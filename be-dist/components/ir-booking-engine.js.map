{"file":"ir-booking-engine.js","mappings":"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","names":["IrBookingEngine","format"],"sources":["src/models/stack.ts","src/components/ir-booking-engine/ir-booking-engine.css?tag=ir-booking-engine&encapsulation=scoped","src/components/ir-booking-engine/ir-booking-engine.tsx"],"sourcesContent":["export default class Stack<TData> {\r\n  private _topNode: Node<TData> = undefined;\r\n  private _count: number = 0;\r\n\r\n  public count(): number {\r\n    return this._count;\r\n  }\r\n\r\n  public isEmpty(): boolean {\r\n    return this._topNode === undefined;\r\n  }\r\n\r\n  public push(value: TData): void {\r\n    console.log(value);\r\n    let node = new Node<TData>(value, this._topNode);\r\n    this._topNode = node;\r\n    this._count++;\r\n  }\r\n\r\n  public pop(): TData {\r\n    let poppedNode = this._topNode;\r\n    this._topNode = poppedNode.previous;\r\n    this._count--;\r\n    return poppedNode.data;\r\n  }\r\n\r\n  public peek(): TData {\r\n    return this._topNode.data;\r\n  }\r\n}\r\n\r\nclass Node<T> {\r\n  previous: Node<T>;\r\n  data: T;\r\n\r\n  constructor(data: T, previous: Node<T>) {\r\n    this.previous = previous;\r\n    this.data = data;\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n","import { CommonService } from '@/services/api/common.service';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport { Component, Listen, Prop, State, Watch, h } from '@stencil/core';\r\nimport { format, Locale } from 'date-fns';\r\nimport { ICurrency, IExposedLanguages } from '@/models/common';\r\nimport axios from 'axios';\r\nimport { IExposedProperty, Variation } from '@/models/property';\r\nimport booking_store, { updateRoomParams } from '@/stores/booking';\r\nimport app_store, { changeLocale, updateUserPreference } from '@/stores/app.store';\r\nimport { checkAffiliate, getUserPrefernce, matchLocale, setDefaultLocale } from '@/utils/utils';\r\nimport Stack from '@/models/stack';\r\nimport { v4 } from 'uuid';\r\nimport { AvailabiltyService } from '@/services/app/availability.service';\r\nimport { checkout_store } from '@/stores/checkout.store';\r\n\r\n@Component({\r\n  tag: 'ir-booking-engine',\r\n  styleUrl: 'ir-booking-engine.css',\r\n  scoped: true,\r\n})\r\nexport class IrBookingEngine {\r\n  @Prop({ mutable: true }) token: string =\r\n    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MTQ1NTQ5OTIsIkNMQUlNLTAxIjoiOGJpaUdjK21FQVE9IiwiQ0xBSU0tMDIiOiI5UStMQm93VTl6az0iLCJDTEFJTS0wMyI6Ilp3Tys5azJoTzUwPSIsIkNMQUlNLTA0IjoicUxHWllZcVA3SzB5aENrRTFaY0tENm5TeFowNkEvQ2lPc1JrWUpYTHFhTEF5M3N0akltbU9CWkdDb080dDRyNVRiWjkxYnZQelFIQ2c1YlBGU2J3cm5HdjNsNjVVcjVLT3RnMmZQVWFnNHNEYmE3WTJkMDF4RGpDWUs2SFlGREhkcTFYTzBLdTVtd0NKeU5rWDFSeWZmSnhJdWdtZFBUeTZPWjk0RUVjYTJleWVSVzZFa0pYMnhCZzFNdnJ3aFRKRHF1cUxzaUxvZ3I0UFU5Y2x0MjdnQ2tJZlJzZ2lZbnpOK2szclZnTUdsQTUvWjRHekJWcHl3a0dqcWlpa0M5T0owWFUrdWJJM1dzNmNvSWEwSks4SWRqVjVaQ1VaZjZ1OGhBMytCUlpsUWlyWmFZVWZlVmpzU1FETFNwWFowYjVQY0FncE1EWVpmRGtWbGFscjRzZ1pRNVkwODkwcEp6dE16T0s2VTR5Z1FMQkdQbTlTSmRLY0ExSGU2MXl2YlhuIiwiQ0xBSU0tMDUiOiJFQTEzejA3ejBUcWRkM2gwNElyYThBcklIUzg2aEpCQSJ9.ySJjLhWwUDeP4X8LIJcbsjO74y_UgMHwRDpNrCClndc';\r\n  @Prop() propertyId: number;\r\n  @Prop() baseUrl: string;\r\n  @Prop() injected: boolean;\r\n  @Prop() roomtype_id: number = null;\r\n  @Prop() redirect_url: string = null;\r\n\r\n  //extra props\r\n  @Prop() perma_link: string = null;\r\n  @Prop() aName: string = null;\r\n  @Prop() fromDate: string;\r\n  @Prop() language: string;\r\n  @Prop() toDate: string;\r\n  @Prop() adultCount: string;\r\n  @Prop() childrenCount: string;\r\n  @Prop() cur: string;\r\n  @Prop() aff: string;\r\n  @Prop() stag: string | null;\r\n  @Prop() property: IExposedProperty | null = null;\r\n  @Prop() source: {\r\n    code: string;\r\n    desciption: string;\r\n  } | null = null;\r\n\r\n  @State() selectedLocale: Locale;\r\n  @State() currencies: ICurrency[];\r\n  @State() languages: IExposedLanguages[];\r\n  @State() isLoading: boolean = false;\r\n\r\n  private commonService = new CommonService();\r\n  private propertyService = new PropertyService();\r\n  private availabiltyService = new AvailabiltyService();\r\n  private identifier: string;\r\n\r\n  @State() router = new Stack<HTMLElement>();\r\n  @State() bookingListingScreenOptions: { screen: 'bookings' | 'booking-details'; params: unknown } = { params: null, screen: 'bookings' };\r\n\r\n  async componentWillLoad() {\r\n    console.log(this.property);\r\n    axios.defaults.withCredentials = true;\r\n    axios.defaults.baseURL = this.baseUrl;\r\n    getUserPrefernce(this.language);\r\n\r\n    const isAuthenticated = this.commonService.checkUserAuthState();\r\n    if (isAuthenticated) {\r\n      app_store.is_signed_in = true;\r\n      this.token = isAuthenticated.token;\r\n      app_store.app_data.token = this.token;\r\n    } else {\r\n      this.token = await this.commonService.getBEToken();\r\n    }\r\n  }\r\n\r\n  @Watch('token')\r\n  handleTokenChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.initializeApp();\r\n    }\r\n  }\r\n\r\n  // @Watch('language')\r\n  // handleLanguageChange(newValue: string, oldValue: string) {\r\n  //   if (!this.languages) {\r\n  //     return;\r\n  //   }\r\n  //   if (newValue !== oldValue) {\r\n  //     this.modifyLanguage(newValue);\r\n  //   }\r\n  // }\r\n  modifyLanguage(code: string) {\r\n    if (!this.languages) {\r\n      return;\r\n    }\r\n    changeLocale(this.languages.find(l => l.code.toLowerCase() === code)?.direction || 'LTR', matchLocale(code));\r\n    updateUserPreference({\r\n      language_id: code,\r\n    });\r\n  }\r\n  @Watch('cur')\r\n  handleCurrencyChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      updateUserPreference({\r\n        currency_id: newValue,\r\n      });\r\n    }\r\n  }\r\n\r\n  initializeApp() {\r\n    this.commonService.setToken(this.token);\r\n    this.propertyService.setToken(this.token);\r\n    app_store.app_data = {\r\n      token: this.token,\r\n      property_id: this.propertyId,\r\n      injected: this.injected,\r\n      roomtype_id: this.roomtype_id,\r\n      redirect_url: this.redirect_url,\r\n      affiliate: null,\r\n      tag: this.stag,\r\n      source: this.source,\r\n    };\r\n    this.initRequest();\r\n  }\r\n  async initRequest() {\r\n    this.isLoading = true;\r\n    const p = JSON.parse(localStorage.getItem('user_preference'));\r\n    let requests = [\r\n      this.commonService.getCurrencies(),\r\n      this.commonService.getExposedLanguages(),\r\n      this.commonService.getExposedCountryByIp(),\r\n      this.commonService.getExposedLanguage(),\r\n      // ,\r\n    ];\r\n    if (!this.property) {\r\n      requests.push(\r\n        this.propertyService.getExposedProperty({ id: this.propertyId, language: app_store.userPreferences?.language_id || 'en', aname: this.aName, perma_link: this.perma_link }),\r\n      );\r\n    }\r\n    if (app_store.is_signed_in) {\r\n      requests.push(this.propertyService.getExposedGuest());\r\n    }\r\n    const [_, currencies, languages] = await Promise.all(requests);\r\n    this.currencies = currencies;\r\n    this.languages = languages;\r\n\r\n    if (!p) {\r\n      if (this.language) {\r\n        this.modifyLanguage(this.language);\r\n      }\r\n      setDefaultLocale({ currency: app_store.userDefaultCountry.currency });\r\n    }\r\n    app_store.app_data = {\r\n      ...app_store.app_data,\r\n      affiliate: checkAffiliate(this.aff?.toLowerCase().trim()),\r\n    };\r\n\r\n    // booking_store.roomTypes = [...roomtypes];\r\n    this.isLoading = false;\r\n  }\r\n  handleVariationChange(e: CustomEvent, variations: Variation[], rateplanId: number, roomTypeId: number) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const value = e.detail;\r\n    const selectedVariation = variations.find(variation => variation.adult_child_offering === value);\r\n    if (!selectedVariation) {\r\n      return;\r\n    }\r\n    updateRoomParams({ params: { selected_variation: { variation: selectedVariation, state: 'modified' } }, ratePlanId: rateplanId, roomTypeId });\r\n  }\r\n\r\n  @Listen('routing')\r\n  handleNavigation(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    app_store.currentPage = e.detail;\r\n  }\r\n  @Listen('resetBooking')\r\n  async handleResetBooking(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    await this.resetBooking(e.detail ?? 'completeReset');\r\n  }\r\n  @Listen('authStatus')\r\n  handleAuthFinish(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    console.log('auth finish');\r\n    const { token, state, payload } = e.detail;\r\n    console.log(token, state, payload);\r\n    if (state === 'success') {\r\n      if (payload.method === 'direct') {\r\n        // this.bookingNumber = payload.booking_nbr;\r\n        // this.token = token;\r\n        this.bookingListingScreenOptions = {\r\n          screen: 'booking-details',\r\n          params: {\r\n            booking_nbr: payload.booking_nbr,\r\n            email: payload.email,\r\n          },\r\n        };\r\n        app_store.currentPage = 'booking-listing';\r\n      }\r\n    }\r\n  }\r\n  async resetBooking(resetType: 'discountOnly' | 'completeReset' = 'completeReset') {\r\n    let queries = [];\r\n    if (resetType === 'discountOnly' && app_store.fetchedBooking) {\r\n      queries.push(this.checkAvailability());\r\n    } else if (resetType === 'completeReset') {\r\n      queries = [\r\n        ...queries,\r\n        ...[\r\n          this.commonService.getExposedLanguage(),\r\n          this.propertyService.getExposedProperty(\r\n            { id: app_store.app_data.property_id, language: app_store.userPreferences?.language_id || 'en', aname: this.aName, perma_link: this.perma_link },\r\n            false,\r\n          ),\r\n        ],\r\n      ];\r\n      if (app_store.fetchedBooking) {\r\n        queries.push(this.checkAvailability());\r\n      }\r\n    }\r\n    await Promise.all(queries);\r\n  }\r\n  async checkAvailability() {\r\n    this.identifier = v4();\r\n    this.availabiltyService.initSocket(this.identifier);\r\n    await this.propertyService.getExposedBookingAvailability({\r\n      params: {\r\n        propertyid: app_store.app_data.property_id,\r\n        from_date: format(booking_store.bookingAvailabilityParams.from_date, 'yyyy-MM-dd'),\r\n        to_date: format(booking_store.bookingAvailabilityParams.to_date, 'yyyy-MM-dd'),\r\n        room_type_ids: [],\r\n        adult_nbr: booking_store.bookingAvailabilityParams.adult_nbr,\r\n        child_nbr: booking_store.bookingAvailabilityParams.child_nbr,\r\n        language: app_store.userPreferences.language_id,\r\n        currency_ref: app_store.userPreferences.currency_id,\r\n        is_in_loyalty_mode: booking_store.bookingAvailabilityParams.loyalty ? true : !!booking_store.bookingAvailabilityParams.coupon,\r\n        promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n        is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n        agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n      },\r\n      identifier: this.identifier,\r\n      mode: 'default',\r\n    });\r\n  }\r\n  renderScreens() {\r\n    switch (app_store.currentPage) {\r\n      case 'booking':\r\n        return <ir-booking-page adultCount={this.adultCount} childrenCount={this.childrenCount} fromDate={this.fromDate} toDate={this.toDate}></ir-booking-page>;\r\n      case 'checkout':\r\n        return <ir-checkout-page></ir-checkout-page>;\r\n      case 'invoice':\r\n        return (\r\n          <ir-invoice\r\n            headerShown={false}\r\n            footerShown={false}\r\n            propertyId={this.propertyId}\r\n            perma_link={this.perma_link}\r\n            aName={this.aName}\r\n            language={this.language}\r\n            baseUrl={this.baseUrl}\r\n            email={app_store.invoice.email}\r\n            bookingNbr={app_store.invoice.booking_number}\r\n            status={1}\r\n            be={true}\r\n          ></ir-invoice>\r\n        );\r\n      case 'booking-listing':\r\n        return (\r\n          <ir-booking-listing\r\n            startScreen={this.bookingListingScreenOptions}\r\n            showAllBookings={false}\r\n            headerShown={false}\r\n            footerShown={false}\r\n            propertyid={this.propertyId}\r\n            perma_link={this.perma_link}\r\n            aName={this.aName}\r\n            be={true}\r\n            baseUrl={this.baseUrl}\r\n            aff={this.aff}\r\n          ></ir-booking-listing>\r\n        );\r\n      case 'user-profile':\r\n        return (\r\n          <ir-user-profile\r\n            user_data={{\r\n              id: checkout_store.userFormData.id,\r\n              email: checkout_store.userFormData.email,\r\n              first_name: checkout_store.userFormData.firstName,\r\n              last_name: checkout_store.userFormData.lastName,\r\n              country_id: checkout_store.userFormData.country_id,\r\n              mobile: checkout_store.userFormData.mobile_number,\r\n              country_phone_prefix: checkout_store.userFormData.country_phone_prefix.toString(),\r\n            }}\r\n          ></ir-user-profile>\r\n        );\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n  disconnectedCallback() {\r\n    this.availabiltyService.disconnectSocket();\r\n  }\r\n  render() {\r\n    if (this.isLoading) {\r\n      return null;\r\n    }\r\n    return (\r\n      <main class=\"relative  flex w-full flex-col space-y-5 \">\r\n        <ir-interceptor></ir-interceptor>\r\n        <section class=\"sticky top-0 z-50 m-0 w-full p-0 \">\r\n          <ir-nav\r\n            class={'m-0 p-0'}\r\n            website={app_store.property?.space_theme.website}\r\n            logo={app_store.property?.space_theme?.logo}\r\n            currencies={this.currencies}\r\n            languages={this.languages}\r\n          ></ir-nav>\r\n        </section>\r\n        <section class=\"flex-1 px-4 lg:px-6\">\r\n          <div class=\"mx-auto max-w-6xl\">{this.renderScreens()}</div>\r\n        </section>\r\n        {!this.injected && <ir-footer></ir-footer>}\r\n      </main>\r\n    );\r\n  }\r\n}\r\n"],"version":3}