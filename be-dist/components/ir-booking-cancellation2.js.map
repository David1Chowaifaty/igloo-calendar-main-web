{"file":"ir-booking-cancellation2.js","mappings":";;;;;;;;;;;MAEa,cAAc;IAClB,MAAM,mBAAmB,CAAC,MAAsE;QACrG,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,CAAC,IAAI,CAAC,wBAAwB,EAAE,MAAM,CAAC,CAAC;QACpE,IAAI,IAAI,CAAC,YAAY,KAAK,EAAE,EAAE;YAC5B,MAAM,IAAI,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SACpC;QACD,OAAO,IAAI,CAAC,SAAS,CAAC;KACvB;;;ACTH,MAAM,wBAAwB,GAAG,+glBAA+glB,CAAC;AACjjlB,oCAAe,wBAAwB;;MCY1B,qBAAqB;IALlC;;;;;;QASW,WAAM,GAAG,KAAK,CAAC;QACf,aAAQ,GAAmB,EAAE,CAAC;QAO/B,mBAAc,GAAG,IAAI,cAAc,EAAE,CAAC;QACtC,mBAAc,GAAG,IAAI,cAAc,EAAE,CAAC;KAwI/C;IAtIC,MAAM,IAAI;QACR,IAAI;YACF,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;gBACjB,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;aACpC;YACD,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;YACnB,IAAI,CAAC,mBAAmB,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,mBAAmB,CAAC;gBACvE,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW;gBACrC,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;gBACrC,QAAQ,EAAE,SAAS,CAAC,eAAe,CAAC,WAAW;aAChD,CAAC,CAAC;SACJ;QAAC,OAAO,KAAK,EAAE;YACd,OAAO,CAAC,KAAK,CAAC,8BAA8B,EAAE,KAAK,CAAC,CAAC;SACtD;KACF;IACO,MAAM,yBAAyB;QACrC,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YAC5B,OAAO;SACR;QACD,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,0BAA0B,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QACnF,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;QACrB,IAAI,OAAO,EAAE;YACX,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,oBAAoB,CAAC;SAC9C;KACF;IAED,MAAM,UAAU;QACd,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3B,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC;QAC7B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC1B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;SACpC;QACD,MAAM,IAAI,CAAC,IAAI,EAAE,CAAC;KACnB;IAEO,gBAAgB;QACtB,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,CAAC;QAC9B,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;KAC7B;IAED,MAAM;;QACJ,MAAM,SAAS,GAAG,gBAAgB,CAAC,kCAAkC,CAAC,CAAC;;QAEvE,QACE,8DACE,wEACE,GAAG,EAAE,EAAE,KAAK,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC,EAClC,YAAY,EAAE,CAAC;gBACb,IAAI,CAAC,CAAC,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,EAAE;oBAC5B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;iBACrB;aACF,IAED,2DAAI,IAAI,EAAC,aAAa,EAAC,KAAK,EAAC,qBAAqB,IAC/C,cAAc,CAAC,OAAO,CAAC,uBAAuB,CAC5C,EACL,4DAAK,KAAK,EAAC,MAAM,EAAC,IAAI,EAAC,YAAY,IAChC,gBAAgB,CAAC,wBAAwB,CAAC,IACzC,WAAK,KAAK,EAAC,MAAM,IACf,mBAAa,KAAK,EAAC,iBAAiB,GAAe,CAC/C,KAEN,EAAC,QAAQ,QAMP,SAAG,KAAK,EAAC,QAAQ,IAAE,IAAI,CAAC,mBAAmB,CAAK,EAChD,cACE,OAAO,EAAE;gBACP,IAAI,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC;gBAC3B,IAAI,CAAC,yBAAyB,EAAE,CAAC;aAClC,EACD,KAAK,EAAC,4DAA4D,IAElE,aAAI,cAAc,CAAC,OAAO,CAAC,eAAe,CAAK,EAC/C,gBAAU,IAAI,EAAE,IAAI,CAAC,MAAM,GAAG,UAAU,GAAG,YAAY,EAAE,YAAY,EAAC,KAAK,GAAY,CAChF,EACR,IAAI,CAAC,MAAM,KACV,EAAC,QAAQ,QACN,gBAAgB,CAAC,kCAAkC,CAAC,IACnD,WAAK,KAAK,EAAC,aAAa,IACtB,mBAAa,KAAK,EAAC,mBAAmB,GAAe,CACjD,KAEN,WAAK,KAAK,EAAE,eAAe,IACxB,MAAA,IAAI,CAAC,QAAQ,0CAAE,GAAG,CAAC,CAAC,KACnB,WAAK,KAAK,EAAC,oBAAoB,IAC7B,SAAG,KAAK,EAAE,aAAa,IACpB,CAAC,CAAC,OAAO,OAAG,CAAC,CAAC,OAAO,CACpB,EACJ,SAAG,KAAK,EAAC,uBAAuB,IAAE,CAAC,CAAC,SAAS,CAAK,CAC9C,CACP,CAAC,CACE,CACP,CACQ,CACZ,CACQ,CACZ,CACG,EAEN,4DAAK,IAAI,EAAC,cAAc,IACtB,kEACE,KAAK,EAAE,cAAc,CAAC,OAAO,CAAC,UAAU,EACxC,QAAQ,EAAC,SAAS,EAClB,aAAa,EAAE;gBACb,IAAI,CAAC,gBAAgB,EAAE,CAAC;aACzB,EACD,IAAI,EAAC,IAAI,GACE,EACb,kEACE,QAAQ,EAAE,SAAS,EACnB,IAAI,EAAC,IAAI,EACT,KAAK,EAAE,cAAc,CAAC,OAAO,CAAC,oBAAoB,EAClD,SAAS,EAAE,gBAAgB,CAAC,8BAA8B,CAAC,EAC3D,aAAa,EAAE;gBACb,IAAI;oBACF,MAAM,IAAI,CAAC,cAAc,CAAC,0BAA0B,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;oBAC/E,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;oBAC1F,IAAI,CAAC,gBAAgB,EAAE,CAAC;iBACzB;gBAAC,OAAO,KAAK,EAAE;oBACd,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;oBACrB,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,WAAW,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;iBAC1F;aACF,GACU,CACT,CACU,CACd,EACN;KACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":[],"sources":["src/services/api/booking.service.ts","src/components/ir-booking-cancellation/ir-booking-cancellation.css?tag=ir-booking-cancellation&encapsulation=shadow","src/components/ir-booking-cancellation/ir-booking-cancellation.tsx"],"sourcesContent":["import axios from 'axios';\r\n\r\nexport class BookingService {\r\n  public async GetPenaltyStatement(params: { booking_nbr: string; currency_id: number; language: string }) {\r\n    const { data } = await axios.post('/Get_Penalty_Statement', params);\r\n    if (data.ExceptionMsg !== '') {\r\n      throw new Error(data.ExceptionMsg);\r\n    }\r\n    return data.My_Result;\r\n  }\r\n}\r\n","\r\n","import { Component, Event, EventEmitter, Fragment, h, Method, Prop, State } from '@stencil/core';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport { PaymentService, TBookingInfo } from '@/services/api/payment.service';\r\nimport { Booking } from '@/models/booking.dto';\r\nimport localizedWords from '@/stores/localization.store';\r\nimport app_store from '@/stores/app.store';\r\nimport { BookingService } from '@/services/api/booking.service';\r\n\r\n@Component({\r\n  tag: 'ir-booking-cancellation',\r\n  styleUrl: 'ir-booking-cancellation.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingCancellation {\r\n  @Prop() property_id: number;\r\n  @Prop() booking: Booking;\r\n  @State() isLoading: boolean;\r\n  @State() isOpen = false;\r\n  @State() policies: TBookingInfo[] = [];\r\n  @State() cancellationMessage: string;\r\n\r\n  @Event() openChange: EventEmitter<boolean>;\r\n  @Event() cancellationResult: EventEmitter<{ state: 'failed' | 'success'; booking_nbr: string }>;\r\n\r\n  private alertDialog: HTMLIrAlertDialogElement;\r\n  private paymentService = new PaymentService();\r\n  private bookingService = new BookingService();\r\n\r\n  async init() {\r\n    try {\r\n      if (!this.booking) {\r\n        throw new Error('Missing Booking');\r\n      }\r\n      this.policies = [];\r\n      this.cancellationMessage = await this.bookingService.GetPenaltyStatement({\r\n        booking_nbr: this.booking.booking_nbr,\r\n        currency_id: this.booking.currency.id,\r\n        language: app_store.userPreferences.language_id,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error during initialization:', error);\r\n    }\r\n  }\r\n  private async fetchRatePlansMoreDetails() {\r\n    if (this.policies.length > 0) {\r\n      return;\r\n    }\r\n    const results = await this.paymentService.getBookingPrepaymentAmount(this.booking);\r\n    console.log(results);\r\n    if (results) {\r\n      this.policies = results.cancelation_policies;\r\n    }\r\n  }\r\n  @Method()\r\n  async openDialog() {\r\n    this.openChange.emit(true);\r\n    this.alertDialog.openModal();\r\n    console.log(this.booking);\r\n    if (!this.booking) {\r\n      throw new Error('Missing booking');\r\n    }\r\n    await this.init();\r\n  }\r\n\r\n  private closeAlertDialog() {\r\n    this.alertDialog.closeModal();\r\n    this.openChange.emit(false);\r\n  }\r\n\r\n  render() {\r\n    const isPending = isRequestPending('/Get_Exposed_Applicable_Policies');\r\n    // const isPending = isRequestPending('/Get_Exposed_Cancelation_Due_Amount');\r\n    return (\r\n      <div>\r\n        <ir-alert-dialog\r\n          ref={el => (this.alertDialog = el)}\r\n          onOpenChange={e => {\r\n            if (!e.detail && this.isOpen) {\r\n              this.isOpen = false;\r\n            }\r\n          }}\r\n        >\r\n          <h2 slot=\"modal-title\" class=\"text-lg font-medium\">\r\n            {localizedWords.entries.Lcz_BookingCancellation}\r\n          </h2>\r\n          <div class=\"py-3\" slot=\"modal-body\">\r\n            {isRequestPending('/Get_Penalty_Statement') ? (\r\n              <div class=\"h-24\">\r\n                <ir-skeleton class=\"mb-2.5 h-4 w-60\"></ir-skeleton>\r\n              </div>\r\n            ) : (\r\n              <Fragment>\r\n                {/* {this.paymentAmount > 0 ? (\r\n                  <p class=\"mb-2.5 font-semibold\">{localizedWords.entries.Lcz_IfYouCancelNow.replace('%1', formatAmount(this.paymentAmount, this.currency?.code || 'usd'))}.</p>\r\n                ) : (\r\n                  <p class=\"mb-2.5 font-semibold\">{localizedWords.entries.Lcz_NoPenalityIsApplied}</p>\r\n                )} */}\r\n                <p class=\"mb-2.5\">{this.cancellationMessage}</p>\r\n                <button\r\n                  onClick={() => {\r\n                    this.isOpen = !this.isOpen;\r\n                    this.fetchRatePlansMoreDetails();\r\n                  }}\r\n                  class=\"flex w-full items-center justify-between rounded-md  py-1 \"\r\n                >\r\n                  <p>{localizedWords.entries.Lcz_MoreDetails}</p>\r\n                  <ir-icons name={this.isOpen ? 'angle_up' : 'angle_down'} svgClassName=\"h-3\"></ir-icons>\r\n                </button>\r\n                {this.isOpen && (\r\n                  <Fragment>\r\n                    {isRequestPending('/Get_Exposed_Applicable_Policies') ? (\r\n                      <div class=\"h-20 w-full\">\r\n                        <ir-skeleton class=\"mb-2.5 h-20  w-60\"></ir-skeleton>\r\n                      </div>\r\n                    ) : (\r\n                      <div class={'divide-y py-2'}>\r\n                        {this.policies?.map(d => (\r\n                          <div class=\"space-y-1.5 py-2.5\">\r\n                            <p class={'font-medium'}>\r\n                              {d.rt_name} {d.rp_name}\r\n                            </p>\r\n                            <p class=\"text-xs text-gray-500\">{d.statement}</p>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </Fragment>\r\n                )}\r\n              </Fragment>\r\n            )}\r\n          </div>\r\n\r\n          <div slot=\"modal-footer\">\r\n            <ir-button\r\n              label={localizedWords.entries.Lcz_Cancel}\r\n              variants=\"outline\"\r\n              onButtonClick={() => {\r\n                this.closeAlertDialog();\r\n              }}\r\n              size=\"md\"\r\n            ></ir-button>\r\n            <ir-button\r\n              disabled={isPending}\r\n              size=\"md\"\r\n              label={localizedWords.entries.Lcz_AcceptAndConfirm}\r\n              isLoading={isRequestPending('/Request_Booking_Cancelation')}\r\n              onButtonClick={async () => {\r\n                try {\r\n                  await this.paymentService.RequestBookingCancellation(this.booking.booking_nbr);\r\n                  this.cancellationResult.emit({ state: 'success', booking_nbr: this.booking.booking_nbr });\r\n                  this.closeAlertDialog();\r\n                } catch (error) {\r\n                  console.error(error);\r\n                  this.cancellationResult.emit({ state: 'failed', booking_nbr: this.booking.booking_nbr });\r\n                }\r\n              }}\r\n            ></ir-button>\r\n          </div>\r\n        </ir-alert-dialog>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"version":3}