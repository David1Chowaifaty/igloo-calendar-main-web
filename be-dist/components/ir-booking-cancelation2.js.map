{"file":"ir-booking-cancelation2.js","mappings":"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","names":[],"sources":["src/components/ir-booking-cancelation/ir-booking-cancelation.css?tag=ir-booking-cancelation&encapsulation=shadow","src/components/ir-booking-cancelation/ir-booking-cancelation.tsx"],"sourcesContent":["\r\n","import { Component, Event, EventEmitter, Fragment, h, Method, Prop, State } from '@stencil/core';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport { PaymentService, TBookingInfo } from '@/services/api/payment.service';\r\nimport app_store from '@/stores/app.store';\r\nimport { formatAmount } from '@/utils/utils';\r\nimport { Booking } from '@/models/booking.dto';\r\nimport localizedWords from '@/stores/localization.store';\r\n\r\n@Component({\r\n  tag: 'ir-booking-cancelation',\r\n  styleUrl: 'ir-booking-cancelation.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingCancelation {\r\n  @Prop() booking_nbr: string;\r\n  @Prop() cancelation: string;\r\n  @Prop() cancelation_policies: TBookingInfo[] = [];\r\n  @Prop() currency: { code: string; id: number };\r\n  @Prop() booking: Booking;\r\n  @State() paymentAmount: number;\r\n  @State() isLoading: boolean;\r\n  @State() isOpen = false;\r\n  @State() policies: TBookingInfo[] = [];\r\n\r\n  @Event() openChange: EventEmitter<boolean>;\r\n  @Event() cancelationResult: EventEmitter<{ state: 'failed' | 'success'; booking_nbr: string }>;\r\n\r\n  private alertDialog: HTMLIrAlertDialogElement;\r\n  private paymentService = new PaymentService();\r\n\r\n  componentWillLoad() {\r\n    this.paymentService.setToken(app_store.app_data.token);\r\n  }\r\n  async setOverdueAmount() {\r\n    try {\r\n      const res = await this.paymentService.getExposedCancelationDueAmount({\r\n        booking_nbr: this.booking_nbr,\r\n        currency_id: this.currency.id,\r\n      });\r\n\r\n      const overdueResult = res.find(f => f.type === 'overdue');\r\n      if (overdueResult) {\r\n        this.paymentAmount = overdueResult.amount;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching overdue amount:', error);\r\n    }\r\n  }\r\n  async init() {\r\n    try {\r\n      this.policies = this.cancelation_policies;\r\n      const requests = [];\r\n      if (this.cancelation_policies.length === 0 && this.booking) {\r\n        const prepaymentPromise = this.paymentService.getBookingPrepaymentAmount(this.booking);\r\n        requests.push(prepaymentPromise);\r\n      }\r\n      const overdueAmountPromise = this.setOverdueAmount();\r\n      requests.push(overdueAmountPromise);\r\n      const results = await Promise.all(requests);\r\n      if (this.cancelation_policies.length === 0 && this.booking) {\r\n        const prepaymentResult = results.length > 1 ? results[0] : null;\r\n        if (prepaymentResult) {\r\n          this.policies = prepaymentResult.cancelation_policies ?? this.policies;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error during initialization:', error);\r\n    }\r\n  }\r\n  @Method()\r\n  async openDialog() {\r\n    this.openChange.emit(true);\r\n    this.alertDialog.openModal();\r\n    await this.init();\r\n  }\r\n\r\n  private closeAlertDialog() {\r\n    this.alertDialog.closeModal();\r\n    this.openChange.emit(false);\r\n  }\r\n\r\n  render() {\r\n    const isPending = isRequestPending('/Get_Exposed_Cancelation_Due_Amount');\r\n    return (\r\n      <div>\r\n        <ir-alert-dialog\r\n          ref={el => (this.alertDialog = el)}\r\n          onOpenChange={e => {\r\n            if (!e.detail && this.isOpen) {\r\n              this.isOpen = false;\r\n            }\r\n          }}\r\n        >\r\n          <h2 slot=\"modal-title\" class=\"text-lg font-medium\">\r\n            {localizedWords.entries.Lcz_BookingCancellation}\r\n          </h2>\r\n          <div class=\"py-3\" slot=\"modal-body\">\r\n            {isPending ? (\r\n              <div class=\"h-24\">\r\n                <ir-skeleton class=\"mb-2.5 h-4 w-60\"></ir-skeleton>\r\n              </div>\r\n            ) : (\r\n              <Fragment>\r\n                {this.paymentAmount > 0 ? (\r\n                  <p class=\"mb-2.5 font-semibold\">{`If you cancel now, the penalty will be ${formatAmount(this.paymentAmount, this.currency?.code || 'usd')}.`}</p>\r\n                ) : (\r\n                  <p class=\"mb-2.5 font-semibold\">{localizedWords.entries.Lcz_NoPenalityIsApplied}</p>\r\n                )}\r\n                <button\r\n                  onClick={() => {\r\n                    this.isOpen = !this.isOpen;\r\n                  }}\r\n                  class=\"flex w-full items-center justify-between rounded-md  py-1 \"\r\n                >\r\n                  <p>{localizedWords.entries.Lcz_MoreDetails}</p>\r\n                  <ir-icons name={this.isOpen ? 'angle_up' : 'angle_down'} svgClassName=\"h-3\"></ir-icons>\r\n                </button>\r\n                {this.isOpen && (\r\n                  <Fragment>\r\n                    <div class={'divide-y py-2'}>\r\n                      {this.policies?.map(d => (\r\n                        <div class=\"space-y-1.5 py-2.5\">\r\n                          <p class={'font-medium'}>\r\n                            {d.rt_name} {d.rp_name}\r\n                          </p>\r\n                          <p class=\"text-xs text-gray-500\">{d.statement}</p>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </Fragment>\r\n                )}\r\n              </Fragment>\r\n            )}\r\n          </div>\r\n\r\n          <div slot=\"modal-footer\">\r\n            <ir-button\r\n              label={localizedWords.entries.Lcz_Cancel}\r\n              variants=\"outline\"\r\n              onButtonClick={() => {\r\n                this.closeAlertDialog();\r\n              }}\r\n              size=\"md\"\r\n            ></ir-button>\r\n            <ir-button\r\n              disabled={isPending}\r\n              size=\"md\"\r\n              label={localizedWords.entries.Lcz_AcceptAndConfirm}\r\n              isLoading={isRequestPending('/Request_Booking_Cancelation')}\r\n              onButtonClick={async () => {\r\n                try {\r\n                  await this.paymentService.RequestBookingCancelation(this.booking_nbr);\r\n                  this.cancelationResult.emit({ state: 'success', booking_nbr: this.booking_nbr });\r\n                  this.closeAlertDialog();\r\n                } catch (error) {\r\n                  console.error(error);\r\n                  this.cancelationResult.emit({ state: 'failed', booking_nbr: this.booking_nbr });\r\n                }\r\n              }}\r\n            ></ir-button>\r\n          </div>\r\n        </ir-alert-dialog>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"version":3}