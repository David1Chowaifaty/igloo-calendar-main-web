{"file":"ir-availibility-header2.js","mappings":"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","names":["format","localization_store"],"sources":["src/components/ir-booking-engine/ir-booking-page/ir-availibility-header/availability.ts","src/components/ir-booking-engine/ir-booking-page/ir-availibility-header/ir-availibility-header.css?tag=ir-availibility-header&encapsulation=shadow","src/components/ir-booking-engine/ir-booking-page/ir-availibility-header/ir-availibility-header.tsx"],"sourcesContent":["import { z } from 'zod';\r\n\r\nexport const ExposedBookingAvailability = z.object({\r\n  propertyid: z.coerce.number(),\r\n  from_date: z.string().min(2),\r\n  to_date: z.string().min(2),\r\n  room_type_ids: z.string().array().optional().default([]),\r\n  adult_nbr: z.number().min(1),\r\n  child_nbr: z.number().min(0),\r\n  language: z.string().default('en'),\r\n  currency_ref: z.string(),\r\n  is_in_loyalty_mode: z.boolean().default(false),\r\n  promo_key: z.string(),\r\n  is_in_agent_mode: z.boolean().default(false),\r\n  agent_id: z.number().default(0).optional(),\r\n});\r\n\r\nexport type TExposedBookingAvailability = z.infer<typeof ExposedBookingAvailability>;\r\n",":host {\r\n  display: block;\r\n}\r\n.availability-container {\r\n  border-radius: min(var(--radius, 8px), 8px);\r\n}\r\n","import { Component, Event, EventEmitter, h, Listen, State } from '@stencil/core';\r\nimport { ExposedBookingAvailability, TExposedBookingAvailability } from './availability';\r\nimport { format } from 'date-fns';\r\nimport { ZodError } from 'zod';\r\nimport { createPopper } from '@popperjs/core';\r\nimport localization_store, { onAppDataChange } from '@/stores/app.store';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport app_store from '@/stores/app.store';\r\nimport booking_store from '@/stores/booking';\r\n\r\n@Component({\r\n  tag: 'ir-availibility-header',\r\n  styleUrl: 'ir-availibility-header.css',\r\n  shadow: true,\r\n})\r\nexport class IrAvailibilityHeader {\r\n  @State() exposedBookingAvailabiltyParams: TExposedBookingAvailability = {\r\n    adult_nbr: 1,\r\n    child_nbr: 0,\r\n    currency_ref: 'USD',\r\n    language: 'en',\r\n    room_type_ids: [],\r\n    propertyid: 42,\r\n    is_in_loyalty_mode: !!booking_store.bookingAvailabilityParams.coupon,\r\n    promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n    is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n    agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n  };\r\n\r\n  @State() errorCause: 'date' | 'adult_child' | null = null;\r\n  @State() isLoading = false;\r\n\r\n  @Event() resetBooking: EventEmitter<null>;\r\n\r\n  private popoverInstance = null;\r\n  private datePopup: HTMLIrDatePopupElement;\r\n  private dateToast: HTMLDivElement;\r\n  private toast_timeout: NodeJS.Timeout;\r\n\r\n  private propertyService = new PropertyService();\r\n\r\n  componentWillLoad() {\r\n    const { token, property_id } = app_store.app_data;\r\n    this.propertyService.setToken(token);\r\n    if (booking_store.bookingAvailabilityParams.from_date) {\r\n      this.exposedBookingAvailabiltyParams.from_date = format(booking_store.bookingAvailabilityParams.from_date, 'yyyy-MM-dd');\r\n      this.exposedBookingAvailabiltyParams.to_date = format(booking_store.bookingAvailabilityParams.to_date, 'yyyy-MM-dd');\r\n    }\r\n    this.changeExposedAvailabilityParams({\r\n      propertyid: property_id,\r\n      language: app_store.userPreferences.language_id,\r\n      currency_ref: app_store.userPreferences.currency_id,\r\n    });\r\n    onAppDataChange('userPreferences', async newValue => {\r\n      this.changeExposedAvailabilityParams({\r\n        language: newValue.language_id,\r\n        currency_ref: newValue.currency_id,\r\n      });\r\n      try {\r\n        if (app_store.currentPage === 'booking') {\r\n          this.resetBooking.emit(null);\r\n        }\r\n      } catch (error) {}\r\n    });\r\n  }\r\n  componentDidLoad() {\r\n    createPopper(this.datePopup, this.dateToast, {\r\n      placement: localization_store.dir === 'LTR' ? 'bottom-start' : 'bottom-end',\r\n      modifiers: [\r\n        {\r\n          name: 'offset',\r\n          options: {\r\n            offset: [0, 3],\r\n          },\r\n        },\r\n      ],\r\n    });\r\n  }\r\n\r\n  async checkAvailability() {\r\n    const params = ExposedBookingAvailability.parse(this.exposedBookingAvailabiltyParams);\r\n    await this.propertyService.getExposedBookingAvailability({\r\n      ...this.exposedBookingAvailabiltyParams,\r\n      is_in_loyalty_mode: !!booking_store.bookingAvailabilityParams.coupon,\r\n      promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n      is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n      agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n    });\r\n    booking_store.bookingAvailabilityParams = {\r\n      ...booking_store.bookingAvailabilityParams,\r\n      from_date: new Date(params.from_date),\r\n      to_date: new Date(params.to_date),\r\n      adult_nbr: params.adult_nbr,\r\n      child_nbr: params.child_nbr,\r\n    };\r\n    console.log(booking_store.bookingAvailabilityParams);\r\n  }\r\n\r\n  async handleCheckAvailability() {\r\n    try {\r\n      this.isLoading = true;\r\n      await this.checkAvailability();\r\n      app_store.fetchedBooking = true;\r\n    } catch (error) {\r\n      if (error instanceof ZodError) {\r\n        for (const err of error.errors) {\r\n          const error_cause = err.path[0].toString();\r\n          if (error_cause.includes('date')) {\r\n            this.triggerToast('date');\r\n            break;\r\n          } else if (error_cause.includes('nbr')) {\r\n            this.triggerToast('adult_child');\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n  triggerToast(cause: 'date' | 'adult_child') {\r\n    this.errorCause = cause;\r\n    setTimeout(() => {\r\n      this.errorCause = null;\r\n    }, 2000);\r\n  }\r\n  changeExposedAvailabilityParams(params: Partial<TExposedBookingAvailability>) {\r\n    this.exposedBookingAvailabiltyParams = {\r\n      ...this.exposedBookingAvailabiltyParams,\r\n      ...params,\r\n    };\r\n  }\r\n  @Listen('dateChange')\r\n  handleDateChange(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const { start, end } = e.detail;\r\n    if (end) {\r\n      this.changeExposedAvailabilityParams({\r\n        from_date: format(start, 'yyyy-MM-dd').toString(),\r\n        to_date: format(end, 'yyyy-MM-dd').toString(),\r\n      });\r\n    } else if (this.exposedBookingAvailabiltyParams.to_date && !end) {\r\n      this.changeExposedAvailabilityParams({\r\n        from_date: format(start, 'yyyy-MM-dd').toString(),\r\n        to_date: null,\r\n      });\r\n    } else {\r\n      this.changeExposedAvailabilityParams({ from_date: format(start, 'yyyy-MM-dd') });\r\n    }\r\n  }\r\n  @Listen('addAdultsAndChildren')\r\n  handleAdultChildChange(e: CustomEvent) {\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n    this.changeExposedAvailabilityParams({ ...e.detail });\r\n  }\r\n  disconnectedCallback() {\r\n    if (this.popoverInstance) {\r\n      this.popoverInstance.destroy();\r\n    }\r\n    if (this.toast_timeout) {\r\n      clearTimeout(this.toast_timeout);\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <div class=\"availability-container flex flex-col items-center gap-4 bg-gray-100 p-2 sm:flex-row sm:flex-wrap sm:justify-center \">\r\n        <div class=\"flex w-full flex-col items-center gap-4 sm:w-fit sm:flex-row lg:mr-10\">\r\n          <ir-date-popup\r\n            ref={el => (this.datePopup = el)}\r\n            dates={{\r\n              start: this.exposedBookingAvailabiltyParams?.from_date ? new Date(this.exposedBookingAvailabiltyParams.from_date) : null,\r\n              end: this.exposedBookingAvailabiltyParams?.to_date ? new Date(this.exposedBookingAvailabiltyParams.to_date) : null,\r\n            }}\r\n            class=\"w-full sm:w-auto\"\r\n          ></ir-date-popup>\r\n          <div ref={el => (this.dateToast = el)}>{this.errorCause === 'date' && <p class=\"rounded-md bg-red-500 px-5 py-1 text-sm text-white\"> Select a date</p>}</div>\r\n          <ir-adult-child-counter class=\"w-full sm:w-auto\"></ir-adult-child-counter>\r\n          <ir-button\r\n            isLoading={this.isLoading}\r\n            onButtonClick={e => {\r\n              e.stopImmediatePropagation();\r\n              e.stopPropagation();\r\n              this.handleCheckAvailability();\r\n            }}\r\n            label=\"Search\"\r\n            size=\"lg\"\r\n            class=\"w-full sm:w-auto\"\r\n            buttonClassName=\"justify-center\"\r\n          ></ir-button>\r\n        </div>\r\n        {app_store?.property?.promotions && (\r\n          <div class={'flex w-full flex-wrap  items-center gap-4 sm:justify-center md:w-fit md:justify-start'}>\r\n            <ir-coupon-dialog class=\"w-full sm:w-fit\"></ir-coupon-dialog>\r\n            <ir-loyalty class=\"w-full sm:w-fit\"></ir-loyalty>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"version":3}