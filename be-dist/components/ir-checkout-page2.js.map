{"file":"ir-checkout-page2.js","mappings":"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","names":[],"sources":["src/components/ir-booking-engine/ir-checkout-page/ir-checkout-page.css?tag=ir-checkout-page&encapsulation=scoped","src/components/ir-booking-engine/ir-checkout-page/ir-checkout-page.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}\r\n","import { pages } from '@/models/common';\r\nimport { PickupFormData } from '@/models/pickup';\r\nimport { IrUserFormData } from '@/models/user_form';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport app_store from '@/stores/app.store';\r\nimport booking_store from '@/stores/booking';\r\nimport { checkout_store } from '@/stores/checkout.store';\r\nimport interceptor_requests, { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport { Component, Host, Listen, State, h, Event, EventEmitter } from '@stencil/core';\r\nimport { ZodError, ZodIssue } from 'zod';\r\n\r\n@Component({\r\n  tag: 'ir-checkout-page',\r\n  styleUrl: 'ir-checkout-page.css',\r\n  scoped: true,\r\n})\r\nexport class IrCheckoutPage {\r\n  @State() isLoading = false;\r\n  @State() error: { cause: 'user' | 'pickup'; issues: Record<string, ZodIssue> };\r\n\r\n  private propertyService = new PropertyService();\r\n\r\n  @Event() routing: EventEmitter<pages>;\r\n  userForm: HTMLIrUserFormElement;\r\n  bookingDetails: HTMLIrBookingDetailsElement;\r\n  pickupForm: HTMLIrPickupElement;\r\n  errorElement: HTMLElement;\r\n\r\n  componentWillLoad() {\r\n    this.propertyService.setToken(app_store.app_data.token);\r\n  }\r\n\r\n  @Listen('bookingClicked')\r\n  async handleBooking(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    this.error = undefined;\r\n    this.isLoading = true;\r\n    try {\r\n      IrUserFormData.parse(checkout_store.userFormData);\r\n    } catch (error) {\r\n      if (error instanceof ZodError) {\r\n        console.log(error);\r\n        let issues: Record<string, ZodIssue> = {};\r\n        error.issues.map(issue => (issues[issue.path[0]] = issue));\r\n        this.error = {\r\n          cause: 'user',\r\n          issues,\r\n        };\r\n        this.errorElement = this.userForm;\r\n        this.scrollToError();\r\n      }\r\n      this.isLoading = false;\r\n\r\n      return;\r\n    }\r\n    console.log('first');\r\n    try {\r\n      if (checkout_store.pickup.location) {\r\n        PickupFormData.parse(checkout_store.pickup);\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n      if (error instanceof ZodError) {\r\n        let issues: Record<string, ZodIssue> = {};\r\n        error.issues.map(issue => (issues[issue.path[0]] = issue));\r\n        this.error = {\r\n          cause: 'pickup',\r\n          issues,\r\n        };\r\n        this.errorElement = this.pickupForm;\r\n        this.scrollToError();\r\n      }\r\n      this.isLoading = false;\r\n\r\n      return;\r\n    }\r\n    try {\r\n      const result = await this.propertyService.bookUser();\r\n      booking_store.booking = result;\r\n      this.routing.emit('invoice');\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n    this.isLoading = false;\r\n  }\r\n  scrollToError() {\r\n    if (this.errorElement) {\r\n      this.errorElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n      window.setTimeout(() => {\r\n        window.scrollBy(0, -150);\r\n      }, 500);\r\n    }\r\n  }\r\n  render() {\r\n    console.log(\r\n      isRequestPending('/Get_Exposed_Countries') || isRequestPending('/Get_Country_By_IP'),\r\n      isRequestPending('/Get_Exposed_Countries'),\r\n      isRequestPending('/Get_Country_By_IP'),\r\n      Object.keys(interceptor_requests),\r\n    );\r\n    if (isRequestPending('/Get_Exposed_Booking_Availability') || isRequestPending('/Get_Exposed_Countries') || isRequestPending('/Get_Country_By_IP')) {\r\n      return <ir-checkout-skeleton></ir-checkout-skeleton>;\r\n    }\r\n    return (\r\n      <Host>\r\n        <ir-seo-injector pageTitle={'checkout'} pageKeywords=\"checkout\" pageDescription=\"checkout page\"></ir-seo-injector>\r\n        <main class=\"flex w-full  flex-col justify-between gap-4  md:flex-row md:items-start\">\r\n          <section class=\"w-full space-y-4 md:max-w-4xl\">\r\n            <div class=\"flex items-center gap-2.5\">\r\n              <ir-button\r\n                variants=\"icon\"\r\n                onButtonClick={e => {\r\n                  e.stopPropagation();\r\n                  e.stopImmediatePropagation();\r\n                  this.routing.emit('booking');\r\n                }}\r\n              >\r\n                <ir-icons name={app_store.dir === 'RTL' ? 'angle_right' : ('angle_left' as any)} slot=\"btn-icon\"></ir-icons>\r\n              </ir-button>\r\n              <p class=\"text-2xl font-semibold\">Complete your booking</p>\r\n            </div>\r\n            <div>\r\n              <ir-quick-auth></ir-quick-auth>\r\n            </div>\r\n            <div class={'space-y-8'}>\r\n              <div>\r\n                <ir-user-form ref={el => (this.userForm = el)} class=\"\" errors={this.error && this.error.cause === 'user' ? this.error.issues : undefined}></ir-user-form>\r\n              </div>\r\n              <div>\r\n                <ir-booking-details ref={el => (this.bookingDetails = el)}></ir-booking-details>\r\n              </div>\r\n              <div>\r\n                <ir-pickup ref={el => (this.pickupForm = el)} errors={this.error && this.error.cause === 'pickup' ? this.error.issues : undefined}></ir-pickup>\r\n              </div>\r\n            </div>\r\n            {/* <ir-phone-input></ir-phone-input> */}\r\n          </section>\r\n          <section class=\"w-full md:sticky  md:top-20  md:flex md:max-w-md md:justify-end\">\r\n            <ir-booking-summary isLoading={this.isLoading}></ir-booking-summary>\r\n          </section>\r\n        </main>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}