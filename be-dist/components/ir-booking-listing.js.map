{"file":"ir-booking-listing.js","mappings":"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","names":["IrBookingListing","differenceInCalendarDays","format"],"sources":["src/services/api/booking_listing.service.ts","src/components/ir-booking-engine/ir-booking-listing/ir-booking-listing.css?tag=ir-booking-listing&encapsulation=shadow","src/components/ir-booking-engine/ir-booking-listing/ir-booking-listing.tsx"],"sourcesContent":["import { MissingTokenError, Token } from '@/models/Token';\r\nimport axios from 'axios';\r\n\r\nexport class BookingListingService extends Token {\r\n  public async getExposedGuestToken(property_id: string | number) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new MissingTokenError();\r\n    }\r\n    const { data } = await axios.post(`/Get_Exposed_Guest_Bookings?Ticket=${token}`, {\r\n      property_id,\r\n    });\r\n    if (data['ExceptionMsg'] !== '') {\r\n      throw new Error(data['ExceptionMsg']);\r\n    }\r\n    return data['My_Result'];\r\n  }\r\n}\r\n","@import url('../../gloabls.css');\r\n:host {\r\n  display: block;\r\n}\r\n","import { Booking } from '@/models/booking.dto';\r\nimport { BookingListingService } from '@/services/api/booking_listing.service';\r\nimport { CommonService } from '@/services/api/common.service';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport app_store from '@/stores/app.store';\r\nimport { formatAmount } from '@/utils/utils';\r\nimport { Component, Host, Prop, State, h } from '@stencil/core';\r\nimport axios from 'axios';\r\nimport { differenceInCalendarDays, format } from 'date-fns';\r\n\r\n@Component({\r\n  tag: 'ir-booking-listing',\r\n  styleUrl: 'ir-booking-listing.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingListing {\r\n  @Prop() propertyid: number;\r\n  @Prop() baseUrl: string;\r\n  @Prop() headerShown: boolean = true;\r\n  @Prop() footerShown: boolean = true;\r\n\r\n  @State() isLoading = false;\r\n  @State() token: string =\r\n    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MTY0NzAzMjYsIkNMQUlNLTAxIjoiZE1TL0hDV21NdW89IiwiQ0xBSU0tMDIiOiI5UStMQm93VTl6az0iLCJDTEFJTS0wMyI6Ilp3Tys5azJoTzUwPSIsIkNMQUlNLTA0IjoiQUVxVnRCMm1kWTg9IiwiQ0xBSU0tMDUiOiJFQTEzejA3ejBUcWRkM2gwNElyYThITHBnTWQvOWV5aSJ9.9hKPGjcvmTuRMAOE8BmXUY1NT3DDqSYDKgEokUV2N6U';\r\n  @State() bookings: Booking[] = [];\r\n\r\n  private bookingListingService = new BookingListingService();\r\n  private commonService = new CommonService();\r\n  private propertyService = new PropertyService();\r\n\r\n  async componentWillLoad() {\r\n    axios.defaults.baseURL = this.baseUrl;\r\n    if (!this.propertyid) {\r\n      throw new Error('missing property id');\r\n    }\r\n    if (this.token) {\r\n      this.initializeServices();\r\n      this.initializeApp();\r\n    } else {\r\n      const token = await this.commonService.getBEToken();\r\n      if (token) {\r\n        app_store.app_data.token = token;\r\n      }\r\n    }\r\n  }\r\n  initializeServices() {\r\n    this.bookingListingService.setToken(this.token);\r\n    this.propertyService.setToken(this.token);\r\n  }\r\n  async initializeApp() {\r\n    try {\r\n      this.isLoading = true;\r\n      const [bookings] = await Promise.all([\r\n        this.bookingListingService.getExposedGuestToken(this.propertyid),\r\n        this.propertyService.getExposedProperty({ id: this.propertyid, language: app_store.userPreferences?.language_id || 'en' }),\r\n      ]);\r\n      this.bookings = bookings;\r\n      console.log(this.bookings);\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n  handleAuthFinish(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const { token, state } = e.detail;\r\n    console.log(token, state);\r\n    if (state === 'success') {\r\n      this.token = token;\r\n      this.initializeServices();\r\n      this.initializeApp();\r\n    }\r\n  }\r\n  getBadgeVariant(code: string) {\r\n    if (code === '001') {\r\n      return 'pending';\r\n    } else if (code === '002') {\r\n      return 'success';\r\n    }\r\n    return 'error';\r\n  }\r\n  render() {\r\n    if (!this.token) {\r\n      return (\r\n        <Host>\r\n          <main class=\"flex h-screen flex-col  justify-center\">\r\n            <div class=\"mx-auto w-full max-w-md px-4\">\r\n              {/* <ir-signin></ir-signin> */}\r\n              <ir-auth enableSignUp={false} onAuthFinish={this.handleAuthFinish.bind(this)}></ir-auth>\r\n            </div>\r\n          </main>\r\n        </Host>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <Host>\r\n        {this.headerShown && <ir-nav isBookingListing website={app_store.property?.space_theme.website} logo={app_store.property?.space_theme?.logo}></ir-nav>}\r\n        <main class={' p-4'}>\r\n          <div class=\"table-container mx-auto max-w-6xl overflow-x-hidden shadow-md\">\r\n            <div class=\"flex flex-col gap-2.5 px-[20px] py-[16px] md:flex-row md:items-center md:justify-between \">\r\n              <h3>Bookings</h3>\r\n              {/* <input type=\"text\" placeholder=\"Search...\" class=\"w-full max-w-sm rounded-md border border-solid border-gray-300 px-4 py-1.5 \" /> */}\r\n            </div>\r\n            <div class=\"max-w-full overflow-x-auto \">\r\n              <table class=\"table\">\r\n                <thead>\r\n                  <tr class=\"table-header\">\r\n                    <th class=\"table-head\">Status</th>\r\n                    <th class=\"table-head\">Booking reference</th>\r\n                    <th class=\"table-head\">Booking date</th>\r\n                    <th class=\"table-head\">Check-in</th>\r\n                    <th class=\"table-head\">Duration</th>\r\n                    <th class=\"table-head\">Total price</th>\r\n                    <th class=\"table-head sr-only\">pay now</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {this.bookings?.map(booking => {\r\n                    const totalNights = differenceInCalendarDays(new Date(booking.to_date), new Date(booking.from_date));\r\n                    return (\r\n                      <tr class=\"table-row\" key={booking.booking_nbr}>\r\n                        <td class=\"table-cell\">{<ir-badge label={booking.status.description} variant={this.getBadgeVariant(booking.status.code)}></ir-badge>}</td>\r\n                        <td class=\"table-cell\">{booking.booking_nbr}</td>\r\n                        <td class=\"table-cell\">{format(new Date(booking.booked_on.date), 'dd-MMM-yyyy')}</td>\r\n                        <td class=\"table-cell\">{format(new Date(booking.from_date), 'EEE, dd MMM yyyy')}</td>\r\n                        <td class=\"table-cell\">\r\n                          {totalNights} {totalNights > 1 ? 'nights' : 'night'}\r\n                        </td>\r\n                        <td class=\"table-cell\">{formatAmount(booking.total, booking.currency.code)}</td>\r\n                        <td class=\"table-cell\"></td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n            {/* <div class=\"flex items-center justify-between px-[20px] py-[16px] \">\r\n              <ir-button variants=\"outline\" label=\"Previous\" haveLeftIcon>\r\n                <ir-icons name=\"arrow_left\" slot=\"left-icon\" svgClassName=\"size-3\"></ir-icons>\r\n              </ir-button>\r\n              <ir-button variants=\"outline\" label=\"Next\" haveRightIcon>\r\n                <ir-icons name=\"arrow_right\" slot=\"right-icon\" svgClassName=\"size-3\"></ir-icons>\r\n              </ir-button>\r\n            </div> */}\r\n          </div>\r\n        </main>\r\n        {this.footerShown && <ir-footer></ir-footer>}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}