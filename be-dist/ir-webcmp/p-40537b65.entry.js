import{r as e,c as t,h as i,H as s,F as n}from"./p-ee49d535.js";import{h as o,B as a}from"./p-2b2c397a.js";import{l}from"./p-806fad31.js";import{T as d}from"./p-5955518a.js";import{d as r,p as c,q as h,s as g}from"./p-4dc453f7.js";import{h as f}from"./p-6c4ba7c0.js";import{h as b,g as p}from"./p-8f37a731.js";import{c as u}from"./p-cb14c0da.js";import"./p-06203439.js";import"./p-4eb12235.js";import"./p-d3003ac0.js";const m=".sc-igl-cal-body-h{display:block}.bodyContainer.sc-igl-cal-body{position:relative}.roomRow.sc-igl-cal-body{width:max-content}.roomRow.sc-igl-cal-body:first-child{margin-top:80px}.categoryName.sc-igl-cal-body{font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.cellData.sc-igl-cal-body{width:58px;height:30px;display:inline-grid;border-top:1px solid #e0e0e0;border-left:1px solid #e0e0e0;vertical-align:top}.cellData.sc-igl-cal-body:nth-child(2){border-left:0px}.cellData.sc-igl-cal-body:last-child{border-right:1px solid #e0e0e0}.roomHeaderCell.sc-igl-cal-body{position:-webkit-sticky;position:sticky;left:0;background:#fff;border-right:1px solid #ccc;width:170px;z-index:1}.currentDay.sc-igl-cal-body{background-color:#e3f3fa}.dragOverHighlight.sc-igl-cal-body{background-color:#f5f5dc !important}.selectedDay.sc-igl-cal-body{background-color:#f9f9c9 !important}.categoryTitle.sc-igl-cal-body{grid-template-columns:1fr 20px;padding-left:10px;cursor:pointer;height:40px;font-size:0.9em}.categoryTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.sc-igl-cal-body{padding-left:20px;font-size:0.9em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.roomTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.pl10.sc-igl-cal-body{padding-left:10px}.categoryPriceColumn.sc-igl-cal-body{align-items:center;height:40px;-webkit-user-select:none;user-select:none}.bookingEventsContainer.sc-igl-cal-body{position:absolute;top:0;left:0}";const y=m;const w=class{constructor(i){e(this,i);this.showBookingPopup=t(this,"showBookingPopup",7);this.scrollPageToRoom=t(this,"scrollPageToRoom",7);this.addBookingDatasEvent=t(this,"addBookingDatasEvent",7);this.selectedRooms={};this.fromRoomId=-1;this.currentDate=new Date;this.isScrollViewDragging=undefined;this.calendarData=undefined;this.today=undefined;this.currency=undefined;this.language=undefined;this.countryNodeList=undefined;this.dragOverElement="";this.renderAgain=false;this.highlightedDate=undefined}componentWillLoad(){this.currentDate.setHours(0,0,0,0)}dragOverHighlightElementHandler(e){this.dragOverElement=e.detail.dragOverElement}gotoRoom(e){let t=e.detail.roomId;let i=this.getRoomCategoryByRoomId(t);if(!i.expanded){this.toggleCategory(i);setTimeout((()=>{this.scrollToRoom(t)}),10)}else{this.scrollToRoom(t)}}addToBeAssignedEvents(e){this.addBookingDatas(e.detail.data);this.renderElement()}scrollToRoom(e){this.scrollPageToRoom.emit({key:"scrollPageToRoom",id:e,refClass:"room_"+e})}getRoomCategoryByRoomId(e){return this.calendarData.roomsInfo.find((t=>this.getCategoryRooms(t).find((t=>this.getRoomId(t)===e))))}getCategoryName(e){return e.name}getCategoryId(e){return e.id}getTotalPhysicalRooms(e){return this.getCategoryRooms(e).length}getCategoryRooms(e){return e&&e.physicalrooms||[]}getRoomName(e){return e.name}getRoomId(e){return e.id}getRoomById(e,t){return e.find((e=>this.getRoomId(e)===t))}getBookingData(){return this.calendarData.bookingEvents}addBookingDatas(e){this.addBookingDatasEvent.emit(e)}getSelectedCellRefName(e,t){return"room_"+e+"_"+t.currentDate}getSplitBookingEvents(e){console.log(e.FROM_DATE);return this.getBookingData().some((t=>{if(!["003","002","004"].includes(t.STATUS_CODE)){if(new Date(e.FROM_DATE).getTime()>=new Date(t.FROM_DATE).getTime()&&new Date(e.FROM_DATE).getTime()<=new Date(t.TO_DATE).getTime()){return t}}}))}closeWindow(){let e=this.getBookingData().findIndex((e=>e.ID==="NEW_TEMP_EVENT"));if(e!==-1){this.getBookingData().splice(e,1);console.log("removed item..");this.renderElement()}}addNewEvent(e){let t=Object.keys(this.selectedRooms);let s,n;if(this.selectedRooms[t[0]].currentDate<this.selectedRooms[t[1]].currentDate){s=new Date(this.selectedRooms[t[0]].currentDate);n=new Date(this.selectedRooms[t[1]].currentDate)}else{s=new Date(this.selectedRooms[t[1]].currentDate);n=new Date(this.selectedRooms[t[0]].currentDate)}this.newEvent={ID:"NEW_TEMP_EVENT",NAME:i("span",null,"Â "),EMAIL:"",PHONE:"",convertBooking:false,REFERENCE_TYPE:"PHONE",FROM_DATE:s.getFullYear()+"-"+this.getTwoDigitNumStr(s.getMonth()+1)+"-"+this.getTwoDigitNumStr(s.getDate()),TO_DATE:n.getFullYear()+"-"+this.getTwoDigitNumStr(n.getMonth()+1)+"-"+this.getTwoDigitNumStr(n.getDate()),BALANCE:"",NOTES:"",RELEASE_AFTER_HOURS:0,PR_ID:this.selectedRooms[t[0]].roomId,ENTRY_DATE:"",NO_OF_DAYS:(n-s)/864e5,ADULTS_COUNT:1,COUNTRY:"",INTERNAL_NOTE:"",RATE:"",TOTAL_PRICE:"",RATE_PLAN:"",ARRIVAL_TIME:"",TITLE:l.entries.Lcz_NewBookingFor,roomsInfo:[e],CATEGORY:e.name,event_type:"BAR_BOOKING",STATUS:"TEMP-EVENT",defaultDateRange:{fromDate:null,fromDateStr:"",toDate:null,toDateStr:"",dateDifference:(n-s)/864e5,editable:false,message:"Including 5.00% City Tax - Excluding 11.00% VAT"}};let o=e.name+" "+this.getRoomName(this.getRoomById(this.getCategoryRooms(e),this.selectedRooms[t[0]].roomId));this.newEvent.BLOCK_DATES_TITLE=`${l.entries.Lcz_BlockDatesFor} ${o}`;this.newEvent.TITLE+=o;this.newEvent.defaultDateRange.toDate=new Date(this.newEvent.TO_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDate=new Date(this.newEvent.FROM_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDateStr=this.getDateStr(this.newEvent.defaultDateRange.fromDate);this.newEvent.defaultDateRange.toDateStr=this.getDateStr(this.newEvent.defaultDateRange.toDate);this.newEvent.ENTRY_DATE=(new Date).toISOString();this.newEvent.legendData=this.calendarData.formattedLegendData;let a=this.getSplitBookingEvents(this.newEvent);if(a){this.newEvent.splitBookingEvents=a}this.getBookingData().push(this.newEvent);return this.newEvent}getTwoDigitNumStr(e){return e<=9?"0"+e:e}getDateStr(e,t="default"){return e.getDate()+" "+e.toLocaleString(t,{month:"short"})+" "+e.getFullYear()}removeNewEvent(){this.calendarData.bookingEvents=this.calendarData.bookingEvents.filter((e=>e.ID!=="NEW_TEMP_EVENT"));this.newEvent=null}clickCell(e,t,i){if(!this.isScrollViewDragging&&t.currentDate>=this.currentDate.getTime()){let s=this.getSelectedCellRefName(e,t);if(this.selectedRooms.hasOwnProperty(s)){this.removeNewEvent();delete this.selectedRooms[s];this.renderElement();return}else if(Object.keys(this.selectedRooms).length!=1||this.fromRoomId!=e){this.removeNewEvent();this.selectedRooms={};this.selectedRooms[s]=Object.assign(Object.assign({},t),{roomId:e});this.fromRoomId=e;this.renderElement()}else{this.selectedRooms[s]=Object.assign(Object.assign({},t),{roomId:e});this.addNewEvent(i);this.selectedRooms={};this.renderElement();this.showNewBookingPopup(this.newEvent)}}}showNewBookingPopup(e){console.log(e)}renderElement(){this.renderAgain=!this.renderAgain}getGeneralCategoryDayColumns(e,t=false,s){return o.days.map((n=>i("div",{class:`cellData  font-weight-bold categoryPriceColumn ${e+"_"+n.day} ${n.day===this.today||n.day===this.highlightedDate?"currentDay":""}`},t?i("span",{class:"categoryName"},n.rate[s].exposed_inventory.rts):"")))}getGeneralRoomDayColumns(e,t){return this.calendarData.days.map((s=>i("div",{class:`cellData ${"room_"+e+"_"+s.day} ${s.day===this.today||s.day===this.highlightedDate?"currentDay":""} ${this.dragOverElement===e+"_"+s.day?"dragOverHighlight":""} ${this.selectedRooms.hasOwnProperty(this.getSelectedCellRefName(e,s))?"selectedDay":""}`,onClick:()=>this.clickCell(e,s,t)})))}toggleCategory(e){e.expanded=!e.expanded;this.renderElement()}getRoomCategoryRow(e,t){if(this.getTotalPhysicalRooms(e)<=1||!e.is_active){return null}return i("div",{class:"roomRow"},i("div",{class:`cellData text-left align-items-center roomHeaderCell categoryTitle ${"category_"+this.getCategoryId(e)}`,onClick:()=>this.toggleCategory(e)},i("div",{class:"categoryName"},i("ir-popover",{popoverTitle:this.getCategoryName(e)})),e.expanded?i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"})):i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"}))),this.getGeneralCategoryDayColumns("category_"+this.getCategoryId(e),true,t))}getRoomsByCategory(e){var t;if(!e.expanded){return[]}return(t=this.getCategoryRooms(e))===null||t===void 0?void 0:t.map((t=>{if(!t.is_active){return null}return i("div",{class:"roomRow"},i("div",{class:`cellData text-left align-items-center roomHeaderCell  roomTitle ${this.getTotalPhysicalRooms(e)<=1?"pl10":""} ${"room_"+this.getRoomId(t)}`,"data-room":this.getRoomId(t)},i("ir-popover",{popoverTitle:this.getTotalPhysicalRooms(e)<=1?this.getCategoryName(e):this.getRoomName(t)})),this.getGeneralRoomDayColumns(this.getRoomId(t),e))}))}getRoomRows(){var e;return(e=this.calendarData.roomsInfo)===null||e===void 0?void 0:e.map(((e,t)=>{if(e.is_active){return[this.getRoomCategoryRow(e,t),this.getRoomsByCategory(e)]}else{return null}}))}render(){var e;return i(s,{key:"e16b417f5f3a9dc9f6151b49f8f7d1eba62a5c39"},i("div",{key:"c2b251b6ec01b8c1ab6601f9c1bd9277cf161d36",class:"bodyContainer"},this.getRoomRows(),i("div",{key:"40e1b32cef7a9975d3d3645be74cd83ef3195c06",class:"bookingEventsContainer preventPageScroll"},(e=this.getBookingData())===null||e===void 0?void 0:e.map((e=>i("igl-booking-event",{language:this.language,is_vacation_rental:this.calendarData.is_vacation_rental,countryNodeList:this.countryNodeList,currency:this.currency,"data-component-id":e.ID,bookingEvent:e,allBookingEvents:this.getBookingData()}))))))}};w.style=y;const k=".sc-igl-cal-footer-h{display:block;position:sticky;bottom:0;width:max-content;z-index:3}.footerCell.sc-igl-cal-footer{display:-moz-inline-grid;display:-ms-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;bottom:0;width:58px;height:40px;background:#fff;vertical-align:top;border-top:1px solid #e0e0e0}.bottomLeftCell.sc-igl-cal-footer{left:-1px;z-index:2;width:170px;text-align:left;padding-left:15px;color:#000000}.footerCell.sc-igl-cal-footer i.sc-igl-cal-footer{margin-right:5px}.legendBtn.sc-igl-cal-footer{color:#41bff3;cursor:pointer}.isOnline.sc-igl-cal-footer i.sc-igl-cal-footer{color:#2f9c3f;font-weight:bold}.isOffline.sc-igl-cal-footer i.sc-igl-cal-footer{font-weight:bold}.isOffline.sc-igl-cal-footer{color:#a40000}.dayTitle.sc-igl-cal-footer{font-size:0.8em;font-weight:600;display:grid;user-select:none}.currentDay.sc-igl-cal-footer .dayTitle.sc-igl-cal-footer{font-weight:bold}.currentDay.sc-igl-cal-footer{background-color:#e3f3fa}.dayCapacityPercent.sc-igl-cal-footer{font-size:0.75em}.badge-pill.sc-igl-cal-footer{padding-left:1em;padding-right:1em;font-size:0.7em;margin-bottom:2px}";const v=k;const x=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.calendarData=undefined;this.today=undefined;this.highlightedDate=undefined}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}render(){return i(s,{key:"03e81d5d07e3a4ece7db2b84e7a3af069ab825c2",class:"footerContainer"},i("div",{key:"150433f62c921d919d25ab3e8513a96a33a2884d",class:"footerCell bottomLeftCell align-items-center preventPageScroll"},i("div",{key:"1338754dfdefad6c1a957a6a0288362617983ddd",class:"legendBtn",onClick:()=>this.handleOptionEvent("showLegend")},i("i",{key:"0d4330a73f85983b96ac2a22f4b6aac037565ffc",class:"la la-square"}),i("u",{key:"0eeda67e2909d841bea61ebff50f3725d06cfe0e"},l.entries.Lcz_Legend),i("span",{key:"25e4ae6dff069cf859c85d56e5c9d8a7c7c42030"}," - v99.12"))),this.calendarData.days.map((e=>i("div",{class:"footerCell align-items-center"},i("div",{class:`dayTitle full-height align-items-center ${e.day===this.today||this.highlightedDate===e.day?"currentDay":""}`},e.dayDisplayName)))))}};x.style=v;const D=".sc-igl-cal-header-h{display:block;position:absolute;top:0;height:100%}.svg-icon.sc-igl-cal-header{height:20px;width:20px}.darkGrey.sc-igl-cal-header{background:#ececec}.btn.sc-igl-cal-header{pointer-events:auto}.stickyCell.sc-igl-cal-header{display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;top:0px;height:82px;display:inline-block;vertical-align:top;z-index:2}.headersContainer.sc-igl-cal-header{background-color:#ffffff}.headerCell.sc-igl-cal-header{display:inline-grid;width:58px;height:58px;vertical-align:top;background-color:#ffffff;border-bottom:1px solid #e0e0e0}.monthsContainer.sc-igl-cal-header{height:20px;background-color:#ffffff;margin-bottom:0.2em}.monthCell.sc-igl-cal-header{display:inline-grid;height:20px;background-color:#ececec;border-right:1px solid #c7c7c7;vertical-align:top}.monthCell.sc-igl-cal-header:nth-child(odd){background-color:#dddddd}.monthTitle.sc-igl-cal-header{overflow:hidden;text-overflow:ellipsis;font-size:0.9em;text-transform:uppercase;font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.topLeftCell.sc-igl-cal-header{left:0px;z-index:3;width:170px;background-color:#ffffff;display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid}.datePickerHidden.sc-igl-cal-header{position:absolute;height:100%;width:100%;opacity:0;cursor:pointer;z-index:1}.date_btn.sc-igl-cal-header{cursor:pointer;display:flex;align-items:center;justify-content:center;position:relative}.date_btn.sc-igl-cal-header:hover{background:#f6f6f6;border-radius:0.3rem}.caledarBtns.sc-igl-cal-header{position:relative;cursor:pointer;padding:0.4rem}.caledarBtns.sc-igl-cal-header:hover{background-color:#f6f6f6}.dayTitle.sc-igl-cal-header{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.currentDay.sc-igl-cal-header .dayTitle.sc-igl-cal-header{font-weight:bold}.currentDay.sc-igl-cal-header{background-color:#e3f3fa}.dayCapacityPercent.sc-igl-cal-header{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.badge-pill.sc-igl-cal-header{padding:3px 1em;font-size:0.8em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.pointer.sc-igl-cal-header{cursor:pointer}.searchContiner.sc-igl-cal-header{padding-left:10px;padding-right:10px}.searchListContainer.sc-igl-cal-header{background:#fff;border:1px solid #ccc;border-bottom:none}.searchListItem.sc-igl-cal-header{background:white;border-bottom:1px solid #ccc;padding-left:8px}.badge-light.sc-igl-cal-header{background-color:#999999;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.min-width-full.sc-igl-cal-header{min-width:100%}";const C=D;const _=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.gotoRoomEvent=t(this,"gotoRoomEvent",7);this.gotoToBeAssignedDate=t(this,"gotoToBeAssignedDate",7);this.searchValue="";this.searchList=[];this.roomsList=[];this.toBeAssignedService=new d;this.calendarData=undefined;this.today=undefined;this.propertyid=undefined;this.unassignedDates=undefined;this.to_date=undefined;this.highlightedDate=undefined;this.renderAgain=false;this.unassignedRoomsNumber={}}componentWillLoad(){try{this.initializeRoomsList();if(!this.calendarData.is_vacation_rental){b("unassigned_dates",(e=>{if(Object.keys(e).length>0){this.fetchAndAssignUnassignedRooms()}}))}}catch(e){console.error("Error in componentWillLoad:",e)}}handleCalendarDataChanged(){this.fetchAndAssignUnassignedRooms()}initializeRoomsList(){this.roomsList=[];this.calendarData.roomsInfo.forEach((e=>{this.roomsList=this.roomsList.concat(...e.physicalrooms)}))}async fetchAndAssignUnassignedRooms(){await this.assignRoomsToDate()}async assignRoomsToDate(){try{const{fromDate:e,toDate:t,data:i}=this.unassignedDates;let s=new Date(e);s.setHours(0,0,0,0);let n=s.getTime();while(n<=new Date(t).getTime()){const e=f(n).format("D_M_YYYY");if(i[n]){const t=await this.toBeAssignedService.getUnassignedRooms({from_date:this.calendarData.from_date,to_date:this.calendarData.to_date},this.propertyid,r(new Date(n)),this.calendarData.roomsInfo,this.calendarData.formattedLegendData);this.unassignedRoomsNumber[e]=t.length}else if(this.unassignedRoomsNumber[e]){const t=this.unassignedRoomsNumber[e]-1;this.unassignedRoomsNumber[e]=t<0?0:t}const t=f(n).add(1,"days").toDate();t.setHours(0,0,0,0);n=t.getTime();this.renderView()}}catch(e){console.error(e)}}handleReduceAvailableUnitEvent(e){e.stopImmediatePropagation();e.stopPropagation();const{fromDate:t,toDate:i}=e.detail;let s=new Date(t).getTime();while(s<new Date(i).getTime()){const e=f(s).format("D_M_YYYY");this.unassignedRoomsNumber[e]=this.unassignedRoomsNumber[e]-1;s=f(s).add(1,"days").toDate().getTime()}this.renderView()}showToBeAssigned(e){if(this.unassignedRoomsNumber[e.day]||0){this.handleOptionEvent("showAssigned");setTimeout((()=>{this.gotoToBeAssignedDate.emit({key:"gotoToBeAssignedDate",data:e.currentDate})}),100)}}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}handleDateSelect(e){if(Object.keys(e.detail).length>0){this.handleOptionEvent("calendar",e.detail)}}handleClearSearch(){this.searchValue="";this.searchList=[];this.renderView()}handleFilterRooms(e){const t=e.target;let i=t.value.trim();this.searchValue=i;i=i.toLowerCase();if(i===""){this.handleClearSearch()}else{this.searchList=this.roomsList.filter((e=>e.name.toLocaleLowerCase().indexOf(i)!=-1))}this.renderView()}handleScrollToRoom(e){this.handleClearSearch();this.gotoRoomEvent.emit({key:"gotoRoom",roomId:e})}getStringDateFormat(e){return e.getFullYear()+"-"+(e.getMonth()<9?"0":"")+(e.getMonth()+1)+"-"+(e.getDate()<=9?"0":"")+e.getDate()}getNewBookingModel(){let e=new Date;e.setHours(0,0,0,0);let t=this.getStringDateFormat(e);e.setDate(e.getDate()+1);e.setHours(0,0,0,0);let i=this.getStringDateFormat(e);return{ID:"",NAME:"",EMAIL:"",PHONE:"",REFERENCE_TYPE:"PHONE",FROM_DATE:t,TO_DATE:i,roomsInfo:this.calendarData.roomsInfo,TITLE:l.entries.Lcz_NewBooking,event_type:"PLUS_BOOKING",legendData:this.calendarData.formattedLegendData,defaultDateRange:{fromDate:new Date(t),fromDateStr:"",toDate:new Date(i),toDateStr:"",dateDifference:0,editabled:true,message:""}}}renderView(){this.renderAgain=!this.renderAgain}render(){return i(s,{key:"cd0fcb1b2a851561d720597fbae50c176f254bff"},i("div",{key:"90d97b8d257fede2f25787baa1c1e747738f1373",class:"stickyCell align-items-center topLeftCell preventPageScroll"},i("div",{key:"c648f75067d1d8dc62ee02dfaf9a54a59c1c357a",class:"row justify-content-around no-gutters"},!this.calendarData.is_vacation_rental&&i("ir-button",{key:"a6de4481ddde1118e495bf64109d0a157bbd3354",variant:"icon",icon_name:"server",style:Object.assign(Object.assign({},u.secondary),{"--icon-size":"1.5rem"}),"data-toggle":"tooltip","data-placement":"bottom",title:l.entries.Lcz_UnassignedUnitsTooltip,onClickHandler:()=>this.handleOptionEvent("showAssigned"),btn_styles:"caledarBtns",visibleBackgroundOnHover:true}),i("ir-button",{key:"e953dca93e86955e3001d847fa726382d3e6758e",btn_styles:"caledarBtns",class:"date_btn",variant:"icon",icon_name:"calendar",style:Object.assign(Object.assign({},u.secondary),{"--icon-size":"1.5rem"}),"data-toggle":"tooltip","data-placement":"bottom",title:l.entries.Lcz_Navigate,onClickHandler:()=>this.handleOptionEvent("calendar"),visibleBackgroundOnHover:true},i("ir-date-picker",{key:"4460928d6c8b60bd29430bb9ff4c69062abe6f59",minDate:f().add(-2,"months").startOf("month").format("YYYY-MM-DD"),autoApply:true,singleDatePicker:true,onDateChanged:e=>{console.log("evt",e);this.handleDateSelect(e)},class:"datePickerHidden"})),i("ir-button",{key:"e0bf2374328b3f733ad02fbe73dec91d12ef36b5",variant:"icon",btn_styles:"caledarBtns",class:"pointer",icon_name:"clock",visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},u.secondary),{"--icon-size":"1.5rem"}),"data-toggle":"tooltip","data-placement":"bottom",title:l.entries.Lcz_Today,onClickHandler:()=>this.handleOptionEvent("gotoToday")}),i("ir-button",{key:"eea488e99bf3c3b110d8383f99a1ca134ad594f1",variant:"icon",btn_styles:"caledarBtns",icon_name:"plus","data-toggle":"tooltip","data-placement":"bottom",title:l.entries.Lcz_CreateNewBooking,visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},u.secondary),{"--icon-size":"1.5rem"}),onClickHandler:()=>this.handleOptionEvent("add",this.getNewBookingModel())})),i("div",{key:"74ab2eeaee95bd0536ce5aeba5991d07e5c5ea6a",class:"row justify-content-around no-gutters searchContiner"},i("fieldset",{key:"590b805e731cc237edf51c70e33cf8ca12f9eb93",class:`form-group position-relative ${this.searchValue!=""?"show":""}`},i("input",{key:"0bdb1f9dd8002d006d39fbcdb87a2cd3d6bfd574",type:"text",class:"form-control form-control-sm input-sm",id:"iconLeft7",value:this.searchValue,placeholder:l.entries.Lcz_FindUnit,onInput:e=>this.handleFilterRooms(e)}),this.searchValue!==""?i("div",{class:"form-control-position pointer",onClick:()=>this.handleClearSearch(),"data-toggle":"tooltip","data-placement":"top","data-original-title":"Clear Selection"},i("i",{class:"la la-close font-small-4"})):null,this.searchList.length?i("div",{class:"position-absolute searchListContainer dropdown-menu dropdown-menu-left min-width-full"},this.searchList.map((e=>i("div",{class:"searchListItem1 dropdown-item px-1 text-left pointer",onClick:()=>this.handleScrollToRoom(e.id)},e.name)))):null))),i("div",{key:"49b22443f80e1f8ee99794fe2aa0c9fc9148c8bd",class:"stickyCell headersContainer"},i("div",{key:"f3366306cf061f49ad3ac0b45fc20469ac69803d",class:"monthsContainer"},this.calendarData.monthsInfo.map((e=>i("div",{class:"monthCell",style:{width:e.daysCount*58+"px"}},i("div",{class:"monthTitle"},e.monthName))))),this.calendarData.days.map((e=>i("div",{class:`headerCell align-items-center ${"day-"+e.day} ${e.day===this.today||e.day===this.highlightedDate?"currentDay":""}`,"data-day":e.day},!this.calendarData.is_vacation_rental&&i("div",{class:"preventPageScroll"},i("span",{class:`badge badge-${this.unassignedRoomsNumber[e.day]||e.unassigned_units_nbr!==0?"info pointer":"light"} badge-pill`,onClick:()=>this.showToBeAssigned(e)},this.unassignedRoomsNumber[e.day]||e.unassigned_units_nbr)),i("div",{class:"dayTitle"},e.dayDisplayName),i("div",{class:"dayCapacityPercent"},e.occupancy,"%"))))))}static get watchers(){return{unassignedDates:["handleCalendarDataChanged"]}}};_.style=C;const E=".sc-igl-legends-h{display:block}.legendHeader.sc-igl-legends{font-weight:500;letter-spacing:0.05rem;font-size:1.12rem;padding-top:5px;margin-bottom:1rem}.legendCloseBtn.sc-igl-legends{position:absolute;top:50%;right:0;cursor:pointer;font-size:1.75em;line-height:1em;padding:0.4rem;display:flex;align-items:center;justify-content:center;border-radius:3px;transform:translateY(-50%)}.legendCloseBtn.sc-igl-legends:hover{background-color:#f6f6f6}.stickyHeader.sc-igl-legends{position:-webkit-sticky;position:sticky;top:0;background-color:#ffffff;z-index:1}.legendRow.sc-igl-legends{position:relative;vertical-align:middle;margin-bottom:0.3rem}.legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle}.legend_skew.sc-igl-legends,.legend_skew-bordered.sc-igl-legends,.legend_skewsplit.sc-igl-legends{transform:skew(-30deg);width:15px;height:16px}.legend_skew-bordered.sc-igl-legends{border:1px solid black}.legend_circle.sc-igl-legends{border-radius:100%;width:10px;height:10px;margin:3px 3px 3px 2px}.legend_skewsplit.sc-igl-legends{border-right:2px solid #000000}.headerCell.sc-igl-legends .blueColor.sc-igl-legends{background-color:#31bef1}.greenColor.sc-igl-legends{background-color:#45b16d}.yellowColor.sc-igl-legends{background-color:#f4d552}.greyColor.sc-igl-legends{background-color:#a0a0a0}.redColor.sc-igl-legends{background-color:#f34752}.pinkColor.sc-igl-legends{background-color:#f9b4b7}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends{margin-bottom:0}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends:first-child .legendCal.sc-igl-legends{background-color:#ececec}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.total-availability.sc-igl-legends{font-size:1em !important}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends{width:80px;height:25px;text-align:center;display:inline-grid !important;align-content:center;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends .badge.sc-igl-legends{margin-top:0.2rem;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.legendCal-h2.sc-igl-legends{height:40px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.br-t.sc-igl-legends{border-top:1px solid #a0a0a0}.br-s.sc-igl-legends{border-left:1px solid #a0a0a0;border-right:1px solid #a0a0a0}.br-bt.sc-igl-legends{border-bottom:1px solid #a0a0a0}.highphenLegend.sc-igl-legends{font-size:0.9em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.highphenLegend.sc-igl-legends::before{width:12px;height:0.5px;content:' ';background-color:#000000;vertical-align:middle;display:inline-block;margin-left:5px;margin-right:5px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.badge-pill.sc-igl-legends{padding:3px 1em;font-size:0.8em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.headerCell.sc-igl-legends{width:70px;display:flex;align-items:center;justify-content:center}.dayTitle.sc-igl-legends{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.dayCapacityPercent.sc-igl-legends{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}";const T=E;const R=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.legendData=undefined}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}render(){return i(s,{key:"2a1e0684822dea49c217256216dbcf9b2264f80a",class:"legendContainer pr-1 text-left"},i("div",{key:"1b617815b48f37a82a8455ad06754972d1ea9e19",class:"w-full"},i("div",{key:"e21640dc9f4afb1fbe3e26472ec7697f7283fd99",class:"w-full"},i("div",{key:"e3d993440aa39a29102a38af52f6e1c3c9d72ccf",class:"stickyHeader pt-1 "},i("p",{key:"26e18c0fd8d824dd1854738d89d8c59d87676759",class:"legendHeader"},l.entries.Lcz_Legend),i("div",{key:"e08530b5dcaae898e2d448050171511b9b332e38",class:"legendCloseBtn",onClick:()=>this.handleOptionEvent("closeSideMenu")},i("svg",{key:"2aee677a9d52412eb5cc311c357fc6855c3a11b8",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},i("path",{key:"15c18c52207cfade4803903d49975008d6f53f94",fill:"#6b6f82",d:"M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160zm352-160l-160 160c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L301.3 256 438.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0z"}))),i("hr",{key:"7db05b17853026cdc90ed5b6c2b19a548ac962f1"})),i("div",{key:"37df609766f8f429598b3618d861e8f0086950a3",class:"mt-2 pl-1"},this.legendData.map((e=>i("div",{class:"legendRow "},i("div",{class:`legend_${e.design} mr-1`,style:{backgroundColor:e.color}}),i("span",{class:"font-small-3"},e.name))))),i("hr",{key:"7a42bde89052b35e422638eefbd989861b8b766d"}),i("div",{key:"f3142fd212aaed7548aa5ff24d0c8da078943c1b",class:"mt-2"},i("div",{key:"26fe39e1d6a727d0dccbf0303f2885575303c5bc",class:"legendCalendar"},i("div",{key:"9e81091a3d23562d9408fae92b5c69fdbb26b666",class:"legendRow align-items-center"},i("div",{key:"6ddf55a6ca0dc6288c32e3323856b5986cee0efe",class:"legendCal br-t br-s br-bt"},i("strong",{key:"181ab9b3d6f1843dbe08c2f5dac654fea3f1a815"},"MAR 2022")),i("div",{key:"8507b981e0376b67fea8c0bc4a7c497e5368caa2",class:"highphenLegend"},l.entries.Lcz_MonthAndYear)),i("div",{key:"68247d49a25f5659b0ab6e9f813d495b887454d4",class:"legendRow"},i("div",{key:"7d50f83cf0ca1eeb391c4f810d944fa3c3347962",class:"legendCal headerCell align-items-center br-s"},i("span",{key:"fb076e68070a55896964f3c1d4713608def55067",class:"badge badge-info  badge-pill"},"3")),i("div",{key:"c46b38bcd74286c4537786abaa1bd5ee0b9c7c77",class:"highphenLegend"},i("div",{key:"bcb5954c631abb933e287d35d1702a54315f2167"},l.entries.Lcz_UnassignedUnits))),i("div",{key:"094445cfbdad3522325d2ccb72ce9215902e9dc4",class:"legendRow"},i("div",{key:"cca3a2befe313fff6ec55a7c59ac9453b5bfcd32",class:"legendCal dayTitle br-s"},"Fri 18"),i("div",{key:"e9a4945300db845da359a48e0f897f9ea0ec248d",class:"highphenLegend"},l.entries.Lcz_Date)),i("div",{key:"bfaad014333503fe33c98743f4af09116e949c1f",class:"legendRow"},i("div",{key:"9cb1d50eb87120970a7db14df75170b1b28601a0",class:"legendCal br-s br-bt dayCapacityPercent"},"15%"),i("div",{key:"8779180cf3a610afdf9b06bea8cb0576f19510ae",class:"highphenLegend"},l.entries.Lcz_Occupancy)),i("div",{key:"271a9700f90d5cfaf6f69eb661adcadcea01ea90",class:"legendRow"},i("div",{key:"e698daa8a588d97fd59be6f998258b2b934ace3f",class:"legendCal br-s br-bt  font-weight-bold total-availability"},"20"),i("div",{key:"6e134af5ad03117b1b356054fccf68d27dcf9e2a",class:"highphenLegend"},l.entries.Lcz_TotalAvailability)))))))}};R.style=T;const Y=".sc-igl-to-be-assigned-h{display:block}.custom-dropdown.sc-igl-to-be-assigned{cursor:pointer;padding:5px 10px;width:min-content;margin-left:auto;margin-right:auto}.dropdown-toggle.sc-igl-to-be-assigned{all:unset;display:flex;width:max-content;align-items:center;gap:10px}.close_btn_style.sc-igl-to-be-assigned{padding:0.4rem}.close_btn_style.sc-igl-to-be-assigned:hover{background-color:#f6f6f6}.dropdown-menu.sc-igl-to-be-assigned{max-height:250px;overflow-y:auto}.tobeAssignedHeader.sc-igl-to-be-assigned{font-weight:500;letter-spacing:0.05rem;font-size:1.12rem;padding:0;margin:0}.assignment_header.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:space-between;padding-top:5px;margin-bottom:1rem}.dropdown-toggle.sc-igl-to-be-assigned::after{content:none;display:none}.dropdown-toggle.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transition:transform 0.2s ease}.show.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transform:rotate(-180deg)}.stickyHeader.sc-igl-to-be-assigned{position:-webkit-sticky;position:sticky;top:0;background-color:#ffffff;z-index:1}.pointer.sc-igl-to-be-assigned{cursor:pointer}.dots.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:center;margin:0 3px;padding:0}.dot.sc-igl-to-be-assigned{width:5px;height:5px;margin:5px 4px 0;background-color:#6b6f82;border-radius:50%;animation:dotFlashing 1s infinite linear alternate}.dot.sc-igl-to-be-assigned:nth-child(2){animation-delay:0.2s}.dot.sc-igl-to-be-assigned:nth-child(3){animation-delay:0.4s}@keyframes dotFlashing{0%{opacity:0}50%,100%{opacity:1}}";const O=Y;const B=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.reduceAvailableUnitEvent=t(this,"reduceAvailableUnitEvent",7);this.showBookingPopup=t(this,"showBookingPopup",7);this.addToBeAssignedEvent=t(this,"addToBeAssignedEvent",7);this.highlightToBeAssignedBookingEvent=t(this,"highlightToBeAssignedBookingEvent",7);this.isGotoToBeAssignedDate=false;this.isLoading=true;this.selectedDate=null;this.data={};this.today=new Date;this.categoriesData={};this.toBeAssignedService=new d;this.unassignedDatesProp=undefined;this.propertyid=undefined;this.from_date=undefined;this.to_date=undefined;this.calendarData=undefined;this.loadingMessage=undefined;this.showDatesList=false;this.renderAgain=false;this.orderedDatesList=[];this.noScroll=false}componentWillLoad(){this.reArrangeData();this.loadingMessage=l.entries.Lcz_FetchingUnAssignedUnits}handleUnassignedDatesToBeAssignedChange(e){const{fromDate:t,toDate:i,data:s}=e;let n=new Date(t);n.setHours(0);n.setMinutes(0);n.setSeconds(0);let o=n.getTime();while(o<=new Date(i).getTime()){if(s&&!s[o]&&this.unassignedDates.hasOwnProperty(o)){delete this.unassignedDates[o]}else if(s&&s[o]){this.unassignedDates[o]=s[o]}o=f(o).add(1,"days").toDate().getTime()}this.data=Object.assign({},this.unassignedDates);this.orderedDatesList=Object.keys(this.data).sort(((e,t)=>parseInt(e)-parseInt(t)));if(this.orderedDatesList.length){if(!this.data.hasOwnProperty(this.selectedDate)){this.selectedDate=this.orderedDatesList.length?this.orderedDatesList[0]:null}this.showForDate(this.selectedDate,false);this.renderView()}else{this.selectedDate=null}}handleAssignUnit(e){const t=e.detail;const i=t.data;e.stopImmediatePropagation();e.stopPropagation();if(t.key==="assignUnit"){if(Object.keys(this.data[i.selectedDate].categories).length===1){this.isLoading=true;this.noScroll=true}this.data[i.selectedDate].categories[i.RT_ID]=this.data[i.selectedDate].categories[i.RT_ID].filter((e=>e.ID!=i.assignEvent.ID));this.calendarData=i.calendarData;this.renderView()}}async updateCategories(e,t){try{let i={};const s=await this.toBeAssignedService.getUnassignedRooms({from_date:t.from_date,to_date:t.to_date},this.propertyid,r(new Date(+e)),t.roomsInfo,t.formattedLegendData);s.forEach((e=>{if(!i.hasOwnProperty(e.RT_ID)){i[e.RT_ID]=[e]}else{i[e.RT_ID].push(e)}}));this.unassignedDates[e].categories=i}catch(e){}}async reArrangeData(){try{this.today.setHours(0,0,0,0);this.calendarData.roomsInfo.forEach((e=>{this.categoriesData[e.id]={name:e.name,roomsList:e.physicalrooms,roomIds:e.physicalrooms.map((e=>e.id))}}));this.selectedDate=null;this.unassignedDates=p();console.log(this.unassignedDates);this.data=this.unassignedDates;this.orderedDatesList=Object.keys(this.data).sort(((e,t)=>parseInt(e)-parseInt(t)));if(!this.selectedDate&&this.orderedDatesList.length){this.selectedDate=this.orderedDatesList[0]}}catch(e){console.error("Error fetching unassigned dates:",e)}}async componentDidLoad(){setTimeout((()=>{if(!this.isGotoToBeAssignedDate&&Object.keys(this.unassignedDates).length>0){const e=Object.keys(this.unassignedDates)[0];this.showForDate(e)}}),100)}async gotoDate(e){this.isGotoToBeAssignedDate=true;this.showForDate(e.detail.data);this.showDatesList=false;this.renderView()}handleToBeAssignedDate(e){this.showBookingPopup.emit({key:"calendar",data:new Date(e.detail.data.fromDate).getTime()-864e5,noScroll:false})}async showForDate(e,t=true){try{if(t){this.isLoading=true}if(this.showDatesList){this.showUnassignedDate()}await this.updateCategories(e,this.calendarData);this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.showBookingPopup.emit({key:"calendar",data:parseInt(e)-864e5,noScroll:this.noScroll});if(this.isGotoToBeAssignedDate){this.isGotoToBeAssignedDate=false}this.isLoading=false;this.selectedDate=e;this.renderView()}catch(e){}}getDay(e){const t=new Date(e);const i="default";const s=this.getLocalizedDayOfWeek(t,i);return s+" "+t.getDate()+", "+t.getFullYear()}getLocalizedDayOfWeek(e,t){const i={weekday:"short"};return e.toLocaleDateString(t,i)}handleOptionEvent(e,t=""){this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:"----"}});this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.optionEvent.emit({key:e,data:t})}showUnassignedDate(){this.showDatesList=!this.showDatesList}getToBeAssignedEntities(){}getCategoryView(){if(this.orderedDatesList.length&&this.selectedDate&&this.data[this.selectedDate]){return Object.entries(this.data[this.selectedDate].categories).map((([e,t],s)=>i("igl-tba-category-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,categoryId:e,categoryIndex:s,categoriesData:this.categoriesData,eventDatas:t,onAssignUnitEvent:e=>this.handleAssignUnit(e)})))}else{return null}}renderView(){this.renderAgain=!this.renderAgain}render(){var e;return i(s,{key:"d569f1a5af566b1af74a59b2a5c42e978bce6802",class:"tobeAssignedContainer pr-1 text-left"},i("div",{key:"1f0f351f3cb23cc94993df2593a854ff47833e9b"},i("div",{key:"e43ccb787e67598fc54e7ee2293df63b40abb49c"},i("div",{key:"5f4a180e4bb46a4036cf962467abe20e658bdca5",class:"stickyHeader pt-1"},i("div",{key:"7e1d33943b24bc3fbc381b19163f03e5146516da",class:"assignment_header"},i("p",{key:"f35ef1df6f30c32f5b1efc8422036d3bcd63d559",class:"tobeAssignedHeader "},l.entries.Lcz_Assignments),i("ir-button",{key:"21d6e98889fa3cbffea9ad07dafc906ddef6b02a",class:"close_btn",variant:"icon",btn_styles:"close_btn_style",icon_name:"double_caret_left",style:u.secondary,onClickHandler:()=>this.handleOptionEvent("closeSideMenu"),visibleBackgroundOnHover:true})),i("hr",{key:"638ff9739b3ca0aa47fd97c0fab70e2f14228419"}),Object.keys(this.data).length===0?i("p",null,l.entries.Lcz_AllBookingsAreAssigned):this.isLoading?i("p",{class:"d-flex align-items-center"},i("span",{class:"p-0"},this.loadingMessage),i("div",{class:"dots"},i("div",{class:"dot"}),i("div",{class:"dot"}),i("div",{class:"dot"}))):i(n,null,this.orderedDatesList.length?i("div",{class:`custom-dropdown border border-light rounded text-center `+(this.showDatesList?"show":""),id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i("div",{class:"dropdown-toggle"},i("span",{class:"font-weight-bold"},this.data[this.selectedDate].dateStr),i("svg",{class:"caret-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"}))),i("div",{class:"dropdown-menu dropdown-menu-right full-width","aria-labelledby":"dropdownMenuButton"},(e=this.orderedDatesList)===null||e===void 0?void 0:e.map((e=>i("div",{class:"dropdown-item pointer",onClick:()=>this.showForDate(e)},this.data[e].dateStr))))):l.entries.Lcz_AllBookingsAreAssigned)),!this.isLoading&&i("div",{key:"5debb87f644dfde418da6c5f8ceed3abb738f8a1",class:"scrollabledArea"},this.orderedDatesList.length?Object.keys(this.data[this.selectedDate].categories).length?this.getCategoryView():i("div",{class:"mt-1"},l.entries.Lcz_AllAssignForThisDay):null))))}static get watchers(){return{unassignedDatesProp:["handleUnassignedDatesToBeAssignedChange"]}}};B.style=O;const A=".sc-ir-room-nights-h{display:block;box-sizing:border-box;margin:0;position:relative}.loading-container.sc-ir-room-nights{position:relative;height:100%;width:100%;display:flex;align-items:center;justify-content:center}.close-icon.sc-ir-room-nights{position:absolute;top:18px;right:33px;outline:none}.close.sc-ir-room-nights{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.card.sc-ir-room-nights{top:0;z-index:1000}.card-title.sc-ir-room-nights{border-bottom:1px solid #e4e5ec;width:100%}.irfontgreen.sc-ir-room-nights{color:#0e930e}.currency.sc-ir-room-nights{display:block;position:absolute;margin:0;padding:0;height:auto;left:10px}.rate-input.sc-ir-room-nights{font-size:14px;line-height:0;padding:0;height:0;border-left:0;border-radius:0.25rem !important}.rate-input-container.sc-ir-room-nights{display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;flex:1}.new-currency.sc-ir-room-nights{color:#3b4781;border:1px solid #cacfe7;font-size:0.975rem;height:2rem;background:rgb(255, 255, 255);padding-right:0 !important;border-right:0;border-top-right-radius:0;border-bottom-right-radius:0;transition:border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.input-group-prepend.sc-ir-room-nights span[data-state='focus'].sc-ir-room-nights{border-color:var(--blue)}.input-group-prepend.sc-ir-room-nights span[data-disabled].sc-ir-room-nights{background-color:#eceff1;border-color:rgba(118, 118, 118, 0.3)}.rateInputBorder.sc-ir-room-nights{padding-left:5px !important;padding-right:5px !important;border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}";const j=A;const M=class{constructor(i){e(this,i);this.closeRoomNightsDialog=t(this,"closeRoomNightsDialog",7);this.bookingService=new a;this.bookingNumber=undefined;this.propertyId=undefined;this.language=undefined;this.identifier=undefined;this.toDate=undefined;this.fromDate=undefined;this.pool=undefined;this.ticket=undefined;this.defaultDates=undefined;this.bookingEvent=undefined;this.selectedRoom=undefined;this.rates=[];this.isLoading=false;this.initialLoading=false;this.inventory=null;this.isEndDateBeforeFromDate=false;this.defaultTotalNights=0;this.isInputFocused=-1;this.dates={from_date:new Date,to_date:new Date}}componentWillLoad(){this.dates={from_date:new Date(this.fromDate),to_date:new Date(this.toDate)};this.init()}isButtonDisabled(){return this.isLoading||this.rates.some((e=>e.amount===-1))||this.inventory===0||this.inventory===null}async init(){var e;try{const{from_date:t}=this.defaultDates;if(f(t,"YYYY-MM-DD").isBefore(f(this.fromDate,"YYYY-MM-DD"))){this.dates.from_date=new Date(t)}else{this.dates.from_date=new Date(this.fromDate)}this.dates.to_date=new Date(this.toDate);this.bookingEvent=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);if(this.bookingEvent){const t=this.bookingEvent.rooms.filter((e=>e.identifier===this.identifier));this.selectedRoom=t[0];const i=(e=this.selectedRoom)===null||e===void 0?void 0:e.days[this.selectedRoom.days.length-1];if(f(this.toDate).add(-1,"days").isSame(f(i.date))){console.log("here1");const e=await this.fetchBookingAvailability(this.fromDate,this.selectedRoom.days[0].date,this.selectedRoom.rateplan.id);const t=c(this.selectedRoom.days[0].date,this.fromDate);this.isEndDateBeforeFromDate=true;this.rates=[...t.map((i=>({amount:e/t.length,date:i,cost:null}))),...this.selectedRoom.days];this.defaultTotalNights=this.rates.length-this.selectedRoom.days.length}else{console.log("here2");console.log(i);const e=await this.fetchBookingAvailability(this.bookingEvent.to_date,f(this.toDate,"YYYY-MM-DD").format("YYYY-MM-DD"),this.selectedRoom.rateplan.id);const t=c(i.date,this.toDate);this.rates=[...this.selectedRoom.days,...t.map((i=>({amount:e/t.length,date:i,cost:null})))]}}}catch(e){console.log(e)}}handleInput(e,t){let i=e;let s=[...this.rates];i=i.replace(/[^0-9.]/g,"");if(i===""){s[t].amount=-1}else{if(!isNaN(Number(i))){s[t].amount=Number(i)}}this.rates=s}async fetchBookingAvailability(e,t,i){var s;try{this.initialLoading=true;const n=await this.bookingService.getBookingAvailability({from_date:e,to_date:t,propertyid:this.propertyId,adultChildCount:{adult:this.selectedRoom.rateplan.selected_variation.adult_nbr,child:this.selectedRoom.rateplan.selected_variation.child_nbr},language:this.language,currency:this.bookingEvent.currency,room_type_ids:[this.selectedRoom.roomtype.id],rate_plan_ids:[i]});console.log(n[0],i);this.inventory=n[0].inventory;const o=n[0].rateplans.find((e=>e.id===i));if(!o||!o.variations){this.inventory=null;return null}const a=(s=o.variations)===null||s===void 0?void 0:s.find((e=>e.adult_nbr===this.selectedRoom.rateplan.selected_variation.adult_nbr&&e.child_nbr===this.selectedRoom.rateplan.selected_variation.child_nbr));if(!a){return null}return a.discounted_gross_amount}catch(e){console.error(e)}finally{this.initialLoading=false}}renderInputField(e,t,s){return i("div",{class:"col-3 ml-1 position-relative  m-0 p-0 rate-input-container"},i("ir-price-input",{value:s.amount>0?s.amount.toString():"",disabled:this.inventory===0||this.inventory===null,currency:t,"aria-label":"rate","aria-describedby":"rate cost",onTextChange:t=>this.handleInput(t.detail,e)}))}renderReadOnlyField(e,t){return i("p",{class:"col-9 ml-1 m-0 p-0"},`${e}${Number(t.amount).toFixed(2)}`)}renderRateFields(e,t,i){if(this.isEndDateBeforeFromDate){if(e<this.defaultTotalNights){return this.renderInputField(e,t,i)}else{return this.renderReadOnlyField(t,i)}}else{return e<this.selectedRoom.days.length?this.renderReadOnlyField(t,i):this.renderInputField(e,t,i)}}renderDates(){var e;const t=this.bookingEvent.currency.symbol;return i("div",{class:"mt-2 m-0"},(e=this.rates)===null||e===void 0?void 0:e.map(((e,s)=>i("div",{class:"row m-0 mt-1 align-items-center"},i("p",{class:"col-2 m-0 p-0"},h(e.date)),this.renderRateFields(s,t,e)))))}async handleRoomConfirmation(){try{this.isLoading=true;let e=[...this.bookingEvent.rooms];let t=e.findIndex((e=>e.identifier===this.identifier));if(t===-1){throw new Error("Invalid Pool")}e[t]=Object.assign(Object.assign({},e[t]),{days:this.rates,to_date:f(this.dates.to_date).format("YYYY-MM-DD"),from_date:f(this.dates.from_date).format("YYYY-MM-DD")});const i={assign_units:true,check_in:true,is_pms:true,is_direct:true,pickup_info:this.bookingEvent.pickup_info,extra_services:this.bookingEvent.extra_services,booking:{booking_nbr:this.bookingNumber,from_date:f(this.dates.from_date).format("YYYY-MM-DD"),to_date:f(this.dates.to_date).format("YYYY-MM-DD"),remark:this.bookingEvent.remark,property:this.bookingEvent.property,source:this.bookingEvent.source,currency:this.bookingEvent.currency,arrival:this.bookingEvent.arrival,guest:this.bookingEvent.guest,rooms:e}};await this.bookingService.doReservation(i);this.closeRoomNightsDialog.emit({type:"confirm",pool:this.pool})}catch(e){}finally{this.isLoading=false}}render(){var e,t,o;if(!this.bookingEvent){return i("div",{class:"loading-container"},i("ir-loading-screen",null))}console.log(this.inventory);return i(s,null,i("div",{class:"card position-sticky mb-0 shadow-none p-0 "},i("div",{class:"d-flex mt-2 align-items-center justify-content-between "},i("h3",{class:"card-title text-left pb-1 font-medium-2 px-2"},l.entries.Lcz_AddingRoomNightsTo," ",(t=(e=this.selectedRoom)===null||e===void 0?void 0:e.roomtype)===null||t===void 0?void 0:t.name," ",((o=this.selectedRoom)===null||o===void 0?void 0:o.unit).name),i("button",{type:"button",class:"close close-icon",onClick:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool})},i("ir-icon",{icon:"ft-x",class:"m-0"})))),i("section",{class:"text-left px-2"},i("p",{class:"font-medium-1"},`${l.entries.Lcz_Booking}#`," ",this.bookingNumber),this.initialLoading?i("p",{class:"mt-2 text-secondary"},l.entries["Lcz_CheckingRoomAvailability "]):i(n,null,i("p",{class:"font-weight-bold font-medium-1"},`${g(f(this.dates.from_date).format("YYYY-MM-DD"),"YYYY-MM-DD")} - ${g(f(this.dates.to_date).format("YYYY-MM-DD"),"YYYY-MM-DD")}`),i("p",{class:"font-medium-1 mb-0"},`${this.selectedRoom.rateplan.name}`," ",this.selectedRoom.rateplan.is_non_refundable&&i("span",{class:"irfontgreen"},l.entries.Lcz_NonRefundable)),(this.inventory===0||this.inventory===null)&&i("p",{class:"font-medium-1 text danger"},l.entries.Lcz_NoAvailabilityForAdditionalNights),this.selectedRoom.rateplan.custom_text&&i("p",{class:"text-secondary mt-0"},this.selectedRoom.rateplan.custom_text),this.renderDates())),i("section",{class:"d-flex align-items-center mt-2 px-2"},i("ir-button",{btn_color:"secondary",btn_disabled:this.isLoading,text:l===null||l===void 0?void 0:l.entries.Lcz_Cancel,class:"full-width",btn_styles:"justify-content-center",onClickHandler:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool})}),this.inventory>0&&this.inventory!==null&&i("ir-button",{isLoading:this.isLoading,text:l===null||l===void 0?void 0:l.entries.Lcz_Confirm,btn_disabled:this.isButtonDisabled(),class:"ml-1 full-width",btn_styles:"justify-content-center",onClickHandler:this.handleRoomConfirmation.bind(this)})))}};M.style=j;export{w as igl_cal_body,x as igl_cal_footer,_ as igl_cal_header,R as igl_legends,B as igl_to_be_assigned,M as ir_room_nights};
//# sourceMappingURL=p-40537b65.entry.js.map