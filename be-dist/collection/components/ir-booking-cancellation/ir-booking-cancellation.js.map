{"version":3,"file":"ir-booking-cancellation.js","sourceRoot":"","sources":["../../../src/components/ir-booking-cancellation/ir-booking-cancellation.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, Fragment, h, Method, Prop, State } from '@stencil/core';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport { PaymentService, TBookingInfo } from '@/services/api/payment.service';\r\nimport { Booking } from '@/models/booking.dto';\r\nimport localizedWords from '@/stores/localization.store';\r\nimport app_store from '@/stores/app.store';\r\nimport { BookingService } from '@/services/api/booking.service';\r\n\r\n@Component({\r\n  tag: 'ir-booking-cancellation',\r\n  styleUrl: 'ir-booking-cancellation.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingCancellation {\r\n  @Prop() property_id: number;\r\n  @Prop() booking: Booking;\r\n  @State() isLoading: boolean;\r\n  @State() isOpen = false;\r\n  @State() policies: TBookingInfo[] = [];\r\n  @State() cancellationMessage: string;\r\n\r\n  @Event() openChange: EventEmitter<boolean>;\r\n  @Event() cancellationResult: EventEmitter<{ state: 'failed' | 'success'; booking_nbr: string }>;\r\n\r\n  private alertDialog: HTMLIrAlertDialogElement;\r\n  private paymentService = new PaymentService();\r\n  private bookingService = new BookingService();\r\n\r\n  async init() {\r\n    try {\r\n      if (!this.booking) {\r\n        throw new Error('Missing Booking');\r\n      }\r\n      this.policies = [];\r\n      this.cancellationMessage = await this.bookingService.GetPenaltyStatement({\r\n        booking_nbr: this.booking.booking_nbr,\r\n        currency_id: this.booking.currency.id,\r\n        language: app_store.userPreferences.language_id,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error during initialization:', error);\r\n    }\r\n  }\r\n  private async fetchRatePlansMoreDetails() {\r\n    if (this.policies.length > 0) {\r\n      return;\r\n    }\r\n    const results = await this.paymentService.getBookingPrepaymentAmount(this.booking);\r\n    console.log(results);\r\n    if (results) {\r\n      this.policies = results.cancelation_policies;\r\n    }\r\n  }\r\n  @Method()\r\n  async openDialog() {\r\n    this.openChange.emit(true);\r\n    this.alertDialog.openModal();\r\n    console.log(this.booking);\r\n    if (!this.booking) {\r\n      throw new Error('Missing booking');\r\n    }\r\n    await this.init();\r\n  }\r\n\r\n  private closeAlertDialog() {\r\n    this.alertDialog.closeModal();\r\n    this.openChange.emit(false);\r\n  }\r\n\r\n  render() {\r\n    const isPending = isRequestPending('/Get_Exposed_Applicable_Policies');\r\n    // const isPending = isRequestPending('/Get_Exposed_Cancelation_Due_Amount');\r\n    return (\r\n      <div>\r\n        <ir-alert-dialog\r\n          ref={el => (this.alertDialog = el)}\r\n          onOpenChange={e => {\r\n            if (!e.detail && this.isOpen) {\r\n              this.isOpen = false;\r\n            }\r\n          }}\r\n        >\r\n          <h2 slot=\"modal-title\" class=\"text-lg font-medium\">\r\n            {localizedWords.entries.Lcz_BookingCancellation}\r\n          </h2>\r\n          <div class=\"py-3\" slot=\"modal-body\">\r\n            {isRequestPending('/Get_Penalty_Statement') ? (\r\n              <div class=\"h-24\">\r\n                <ir-skeleton class=\"mb-2.5 h-4 w-60\"></ir-skeleton>\r\n              </div>\r\n            ) : (\r\n              <Fragment>\r\n                {/* {this.paymentAmount > 0 ? (\r\n                  <p class=\"mb-2.5 font-semibold\">{localizedWords.entries.Lcz_IfYouCancelNow.replace('%1', formatAmount(this.paymentAmount, this.currency?.code || 'usd'))}.</p>\r\n                ) : (\r\n                  <p class=\"mb-2.5 font-semibold\">{localizedWords.entries.Lcz_NoPenalityIsApplied}</p>\r\n                )} */}\r\n                <p class=\"mb-2.5\">{this.cancellationMessage}</p>\r\n                <button\r\n                  onClick={() => {\r\n                    this.isOpen = !this.isOpen;\r\n                    this.fetchRatePlansMoreDetails();\r\n                  }}\r\n                  class=\"flex w-full items-center justify-between rounded-md  py-1 \"\r\n                >\r\n                  <p>{localizedWords.entries.Lcz_MoreDetails}</p>\r\n                  <ir-icons name={this.isOpen ? 'angle_up' : 'angle_down'} svgClassName=\"h-3\"></ir-icons>\r\n                </button>\r\n                {this.isOpen && (\r\n                  <Fragment>\r\n                    {isRequestPending('/Get_Exposed_Applicable_Policies') ? (\r\n                      <div class=\"h-20 w-full\">\r\n                        <ir-skeleton class=\"mb-2.5 h-20  w-60\"></ir-skeleton>\r\n                      </div>\r\n                    ) : (\r\n                      <div class={'divide-y py-2'}>\r\n                        {this.policies?.map(d => (\r\n                          <div class=\"space-y-1.5 py-2.5\">\r\n                            <p class={'font-medium'}>\r\n                              {d.rt_name} {d.rp_name}\r\n                            </p>\r\n                            <p class=\"text-xs text-gray-500\">{d.statement}</p>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </Fragment>\r\n                )}\r\n              </Fragment>\r\n            )}\r\n          </div>\r\n\r\n          <div slot=\"modal-footer\">\r\n            <ir-button\r\n              label={localizedWords.entries.Lcz_Cancel}\r\n              variants=\"outline\"\r\n              onButtonClick={() => {\r\n                this.closeAlertDialog();\r\n              }}\r\n              size=\"md\"\r\n            ></ir-button>\r\n            <ir-button\r\n              disabled={isPending}\r\n              size=\"md\"\r\n              label={localizedWords.entries.Lcz_AcceptAndConfirm}\r\n              isLoading={isRequestPending('/Request_Booking_Cancelation')}\r\n              onButtonClick={async () => {\r\n                try {\r\n                  await this.paymentService.RequestBookingCancellation(this.booking.booking_nbr);\r\n                  this.cancellationResult.emit({ state: 'success', booking_nbr: this.booking.booking_nbr });\r\n                  this.closeAlertDialog();\r\n                } catch (error) {\r\n                  console.error(error);\r\n                  this.cancellationResult.emit({ state: 'failed', booking_nbr: this.booking.booking_nbr });\r\n                }\r\n              }}\r\n            ></ir-button>\r\n          </div>\r\n        </ir-alert-dialog>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]}