{"version":3,"file":"ir-coupon-dialog.js","sourceRoot":"","sources":["../../../src/components/ir-coupon-dialog/ir-coupon-dialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import app_store from '@/stores/app.store';\nimport booking_store, { modifyBookingStore } from '@/stores/booking';\nimport { cn } from '@/utils/utils';\nimport { Component, Fragment, h, State } from '@stencil/core';\nimport { isBefore } from 'date-fns';\n\n@Component({\n  tag: 'ir-coupon-dialog',\n  styleUrl: 'ir-coupon-dialog.css',\n  shadow: true,\n})\nexport class IrCouponDialog {\n  @State() coupon: string;\n  @State() validationMessage: { error: boolean; message: string };\n\n  dialogRef: HTMLIrDialogElement;\n\n  activateCoupon() {\n    this.validationMessage = null;\n    const c = app_store.property.promotions.find(p => p.key === this.coupon.trim());\n    if (!c) {\n      return (this.validationMessage = { error: true, message: 'Invalid coupon' });\n    }\n    if (isBefore(new Date(c.to), new Date())) {\n      return (this.validationMessage = { error: true, message: 'Invalid coupon' });\n    }\n    modifyBookingStore('bookingAvailabilityParams', {\n      coupon: this.coupon,\n      loyalty: false,\n    });\n    this.validationMessage = { error: false, message: this.coupon };\n    this.dialogRef.closeModal();\n  }\n  removeCoupon() {\n    this.validationMessage = null;\n    this.coupon = '';\n    modifyBookingStore('bookingAvailabilityParams', {\n      coupon: null,\n      loyalty: false,\n    });\n  }\n  render() {\n    const showCoupon = app_store.property?.promotions?.some(p => p.key !== '');\n    if (!showCoupon || booking_store.bookingAvailabilityParams.loyalty) {\n      return null;\n    }\n    return (\n      <Fragment>\n        <div class=\"flex items-center w-full gap-4 justify-center\">\n          <ir-button\n            class={cn('w-full', {\n              'w-fit': this.validationMessage && !this.validationMessage.error,\n            })}\n            onButtonClick={() => this.dialogRef.openModal()}\n            variants=\"outline\"\n            label=\"Have a coupon?\"\n            haveLeftIcon\n          >\n            <ir-icons slot=\"left-icon\" name=\"heart\"></ir-icons>\n          </ir-button>\n          {this.validationMessage && !this.validationMessage.error && (\n            <div class=\"flex items-center gap-2.5 text-sm text-[hsl(var(--brand-600))]\">\n              <p onClick={this.removeCoupon.bind(this)}>Discount applied</p>\n              <ir-button variants=\"icon\" onButtonClick={this.removeCoupon.bind(this)}>\n                <ir-icons slot=\"btn-icon\" name=\"xmark\" svgClassName=\"text-[hsl(var(--brand-600))]\"></ir-icons>\n              </ir-button>\n            </div>\n          )}\n        </div>\n\n        <ir-dialog ref={el => (this.dialogRef = el)}>\n          <form\n            onSubmit={e => {\n              e.preventDefault();\n              this.activateCoupon();\n            }}\n            class=\"p-4 sm:p-6\"\n            slot=\"modal-body\"\n          >\n            <h1 class=\"title\">Enter code</h1>\n            <p class=\"Supporting-text mb-8\">If you have a coupon available, you can enter it below to unlock special discounts:</p>\n            <ir-input error={this.validationMessage?.error} onTextChanged={e => (this.coupon = e.detail)} autofocus inputId=\"booking_code\" label=\"Enter your coupon\"></ir-input>\n            {this.validationMessage?.error && <p class=\"text-red-500\">{this.validationMessage.message}</p>}\n            <div class=\"flex flex-col-reverse items-center justify-end mt-8 gap-4 sm:flex-row\">\n              <ir-button\n                size=\"md\"\n                onButtonClick={() => {\n                  this.dialogRef.closeModal();\n                }}\n                variants=\"outline\"\n                label=\"Cancel\"\n                class={'w-full sm:w-fit'}\n              ></ir-button>\n              <ir-button type=\"submit\" size=\"md\" label=\"Activate\" class=\"w-full sm:w-fit\"></ir-button>\n            </div>\n          </form>\n        </ir-dialog>\n      </Fragment>\n    );\n  }\n}\n"]}