{"version":3,"file":"ir-booking-cancelation.js","sourceRoot":"","sources":["../../../src/components/ir-booking-cancelation/ir-booking-cancelation.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, Fragment, h, Method, Prop, State } from '@stencil/core';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport { PaymentService, TBookingInfo } from '@/services/api/payment.service';\r\nimport app_store from '@/stores/app.store';\r\nimport { formatAmount } from '@/utils/utils';\r\n\r\n@Component({\r\n  tag: 'ir-booking-cancelation',\r\n  styleUrl: 'ir-booking-cancelation.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingCancelation {\r\n  @Prop() booking_nbr: string;\r\n  @Prop() cancelation: string;\r\n  @Prop() cancelation_policies: TBookingInfo[] = [];\r\n  @Prop() currency: { code: string; id: number };\r\n\r\n  @State() paymentAmount: number;\r\n  @State() isOpen = false;\r\n  @Event() openChange: EventEmitter<boolean>;\r\n  @Event() cancelationResult: EventEmitter<{ state: 'failed' | 'success'; booking_nbr: string }>;\r\n\r\n  private alertDialog: HTMLIrAlertDialogElement;\r\n  private paymentService = new PaymentService();\r\n\r\n  componentWillLoad() {\r\n    this.paymentService.setToken(app_store.app_data.token);\r\n  }\r\n  async setOverdueAmount() {\r\n    try {\r\n      const res = await this.paymentService.getExposedCancelationDueAmount({\r\n        booking_nbr: this.booking_nbr,\r\n        currency_id: this.currency.id,\r\n      });\r\n\r\n      const overdueResult = res.find(f => f.type === 'overdue');\r\n      if (overdueResult) {\r\n        this.paymentAmount = overdueResult.amount;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching overdue amount:', error);\r\n    }\r\n  }\r\n\r\n  @Method()\r\n  async openDialog() {\r\n    this.openChange.emit(true);\r\n    this.alertDialog.openModal();\r\n    await this.setOverdueAmount();\r\n  }\r\n\r\n  private closeAlertDialog() {\r\n    this.alertDialog.closeModal();\r\n    this.openChange.emit(false);\r\n  }\r\n\r\n  render() {\r\n    const isPending = isRequestPending('/Get_Exposed_Cancelation_Due_Amount');\r\n    return (\r\n      <div>\r\n        <ir-alert-dialog ref={el => (this.alertDialog = el)}>\r\n          <h2 slot=\"modal-title\" class=\"text-lg font-medium\">\r\n            Booking Cancellation\r\n          </h2>\r\n          <div class=\"py-3\" slot=\"modal-body\">\r\n            {isPending ? (\r\n              <Fragment>\r\n                <ir-skeleton class=\"mb-2.5 h-5 w-60\"></ir-skeleton>\r\n                <ir-skeleton class=\"mb-2.5 h-6 w-full\"></ir-skeleton>\r\n              </Fragment>\r\n            ) : (\r\n              <Fragment>\r\n                {this.paymentAmount ? (\r\n                  <p class=\"mb-2.5 font-semibold\">{`If you cancel now, the penalty will be ${formatAmount(this.paymentAmount, this.currency?.code || 'usd')}.`}</p>\r\n                ) : (\r\n                  <p class=\"mb-2.5 font-semibold\">No penalty is applied if you cancel now.</p>\r\n                )}\r\n                <button\r\n                  onClick={() => {\r\n                    this.isOpen = !this.isOpen;\r\n                  }}\r\n                  class=\"flex w-full items-center justify-between rounded-md  py-1 \"\r\n                >\r\n                  <p>More details</p>\r\n                  <ir-icons name={this.isOpen ? 'angle_up' : 'angle_down'} svgClassName=\"h-3\"></ir-icons>\r\n                </button>\r\n                {this.isOpen && (\r\n                  <Fragment>\r\n                    <div class={'divide-y py-2'}>\r\n                      {this.cancelation_policies.map(d => (\r\n                        <div class=\"space-y-1.5 py-2.5\">\r\n                          <p class={'font-medium'}>\r\n                            {d.rt_name} {d.rp_name}\r\n                          </p>\r\n                          <p class=\"text-xs text-gray-500\">{d.statement}</p>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </Fragment>\r\n                )}\r\n              </Fragment>\r\n            )}\r\n          </div>\r\n\r\n          <div slot=\"modal-footer\">\r\n            <ir-button\r\n              label=\"Cancel\"\r\n              variants=\"outline\"\r\n              onButtonClick={() => {\r\n                this.closeAlertDialog();\r\n              }}\r\n              size=\"md\"\r\n            ></ir-button>\r\n            <ir-button\r\n              disabled={isPending}\r\n              size=\"md\"\r\n              label=\"Accept & Confirm\"\r\n              isLoading={isRequestPending('/Request_Booking_Cancelation')}\r\n              onButtonClick={async () => {\r\n                try {\r\n                  await this.paymentService.RequestBookingCancelation(this.booking_nbr);\r\n                  this.cancelationResult.emit({ state: 'success', booking_nbr: this.booking_nbr });\r\n                  this.closeAlertDialog();\r\n                } catch (error) {\r\n                  console.error(error);\r\n                  this.cancelationResult.emit({ state: 'failed', booking_nbr: this.booking_nbr });\r\n                }\r\n              }}\r\n            ></ir-button>\r\n          </div>\r\n        </ir-alert-dialog>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]}