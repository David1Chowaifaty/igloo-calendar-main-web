{"version":3,"file":"ir-booking-widget.js","sourceRoot":"","sources":["../../../src/components/ir-booking-widget/ir-booking-widget.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Element, Prop, Watch, Fragment, State } from '@stencil/core';\r\nimport { TContainerStyle } from './types';\r\nimport localization_store from '@/stores/app.store';\r\nimport { CommonService } from '@/services/api/common.service';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport axios from 'axios';\r\nimport app_store from '@/stores/app.store';\r\nimport { addDays, format } from 'date-fns';\r\nimport localizedWords from '@/stores/localization.store';\r\n@Component({\r\n  tag: 'ir-widget',\r\n  styleUrl: 'ir-booking-widget.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingWidget {\r\n  @Element() el: HTMLIrWidgetElement;\r\n\r\n  @Prop({ reflect: true }) position: 'fixed' | 'block' = 'fixed';\r\n  @Prop() contentContainerStyle: TContainerStyle;\r\n  @Prop() propertyId: number = 42;\r\n  @Prop() perma_link: string = null;\r\n  @Prop() p: string = null;\r\n  @Prop() language: string = 'en';\r\n  @Prop() roomTypeId: string | null = null;\r\n\r\n  @State() isPopoverOpen: boolean;\r\n  @State() isLoading: boolean;\r\n  @State() dates: { from_date: Date | null; to_date: Date | null } = {\r\n    from_date: null,\r\n    to_date: null,\r\n  };\r\n  @State() guests: { adultCount: number; childrenCount: number } = {\r\n    adultCount: 0,\r\n    childrenCount: 0,\r\n  };\r\n\r\n  private baseUrl: string = 'https://gateway.igloorooms.com/IRBE';\r\n  private popover: HTMLIrPopoverElement;\r\n  private token: string;\r\n\r\n  private commonService = new CommonService();\r\n  private propertyService = new PropertyService();\r\n  private guestPopover: HTMLIrPopoverElement;\r\n\r\n  private initApp() {\r\n    this.modifyContainerStyle();\r\n    axios.defaults.withCredentials = true;\r\n    axios.defaults.baseURL = this.baseUrl;\r\n  }\r\n  async componentWillLoad() {\r\n    this.initApp();\r\n    this.token = await this.commonService.getBEToken();\r\n    app_store.userPreferences = {\r\n      language_id: this.language,\r\n      currency_id: 'usd',\r\n    };\r\n    this.commonService.setToken(this.token);\r\n    this.propertyService.setToken(this.token);\r\n    this.initProperty();\r\n  }\r\n  componentDidLoad() {\r\n    console.log('the widget is loaded');\r\n    if (this.position === 'fixed') {\r\n      console.log('widget appended to body');\r\n      document.body.appendChild(this.el);\r\n    }\r\n  }\r\n  async initProperty() {\r\n    try {\r\n      this.isLoading = true;\r\n      await Promise.all([\r\n        this.propertyService.getExposedProperty({\r\n          id: this.propertyId,\r\n          language: this.language,\r\n          aname: this.p,\r\n          perma_link: this.perma_link,\r\n        }),\r\n        this.commonService.getExposedLanguage(),\r\n      ]);\r\n    } catch (error) {\r\n      console.log(error);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  @Watch('contentContainerStyle')\r\n  handleContentContainerStyle() {\r\n    this.modifyContainerStyle();\r\n  }\r\n\r\n  private modifyContainerStyle() {\r\n    if (this.contentContainerStyle && this.contentContainerStyle.borderColor) {\r\n      this.el.style.setProperty('--ir-widget-border-color', this.contentContainerStyle.borderColor);\r\n    }\r\n  }\r\n  handleBooknow() {\r\n    let subdomainURL = `bookingmystay.com`;\r\n    const currentDomain = `${app_store.property.perma_link}.${subdomainURL}`;\r\n    const { from_date, to_date } = this.dates;\r\n    const { adultCount, childrenCount } = this.guests;\r\n    const fromDate = from_date ? `checkin=${format(from_date, 'yyyy-MM-dd')}` : '';\r\n    const toDate = from_date ? `checkout=${format(to_date, 'yyyy-MM-dd')}` : '';\r\n    const adults = adultCount > 0 ? `adults=${adultCount}` : '';\r\n    const children = childrenCount > 0 ? `children=${childrenCount}` : '';\r\n    const roomTypeId = this.roomTypeId ? `rtid=${this.roomTypeId}` : '';\r\n    const queryParams = [fromDate, toDate, adults, children, roomTypeId];\r\n    const queryString = queryParams.filter(param => param !== '').join('&');\r\n    window.open(`https://${currentDomain}?${queryString}`, '_blank');\r\n  }\r\n\r\n  private renderDateTrigger() {\r\n    return (\r\n      <div class=\"date-trigger\" slot=\"trigger\">\r\n        <ir-icons name=\"calendar\" svgClassName=\"size-4\"></ir-icons>\r\n        {this.dates && this.dates.from_date && this.dates.to_date ? (\r\n          <div>\r\n            <p>\r\n              <span>{format(this.dates.from_date, 'MMM dd')}</span>\r\n              <span> - </span>\r\n              <span>{format(this.dates.to_date, 'MMM dd')}</span>\r\n            </p>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <p>Your dates</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n  private renderAdultChildTrigger() {\r\n    const { adultCount, childrenCount } = this.guests;\r\n    return (\r\n      <div class=\"guests-trigger\" slot=\"trigger\">\r\n        <ir-icons name=\"user\" svgClassName=\"size-4\"></ir-icons>\r\n        <p class={'guests'}>\r\n          {adultCount > 0 && (\r\n            <span>\r\n              {adultCount} {adultCount === 1 ? localizedWords.entries.Lcz_Adult : localizedWords.entries.Lcz_Adults}\r\n            </span>\r\n          )}\r\n          {childrenCount > 0 && (\r\n            <span>\r\n              , {childrenCount} {childrenCount === 1 ? localizedWords.entries.Lcz_Child : localizedWords.entries.Lcz_Children}\r\n            </span>\r\n          )}\r\n          {adultCount === 0 && <span>Guests</span>}\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    if (this.isLoading) {\r\n      return null;\r\n    }\r\n    return (\r\n      <Fragment>\r\n        <div class=\"booking-widget-container\" style={this.contentContainerStyle}>\r\n          <ir-popover\r\n            class={'ir-popover'}\r\n            showCloseButton={false}\r\n            placement=\"auto\"\r\n            ref={el => (this.popover = el)}\r\n            onOpenChange={e => {\r\n              this.isPopoverOpen = e.detail;\r\n              if (!this.isPopoverOpen) {\r\n                if (!this.dates.to_date && this.dates.from_date) {\r\n                  this.dates = {\r\n                    ...this.dates,\r\n                    to_date: addDays(this.dates.from_date, 1),\r\n                  };\r\n                }\r\n              }\r\n            }}\r\n          >\r\n            {this.renderDateTrigger()}\r\n            <div slot=\"popover-content\" class=\"popup-container w-full border-0 bg-white p-4 pb-6 shadow-none sm:w-auto sm:border sm:p-4 sm:shadow-sm md:p-6 \">\r\n              <ir-date-range\r\n                minDate={addDays(new Date(), -1)}\r\n                style={{ '--radius': 'var(--ir-widget-radius)' }}\r\n                fromDate={this.dates?.from_date}\r\n                toDate={this.dates?.to_date}\r\n                locale={localization_store.selectedLocale}\r\n                maxSpanDays={5}\r\n                onDateChange={e => {\r\n                  e.stopImmediatePropagation();\r\n                  e.stopPropagation();\r\n                  const { end, start } = e.detail;\r\n                  if (end && this.isPopoverOpen) {\r\n                    this.popover.toggleVisibility();\r\n                  }\r\n                  this.dates = {\r\n                    from_date: start,\r\n                    to_date: end,\r\n                  };\r\n                }}\r\n              ></ir-date-range>\r\n            </div>\r\n          </ir-popover>\r\n          <ir-popover ref={el => (this.guestPopover = el)} class={'ir-popover'} showCloseButton={false} placement=\"auto\">\r\n            {this.renderAdultChildTrigger()}\r\n\r\n            <ir-guest-counter\r\n              slot=\"popover-content\"\r\n              minAdultCount={0}\r\n              maxAdultCount={app_store?.property?.adult_child_constraints.adult_max_nbr}\r\n              maxChildrenCount={app_store?.property?.adult_child_constraints.child_max_nbr}\r\n              childMaxAge={app_store.property?.adult_child_constraints.child_max_age}\r\n              onUpdateCounts={e => (this.guests = e.detail)}\r\n              class={'h-full'}\r\n              onCloseGuestCounter={() => this.guestPopover.toggleVisibility()}\r\n            ></ir-guest-counter>\r\n          </ir-popover>\r\n          <button class=\"btn-flip\" onClick={this.handleBooknow.bind(this)}>\r\n            Book now\r\n          </button>\r\n        </div>\r\n      </Fragment>\r\n    );\r\n  }\r\n}\r\n"]}