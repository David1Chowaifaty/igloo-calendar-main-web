{"version":3,"file":"ir-auth.js","sourceRoot":"","sources":["../../../../../src/components/ir-booking-engine/ir-nav/ir-auth/ir-auth.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, Listen, State, h, Element, Event, EventEmitter, Prop } from '@stencil/core';\r\nimport { TAuthNavigation } from './auth.types';\r\nimport { AuthService } from '@/services/api/auth.service';\r\nimport app_store from '@/stores/app.store';\r\n\r\n@Component({\r\n  tag: 'ir-auth',\r\n  styleUrl: 'ir-auth.css',\r\n  shadow: true,\r\n})\r\nexport class IrAuth {\r\n  @Element() el: HTMLElement;\r\n  @Prop() enableSignUp: boolean = true;\r\n  @State() authState: TAuthNavigation = 'login';\r\n  @State() animationDirection: string = '';\r\n\r\n  @State() signedIn: boolean = false;\r\n\r\n  @Event() closeDialog: EventEmitter<null>;\r\n  @Event() authFinish: EventEmitter<{ state: 'success' | 'failed'; token: string }>;\r\n\r\n  // @Event() onSignIn: EventEmitter;\r\n  // @Event() onSignOut: EventEmitter;\r\n\r\n  private authService = new AuthService();\r\n  // private signInDiv: HTMLDivElement;\r\n  //private googleTrigger: HTMLDivElement;\r\n\r\n  componentWillLoad() {\r\n    this.authService.setToken(app_store.app_data.token);\r\n  }\r\n  componentDidLoad() {\r\n    this.loadGoogleApi();\r\n\r\n    // window.fbAsyncInit = () => {\r\n    //   FB.init({\r\n    //     appId: process.env.FB_APP_ID,\r\n    //     xfbml: true,\r\n    //     version: 'v19.0',\r\n    //   });\r\n\r\n    //   FB.AppEvents.logPageView();\r\n    // };\r\n\r\n    // (function (d, s, id) {\r\n    //   var js,\r\n    //     fjs = d.getElementsByTagName(s)[0];\r\n    //   if (d.getElementById(id)) {\r\n    //     return;\r\n    //   }\r\n    //   js = d.createElement(s);\r\n    //   js.id = id;\r\n    //   js.src = 'https://connect.facebook.net/en_US/sdk.js';\r\n    //   fjs.parentNode.insertBefore(js, fjs);\r\n    // })(document, 'script', 'facebook-jssdk');\r\n  }\r\n  initGoogleAuth = () => {\r\n    window.gapi.load('auth2', () => {\r\n      if (!window.gapi.auth2.getAuthInstance()) {\r\n        window.gapi.auth2\r\n          .init({\r\n            client_id: process.env.GOOGLE_API_KEY,\r\n          })\r\n          .then(() => {\r\n            console.log('Google Auth initialized');\r\n          });\r\n      }\r\n    });\r\n  };\r\n  loadGoogleApi() {\r\n    // const script = document.createElement('script');\r\n    // script.src = 'https://accounts.google.com/gsi/client';\r\n    // script.async;\r\n    // script.defer;\r\n    // script.onload = () => {\r\n    //   window.gapi.load('auth2', () => {\r\n    //     window.gapi.auth2\r\n    //       .init({\r\n    //         client_id: '1035240403483-60urt17notg4vmvjbq739p0soqup0o87.apps.googleusercontent.com',\r\n    //       })\r\n    //       .catch(error => {\r\n    //         console.error('Error initializing Google Auth:', error);\r\n    //       });\r\n    //   });\r\n    // };\r\n    // const div1 = document.createElement('div');\r\n    // div1.id = 'g_id_onload';\r\n    // div1.setAttribute('data-client_id', '1035240403483-60urt17notg4vmvjbq739p0soqup0o87.apps.googleusercontent.com');\r\n    // div1.setAttribute('data-callback', 'handleCredentialResponse');\r\n    // div1.setAttribute('data-auto_prompt', 'false');\r\n    // this.signInDiv = document.createElement('div');\r\n    // this.signInDiv.className = 'g_id_signin';\r\n    // // this.signInDiv.style.display = 'none'; // Initially hidden\r\n    // this.signInDiv.setAttribute('data-type', 'standard');\r\n\r\n    // this.el.appendChild(script);\r\n    // this.el.appendChild(div1);\r\n    // this.el.appendChild(this.signInDiv);\r\n\r\n    // (window as any).google.accounts.id.initialize({\r\n    //   client_id: '1035240403483-60urt17notg4vmvjbq739p0soqup0o87.apps.googleusercontent.com',\r\n    //   // callback: handleCredentialResponse\r\n    // });\r\n    // (window as any).google.accounts.id.renderButton(\r\n    //   this.googleTrigger,\r\n    //   { theme: 'outline', size: 'large' }, // customization attributes\r\n    // );\r\n    // (window as any).google.accounts.id.prompt();\r\n    window.onload = function () {\r\n      // also display the One Tap dialog\r\n    };\r\n\r\n    // window.onload = function () {\r\n    //   google.accounts.id.initialize({\r\n    //     client_id: 'YOUR_GOOGLE_CLIENT_ID',\r\n    //     callback: handleCredentialResponse\r\n    //   });\r\n    //   google.accounts.id.prompt();\r\n    // };\r\n  }\r\n\r\n  handleSignIn = () => {\r\n    // if (window.gapi && window.gapi.auth2) {\r\n    //   const auth2 = window.gapi.auth2.getAuthInstance();\r\n    //   if (auth2) {\r\n    //     this.signInDiv.style.display = 'block';\r\n    //     auth2\r\n    //       .signIn()\r\n    //       .then(googleUser => {\r\n    //         this.signedIn = true;\r\n    //         this.onSignIn.emit(googleUser.getBasicProfile());\r\n    //         this.signInDiv.style.display = 'none';\r\n    //       })\r\n    //       .catch(error => {\r\n    //         console.error('Error signing in', error);\r\n    //         this.signInDiv.style.display = 'none';\r\n    //       });\r\n    //   } else {\r\n    //     console.error('Google Auth instance not available.');\r\n    //   }\r\n    // } else {\r\n    //   console.error('Google API not loaded.');\r\n    // }\r\n  };\r\n\r\n  handleSignOut = () => {\r\n    const auth2 = window.gapi.auth2.getAuthInstance();\r\n    auth2.signOut().then(() => {\r\n      this.signedIn = false;\r\n      // this.onSignOut.emit();\r\n    });\r\n  };\r\n\r\n  async loginWithFacebook() {\r\n    FB.login(response => {\r\n      if (response.authResponse) {\r\n        console.log('Welcome!  Fetching your information.... ');\r\n        FB.api('/me', response => {\r\n          console.log('Good to see you, ' + response.name + '.', response);\r\n        });\r\n      } else {\r\n        console.log('User cancelled login or did not fully authorize.');\r\n      }\r\n    });\r\n    FB.getLoginStatus(response => {\r\n      console.log('login status', response);\r\n    });\r\n  }\r\n\r\n  @Listen('navigate')\r\n  handleNavigation(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n\r\n    if (this.authState === 'login' && e.detail !== 'login') {\r\n      this.animationDirection = 'slide-right';\r\n    } else if (this.authState !== 'login' && e.detail === 'login') {\r\n      this.animationDirection = 'slide-left';\r\n    }\r\n\r\n    this.authState = e.detail;\r\n  }\r\n\r\n  signUp(params: { email?: string; password?: string; first_name?: string; last_name?: string }) {\r\n    try {\r\n      const res = this.authService.signUp(params);\r\n      console.log(res);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div class={`auth-container ${this.animationDirection} p-4 sm:p-6`}>\r\n          {/* <div id=\"buttonDiv\" ref={el => (this.googleTrigger = el)}></div> */}\r\n          {this.authState === 'login' ? (\r\n            <ir-signin\r\n              enableSignUp={this.enableSignUp}\r\n              onSignIn={e => {\r\n                if (e.detail.trigger === 'fb') {\r\n                  return this.loginWithFacebook();\r\n                } else if (e.detail.trigger === 'google') {\r\n                  return this.handleSignIn();\r\n                }\r\n              }}\r\n            ></ir-signin>\r\n          ) : (\r\n            <ir-signup\r\n              onSignUp={e => {\r\n                if (e.detail.trigger === 'be') {\r\n                  return this.signUp(e.detail.params);\r\n                } else if (e.detail.trigger === 'fb') {\r\n                  return this.loginWithFacebook();\r\n                }\r\n                return this.handleSignIn();\r\n              }}\r\n            ></ir-signup>\r\n          )}\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}