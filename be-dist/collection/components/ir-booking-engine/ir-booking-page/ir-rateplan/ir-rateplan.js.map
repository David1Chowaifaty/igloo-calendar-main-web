{"version":3,"file":"ir-rateplan.js","sourceRoot":"","sources":["../../../../../src/components/ir-booking-engine/ir-booking-page/ir-rateplan/ir-rateplan.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\r\nimport { RatePlan, Variation } from '@/models/property';\r\nimport app_store from '@/stores/app.store';\r\nimport booking_store, { IRatePlanSelection, reserveRooms, updateRoomParams } from '@/stores/booking';\r\nimport { formatAmount, getDateDifference } from '@/utils/utils';\r\nimport localizedWords from '@/stores/localization.store';\r\nimport { v4 } from 'uuid';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport { format } from 'date-fns';\r\nimport { AvailabiltyService } from '@/services/app/availability.service';\r\nimport { PaymentService } from '@/services/api/payment.service';\r\n@Component({\r\n  tag: 'ir-rateplan',\r\n  styleUrl: 'ir-rateplan.css',\r\n  shadow: true,\r\n})\r\nexport class IrRateplan {\r\n  @Prop() ratePlan: RatePlan;\r\n  @Prop() visibleInventory?:\r\n    | IRatePlanSelection\r\n    | {\r\n        reserved: number;\r\n        visibleInventory?: number;\r\n        selected_variation: any;\r\n      };\r\n  @Prop() roomTypeInventory: number;\r\n  @Prop() roomTypeId: number;\r\n\r\n  @State() isLoading = false;\r\n  @State() cancelationMessage = '';\r\n  @State() isRatePlanAvailable: boolean = true;\r\n\r\n  @Event() animateBookingButton: EventEmitter<null>;\r\n\r\n  private propertyService = new PropertyService();\r\n  private availabilityService = new AvailabiltyService();\r\n  private paymentService = new PaymentService();\r\n\r\n  componentWillLoad() {\r\n    this.propertyService.setToken(app_store.app_data.token);\r\n    this.paymentService.setToken(app_store.app_data.token);\r\n    this.checkAvailability();\r\n  }\r\n  @Watch('roomTypeInventory')\r\n  handleRTICHange(newValue: number, oldValue: number) {\r\n    if (newValue === oldValue) {\r\n      return null;\r\n    }\r\n    this.checkAvailability();\r\n  }\r\n  checkAvailability() {\r\n    this.isRatePlanAvailable = this.roomTypeInventory > 0 && !this.ratePlan.variations.some(v => v.is_calculated && (v.amount === 0 || v.amount === null));\r\n    // this.isRatePlanAvailable = this.roomTypeInventory > 0;\r\n  }\r\n  async handleVariationChange(e: CustomEvent, variations: Variation[], rateplanId: number, roomTypeId: number) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const value = e.detail;\r\n    let selectedVariation = variations[value];\r\n    console.log(selectedVariation);\r\n    if (!selectedVariation) {\r\n      return;\r\n    }\r\n    if (!selectedVariation.amount) {\r\n      this.isLoading = true;\r\n      await this.updateVariation({\r\n        adult_nbr: selectedVariation.adult_nbr,\r\n        child_nbr: selectedVariation.child_nbr,\r\n        rp_id: rateplanId,\r\n        rt_id: roomTypeId,\r\n        adultChildConstraint: selectedVariation.adult_child_offering,\r\n      });\r\n      this.isLoading = false;\r\n    }\r\n    selectedVariation = booking_store.roomTypes.find(rt => rt.id === roomTypeId).rateplans.find(rp => rp.id === rateplanId).variations[value];\r\n    updateRoomParams({ params: { selected_variation: { variation: selectedVariation, state: 'modified' } }, ratePlanId: rateplanId, roomTypeId });\r\n  }\r\n  async updateVariation(params: { adult_nbr: number; child_nbr: number; rt_id: number; rp_id: number; adultChildConstraint: string }) {\r\n    const identifier = v4();\r\n    this.availabilityService.initSocket(identifier, true);\r\n    await this.propertyService.getExposedBookingAvailability({\r\n      params: {\r\n        propertyid: app_store.app_data.property_id,\r\n        from_date: format(booking_store.bookingAvailabilityParams.from_date, 'yyyy-MM-dd'),\r\n        to_date: format(booking_store.bookingAvailabilityParams.to_date, 'yyyy-MM-dd'),\r\n        room_type_ids: [],\r\n        adult_nbr: params.adult_nbr,\r\n        child_nbr: params.child_nbr,\r\n        language: app_store.userPreferences.language_id,\r\n        currency_ref: app_store.userPreferences.currency_id,\r\n        is_in_loyalty_mode: booking_store.bookingAvailabilityParams.loyalty ? true : !!booking_store.bookingAvailabilityParams.coupon,\r\n        promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n        is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n        agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n      },\r\n      identifier,\r\n      mode: 'modify_rt',\r\n      rp_id: params.rp_id,\r\n      rt_id: params.rt_id,\r\n      adultChildConstraint: params.adultChildConstraint,\r\n    });\r\n  }\r\n  render() {\r\n    // console.log('ratePlan', this.ratePlan);\r\n    return (\r\n      <div class=\"rateplan-container\">\r\n        <div class={`rateplan-header ${this.isRatePlanAvailable ? 'available' : 'not-available'}`}>\r\n          <p class=\"rateplan-name\">\r\n            <span class=\"rateplan-short-name\">{this.ratePlan.short_name}</span>\r\n            <span class=\"rateplan-custom-text rateplan-custom-text-hidden\">{this.ratePlan.custom_text}</span>\r\n          </p>\r\n          {this.isLoading ? (\r\n            <div class=\"grid place-items-center md:hidden\">\r\n              <div class=\"h-4 w-12 animate-pulse rounded-md bg-gray-300\"></div>\r\n            </div>\r\n          ) : (\r\n            <Fragment>\r\n              {this.isRatePlanAvailable ? (\r\n                !this.visibleInventory?.selected_variation?.variation?.IS_MLS_VIOLATED && (\r\n                  <div class=\"rateplan-pricing-mobile\">\r\n                    <p class=\"rateplan-amount\">{formatAmount(this.visibleInventory?.selected_variation?.variation?.amount, app_store.userPreferences.currency_id, 0)}</p>\r\n                    {this.visibleInventory?.selected_variation?.variation?.discount_pct > 0 && (\r\n                      <p class=\"rateplan-discounted-amount\">\r\n                        {formatAmount(this.visibleInventory?.selected_variation?.variation?.total_before_discount, app_store.userPreferences.currency_id, 0)}\r\n                      </p>\r\n                    )}\r\n                  </div>\r\n                )\r\n              ) : (\r\n                <p class=\"no-availability\">Not available</p>\r\n              )}\r\n            </Fragment>\r\n          )}\r\n        </div>\r\n\r\n        <p class=\"rateplan-custom-text rateplan-custom-text-mobile\">{this.ratePlan.custom_text}</p>\r\n\r\n        {this.isRatePlanAvailable && (\r\n          <div class={`rateplan-details ${this.ratePlan.custom_text ? 'rateplan-details-no-custom-text' : ''}`}>\r\n            {this.isLoading ? (\r\n              <div class=\"col-span-6 w-full \">\r\n                <div class=\"h-8 w-full animate-pulse rounded-md  bg-gray-300\"></div>\r\n              </div>\r\n            ) : (\r\n              <Fragment>\r\n                <div class=\"rateplan-travelers\">\r\n                  {this.ratePlan.variations && (\r\n                    <ir-select\r\n                      class=\"rateplan-select-travelers\"\r\n                      label={localizedWords.entries.Lcz_Travelers}\r\n                      value={this.ratePlan.variations\r\n                        .findIndex(f => f.adult_child_offering === this.visibleInventory?.selected_variation?.variation.adult_child_offering)\r\n                        .toString()}\r\n                      onValueChange={e => {\r\n                        this.handleVariationChange(e, this.ratePlan.variations, this.ratePlan.id, this.roomTypeId);\r\n                      }}\r\n                      data={this.ratePlan.variations.map((v, i) => ({\r\n                        id: i.toString(),\r\n                        value: v.adult_child_offering,\r\n                      }))}\r\n                    ></ir-select>\r\n                  )}\r\n                  <div class=\"rateplan-cancellation gap-2.5\">\r\n                    {this.ratePlan.is_non_refundable ? (\r\n                      <p class=\"text-xs text-green-500\">Non refundable</p>\r\n                    ) : (\r\n                      <div class=\"flex items-center gap-[2px] \">\r\n                        {/* <p class=\"rateplan-cancellation-text\">If I cancel?</p> */}\r\n                        <ir-tooltip\r\n                          labelColors={booking_store.isInFreeCancelationZone ? 'green' : 'default'}\r\n                          class={`rateplan-tooltip `}\r\n                          open_behavior=\"click\"\r\n                          label={booking_store.isInFreeCancelationZone ? 'Free cancellation' : 'If I cancel?'}\r\n                          message={(this.cancelationMessage || this.ratePlan.cancelation) + this.ratePlan.guarantee}\r\n                          onTooltipOpenChange={e => {\r\n                            if (e.detail && !this.cancelationMessage) {\r\n                              this.fetchCancelationMessage(this.ratePlan.id, this.roomTypeId);\r\n                            }\r\n                          }}\r\n                        ></ir-tooltip>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                {!this.visibleInventory?.selected_variation?.variation?.IS_MLS_VIOLATED ? (\r\n                  <Fragment>\r\n                    {this.visibleInventory?.selected_variation?.variation?.discount_pct > 0 && (\r\n                      <div class=\"rateplan-pricing\">\r\n                        <p class=\"rateplan-discounted-amount\">\r\n                          {formatAmount(this.visibleInventory?.selected_variation?.variation?.total_before_discount, app_store.userPreferences.currency_id, 0)}\r\n                        </p>\r\n                        <p class=\"rateplan-discount\">{`-${this.visibleInventory?.selected_variation?.variation?.discount_pct}%`}</p>\r\n                      </div>\r\n                    )}\r\n                    <div class=\"rateplan-final-pricing\">\r\n                      <p class=\"rateplan-amount\">{formatAmount(this.visibleInventory?.selected_variation?.variation?.amount, app_store.userPreferences.currency_id, 0)}</p>\r\n                      {getDateDifference(booking_store.bookingAvailabilityParams.from_date ?? new Date(), booking_store.bookingAvailabilityParams.to_date ?? new Date()) > 1 && (\r\n                        <p class=\"rateplan-amount-per-night\">{`${formatAmount(this.visibleInventory?.selected_variation?.variation?.amount_per_night, app_store.userPreferences.currency_id, 0)}/${localizedWords.entries.Lcz_night}`}</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    <ir-select\r\n                      onValueChange={e => {\r\n                        reserveRooms(this.roomTypeId, this.ratePlan.id, Number(e.detail));\r\n                        this.animateBookingButton.emit(null);\r\n                      }}\r\n                      label={localizedWords.entries.Lcz_Rooms}\r\n                      value={this.visibleInventory?.reserved}\r\n                      class=\"rateplan-select-rooms\"\r\n                      data={[...new Array(this.roomTypeInventory + 1)]?.map((_, i) => ({\r\n                        id: i,\r\n                        value:\r\n                          i === 0\r\n                            ? `${localizedWords.entries.Lcz_Select}`\r\n                            : `${i}&nbsp;&nbsp;&nbsp;${i === 0 ? '' : formatAmount(this.visibleInventory?.selected_variation?.variation?.amount * i, app_store.userPreferences.currency_id, 0)}`,\r\n                        disabled: i >= this.visibleInventory?.visibleInventory + 1,\r\n                        html: true,\r\n                      }))}\r\n                    ></ir-select>\r\n                  </Fragment>\r\n                ) : (\r\n                  <p class=\"mls_alert\">{this.visibleInventory.selected_variation?.variation?.MLS_ALERT}</p>\r\n                )}\r\n              </Fragment>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n  async fetchCancelationMessage(id: number, roomTypeId: number) {\r\n    const result = await this.paymentService.GetExposedApplicablePolicies({\r\n      book_date: new Date(),\r\n      params: {\r\n        booking_nbr: booking_store.fictus_booking_nbr?.nbr,\r\n        currency_id: app_store.currencies.find(c => c.code.toLowerCase() === (app_store.userPreferences.currency_id.toLowerCase() || 'usd')).id,\r\n        language: app_store.userPreferences.language_id,\r\n        property_id: app_store.app_data.property_id,\r\n        rate_plan_id: id,\r\n        room_type_id: roomTypeId,\r\n      },\r\n      token: app_store.app_data.token,\r\n    });\r\n    const message = result.data.find(t => t.type === 'cancelation')?.combined_statement;\r\n    this.cancelationMessage = message ? `<b><u>Cancellation:</u></b>${message}<br/>` : '<span></span>';\r\n    console.log(result);\r\n  }\r\n}\r\n"]}