{"version":3,"file":"ir-coupon-dialog.js","sourceRoot":"","sources":["../../../../../../src/components/ir-booking-engine/ir-booking-page/ir-availibility-header/ir-coupon-dialog/ir-coupon-dialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import app_store from '@/stores/app.store';\r\nimport booking_store, { modifyBookingStore } from '@/stores/booking';\r\nimport { cn } from '@/utils/utils';\r\nimport { Component, Fragment, h, State, Event, EventEmitter } from '@stencil/core';\r\nimport { isBefore } from 'date-fns';\r\n\r\n@Component({\r\n  tag: 'ir-coupon-dialog',\r\n  styleUrl: 'ir-coupon-dialog.css',\r\n  shadow: true,\r\n})\r\nexport class IrCouponDialog {\r\n  @State() coupon: string;\r\n  @State() validationMessage: { error: boolean; message: string };\r\n\r\n  @Event() resetBooking: EventEmitter<null>;\r\n\r\n  dialogRef: HTMLIrDialogElement;\r\n\r\n  activateCoupon() {\r\n    this.validationMessage = null;\r\n    const c = app_store.property.promotions.find(p => p.key === this.coupon.trim());\r\n    if (!c) {\r\n      return (this.validationMessage = { error: true, message: 'Invalid coupon' });\r\n    }\r\n    if (isBefore(new Date(c.to), new Date())) {\r\n      return (this.validationMessage = { error: true, message: 'Invalid coupon' });\r\n    }\r\n    modifyBookingStore('bookingAvailabilityParams', {\r\n      coupon: this.coupon,\r\n      loyalty: false,\r\n    });\r\n    this.validationMessage = { error: false, message: this.coupon };\r\n    this.resetBooking.emit(null);\r\n    this.dialogRef.closeModal();\r\n  }\r\n  removeCoupon() {\r\n    this.validationMessage = null;\r\n    this.coupon = '';\r\n    modifyBookingStore('bookingAvailabilityParams', {\r\n      coupon: null,\r\n      loyalty: false,\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const showCoupon = app_store.property?.promotions?.some(p => p.key !== '');\r\n    if (!showCoupon || booking_store.bookingAvailabilityParams.loyalty) {\r\n      return null;\r\n    }\r\n    return (\r\n      <Fragment>\r\n        <div class=\"flex items-center w-full gap-4 justify-center\">\r\n          <ir-button\r\n            class={cn('w-full', {\r\n              'w-fit': this.validationMessage && !this.validationMessage.error,\r\n            })}\r\n            onButtonClick={() => this.dialogRef.openModal()}\r\n            variants=\"outline\"\r\n            label=\"Have a coupon?\"\r\n            haveLeftIcon\r\n          >\r\n            <ir-icons slot=\"left-icon\" name=\"heart\"></ir-icons>\r\n          </ir-button>\r\n          {this.validationMessage && !this.validationMessage.error && (\r\n            <div class=\"flex items-center  text-sm text-[hsl(var(--brand-600))]\">\r\n              <p onClick={this.removeCoupon.bind(this)}>Discount applied</p>\r\n              <ir-button aria-label=\"remove coupon\" variants=\"icon\" onButtonClick={this.removeCoupon.bind(this)}>\r\n                <ir-icons slot=\"btn-icon\" title=\"remove coupon\" name=\"xmark\" svgClassName=\"text-[hsl(var(--brand-600))]\"></ir-icons>\r\n              </ir-button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <ir-dialog ref={el => (this.dialogRef = el)}>\r\n          <form\r\n            onSubmit={e => {\r\n              e.preventDefault();\r\n              this.activateCoupon();\r\n            }}\r\n            class=\"p-4 sm:p-6\"\r\n            slot=\"modal-body\"\r\n          >\r\n            <h1 class=\"title\">Have a coupon? </h1>\r\n            <p class=\"Supporting-text mb-8\">If you have a coupon available, you can enter it below to unlock special discounts:</p>\r\n            <ir-input\r\n              error={this.validationMessage?.error}\r\n              onTextChanged={e => (this.coupon = e.detail)}\r\n              autofocus\r\n              inputId=\"booking_code\"\r\n              label=\"Enter your coupon code\"\r\n            ></ir-input>\r\n            {this.validationMessage?.error && <p class=\"text-red-500\">{this.validationMessage.message}</p>}\r\n            <div class=\"flex flex-col-reverse items-center justify-end mt-8 gap-4 sm:flex-row\">\r\n              <ir-button\r\n                size=\"md\"\r\n                onButtonClick={() => {\r\n                  this.dialogRef.closeModal();\r\n                }}\r\n                variants=\"outline\"\r\n                label=\"Cancel\"\r\n                class={'w-full sm:w-fit'}\r\n              ></ir-button>\r\n              <ir-button type=\"submit\" size=\"md\" label=\"Apply\" class=\"w-full sm:w-fit\"></ir-button>\r\n            </div>\r\n          </form>\r\n        </ir-dialog>\r\n      </Fragment>\r\n    );\r\n  }\r\n}\r\n"]}