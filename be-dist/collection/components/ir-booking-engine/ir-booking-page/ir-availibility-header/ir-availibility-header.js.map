{"version":3,"file":"ir-availibility-header.js","sourceRoot":"","sources":["../../../../../src/components/ir-booking-engine/ir-booking-page/ir-availibility-header/ir-availibility-header.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, h, Listen, Prop, State, Watch } from '@stencil/core';\r\nimport { ExposedBookingAvailability, TExposedBookingAvailability } from './availability';\r\nimport { format } from 'date-fns';\r\nimport { ZodError } from 'zod';\r\nimport { onAppDataChange } from '@/stores/app.store';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport app_store from '@/stores/app.store';\r\nimport booking_store from '@/stores/booking';\r\nimport { v4 } from 'uuid';\r\nimport { AvailabiltyService } from '@/services/app/availability.service';\r\n\r\n@Component({\r\n  tag: 'ir-availibility-header',\r\n  styleUrl: 'ir-availibility-header.css',\r\n  shadow: true,\r\n})\r\nexport class IrAvailibilityHeader {\r\n  @Prop() fromDate: string;\r\n  @Prop() toDate: string;\r\n  @Prop() adultCount: string;\r\n  @Prop() childrenCount: string;\r\n\r\n  @State() exposedBookingAvailabiltyParams: TExposedBookingAvailability = {\r\n    adult_nbr: 0,\r\n    child_nbr: 0,\r\n    currency_ref: 'USD',\r\n    language: 'en',\r\n    room_type_ids: [],\r\n    propertyid: 42,\r\n    is_in_loyalty_mode: booking_store.bookingAvailabilityParams.loyalty ? true : !!booking_store.bookingAvailabilityParams.coupon,\r\n    promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n    is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n    agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n  };\r\n  @State() target: HTMLElement = null;\r\n\r\n  @State() errorCause: ('date' | 'adult_child')[] | null = null;\r\n  @State() isLoading = false;\r\n\r\n  @Event() resetBooking: EventEmitter<null>;\r\n  @Event() scrollToRoomType: EventEmitter<null>;\r\n\r\n  private popoverInstance = null;\r\n  private toast_timeout: NodeJS.Timeout;\r\n  private identifier: string;\r\n\r\n  private propertyService = new PropertyService();\r\n  private availabiltyService = new AvailabiltyService();\r\n\r\n  // private popperInstance: any;\r\n  // private personCounter: HTMLIrAdultChildCounterElement;\r\n\r\n  componentWillLoad() {\r\n    const { token, property_id } = app_store.app_data;\r\n    this.propertyService.setToken(token);\r\n    this.availabiltyService.subscribe(() => this.disableLoading());\r\n    this.exposedBookingAvailabiltyParams = {\r\n      ...this.exposedBookingAvailabiltyParams,\r\n      adult_nbr: +this.adultCount || 0,\r\n      child_nbr: +this.childrenCount || 0,\r\n      from_date: this.fromDate,\r\n      to_date: this.toDate,\r\n    };\r\n    if (booking_store.bookingAvailabilityParams.from_date) {\r\n      this.exposedBookingAvailabiltyParams.from_date = format(booking_store.bookingAvailabilityParams.from_date, 'yyyy-MM-dd');\r\n      this.exposedBookingAvailabiltyParams.to_date = format(booking_store.bookingAvailabilityParams.to_date, 'yyyy-MM-dd');\r\n    }\r\n    if (booking_store.bookingAvailabilityParams.adult_nbr) {\r\n      this.exposedBookingAvailabiltyParams.adult_nbr = booking_store.bookingAvailabilityParams.adult_nbr;\r\n      this.exposedBookingAvailabiltyParams.child_nbr = booking_store.bookingAvailabilityParams.child_nbr;\r\n    }\r\n    this.changeExposedAvailabilityParams({\r\n      propertyid: property_id,\r\n      language: app_store.userPreferences.language_id,\r\n      currency_ref: app_store.userPreferences.currency_id,\r\n    });\r\n    onAppDataChange('userPreferences', async newValue => {\r\n      this.changeExposedAvailabilityParams({\r\n        language: newValue.language_id,\r\n        currency_ref: newValue.currency_id,\r\n      });\r\n      try {\r\n        if (app_store.currentPage === 'booking') {\r\n          this.resetBooking.emit(null);\r\n        }\r\n      } catch (error) {}\r\n    });\r\n    if (this.fromDate && this.toDate && this.adultCount) {\r\n      this.checkAvailability();\r\n    }\r\n  }\r\n\r\n  disableLoading() {\r\n    if (this.isLoading) {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n  @Watch('fromDate')\r\n  handleFromDateChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.exposedBookingAvailabiltyParams = {\r\n        ...this.exposedBookingAvailabiltyParams,\r\n        from_date: newValue,\r\n      };\r\n      if (this.fromDate && this.toDate && this.adultCount) {\r\n        this.checkAvailability();\r\n      }\r\n    }\r\n  }\r\n  @Watch('toDate')\r\n  handleToDateChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.exposedBookingAvailabiltyParams = {\r\n        ...this.exposedBookingAvailabiltyParams,\r\n        to_date: newValue,\r\n      };\r\n      if (this.fromDate && this.toDate && this.adultCount) {\r\n        this.checkAvailability();\r\n      }\r\n    }\r\n  }\r\n  @Watch('childrenCount')\r\n  handleChildrenCountChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.exposedBookingAvailabiltyParams = {\r\n        ...this.exposedBookingAvailabiltyParams,\r\n        child_nbr: +newValue,\r\n      };\r\n      if (this.fromDate && this.toDate && this.adultCount) {\r\n        this.checkAvailability();\r\n      }\r\n    }\r\n  }\r\n  @Watch('adultCount')\r\n  handleAdultCountChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.exposedBookingAvailabiltyParams = {\r\n        ...this.exposedBookingAvailabiltyParams,\r\n        adult_nbr: +newValue,\r\n      };\r\n      if (this.fromDate && this.toDate && this.adultCount) {\r\n        this.checkAvailability();\r\n      }\r\n    }\r\n  }\r\n\r\n  async checkAvailability() {\r\n    const params = ExposedBookingAvailability.parse(this.exposedBookingAvailabiltyParams);\r\n    this.identifier = v4();\r\n    this.availabiltyService.initSocket(this.identifier);\r\n    booking_store.bookingAvailabilityParams = {\r\n      ...booking_store.bookingAvailabilityParams,\r\n      from_date: new Date(params.from_date),\r\n      to_date: new Date(params.to_date),\r\n      adult_nbr: params.adult_nbr,\r\n      child_nbr: params.child_nbr,\r\n    };\r\n    await this.propertyService.getExposedBookingAvailability({\r\n      params: {\r\n        ...this.exposedBookingAvailabiltyParams,\r\n        promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n        is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n        agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n        is_in_loyalty_mode: booking_store.bookingAvailabilityParams.loyalty ? true : !!booking_store.bookingAvailabilityParams.coupon,\r\n      },\r\n      identifier: this.identifier,\r\n      mode: 'default',\r\n    });\r\n  }\r\n\r\n  async handleCheckAvailability() {\r\n    try {\r\n      this.isLoading = true;\r\n      if (window.innerWidth < 640) {\r\n        this.scrollToRoomType.emit(null);\r\n      }\r\n      await this.checkAvailability();\r\n      app_store.fetchedBooking = true;\r\n    } catch (error) {\r\n      if (error instanceof ZodError) {\r\n        console.log(error.errors);\r\n        for (const err of error.errors) {\r\n          if (!this.errorCause) {\r\n            this.errorCause = [];\r\n          }\r\n          const error_cause = err.path[0].toString();\r\n\r\n          if (error_cause.includes('date') && !this.errorCause.find(c => c === 'date')) {\r\n            this.errorCause.push('date');\r\n          }\r\n          if (error_cause.includes('nbr')) {\r\n            this.errorCause.push('adult_child');\r\n          }\r\n        }\r\n      }\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  changeExposedAvailabilityParams(params: Partial<TExposedBookingAvailability>) {\r\n    this.exposedBookingAvailabiltyParams = {\r\n      ...this.exposedBookingAvailabiltyParams,\r\n      ...params,\r\n    };\r\n  }\r\n\r\n  @Listen('dateChange')\r\n  handleDateChange(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const { start, end } = e.detail;\r\n    if (end) {\r\n      this.changeExposedAvailabilityParams({\r\n        from_date: format(start, 'yyyy-MM-dd').toString(),\r\n        to_date: format(end, 'yyyy-MM-dd').toString(),\r\n      });\r\n    } else if (this.exposedBookingAvailabiltyParams.to_date && !end) {\r\n      this.changeExposedAvailabilityParams({\r\n        from_date: format(start, 'yyyy-MM-dd').toString(),\r\n        to_date: null,\r\n      });\r\n    } else {\r\n      this.changeExposedAvailabilityParams({ from_date: format(start, 'yyyy-MM-dd') });\r\n    }\r\n  }\r\n\r\n  @Listen('addAdultsAndChildren')\r\n  handleAdultChildChange(e: CustomEvent) {\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n    this.changeExposedAvailabilityParams({ ...e.detail });\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this.popoverInstance) {\r\n      this.popoverInstance.destroy();\r\n    }\r\n    if (this.toast_timeout) {\r\n      clearTimeout(this.toast_timeout);\r\n    }\r\n    this.availabiltyService.unsubscribe(() => this.disableLoading());\r\n    this.availabiltyService.disconnectSocket();\r\n  }\r\n  shouldRenderErrorToast() {\r\n    // Check for date-related errors\r\n    if (this.errorCause?.find(c => c === 'date') !== undefined) {\r\n      // Both dates must be present to clear the error\r\n      if (this.exposedBookingAvailabiltyParams.from_date && this.exposedBookingAvailabiltyParams.to_date) {\r\n        this.errorCause = this.errorCause?.filter(c => c !== 'date');\r\n      }\r\n    }\r\n\r\n    // Check for adult/child count related errors\r\n    if (this.errorCause?.find(c => c === 'adult_child')) {\r\n      // There must be at least one adult to clear the error\r\n      if (this.exposedBookingAvailabiltyParams.adult_nbr > 0) {\r\n        this.errorCause = this.errorCause?.filter(c => c !== 'adult_child');\r\n      }\r\n    }\r\n    return this.errorCause?.length > 0;\r\n  }\r\n\r\n  render() {\r\n    this.shouldRenderErrorToast();\r\n    return (\r\n      <div class=\"availability-container\">\r\n        <div class=\"availability-inputs\">\r\n          <ir-date-popup\r\n            data-state={this.errorCause?.find(c => c === 'date') ? 'error' : ''}\r\n            dates={{\r\n              start: this.exposedBookingAvailabiltyParams?.from_date ? new Date(this.exposedBookingAvailabiltyParams.from_date) : null,\r\n              end: this.exposedBookingAvailabiltyParams?.to_date ? new Date(this.exposedBookingAvailabiltyParams.to_date) : null,\r\n            }}\r\n            class=\"date-popup\"\r\n          ></ir-date-popup>\r\n          <div class=\"availability-controls\">\r\n            <ir-adult-child-counter\r\n              data-state={this.errorCause?.find(c => c === 'adult_child') ? 'error' : ''}\r\n              adultCount={this.exposedBookingAvailabiltyParams.adult_nbr}\r\n              childrenCount={this.exposedBookingAvailabiltyParams.child_nbr}\r\n              minAdultCount={0}\r\n              maxAdultCount={app_store.property.adult_child_constraints.adult_max_nbr}\r\n              maxChildrenCount={app_store.property.adult_child_constraints.child_max_nbr}\r\n              childMaxAge={app_store.property.adult_child_constraints.child_max_age}\r\n              class=\"adult-child-counter\"\r\n              // ref={el => (this.personCounter = el)}\r\n            ></ir-adult-child-counter>\r\n            <ir-button\r\n              isLoading={this.isLoading}\r\n              onButtonClick={e => {\r\n                e.stopImmediatePropagation();\r\n                e.stopPropagation();\r\n                this.handleCheckAvailability();\r\n              }}\r\n              size=\"pill\"\r\n              variants=\"icon-primary\"\r\n              iconName=\"search\"\r\n            ></ir-button>\r\n          </div>\r\n          {/* <ir-button\r\n              isLoading={this.isLoading}\r\n              onButtonClick={e => {\r\n                e.stopImmediatePropagation();\r\n                e.stopPropagation();\r\n                this.handleCheckAvailability();\r\n              }}\r\n              size=\"lg\"\r\n              label=\"search\"\r\n              class=\"full-width-on-mobile\"\r\n            ></ir-button> */}\r\n        </div>\r\n\r\n        {app_store?.property?.promotions && (\r\n          <div class=\"promotions-container\">\r\n            <ir-coupon-dialog class=\"coupon-dialog\"></ir-coupon-dialog>\r\n            <ir-loyalty class=\"loyalty\"></ir-loyalty>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]}