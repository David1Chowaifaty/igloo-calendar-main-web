{"version":3,"file":"ir-booking-engine.js","sourceRoot":"","sources":["../../../src/components/ir-booking-engine/ir-booking-engine.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,aAAa,EAAE,MAAM,+BAA+B,CAAC;AAC9D,OAAO,EAAE,eAAe,EAAE,MAAM,iCAAiC,CAAC;AAClE,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,eAAe,CAAC;AACzE,OAAO,EAAE,MAAM,EAAU,MAAM,UAAU,CAAC;AAE1C,OAAO,KAAK,MAAM,OAAO,CAAC;AAE1B,OAAO,aAAa,EAAE,EAAE,gBAAgB,EAAE,MAAM,kBAAkB,CAAC;AACnE,OAAO,SAAS,MAAM,oBAAoB,CAAC;AAC3C,OAAO,EAAE,mBAAmB,EAAE,gBAAgB,EAAE,gBAAgB,EAAE,MAAM,eAAe,CAAC;AACxF,OAAO,KAAK,MAAM,gBAAgB,CAAC;AACnC,sCAAsC;AAMtC,MAAM,OAAO,eAAe;;QAalB,kBAAa,GAAG,IAAI,aAAa,EAAE,CAAC;QACpC,oBAAe,GAAG,IAAI,eAAe,EAAE,CAAC;qBAZ9C,myBAAmyB;;;;2BAIvwB,IAAI;;;;yBAKJ,KAAK;sBAKjB,IAAI,KAAK,EAAe;;IAE1C,KAAK,CAAC,iBAAiB;QACrB,KAAK,CAAC,QAAQ,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC;QACtC,gBAAgB,EAAE,CAAC;QACnB,IAAI,CAAC,KAAK,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,UAAU,EAAE,CAAC;QACnD,2BAA2B;QAC3B,0BAA0B;QAC1B,IAAI;QACJ,yDAAyD;IAC3D,CAAC;IAED,iBAAiB,CAAC,QAAgB,EAAE,QAAgB;QAClD,IAAI,QAAQ,KAAK,QAAQ,EAAE,CAAC;YAC1B,IAAI,CAAC,aAAa,EAAE,CAAC;QACvB,CAAC;IACH,CAAC;IACD,aAAa;QACX,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACxC,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC1C,SAAS,CAAC,QAAQ,GAAG;YACnB,KAAK,EAAE,IAAI,CAAC,KAAK;YACjB,WAAW,EAAE,IAAI,CAAC,UAAU;YAC5B,QAAQ,EAAE,IAAI,CAAC,QAAQ;YACvB,WAAW,EAAE,IAAI,CAAC,WAAW;SAC9B,CAAC;QACF,IAAI,CAAC,WAAW,EAAE,CAAC;IACrB,CAAC;IACD,KAAK,CAAC,WAAW;;QACf,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;QACtB,MAAM,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC;QAC7D,MAAM,CAAC,QAAQ,EAAE,UAAU,EAAE,SAAS,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;YAC1D,IAAI,CAAC,eAAe,CAAC,kBAAkB,CAAC,EAAE,EAAE,EAAE,IAAI,CAAC,UAAU,EAAE,QAAQ,EAAE,CAAA,MAAA,SAAS,CAAC,eAAe,0CAAE,WAAW,KAAI,IAAI,EAAE,CAAC;YAC1H,IAAI,CAAC,aAAa,CAAC,aAAa,EAAE;YAClC,IAAI,CAAC,aAAa,CAAC,mBAAmB,EAAE;YACxC,IAAI,CAAC,aAAa,CAAC,qBAAqB,EAAE;YAC1C,IAAI,CAAC,aAAa,CAAC,kBAAkB,EAAE;SACxC,CAAC,CAAC;QACH,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC;QAC7B,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAE3B,IAAI,CAAC,CAAC,EAAE,CAAC;YACP,gBAAgB,CAAC,EAAE,QAAQ,EAAE,SAAS,CAAC,kBAAkB,CAAC,QAAQ,EAAE,CAAC,CAAC;QACxE,CAAC;QACD,4CAA4C;QAC5C,IAAI,QAAQ,CAAC,WAAW,EAAE,CAAC;YACzB,MAAM,IAAI,GAAG,QAAQ,CAAC,eAAe,CAAC;YACtC,MAAM,MAAM,GAAG,mBAAmB,CAAC,QAAQ,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;YACzE,IAAI,YAAY,GAAG,GAAG,CAAC;YACvB,MAAM,CAAC,OAAO,CAAC,CAAC,KAAU,EAAE,KAAK,EAAE,EAAE;gBACnC,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,WAAW,YAAY,EAAE,EAAE,GAAG,KAAK,CAAC,CAAC,KAAK,KAAK,CAAC,CAAC,MAAM,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC;gBAC1F,IAAI,KAAK,KAAK,CAAC,EAAE,CAAC;oBAChB,YAAY,GAAG,EAAE,CAAC;gBACpB,CAAC;qBAAM,IAAI,KAAK,KAAK,CAAC,EAAE,CAAC;oBACvB,YAAY,GAAG,EAAE,CAAC;gBACpB,CAAC;qBAAM,CAAC;oBACN,YAAY,GAAG,YAAY,GAAG,GAAG,CAAC;gBACpC,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC;QACD,IAAI,CAAC,SAAS,GAAG,KAAK,CAAC;IACzB,CAAC;IAED,qBAAqB,CAAC,CAAc,EAAE,UAAuB,EAAE,UAAkB,EAAE,UAAkB;QACnG,CAAC,CAAC,wBAAwB,EAAE,CAAC;QAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;QACpB,MAAM,KAAK,GAAG,CAAC,CAAC,MAAM,CAAC;QACvB,MAAM,iBAAiB,GAAG,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,oBAAoB,KAAK,KAAK,CAAC,CAAC;QACjG,IAAI,CAAC,iBAAiB,EAAE,CAAC;YACvB,OAAO;QACT,CAAC;QACD,OAAO,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;QAC/B,gBAAgB,CAAC,EAAE,MAAM,EAAE,EAAE,kBAAkB,EAAE,iBAAiB,EAAE,EAAE,UAAU,EAAE,UAAU,EAAE,UAAU,EAAE,CAAC,CAAC;IAC9G,CAAC;IAGD,gBAAgB,CAAC,CAAc;QAC7B,CAAC,CAAC,wBAAwB,EAAE,CAAC;QAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;QACpB,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC;QACtB,SAAS,CAAC,WAAW,GAAG,CAAC,CAAC,MAAM,CAAC;IACnC,CAAC;IAED,KAAK,CAAC,kBAAkB,CAAC,CAAc;QACrC,CAAC,CAAC,wBAAwB,EAAE,CAAC;QAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;QACpB,MAAM,IAAI,CAAC,YAAY,EAAE,CAAC;IAC5B,CAAC;IACD,KAAK,CAAC,YAAY;;QAChB,IAAI,SAAS,CAAC,cAAc,EAAE,CAAC;YAC7B,MAAM,OAAO,CAAC,GAAG,CAAC;gBAChB,IAAI,CAAC,iBAAiB,EAAE;gBACxB,IAAI,CAAC,aAAa,CAAC,kBAAkB,EAAE;gBACvC,IAAI,CAAC,eAAe,CAAC,kBAAkB,CAAC,EAAE,EAAE,EAAE,SAAS,CAAC,QAAQ,CAAC,WAAW,EAAE,QAAQ,EAAE,CAAA,MAAA,SAAS,CAAC,eAAe,0CAAE,WAAW,KAAI,IAAI,EAAE,CAAC;aAC1I,CAAC,CAAC;YACH,wDAAwD;QAC1D,CAAC;aAAM,CAAC;YACN,MAAM,OAAO,CAAC,GAAG,CAAC;gBAChB,IAAI,CAAC,aAAa,CAAC,kBAAkB,EAAE;gBACvC,IAAI,CAAC,eAAe,CAAC,kBAAkB,CAAC,EAAE,EAAE,EAAE,SAAS,CAAC,QAAQ,CAAC,WAAW,EAAE,QAAQ,EAAE,CAAA,MAAA,SAAS,CAAC,eAAe,0CAAE,WAAW,KAAI,IAAI,EAAE,CAAC;aAC1I,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IACD,KAAK,CAAC,iBAAiB;QACrB,MAAM,IAAI,CAAC,eAAe,CAAC,6BAA6B,CAAC;YACvD,UAAU,EAAE,SAAS,CAAC,QAAQ,CAAC,WAAW;YAC1C,SAAS,EAAE,MAAM,CAAC,aAAa,CAAC,yBAAyB,CAAC,SAAS,EAAE,YAAY,CAAC;YAClF,OAAO,EAAE,MAAM,CAAC,aAAa,CAAC,yBAAyB,CAAC,OAAO,EAAE,YAAY,CAAC;YAC9E,aAAa,EAAE,EAAE;YACjB,SAAS,EAAE,aAAa,CAAC,yBAAyB,CAAC,SAAS;YAC5D,SAAS,EAAE,aAAa,CAAC,yBAAyB,CAAC,SAAS;YAC5D,QAAQ,EAAE,SAAS,CAAC,eAAe,CAAC,WAAW;YAC/C,YAAY,EAAE,SAAS,CAAC,eAAe,CAAC,WAAW;YACnD,kBAAkB,EAAE,CAAC,CAAC,aAAa,CAAC,yBAAyB,CAAC,MAAM;YACpE,SAAS,EAAE,aAAa,CAAC,yBAAyB,CAAC,MAAM,IAAI,EAAE;YAC/D,gBAAgB,EAAE,CAAC,CAAC,aAAa,CAAC,yBAAyB,CAAC,KAAK,IAAI,KAAK;YAC1E,QAAQ,EAAE,aAAa,CAAC,yBAAyB,CAAC,KAAK,IAAI,CAAC;SAC7D,CAAC,CAAC;IACL,CAAC;IACD,MAAM;;QACJ,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,OAAO,CACL,YAAM,KAAK,EAAC,0CAA0C;YACpD,eAAS,KAAK,EAAC,2BAA2B;gBACxC,cAAQ,OAAO,EAAE,MAAA,SAAS,CAAC,QAAQ,0CAAE,WAAW,CAAC,OAAO,EAAE,IAAI,EAAE,MAAA,MAAA,SAAS,CAAC,QAAQ,0CAAE,WAAW,0CAAE,IAAI,EAAE,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE,SAAS,EAAE,IAAI,CAAC,SAAS,GAAW,CAChK;YACV,eAAS,KAAK,EAAC,qBAAqB,IACjC,SAAS,CAAC,WAAW,KAAK,SAAS,CAAC,CAAC,CAAC,CACrC,WAAK,KAAK,EAAC,mBAAmB;gBAC5B,0BAAmC;gBAAC,GAAG,CACnC,CACP,CAAC,CAAC,CAAC,CACF,WAAK,KAAK,EAAC,mBAAmB;gBAC5B,2BAAqC,CACjC,CACP,CACO;YACT,CAAC,IAAI,CAAC,QAAQ,IAAI,oBAAuB,CACrC,CACR,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { CommonService } from '@/services/api/common.service';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport { Component, Listen, Prop, State, Watch, h } from '@stencil/core';\r\nimport { format, Locale } from 'date-fns';\r\nimport { ICurrency, IExposedLanguages } from '@/models/common';\r\nimport axios from 'axios';\r\nimport { Variation } from '@/models/property';\r\nimport booking_store, { updateRoomParams } from '@/stores/booking';\r\nimport app_store from '@/stores/app.store';\r\nimport { generateColorShades, getUserPrefernce, setDefaultLocale } from '@/utils/utils';\r\nimport Stack from '@/models/stack';\r\n// import { roomtypes } from '@/data';\r\n@Component({\r\n  tag: 'ir-booking-engine',\r\n  styleUrl: 'ir-booking-engine.css',\r\n  scoped: false,\r\n})\r\nexport class IrBookingEngine {\r\n  @Prop({ mutable: true }) token: string =\r\n    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MTQ1NTQ5OTIsIkNMQUlNLTAxIjoiOGJpaUdjK21FQVE9IiwiQ0xBSU0tMDIiOiI5UStMQm93VTl6az0iLCJDTEFJTS0wMyI6Ilp3Tys5azJoTzUwPSIsIkNMQUlNLTA0IjoicUxHWllZcVA3SzB5aENrRTFaY0tENm5TeFowNkEvQ2lPc1JrWUpYTHFhTEF5M3N0akltbU9CWkdDb080dDRyNVRiWjkxYnZQelFIQ2c1YlBGU2J3cm5HdjNsNjVVcjVLT3RnMmZQVWFnNHNEYmE3WTJkMDF4RGpDWUs2SFlGREhkcTFYTzBLdTVtd0NKeU5rWDFSeWZmSnhJdWdtZFBUeTZPWjk0RUVjYTJleWVSVzZFa0pYMnhCZzFNdnJ3aFRKRHF1cUxzaUxvZ3I0UFU5Y2x0MjdnQ2tJZlJzZ2lZbnpOK2szclZnTUdsQTUvWjRHekJWcHl3a0dqcWlpa0M5T0owWFUrdWJJM1dzNmNvSWEwSks4SWRqVjVaQ1VaZjZ1OGhBMytCUlpsUWlyWmFZVWZlVmpzU1FETFNwWFowYjVQY0FncE1EWVpmRGtWbGFscjRzZ1pRNVkwODkwcEp6dE16T0s2VTR5Z1FMQkdQbTlTSmRLY0ExSGU2MXl2YlhuIiwiQ0xBSU0tMDUiOiJFQTEzejA3ejBUcWRkM2gwNElyYThBcklIUzg2aEpCQSJ9.ySJjLhWwUDeP4X8LIJcbsjO74y_UgMHwRDpNrCClndc';\r\n  @Prop() propertyId: number;\r\n  @Prop() baseUrl: string;\r\n  @Prop() injected: boolean;\r\n  @Prop() roomtype_id: number = null;\r\n\r\n  @State() selectedLocale: Locale;\r\n  @State() currencies: ICurrency[];\r\n  @State() languages: IExposedLanguages[];\r\n  @State() isLoading: boolean = false;\r\n\r\n  private commonService = new CommonService();\r\n  private propertyService = new PropertyService();\r\n\r\n  @State() router = new Stack<HTMLElement>();\r\n\r\n  async componentWillLoad() {\r\n    axios.defaults.baseURL = this.baseUrl;\r\n    getUserPrefernce();\r\n    this.token = await this.commonService.getBEToken();\r\n    // if (this.token !== '') {\r\n    //   this.initializeApp();\r\n    // }\r\n    // this.router.push(<ir-booking-page></ir-booking-page>);\r\n  }\r\n  @Watch('token')\r\n  handleTokenChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.initializeApp();\r\n    }\r\n  }\r\n  initializeApp() {\r\n    this.commonService.setToken(this.token);\r\n    this.propertyService.setToken(this.token);\r\n    app_store.app_data = {\r\n      token: this.token,\r\n      property_id: this.propertyId,\r\n      injected: this.injected,\r\n      roomtype_id: this.roomtype_id,\r\n    };\r\n    this.initRequest();\r\n  }\r\n  async initRequest() {\r\n    this.isLoading = true;\r\n    const p = JSON.parse(localStorage.getItem('user_prefernce'));\r\n    const [property, currencies, languages] = await Promise.all([\r\n      this.propertyService.getExposedProperty({ id: this.propertyId, language: app_store.userPreferences?.language_id || 'en' }),\r\n      this.commonService.getCurrencies(),\r\n      this.commonService.getExposedLanguages(),\r\n      this.commonService.getExposedCountryByIp(),\r\n      this.commonService.getExposedLanguage(),\r\n    ]);\r\n    this.currencies = currencies;\r\n    this.languages = languages;\r\n\r\n    if (!p) {\r\n      setDefaultLocale({ currency: app_store.userDefaultCountry.currency });\r\n    }\r\n    // booking_store.roomTypes = [...roomtypes];\r\n    if (property.space_theme) {\r\n      const root = document.documentElement;\r\n      const shades = generateColorShades(property.space_theme.button_bg_color);\r\n      let shade_number = 900;\r\n      shades.forEach((shade: any, index) => {\r\n        root.style.setProperty(`--brand-${shade_number}`, `${shade.h}, ${shade.s}%, ${shade.l}%`);\r\n        if (index === 9) {\r\n          shade_number = 25;\r\n        } else if (index === 8) {\r\n          shade_number = 50;\r\n        } else {\r\n          shade_number = shade_number - 100;\r\n        }\r\n      });\r\n    }\r\n    this.isLoading = false;\r\n  }\r\n\r\n  handleVariationChange(e: CustomEvent, variations: Variation[], rateplanId: number, roomTypeId: number) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const value = e.detail;\r\n    const selectedVariation = variations.find(variation => variation.adult_child_offering === value);\r\n    if (!selectedVariation) {\r\n      return;\r\n    }\r\n    console.log(selectedVariation);\r\n    updateRoomParams({ params: { selected_variation: selectedVariation }, ratePlanId: rateplanId, roomTypeId });\r\n  }\r\n\r\n  @Listen('routing')\r\n  handleNavigation(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    console.log(e.detail);\r\n    app_store.currentPage = e.detail;\r\n  }\r\n  @Listen('resetBooking')\r\n  async handleResetBooking(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    await this.resetBooking();\r\n  }\r\n  async resetBooking() {\r\n    if (app_store.fetchedBooking) {\r\n      await Promise.all([\r\n        this.checkAvailability(),\r\n        this.commonService.getExposedLanguage(),\r\n        this.propertyService.getExposedProperty({ id: app_store.app_data.property_id, language: app_store.userPreferences?.language_id || 'en' }),\r\n      ]);\r\n      // booking_store.roomTypes = [...p.My_Result.roomtypes];\r\n    } else {\r\n      await Promise.all([\r\n        this.commonService.getExposedLanguage(),\r\n        this.propertyService.getExposedProperty({ id: app_store.app_data.property_id, language: app_store.userPreferences?.language_id || 'en' }),\r\n      ]);\r\n    }\r\n  }\r\n  async checkAvailability() {\r\n    await this.propertyService.getExposedBookingAvailability({\r\n      propertyid: app_store.app_data.property_id,\r\n      from_date: format(booking_store.bookingAvailabilityParams.from_date, 'yyyy-MM-dd'),\r\n      to_date: format(booking_store.bookingAvailabilityParams.to_date, 'yyyy-MM-dd'),\r\n      room_type_ids: [],\r\n      adult_nbr: booking_store.bookingAvailabilityParams.adult_nbr,\r\n      child_nbr: booking_store.bookingAvailabilityParams.child_nbr,\r\n      language: app_store.userPreferences.language_id,\r\n      currency_ref: app_store.userPreferences.currency_id,\r\n      is_in_loyalty_mode: !!booking_store.bookingAvailabilityParams.coupon,\r\n      promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n      is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n      agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n    });\r\n  }\r\n  render() {\r\n    if (this.isLoading) {\r\n      return null;\r\n    }\r\n    return (\r\n      <main class=\"relative  flex w-full flex-col space-y-5\">\r\n        <section class=\"sticky top-0 z-50 w-full \">\r\n          <ir-nav website={app_store.property?.space_theme.website} logo={app_store.property?.space_theme?.logo} currencies={this.currencies} languages={this.languages}></ir-nav>\r\n        </section>\r\n        <section class=\"flex-1 px-4 lg:px-6\">\r\n          {app_store.currentPage === 'booking' ? (\r\n            <div class=\"mx-auto max-w-6xl\">\r\n              <ir-booking-page></ir-booking-page>{' '}\r\n            </div>\r\n          ) : (\r\n            <div class=\"mx-auto max-w-6xl\">\r\n              <ir-checkout-page></ir-checkout-page>\r\n            </div>\r\n          )}\r\n        </section>\r\n        {!this.injected && <ir-footer></ir-footer>}\r\n      </main>\r\n    );\r\n  }\r\n}\r\n"]}