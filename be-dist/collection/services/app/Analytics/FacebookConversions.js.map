{"version":3,"file":"FacebookConversions.js","sourceRoot":"","sources":["../../../../src/services/app/Analytics/FacebookConversions.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,UAAU,EAAE,sBAAsB,EAAE,MAAM,eAAe,CAAC;AAGnE,MAAM,OAAO,kBAAkB;IAG7B,YAAoB,YAAoB;QAApB,iBAAY,GAAZ,YAAY,CAAQ;IAAG,CAAC;IAErC,IAAI;QACT,IAAI,kBAAkB,CAAC,WAAW;YAAE,OAAO;QAE3C,MAAM,MAAM,GAAG;;;;;;;;;;qBAUE,IAAI,CAAC,YAAY;;;;sEAIgC,IAAI,CAAC,YAAY;;OAEhF,CAAC;QACJ,UAAU,CAAC,MAAM,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;QAEpC,kBAAkB,CAAC,WAAW,GAAG,IAAI,CAAC;IACxC,CAAC;IAEM,aAAa,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAkB;QACtD,MAAM,MAAM,GAAG;;mBAEA,KAAK;sBACF,QAAQ;;SAErB,CAAC;QACN,sBAAsB,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;IAC7C,CAAC;IACM,WAAW,CAAC,EAAE,SAAS,EAAE,OAAO,EAAgB;QACrD,MAAM,MAAM,GAAG;;4BAES,SAAS,MAAM,OAAO;;KAE7C,CAAC;QACF,sBAAsB,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;IAC3C,CAAC;IACM,aAAa,CAAC,EAAE,QAAQ,EAAE,KAAK,EAAkB;QACtD,MAAM,MAAM,GAAG;;iBAEF,KAAK;oBACF,QAAQ;;GAEzB,CAAC;QACA,sBAAsB,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;IAC7C,CAAC;;AAtDa,8BAAW,GAAG,KAAK,CAAC","sourcesContent":["import { injectHTML, injectHTMLAndRunScript } from '@/utils/utils';\r\nimport { CheckoutParams, IConversion, PurchaseParams, SearchParams } from './types';\r\n\r\nexport class FacebookConversion implements IConversion {\r\n  public static initialized = false;\r\n\r\n  constructor(private conversionId: string) {}\r\n\r\n  public init() {\r\n    if (FacebookConversion.initialized) return;\r\n\r\n    const script = `\r\n      <script>\r\n      !function(f,b,e,v,n,t,s)\r\n      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\r\n      n.callMethod.apply(n,arguments):n.queue.push(arguments)};\r\n      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\r\n      n.queue=[];t=b.createElement(e);t.async=!0;\r\n      t.src=v;s=b.getElementsByTagName(e)[0];\r\n      s.parentNode.insertBefore(t,s)}(window,document,'script',\r\n      'https://connect.facebook.net/en_US/fbevents.js');\r\n      fbq('init', '${this.conversionId}');\r\n      fbq('track', 'PageView');\r\n      </script>\r\n      <noscript>\r\n      <img height=\"1\" width=\"1\" src=\"https://www.facebook.com/tr?id=${this.conversionId}&ev=PageView&noscript=1\" />\r\n      </noscript>\r\n      `;\r\n    injectHTML(script, 'head', 'first');\r\n\r\n    FacebookConversion.initialized = true;\r\n  }\r\n\r\n  public trackCheckout({ currency, value }: CheckoutParams): void {\r\n    const script = `\r\n        fbq('track', 'InitiateCheckout', {\r\n          value: ${value},\r\n          currency: ${currency}\r\n         });\r\n        `;\r\n    injectHTMLAndRunScript(script, 'checkout');\r\n  }\r\n  public trackSearch({ from_date, to_date }: SearchParams) {\r\n    const script = `\r\n        fbq('track', 'Search', {\r\n          search_string: '${from_date} / ${to_date}'\r\n        });\r\n    `;\r\n    injectHTMLAndRunScript(script, 'search');\r\n  }\r\n  public trackPurchase({ currency, value }: PurchaseParams): void {\r\n    const script = `\r\n      fbq('track', 'Purchase', {\r\n        value: ${value},\r\n        currency: ${currency}\r\n      });\r\n  `;\r\n    injectHTMLAndRunScript(script, 'purchase');\r\n  }\r\n}\r\n"]}