{"version":3,"file":"booking-listing.service.js","sourceRoot":"","sources":["../../../src/services/app/booking-listing.service.ts"],"names":[],"mappings":"AACA,OAAO,SAAS,MAAM,oBAAoB,CAAC;AAC3C,OAAO,cAAc,MAAM,6BAA6B,CAAC;AACzD,OAAO,EAAE,YAAY,EAAE,MAAM,eAAe,CAAC;AAC7C,OAAO,EAAE,QAAQ,EAAE,MAAM,UAAU,CAAC;AAMpC,MAAM,OAAO,wBAAwB;IAC5B,mBAAmB,CAAC,OAAgB;;QACzC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAC5B,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;YACpB,OAAO,IAAI,CAAC;QACd,CAAC;QACD,MAAM,IAAI,GAAG,MAAA,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,cAAc,CAAC,0CAAE,KAAK,CAAC;QACvE,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,OAAO,IAAI,CAAC;QACd,CAAC;QACD,OAAO,MAAA,SAAS,CAAC,QAAQ,CAAC,uBAAuB,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,KAAK,IAAI,CAAC,mCAAI,IAAI,CAAC;IAC3F,CAAC;IAEM,iBAAiB,CAAC,OAAgB;QACvC,iDAAiD;QACjD,MAAM,OAAO,GAAG,IAAI,CAAC;QACrB,MAAM,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,KAAK,IAAI,QAAQ,CAAC,IAAI,IAAI,EAAE,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC;QACrG,MAAM,cAAc,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,KAAK,KAAK,IAAI,SAAS,CAAC,QAAQ,CAAC,uBAAuB,CAAC,IAAI,CAAC,aAAa,CAAC,EAAE,CAAC,aAAa,CAAC,kBAAkB,CAAC,CAAC;QAC3J,IAAI,gBAAgB,GAAG,EAAE,CAAC;QAC1B,IAAI,eAAe,GAAG,EAAE,CAAC;QACzB,IAAI,cAAc,EAAE,CAAC;YACnB,MAAM,iBAAiB,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,KAAK,mBAAmB,CAAC,CAAC;YAClF,IAAI,iBAAiB,EAAE,CAAC;gBACtB,eAAe,GAAG,YAAY,CAAC,iBAAiB,CAAC,KAAK,IAAI,CAAC,EAAE,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;gBACpF,gBAAgB,GAAG,cAAc,CAAC,OAAO,CAAC,kBAAkB,CAAC,OAAO,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;YAC9F,CAAC;QACH,CAAC;QACD,OAAO;YACL,MAAM,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,KAAK,EAAE,cAAc,CAAC,OAAO,CAAC,iBAAiB,EAAE;YAC5E,OAAO,EAAE,EAAE,IAAI,EAAE,cAAc,EAAE,KAAK,EAAE,gBAAgB,EAAE,eAAe,EAAE;YAC3E,IAAI,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,cAAc,CAAC,OAAO,CAAC,kBAAkB,EAAE;SAC1E,CAAC;IACJ,CAAC;CACF","sourcesContent":["import { Booking } from '@/models/booking.dto';\r\nimport app_store from '@/stores/app.store';\r\nimport localizedWords from '@/stores/localization.store';\r\nimport { formatAmount } from '@/utils/utils';\r\nimport { isBefore } from 'date-fns';\r\ntype TBookingActions = {\r\n  cancel: { show: boolean; label: string };\r\n  payment: { show: boolean; label: string; formattedAmount: string };\r\n  view: { show: boolean; label: string };\r\n};\r\nexport class BookingListingAppService {\r\n  public detectPaymentOrigin(booking: Booking) {\r\n    console.log(booking.extras);\r\n    if (!booking.extras) {\r\n      return null;\r\n    }\r\n    const code = booking.extras.find(e => e.key === 'payment_code')?.value;\r\n    if (!code) {\r\n      return null;\r\n    }\r\n    return app_store.property.allowed_payment_methods.find(apm => apm.code === code) ?? null;\r\n  }\r\n\r\n  public getBookingActions(booking: Booking): TBookingActions {\r\n    // const canView = booking.status.code !== '003';\r\n    const canView = true;\r\n    const canCancel = booking.status.code !== '003' && isBefore(new Date(), new Date(booking.from_date));\r\n    const canMakePayment = booking.status.code === '001' && app_store.property.allowed_payment_methods.some(paymentMethod => paymentMethod.is_payment_gateway);\r\n    let makePaymentLabel = '';\r\n    let formattedAmount = '';\r\n    if (canMakePayment) {\r\n      const prepayment_amount = booking.extras.find(e => e.key === 'prepayment_amount');\r\n      if (prepayment_amount) {\r\n        formattedAmount = formatAmount(prepayment_amount.value || 0, booking.currency.code);\r\n        makePaymentLabel = localizedWords.entries.Lcz_PayToGuarantee.replace('%1', formattedAmount);\r\n      }\r\n    }\r\n    return {\r\n      cancel: { show: canCancel, label: localizedWords.entries.Lcz_CancelBooking },\r\n      payment: { show: canMakePayment, label: makePaymentLabel, formattedAmount },\r\n      view: { show: canView, label: localizedWords.entries.Lcz_BookingDetails },\r\n    };\r\n  }\r\n}\r\n"]}