{"version":3,"file":"checkout.validator.js","sourceRoot":"","sources":["../../src/validators/checkout.validator.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AAExB,MAAM,kBAAkB,GAAG;IACzB,IAAI,EAAE,2BAA2B;IACjC,UAAU,EAAE,mBAAmB;IAC/B,IAAI,EAAE,kBAAkB;CACzB,CAAC;AAEF,MAAM,WAAW,GAAG;IAClB,IAAI,EAAE,YAAY;IAClB,UAAU,EAAE,YAAY;IACxB,IAAI,EAAE,YAAY;CACnB,CAAC;AAEF,MAAM,kBAAkB,GAAG,CAAC,MAAc,EAAE,EAAE;IAC5C,MAAM,CAAC,KAAK,EAAE,IAAI,CAAC,GAAG,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;IACpD,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,IAAI,KAAK,GAAG,CAAC,IAAI,KAAK,GAAG,EAAE,EAAE,CAAC;QAC/C,OAAO,KAAK,CAAC;IACf,CAAC;IACD,MAAM,WAAW,GAAG,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,GAAG,GAAG,CAAC;IACnD,MAAM,YAAY,GAAG,IAAI,IAAI,EAAE,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAC;IAC/C,IAAI,IAAI,GAAG,WAAW,IAAI,CAAC,IAAI,KAAK,WAAW,IAAI,KAAK,GAAG,YAAY,CAAC,EAAE,CAAC;QACzE,OAAO,KAAK,CAAC;IACf,CAAC;IACD,OAAO,IAAI,CAAC;AACd,CAAC,CAAC;AAEF,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAAC;KAC/B,MAAM,CAAC;IACN,UAAU,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,MAAM,CAC3B,GAAG,CAAC,EAAE;QACJ,OAAO,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,kBAAkB,CAAC,UAAU,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,kBAAkB,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC3H,CAAC,EACD;QACE,OAAO,EAAE,qBAAqB;KAC/B,CACF;IACD,GAAG,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;IACtB,UAAU,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,MAAM,CAAC,kBAAkB,EAAE;QAChD,OAAO,EAAE,qBAAqB;KAC/B,CAAC;IACF,cAAc,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE;QAChC,OAAO,EAAE,iCAAiC;KAC3C,CAAC;CACH,CAAC;KACD,WAAW,CAAC,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE;IACzB,MAAM,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,kBAAkB,CAAC,IAAuC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;IAEjJ,IAAI,QAAQ,IAAI,CAAC,WAAW,CAAC,QAAoC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC;QAClF,GAAG,CAAC,QAAQ,CAAC;YACX,IAAI,EAAE,QAAQ;YACd,IAAI,EAAE,CAAC,KAAK,CAAC;YACb,OAAO,EAAE,cAAc;SACxB,CAAC,CAAC;IACL,CAAC;AACH,CAAC,CAAC,CAAC","sourcesContent":["import { z } from 'zod';\n\nconst cardNumberPatterns = {\n  VISA: /^4[0-9]{12}(?:[0-9]{3})?$/,\n  Mastercard: /^5[1-5][0-9]{14}$/,\n  AMEX: /^3[47][0-9]{13}$/,\n};\n\nconst cvcPatterns = {\n  VISA: /^[0-9]{3}$/,\n  Mastercard: /^[0-9]{3}$/,\n  AMEX: /^[0-9]{4}$/,\n};\n\nconst validateExpiryDate = (expiry: string) => {\n  const [month, year] = expiry.split('/').map(Number);\n  if (!month || !year || month < 1 || month > 12) {\n    return false;\n  }\n  const currentYear = new Date().getFullYear() % 100;\n  const currentMonth = new Date().getMonth() + 1;\n  if (year < currentYear || (year === currentYear && month < currentMonth)) {\n    return false;\n  }\n  return true;\n};\n\nexport const ZCreditCardSchema = z\n  .object({\n    cardNumber: z.string().refine(\n      val => {\n        return cardNumberPatterns.VISA.test(val) || cardNumberPatterns.Mastercard.test(val) || cardNumberPatterns.AMEX.test(val);\n      },\n      {\n        message: 'Invalid card number',\n      },\n    ),\n    cvc: z.string().min(3),\n    expiryDate: z.string().refine(validateExpiryDate, {\n      message: 'Invalid expiry date',\n    }),\n    cardHolderName: z.string().min(1, {\n      message: 'Cardholder name cannot be empty',\n    }),\n  })\n  .superRefine((data, ctx) => {\n    const cardType = Object.keys(cardNumberPatterns).find(type => cardNumberPatterns[type as keyof typeof cardNumberPatterns].test(data.cardNumber));\n\n    if (cardType && !cvcPatterns[cardType as keyof typeof cvcPatterns].test(data.cvc)) {\n      ctx.addIssue({\n        code: 'custom',\n        path: ['cvc'],\n        message: \"'Invalid CVC\",\n      });\n    }\n  });\n"]}