{"version":3,"names":["BookingListingService","Token","getExposedGuestToken","property_id","token","this","getToken","MissingTokenError","data","axios","post","Error","irBookingListingCss","IrBookingListingStyle0","IrBookingListing","bookingListingService","commonService","CommonService","propertyService","PropertyService","componentWillLoad","defaults","baseURL","baseUrl","propertyid","initializeServices","initializeApp","getBEToken","app_store","app_data","setToken","isLoading","bookings","Promise","all","getExposedProperty","id","language","_a","userPreferences","language_id","console","log","error","handleAuthFinish","e","stopImmediatePropagation","stopPropagation","state","detail","getBadgeVariant","code","render","h","Host","class","enableSignUp","onAuthFinish","bind","headerShown","isBookingListing","website","property","space_theme","logo","_c","_b","localizedWords","entries","Lcz_BookingPreference","_d","map","booking","totalNights","differenceInCalendarDays","Date","to_date","from_date","key","booking_nbr","label","status","description","variant","format","booked_on","date","formatAmount","total","currency","footerShown"],"sources":["src/services/api/booking_listing.service.ts","src/components/ir-booking-engine/ir-booking-listing/ir-booking-listing.css?tag=ir-booking-listing&encapsulation=shadow","src/components/ir-booking-engine/ir-booking-listing/ir-booking-listing.tsx"],"sourcesContent":["import { MissingTokenError, Token } from '@/models/Token';\r\nimport axios from 'axios';\r\n\r\nexport class BookingListingService extends Token {\r\n  public async getExposedGuestToken(property_id: string | number) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new MissingTokenError();\r\n    }\r\n    const { data } = await axios.post(`/Get_Exposed_Guest_Bookings?Ticket=${token}`, {\r\n      property_id,\r\n    });\r\n    if (data['ExceptionMsg'] !== '') {\r\n      throw new Error(data['ExceptionMsg']);\r\n    }\r\n    return data['My_Result'];\r\n  }\r\n}\r\n","@import url('../../gloabls.css');\r\n:host {\r\n  display: block;\r\n}\r\n","import { Booking } from '@/models/booking.dto';\r\nimport { BookingListingService } from '@/services/api/booking_listing.service';\r\nimport { CommonService } from '@/services/api/common.service';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport app_store from '@/stores/app.store';\r\nimport localizedWords from '@/stores/localization.store';\r\nimport { formatAmount } from '@/utils/utils';\r\nimport { Component, Host, Prop, State, h } from '@stencil/core';\r\nimport axios from 'axios';\r\nimport { differenceInCalendarDays, format } from 'date-fns';\r\n\r\n@Component({\r\n  tag: 'ir-booking-listing',\r\n  styleUrl: 'ir-booking-listing.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingListing {\r\n  @Prop() propertyid: number;\r\n  @Prop() baseUrl: string;\r\n  @Prop() headerShown: boolean = true;\r\n  @Prop() footerShown: boolean = true;\r\n\r\n  @State() isLoading = false;\r\n  @State() token: string =\r\n    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MTY0NzAzMjYsIkNMQUlNLTAxIjoiZE1TL0hDV21NdW89IiwiQ0xBSU0tMDIiOiI5UStMQm93VTl6az0iLCJDTEFJTS0wMyI6Ilp3Tys5azJoTzUwPSIsIkNMQUlNLTA0IjoiQUVxVnRCMm1kWTg9IiwiQ0xBSU0tMDUiOiJFQTEzejA3ejBUcWRkM2gwNElyYThITHBnTWQvOWV5aSJ9.9hKPGjcvmTuRMAOE8BmXUY1NT3DDqSYDKgEokUV2N6U';\r\n  @State() bookings: Booking[] = [];\r\n\r\n  private bookingListingService = new BookingListingService();\r\n  private commonService = new CommonService();\r\n  private propertyService = new PropertyService();\r\n\r\n  async componentWillLoad() {\r\n    axios.defaults.baseURL = this.baseUrl;\r\n    if (!this.propertyid) {\r\n      throw new Error('missing property id');\r\n    }\r\n    if (this.token) {\r\n      this.initializeServices();\r\n      this.initializeApp();\r\n    } else {\r\n      const token = await this.commonService.getBEToken();\r\n      if (token) {\r\n        app_store.app_data.token = token;\r\n      }\r\n    }\r\n  }\r\n  initializeServices() {\r\n    this.bookingListingService.setToken(this.token);\r\n    this.propertyService.setToken(this.token);\r\n  }\r\n  async initializeApp() {\r\n    try {\r\n      this.isLoading = true;\r\n      const [bookings] = await Promise.all([\r\n        this.bookingListingService.getExposedGuestToken(this.propertyid),\r\n        this.propertyService.getExposedProperty({ id: this.propertyid, language: app_store.userPreferences?.language_id || 'en' }),\r\n      ]);\r\n      this.bookings = bookings;\r\n      console.log(this.bookings);\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n  handleAuthFinish(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const { token, state } = e.detail;\r\n    console.log(token, state);\r\n    if (state === 'success') {\r\n      this.token = token;\r\n      this.initializeServices();\r\n      this.initializeApp();\r\n    }\r\n  }\r\n  getBadgeVariant(code: string) {\r\n    if (code === '001') {\r\n      return 'pending';\r\n    } else if (code === '002') {\r\n      return 'success';\r\n    }\r\n    return 'error';\r\n  }\r\n  render() {\r\n    if (!this.token) {\r\n      return (\r\n        <Host>\r\n          <main class=\"flex h-screen flex-col  justify-center\">\r\n            <div class=\"mx-auto w-full max-w-md px-4\">\r\n              {/* <ir-signin></ir-signin> */}\r\n              <ir-auth enableSignUp={false} onAuthFinish={this.handleAuthFinish.bind(this)}></ir-auth>\r\n            </div>\r\n          </main>\r\n        </Host>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <Host>\r\n        {this.headerShown && <ir-nav isBookingListing website={app_store.property?.space_theme.website} logo={app_store.property?.space_theme?.logo}></ir-nav>}\r\n        <main class={' p-4'}>\r\n          <div class=\"table-container mx-auto max-w-6xl overflow-x-hidden shadow-md\">\r\n            <div class=\"flex flex-col gap-2.5 px-[20px] py-[16px] md:flex-row md:items-center md:justify-between \">\r\n              <h3>Bookings</h3>\r\n              {/* <input type=\"text\" placeholder=\"Search...\" class=\"w-full max-w-sm rounded-md border border-solid border-gray-300 px-4 py-1.5 \" /> */}\r\n            </div>\r\n            <div class=\"max-w-full overflow-x-auto \">\r\n              <table class=\"table\">\r\n                <thead>\r\n                  <tr class=\"table-header\">\r\n                    <th class=\"table-head\">Status</th>\r\n                    <th class=\"table-head\">{localizedWords.entries.Lcz_BookingPreference}</th>\r\n                    <th class=\"table-head\">Booking date</th>\r\n                    <th class=\"table-head\">Check-in</th>\r\n                    <th class=\"table-head\">Duration</th>\r\n                    <th class=\"table-head\">Total price</th>\r\n                    <th class=\"table-head sr-only\">pay now</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {this.bookings?.map(booking => {\r\n                    const totalNights = differenceInCalendarDays(new Date(booking.to_date), new Date(booking.from_date));\r\n                    return (\r\n                      <tr class=\"table-row\" key={booking.booking_nbr}>\r\n                        <td class=\"table-cell\">{<ir-badge label={booking.status.description} variant={this.getBadgeVariant(booking.status.code)}></ir-badge>}</td>\r\n                        <td class=\"table-cell\">{booking.booking_nbr}</td>\r\n                        <td class=\"table-cell\">{format(new Date(booking.booked_on.date), 'dd-MMM-yyyy')}</td>\r\n                        <td class=\"table-cell\">{format(new Date(booking.from_date), 'EEE, dd MMM yyyy')}</td>\r\n                        <td class=\"table-cell\">\r\n                          {totalNights} {totalNights > 1 ? 'nights' : 'night'}\r\n                        </td>\r\n                        <td class=\"table-cell\">{formatAmount(booking.total, booking.currency.code)}</td>\r\n                        <td class=\"table-cell\"></td>\r\n                      </tr>\r\n                    );\r\n                  })}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n            {/* <div class=\"flex items-center justify-between px-[20px] py-[16px] \">\r\n              <ir-button variants=\"outline\" label=\"Previous\" haveLeftIcon>\r\n                <ir-icons name=\"arrow_left\" slot=\"left-icon\" svgClassName=\"size-3\"></ir-icons>\r\n              </ir-button>\r\n              <ir-button variants=\"outline\" label=\"Next\" haveRightIcon>\r\n                <ir-icons name=\"arrow_right\" slot=\"right-icon\" svgClassName=\"size-3\"></ir-icons>\r\n              </ir-button>\r\n            </div> */}\r\n          </div>\r\n        </main>\r\n        {this.footerShown && <ir-footer></ir-footer>}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}