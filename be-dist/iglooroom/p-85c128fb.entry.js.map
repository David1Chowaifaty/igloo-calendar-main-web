{"version":3,"names":["initialState","channels","settlement_methods","statuses","types","token","rowCount","bookings","userSelection","from","format","addDays","Date","to","channel","property_id","start_row","end_row","total_count","filter_type","name","book_nbr","booking_status","affiliate_id","is_mpo_managed","is_mpo_used","is_for_mobile","is_combined_view","is_to_export","download_url","state","booking_listing","onChange","onBookingListingChange","createStore","initializeUserSelection","Object","assign","code","id","BookingListingService","Token","getExposedBookingsCriteria","this","getToken","Error","data","axios","post","result","My_Result","getExposedBookings","params","header","My_Params_Get_Exposed_Bookings","exported_data_url","removeExposedBooking","booking_nbr","is_to_revover","irBookingListingCss","IrBookingListingStyle0","IrBookingListing","bookingListingService","initializeApp","isLoading","error","console","render","h","class","enableSignUp","Host","type","placeholder","Array","map","_","i","label","variant","variants","haveLeftIcon","slot","svgClassName","haveRightIcon"],"sources":["src/stores/booking_listing.store.ts","src/services/api/booking_listing.service.ts","src/components/ir-booking-engine/ir-booking-listing/ir-booking-listing.css?tag=ir-booking-listing&encapsulation=shadow","src/components/ir-booking-engine/ir-booking-listing/ir-booking-listing.tsx"],"sourcesContent":["import { Booking } from '@/models/booking.dto';\r\nimport { IExposedBookingsCriteria } from '@/models/IrBookingListing';\r\nimport { createStore } from '@stencil/store';\r\nimport { addDays, format } from 'date-fns';\r\n\r\nexport interface IBookingListingStore extends IExposedBookingsCriteria {\r\n  token: string;\r\n  userSelection: IUserListingSelection;\r\n  bookings: Booking[];\r\n  download_url: string | null;\r\n  rowCount: number;\r\n}\r\nexport interface IUserListingSelection {\r\n  channel: string;\r\n  property_id: number;\r\n  filter_type: number;\r\n  from: string;\r\n  to: string;\r\n  name: string;\r\n  book_nbr: string;\r\n  booking_status: string;\r\n  affiliate_id: 0;\r\n  is_mpo_managed: false;\r\n  is_mpo_used: false;\r\n  is_for_mobile: false;\r\n  is_combined_view: false;\r\n  start_row: number;\r\n  end_row: number;\r\n  total_count: number;\r\n  is_to_export: boolean;\r\n}\r\n\r\nconst initialState: IBookingListingStore = {\r\n  channels: [],\r\n  settlement_methods: [],\r\n  statuses: [],\r\n  types: [],\r\n  token: '',\r\n  rowCount: 10,\r\n  bookings: [],\r\n  userSelection: {\r\n    from: format(addDays(new Date(), -7), 'yyyy-MM-dd'),\r\n    to: format(new Date(), 'yyyy-MM-dd'),\r\n    channel: '',\r\n    property_id: null,\r\n    start_row: 0,\r\n    end_row: 20,\r\n    total_count: 0,\r\n    filter_type: null,\r\n    name: '',\r\n    book_nbr: '',\r\n    booking_status: '',\r\n    affiliate_id: 0,\r\n    is_mpo_managed: false,\r\n    is_mpo_used: false,\r\n    is_for_mobile: false,\r\n    is_combined_view: false,\r\n    is_to_export: false,\r\n  },\r\n  download_url: null,\r\n};\r\n\r\nexport const { state: booking_listing, onChange: onBookingListingChange } = createStore<IBookingListingStore>(initialState);\r\nexport function initializeUserSelection() {\r\n  //booking_listing.channels[0].name\r\n  booking_listing.userSelection = {\r\n    ...booking_listing.userSelection,\r\n    channel: '',\r\n    booking_status: booking_listing.statuses[0].code,\r\n    filter_type: booking_listing.types[0].id,\r\n    book_nbr: '',\r\n    name: '',\r\n    from: format(addDays(new Date(), -7), 'yyyy-MM-dd'),\r\n    to: format(new Date(), 'yyyy-MM-dd'),\r\n    start_row: 0,\r\n    end_row: booking_listing.rowCount,\r\n  };\r\n}\r\nexport function updateUserSelection(key: keyof IUserListingSelection, value: any) {\r\n  booking_listing.userSelection = {\r\n    ...booking_listing.userSelection,\r\n    [key]: value,\r\n  };\r\n}\r\nexport default booking_listing;\r\n","import { Token } from '@/models/Token';\r\nimport booking_listing, { initializeUserSelection, IUserListingSelection } from '@/stores/booking_listing.store';\r\nimport axios from 'axios';\r\n\r\nexport class BookingListingService extends Token {\r\n  public async getExposedBookingsCriteria(property_id: number) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new Error('Invalid token');\r\n    }\r\n    const { data } = await axios.post(`/Get_Exposed_Bookings_Criteria?Ticket=${token}`, {\r\n      property_id,\r\n    });\r\n\r\n    const result = data.My_Result;\r\n\r\n    booking_listing.channels = result.channels;\r\n    booking_listing.settlement_methods = result.settlement_methods;\r\n    booking_listing.statuses = result.statuses;\r\n    booking_listing.types = result.types;\r\n    initializeUserSelection();\r\n  }\r\n\r\n  public async getExposedBookings(params: IUserListingSelection) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new Error('Invalid token');\r\n    }\r\n    const { data } = await axios.post(`/Get_Exposed_Bookings?Ticket=${token}`, params);\r\n    const result = data.My_Result;\r\n    const header = data.My_Params_Get_Exposed_Bookings;\r\n    booking_listing.bookings = [...result];\r\n    booking_listing.userSelection = {\r\n      ...booking_listing.userSelection,\r\n      total_count: header.total_count,\r\n    };\r\n    booking_listing.download_url = header.exported_data_url;\r\n  }\r\n  public async removeExposedBooking(booking_nbr: string, is_to_revover: boolean) {\r\n    const token = this.getToken();\r\n    if (!token) {\r\n      throw new Error('Invalid token');\r\n    }\r\n    await axios.post(`/Remove_Exposed_Booking?Ticket=${token}`, {\r\n      booking_nbr,\r\n      is_to_revover,\r\n    });\r\n  }\r\n}\r\n","@import url('../../gloabls.css');\r\n:host {\r\n  display: block;\r\n}\r\n","import { BookingListingService } from '@/services/api/booking_listing.service';\r\nimport booking_listing from '@/stores/booking_listing.store';\r\nimport { Component, Host, Prop, State, h } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'ir-booking-listing',\r\n  styleUrl: 'ir-booking-listing.css',\r\n  shadow: true,\r\n})\r\nexport class IrBookingListing {\r\n  @Prop() propertid: number;\r\n\r\n  @State() isLoading = false;\r\n  @State() token: string;\r\n\r\n  private bookingListingService = new BookingListingService();\r\n  async initializeApp() {\r\n    try {\r\n      this.isLoading = true;\r\n      // await Promise.all([this.bookingListingService.getExposedBookingsCriteria(this.propertyid), this.roomService.fetchLanguage(this.language, ['_BOOKING_LIST_FRONT'])]);\r\n      await this.bookingListingService.getExposedBookings({ ...booking_listing.userSelection, is_to_export: false });\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n  render() {\r\n    if (!this.token) {\r\n      return (\r\n        <main class=\"flex h-screen flex-col  justify-center\">\r\n          <div class=\"mx-auto w-full max-w-md px-4\">\r\n            {/* <ir-signin></ir-signin> */}\r\n            <ir-auth enableSignUp={false}></ir-auth>\r\n          </div>\r\n        </main>\r\n      );\r\n    }\r\n    return (\r\n      <Host>\r\n        <div class={'p-4'}>\r\n          <div class=\"table-container overflow-x-hidden shadow-md\">\r\n            <div class=\"flex flex-col gap-2.5 px-[20px] py-[16px] md:flex-row md:items-center md:justify-between \">\r\n              <h3>Bookings</h3>\r\n              <input type=\"text\" placeholder=\"Search...\" class=\"w-full max-w-sm rounded-md border border-solid border-gray-300 px-4 py-1.5 \" />\r\n            </div>\r\n            <div class=\"max-w-full overflow-x-auto \">\r\n              <table class=\"table\">\r\n                <thead>\r\n                  <tr class=\"table-header\">\r\n                    <th class=\"table-head\">Status</th>\r\n                    <th class=\"table-head\">Booking reference</th>\r\n                    <th class=\"table-head\">Booking date</th>\r\n                    <th class=\"table-head\">Check-in</th>\r\n                    <th class=\"table-head\">Duration</th>\r\n                    <th class=\"table-head\">Total price</th>\r\n                    <th class=\"table-head sr-only\">pay now</th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {[...new Array(10)].map((_, i) => (\r\n                    <tr class=\"table-row\">\r\n                      <td class=\"table-cell\">\r\n                        <ir-badge label=\"Pending\" variant=\"pending\"></ir-badge>\r\n                      </td>\r\n                      <td class=\"table-cell\">{i}</td>\r\n                      <td class=\"table-cell\">Name {i}</td>\r\n                      <td class=\"table-cell\">email{i}@example.com</td>\r\n                      <td class=\"table-cell\">City {i}</td>\r\n                      <td class=\"table-cell\">Country {i}</td>\r\n                      <td class=\"table-cell\">Zip{i}</td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n            <div class=\"flex items-center justify-between px-[20px] py-[16px] \">\r\n              <ir-button variants=\"outline\" label=\"Previous\" haveLeftIcon>\r\n                <ir-icons name=\"arrow_left\" slot=\"left-icon\" svgClassName=\"size-3\"></ir-icons>\r\n              </ir-button>\r\n              <ir-button variants=\"outline\" label=\"Next\" haveRightIcon>\r\n                <ir-icons name=\"arrow_right\" slot=\"right-icon\" svgClassName=\"size-3\"></ir-icons>\r\n              </ir-button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}