{"version":3,"names":["Stack","constructor","this","_topNode","undefined","_count","count","isEmpty","push","value","console","log","node","Node","pop","poppedNode","previous","data","peek","irBookingEngineCss","IrBookingEngineStyle0","IrBookingEngine","commonService","CommonService","propertyService","PropertyService","componentWillLoad","axios","defaults","withCredentials","baseURL","baseUrl","getUserPrefernce","token","getBEToken","app_store","userPreferences","handleTokenChange","newValue","oldValue","initializeApp","setToken","app_data","property_id","propertyId","injected","roomtype_id","initRequest","isLoading","p","JSON","parse","localStorage","getItem","property","currencies","languages","Promise","all","getExposedProperty","id","language","_a","language_id","getCurrencies","getExposedLanguages","getExposedCountryByIp","getExposedLanguage","setDefaultLocale","currency","userDefaultCountry","space_theme","root","document","documentElement","shades","generateColorShades","button_bg_color","shade_number","forEach","shade","index","style","setProperty","h","s","l","handleVariationChange","e","variations","rateplanId","roomTypeId","stopImmediatePropagation","stopPropagation","detail","selectedVariation","find","variation","adult_child_offering","updateRoomParams","params","selected_variation","ratePlanId","handleNavigation","currentPage","handleResetBooking","resetBooking","fetchedBooking","checkAvailability","_b","getExposedBookingAvailability","propertyid","from_date","format","booking_store","bookingAvailabilityParams","to_date","room_type_ids","adult_nbr","child_nbr","currency_ref","currency_id","is_in_loyalty_mode","coupon","promo_key","is_in_agent_mode","agent","agent_id","renderScreens","render","class","website","logo","_c"],"sources":["src/models/stack.ts","src/components/ir-booking-engine/ir-booking-engine.css?tag=ir-booking-engine&encapsulation=scoped","src/components/ir-booking-engine/ir-booking-engine.tsx"],"sourcesContent":["export default class Stack<TData> {\r\n  private _topNode: Node<TData> = undefined;\r\n  private _count: number = 0;\r\n\r\n  public count(): number {\r\n    return this._count;\r\n  }\r\n\r\n  public isEmpty(): boolean {\r\n    return this._topNode === undefined;\r\n  }\r\n\r\n  public push(value: TData): void {\r\n    console.log(value);\r\n    let node = new Node<TData>(value, this._topNode);\r\n    this._topNode = node;\r\n    this._count++;\r\n  }\r\n\r\n  public pop(): TData {\r\n    let poppedNode = this._topNode;\r\n    this._topNode = poppedNode.previous;\r\n    this._count--;\r\n    return poppedNode.data;\r\n  }\r\n\r\n  public peek(): TData {\r\n    return this._topNode.data;\r\n  }\r\n}\r\n\r\nclass Node<T> {\r\n  previous: Node<T>;\r\n  data: T;\r\n\r\n  constructor(data: T, previous: Node<T>) {\r\n    this.previous = previous;\r\n    this.data = data;\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n","import { CommonService } from '@/services/api/common.service';\r\nimport { PropertyService } from '@/services/api/property.service';\r\nimport { Component, Listen, Prop, State, Watch, h } from '@stencil/core';\r\nimport { format, Locale } from 'date-fns';\r\nimport { ICurrency, IExposedLanguages } from '@/models/common';\r\nimport axios from 'axios';\r\nimport { Variation } from '@/models/property';\r\nimport booking_store, { updateRoomParams } from '@/stores/booking';\r\nimport app_store from '@/stores/app.store';\r\nimport { generateColorShades, getUserPrefernce, setDefaultLocale } from '@/utils/utils';\r\nimport Stack from '@/models/stack';\r\n// import { roomtypes } from '@/data';\r\n@Component({\r\n  tag: 'ir-booking-engine',\r\n  styleUrl: 'ir-booking-engine.css',\r\n  scoped: true,\r\n})\r\nexport class IrBookingEngine {\r\n  @Prop({ mutable: true }) token: string =\r\n    'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MTQ1NTQ5OTIsIkNMQUlNLTAxIjoiOGJpaUdjK21FQVE9IiwiQ0xBSU0tMDIiOiI5UStMQm93VTl6az0iLCJDTEFJTS0wMyI6Ilp3Tys5azJoTzUwPSIsIkNMQUlNLTA0IjoicUxHWllZcVA3SzB5aENrRTFaY0tENm5TeFowNkEvQ2lPc1JrWUpYTHFhTEF5M3N0akltbU9CWkdDb080dDRyNVRiWjkxYnZQelFIQ2c1YlBGU2J3cm5HdjNsNjVVcjVLT3RnMmZQVWFnNHNEYmE3WTJkMDF4RGpDWUs2SFlGREhkcTFYTzBLdTVtd0NKeU5rWDFSeWZmSnhJdWdtZFBUeTZPWjk0RUVjYTJleWVSVzZFa0pYMnhCZzFNdnJ3aFRKRHF1cUxzaUxvZ3I0UFU5Y2x0MjdnQ2tJZlJzZ2lZbnpOK2szclZnTUdsQTUvWjRHekJWcHl3a0dqcWlpa0M5T0owWFUrdWJJM1dzNmNvSWEwSks4SWRqVjVaQ1VaZjZ1OGhBMytCUlpsUWlyWmFZVWZlVmpzU1FETFNwWFowYjVQY0FncE1EWVpmRGtWbGFscjRzZ1pRNVkwODkwcEp6dE16T0s2VTR5Z1FMQkdQbTlTSmRLY0ExSGU2MXl2YlhuIiwiQ0xBSU0tMDUiOiJFQTEzejA3ejBUcWRkM2gwNElyYThBcklIUzg2aEpCQSJ9.ySJjLhWwUDeP4X8LIJcbsjO74y_UgMHwRDpNrCClndc';\r\n  @Prop() propertyId: number;\r\n  @Prop() baseUrl: string;\r\n  @Prop() injected: boolean;\r\n  @Prop() roomtype_id: number = null;\r\n\r\n  @State() selectedLocale: Locale;\r\n  @State() currencies: ICurrency[];\r\n  @State() languages: IExposedLanguages[];\r\n  @State() isLoading: boolean = false;\r\n\r\n  private commonService = new CommonService();\r\n  private propertyService = new PropertyService();\r\n\r\n  @State() router = new Stack<HTMLElement>();\r\n\r\n  async componentWillLoad() {\r\n    axios.defaults.withCredentials = true;\r\n    axios.defaults.baseURL = this.baseUrl;\r\n    getUserPrefernce();\r\n    this.token = await this.commonService.getBEToken();\r\n    console.log(app_store.userPreferences);\r\n  }\r\n  @Watch('token')\r\n  handleTokenChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.initializeApp();\r\n    }\r\n  }\r\n  initializeApp() {\r\n    this.commonService.setToken(this.token);\r\n    this.propertyService.setToken(this.token);\r\n    app_store.app_data = {\r\n      token: this.token,\r\n      property_id: this.propertyId,\r\n      injected: this.injected,\r\n      roomtype_id: this.roomtype_id,\r\n    };\r\n    this.initRequest();\r\n  }\r\n  async initRequest() {\r\n    this.isLoading = true;\r\n    const p = JSON.parse(localStorage.getItem('user_prefernce'));\r\n    const [property, currencies, languages] = await Promise.all([\r\n      this.propertyService.getExposedProperty({ id: this.propertyId, language: app_store.userPreferences?.language_id || 'en' }),\r\n      this.commonService.getCurrencies(),\r\n      this.commonService.getExposedLanguages(),\r\n      this.commonService.getExposedCountryByIp(),\r\n      this.commonService.getExposedLanguage(),\r\n    ]);\r\n    this.currencies = currencies;\r\n    this.languages = languages;\r\n\r\n    if (!p) {\r\n      setDefaultLocale({ currency: app_store.userDefaultCountry.currency });\r\n    }\r\n    // booking_store.roomTypes = [...roomtypes];\r\n    if (property.space_theme) {\r\n      const root = document.documentElement;\r\n      const shades = generateColorShades(property.space_theme.button_bg_color);\r\n      let shade_number = 900;\r\n      shades.forEach((shade: any, index) => {\r\n        root.style.setProperty(`--brand-${shade_number}`, `${shade.h}, ${shade.s}%, ${shade.l}%`);\r\n        if (index === 9) {\r\n          shade_number = 25;\r\n        } else if (index === 8) {\r\n          shade_number = 50;\r\n        } else {\r\n          shade_number = shade_number - 100;\r\n        }\r\n      });\r\n    }\r\n    this.isLoading = false;\r\n    //new tab\r\n    // window.open(\r\n    //   'https://checkout.stripe.com/c/pay/cs_live_a1l2j0mneEassWNnZioZl1HRpP2VLeCZ8AgpV9GkdMN2tDZo6TvEOFapVU#fidkdWxOYHwnPyd1blppbHNgWjA0SDBKazxEVD19djA2YlxKSUtraHMwY24zQHBgdjdzYTdRSVMxdnZwaUlua2M0cDQ3UDB0dEtJdE9TY2xLR00zXWszZ1doYWhMRjw2SlBSRDN0Vzd0QkpyNTVMYjVnaEtCbCcpJ2N3amhWYHdzYHcnP3F3cGApJ2lkfGpwcVF8dWAnPyd2bGtiaWBabHFgaCcpJ2BrZGdpYFVpZGZgbWppYWB3dic%2FcXdwYHgl',\r\n    //   '_blank',\r\n    // );\r\n    //same window\r\n    // window.location.href = 'https://www.vivapayments.com/web2?ref=3205412746222813';\r\n\r\n    // window.eval(\r\n    //   `str_Checkout_Url = 'https://epayment.areeba.com/checkout/version/60/checkout.js';var js = document.createElement('script');js.src = str_Checkout_Url;js.setAttribute('data-error', ()=>{alert('Error')});js.setAttribute('data-cancel', ()=>{alert('Cancel')});js.setAttribute('data-complete', ()=>{alert('Complete')});js.onload = () => {var checkoutOptions = {merchant:'222206717001',order: {amount:'50',currency:'USD',description:'28252845',id:'Areeba-28252845-9f92ae52-7426-4b44-9add-44928a158bc6'},customer: {email:'soir.daou@gmail.com',firstName:'Soir',lastName:'Daou',mobilePhone:'03084767'},session: {id:'SESSION0002816619793M79905493M6'},interaction: {merchant: {name:'Beit Noun',logo:'https://dhl6m8m6g2w2j.cloudfront.net/ac/AcImage_330_10232.jpg'},displayControl: {billingAddress: 'HIDE',customerEmail: 'HIDE',orderSummary: 'HIDE',shipping: 'HIDE'}}};Checkout.configure(checkoutOptions);Checkout.showPaymentPage();};document.head.appendChild(js);`,\r\n    // );\r\n  }\r\n\r\n  handleVariationChange(e: CustomEvent, variations: Variation[], rateplanId: number, roomTypeId: number) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const value = e.detail;\r\n    const selectedVariation = variations.find(variation => variation.adult_child_offering === value);\r\n    if (!selectedVariation) {\r\n      return;\r\n    }\r\n    console.log(selectedVariation);\r\n    updateRoomParams({ params: { selected_variation: selectedVariation }, ratePlanId: rateplanId, roomTypeId });\r\n  }\r\n\r\n  @Listen('routing')\r\n  handleNavigation(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    console.log(e.detail);\r\n    app_store.currentPage = e.detail;\r\n  }\r\n  @Listen('resetBooking')\r\n  async handleResetBooking(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    await this.resetBooking();\r\n  }\r\n  async resetBooking() {\r\n    if (app_store.fetchedBooking) {\r\n      await Promise.all([\r\n        this.checkAvailability(),\r\n        this.commonService.getExposedLanguage(),\r\n        this.propertyService.getExposedProperty({ id: app_store.app_data.property_id, language: app_store.userPreferences?.language_id || 'en' }),\r\n      ]);\r\n      // booking_store.roomTypes = [...p.My_Result.roomtypes];\r\n    } else {\r\n      await Promise.all([\r\n        this.commonService.getExposedLanguage(),\r\n        this.propertyService.getExposedProperty({ id: app_store.app_data.property_id, language: app_store.userPreferences?.language_id || 'en' }),\r\n      ]);\r\n    }\r\n  }\r\n  async checkAvailability() {\r\n    await this.propertyService.getExposedBookingAvailability({\r\n      propertyid: app_store.app_data.property_id,\r\n      from_date: format(booking_store.bookingAvailabilityParams.from_date, 'yyyy-MM-dd'),\r\n      to_date: format(booking_store.bookingAvailabilityParams.to_date, 'yyyy-MM-dd'),\r\n      room_type_ids: [],\r\n      adult_nbr: booking_store.bookingAvailabilityParams.adult_nbr,\r\n      child_nbr: booking_store.bookingAvailabilityParams.child_nbr,\r\n      language: app_store.userPreferences.language_id,\r\n      currency_ref: app_store.userPreferences.currency_id,\r\n      is_in_loyalty_mode: !!booking_store.bookingAvailabilityParams.coupon,\r\n      promo_key: booking_store.bookingAvailabilityParams.coupon || '',\r\n      is_in_agent_mode: !!booking_store.bookingAvailabilityParams.agent || false,\r\n      agent_id: booking_store.bookingAvailabilityParams.agent || 0,\r\n    });\r\n  }\r\n  renderScreens() {\r\n    switch (app_store.currentPage) {\r\n      case 'booking':\r\n        return <ir-booking-page></ir-booking-page>;\r\n      case 'checkout':\r\n        return <ir-checkout-page></ir-checkout-page>;\r\n      case 'invoice':\r\n        return <ir-invoice></ir-invoice>;\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n  render() {\r\n    if (this.isLoading) {\r\n      return null;\r\n    }\r\n    return (\r\n      <main class=\"relative  flex w-full flex-col space-y-5 \">\r\n        <ir-interceptor></ir-interceptor>\r\n        <section class=\"sticky top-0 z-50 w-full \">\r\n          <ir-nav website={app_store.property?.space_theme.website} logo={app_store.property?.space_theme?.logo} currencies={this.currencies} languages={this.languages}></ir-nav>\r\n        </section>\r\n        <section class=\"flex-1 px-4 lg:px-6\">\r\n          <div class=\"mx-auto max-w-6xl\">{this.renderScreens()}</div>\r\n        </section>\r\n        {!this.injected && <ir-footer></ir-footer>}\r\n      </main>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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"}