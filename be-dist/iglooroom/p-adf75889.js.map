{"version":3,"names":["BookingListingAppService","getBookingActions","booking","canView","canCancel","status","code","isBefore","Date","to_date","canMakePayment","app_store","property","allowed_payment_methods","some","paymentMethod","is_payment_gateway","makePaymentLabel","prepayment_amount","extras","find","e","key","formatAmount","value","currency","cancel","show","label","payment","view"],"sources":["src/services/app/booking-listing.service.ts"],"sourcesContent":["import { Booking } from '@/models/booking.dto';\r\nimport app_store from '@/stores/app.store';\r\nimport { formatAmount } from '@/utils/utils';\r\nimport { isBefore } from 'date-fns';\r\ntype TBookingActions = {\r\n  cancel: { show: boolean; label: string };\r\n  payment: { show: boolean; label: string };\r\n  view: { show: boolean; label: string };\r\n};\r\nexport class BookingListingAppService {\r\n  public getBookingActions(booking: Booking): TBookingActions {\r\n    // const canView = booking.status.code !== '003';\r\n    const canView = true;\r\n    const canCancel = booking.status.code !== '003' && isBefore(new Date(), new Date(booking.to_date));\r\n    const canMakePayment = booking.status.code === '001' && app_store.property.allowed_payment_methods.some(paymentMethod => paymentMethod.is_payment_gateway);\r\n    let makePaymentLabel = '';\r\n    if (canMakePayment) {\r\n      const prepayment_amount = booking.extras.find(e => e.key === 'prepayment_amount');\r\n      if (prepayment_amount) {\r\n        makePaymentLabel = `Pay ${formatAmount(prepayment_amount.value || 0, booking.currency.code)} to guarentee`;\r\n      }\r\n    }\r\n    return {\r\n      cancel: { show: canCancel, label: 'Cancel booking' },\r\n      payment: { show: canMakePayment, label: makePaymentLabel },\r\n      view: { show: canView, label: 'Booking Details' },\r\n    };\r\n  }\r\n}\r\n"],"mappings":"kHASaA,EACJ,iBAAAC,CAAkBC,GAEvB,MAAMC,EAAU,KAChB,MAAMC,EAAYF,EAAQG,OAAOC,OAAS,OAASC,WAAS,IAAIC,KAAQ,IAAIA,KAAKN,EAAQO,UACzF,MAAMC,EAAiBR,EAAQG,OAAOC,OAAS,OAASK,EAAUC,SAASC,wBAAwBC,MAAKC,GAAiBA,EAAcC,qBACvI,IAAIC,EAAmB,GACvB,GAAIP,EAAgB,CAClB,MAAMQ,EAAoBhB,EAAQiB,OAAOC,MAAKC,GAAKA,EAAEC,MAAQ,sBAC7D,GAAIJ,EAAmB,CACrBD,EAAmB,OAAOM,EAAaL,EAAkBM,OAAS,EAAGtB,EAAQuB,SAASnB,oB,EAG1F,MAAO,CACLoB,OAAQ,CAAEC,KAAMvB,EAAWwB,MAAO,kBAClCC,QAAS,CAAEF,KAAMjB,EAAgBkB,MAAOX,GACxCa,KAAM,CAAEH,KAAMxB,EAASyB,MAAO,mB","ignoreList":[]}