import{b as t}from"./p-1c871994.js";import{z as i}from"./p-2ad5d597.js";class s{constructor(){this.items={};this.rear=0;this.front=0}enqueue(t){this.items[this.rear]=t;this.rear++}dequeue(){if(this.isEmpty()){return undefined}const t=this.items[this.front];delete this.items[this.front];this.front++;if(this.isEmpty()){this.rear=0;this.front=0}return t}isEmpty(){return this.rear===this.front}peek(){return this.items[this.front]}size(){return this.rear-this.front}print(){console.log(Object.values(this.items).slice(this.front,this.rear))}}const e=Object.create(null);e["open"]="0";e["close"]="1";e["ping"]="2";e["pong"]="3";e["message"]="4";e["upgrade"]="5";e["noop"]="6";const n=Object.create(null);Object.keys(e).forEach((t=>{n[e[t]]=t}));const r={type:"error",data:"parser error"};const o=typeof Blob==="function"||typeof Blob!=="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]";const h=typeof ArrayBuffer==="function";const c=t=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer;const f=({type:t,data:i},s,n)=>{if(o&&i instanceof Blob){if(s){return n(i)}else{return u(i,n)}}else if(h&&(i instanceof ArrayBuffer||c(i))){if(s){return n(i)}else{return u(new Blob([i]),n)}}return n(e[t]+(i||""))};const u=(t,i)=>{const s=new FileReader;s.onload=function(){const t=s.result.split(",")[1];i("b"+(t||""))};return s.readAsDataURL(t)};function a(t){if(t instanceof Uint8Array){return t}else if(t instanceof ArrayBuffer){return new Uint8Array(t)}else{return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}}let l;function d(t,i){if(o&&t.data instanceof Blob){return t.data.arrayBuffer().then(a).then(i)}else if(h&&(t.data instanceof ArrayBuffer||c(t.data))){return i(a(t.data))}f(t,false,(t=>{if(!l){l=new TextEncoder}i(l.encode(t))}))}const p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const y=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(let t=0;t<p.length;t++){y[p.charCodeAt(t)]=t}const b=t=>{let i=t.length*.75,s=t.length,e,n=0,r,o,h,c;if(t[t.length-1]==="="){i--;if(t[t.length-2]==="="){i--}}const f=new ArrayBuffer(i),u=new Uint8Array(f);for(e=0;e<s;e+=4){r=y[t.charCodeAt(e)];o=y[t.charCodeAt(e+1)];h=y[t.charCodeAt(e+2)];c=y[t.charCodeAt(e+3)];u[n++]=r<<2|o>>4;u[n++]=(o&15)<<4|h>>2;u[n++]=(h&3)<<6|c&63}return f};const w=typeof ArrayBuffer==="function";const g=(t,i)=>{if(typeof t!=="string"){return{type:"message",data:v(t,i)}}const s=t.charAt(0);if(s==="b"){return{type:"message",data:m(t.substring(1),i)}}const e=n[s];if(!e){return r}return t.length>1?{type:n[s],data:t.substring(1)}:{type:n[s]}};const m=(t,i)=>{if(w){const s=b(t);return v(s,i)}else{return{base64:true,data:t}}};const v=(t,i)=>{switch(i){case"blob":if(t instanceof Blob){return t}else{return new Blob([t])}case"arraybuffer":default:if(t instanceof ArrayBuffer){return t}else{return t.buffer}}};const k=String.fromCharCode(30);const O=(t,i)=>{const s=t.length;const e=new Array(s);let n=0;t.forEach(((t,r)=>{f(t,false,(t=>{e[r]=t;if(++n===s){i(e.join(k))}}))}))};const A=(t,i)=>{const s=t.split(k);const e=[];for(let t=0;t<s.length;t++){const n=g(s[t],i);e.push(n);if(n.type==="error"){break}}return e};function E(){return new TransformStream({transform(t,i){d(t,(s=>{const e=s.length;let n;if(e<126){n=new Uint8Array(1);new DataView(n.buffer).setUint8(0,e)}else if(e<65536){n=new Uint8Array(3);const t=new DataView(n.buffer);t.setUint8(0,126);t.setUint16(1,e)}else{n=new Uint8Array(9);const t=new DataView(n.buffer);t.setUint8(0,127);t.setBigUint64(1,BigInt(e))}if(t.data&&typeof t.data!=="string"){n[0]|=128}i.enqueue(n);i.enqueue(s)}))}})}let j;function _(t){return t.reduce(((t,i)=>t+i.length),0)}function N(t,i){if(t[0].length===i){return t.shift()}const s=new Uint8Array(i);let e=0;for(let n=0;n<i;n++){s[n]=t[0][e++];if(e===t[0].length){t.shift();e=0}}if(t.length&&e<t[0].length){t[0]=t[0].slice(e)}return s}function B(t,i){if(!j){j=new TextDecoder}const s=[];let e=0;let n=-1;let o=false;return new TransformStream({transform(h,c){s.push(h);while(true){if(e===0){if(_(s)<1){break}const t=N(s,1);o=(t[0]&128)===128;n=t[0]&127;if(n<126){e=3}else if(n===126){e=1}else{e=2}}else if(e===1){if(_(s)<2){break}const t=N(s,2);n=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0);e=3}else if(e===2){if(_(s)<8){break}const t=N(s,8);const i=new DataView(t.buffer,t.byteOffset,t.length);const o=i.getUint32(0);if(o>Math.pow(2,53-32)-1){c.enqueue(r);break}n=o*Math.pow(2,32)+i.getUint32(4);e=3}else{if(_(s)<n){break}const t=N(s,n);c.enqueue(g(o?t:j.decode(t),i));e=0}if(n===0||n>t){c.enqueue(r);break}}}})}const C=4;function x(t){if(t)return S(t)}function S(t){for(var i in x.prototype){t[i]=x.prototype[i]}return t}x.prototype.on=x.prototype.addEventListener=function(t,i){this._callbacks=this._callbacks||{};(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(i);return this};x.prototype.once=function(t,i){function s(){this.off(t,s);i.apply(this,arguments)}s.fn=i;this.on(t,s);return this};x.prototype.off=x.prototype.removeListener=x.prototype.removeAllListeners=x.prototype.removeEventListener=function(t,i){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length){delete this._callbacks["$"+t];return this}var e;for(var n=0;n<s.length;n++){e=s[n];if(e===i||e.fn===i){s.splice(n,1);break}}if(s.length===0){delete this._callbacks["$"+t]}return this};x.prototype.emit=function(t){this._callbacks=this._callbacks||{};var i=new Array(arguments.length-1),s=this._callbacks["$"+t];for(var e=1;e<arguments.length;e++){i[e-1]=arguments[e]}if(s){s=s.slice(0);for(var e=0,n=s.length;e<n;++e){s[e].apply(this,i)}}return this};x.prototype.emitReserved=x.prototype.emit;x.prototype.listeners=function(t){this._callbacks=this._callbacks||{};return this._callbacks["$"+t]||[]};x.prototype.hasListeners=function(t){return!!this.listeners(t).length};const T=(()=>{if(typeof self!=="undefined"){return self}else if(typeof window!=="undefined"){return window}else{return Function("return this")()}})();function L(t,...i){return i.reduce(((i,s)=>{if(t.hasOwnProperty(s)){i[s]=t[s]}return i}),{})}const U=T.setTimeout;const D=T.clearTimeout;function I(t,i){if(i.useNativeTimers){t.setTimeoutFn=U.bind(T);t.clearTimeoutFn=D.bind(T)}else{t.setTimeoutFn=T.setTimeout.bind(T);t.clearTimeoutFn=T.clearTimeout.bind(T)}}const M=1.33;function P(t){if(typeof t==="string"){return R(t)}return Math.ceil((t.byteLength||t.size)*M)}function R(t){let i=0,s=0;for(let e=0,n=t.length;e<n;e++){i=t.charCodeAt(e);if(i<128){s+=1}else if(i<2048){s+=2}else if(i<55296||i>=57344){s+=3}else{e++;s+=4}}return s}function V(t){let i="";for(let s in t){if(t.hasOwnProperty(s)){if(i.length)i+="&";i+=encodeURIComponent(s)+"="+encodeURIComponent(t[s])}}return i}function $(t){let i={};let s=t.split("&");for(let t=0,e=s.length;t<e;t++){let e=s[t].split("=");i[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return i}class q extends Error{constructor(t,i,s){super(t);this.description=i;this.context=s;this.type="TransportError"}}class F extends x{constructor(t){super();this.writable=false;I(this,t);this.opts=t;this.query=t.query;this.socket=t.socket}onError(t,i,s){super.emitReserved("error",new q(t,i,s));return this}open(){this.readyState="opening";this.doOpen();return this}close(){if(this.readyState==="opening"||this.readyState==="open"){this.doClose();this.onClose()}return this}send(t){if(this.readyState==="open"){this.write(t)}}onOpen(){this.readyState="open";this.writable=true;super.emitReserved("open")}onData(t){const i=g(t,this.socket.binaryType);this.onPacket(i)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed";super.emitReserved("close",t)}pause(t){}createUri(t,i={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){if(this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)){return":"+this.opts.port}else{return""}}_query(t){const i=V(t);return i.length?"?"+i:""}}const J="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),z=64,H={};let X=0,Q=0,W;function G(t){let i="";do{i=J[t%z]+i;t=Math.floor(t/z)}while(t>0);return i}function K(){const t=G(+new Date);if(t!==W)return X=0,W=t;return t+"."+G(X++)}for(;Q<z;Q++)H[J[Q]]=Q;let Y=false;try{Y=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(t){}const Z=Y;function tt(t){const i=t.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!i||Z)){return new XMLHttpRequest}}catch(t){}if(!i){try{return new(T[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}}function it(){}function st(){}const et=function(){const t=new tt({xdomain:false});return null!=t.responseType}();class nt extends F{constructor(t){super(t);this.polling=false;if(typeof location!=="undefined"){const i="https:"===location.protocol;let s=location.port;if(!s){s=i?"443":"80"}this.xd=typeof location!=="undefined"&&t.hostname!==location.hostname||s!==t.port}const i=t&&t.forceBase64;this.supportsBinary=et&&!i;if(this.opts.withCredentials){this.cookieJar=it()}}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const i=()=>{this.readyState="paused";t()};if(this.polling||!this.writable){let t=0;if(this.polling){t++;this.once("pollComplete",(function(){--t||i()}))}if(!this.writable){t++;this.once("drain",(function(){--t||i()}))}}else{i()}}poll(){this.polling=true;this.doPoll();this.emitReserved("poll")}onData(t){const i=t=>{if("opening"===this.readyState&&t.type==="open"){this.onOpen()}if("close"===t.type){this.onClose({description:"transport closed by the server"});return false}this.onPacket(t)};A(t,this.socket.binaryType).forEach(i);if("closed"!==this.readyState){this.polling=false;this.emitReserved("pollComplete");if("open"===this.readyState){this.poll()}}}doClose(){const t=()=>{this.write([{type:"close"}])};if("open"===this.readyState){t()}else{this.once("open",t)}}write(t){this.writable=false;O(t,(t=>{this.doWrite(t,(()=>{this.writable=true;this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http";const i=this.query||{};if(false!==this.opts.timestampRequests){i[this.opts.timestampParam]=K()}if(!this.supportsBinary&&!i.sid){i.b64=1}return this.createUri(t,i)}request(t={}){Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts);return new rt(this.uri(),t)}doWrite(t,i){const s=this.request({method:"POST",data:t});s.on("success",i);s.on("error",((t,i)=>{this.onError("xhr post error",t,i)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this));t.on("error",((t,i)=>{this.onError("xhr poll error",t,i)}));this.pollXhr=t}}class rt extends x{constructor(t,i){super();I(this,i);this.opts=i;this.method=i.method||"GET";this.uri=t;this.data=undefined!==i.data?i.data:null;this.create()}create(){var t;const i=L(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const s=this.xhr=new tt(i);try{s.open(this.method,this.uri,true);try{if(this.opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(true);for(let t in this.opts.extraHeaders){if(this.opts.extraHeaders.hasOwnProperty(t)){s.setRequestHeader(t,this.opts.extraHeaders[t])}}}}catch(t){}if("POST"===this.method){try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}}try{s.setRequestHeader("Accept","*/*")}catch(t){}(t=this.opts.cookieJar)===null||t===void 0?void 0:t.addCookies(s);if("withCredentials"in s){s.withCredentials=this.opts.withCredentials}if(this.opts.requestTimeout){s.timeout=this.opts.requestTimeout}s.onreadystatechange=()=>{var t;if(s.readyState===3){(t=this.opts.cookieJar)===null||t===void 0?void 0:t.parseCookies(s)}if(4!==s.readyState)return;if(200===s.status||1223===s.status){this.onLoad()}else{this.setTimeoutFn((()=>{this.onError(typeof s.status==="number"?s.status:0)}),0)}};s.send(this.data)}catch(t){this.setTimeoutFn((()=>{this.onError(t)}),0);return}if(typeof document!=="undefined"){this.index=rt.requestsCount++;rt.requests[this.index]=this}}onError(t){this.emitReserved("error",t,this.xhr);this.cleanup(true)}cleanup(t){if("undefined"===typeof this.xhr||null===this.xhr){return}this.xhr.onreadystatechange=st;if(t){try{this.xhr.abort()}catch(t){}}if(typeof document!=="undefined"){delete rt.requests[this.index]}this.xhr=null}onLoad(){const t=this.xhr.responseText;if(t!==null){this.emitReserved("data",t);this.emitReserved("success");this.cleanup()}}abort(){this.cleanup()}}rt.requestsCount=0;rt.requests={};if(typeof document!=="undefined"){if(typeof attachEvent==="function"){attachEvent("onunload",ot)}else if(typeof addEventListener==="function"){const t="onpagehide"in T?"pagehide":"unload";addEventListener(t,ot,false)}}function ot(){for(let t in rt.requests){if(rt.requests.hasOwnProperty(t)){rt.requests[t].abort()}}}const ht=(()=>{const t=typeof Promise==="function"&&typeof Promise.resolve==="function";if(t){return t=>Promise.resolve().then(t)}else{return(t,i)=>i(t,0)}})();const ct=T.WebSocket||T.MozWebSocket;const ft="arraybuffer";const ut=typeof navigator!=="undefined"&&typeof navigator.product==="string"&&navigator.product.toLowerCase()==="reactnative";class at extends F{constructor(t){super(t);this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check()){return}const t=this.uri();const i=this.opts.protocols;const s=ut?{}:L(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");if(this.opts.extraHeaders){s.headers=this.opts.extraHeaders}try{this.ws=!ut?i?new ct(t,i):new ct(t):new ct(t,i,s)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType;this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{if(this.opts.autoUnref){this.ws._socket.unref()}this.onOpen()};this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t});this.ws.onmessage=t=>this.onData(t.data);this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=false;for(let i=0;i<t.length;i++){const s=t[i];const e=i===t.length-1;f(s,this.supportsBinary,(t=>{try{{this.ws.send(t)}}catch(t){}if(e){ht((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){if(typeof this.ws!=="undefined"){this.ws.close();this.ws=null}}uri(){const t=this.opts.secure?"wss":"ws";const i=this.query||{};if(this.opts.timestampRequests){i[this.opts.timestampParam]=K()}if(!this.supportsBinary){i.b64=1}return this.createUri(t,i)}check(){return!!ct}}class lt extends F{get name(){return"webtransport"}doOpen(){if(typeof WebTransport!=="function"){return}this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]);this.transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)}));this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((t=>{const i=B(Number.MAX_SAFE_INTEGER,this.socket.binaryType);const s=t.readable.pipeThrough(i).getReader();const e=E();e.readable.pipeTo(t.writable);this.writer=e.writable.getWriter();const n=()=>{s.read().then((({done:t,value:i})=>{if(t){return}this.onPacket(i);n()})).catch((t=>{}))};n();const r={type:"open"};if(this.query.sid){r.data=`{"sid":"${this.query.sid}"}`}this.writer.write(r).then((()=>this.onOpen()))}))}))}write(t){this.writable=false;for(let i=0;i<t.length;i++){const s=t[i];const e=i===t.length-1;this.writer.write(s).then((()=>{if(e){ht((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){var t;(t=this.transport)===null||t===void 0?void 0:t.close()}}const dt={websocket:at,webtransport:lt,polling:nt};const pt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;const yt=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function bt(t){if(t.length>2e3){throw"URI too long"}const i=t,s=t.indexOf("["),e=t.indexOf("]");if(s!=-1&&e!=-1){t=t.substring(0,s)+t.substring(s,e).replace(/:/g,";")+t.substring(e,t.length)}let n=pt.exec(t||""),r={},o=14;while(o--){r[yt[o]]=n[o]||""}if(s!=-1&&e!=-1){r.source=i;r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":");r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":");r.ipv6uri=true}r.pathNames=wt(r,r["path"]);r.queryKey=gt(r,r["query"]);return r}function wt(t,i){const s=/\/{2,9}/g,e=i.replace(s,"/").split("/");if(i.slice(0,1)=="/"||i.length===0){e.splice(0,1)}if(i.slice(-1)=="/"){e.splice(e.length-1,1)}return e}function gt(t,i){const s={};i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,i,e){if(i){s[i]=e}}));return s}class mt extends x{constructor(t,i={}){super();this.binaryType=ft;this.writeBuffer=[];if(t&&"object"===typeof t){i=t;t=null}if(t){t=bt(t);i.hostname=t.host;i.secure=t.protocol==="https"||t.protocol==="wss";i.port=t.port;if(t.query)i.query=t.query}else if(i.host){i.hostname=bt(i.host).host}I(this,i);this.secure=null!=i.secure?i.secure:typeof location!=="undefined"&&"https:"===location.protocol;if(i.hostname&&!i.port){i.port=this.secure?"443":"80"}this.hostname=i.hostname||(typeof location!=="undefined"?location.hostname:"localhost");this.port=i.port||(typeof location!=="undefined"&&location.port?location.port:this.secure?"443":"80");this.transports=i.transports||["polling","websocket","webtransport"];this.writeBuffer=[];this.prevBufferLen=0;this.opts=Object.assign({path:"/engine.io",agent:false,withCredentials:false,upgrade:true,timestampParam:"t",rememberUpgrade:false,addTrailingSlash:true,rejectUnauthorized:true,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:false},i);this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":"");if(typeof this.opts.query==="string"){this.opts.query=$(this.opts.query)}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingTimeoutTimer=null;if(typeof addEventListener==="function"){if(this.opts.closeOnBeforeunload){this.beforeunloadEventListener=()=>{if(this.transport){this.transport.removeAllListeners();this.transport.close()}};addEventListener("beforeunload",this.beforeunloadEventListener,false)}if(this.hostname!=="localhost"){this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})};addEventListener("offline",this.offlineEventListener,false)}}this.open()}createTransport(t){const i=Object.assign({},this.opts.query);i.EIO=C;i.transport=t;if(this.id)i.sid=this.id;const s=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new dt[t](s)}open(){let t;if(this.opts.rememberUpgrade&&mt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){t="websocket"}else if(0===this.transports.length){this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);return}else{t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){this.transports.shift();this.open();return}t.open();this.setTransport(t)}setTransport(t){if(this.transport){this.transport.removeAllListeners()}this.transport=t;t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let i=this.createTransport(t);let s=false;mt.priorWebsocketSuccess=false;const e=()=>{if(s)return;i.send([{type:"ping",data:"probe"}]);i.once("packet",(t=>{if(s)return;if("pong"===t.type&&"probe"===t.data){this.upgrading=true;this.emitReserved("upgrading",i);if(!i)return;mt.priorWebsocketSuccess="websocket"===i.name;this.transport.pause((()=>{if(s)return;if("closed"===this.readyState)return;f();this.setTransport(i);i.send([{type:"upgrade"}]);this.emitReserved("upgrade",i);i=null;this.upgrading=false;this.flush()}))}else{const t=new Error("probe error");t.transport=i.name;this.emitReserved("upgradeError",t)}}))};function n(){if(s)return;s=true;f();i.close();i=null}const r=t=>{const s=new Error("probe error: "+t);s.transport=i.name;n();this.emitReserved("upgradeError",s)};function o(){r("transport closed")}function h(){r("socket closed")}function c(t){if(i&&t.name!==i.name){n()}}const f=()=>{i.removeListener("open",e);i.removeListener("error",r);i.removeListener("close",o);this.off("close",h);this.off("upgrading",c)};i.once("open",e);i.once("error",r);i.once("close",o);this.once("close",h);this.once("upgrading",c);if(this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"){this.setTimeoutFn((()=>{if(!s){i.open()}}),200)}else{i.open()}}onOpen(){this.readyState="open";mt.priorWebsocketSuccess="websocket"===this.transport.name;this.emitReserved("open");this.flush();if("open"===this.readyState&&this.opts.upgrade){let t=0;const i=this.upgrades.length;for(;t<i;t++){this.probe(this.upgrades[t])}}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.emitReserved("packet",t);this.emitReserved("heartbeat");this.resetPingTimeout();switch(t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong");this.emitReserved("ping");this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=t.data;this.onError(i);break;case"message":this.emitReserved("data",t.data);this.emitReserved("message",t.data);break}}}onHandshake(t){this.emitReserved("handshake",t);this.id=t.sid;this.transport.query.sid=t.sid;this.upgrades=this.filterUpgrades(t.upgrades);this.pingInterval=t.pingInterval;this.pingTimeout=t.pingTimeout;this.maxPayload=t.maxPayload;this.onOpen();if("closed"===this.readyState)return;this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer);this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout);if(this.opts.autoUnref){this.pingTimeoutTimer.unref()}}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emitReserved("drain")}else{this.flush()}}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t);this.prevBufferLen=t.length;this.emitReserved("flush")}}getWritablePackets(){const t=this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1;if(!t){return this.writeBuffer}let i=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s){i+=P(s)}if(t>0&&i>this.maxPayload){return this.writeBuffer.slice(0,t)}i+=2}return this.writeBuffer}write(t,i,s){this.sendPacket("message",t,i,s);return this}send(t,i,s){this.sendPacket("message",t,i,s);return this}sendPacket(t,i,s,e){if("function"===typeof i){e=i;i=undefined}if("function"===typeof s){e=s;s=null}if("closing"===this.readyState||"closed"===this.readyState){return}s=s||{};s.compress=false!==s.compress;const n={type:t,data:i,options:s};this.emitReserved("packetCreate",n);this.writeBuffer.push(n);if(e)this.once("flush",e);this.flush()}close(){const t=()=>{this.onClose("forced close");this.transport.close()};const i=()=>{this.off("upgrade",i);this.off("upgradeError",i);t()};const s=()=>{this.once("upgrade",i);this.once("upgradeError",i)};if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";if(this.writeBuffer.length){this.once("drain",(()=>{if(this.upgrading){s()}else{t()}}))}else if(this.upgrading){s()}else{t()}}return this}onError(t){mt.priorWebsocketSuccess=false;this.emitReserved("error",t);this.onClose("transport error",t)}onClose(t,i){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.clearTimeoutFn(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();if(typeof removeEventListener==="function"){removeEventListener("beforeunload",this.beforeunloadEventListener,false);removeEventListener("offline",this.offlineEventListener,false)}this.readyState="closed";this.id=null;this.emitReserved("close",t,i);this.writeBuffer=[];this.prevBufferLen=0}}filterUpgrades(t){const i=[];let s=0;const e=t.length;for(;s<e;s++){if(~this.transports.indexOf(t[s]))i.push(t[s])}return i}}mt.protocol=C;function vt(t,i="",s){let e=t;s=s||typeof location!=="undefined"&&location;if(null==t)t=s.protocol+"//"+s.host;if(typeof t==="string"){if("/"===t.charAt(0)){if("/"===t.charAt(1)){t=s.protocol+t}else{t=s.host+t}}if(!/^(https?|wss?):\/\//.test(t)){if("undefined"!==typeof s){t=s.protocol+"//"+t}else{t="https://"+t}}e=bt(t)}if(!e.port){if(/^(http|ws)$/.test(e.protocol)){e.port="80"}else if(/^(http|ws)s$/.test(e.protocol)){e.port="443"}}e.path=e.path||"/";const n=e.host.indexOf(":")!==-1;const r=n?"["+e.host+"]":e.host;e.id=e.protocol+"://"+r+":"+e.port+i;e.href=e.protocol+"://"+r+(s&&s.port===e.port?"":":"+e.port);return e}const kt=typeof ArrayBuffer==="function";const Ot=t=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer;const At=Object.prototype.toString;const Et=typeof Blob==="function"||typeof Blob!=="undefined"&&At.call(Blob)==="[object BlobConstructor]";const jt=typeof File==="function"||typeof File!=="undefined"&&At.call(File)==="[object FileConstructor]";function _t(t){return kt&&(t instanceof ArrayBuffer||Ot(t))||Et&&t instanceof Blob||jt&&t instanceof File}function Nt(t,i){if(!t||typeof t!=="object"){return false}if(Array.isArray(t)){for(let i=0,s=t.length;i<s;i++){if(Nt(t[i])){return true}}return false}if(_t(t)){return true}if(t.toJSON&&typeof t.toJSON==="function"&&arguments.length===1){return Nt(t.toJSON(),true)}for(const i in t){if(Object.prototype.hasOwnProperty.call(t,i)&&Nt(t[i])){return true}}return false}function Bt(t){const i=[];const s=t.data;const e=t;e.data=Ct(s,i);e.attachments=i.length;return{packet:e,buffers:i}}function Ct(t,i){if(!t)return t;if(_t(t)){const s={_placeholder:true,num:i.length};i.push(t);return s}else if(Array.isArray(t)){const s=new Array(t.length);for(let e=0;e<t.length;e++){s[e]=Ct(t[e],i)}return s}else if(typeof t==="object"&&!(t instanceof Date)){const s={};for(const e in t){if(Object.prototype.hasOwnProperty.call(t,e)){s[e]=Ct(t[e],i)}}return s}return t}function xt(t,i){t.data=St(t.data,i);delete t.attachments;return t}function St(t,i){if(!t)return t;if(t&&t._placeholder===true){const s=typeof t.num==="number"&&t.num>=0&&t.num<i.length;if(s){return i[t.num]}else{throw new Error("illegal attachments")}}else if(Array.isArray(t)){for(let s=0;s<t.length;s++){t[s]=St(t[s],i)}}else if(typeof t==="object"){for(const s in t){if(Object.prototype.hasOwnProperty.call(t,s)){t[s]=St(t[s],i)}}}return t}const Tt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];const Lt=5;var Ut;(function(t){t[t["CONNECT"]=0]="CONNECT";t[t["DISCONNECT"]=1]="DISCONNECT";t[t["EVENT"]=2]="EVENT";t[t["ACK"]=3]="ACK";t[t["CONNECT_ERROR"]=4]="CONNECT_ERROR";t[t["BINARY_EVENT"]=5]="BINARY_EVENT";t[t["BINARY_ACK"]=6]="BINARY_ACK"})(Ut||(Ut={}));class Dt{constructor(t){this.replacer=t}encode(t){if(t.type===Ut.EVENT||t.type===Ut.ACK){if(Nt(t)){return this.encodeAsBinary({type:t.type===Ut.EVENT?Ut.BINARY_EVENT:Ut.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}}return[this.encodeAsString(t)]}encodeAsString(t){let i=""+t.type;if(t.type===Ut.BINARY_EVENT||t.type===Ut.BINARY_ACK){i+=t.attachments+"-"}if(t.nsp&&"/"!==t.nsp){i+=t.nsp+","}if(null!=t.id){i+=t.id}if(null!=t.data){i+=JSON.stringify(t.data,this.replacer)}return i}encodeAsBinary(t){const i=Bt(t);const s=this.encodeAsString(i.packet);const e=i.buffers;e.unshift(s);return e}}function It(t){return Object.prototype.toString.call(t)==="[object Object]"}class Mt extends x{constructor(t){super();this.reviver=t}add(t){let i;if(typeof t==="string"){if(this.reconstructor){throw new Error("got plaintext data when reconstructing a packet")}i=this.decodeString(t);const s=i.type===Ut.BINARY_EVENT;if(s||i.type===Ut.BINARY_ACK){i.type=s?Ut.EVENT:Ut.ACK;this.reconstructor=new Pt(i);if(i.attachments===0){super.emitReserved("decoded",i)}}else{super.emitReserved("decoded",i)}}else if(_t(t)||t.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{i=this.reconstructor.takeBinaryData(t);if(i){this.reconstructor=null;super.emitReserved("decoded",i)}}}else{throw new Error("Unknown type: "+t)}}decodeString(t){let i=0;const s={type:Number(t.charAt(0))};if(Ut[s.type]===undefined){throw new Error("unknown packet type "+s.type)}if(s.type===Ut.BINARY_EVENT||s.type===Ut.BINARY_ACK){const e=i+1;while(t.charAt(++i)!=="-"&&i!=t.length){}const n=t.substring(e,i);if(n!=Number(n)||t.charAt(i)!=="-"){throw new Error("Illegal attachments")}s.attachments=Number(n)}if("/"===t.charAt(i+1)){const e=i+1;while(++i){const s=t.charAt(i);if(","===s)break;if(i===t.length)break}s.nsp=t.substring(e,i)}else{s.nsp="/"}const e=t.charAt(i+1);if(""!==e&&Number(e)==e){const e=i+1;while(++i){const s=t.charAt(i);if(null==s||Number(s)!=s){--i;break}if(i===t.length)break}s.id=Number(t.substring(e,i+1))}if(t.charAt(++i)){const e=this.tryParse(t.substr(i));if(Mt.isPayloadValid(s.type,e)){s.data=e}else{throw new Error("invalid payload")}}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return false}}static isPayloadValid(t,i){switch(t){case Ut.CONNECT:return It(i);case Ut.DISCONNECT:return i===undefined;case Ut.CONNECT_ERROR:return typeof i==="string"||It(i);case Ut.EVENT:case Ut.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]==="number"||typeof i[0]==="string"&&Tt.indexOf(i[0])===-1);case Ut.ACK:case Ut.BINARY_ACK:return Array.isArray(i)}}destroy(){if(this.reconstructor){this.reconstructor.finishedReconstruction();this.reconstructor=null}}}class Pt{constructor(t){this.packet=t;this.buffers=[];this.reconPack=t}takeBinaryData(t){this.buffers.push(t);if(this.buffers.length===this.reconPack.attachments){const t=xt(this.reconPack,this.buffers);this.finishedReconstruction();return t}return null}finishedReconstruction(){this.reconPack=null;this.buffers=[]}}const Rt=Object.freeze({__proto__:null,protocol:Lt,get PacketType(){return Ut},Encoder:Dt,Decoder:Mt});function Vt(t,i,s){t.on(i,s);return function e(){t.off(i,s)}}const $t=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class qt extends x{constructor(t,i,s){super();this.connected=false;this.recovered=false;this.receiveBuffer=[];this.sendBuffer=[];this._queue=[];this._queueSeq=0;this.ids=0;this.acks={};this.flags={};this.io=t;this.nsp=i;if(s&&s.auth){this.auth=s.auth}this._opts=Object.assign({},s);if(this.io._autoConnect)this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Vt(t,"open",this.onopen.bind(this)),Vt(t,"packet",this.onpacket.bind(this)),Vt(t,"error",this.onerror.bind(this)),Vt(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){if(this.connected)return this;this.subEvents();if(!this.io["_reconnecting"])this.io.open();if("open"===this.io._readyState)this.onopen();return this}open(){return this.connect()}send(...t){t.unshift("message");this.emit.apply(this,t);return this}emit(t,...i){if($t.hasOwnProperty(t)){throw new Error('"'+t.toString()+'" is a reserved event name')}i.unshift(t);if(this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile){this._addToQueue(i);return this}const s={type:Ut.EVENT,data:i};s.options={};s.options.compress=this.flags.compress!==false;if("function"===typeof i[i.length-1]){const t=this.ids++;const e=i.pop();this._registerAckCallback(t,e);s.id=t}const e=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;const n=this.flags.volatile&&(!e||!this.connected);if(n);else if(this.connected){this.notifyOutgoingListeners(s);this.packet(s)}else{this.sendBuffer.push(s)}this.flags={};return this}_registerAckCallback(t,i){var s;const e=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(e===undefined){this.acks[t]=i;return}const n=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let i=0;i<this.sendBuffer.length;i++){if(this.sendBuffer[i].id===t){this.sendBuffer.splice(i,1)}}i.call(this,new Error("operation has timed out"))}),e);const r=(...t)=>{this.io.clearTimeoutFn(n);i.apply(this,t)};r.withError=true;this.acks[t]=r}emitWithAck(t,...i){return new Promise(((s,e)=>{const n=(t,i)=>t?e(t):s(i);n.withError=true;i.push(n);this.emit(t,...i)}))}_addToQueue(t){let i;if(typeof t[t.length-1]==="function"){i=t.pop()}const s={id:this._queueSeq++,tryCount:0,pending:false,args:t,flags:Object.assign({fromQueue:true},this.flags)};t.push(((t,...e)=>{if(s!==this._queue[0]){return}const n=t!==null;if(n){if(s.tryCount>this._opts.retries){this._queue.shift();if(i){i(t)}}}else{this._queue.shift();if(i){i(null,...e)}}s.pending=false;return this._drainQueue()}));this._queue.push(s);this._drainQueue()}_drainQueue(t=false){if(!this.connected||this._queue.length===0){return}const i=this._queue[0];if(i.pending&&!t){return}i.pending=true;i.tryCount++;this.flags=i.flags;this.emit.apply(this,i.args)}packet(t){t.nsp=this.nsp;this.io._packet(t)}onopen(){if(typeof this.auth=="function"){this.auth((t=>{this._sendConnectPacket(t)}))}else{this._sendConnectPacket(this.auth)}}_sendConnectPacket(t){this.packet({type:Ut.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){if(!this.connected){this.emitReserved("connect_error",t)}}onclose(t,i){this.connected=false;delete this.id;this.emitReserved("disconnect",t,i);this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{const i=this.sendBuffer.some((i=>String(i.id)===t));if(!i){const i=this.acks[t];delete this.acks[t];if(i.withError){i.call(this,new Error("socket has been disconnected"))}}}))}onpacket(t){const i=t.nsp===this.nsp;if(!i)return;switch(t.type){case Ut.CONNECT:if(t.data&&t.data.sid){this.onconnect(t.data.sid,t.data.pid)}else{this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"))}break;case Ut.EVENT:case Ut.BINARY_EVENT:this.onevent(t);break;case Ut.ACK:case Ut.BINARY_ACK:this.onack(t);break;case Ut.DISCONNECT:this.ondisconnect();break;case Ut.CONNECT_ERROR:this.destroy();const i=new Error(t.data.message);i.data=t.data.data;this.emitReserved("connect_error",i);break}}onevent(t){const i=t.data||[];if(null!=t.id){i.push(this.ack(t.id))}if(this.connected){this.emitEvent(i)}else{this.receiveBuffer.push(Object.freeze(i))}}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const s of i){s.apply(this,t)}}super.emit.apply(this,t);if(this._pid&&t.length&&typeof t[t.length-1]==="string"){this._lastOffset=t[t.length-1]}}ack(t){const i=this;let s=false;return function(...e){if(s)return;s=true;i.packet({type:Ut.ACK,id:t,data:e})}}onack(t){const i=this.acks[t.id];if(typeof i!=="function"){return}delete this.acks[t.id];if(i.withError){t.data.unshift(null)}i.apply(this,t.data)}onconnect(t,i){this.id=t;this.recovered=i&&this._pid===i;this._pid=i;this.connected=true;this.emitBuffered();this.emitReserved("connect");this._drainQueue(true)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t)));this.receiveBuffer=[];this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t);this.packet(t)}));this.sendBuffer=[]}ondisconnect(){this.destroy();this.onclose("io server disconnect")}destroy(){if(this.subs){this.subs.forEach((t=>t()));this.subs=undefined}this.io["_destroy"](this)}disconnect(){if(this.connected){this.packet({type:Ut.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}close(){return this.disconnect()}compress(t){this.flags.compress=t;return this}get volatile(){this.flags.volatile=true;return this}timeout(t){this.flags.timeout=t;return this}onAny(t){this._anyListeners=this._anyListeners||[];this._anyListeners.push(t);return this}prependAny(t){this._anyListeners=this._anyListeners||[];this._anyListeners.unshift(t);return this}offAny(t){if(!this._anyListeners){return this}if(t){const i=this._anyListeners;for(let s=0;s<i.length;s++){if(t===i[s]){i.splice(s,1);return this}}}else{this._anyListeners=[]}return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.push(t);return this}prependAnyOutgoing(t){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.unshift(t);return this}offAnyOutgoing(t){if(!this._anyOutgoingListeners){return this}if(t){const i=this._anyOutgoingListeners;for(let s=0;s<i.length;s++){if(t===i[s]){i.splice(s,1);return this}}}else{this._anyOutgoingListeners=[]}return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const s of i){s.apply(this,t.data)}}}}function Ft(t){t=t||{};this.ms=t.min||100;this.max=t.max||1e4;this.factor=t.factor||2;this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0;this.attempts=0}Ft.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random();var s=Math.floor(i*this.jitter*t);t=(Math.floor(i*10)&1)==0?t-s:t+s}return Math.min(t,this.max)|0};Ft.prototype.reset=function(){this.attempts=0};Ft.prototype.setMin=function(t){this.ms=t};Ft.prototype.setMax=function(t){this.max=t};Ft.prototype.setJitter=function(t){this.jitter=t};class Jt extends x{constructor(t,i){var s;super();this.nsps={};this.subs=[];if(t&&"object"===typeof t){i=t;t=undefined}i=i||{};i.path=i.path||"/socket.io";this.opts=i;I(this,i);this.reconnection(i.reconnection!==false);this.reconnectionAttempts(i.reconnectionAttempts||Infinity);this.reconnectionDelay(i.reconnectionDelay||1e3);this.reconnectionDelayMax(i.reconnectionDelayMax||5e3);this.randomizationFactor((s=i.randomizationFactor)!==null&&s!==void 0?s:.5);this.backoff=new Ft({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==i.timeout?2e4:i.timeout);this._readyState="closed";this.uri=t;const e=i.parser||Rt;this.encoder=new e.Encoder;this.decoder=new e.Decoder;this._autoConnect=i.autoConnect!==false;if(this._autoConnect)this.open()}reconnection(t){if(!arguments.length)return this._reconnection;this._reconnection=!!t;return this}reconnectionAttempts(t){if(t===undefined)return this._reconnectionAttempts;this._reconnectionAttempts=t;return this}reconnectionDelay(t){var i;if(t===undefined)return this._reconnectionDelay;this._reconnectionDelay=t;(i=this.backoff)===null||i===void 0?void 0:i.setMin(t);return this}randomizationFactor(t){var i;if(t===undefined)return this._randomizationFactor;this._randomizationFactor=t;(i=this.backoff)===null||i===void 0?void 0:i.setJitter(t);return this}reconnectionDelayMax(t){var i;if(t===undefined)return this._reconnectionDelayMax;this._reconnectionDelayMax=t;(i=this.backoff)===null||i===void 0?void 0:i.setMax(t);return this}timeout(t){if(!arguments.length)return this._timeout;this._timeout=t;return this}maybeReconnectOnOpen(){if(!this._reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new mt(this.uri,this.opts);const i=this.engine;const s=this;this._readyState="opening";this.skipReconnect=false;const e=Vt(i,"open",(function(){s.onopen();t&&t()}));const n=i=>{this.cleanup();this._readyState="closed";this.emitReserved("error",i);if(t){t(i)}else{this.maybeReconnectOnOpen()}};const r=Vt(i,"error",n);if(false!==this._timeout){const t=this._timeout;const s=this.setTimeoutFn((()=>{e();n(new Error("timeout"));i.close()}),t);if(this.opts.autoUnref){s.unref()}this.subs.push((()=>{this.clearTimeoutFn(s)}))}this.subs.push(e);this.subs.push(r);return this}connect(t){return this.open(t)}onopen(){this.cleanup();this._readyState="open";this.emitReserved("open");const t=this.engine;this.subs.push(Vt(t,"ping",this.onping.bind(this)),Vt(t,"data",this.ondata.bind(this)),Vt(t,"error",this.onerror.bind(this)),Vt(t,"close",this.onclose.bind(this)),Vt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){ht((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,i){let s=this.nsps[t];if(!s){s=new qt(this,t,i);this.nsps[t]=s}else if(this._autoConnect&&!s.active){s.connect()}return s}_destroy(t){const i=Object.keys(this.nsps);for(const t of i){const i=this.nsps[t];if(i.active){return}}this._close()}_packet(t){const i=this.encoder.encode(t);for(let s=0;s<i.length;s++){this.engine.write(i[s],t.options)}}cleanup(){this.subs.forEach((t=>t()));this.subs.length=0;this.decoder.destroy()}_close(){this.skipReconnect=true;this._reconnecting=false;this.onclose("forced close");if(this.engine)this.engine.close()}disconnect(){return this._close()}onclose(t,i){this.cleanup();this.backoff.reset();this._readyState="closed";this.emitReserved("close",t,i);if(this._reconnection&&!this.skipReconnect){this.reconnect()}}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts){this.backoff.reset();this.emitReserved("reconnect_failed");this._reconnecting=false}else{const i=this.backoff.duration();this._reconnecting=true;const s=this.setTimeoutFn((()=>{if(t.skipReconnect)return;this.emitReserved("reconnect_attempt",t.backoff.attempts);if(t.skipReconnect)return;t.open((i=>{if(i){t._reconnecting=false;t.reconnect();this.emitReserved("reconnect_error",i)}else{t.onreconnect()}}))}),i);if(this.opts.autoUnref){s.unref()}this.subs.push((()=>{this.clearTimeoutFn(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=false;this.backoff.reset();this.emitReserved("reconnect",t)}}const zt={};function Ht(t,i){if(typeof t==="object"){i=t;t=undefined}i=i||{};const s=vt(t,i.path||"/socket.io");const e=s.source;const n=s.id;const r=s.path;const o=zt[n]&&r in zt[n]["nsps"];const h=i.forceNew||i["force new connection"]||false===i.multiplex||o;let c;if(h){c=new Jt(e,i)}else{if(!zt[n]){zt[n]=new Jt(e,i)}c=zt[n]}if(s.query&&!i.query){i.query=s.queryKey}return c.socket(s.path,i)}Object.assign(Ht,{Manager:Jt,Socket:qt,io:Ht,connect:Ht});class Xt{constructor(){this.isConnected=false;this.initializeSocket()}initializeSocket(){this.socket=Ht("https://realtime.igloorooms.com/",{reconnectionAttempts:5,reconnectionDelay:2e3});this.socket.on("connect",(()=>{console.log("Connected to the socket server");this.isConnected=true}));this.socket.on("connect_error",(t=>{console.error("Connection error:",t)}));this.socket.on("disconnect",(t=>{console.log("Disconnected:",t);this.isConnected=false}))}static getInstance(){if(!Xt.instance){Xt.instance=new Xt}return Xt.instance}reconnect(){console.log("Attempting to reconnect...");this.initializeSocket()}close(){this.socket.close()}}class Qt{constructor(){this.queue=new s;this.intervalId=null;this.PROCESSING_INTERVAL=400;this.subscribers=[];this.roomTypes=[];this.socketManager=Xt.getInstance()}subscribe(t){this.subscribers.push(t)}unsubscribe(t){this.subscribers=this.subscribers.filter((i=>i!==t))}disconnectSocket(){this.socketManager.socket.on("disconnect",(t=>{console.log("Disconnected:",t);if(this.intervalId){clearInterval(this.intervalId)}}));this.socketManager.socket.close()}initSocket(t,i=false){if(!this.socketManager.isConnected){this.socketManager.reconnect()}if(!i){this.resetVariations()}this.socketManager.socket.on("MSG",(s=>{try{const e=JSON.parse(s);if(e&&e.KEY&&e.KEY.toString()===t){if(i){return console.log(JSON.parse(e.PAYLOAD))}this.notifySubscribers();this.queue.enqueue(e.PAYLOAD)}}catch(t){console.error("Error parsing message:",t)}}));this.startProcessingQueue()}startProcessingQueue(){this.intervalId=setInterval((()=>this.processQueue()),this.PROCESSING_INTERVAL)}async processQueue(){const t=[];while(!this.queue.isEmpty()){const i=this.queue.dequeue();if(i){t.push(JSON.parse(i))}}if(t.length>0){await this.processPayloads(t)}}notifySubscribers(){this.subscribers.forEach((t=>t(false)))}resetVariations(){t.resetBooking=true;this.roomTypes=[...t.roomTypes];this.roomTypes=this.roomTypes.map((t=>Object.assign(Object.assign({},t),{rateplans:t.rateplans.map((t=>Object.assign(Object.assign({},t),{variations:[]})))})))}validateNumberString(t){const s=i.string().refine((t=>{const i=t.replace(/,/g,"");return!isNaN(Number(i))}),{message:"Invalid number format"});const e=s.safeParse(t);if(!e.success){throw new Error(`${t} is an invalid number format`)}return Number(e.data.replace(/,/g,""))}async processPayloads(i){try{if(!t.enableBooking){t.enableBooking=true}i.forEach((i=>{var s,e,n,r,o,h,c,f,u,a,l,d,p,y,b;if(i.ROOM_CATEGORY_ID===2345){console.log(i)}const w=this.roomTypes.findIndex((t=>t.id===i.ROOM_CATEGORY_ID));if(w===-1){console.error("Invalid room type");return}let g=this.roomTypes[w];const m=g.rateplans.findIndex((t=>t.id===i.ROOM_TYPE_ID));if(m===-1){return}let v=g.rateplans[m];let k=v.variations||[];const O={adult_child_offering:i.ADULT_CHILD_OFFERING,adult_nbr:Number((s=i.ADULTS_NBR)!==null&&s!==void 0?s:0),amount:(()=>{var t,s,e;const n=(e=this.validateNumberString((s=(t=i.ALLOT_RATE_V)!==null&&t!==void 0?t:0)===null||s===void 0?void 0:s.toString()))!==null&&e!==void 0?e:0;return n===0?null:n})(),child_nbr:Number((e=i.CHILD_NBR)!==null&&e!==void 0?e:0),amount_per_night:(h=this.validateNumberString((o=(r=(n=i.AMOUNT_PER_NIGHT_VAL)!==null&&n!==void 0?n:0)===null||r===void 0?void 0:r.toString())!==null&&o!==void 0?o:"").toString())!==null&&h!==void 0?h:"",discount_pct:(u=this.validateNumberString((f=(c=i.DISCOUNT)!==null&&c!==void 0?c:0)===null||f===void 0?void 0:f.toString()))!==null&&u!==void 0?u:0,is_lmd:i.IS_LMD,nights_nbr:(d=this.validateNumberString((l=(a=i.NIGHTS_NBR)!==null&&a!==void 0?a:0)===null||l===void 0?void 0:l.toString()))!==null&&d!==void 0?d:0,total_before_discount:(b=this.validateNumberString((y=(p=i.TOTAL_BEFORE_DISCOUNT)!==null&&p!==void 0?p:0)===null||y===void 0?void 0:y.toString()))!==null&&b!==void 0?b:0,is_calculated:i.IS_CALCULATED,MLS_ALERT:i.MLS_ALERT,IS_MLS_VIOLATED:i.IS_MLS_VIOLATED};const A=k.findIndex((t=>t.adult_child_offering===i.ADULT_CHILD_OFFERING));if(A===-1){k.push(O)}else{k[A]=O}k=k.filter((i=>Number(i.adult_nbr)<=Number(t.bookingAvailabilityParams.adult_nbr)&&Number(i.child_nbr)<=Number(t.bookingAvailabilityParams.child_nbr)));v=Object.assign(Object.assign({},v),{variations:k});g.rateplans[m]=v;this.roomTypes[w]=Object.assign(Object.assign({},g),{inventory:1})}));t.resetBooking=true;t.roomTypes=[...this.roomTypes]}catch(t){console.error("Error processing payloads:",t)}}}export{Qt as A};
//# sourceMappingURL=p-43424fb4.js.map