import{h as n}from"./p-6c4ba7c0.js";import{b as o,i as t}from"./p-3dbb5ff4.js";import{a as _}from"./p-bf44a732.js";import{l as i}from"./p-e19fbf2a.js";import{c as T}from"./p-0db2e55e.js";import{c as E}from"./p-7482373c.js";const e={days:[],months:[],fromDate:"",toDate:""};const{state:s,onChange:a}=T(e);async function r(n){const o=[];const t=await u();for(const _ of n){for(const n of _.days){for(const _ of n.room_types){O(_.physicalrooms,o,t)}}}return o}function O(n,o,t){for(const _ of n){for(const n in _.calendar_cell){if(_.calendar_cell[n].Is_Available===false){Y(_.calendar_cell[n],o,t)}}}}const c={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const l={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function D(n,o){if(n===null&&o===null)return"";if(o!==null&&o!==""){return`${n!==null&&n!==void 0?n:""} , ${o!==null&&o!==void 0?o:""}`}return n}async function u(){try{const{data:n}=await _.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return n.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}catch(n){console.log(n)}}function d(o,t,_){const T=new Date(o);T.setHours(t);T.setMinutes(_);return`${i.entries.Lcz_BlockedTill} ${n(T).format("MMM DD, HH:mm")}`}function A(_,i){var T,E,e,s,a,r,O,u;if(t(_.STAY_STATUS_CODE)){const t=n(_.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(_.DATE)?_.My_Block_Info.from_date:_.DATE;const T=n(_.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(_.DATE)?_.My_Block_Info.to_date:_.DATE;return{ID:_.POOL,NOTES:"",BALANCE:"",NAME:_.My_Block_Info.NOTES!==""?_.My_Block_Info.NOTES:_.STAY_STATUS_CODE==="003"?d(_.My_Block_Info.BLOCKED_TILL_DATE,_.My_Block_Info.BLOCKED_TILL_HOUR,_.My_Block_Info.BLOCKED_TILL_MINUTE):i.find((n=>n.code===_.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:_.My_Block_Info.DESCRIPTION,PR_ID:_.My_Block_Info.pr_id,ENTRY_DATE:_.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:_.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:_.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:_.My_Block_Info.NOTES,FROM_DATE:t,TO_DATE:T,NO_OF_DAYS:o(t,T),STATUS:c[_.STAY_STATUS_CODE],POOL:_.POOL,STATUS_CODE:_.STAY_STATUS_CODE,OUT_OF_SERVICE:_.STAY_STATUS_CODE==="004",FROM_DATE_STR:_.My_Block_Info.format.from_date,TO_DATE_STR:_.My_Block_Info.format.to_date,defaultDates:{from_date:_.My_Block_Info.from_date,to_date:_.My_Block_Info.to_date}}}if(_.booking.booking_nbr.toString()==="77054273380"){console.log("booking",_)}const A=n(_.room.from_date,"YYYY-MM-DD").isAfter(_.DATE)?_.room.from_date:_.DATE;const R=n(_.room.to_date,"YYYY-MM-DD").isAfter(_.DATE)?_.room.to_date:_.DATE;const Y=(T=_.room.sharing_persons)===null||T===void 0?void 0:T.find((n=>n.is_main));return{ID:_.POOL,FROM_DATE:A,TO_DATE:R,NO_OF_DAYS:o(A,R),STATUS:l[(E=_.booking)===null||E===void 0?void 0:E.status.code],NAME:D(Y===null||Y===void 0?void 0:Y.first_name,Y.last_name),IDENTIFIER:_.room.identifier,PR_ID:_.pr_id,POOL:_.POOL,BOOKING_NUMBER:_.booking.booking_nbr,NOTES:_.booking.is_direct?_.booking.remark:null,PRIVATE_NOTE:f(_.booking.extras),is_direct:_.booking.is_direct,BALANCE:(e=_.booking.financial)===null||e===void 0?void 0:e.due_amount,channel_booking_nbr:_.booking.channel_booking_nbr,ARRIVAL_TIME:_.booking.arrival.description,defaultDates:{from_date:_.room.from_date,to_date:_.room.to_date},ENTRY_DATE:_.booking.booked_on.date,PHONE_PREFIX:_.booking.guest.country_phone_prefix,IS_EDITABLE:_.booking.is_editable,ARRIVAL:_.booking.arrival,PHONE:(s=_.booking.guest.mobile_without_prefix)!==null&&s!==void 0?s:"",RATE:_.room.total,RATE_PLAN:_.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:_.room.rateplan.id,RATE_TYPE:1,ADULTS_COUNT:_.room.occupancy.adult_nbr,CHILDREN_COUNT:_.room.occupancy.children_nbr,origin:_.booking.origin,GUEST:_.booking.guest,ROOMS:_.booking.rooms,cancelation:_.room.rateplan.cancelation,guarantee:_.room.rateplan.guarantee,TOTAL_PRICE:(a=_.booking.financial)===null||a===void 0?void 0:a.gross_total,COUNTRY:_.booking.guest.country_id,FROM_DATE_STR:_.booking.format.from_date,TO_DATE_STR:_.booking.format.to_date,adult_child_offering:_.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:_.booking.source.code,description:_.booking.source.description,tag:_.booking.source.tag},CHECKIN:((r=_.room.in_out)===null||r===void 0?void 0:r.code)==="001",CHECKOUT:((O=_.room.in_out)===null||O===void 0?void 0:O.code)==="002",ROOM_INFO:{occupancy:_.room.occupancy,sharing_persons:_.room.sharing_persons,unit:_.room.unit,in_out:_.room.in_out},BASE_STATUS_CODE:(u=_.booking.status)===null||u===void 0?void 0:u.code}}function R(o){var t,_,i,T;const{in_out:e,status_code:s,from_date:a,to_date:r}=o;if(E.checkin_enabled){if((e===null||e===void 0?void 0:e.code)==="001"){return l["000"]}else if((e===null||e===void 0?void 0:e.code)==="002"){if(!E.is_automatic_check_in_out){const o=n();const i=n(r,"YYYY-MM-DD");const T=n(a,"YYYY-MM-DD");const e=I(o.toDate(),v((t=E.checkin_checkout_hours)===null||t===void 0?void 0:t.offset,(_=E.checkin_checkout_hours)===null||_===void 0?void 0:_.hour));if(o.isSame(i,"days")&&o.isAfter(T,"days")&&e||o.isAfter(i,"days")){return l["003"]}else{return l["002"]}}}return l[s||"001"]}else{const o=n();const t=n(r,"YYYY-MM-DD");const _=n(a,"YYYY-MM-DD");const e=I(o.toDate(),v((i=E.checkin_checkout_hours)===null||i===void 0?void 0:i.offset,(T=E.checkin_checkout_hours)===null||T===void 0?void 0:T.hour));if(_.isSame(o,"day")&&e){return l["000"]}else if(o.isAfter(_,"day")&&o.isBefore(t,"day")){return l["000"]}else if(t.isSame(o,"day")&&e){return l["000"]}else if(t.isSame(o,"day")&&e||t.isBefore(o,"day")){return l["003"]}else{return l[s||"001"]}}}function Y(n,o,t){const _=o.findIndex((o=>o.POOL===n.POOL));if(_===-1){const _=A(n,t);o.push(_)}}function f(n){var o;if(!n){return null}return((o=n.find((n=>n.key==="private_note")))===null||o===void 0?void 0:o.value)||null}function N(t){let _=[];const i=t.rooms.filter((n=>!!n["assigned_units_pool"]));i.forEach((i=>{var T,E,e,a,r,O;const c=n(i.from_date,"YYYY-MM-DD").isAfter(n(s.fromDate,"YYYY-MM-DD"))?i.from_date:s.fromDate;const l=i.to_date;if(n(i.to_date,"YYYY-MM-DD").isBefore(n(s.fromDate,"YYYY-MM-DD"))){return}const u=(T=i.sharing_persons)===null||T===void 0?void 0:T.find((n=>n.is_main));_.push({CHECKIN:false,CHECKOUT:false,ID:i["assigned_units_pool"],TO_DATE:l,FROM_DATE:c,PRIVATE_NOTE:f(t.extras),NO_OF_DAYS:o(c,l),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(E=t.financial)===null||E===void 0?void 0:E.due_amount,STATUS:R({in_out:i.in_out,from_date:i.from_date,to_date:i.to_date,status_code:(e=t.status)===null||e===void 0?void 0:e.code}),NAME:D(u===null||u===void 0?void 0:u.first_name,u.last_name),PHONE:(a=t.guest.mobile_without_prefix)!==null&&a!==void 0?a:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:i.total,RATE_PLAN:i.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:i.rateplan.id,IDENTIFIER:i.identifier,RATE_TYPE:i.roomtype.id,ADULTS_COUNT:i.occupancy.adult_nbr,CHILDREN_COUNT:i.occupancy.children_nbr,PR_ID:+i.unit.id,POOL:i["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:i.rateplan.cancelation,guarantee:i.rateplan.guarantee,TOTAL_PRICE:(r=t.financial)===null||r===void 0?void 0:r.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:i.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:i.from_date,to_date:i.to_date},ROOM_INFO:{occupancy:i.occupancy,sharing_persons:i.sharing_persons,unit:i.unit,in_out:i.in_out},BASE_STATUS_CODE:(O=t.status)===null||O===void 0?void 0:O.code})}));return _}async function S(n){const o=await u();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""?n.NOTES:n.STAY_STATUS_CODE==="003"?d(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):o.find((o=>o.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:M(n.from_date,n.to_date),STATUS:c[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date,defaultDates:{from_date:n.from_date,to_date:n.to_date}}}function M(o,t){const _=n(o,"YYYY-MM-DD");const i=n(t,"YYYY-MM-DD");const T=i.diff(_,"days");return T||1}function I(n,o){return n.getHours()>=o.getHours()&&n.getMinutes()>=o.getMinutes()}function v(n,o){const t=new Date;const _=n*60*60*1e3;const i=new Date(t.getTime()+_);const T=i.getUTCFullYear();const E=i.getUTCMonth();const e=i.getUTCDate();const s=o-n;return new Date(Date.UTC(T,E,e,s))}export{I as a,v as b,M as c,s as d,S as e,l as f,R as g,f as h,D as i,r as j,N as t};
//# sourceMappingURL=p-8bdbf849.js.map