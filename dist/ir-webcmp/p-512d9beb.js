import{h as o}from"./p-6c4ba7c0.js";import{l as n,i as t}from"./p-21e4b336.js";import{a as _}from"./p-bf44a732.js";import{l as T}from"./p-e19fbf2a.js";import{c as E}from"./p-0db2e55e.js";import{c as i}from"./p-7f64bb6e.js";const e={days:[],months:[],fromDate:"",toDate:""};const{state:s,onChange:a}=E(e);async function O(o){const n=[];const t=await u();for(const _ of o){for(const o of _.days){for(const _ of o.room_types){r(_.physicalrooms,n,t)}}}return n}function r(o,n,t){for(const _ of o){for(const o in _.calendar_cell){if(_.calendar_cell[o].Is_Available===false){Y(_.calendar_cell[o],n,t)}}}}const D={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const A={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function l(o,n){if(o===null&&n===null)return"";if(n!==null&&n!==""){return`${o!==null&&o!==void 0?o:""} , ${n!==null&&n!==void 0?n:""}`}return o}async function u(){try{const{data:o}=await _.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return o.My_Result.map((o=>({code:o.CODE_NAME,value:o.CODE_VALUE_EN})))}catch(o){console.log(o)}}function c(n,t,_){const E=new Date(n);E.setHours(t);E.setMinutes(_);return`${T.entries.Lcz_BlockedTill} ${o(E).format("MMM DD, HH:mm")}`}function d(_,T){var E,i,e,s,a,O,r,u;if(t(_.STAY_STATUS_CODE)){const t=o(_.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(_.DATE)?_.My_Block_Info.from_date:_.DATE;const E=o(_.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(_.DATE)?_.My_Block_Info.to_date:_.DATE;return{ID:_.POOL,NOTES:"",BALANCE:"",NAME:_.My_Block_Info.NOTES!==""?_.My_Block_Info.NOTES:_.STAY_STATUS_CODE==="003"?c(_.My_Block_Info.BLOCKED_TILL_DATE,_.My_Block_Info.BLOCKED_TILL_HOUR,_.My_Block_Info.BLOCKED_TILL_MINUTE):T.find((o=>o.code===_.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:_.My_Block_Info.DESCRIPTION,PR_ID:_.My_Block_Info.pr_id,ENTRY_DATE:_.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:_.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:_.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:_.My_Block_Info.NOTES,FROM_DATE:t,TO_DATE:E,NO_OF_DAYS:n(t,E),STATUS:D[_.STAY_STATUS_CODE],POOL:_.POOL,STATUS_CODE:_.STAY_STATUS_CODE,OUT_OF_SERVICE:_.STAY_STATUS_CODE==="004",FROM_DATE_STR:_.My_Block_Info.format.from_date,TO_DATE_STR:_.My_Block_Info.format.to_date,defaultDates:{from_date:_.My_Block_Info.from_date,to_date:_.My_Block_Info.to_date}}}if(_.booking.booking_nbr.toString()==="77054273380"){console.log("booking",_)}const d=o(_.room.from_date,"YYYY-MM-DD").isAfter(_.DATE)?_.room.from_date:_.DATE;const R=o(_.room.to_date,"YYYY-MM-DD").isAfter(_.DATE)?_.room.to_date:_.DATE;const Y=(E=_.room.sharing_persons)===null||E===void 0?void 0:E.find((o=>o.is_main));return{ID:_.POOL,FROM_DATE:d,TO_DATE:R,NO_OF_DAYS:n(d,R),STATUS:A[(i=_.booking)===null||i===void 0?void 0:i.status.code],NAME:l(Y===null||Y===void 0?void 0:Y.first_name,Y.last_name),IDENTIFIER:_.room.identifier,PR_ID:_.pr_id,POOL:_.POOL,BOOKING_NUMBER:_.booking.booking_nbr,NOTES:_.booking.is_direct?_.booking.remark:null,PRIVATE_NOTE:f(_.booking.extras),is_direct:_.booking.is_direct,BALANCE:(e=_.booking.financial)===null||e===void 0?void 0:e.due_amount,channel_booking_nbr:_.booking.channel_booking_nbr,ARRIVAL_TIME:_.booking.arrival.description,defaultDates:{from_date:_.room.from_date,to_date:_.room.to_date},ENTRY_DATE:_.booking.booked_on.date,PHONE_PREFIX:_.booking.guest.country_phone_prefix,IS_EDITABLE:_.booking.is_editable,ARRIVAL:_.booking.arrival,PHONE:(s=_.booking.guest.mobile_without_prefix)!==null&&s!==void 0?s:"",RATE:_.room.total,RATE_PLAN:_.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:_.room.rateplan.id,RATE_TYPE:1,ADULTS_COUNT:_.room.occupancy.adult_nbr,CHILDREN_COUNT:_.room.occupancy.children_nbr,origin:_.booking.origin,GUEST:_.booking.guest,ROOMS:_.booking.rooms,cancelation:_.room.rateplan.cancelation,guarantee:_.room.rateplan.guarantee,TOTAL_PRICE:(a=_.booking.financial)===null||a===void 0?void 0:a.gross_total,COUNTRY:_.booking.guest.country_id,FROM_DATE_STR:_.booking.format.from_date,TO_DATE_STR:_.booking.format.to_date,adult_child_offering:_.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:_.booking.source.code,description:_.booking.source.description,tag:_.booking.source.tag},CHECKIN:((O=_.room.in_out)===null||O===void 0?void 0:O.code)==="001",CHECKOUT:((r=_.room.in_out)===null||r===void 0?void 0:r.code)==="002",ROOM_INFO:{occupancy:_.room.occupancy,sharing_persons:_.room.sharing_persons,unit:_.room.unit,in_out:_.room.in_out},BASE_STATUS_CODE:(u=_.booking.status)===null||u===void 0?void 0:u.code}}function R(n){const{in_out:t,status_code:_,from_date:T,to_date:E}=n;if(i.checkin_enabled){if((t===null||t===void 0?void 0:t.code)==="001"){return A["000"]}else if((t===null||t===void 0?void 0:t.code)==="002"){if(!i.is_automatic_check_in_out){const n=o();const t=o(E,"YYYY-MM-DD");const _=o(T,"YYYY-MM-DD");if(n.isSame(t,"days")&&n.isAfter(_,"days")&&n.hour()>=12||n.isAfter(t,"days")){return A["003"]}else{return A["002"]}}}return A[_||"001"]}else{const n=o();const t=o(E,"YYYY-MM-DD");const i=o(T,"YYYY-MM-DD");if(i.isSame(n,"day")&&n.hour()>=12){return A["000"]}else if(n.isAfter(i,"day")&&n.isBefore(t,"day")){return A["000"]}else if(t.isSame(n,"day")&&n.hour()<12){return A["000"]}else if(t.isSame(n,"day")&&n.hour()>=12||t.isBefore(n,"day")){return A["003"]}else{return A[_||"001"]}}}function Y(o,n,t){const _=n.findIndex((n=>n.POOL===o.POOL));if(_===-1){const _=d(o,t);n.push(_)}}function f(o){var n;if(!o){return null}return((n=o.find((o=>o.key==="private_note")))===null||n===void 0?void 0:n.value)||null}function N(t){let _=[];const T=t.rooms.filter((o=>!!o["assigned_units_pool"]));T.forEach((T=>{var E,i,e,a,O,r;const D=o(T.from_date,"YYYY-MM-DD").isAfter(o(s.fromDate,"YYYY-MM-DD"))?T.from_date:s.fromDate;const A=T.to_date;if(o(T.to_date,"YYYY-MM-DD").isBefore(o(s.fromDate,"YYYY-MM-DD"))){return}const u=(E=T.sharing_persons)===null||E===void 0?void 0:E.find((o=>o.is_main));_.push({CHECKIN:false,CHECKOUT:false,ID:T["assigned_units_pool"],TO_DATE:A,FROM_DATE:D,PRIVATE_NOTE:f(t.extras),NO_OF_DAYS:n(D,A),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(i=t.financial)===null||i===void 0?void 0:i.due_amount,STATUS:R({in_out:T.in_out,from_date:T.from_date,to_date:T.to_date,status_code:(e=t.status)===null||e===void 0?void 0:e.code}),NAME:l(u===null||u===void 0?void 0:u.first_name,u.last_name),PHONE:(a=t.guest.mobile_without_prefix)!==null&&a!==void 0?a:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:T.total,RATE_PLAN:T.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:T.rateplan.id,IDENTIFIER:T.identifier,RATE_TYPE:T.roomtype.id,ADULTS_COUNT:T.occupancy.adult_nbr,CHILDREN_COUNT:T.occupancy.children_nbr,PR_ID:+T.unit.id,POOL:T["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:T.rateplan.cancelation,guarantee:T.rateplan.guarantee,TOTAL_PRICE:(O=t.financial)===null||O===void 0?void 0:O.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:T.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:T.from_date,to_date:T.to_date},ROOM_INFO:{occupancy:T.occupancy,sharing_persons:T.sharing_persons,unit:T.unit,in_out:T.in_out},BASE_STATUS_CODE:(r=t.status)===null||r===void 0?void 0:r.code})}));return _}async function S(o){const n=await u();return{ID:o.POOL,NOTES:"",BALANCE:"",NAME:o.NOTES!==""?o.NOTES:o.STAY_STATUS_CODE==="003"?c(o.BLOCKED_TILL_DATE,o.BLOCKED_TILL_HOUR,o.BLOCKED_TILL_MINUTE):n.find((n=>n.code===o.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:o.DESCRIPTION,PR_ID:o.pr_id,ENTRY_DATE:o.BLOCKED_TILL_DATE,ENTRY_HOUR:o.BLOCKED_TILL_HOUR,ENTRY_MINUTE:o.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:o.NOTES,FROM_DATE:o.from_date,TO_DATE:o.to_date,NO_OF_DAYS:M(o.from_date,o.to_date),STATUS:D[o.STAY_STATUS_CODE],POOL:o.POOL,STATUS_CODE:o.STAY_STATUS_CODE,OUT_OF_SERVICE:o.STAY_STATUS_CODE==="004",FROM_DATE_STR:o.format.from_date,TO_DATE_STR:o.format.to_date,defaultDates:{from_date:o.from_date,to_date:o.to_date}}}function M(n,t){const _=o(n,"YYYY-MM-DD");const T=o(t,"YYYY-MM-DD");const E=T.diff(_,"days");return E||1}export{S as a,A as b,s as c,f as d,M as e,O as f,R as g,l as h,N as t};
//# sourceMappingURL=p-512d9beb.js.map