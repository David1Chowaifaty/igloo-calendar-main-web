import{h as o}from"./p-6c4ba7c0.js";import{d as n,i as t}from"./p-f02f026f.js";import{a as T}from"./p-bf44a732.js";import{l as E}from"./p-e19fbf2a.js";import{c as _}from"./p-0db2e55e.js";import{c as e}from"./p-7f64bb6e.js";const i={days:[],months:[],fromDate:"",toDate:""};const{state:a,onChange:r}=_(i);async function O(o){const n=[];const t=await R();for(const T of o){for(const o of T.days){for(const T of o.room_types){D(T.physicalrooms,n,t)}}}return n}function D(o,n,t){for(const T of o){for(const o in T.calendar_cell){if(T.calendar_cell[o].Is_Available===false){d(T.calendar_cell[o],n,t)}}}}const l={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const s={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function A(o,n){if(o===null&&n===null)return"";if(n!==null&&n!==""){return`${o!==null&&o!==void 0?o:""} , ${n!==null&&n!==void 0?n:""}`}return o}async function R(){try{const{data:o}=await T.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return o.My_Result.map((o=>({code:o.CODE_NAME,value:o.CODE_VALUE_EN})))}catch(o){console.log(o)}}function u(n,t,T){const _=new Date(n);_.setHours(t);_.setMinutes(T);return`${E.entries.Lcz_BlockedTill} ${o(_).format("MMM DD, HH:mm")}`}function c(T,E){var _,e,i,a,r,O,D;if(t(T.STAY_STATUS_CODE)){const t=o(T.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(T.DATE)?T.My_Block_Info.from_date:T.DATE;const _=o(T.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(T.DATE)?T.My_Block_Info.to_date:T.DATE;return{ID:T.POOL,NOTES:"",BALANCE:"",NAME:T.My_Block_Info.NOTES!==""?T.My_Block_Info.NOTES:T.STAY_STATUS_CODE==="003"?u(T.My_Block_Info.BLOCKED_TILL_DATE,T.My_Block_Info.BLOCKED_TILL_HOUR,T.My_Block_Info.BLOCKED_TILL_MINUTE):E.find((o=>o.code===T.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:T.My_Block_Info.DESCRIPTION,PR_ID:T.My_Block_Info.pr_id,ENTRY_DATE:T.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:T.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:T.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:T.My_Block_Info.NOTES,FROM_DATE:t,TO_DATE:_,NO_OF_DAYS:n(t,_),STATUS:l[T.STAY_STATUS_CODE],POOL:T.POOL,STATUS_CODE:T.STAY_STATUS_CODE,OUT_OF_SERVICE:T.STAY_STATUS_CODE==="004",FROM_DATE_STR:T.My_Block_Info.format.from_date,TO_DATE_STR:T.My_Block_Info.format.to_date,defaultDates:{from_date:T.My_Block_Info.from_date,to_date:T.My_Block_Info.to_date}}}if(T.booking.booking_nbr.toString()==="77054273380"){console.log("booking",T)}const R=o(T.room.from_date,"YYYY-MM-DD").isAfter(T.DATE)?T.room.from_date:T.DATE;const c=o(T.room.to_date,"YYYY-MM-DD").isAfter(T.DATE)?T.room.to_date:T.DATE;const d=(_=T.room.sharing_persons)===null||_===void 0?void 0:_.find((o=>o.is_main));return{ID:T.POOL,FROM_DATE:R,TO_DATE:c,NO_OF_DAYS:n(R,c),STATUS:s[(e=T.booking)===null||e===void 0?void 0:e.status.code],NAME:A(d===null||d===void 0?void 0:d.first_name,d.last_name),IDENTIFIER:T.room.identifier,PR_ID:T.pr_id,POOL:T.POOL,BOOKING_NUMBER:T.booking.booking_nbr,NOTES:T.booking.is_direct?T.booking.remark:null,PRIVATE_NOTE:f(T.booking.extras),is_direct:T.booking.is_direct,BALANCE:(i=T.booking.financial)===null||i===void 0?void 0:i.due_amount,channel_booking_nbr:T.booking.channel_booking_nbr,ARRIVAL_TIME:T.booking.arrival.description,defaultDates:{from_date:T.room.from_date,to_date:T.room.to_date},ENTRY_DATE:T.booking.booked_on.date,PHONE_PREFIX:T.booking.guest.country_phone_prefix,IS_EDITABLE:T.booking.is_editable,ARRIVAL:T.booking.arrival,PHONE:(a=T.booking.guest.mobile_without_prefix)!==null&&a!==void 0?a:"",RATE:T.room.total,RATE_PLAN:T.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:T.room.rateplan.id,RATE_TYPE:1,ADULTS_COUNT:T.room.occupancy.adult_nbr,CHILDREN_COUNT:T.room.occupancy.children_nbr,origin:T.booking.origin,GUEST:T.booking.guest,ROOMS:T.booking.rooms,cancelation:T.room.rateplan.cancelation,guarantee:T.room.rateplan.guarantee,TOTAL_PRICE:(r=T.booking.financial)===null||r===void 0?void 0:r.gross_total,COUNTRY:T.booking.guest.country_id,FROM_DATE_STR:T.booking.format.from_date,TO_DATE_STR:T.booking.format.to_date,adult_child_offering:T.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:T.booking.source.code,description:T.booking.source.description,tag:T.booking.source.tag},CHECKIN:((O=T.room.in_out)===null||O===void 0?void 0:O.code)==="001",CHECKOUT:((D=T.room.in_out)===null||D===void 0?void 0:D.code)==="002"}}function d(o,n,t){const T=n.findIndex((n=>n.POOL===o.POOL));if(T===-1){const T=c(o,t);n.push(T)}}function f(o){var n;if(!o){return null}return((n=o.find((o=>o.key==="private_note")))===null||n===void 0?void 0:n.value)||null}function N(t){let T=[];const E=n=>{var T,E;if(e.checkin_enabled){if(((T=n.in_out)===null||T===void 0?void 0:T.code)==="001"){return s["000"]}else if(((E=n.in_out)===null||E===void 0?void 0:E.code)==="002"){return s["003"]}return s[(t===null||t===void 0?void 0:t.status.code)||"001"]}else{const T=o();const E=o(n.to_date,"YYYY-MM-DD");const _=o(n.from_date,"YYYY-MM-DD");if(_.isSame(T,"day")&&T.hour()>=12){return s["000"]}else if(T.isAfter(_,"day")&&T.isBefore(E,"day")){return s["000"]}else if(E.isSame(T,"day")&&T.hour()<12){return s["000"]}else if(E.isSame(T,"day")&&T.hour()>=12||E.isBefore(T,"day")){return s["003"]}else{return s[(t===null||t===void 0?void 0:t.status.code)||"001"]}}};const _=t.rooms.filter((o=>!!o["assigned_units_pool"]));_.forEach((_=>{var e,i,r,O;const D=o(_.from_date,"YYYY-MM-DD").isAfter(o(a.fromDate,"YYYY-MM-DD"))?_.from_date:a.fromDate;const l=_.to_date;console.log(`\n  bookingFromDate:${D},\n\n  roomFromDate:${_.from_date},\n\n  bookingToDate:${l},\n\n  roomToDate:${l}\n\n      `);if(o(_.to_date,"YYYY-MM-DD").isBefore(o(a.fromDate,"YYYY-MM-DD"))){return}const s=(e=_.sharing_persons)===null||e===void 0?void 0:e.find((o=>o.is_main));T.push({CHECKIN:false,CHECKOUT:false,ID:_["assigned_units_pool"],TO_DATE:l,FROM_DATE:D,PRIVATE_NOTE:f(t.extras),NO_OF_DAYS:n(D,l),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(i=t.financial)===null||i===void 0?void 0:i.due_amount,STATUS:E(_),NAME:A(s===null||s===void 0?void 0:s.first_name,s.last_name),PHONE:(r=t.guest.mobile_without_prefix)!==null&&r!==void 0?r:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:_.total,RATE_PLAN:_.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:_.rateplan.id,IDENTIFIER:_.identifier,RATE_TYPE:_.roomtype.id,ADULTS_COUNT:_.occupancy.adult_nbr,CHILDREN_COUNT:_.occupancy.children_nbr,PR_ID:+_.unit.id,POOL:_["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:_.rateplan.cancelation,guarantee:_.rateplan.guarantee,TOTAL_PRICE:(O=t.financial)===null||O===void 0?void 0:O.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:_.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:_.from_date,to_date:_.to_date}})}));return T}async function Y(o){const n=await R();return{ID:o.POOL,NOTES:"",BALANCE:"",NAME:o.NOTES!==""?o.NOTES:o.STAY_STATUS_CODE==="003"?u(o.BLOCKED_TILL_DATE,o.BLOCKED_TILL_HOUR,o.BLOCKED_TILL_MINUTE):n.find((n=>n.code===o.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:o.DESCRIPTION,PR_ID:o.pr_id,ENTRY_DATE:o.BLOCKED_TILL_DATE,ENTRY_HOUR:o.BLOCKED_TILL_HOUR,ENTRY_MINUTE:o.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:o.NOTES,FROM_DATE:o.from_date,TO_DATE:o.to_date,NO_OF_DAYS:S(o.from_date,o.to_date),STATUS:l[o.STAY_STATUS_CODE],POOL:o.POOL,STATUS_CODE:o.STAY_STATUS_CODE,OUT_OF_SERVICE:o.STAY_STATUS_CODE==="004",FROM_DATE_STR:o.format.from_date,TO_DATE_STR:o.format.to_date,defaultDates:{from_date:o.from_date,to_date:o.to_date}}}function S(n,t){const T=o(n,"YYYY-MM-DD");const E=o(t,"YYYY-MM-DD");const _=E.diff(T,"days");return _||1}export{a,s as b,S as c,Y as d,O as e,A as f,f as g,N as t};
//# sourceMappingURL=p-ca06ac40.js.map