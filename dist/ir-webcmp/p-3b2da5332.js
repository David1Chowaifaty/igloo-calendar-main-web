import{a as r}from"./p-bf44a732.js";import{e as t,a as e,b as n,f as o}from"./p-35ce2cf2.js";import{g as a,b as i}from"./p-fbb31de9.js";import{c as s}from"./p-a66990e0.js";var c=undefined&&undefined.__rest||function(r,t){var e={};for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)&&t.indexOf(n)<0)e[n]=r[n];if(r!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,n=Object.getOwnPropertySymbols(r);o<n.length;o++){if(t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(r,n[o]))e[n[o]]=r[n[o]]}return e};class l{async handleExposedRoomInOut(t){const{data:e}=await r.post(`/Handle_Exposed_Room_InOut`,t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e}async getLov(){const{data:t}=await r.post(`/Get_LOV`,{});if(t.ExceptionMsg!==""){throw new Error(t.ExceptionMsg)}return t}async sendBookingConfirmationEmail(t,e){const{data:n}=await r.post(`/Send_Booking_Confirmation_Email`,{booking_nbr:t,language:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}async getCalendarData(o,i,s){try{const{data:c}=await r.post(`/Get_Exposed_Calendar`,{propertyid:o,from_date:i,to_date:s,extras:t});if(c.ExceptionMsg!==""){throw new Error(c.ExceptionMsg)}const l=c.My_Result.months;const u=[];const _=await a(l);const d=l.map((r=>{u.push({daysCount:r.days.length,monthName:r.description});return r.days.map((t=>({day:e(t.description,r.description),currentDate:n(t.description,r.description),dayDisplayName:t.description,rate:t.room_types,unassigned_units_nbr:t.unassigned_units_nbr,occupancy:t.occupancy})))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:o,FROM:c.My_Params_Get_Exposed_Calendar.from_date,TO:c.My_Params_Get_Exposed_Calendar.to_date},days:d,months:u,myBookings:_,defaultMonths:l})}catch(r){console.error(r)}}async handleExposedRoomGuests(t){const{data:e}=await r.post("/Handle_Exposed_Room_Guests",t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e}async fetchGuest(t){try{const{data:e}=await r.post(`/Get_Exposed_Guest`,{email:t});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(r){console.log(r);throw new Error(r)}}async changeExposedBookingStatus(t){try{const{data:e}=await r.post(`/Change_Exposed_Booking_Status`,t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(r){throw new Error(r)}}async fetchPMSLogs(t){try{const{data:e}=await r.post(`/Get_Exposed_PMS_Logs`,{booking_nbr:t});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(r){console.log(r);throw new Error(r)}}async getExposedBookingEvents(t){try{const{data:e}=await r.post(`/Get_Exposed_Booking_Events`,{booking_nbr:t});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(r){console.log(r);throw new Error(r)}}async editExposedGuest(t,e){try{const{data:n}=await r.post(`/Edit_Exposed_Guest`,Object.assign(Object.assign({},t),{book_nbr:e}));if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(r){console.log(r);throw new Error(r)}}async getBookingAvailability(t){try{const{adultChildCount:e,currency:n}=t,o=c(t,["adultChildCount","currency"]);const{data:a}=await r.post(`/Check_Availability`,Object.assign(Object.assign({},o),{adult_nbr:e.adult,child_nbr:e.child,currency_ref:n.code,skip_getting_assignable_units:!s.is_frontdesk_enabled,is_backend:true}));if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}const l=this.modifyRateplans(this.sortRoomTypes(a["My_Result"],{adult_nbr:Number(e.adult),child_nbr:Number(e.child)}));i.roomTypes=[...l];i.tax_statement={message:a.My_Result.tax_statement};return l}catch(r){console.error(r);throw new Error(r)}}sortRoomTypes(r,t){return r.sort(((r,e)=>{var n,o,a,i;if(r.is_available_to_book&&!e.is_available_to_book)return-1;if(!r.is_available_to_book&&e.is_available_to_book)return 1;const s=(n=r.rateplans)===null||n===void 0?void 0:n.some((r=>{var t;return(t=r.variations)===null||t===void 0?void 0:t.some((r=>r.discounted_amount===0||r.discounted_amount===null))}));const c=(o=e.rateplans)===null||o===void 0?void 0:o.some((r=>{var t;return(t=r.variations)===null||t===void 0?void 0:t.some((r=>r.discounted_amount===0||r.discounted_amount===null))}));if(s&&!c)return 1;if(!s&&c)return-1;const l=(a=r.rateplans)===null||a===void 0?void 0:a.some((r=>{var e;return(e=r.variations)===null||e===void 0?void 0:e.some((r=>r.adult_nbr===t.adult_nbr&&r.child_nbr===t.child_nbr))}));const u=(i=e.rateplans)===null||i===void 0?void 0:i.some((r=>{var e;return(e=r.variations)===null||e===void 0?void 0:e.some((r=>r.adult_nbr===t.adult_nbr&&r.child_nbr===t.child_nbr))}));if(l&&!u)return-1;if(!l&&u)return 1;const _=Math.max(...r.rateplans.flatMap((r=>{var t;return(t=r.variations)===null||t===void 0?void 0:t.map((r=>{var t;return(t=r.discounted_amount)!==null&&t!==void 0?t:0}))})));const d=Math.max(...e.rateplans.flatMap((r=>{var t;return(t=r.variations)===null||t===void 0?void 0:t.map((r=>{var t;return(t=r.discounted_amount)!==null&&t!==void 0?t:0}))})));if(_<d)return-1;if(_>d)return 1;return 0}))}modifyRateplans(r){return r===null||r===void 0?void 0:r.map((r=>{var t;return Object.assign(Object.assign({},r),{rateplans:(t=r.rateplans)===null||t===void 0?void 0:t.map((r=>{var t;return Object.assign(Object.assign({},r),{variations:this.sortVariations((t=r===null||r===void 0?void 0:r.variations)!==null&&t!==void 0?t:[])})}))})}))}sortVariations(r){return r.sort(((r,t)=>{if(r.adult_nbr!==t.adult_nbr){return t.adult_nbr-r.adult_nbr}return t.child_nbr-r.child_nbr}))}async getCountries(t){try{const{data:e}=await r.post(`/Get_Exposed_Countries`,{language:t});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(r){console.error(r);throw new Error(r)}}async getSetupEntriesByTableName(t){var e;const{data:n}=await r.post(`/Get_Setup_Entries_By_TBL_NAME`,{TBL_NAME:t});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}const o=(e=n.My_Result)!==null&&e!==void 0?e:[];return o}async fetchSetupEntries(){try{const{data:t}=await r.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]});if(t.ExceptionMsg!==""){throw new Error(t.ExceptionMsg)}const e=t.My_Result;return{arrivalTime:e.filter((r=>r.TBL_NAME==="_ARRIVAL_TIME")),ratePricingMode:e.filter((r=>r.TBL_NAME==="_RATE_PRICING_MODE")),bedPreferenceType:e.filter((r=>r.TBL_NAME==="_BED_PREFERENCE_TYPE"))}}catch(r){console.error(r);throw new Error(r)}}async doBookingExtraService({booking_nbr:t,service:e,is_remove:n}){const{data:o}=await r.post(`/Do_Booking_Extra_Service`,Object.assign(Object.assign({},e),{booking_nbr:t,is_remove:n}));if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}async getBlockedInfo(){try{const{data:t}=await r.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:["_CALENDAR_BLOCKED_TILL"]});if(t.ExceptionMsg!==""){throw new Error(t.ExceptionMsg)}return t.My_Result}catch(r){console.error(r);throw new Error(r)}}async getUserDefaultCountry(){try{const{data:t}=await r.post(`/Get_Country_By_IP`,{IP:""});if(t.ExceptionMsg!==""){throw new Error(t.ExceptionMsg)}return t["My_Result"]}catch(r){console.error(r);throw new Error(r)}}async blockUnit(t){try{const{data:e}=await r.post(`/Block_Exposed_Unit`,t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}console.log(e);return e["My_Params_Block_Exposed_Unit"]}catch(r){console.error(r);throw new Error(r)}}async getUserInfo(t){try{const{data:e}=await r.post(`/GET_EXPOSED_GUEST`,{email:t});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(r){console.error(r);throw new Error(r)}}async getExposedBooking(e,n,o=true){try{const{data:a}=await r.post(`/Get_Exposed_Booking`,{booking_nbr:e,language:n,extras:o?t:null});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a.My_Result}catch(r){console.error(r)}}generateDays(r,t,e){const n=new Date(r);const o=new Date(t);const a=[];while(n<o){a.push({date:n.toISOString().split("T")[0],amount:e,cost:null});n.setDate(n.getDate()+1)}return a}calculateTotalRate(r,t,e,n){if(e&&n===2){return+r}return+r/+t}async fetchExposedGuest(t,e){try{const{data:n}=await r.post(`/Fetch_Exposed_Guests`,{email:t,property_id:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n["My_Result"]}catch(r){console.error(r);throw new Error(r)}}async fetchExposedBookings(t,e,n,o){try{const{data:a}=await r.post(`/Fetch_Exposed_Bookings`,{booking_nbr:t,property_id:e,from_date:n,to_date:o});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a["My_Result"]}catch(r){console.error(r);throw new Error(r)}}async getPCICardInfoURL(t){try{const{data:e}=await r.post(`/Get_PCI_Card_Info_URL`,{BOOK_NBR:t});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e["My_Result"]}catch(r){console.error(r);throw new Error(r)}}async doReservation(e){const{data:n}=await r.post(`/DoReservation`,Object.assign(Object.assign({},e),{extras:e.extras?e.extras:t}));if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}console.log(n["My_Result"]);return n["My_Result"]}async bookUser({bookedByInfoData:r,check_in:t,currency:e,extras:n=null,fromDate:a,guestData:i,pickup_info:s,propertyid:c,rooms:l,source:u,toDate:_,totalNights:d,arrivalTime:w,bookingNumber:E,defaultGuest:h,identifier:y,pr_id:f}){try{const b=o(a);const p=o(_);let m={email:r.email===""?null:r.email||null,first_name:r.firstName,last_name:r.lastName,country_id:r.countryId===""?null:r.countryId,city:null,mobile:r.contactNumber===null?"":r.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:r.emailGuest||false,cci:r.cardNumber?{nbr:r.cardNumber,holder_name:r.cardHolderName,expiry_month:r.expiryMonth,expiry_year:r.expiryYear}:null};if(h){m=Object.assign(Object.assign({},h),{email:h.email===""?null:h.email})}if(r.id){m=Object.assign(Object.assign({},m),{id:r.id})}const v={assign_units:true,check_in:t,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:n,booking:{booking_nbr:E||"",from_date:b,to_date:p,remark:r.message||null,property:{id:c},source:u,currency:e,arrival:{code:w?w:r.selectedArrivalTime},guest:m,rooms:[...i.map((r=>({identifier:y||null,roomtype:{id:r.roomCategoryId,name:r.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:r.inventory,rate:r.rate/d},rateplan:{id:r.ratePlanId,name:r.ratePlanName,rate_restrictions:null,variations:null,cancelation:r.cancelation,guarantee:r.guarantee},unit:typeof f==="undefined"&&r.roomId===""?null:{id:+f||+r.roomId},occupancy:{adult_nbr:r.adultCount,children_nbr:r.childrenCount,infant_nbr:null},bed_preference:r.preference,from_date:b,to_date:p,notes:null,days:this.generateDays(b,p,this.calculateTotalRate(r.rate,d,r.isRateModified,r.rateType)),guest:{email:null,first_name:r.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),...l]},pickup_info:s};console.log("book user payload",v)}catch(r){console.error(r);throw new Error(r)}}}export{l as B};
//# sourceMappingURL=p-3b2da5332.js.map