import{r as i,c as t,h as e,H as n}from"./p-ee49d535.js";import{P as s,p as o}from"./p-6eb04c5a.js";import{R as a}from"./p-be1492f7.js";import{l}from"./p-806fad31.js";import"./p-b364a44f.js";import"./p-06203439.js";import"./p-4eb12235.js";import"./p-6bab2172.js";const r=".sc-ir-payment-option-h{display:block}.payment-table-container.sc-ir-payment-option{display:flex;align-items:center;justify-content:center}.po-view.sc-ir-payment-option{padding:0;margin:0}.payment-img.sc-ir-payment-option{height:18px;display:none}.loading-container.sc-ir-payment-option{background:white;display:flex;align-items:center;flex-direction:column;align-items:center;justify-content:center;width:100%;height:40rem}.payment-option-loader.sc-ir-payment-option{width:1.25rem;height:1.25rem;border:2.5px solid #3f3f3f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}.loading-container.default.sc-ir-payment-option{height:100vh;width:100%}@media (min-width: 768px){.po-view.sc-ir-payment-option{display:flex;align-items:center;justify-content:space-between;gap:0.5rem}.dataTable.sc-ir-payment-option{width:70%}.payment-img.sc-ir-payment-option{display:block}.actions-header.sc-ir-payment-option{width:max-content !important}.payment-table-container.sc-ir-payment-option{justify-content:flex-start}}@media (min-width: 1280px){.dataTable.sc-ir-payment-option{width:50%}}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}";const d=r;const h=class{constructor(e){i(this,e);this.toast=t(this,"toast",7);this.paymentOptionService=new s;this.roomService=new a;this.propertyid=undefined;this.ticket=undefined;this.p=undefined;this.language="en";this.defaultStyles=true;this.hideLogs=true;this.paymentOptions=[];this.isLoading=false;this.selectedOption=null}componentWillLoad(){if(this.ticket){this.init()}}handleTokenChange(i,t){if(i!==t){this.init()}}init(){this.initServices();this.fetchData()}handleCloseModal(i){i.stopPropagation();i.stopImmediatePropagation();console.log(i.detail);this.closeModal(i.detail)}log(i,...t){if(this.hideLogs){return}console.log(i,...t)}closeModal(i){var t,e;if(i){this.modifyPaymentList(i);if(i.is_payment_gateway){this.propertyOptionsById.set(i.id,i)}else{this.propertyOptionsByCode.set(i.code,i)}}else{if(!this.propertyOptionsByCode.has((t=o.selectedOption)===null||t===void 0?void 0:t.code)&&!this.propertyOptionsById.has((e=o.selectedOption)===null||e===void 0?void 0:e.id)){this.modifyPaymentList(Object.assign(Object.assign({},o.selectedOption),{is_active:false}))}}o.selectedOption=null;o.mode=null}async fetchData(){try{if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}this.isLoading=true;let i=this.propertyid;console.log("pror id",i);if(!i){console.log("fetching property id");const t=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language});i=t.My_Result.id}const[t,e,n]=await Promise.all([this.paymentOptionService.GetExposedPaymentMethods(),this.paymentOptionService.GetPropertyPaymentMethods(i),this.roomService.fetchLanguage(this.language,["_PAYMENT_BACK"])]);this.log("---feteched data---");this.log("paymentOptions",t);this.log("propertyOptions",e);this.log("languageTexts",n);this.log("---feteched data---");l.entries=n.entries;l.direction=n.direction;this.propertyOptionsById=new Map(e===null||e===void 0?void 0:e.map((i=>[i.id,i])));this.propertyOptionsByCode=new Map(e===null||e===void 0?void 0:e.map((i=>[i.code,i])));this.paymentOptions=t===null||t===void 0?void 0:t.map((i=>{if(i.is_payment_gateway){return this.propertyOptionsById.get(i.id)||i}return this.propertyOptionsByCode.get(i.code)||i}))}catch(i){console.error(i)}finally{this.isLoading=false;this.log("end fetching data")}}initServices(){o.token=this.ticket;this.paymentOptionService.setToken(this.ticket);this.roomService.setToken(this.ticket)}modifyPaymentList(i){let t=[...this.paymentOptions];console.log(i);let e=t.findIndex((t=>t.code===i.code));if(e===-1){throw new Error("Invalid code")}t[e]=Object.assign({},i);this.paymentOptions=[...t]}async handleCheckChange(i,t){var e;i.stopPropagation();i.stopImmediatePropagation();const n=i.detail;const s=Object.assign(Object.assign({},t),{is_active:n,property_id:this.propertyid});if(t.code!=="005"&&!t.is_payment_gateway){await this.paymentOptionService.HandlePaymentMethod(s);this.modifyPaymentList(s);if(t.code==="000"&&n&&this.paymentOptions.filter((i=>i.code!=="000")).every((i=>i.is_active===false||i.is_active===null))){this.toast.emit({type:"success",description:"",title:l.entries["Lcz_YouNeedToSelect"],position:"top-right"})}return}if(!this.showEditButton(t)){this.modifyPaymentList(s);return}if(n&&((e=t.data)===null||e===void 0?void 0:e.some((i=>i.value===null)))){o.mode="create";o.selectedOption=s}else{await this.paymentOptionService.HandlePaymentMethod(s)}this.modifyPaymentList(s)}showEditButton(i){var t;if(!i.is_payment_gateway&&i.code!=="005"){return false}return i.code==="005"||i.is_payment_gateway&&((t=i.data)===null||t===void 0?void 0:t.length)>0}render(){var i,t,s,a,r,d,h;this.log("----loading conditions----");this.log("isLoading",this.isLoading);this.log("paymentOptions",this.paymentOptions);this.log("----loading conditions----");if(this.isLoading===true||this.paymentOptions&&this.paymentOptions.length===0){this.log("rendering the loading view");return e(n,{class:this.defaultStyles?"p-2":""},e("div",{class:`loading-container ${this.defaultStyles?"default":""}`},e("span",{class:"payment-option-loader"})))}this.log("rendering the payment option");return e(n,{class:this.defaultStyles?"p-2":""},e("ir-toast",null),e("ir-interceptor",null),e("div",{class:`${this.defaultStyles?"card ":""} p-1 flex-fill m-0`},e("div",{class:"d-flex align-items-center mb-2"},e("div",{class:"p-0 m-0 mr-1"},e("ir-icons",{name:"credit_card"})),e("h3",{class:"m-0 p-0"},(i=l===null||l===void 0?void 0:l.entries)===null||i===void 0?void 0:i.Lcz_PaymentOptions)),e("div",{class:"payment-table-container"},e("table",{class:"table table-striped table-bordered no-footer dataTable"},e("thead",null,e("tr",null,e("th",{scope:"col",class:"text-left"},(t=l===null||l===void 0?void 0:l.entries)===null||t===void 0?void 0:t.Lcz_PaymentMethod),e("th",{scope:"col"},(s=l===null||l===void 0?void 0:l.entries)===null||s===void 0?void 0:s.Lcz_Status),e("th",{scope:"col",class:"actions-header"},(a=l===null||l===void 0?void 0:l.entries)===null||a===void 0?void 0:a.Lcz_Action))),e("tbody",{class:""},(r=this.paymentOptions)===null||r===void 0?void 0:r.map((i=>{var t;if(i.code==="004"){return null}return e("tr",{key:i.id},e("td",{class:"text-left po-description"},e("div",{class:"po-view"},e("span",{class:"p-0 m-0"},i===null||i===void 0?void 0:i.description))),e("td",null,e("ir-switch",{checked:i.is_active,onCheckChange:t=>this.handleCheckChange(t,i)})),e("td",{class:"payment-action"},this.showEditButton(i)&&e("ir-button",{title:(t=l===null||l===void 0?void 0:l.entries)===null||t===void 0?void 0:t.Lcz_Edit,variant:"icon",icon_name:"edit",onClickHanlder:()=>{o.selectedOption=i;o.mode="edit"}})))})))))),e("ir-sidebar",{onIrSidebarToggle:()=>{this.closeModal(null)},label:(d=l===null||l===void 0?void 0:l.entries.Lcz_Information)===null||d===void 0?void 0:d.replace("%1",(h=o.selectedOption)===null||h===void 0?void 0:h.description),open:(o===null||o===void 0?void 0:o.selectedOption)!==null},(o===null||o===void 0?void 0:o.selectedOption)&&e("ir-option-details",{propertyId:this.propertyid,slot:"sidebar-body"})))}static get watchers(){return{ticket:["handleTokenChange"]}}};h.style=d;export{h as ir_payment_option};
//# sourceMappingURL=p-5b9e69b9.entry.js.map