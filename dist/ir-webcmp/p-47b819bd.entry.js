import{r as t,c as i,h as e}from"./p-acddcbeb.js";import{B as s,b as o}from"./p-1d208554.js";import{l as n}from"./p-e58470d9.js";import{P as a}from"./p-834c4250.js";import{h as r}from"./p-6c4ba7c0.js";import"./p-2925ded6.js";import"./p-bfb03024.js";import"./p-ea7580c2.js";import"./p-d6d6fb27.js";import"./p-bf44a732.js";const l=".backdropModal.sc-ir-listing-modal{background-color:rgba(0, 0, 0, 0.5);z-index:1000;position:fixed;top:0;left:0;height:100vh;width:100%;opacity:0;transition:opacity 0.3s ease-in-out;pointer-events:none}.backdropModal.active.sc-ir-listing-modal{cursor:pointer;opacity:1 !important;pointer-events:all}.ir-modal[data-state='opened'].sc-ir-listing-modal{opacity:1;visibility:visible;pointer-events:all;transition:all 0.3s ease-in-out}.ir-alert-content.sc-ir-listing-modal{padding:10px;background:white;border-radius:5px}.modal.sc-ir-listing-modal{z-index:1001 !important}.modal-dialog.sc-ir-listing-modal{height:100vh;display:flex;align-items:center}.ir-alert-footer.sc-ir-listing-modal{gap:10px}.exit-icon.sc-ir-listing-modal{position:absolute;right:10px;top:5px;margin:0}.ir-modal.sc-ir-listing-modal{position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);z-index:1050;width:90%;max-width:32rem;overflow:hidden;outline:0;opacity:0;transition:transform 0.3s ease-in-out, opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;visibility:hidden;pointer-events:none}.ir-modal.active.sc-ir-listing-modal{opacity:1;transform:translate(-50%, 0);visibility:visible;pointer-events:all;transition:all 0.3s ease-in-out}";const d=l;const c=class{constructor(e){t(this,e);this.modalClosed=i(this,"modalClosed",7);this.resetData=i(this,"resetData",7)}modalTitle="Modal Title";editBooking;paymentEntries;isOpen=false;deletionStage=2;selectedDesignation;loadingBtn=null;bookingListingsService=new s;paymentService=new a;componentWillLoad(){this.selectedDesignation=this.paymentEntries.methods[0]}modalClosed;resetData;async closeModal(){this.isOpen=false;this.selectedDesignation=this.paymentEntries.methods[0];this.modalClosed.emit(null)}async openModal(){this.isOpen=true}filterBookings(){o.bookings=o.bookings.filter((t=>t.booking_nbr!==this.editBooking.booking.booking_nbr))}async btnClickHandler(t){let i=t.target;let e=i.name;try{if(e==="confirm"){this.loadingBtn="confirm";if(this.editBooking.cause==="payment"){const t=this.paymentEntries.types.find((t=>t.CODE_NAME===(this.editBooking.booking.financial.due_amount<0?"010":"001")));await this.paymentService.AddPayment({amount:["003","004"].includes(this.editBooking.booking.status.code)?Math.abs(this.editBooking.booking.financial.cancelation_penality_as_if_today):this.editBooking.booking.financial.due_amount,currency:this.editBooking.booking.currency,date:r().format("YYYY-MM-DD"),designation:this.selectedDesignation.CODE_VALUE_EN,payment_method:{code:this.selectedDesignation.CODE_NAME,description:this.selectedDesignation.CODE_VALUE_EN,operation:this.selectedDesignation.NOTES},payment_type:{code:t.CODE_NAME,description:t.CODE_VALUE_EN,operation:t.NOTES},id:-1,reference:""},this.editBooking.booking.booking_nbr);this.resetData.emit(this.editBooking.booking.booking_nbr)}else{if(this.deletionStage===2){await this.bookingListingsService.removeExposedBooking(this.editBooking.booking.booking_nbr,true);this.filterBookings()}}}if(e==="cancel"){this.closeModal()}}catch(t){console.error(t)}finally{if(this.loadingBtn){this.loadingBtn=null;this.closeModal()}}}renderTitle(){if(this.editBooking.cause==="payment"){return n.entries?.Lcz_MarkBookingAsPaid.replace("%1",this.editBooking.booking.booking_nbr)}else{return n.entries.Lcz_SureYouWantToDeleteBookingNbr+this.editBooking?.booking.booking_nbr}}renderConfirmationTitle(){return n.entries.Lcz_Confirm}renderCancellationTitle(){return n.entries.Lcz_Cancel}handleDropdownChange(t){t.stopImmediatePropagation();t.stopPropagation();const i=t.detail.toString();console.log(i);const e=this.paymentEntries.methods.find((t=>t.CODE_NAME===i));if(!e){console.warn(`Invalid payment method ${t.detail}`);return}this.selectedDesignation=e}render(){if(!this.editBooking){return null}return[e("div",{class:`backdropModal ${this.isOpen?"active":""}`,onClick:()=>{if(this.editBooking.cause==="delete"){return}this.closeModal()}}),e("div",{"data-state":this.isOpen?"opened":"closed",class:`ir-modal`,tabindex:"-1"},this.isOpen&&e("div",{class:`ir-alert-content p-2`},e("div",{class:`ir-alert-header align-items-center border-0 py-0 m-0 `},e("p",{class:"p-0 my-0 mb-1"},this.renderTitle()),e("ir-icon",{class:"exit-icon",style:{cursor:"pointer"},onClick:()=>{this.closeModal()}},e("svg",{slot:"icon",xmlns:"http://www.w3.org/2000/svg",height:"14",width:"10.5",viewBox:"0 0 384 512"},e("path",{fill:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"})))),e("div",{class:"modal-body text-left p-0 mb-2"},this.editBooking.cause==="payment"?e("ir-select",{selectedValue:this.selectedDesignation?.CODE_NAME,onSelectChange:this.handleDropdownChange.bind(this),showFirstOption:false,data:this.paymentEntries.methods?.map((t=>({value:t.CODE_NAME,text:t.CODE_VALUE_EN})))}):null),e("div",{class:`ir-alert-footer border-0 d-flex justify-content-end`},e("ir-button",{isLoading:this.loadingBtn==="just_delete",btn_color:"secondary",btn_block:true,text:this.renderCancellationTitle(),name:"cancel"}),e("ir-button",{isLoading:this.loadingBtn==="confirm",btn_color:"primary",btn_block:true,text:this.renderConfirmationTitle(),name:"confirm"}))))]}};c.style=d;export{c as ir_listing_modal};
//# sourceMappingURL=p-47b819bd.entry.js.map