import{r as t,c as i,h as o,H as s,g as e}from"./p-53d64953.js";import{v as h}from"./p-4ed69de7.js";const r=".sc-ir-m-combobox-h{position:relative;display:block}.input-wrapper.sc-ir-m-combobox{position:relative;width:100%}.prefix-container.sc-ir-m-combobox,.suffix-container.sc-ir-m-combobox{position:absolute;top:0;bottom:0;display:inline-flex;align-items:center;color:var(--ir-combobox-affix-color, #6c757d);pointer-events:none}.dropdown-item.sc-ir-m-combobox{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.prefix-container.sc-ir-m-combobox{left:0.5rem}.suffix-container.sc-ir-m-combobox{right:0.5rem}.sc-ir-m-combobox-s>[slot='prefix'],.sc-ir-m-combobox-s>[slot='suffix']{display:inline-flex;width:var(--ir-combobox-affix-size, 1rem);height:var(--ir-combobox-affix-size, 1rem)}.has-prefix.sc-ir-m-combobox-h input.form-control.sc-ir-m-combobox{padding-left:calc(0.75rem + var(--ir-combobox-affix-size, 1rem))}.has-suffix.sc-ir-m-combobox-h input.form-control.sc-ir-m-combobox{padding-right:calc(0.75rem + var(--ir-combobox-affix-size, 1rem))}.dropdown.sc-ir-m-combobox{position:absolute;top:100%;left:0;z-index:1000;width:100%}.dropdown-menu.sc-ir-m-combobox{max-height:var(--ir-combobox-height, 200px);overflow-y:auto;min-width:100%;width:var(--ir-combobox-width, 100%) !important;scroll-behavior:smooth}.dropdown-item.loading.sc-ir-m-combobox,.dropdown-item.no-results.sc-ir-m-combobox{color:#6c757d;cursor:default;pointer-events:none}.dropdown-item.sc-ir-m-combobox{padding:0.5rem 1rem !important}.dropdown-item.active.sc-ir-m-combobox,.dropdown-item.sc-ir-m-combobox:active,.dropdown-item.focused.sc-ir-m-combobox{background-color:var(--blue, #1e9ff2) !important;color:white !important}[slot='dropdown-content'].sc-ir-m-combobox .dropdown-item.focused.sc-ir-m-combobox,[slot='dropdown-content'].sc-ir-m-combobox .dropdown-item.active.sc-ir-m-combobox{background-color:#1e9ff2 !important;color:white !important}[slot='dropdown-content'].sc-ir-m-combobox [data-option].focused.sc-ir-m-combobox,[slot='dropdown-content'].sc-ir-m-combobox [data-option].active.sc-ir-m-combobox{background-color:#1e9ff2 !important;color:white !important}";const a=r;const n=class{constructor(o){t(this,o);this.optionChange=i(this,"optionChange",7);this.searchQuery=i(this,"searchQuery",7);this.dataMode="static";this.options=[];this.debounceDelay=300;this.loading=false;this.useSlot=false;this.isOpen=false;this.focusedIndex=-1;this.filteredOptions=[];this.slotElements=[];this.hasPrefix=false;this.hasSuffix=false;this.itemChildren=[];this.id=h();this.dropdownId=`dropdown-${this.id}`;this.mo=null;this.handleDocumentClick=t=>{if(!this.el.contains(t.target)){this.closeDropdown()}};this.updateAffixPresence=()=>{try{const t=this.prefixSlotRef&&this.prefixSlotRef.assignedElements?this.prefixSlotRef.assignedElements():Array.from(this.el.querySelectorAll('[slot="prefix"]'));const i=this.suffixSlotRef&&this.suffixSlotRef.assignedElements?this.suffixSlotRef.assignedElements():Array.from(this.el.querySelectorAll('[slot="suffix"]'));this.hasPrefix=Array.isArray(t)?t.length>0:false;this.hasSuffix=Array.isArray(i)?i.length>0:false}catch(t){const i=this.el.querySelector('[slot="prefix"]');const o=this.el.querySelector('[slot="suffix"]');this.hasPrefix=!!i;this.hasSuffix=!!o}};this.handleKeyDown=t=>{const i=this.useSlot?this.slotElements.length-1:this.filteredOptions.length-1;switch(t.key){case"ArrowDown":t.preventDefault();if(!this.isOpen){this.openDropdown()}else{this.focusedIndex=Math.min(this.focusedIndex+1,i);if(this.useSlot){this.focusSlotElement(this.focusedIndex)}else{this.scrollToFocusedOption()}}break;case"ArrowUp":t.preventDefault();if(this.isOpen){this.focusedIndex=Math.max(this.focusedIndex-1,0);if(this.useSlot){this.focusSlotElement(this.focusedIndex)}else{this.scrollToFocusedOption()}}break;case"Enter":t.preventDefault();if(this.isOpen&&this.focusedIndex>=0){if(this.useSlot){this.selectSlotElement(this.focusedIndex)}else{this.selectOption(this.filteredOptions[this.focusedIndex])}}else if(!this.isOpen){this.openDropdown()}break;case"Escape":t.preventDefault();this.closeDropdown();break;case"Tab":if(this.isOpen){this.closeDropdown()}break}};this.handleInput=t=>{const i=t.target;const o=i.value;if(this.dataMode==="external"&&!this.isCompositionMode){this.emitSearchQuery(o)}else if(this.isCompositionMode){this.filterComposition(o)}else{const t=this.options.length>0?this.options:[];this.filteredOptions=o?t.filter((t=>t.label.toLowerCase().includes(o.toLowerCase()))):t}this.focusedIndex=-1;if(!this.isOpen){this.openDropdown()}}}async selectOptionFromSlot(t){this.selectOption(t)}get isCompositionMode(){return this.itemChildren.length>0}watchOptionsChanged(t){this.filteredOptions=t||[];if(this.useSlot){this.updateSlotElements()}}watchUseSlotChanged(){if(this.useSlot){setTimeout((()=>this.updateSlotElements()),0)}}componentWillLoad(){this.initializeOptions();this.collectItemChildren();this.mo=new MutationObserver((()=>this.collectItemChildren()));this.mo.observe(this.el,{childList:true,subtree:true})}componentDidLoad(){var t,i;document.addEventListener("click",this.handleDocumentClick.bind(this));if(this.useSlot){setTimeout((()=>this.updateSlotElements()),0)}setTimeout((()=>this.updateAffixPresence()),0);(t=this.prefixSlotRef)===null||t===void 0?void 0:t.addEventListener("slotchange",this.updateAffixPresence);(i=this.suffixSlotRef)===null||i===void 0?void 0:i.addEventListener("slotchange",this.updateAffixPresence)}disconnectedCallback(){var t,i,o;document.removeEventListener("click",this.handleDocumentClick.bind(this));if(this.debounceTimeout)clearTimeout(this.debounceTimeout);(t=this.prefixSlotRef)===null||t===void 0?void 0:t.removeEventListener("slotchange",this.updateAffixPresence);(i=this.suffixSlotRef)===null||i===void 0?void 0:i.removeEventListener("slotchange",this.updateAffixPresence);(o=this.mo)===null||o===void 0?void 0:o.disconnect()}handleDocumentKeyDown(t){var i;if(!this.isOpen)return;if(t.key==="Escape"){this.closeDropdown();(i=this.inputRef)===null||i===void 0?void 0:i.focus()}}handleComboboxItemSelect(t){t.stopPropagation();console.log(t.detail);this.selectOption(t.detail)}handleComboboxItemRegister(){this.collectItemChildren()}handleComboboxItemUnregister(){this.collectItemChildren()}initializeOptions(){this.filteredOptions=this.options.length>0?this.options:[]}openDropdown(){this.isOpen=true;if(this.isCompositionMode||this.useSlot){this.focusedIndex=-1;setTimeout((()=>this.isCompositionMode?this.updateSlotElementsForItems():this.updateSlotElements()),0)}else{this.focusedIndex=this.selectedOption?this.filteredOptions.findIndex((t=>t.value===this.selectedOption.value)):-1}}emitSearchQuery(t){if(this.debounceTimeout){clearTimeout(this.debounceTimeout)}this.debounceTimeout=setTimeout((()=>{this.searchQuery.emit(t)}),this.debounceDelay)}closeDropdown(){this.isOpen=false;this.focusedIndex=-1;this.removeSlotFocus()}updateSlotElements(){if(!this.useSlot||!this.dropdownRef)return;const t=this.dropdownRef.querySelector('slot[name="dropdown-content"]');if(t){const i=t.assignedElements?t.assignedElements():Array.from(this.el.querySelectorAll('[slot="dropdown-content"] [data-option]'));this.slotElements=i.length>0?i:Array.from(this.dropdownRef.querySelectorAll('[data-option], .dropdown-item[style*="cursor"]'));this.slotElements.forEach(((t,i)=>{t.setAttribute("data-slot-index",i.toString());t.setAttribute("role","option");t.setAttribute("tabindex","-1")}))}}removeSlotFocus(){this.slotElements.forEach((t=>{t.classList.remove("focused","active");t.removeAttribute("aria-selected")}))}focusSlotElement(t){this.removeSlotFocus();if(t>=0&&t<this.slotElements.length){const i=this.slotElements[t];i.classList.add("focused","active");i.setAttribute("aria-selected","true");i.scrollIntoView({block:"nearest"})}}selectSlotElement(t){if(t>=0&&t<this.slotElements.length){const i=this.slotElements[t];i.click()}}selectOption(t){this.selectedOption=t;this.optionChange.emit(t);this.closeDropdown();this.inputRef.focus()}scrollToFocusedOption(){if(this.focusedIndex<0||!this.dropdownRef||this.useSlot)return;const t=this.dropdownRef.querySelector(`#${this.dropdownId}-option-${this.focusedIndex}`);if(t){t.scrollIntoView({block:"nearest"})}}collectItemChildren(){const t=Array.from(this.el.querySelectorAll("ir-m-combobox-item"));this.itemChildren=t;console.log(t);if(this.isCompositionMode){this.useSlot=true;setTimeout((()=>this.updateSlotElementsForItems()),0)}}updateSlotElementsForItems(){this.slotElements=this.itemChildren;this.slotElements.forEach(((t,i)=>{t.setAttribute("data-slot-index",String(i));t.setAttribute("role","option");t.setAttribute("tabindex","-1")}))}async filterComposition(t){const i=await Promise.all(this.itemChildren.map((i=>i.matchesQuery(t))));await Promise.all(this.itemChildren.map(((o,s)=>o.setHidden(t?!i[s]:false))));this.updateSlotElementsForItems()}render(){var t;return o(s,{key:"62b2427eb7095965d13ea4388d1b87182355095a",class:{"has-prefix":this.hasPrefix,"has-suffix":this.hasSuffix}},o("div",{key:"90c9fbc684f1adc37527da183e5c26216fe3fdb5",class:"input-wrapper"},o("span",{key:"8f00e4adf352f50b63af1d3ad06c18892d79ed6a",class:"prefix-container","aria-hidden":!this.hasPrefix},o("slot",{key:"7f07f5b963e03735694d88f93b7c2870f5419777",name:"prefix",ref:t=>this.prefixSlotRef=t})),o("input",{key:"782c13570aa11a0cd7f24c666b971b0d0a08f6bf",ref:t=>this.inputRef=t,type:"text",class:"form-control",role:"combobox",id:this.id,value:((t=this.selectedOption)===null||t===void 0?void 0:t.label)||"",placeholder:this.placeholder,"aria-expanded":String(this.isOpen),"aria-autocomplete":"list","aria-controls":this.dropdownId,"data-reference":"parent","aria-haspopup":"listbox","aria-activedescendant":this.focusedIndex>=0?`${this.dropdownId}-option-${this.focusedIndex}`:null,"aria-label":"Combobox","aria-required":true,onKeyDown:this.handleKeyDown,onInput:this.handleInput}),o("span",{key:"060c45a0628192c987423e6aec92bc1362dc1d98",class:"suffix-container","aria-hidden":!this.hasSuffix},o("slot",{key:"64ae37e109ede9b4928291d23613231deb996a72",name:"suffix",ref:t=>this.suffixSlotRef=t}))),o("div",{key:"59254c25e33f096d516069e8f34c7b198fa630bd",class:`dropdown ${this.isOpen?"show":""}`},o("div",{key:"aa984248908b242cbef975db869ada33ad72cb45",ref:t=>this.dropdownRef=t,class:`dropdown-menu ${this.isOpen?"show":""}`,id:this.dropdownId,role:"listbox","aria-expanded":String(this.isOpen)},this.isCompositionMode?o("slot",null):this.useSlot?o("slot",{name:"dropdown-content"}):[this.loading&&o("div",{class:"dropdown-item loading"},"Loading..."),!this.loading&&this.filteredOptions.length===0&&o("div",{class:"dropdown-item no-results"},"No results found"),!this.loading&&this.filteredOptions.map(((t,i)=>{var s;return o("button",{id:`${this.dropdownId}-option-${i}`,class:`dropdown-item ${this.focusedIndex===i?"active":""}`,role:"option","aria-selected":((s=this.selectedOption)===null||s===void 0?void 0:s.value)===t.value?"true":"false",onClick:()=>this.selectOption(t),onMouseEnter:()=>this.focusedIndex=i,innerHTML:t.html_content},t.html_content?null:t.label)}))])))}get el(){return e(this)}static get watchers(){return{options:["watchOptionsChanged"],useSlot:["watchUseSlotChanged"]}}};n.style=a;export{n as ir_m_combobox};
//# sourceMappingURL=p-e1b82e98.entry.js.map