import{r as e,c as t,h as i,F as s,H as o,g as n}from"./p-53d64953.js";import{B as a,r as l}from"./p-086b1a65.js";import{E as r,F as d,v as c,j as h,a as g,t as b,G as f,H as u,I as p,h as v,J as m,K as k,L as y}from"./p-6b5d6ebe.js";import{h as w}from"./p-6c4ba7c0.js";import{E as x,P as D}from"./p-cba87a01.js";import{l as Y}from"./p-71768c2d.js";import{c as _}from"./p-c226aa13.js";import{z as C,Z as M}from"./p-b859bcd5.js";import{H as E}from"./p-b6c1681e.js";import{T as O}from"./p-c84e7d79.js";import{h as T,g as B}from"./p-25bd4703.js";import{c as R}from"./p-834ed596.js";import{i as S}from"./p-2e94af0d.js";import"./p-bf44a732.js";import"./p-a973aec7.js";const N=".sc-igl-booking-event-h{display:block;position:absolute;--ota-bar-width:2px;--stripe-period:20px;--split-border-width:5px;--split-border-color:black}.bookingEventBase.sc-igl-booking-event{position:absolute;width:100%;height:100%;border-radius:4px;background-color:rgb(49, 190, 241);transform:skewX(-22deg);cursor:pointer}.bookingEventBase.leftSplit.sc-igl-booking-event{border-left:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.rightSplit.sc-igl-booking-event{border-right:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.fullSplit.sc-igl-booking-event{border-right:var(--split-border-width) solid var(--split-border-color);border-left:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.fullSplit.skewedLeft.sc-igl-booking-event,.bookingEventBase.leftSplit.skewedLeft.sc-igl-booking-event{border-left:0}.bookingEventBase.fullSplit.skewedRight.sc-igl-booking-event,.bookingEventBase.leftSplit.skewedRight.sc-igl-booking-event{border-right:0}.bookingEvent.sc-igl-booking-event{cursor:pointer}.ota-booking-event.sc-igl-booking-event{border-width:var(--ota-bar-width) !important}.bookingEventHiddenBase.sc-igl-booking-event{position:absolute;top:0;left:-4px;width:calc(100% + 8px)}.bookingEventBase.skewedLeft.sc-igl-booking-event::before,.bookingEventBase.skewedRight.sc-igl-booking-event::before{content:'';position:absolute;top:0;bottom:0;width:50%;height:100%;left:-4px;background-color:var(--ir-event-bg);border-radius:4px}.bookingEventBase.skewedLeft.sc-igl-booking-event::before{transform-origin:right;transform:skewX(22deg);border-top-left-radius:0;border-bottom-left-radius:0}.bookingEventBase.fullSplit.skewedLeft.sc-igl-booking-event::before,.bookingEventBase.leftSplit.skewedLeft.sc-igl-booking-event::before{border-left:var(--split-border-width) solid var(--split-border-color) !important;z-index:2;background-color:transparent}.bookingEventBase.fullSplit.skewedRight.sc-igl-booking-event::before,.bookingEventBase.leftRight.skewedRight.sc-igl-booking-event::before{border-right:var(--split-border-width) solid var(--split-border-color) !important;z-index:2;background-color:transparent}.bookingEventBase.skewedRight.sc-igl-booking-event::before{transform-origin:left;transform:skewX(22deg 0deg);border-top-right-radius:0;border-bottom-right-radius:0}.bookingEventBase.border.skewedLeft.sc-igl-booking-event::before{border:var(--ota-bar-width) solid #424242;border-right:0;border-left:0;border-top-right-radius:0;border-bottom-right-radius:0;top:calc(var(--ota-bar-width) * -1);height:20px;left:-4px}.bookingEventBase.border.skewedRight.sc-igl-booking-event::before{border:var(--ota-bar-width) solid #424242;border-left:0;border-right:0;border-top-left-radius:0;border-bottom-left-radius:0;top:calc(var(--ota-bar-width) * -1);height:20px;right:-4px}.bookingEventBase.striped-bar.fullSplit.skewedLeft.vertical.sc-igl-booking-event::after,.bookingEventBase.striped-bar.leftSplit.skewedLeft.vertical.sc-igl-booking-event::after{z-index:1;border-left:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.striped-bar.fullSplit.skewedRight.vertical.sc-igl-booking-event::after,.bookingEventBase.striped-bar.rightSplit.skewedRight.vertical.sc-igl-booking-event::after{z-index:1;border-right:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.striped-bar.vertical.sc-igl-booking-event::after{--stripe-angle:360deg}.bookingEventBase.striped-bar.sc-igl-booking-event::after{content:'';position:absolute;inset:0;border-radius:4px;background:repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-event-bg) 0,\n    var(--ir-event-bg) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  );backface-visibility:hidden}.bookingEventBase.skewedRight.striped-bar.sc-igl-booking-event::after,.bookingEventBase.border.skewedRight.sc-igl-booking-event::after{right:-8px}.bookingEventBase.skewedLeft.striped-bar.sc-igl-booking-event::after,.bookingEventBase.border.skewedLeft.sc-igl-booking-event::after{left:-8px}.bookingEventBase.striped-bar.animated.sc-igl-booking-event::after{background-size:28.28px 28.28px;backface-visibility:hidden;animation:stripes 0.8s linear infinite;will-change:background-position}@keyframes stripes{0%{background-position:0 0}100%{background-position:28.28px 0}}.bookingEventDragHandle.sc-igl-booking-event{position:absolute;top:0;width:15px;height:100%;opacity:0.1;background-color:rgba(0, 0, 0, 0.15);transform:skewX(-22deg);border-radius:4px;cursor:pointer}.sc-igl-booking-event-h:hover .bookingEventDragHandle.sc-igl-booking-event{display:block;opacity:1}.newEvent.sc-igl-booking-event-h:hover .bookingEventDragHandle.sc-igl-booking-event{display:none;opacity:1}.leftSide.sc-igl-booking-event{left:0}.rightSide.sc-igl-booking-event{right:0}.leftSide.skewedLeft.sc-igl-booking-event{transform:skewX(0)}.rightSide.skewedRight.sc-igl-booking-event{transform:skewX(0)}.bookingEventTitle.sc-igl-booking-event{position:relative;top:2px;left:5px;max-width:calc(100% - 10px);color:#fff;font-size:0.8em;overflow:hidden;text-overflow:ellipsis;-webkit-user-select:none;user-select:none;-webkit-user-drag:none;cursor:pointer}.legend_circle.sc-igl-booking-event{width:10px;height:10px;margin:3px 3px 3px 2px;border:1px solid #fff;border-radius:100%}.noteIcon.sc-igl-booking-event{position:absolute;bottom:-8px;left:2px}.balanceIcon.sc-igl-booking-event{position:absolute;top:-8px;right:2px}.splitBooking.sc-igl-booking-event{border-right:2px solid #000000}";const A=N;var I=undefined&&undefined.__rest||function(e,t){var i={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0)i[s]=e[s];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,s=Object.getOwnPropertySymbols(e);o<s.length;o++){if(t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o]))i[s[o]]=e[s[o]]}return i};const L=class{constructor(i){e(this,i);this.hideBubbleInfo=t(this,"hideBubbleInfo",7);this.updateEventData=t(this,"updateEventData",7);this.dragOverEventData=t(this,"dragOverEventData",7);this.showRoomNightsDialog=t(this,"showRoomNightsDialog",7);this.showDialog=t(this,"showDialog",7);this.resetStretchedBooking=t(this,"resetStretchedBooking",7);this.toast=t(this,"toast",7);this.updateBookingEvent=t(this,"updateBookingEvent",7);this.is_vacation_rental=false;this.allBookingEvents=[];this.renderElement=false;this.isShrinking=null;this.dayWidth=0;this.eventSpace=8;this.vertSpace=10;this.showInfoPopup=false;this.bubbleInfoTopSide=false;this.isStretch=false;this.eventsService=new x;this.bookingService=new a;this.resizeSide="";this.isDragging=false;this.animationFrameId=null;this.handleMouseMoveBind=this.handleMouseMove.bind(this);this.handleMouseUpBind=this.handleMouseUp.bind(this);this.handleClickOutsideBind=this.handleClickOutside.bind(this);this.role="";this.findRoomType=e=>{let t=this.bookingEvent.roomsInfo.filter((t=>t.physicalrooms.some((t=>t.id===+e))));if(t.length){return t[0].id}return null}}componentWillLoad(){var e;window.addEventListener("click",this.handleClickOutsideBind);this.bookingEvent.SPLIT_INDEX=r(this.bookingEvent.ROOMS);if(this.bookingEvent.SPLIT_INDEX){this.role=(e=d(this.bookingEvent.SPLIT_INDEX,this.bookingEvent.IDENTIFIER))!==null&&e!==void 0?e:""}}componentDidLoad(){if(this.isNewEvent()){if(!this.bookingEvent.hideBubble){setTimeout((async()=>{if(["003","002","004"].includes(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}else{this.showEventInfo(true)}this.renderAgain()}),1)}}}disconnectedCallback(){window.removeEventListener("click",this.handleClickOutsideBind);if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}}handleClickOutside(e){const t=e.target;if(!this.element.contains(t)){this.showEventInfo(false)}}hideBubbleInfoPopup(e){if(e.detail.currentInfoBubbleId!=this.getBookingId()||e.detail.key==="hidebubble"&&e.detail.currentInfoBubbleId===this.getBookingId()){this.showInfoPopup=false;this.renderAgain()}}async moveBookingToHandler(e){var t,i,s;try{if(e.detail.bookingId!==this.getBookingId()){this.showEventInfo(false);return}if(e.detail.moveToDay==="revert"||e.detail.toRoomId==="revert"){e.detail.moveToDay=this.bookingEvent.FROM_DATE;e.detail.toRoomId=e.detail.fromRoomId;if(this.isTouchStart&&this.moveDifferenceX<=5&&this.moveDifferenceY<=5&&!this.isStretch){if(c(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}}else{this.animationFrameId=requestAnimationFrame((()=>{this.resetBookingToInitialPosition()}));return}}else{if(this.isTouchStart&&this.moveDifferenceX<=5&&this.moveDifferenceY<=5&&!this.isStretch){if(c(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}}else{const{pool:o,to_date:n,from_date:a,toRoomId:l}=e.detail;const r=w(n,"YYYY-MM-DD").add(-1,"days").format("YYYY-MM-DD");console.log(this.findRoomType(Number(this.bookingEvent.PR_ID)),this.findRoomType(Number(l)));if((!w(this.bookingEvent.TO_DATE,"YYYY-MM-DD").isSame(w(n,"YYYY-MM-DD"),"dates")||this.findRoomType(Number(this.bookingEvent.PR_ID))!==this.findRoomType(Number(l)))&&(((t=h.disabled_cells.get(`${l}_${a}`))===null||t===void 0?void 0:t.disabled)||((i=h.disabled_cells.get(`${l}_${n}`))===null||i===void 0?void 0:i.disabled)&&((s=h.disabled_cells.get(`${l}_${r}`))===null||s===void 0?void 0:s.disabled))&&!this.isStretch){this.reset("This room isnâ€™t available for the entire selected period. Please choose different dates or a different room.")}if(this.checkIfSlotOccupied(l,a,n)){this.reset("Overlapping Dates")}if(o){if(c(this.bookingEvent.STATUS_CODE)){await this.eventsService.reallocateEvent(o,l,a,n).catch((()=>{this.resetBookingToInitialPosition()}))}else{if(this.isShrinking||!this.isStretch){const{description:t,status:i,newRatePlans:s}=this.getModalDescription(l,a,n);let o=false;if(i==="400"){o=true}const r=this.bookingEvent.defaultDates.from_date;const d=this.bookingEvent.defaultDates.to_date;const c=g(r,d);let h=null;let b=r;let f=d;if(this.isShrinking){if(w(a,"YYYY-MM-DD").isAfter(w(r,"YYYY-MM-DD"))&&w(n,"YYYY-MM-DD").isBefore(w(d,"YYYY-MM-DD"))){b=r;f=n}else{h=w(a,"YYYY-MM-DD").isAfter(w(r,"YYYY-MM-DD"))?"left":w(n,"YYYY-MM-DD").isBefore(w(d,"YYYY-MM-DD"))?"right":null;if(h==="left"){b=a}if(h==="right"){f=n}}}else{console.log("stretching");if(w(a,"YYYY-MM-DD").isBefore(w(r,"YYYY-MM-DD"))){b=a;const e=w(a,"YYYY-MM-DD").add(c,"days");f=e.isBefore(w(n,"YYYY-MM-DD"),"days")?n:e.format("YYYY-MM-DD")}else if(w(n,"YYYY-MM-DD").isAfter(w(d,"YYYY-MM-DD"))){f=n;b=w(n,"YYYY-MM-DD").subtract(c,"days").format("YYYY-MM-DD")}}console.warn({fromDate:b,toDate:f});this.showDialog.emit(Object.assign(Object.assign({reason:"reallocate"},e.detail),{description:t,title:"",rateplans:s,hideConfirmButton:o,from_date:b,to_date:f}))}else{const e=this.bookingEvent.defaultDates.from_date;const t=this.bookingEvent.defaultDates.to_date;const i=(e,t)=>{var i;let s=e;let o=0;while(s!==t){if((i=h.disabled_cells.get(`${l}_${s}`))===null||i===void 0?void 0:i.disabled){o++}s=w(s,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD")}if(o>=1){this.reset(Y.entries.Lcz_ThisUnitIsNotAvailable)}};if(w(t,"YYYY-MM-DD").isBefore(w(n),"dates")){i(t,n)}else if(w(e,"YYYY-MM-DD").isAfter(w(a,"YYYY-MM-DD"),"dates")){i(a,e)}const s={booking:this.bookingEvent,bookingNumber:this.bookingEvent.BOOKING_NUMBER,identifier:this.bookingEvent.IDENTIFIER,to_date:n,pool:o,from_date:a,defaultDates:this.bookingEvent.defaultDates};if(!this.bookingEvent.is_direct){this.showDialog.emit(Object.assign({reason:"stretch"},s))}else{this.showRoomNightsDialog.emit(s)}}}this.isShrinking=null}}}}catch(e){this.toast.emit({position:"top-right",title:e.message,description:"",type:"error"});console.log("something went wrong")}}async fetchAndAssignBookingData(){try{console.log("clicked on book#",this.bookingEvent.BOOKING_NUMBER);const e=["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"];if(!e.includes(this.bookingEvent.STATUS)){return}const t=await this.bookingService.getExposedBooking(this.bookingEvent.BOOKING_NUMBER,"en");const i=Object.assign({},t);const s=t.rooms.filter((e=>e["assigned_units_pool"]===this.bookingEvent.ID));if(s.length===0){throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty array`)}if(s.some((e=>e["assigned_units_pool"]===null))){throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty pool`)}t.rooms=s;const o=b(t)[0];const{ID:n,TO_DATE:a,FROM_DATE:l,NO_OF_DAYS:r,STATUS:d,NAME:c,IDENTIFIER:h,origin:g,TOTAL_PRICE:f,PR_ID:u,POOL:p,BOOKING_NUMBER:v,NOTES:m,is_direct:k,BALANCE:y,channel_booking_nbr:w}=o,x=I(o,["ID","TO_DATE","FROM_DATE","NO_OF_DAYS","STATUS","NAME","IDENTIFIER","origin","TOTAL_PRICE","PR_ID","POOL","BOOKING_NUMBER","NOTES","is_direct","BALANCE","channel_booking_nbr"]);this.bookingEvent=Object.assign(Object.assign(Object.assign({},x),this.bookingEvent),{channel_booking_nbr:w,booking:t,base_booking:i,DEPARTURE_TIME:x.DEPARTURE_TIME,PHONE:x.PHONE,PHONE_PREFIX:x.PHONE_PREFIX,PRIVATE_NOTE:x.PRIVATE_NOTE,origin:g,BALANCE:y,TOTAL_PRICE:f,ROOM_INFO:Object.assign(Object.assign({},this.bookingEvent.ROOM_INFO),{sharing_persons:x.ROOM_INFO.sharing_persons})});this.updateBookingEvent.emit(this.bookingEvent);this.showEventInfo(true)}catch(e){console.error(e.message)}}reset(e){this.animationFrameId=requestAnimationFrame((()=>{this.resetBookingToInitialPosition()}));throw new Error(e)}getModalDescription(e,t,i){var s,o;if(!this.bookingEvent.is_direct){if(this.isShrinking){return{description:Y.entries.Lcz_OTA_Modification_Alter,status:"200"}}else{if(w(t,"YYYY-MM-DD").isSame(w(this.bookingEvent.FROM_DATE,"YYYY-MM-DD"))&&w(i,"YYYY-MM-DD").isSame(w(this.bookingEvent.TO_DATE,"YYYY-MM-DD"))){const t=this.findRoomType(this.bookingEvent.PR_ID);const i=this.findRoomType(e);if(t===i){return{description:`${Y.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`,status:"200"}}else{const e=f({rateplan_id:this.bookingEvent.RATE_PLAN_ID,roomTypeId:i,roomTypes:(s=_===null||_===void 0?void 0:_.property)===null||s===void 0?void 0:s.roomtypes});return{description:Y.entries.Lcz_OTA_Modification_Alter,status:"200",newRatePlans:Array.isArray(e)?e:undefined}}}return{description:Y.entries.Lcz_CannotChangeCHBookings+".",status:"400"}}}else{if(!this.isShrinking){const t=this.findRoomType(Number(this.bookingEvent.PR_ID));const i=this.findRoomType(Number(e));if(t===i){console.log("same rt");if(this.bookingEvent.PR_ID.toString()===e.toString()){return{description:Y.entries.Lcz_ConfrmModiication+".",status:"200"}}return{description:`${Y.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`,status:"200"}}else{const e=f({rateplan_id:this.bookingEvent.RATE_PLAN_ID,roomTypeId:i,roomTypes:(o=_===null||_===void 0?void 0:_.property)===null||o===void 0?void 0:o.roomtypes});return{description:Y.entries.Lcz_SameRatesWillBeKept,status:"200",newRatePlans:Array.isArray(e)?e:undefined}}}return{description:Y.entries.Lcz_ConfrmModiication+".",status:"200"}}}resetBookingToInitialPosition(){if(this.isStretch){this.element.style.left=`${this.initialLeft}px`;this.element.style.width=`${this.initialWidth}px`;this.isStretch=false;this.finalWidth=this.initialWidth;this.isShrinking=null}else{this.element.style.top=`${this.dragInitPos.top}px`;this.element.style.left=`${this.dragInitPos.left}px`}}handleRevertBooking(e){if(this.bookingEvent.POOL===e.detail){this.resetBookingToInitialPosition()}}checkIfSlotOccupied(e,t,i){const s=w(t,"YYYY-MM-DD");const o=w(i,"YYYY-MM-DD");const n=this.allBookingEvents.some((t=>{if(t.POOL===this.bookingEvent.POOL){return false}const i=w(t.FROM_DATE,"YYYY-MM-DD").add(1,"days");const n=w(t.TO_DATE,"YYYY-MM-DD");return t.PR_ID===+e&&o.isSameOrAfter(i)&&s.isBefore(n)}));return n}renderAgain(){this.renderElement=!this.renderElement}getUniqueId(){return(new Date).getTime()}isSplitBooking(){return!!this.bookingEvent.SPLIT_BOOKING}isNewEvent(){return this.getBookingId()==="NEW_TEMP_EVENT"}isHighlightEventType(){return this.getEventType()==="HIGH_LIGHT"}getBookingId(){return this.bookingEvent.ID}getBookingStatus(){return this.bookingEvent.STATUS}getBookedBy(){return this.bookingEvent.NAME}getBookedRoomId(){return this.bookingEvent.PR_ID}getEventStartingDate(){return new Date(this.bookingEvent.FROM_DATE)}getEventEndingDate(){return new Date(this.bookingEvent.TO_DATE)}getEventType(){return this.bookingEvent.event_type}getEventLegend(){var e,t;let i=(e=this.bookingEvent)===null||e===void 0?void 0:e.legendData.statusId[this.getBookingStatus()];let s=this.isNewEvent()?{color:"#f9f9c9"}:{};return Object.assign(Object.assign(Object.assign({},(t=this.bookingEvent)===null||t===void 0?void 0:t.legendData[i.id]),i),s)}getLegendOfStatus(e){var t;let i=(t=this.bookingEvent)===null||t===void 0?void 0:t.legendData.statusId[e];return Object.assign(Object.assign({},this.bookingEvent.legendData[i.id]),i)}getNoteNode(){if(this.bookingEvent.NOTES||this.bookingEvent.INTERNAL_NOTE||this.bookingEvent.PRIVATE_NOTE){return this.getLegendOfStatus("NOTES")}return null}getBalanceNode(){if(this.bookingEvent.BALANCE!==null&&this.bookingEvent.BALANCE>=1){return this.getLegendOfStatus("OUTSTANDING-BALANCE")}return null}setStayDays(e){this.bookingEvent.NO_OF_DAYS=e;this.renderAgain()}getStayDays(){return this.bookingEvent.NO_OF_DAYS}getPosition(){let e=this.getEventStartingDate();let t=".room_"+this.getBookedRoomId()+"_"+e.getDate()+"_"+(e.getMonth()+1)+"_"+e.getFullYear();let i=document.querySelector(".bodyContainer");let s=document.querySelector(t);let o={top:"0",left:"0",width:"0",height:"20px"};if(s&&i&&s.getBoundingClientRect()&&i.getBoundingClientRect()){let e=i.getBoundingClientRect();let t=s.getBoundingClientRect();this.dayWidth=this.dayWidth||t.width;o.top=t.top+t.height/2-this.vertSpace-e.top+"px";o.left=t.left+(!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?0:this.dayWidth/2)+this.eventSpace/2-e.left+"px";o.width=(this.getStayDays()+(!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?.5:0))*this.dayWidth-this.eventSpace+"px"}else{console.log(this.bookingEvent);console.log("Locating event cell failed ",t)}return o}getNumber(e){return e?parseFloat(e):0}startDragging(e,t){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(this.isNewEvent()||this.isHighlightEventType()){return null}this.resizeSide=t;this.isDragging=true;this.showEventInfo(false);this.isStretch=t!=="move";if(t==="move"){this.initialX=e.clientX||e.touches[0].clientX;this.initialY=e.clientY||e.touches[0].clientY;this.elementRect=this.element.getBoundingClientRect();const t=0;const i=0;this.dragInitPos={id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.getNumber(this.element.style.top)+i,left:this.getNumber(this.element.style.left)+t};this.dragInitPos.x=this.dragInitPos.left;this.dragInitPos.y=this.dragInitPos.top;this.dragEndPos=Object.assign({},this.dragInitPos);this.element.style.top=`${this.dragInitPos.top}px`;this.element.style.left=`${this.dragInitPos.left}px`;this.isTouchStart=true;this.dragOverEventData.emit({id:"CALCULATE_DRAG_OVER_BOUNDS",data:this.dragInitPos})}else{this.initialWidth=this.element.offsetWidth;this.initialLeft=this.element.offsetLeft;this.initialX=e.clientX||e.touches[0].clientX;this.dragOverEventData.emit({id:"CALCULATE_DRAG_OVER_BOUNDS",data:{id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.getNumber(this.element.style.top),left:this.initialLeft,x:this.initialX,y:e.clientY||e.touches[0].clientY}})}document.addEventListener("mousemove",this.handleMouseMoveBind);document.addEventListener("touchmove",this.handleMouseMoveBind);document.addEventListener("pointermove",this.handleMouseMoveBind);document.addEventListener("mouseup",this.handleMouseUpBind);document.addEventListener("touchup",this.handleMouseUpBind);document.addEventListener("pointerup",this.handleMouseUpBind)}handleMouseMove(e){if(this.isDragging){this.currentX=e.clientX||e.touches[0].clientX;let t=this.currentX-this.initialX;if(this.resizeSide==="move"){this.currentY=e.clientY||e.touches[0].clientY;let i=this.currentY-this.initialY;this.element.style.top=`${this.dragInitPos.top+i}px`;this.element.style.left=`${this.dragInitPos.left+t}px`;this.dragEndPos={id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.dragInitPos.top+i,left:this.dragInitPos.left+t};this.dragEndPos.x=this.dragEndPos.left;this.dragEndPos.y=this.dragEndPos.top;this.dragOverEventData.emit({id:"DRAG_OVER",data:this.dragEndPos})}else{if(this.role==="fullSplit"){return}const e=!this.bookingEvent.is_direct&&!c(this.bookingEvent.STATUS_CODE);let i=this.initialWidth;if(this.resizeSide=="rightSide"){i=this.initialWidth+t;i=Math.min(i,this.initialX+this.element.offsetWidth);i=Math.max(this.dayWidth-this.eventSpace,i);this.isShrinking=t<0;if(!this.isShrinking&&e){return}if(this.role==="rightSplit"){return}this.element.style.width=`${i}px`}else if(this.resizeSide=="leftSide"){this.isShrinking=t>0;if(!this.isShrinking&&e){return}if(this.role==="leftSplit"){return}i=Math.max(this.dayWidth-this.eventSpace,this.initialWidth-t);let s=this.initialLeft+(this.initialWidth-i);this.element.style.left=`${s}px`;this.element.style.width=`${i}px`}this.finalWidth=i}}else{console.log("still mouse move listening...")}}handleMouseUp(){if(this.isDragging){if(this.resizeSide==="move"){if(this.isTouchStart){this.moveDifferenceX=Math.abs(this.dragEndPos.x-this.dragInitPos.x);this.moveDifferenceY=Math.abs(this.dragEndPos.y-this.dragInitPos.y)}this.dragOverEventData.emit({id:"DRAG_OVER_END",data:Object.assign(Object.assign({},this.dragEndPos),{pool:this.bookingEvent.POOL,nbOfDays:this.bookingEvent.NO_OF_DAYS})})}else{const e=this.finalWidth-(!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?this.dayWidth/2:0);const t=Math.round(e/this.dayWidth);console.log(e,this.dayWidth,t);let i=this.getStayDays();if(i!=t&&!isNaN(t)){if(this.resizeSide=="leftSide"){this.element.style.left=`${this.initialLeft+(i-t)*this.dayWidth}px`}else{if(t<i){this.isShrinking=true}}this.dragOverEventData.emit({id:"STRETCH_OVER_END",data:{id:this.getBookingId(),fromRoomId:+this.getBookedRoomId(),x:+this.element.style.left.replace("px",""),y:+this.element.style.top.replace("px",""),pool:this.bookingEvent.POOL,nbOfDays:t}});const e=!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?+this.dayWidth/2:0;this.element.style.width=`${t*this.dayWidth-this.eventSpace+e}px`}else{this.element.style.left=`${this.initialLeft}px`;this.element.style.width=`${t*this.dayWidth-this.eventSpace}px`}}}else{console.log("still mouse up listening...")}this.isDragging=false;document.removeEventListener("mousemove",this.handleMouseMoveBind);document.removeEventListener("touchmove",this.handleMouseMoveBind);document.removeEventListener("pointermove",this.handleMouseMoveBind);document.removeEventListener("mouseup",this.handleMouseUpBind);document.removeEventListener("touchup",this.handleMouseUpBind);document.removeEventListener("pointerup",this.handleMouseUpBind)}updateData(e){this.updateEventData.emit(e)}calculateHoverPosition(){const e=this.element.getBoundingClientRect();const t=e.width;const i=e.left;const s=window.innerWidth;let o;if(t<=s){o=t/2}else{o=s/2-i}return{position:"absolute",left:`${o}px`,transform:"translateX(-50%)"}}renderEventBookingNumber(){if(this.bookingEvent.STATUS==="TEMP-EVENT"||this.bookingEvent.ID==="NEW_TEMP_EVENT"){return""}if(c(this.bookingEvent.STATUS_CODE)){return""}if(!this.bookingEvent.is_direct){return` - ${this.bookingEvent.channel_booking_nbr}`}return` - ${this.bookingEvent.BOOKING_NUMBER}`}showEventInfo(e){if(this.isHighlightEventType()||this.bookingEvent.hideBubble){return null}if(e){let e=document.querySelector(".calendarScrollContainer");let t=e.getBoundingClientRect();let i=this.element.getBoundingClientRect();let s=t.height/2+t.top+50;if(i.top<s){this.bubbleInfoTopSide=false}else{this.bubbleInfoTopSide=true}}if(e){this.hideBubbleInfo.emit({key:"hidePopup",currentInfoBubbleId:this.getBookingId()})}this.showInfoPopup=e;this.renderAgain()}render(){var e,t,n,a,l,r;let d=this.getEventLegend();let h=this.getNoteNode();let g=this.getBalanceNode();let b=((e=this.bookingEvent.ROOM_INFO)===null||e===void 0?void 0:e.calendar_extra)?(a=(n=(t=this.bookingEvent.ROOM_INFO.calendar_extra)===null||t===void 0?void 0:t.booking_color)===null||n===void 0?void 0:n.color)!==null&&a!==void 0?a:d.color:d.color;const{foreground:f,stripe:u}=(r=(l=_.colorsForegrounds)===null||l===void 0?void 0:l[b])!==null&&r!==void 0?r:{foreground:"",checkout:""};b=this.bookingEvent.STATUS==="CHECKED-OUT"?d.color:b;return i(o,{key:"2ea25aafea0b6032326a7dcfe07ae80235c032b2",class:`bookingEvent  ${this.isNewEvent()||this.isHighlightEventType()?"newEvent":""} ${d.clsName} `,style:this.getPosition(),id:"event_"+this.getBookingId()},i("div",{key:"03022647d917ac2246280df29168e3572daf3cb4",class:{bookingEventBase:true,skewedLeft:!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)),skewedRight:!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)),"striped-bar vertical":this.bookingEvent.STATUS==="IN-HOUSE","striped-bar animated":c(this.bookingEvent.STATUS_CODE)&&this.bookingEvent.STATUS_CODE==="003","border border-dark ota-booking-event":!this.bookingEvent.is_direct&&!c(this.bookingEvent.STATUS_CODE)&&this.bookingEvent.STATUS!=="TEMP-EVENT"&&this.bookingEvent.ID!=="NEW_TEMP_EVENT",[this.role]:true},style:{backgroundColor:b,"--ir-event-bg":b,"--ir-event-bg-stripe-color":u},onTouchStart:e=>this.startDragging(e,"move"),onMouseDown:e=>this.startDragging(e,"move")}),h?i("div",{class:"legend_circle noteIcon",style:{backgroundColor:h.color}}):null,g?i("div",{class:"legend_circle balanceIcon",style:{backgroundColor:g.color}}):null,i("div",{key:"a5987c2c73250cc1cf4dd7ef72557a1c08d25268",class:"bookingEventTitle",style:{color:f},onTouchStart:e=>this.startDragging(e,"move"),onMouseDown:e=>this.startDragging(e,"move")},this.getBookedBy(),this.renderEventBookingNumber()),i(s,{key:"183c99af0db20ee8a7d7c1ba1740ec1bee4b2493"},i("div",{key:"115694aa3c601950944a91d07c22c2cacc6cb141",class:`bookingEventDragHandle leftSide ${!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?"skewedLeft":""}\n            ${!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE))?"skewedRight":""}`,onTouchStart:e=>this.startDragging(e,"leftSide"),onMouseDown:e=>this.startDragging(e,"leftSide")}),i("div",{key:"f26f4448f7d2eeff9018089a8e0c8cde2bbf84ed",class:`bookingEventDragHandle rightSide ${!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?"skewedLeft":""}\n              ${!this.isNewEvent()&&w(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE))?"skewedRight":""}`,onTouchStart:e=>this.startDragging(e,"rightSide"),onMouseDown:e=>this.startDragging(e,"rightSide")})),this.showInfoPopup?i("igl-booking-event-hover",{is_vacation_rental:this.is_vacation_rental,countries:this.countries,currency:this.currency,class:"top",bookingEvent:this.bookingEvent,bubbleInfoTop:this.bubbleInfoTopSide,style:this.calculateHoverPosition()}):null)}get element(){return n(this)}};L.style=A;class j{constructor(e){var t;this.isActive=false;this.handleBeforeUnload=e=>{this.onIntercept();e.preventDefault();e.returnValue=""};this.onIntercept=(t=e.onIntercept)!==null&&t!==void 0?t:()=>{};if(e.autoActivate){this.activate()}}activate(){if(this.isActive)return;window.addEventListener("beforeunload",this.handleBeforeUnload,{capture:true});this.isActive=true}deactivate(){if(!this.isActive)return;window.removeEventListener("beforeunload",this.handleBeforeUnload,{capture:true});this.isActive=false}}const z=".sc-igl-bulk-block-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-bulk-block{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-bulk-block{transition:all 0.5s ease}.physical-room.sc-igl-bulk-block{margin-left:1rem !important;padding-top:0.5rem}.physical-room.sc-igl-bulk-block>td.sc-igl-bulk-block:last-child{padding-left:1rem}.room-type-list.sc-igl-bulk-block{padding:0;margin:0}.room-type-list.sc-igl-bulk-block>li.sc-igl-bulk-block,.physical-room.sc-igl-bulk-block,.room-type-row.sc-igl-bulk-block{list-style:none}";const P=z;const H=".sc-igl-bulk-block-h{height:100%}.sheet-container.sc-igl-bulk-block{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-block{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-block{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-block{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-block{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-block{flex-direction:row;align-items:center}}";const F=H;const U=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.toast=t(this,"toast",7);this.maxDatesLength=8;this.selectedRoomTypes=new Map;this.selectedUnit=null;this.blockState="block";this.dates=[{from:null,to:null}];this.dateRefs=[];this.minDate=w().format("YYYY-MM-DD");this.bookingService=new a;this.datesSchema=C.array(C.object({from:C.any().refine((e=>w.isMoment(e)),{message:"Invalid 'from' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD"))),to:C.any().refine((e=>w.isMoment(e)),{message:"Invalid 'to' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD")))}))}componentDidLoad(){this.reloadInterceptor=new j({autoActivate:false});this.sidebar=document.querySelector("ir-sidebar")}disconnectedCallback(){this.reloadInterceptor.deactivate()}async addBlockDates(){var e,t;try{this.errors=null;this.isLoading=true;const i=this.datesSchema.parse(this.dates);if(!this.selectedUnit){this.unitSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="rooms";return}if(this.blockState==="block"){await this.bookingService.blockAvailabilityForBrackets({unit_id:(e=this.selectedUnit)===null||e===void 0?void 0:e.unit_id,description:"",block_status_code:"002",brackets:i.map((e=>({from_date:e.from,to_date:e.to})))})}else{await this.bookingService.unBlockUnitByPeriod({unit_id:(t=this.selectedUnit)===null||t===void 0?void 0:t.unit_id,from_date:i[0].from,to_date:i[0].to})}this.activate();this.deactivate();this.toast.emit({type:"success",title:Y.entries.Lcz_RequestSubmittedSuccessfully,description:""});this.isLoading=false;this.closeModal.emit()}catch(e){console.log(e);if(e instanceof M){this.datesSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="dates"}}finally{this.isLoading=false}}activate(){this.reloadInterceptor.activate();if(this.sidebar)this.sidebar.preventClose=true}deactivate(){this.reloadInterceptor.deactivate();if(this.sidebar)this.sidebar.preventClose=false}handleDateChange({index:e,date:t,key:i}){var s,o;const n=[...this.dates];n[e]=Object.assign(Object.assign({},n[e]),{[i]:t});if(i==="from"&&((s=n[e].to)===null||s===void 0?void 0:s.isBefore(t,"dates"))){n[e].to=null}for(let i=e+1;i<n.length;i++){const e=(o=n[i])===null||o===void 0?void 0:o.from;if(e&&e.isSameOrBefore(t,"day")){n[i]={from:null,to:null}}}this.dates=n;setTimeout((()=>{var t,s;if(i==="from"){(t=this.dateRefs[e])===null||t===void 0?void 0:t.to.openDatePicker()}else{const e=n.findIndex((e=>e.from===null));if(e>-1){(s=this.dateRefs[e])===null||s===void 0?void 0:s.from.openDatePicker()}}}),100)}addDateRow(){const e=this.dates[this.dates.length-1];if(!e.from||!e.to){this.errors="dates";return}this.errors=null;this.dates=[...this.dates,{from:null,to:null}];setTimeout((()=>{var e;(e=this.dateRefs[this.dates.length-1].to)===null||e===void 0?void 0:e.scrollIntoView({behavior:"smooth",block:"center"})}),100)}render(){return i("form",{key:"28897841a28871c89262b39941ca790668ecb079",class:"bulk-sheet-container",onSubmit:e=>{e.preventDefault();this.addBlockDates()}},i("div",{key:"85c3a6b6c7ea90623368381d512cd78be43baf3f",class:"sheet-body px-1"},i("div",{key:"0d0ca78feeda312ba5d7a5c310142060ea2f72dc",class:"text-muted text-left pt-0 my-0 d-flex align-items-center pb-1",style:{gap:"0.5rem"}},i("p",{key:"87bf5c41226b0c463c6c4bf2e984aad7e287b4ea",class:"m-0 p-0"},"Select the unit to"),i("ir-select",{key:"311875577ce0ba644c52bbe0a5521ee8edf98b2c",showFirstOption:false,selectedValue:this.blockState,data:[{text:"Block",value:"block"},{text:"Unblock",value:"unblock"}],onSelectChange:e=>{this.blockState=e.detail}})),i("div",{key:"a62e53437fb84bb18774d1100e7c247fec8efaad"},this.errors==="rooms"&&i("p",{key:"935efa72401becffa905e57658e6173a3851be45",class:"text-danger text-left smaller p-0 ",style:{"margin-bottom":"0.5rem"}},_.is_vacation_rental?Y.entries.Lcz_PlzSelectOneListing:Y.entries.Lcz_PlzSelectOneUnit),i("ul",{key:"a13da8da2647be9cec3641f3255e2a6c9b5af073",class:"room-type-list",ref:e=>this.unitSections=e},_.roomsInfo.map((e=>i(s,null,i("li",{key:`roomTypeRow-${e.id}`,class:`room-type-row`},i("div",{class:"d-flex choice-row"},i("span",{class:"pl-1 text-left room-type-name"},e.name))),e.physicalrooms.map(((t,s)=>{var o;const n=s===e.physicalrooms.length-1?"pb-1":"";return i("li",{key:`physicalRoom-${t.id}-${s}`,class:`physical-room ${n}`},i("div",{class:"d-flex choice-row"},i("ir-radio",{class:"pl-1 ",name:"unit",checked:((o=this.selectedUnit)===null||o===void 0?void 0:o.unit_id)===t.id,onCheckChange:()=>this.selectedUnit={roomtype_id:e.id,unit_id:t.id},label:t.name})))}))))))),i("table",{key:"56d57817ea6b86a83d88095cd5f5bef6cf779492",class:"mt-1",ref:e=>this.datesSections=e},i("thead",{key:"8c038d4b0b4503a41151e320a2ae8250bbc59b9e"},i("tr",{key:"9ede2a0c046b94cca8ae4850ea1d0a0a75e43289"},i("th",{key:"6aa74d2f9938875fb89a72b0b22614bfc8445c8d",class:"text-left"},Y.entries.Lcz_From),i("th",{key:"55932857fe3240065e9a1bf8a08ba36927230de6",class:"text-left"},Y.entries.Lcz_ToExclusive),i("td",{key:"e6eb25956fd3e51cc006e23cac9b5b522718f9ab"},this.dates.length!==this.maxDatesLength&&this.blockState==="block"&&i("ir-button",{key:"1017f947716b17aa7bfb72e2d19158fcaa1adfd6",variant:"icon",icon_name:"plus",onClickHandler:()=>{this.addDateRow()}})))),i("tbody",{key:"63917917171a9f063687af44a9cdd0489f15459c"},this.dates.map(((e,t)=>{var s,o,n,a,l,r,d;if(!this.dateRefs[t]){this.dateRefs[t]={}}const c=t>0?(n=(o=(s=this.dates[t-1])===null||s===void 0?void 0:s.to.clone().add(1,"days"))===null||o===void 0?void 0:o.format("YYYY-MM-DD"))!==null&&n!==void 0?n:this.minDate:this.minDate;const h=this.dates[t].from?(l=(a=this.dates[t])===null||a===void 0?void 0:a.from.clone().add(1,"days"))===null||l===void 0?void 0:l.format("YYYY-MM-DD"):this.minDate;return i("tr",{key:`date_${t}`},i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{ref:e=>{this.dateRefs[t].from=e},forceDestroyOnUpdate:true,minDate:c,"data-testid":"pickup_arrival_date",date:(r=e.from)===null||r===void 0?void 0:r.format("YYYY-MM-DD"),emitEmptyDate:true,"aria-invalid":String(this.errors==="dates"&&!e.from),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"from"})},onDatePickerFocus:e=>{var i,s,o;e.stopImmediatePropagation();e.stopPropagation();if(t===0){return}const n=this.dates.findIndex((e=>!e.from||!e.to));if(!((i=this.dates[n])===null||i===void 0?void 0:i.from)){(s=this.dateRefs[n])===null||s===void 0?void 0:s.from.openDatePicker();return}if(!((o=this.dates[n])===null||o===void 0?void 0:o.to)){this.dateRefs[n].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.from?e.from.format("MMM DD, YYYY"):null,class:`form-control input-sm ${this.errors==="dates"&&!e.to?"border-danger":""} text-center`,style:{width:"100%"}}))),i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{forceDestroyOnUpdate:true,ref:e=>{this.dateRefs[t].to=e},"data-testid":"pickup_arrival_date",date:(d=e.to)===null||d===void 0?void 0:d.format("YYYY-MM-DD"),emitEmptyDate:true,minDate:h,"aria-invalid":String(this.errors==="dates"&&!e.to),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"to"})},maxDate:e.from?w(e.from).add(3,"months").format("YYYY-MM-DD"):undefined,onDatePickerFocus:e=>{var t,i,s,o;e.stopImmediatePropagation();e.stopPropagation();const n=this.dates.findIndex((e=>!e.from||!e.to));if(!((t=this.dates[n])===null||t===void 0?void 0:t.from)){(s=(i=this.dateRefs[n])===null||i===void 0?void 0:i.from)===null||s===void 0?void 0:s.openDatePicker();return}if(!((o=this.dates[n])===null||o===void 0?void 0:o.to)){this.dateRefs[n].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.to?e.to.format("MMM DD, YYYY"):null,class:`form-control input-sm \n                          ${this.errors==="dates"&&!e.to?"border-danger":""}\n                          text-center`,style:{width:"100%"}}))),t>0&&i("td",{class:"pb-1"},i("ir-button",{variant:"icon",icon_name:"minus",onClickHandler:()=>{this.dates=this.dates.filter(((e,i)=>i!==t))}})))}))))),i("div",{key:"9c8f79f1a255c190f2c9abb4b8b4b25f8d71be42",class:"sheet-footer"},i("ir-button",{key:"41d1a543395aca22f097b2c563b8538926491fdd",text:Y.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"b4c539f38a66e8260468d67c52cc8a8e256cbf27",isLoading:this.isLoading,text:Y.entries.Lcz_Confirm,btn_type:"submit",class:"flex-fill"})))}};U.style=P+F;const V=".bulk-operations-sheet-container.sc-igl-bulk-operations{display:flex;flex-direction:column;height:auto !important;min-height:100vh;background:white !important}.animated-container.sc-igl-bulk-operations{transition:all 0.5s ease}.tabs.sc-igl-bulk-operations{position:sticky;top:var(--ir-tabs-top, 54px);background-color:white;z-index:9999999;padding-top:1rem;margin-bottom:1rem}";const G=V;const W=".sc-igl-bulk-operations-h{height:100%}.sheet-container.sc-igl-bulk-operations{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-operations{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-operations{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-operations{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-operations{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-operations{flex-direction:row;align-items:center}}";const K=W;const X=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.toast=t(this,"toast",7);this.maxDatesLength=8;this.tabs=[{id:"stop-sale",label:"Stop/Open Sale"},{id:"block",label:"Block Unit"}]}componentDidLoad(){var e,t,i;this.tabsEl.style.setProperty("--ir-tabs-top",((i=(t=(e=this.titleEl)===null||e===void 0?void 0:e.getBoundingClientRect())===null||t===void 0?void 0:t.height)===null||i===void 0?void 0:i.toString())+"px")}render(){var e;return i("div",{key:"3526742660fd026be06e9d87cc178aae76a2d318",class:"bulk-operations-sheet-container"},i("div",{key:"b59377a6ad208bb5f844f61118166e7e1e058c2c",class:"sheet-header d-flex align-items-center"},i("ir-title",{key:"e7389c74c676a6a165bb4d4c2810e7bf1ef6575a",ref:e=>this.titleEl=e,onCloseSideBar:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeModal.emit(null)},class:"px-1 mb-0",label:"Bulk Operations",displayContext:"sidebar"})),i("ir-tabs",{key:"23f31233f5a12cd04d4a69011f719197b2343644",ref:e=>this.tabsEl=e,class:"tabs",tabs:this.tabs,onTabChanged:e=>this.selectedTab=e.detail}),((e=this.selectedTab)===null||e===void 0?void 0:e.id)==="stop-sale"?i("igl-bulk-stop-sale",{maxDatesLength:this.maxDatesLength,property_id:this.property_id}):i("igl-bulk-block",{maxDatesLength:this.maxDatesLength,property_id:this.property_id}))}};X.style=G+K;const q=".sc-igl-bulk-stop-sale-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-bulk-stop-sale{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-bulk-stop-sale{transition:all 0.5s ease}.days-checkbox.sc-igl-bulk-stop-sale{gap:0.5rem}";const J=q;const Z=".sc-igl-bulk-stop-sale-h{height:100%}.sheet-container.sc-igl-bulk-stop-sale{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-stop-sale{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-stop-sale{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-stop-sale{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-stop-sale{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-stop-sale{flex-direction:row;align-items:center}}";const Q=Z;const ee=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.toast=t(this,"toast",7);this.maxDatesLength=8;this.selectedRoomTypes=[];this.dates=[{from:null,to:null}];this.selectedWeekdays=new Set(Array(7).fill(null).map(((e,t)=>t)));this.dateRefs=[];this.minDate=w().format("YYYY-MM-DD");this.bookingService=new a;this.datesSchema=C.array(C.object({from:C.any().refine((e=>w.isMoment(e)),{message:"Invalid 'from' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD"))),to:C.any().refine((e=>w.isMoment(e)),{message:"Invalid 'to' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD")))}))}getDayIndex(e){return w(e,"YYYY-MM-DD").day()}componentDidLoad(){this.reloadInterceptor=new j({autoActivate:false});this.sidebar=document.querySelector("ir-sidebar")}disconnectedCallback(){this.reloadInterceptor.deactivate()}async addBlockDates(){const e=e=>{const t=[];for(const i of e){let e=i.from;const s=w(i.to,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD");while(e!==s){const i=w(e,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD");if(!this.selectedWeekdays.has(this.getDayIndex(e))){e=i;continue}for(const i of this.selectedRoomTypes){t.push({room_type_id:i.id,night:e})}e=i}}return t};const t=e=>{const t=new Map(h.disabled_cells);const i=new Map(_.roomsInfo.map(((e,t)=>[e.id,{roomType:e,index:t}])));const s=new Map(h.days.map(((e,t)=>[e.value,t])));const o=new Map;for(const n of e){for(const e of n.restrictions){const{night:a,room_type_id:l}=e;const{roomType:r}=i.get(l);if(!r)continue;const d=s.get(a);if(d===undefined){console.warn(`Couldn't find date ${a}`);continue}const c=h.days[d];const g=`${l}_${a}`;let b=o.get(g);if(!b){b=c.rate.find((e=>e.id===l));if(!b){console.warn(`Couldn't find room type ${l}`);continue}o.set(g,b)}const f=b.exposed_inventory.rts===0;for(const e of r.physicalrooms){const i=`${e.id}_${a}`;t.set(i,{disabled:n.is_closed?true:f,reason:n.is_closed?"stop_sale":f?"inventory":"stop_sale"})}}}h["disabled_cells"]=new Map(t)};try{this.errors=null;this.isLoading=true;const i=this.datesSchema.parse(this.dates);if(this.selectedRoomTypes.length===0){this.unitSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="rooms";return}if(this.selectedWeekdays.size===0){this.weekdaysSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="weekdays";return}this.activate();const s=e(i);const o=this.selectedRoomTypes.every((e=>e.result==="open"));const n=this.selectedRoomTypes.every((e=>e.result==="closed"));if(n||o){const e={is_closed:n,restrictions:s,property_id:this.property_id};await this.bookingService.setExposedRestrictionPerRoomType(e);t([e])}else{const e=[];for(const t of this.selectedRoomTypes){const i=s.filter((e=>e.room_type_id===t.id));e.push({is_closed:t.result==="closed",restrictions:i,property_id:this.property_id})}await Promise.all(e.map((e=>this.bookingService.setExposedRestrictionPerRoomType(e))));t(e)}this.deactivate();this.toast.emit({type:"success",title:Y.entries.Lcz_RequestSubmittedSuccessfully,description:""});this.isLoading=false;this.closeModal.emit()}catch(e){console.log(e);if(e instanceof M){this.datesSections.scrollIntoView({behavior:"smooth",block:"end"});this.errors="dates"}}finally{this.isLoading=false}}activate(){this.reloadInterceptor.activate();if(this.sidebar)this.sidebar.preventClose=true}deactivate(){this.reloadInterceptor.deactivate();if(this.sidebar)this.sidebar.preventClose=false}handleDateChange({index:e,date:t,key:i}){var s,o;const n=[...this.dates];n[e]=Object.assign(Object.assign({},n[e]),{[i]:t});if(i==="from"&&((s=n[e].to)===null||s===void 0?void 0:s.isBefore(t,"dates"))){n[e].to=null}for(let i=e+1;i<n.length;i++){const e=(o=n[i])===null||o===void 0?void 0:o.from;if(e&&e.isSameOrBefore(t,"day")){n[i]={from:null,to:null}}}this.dates=n;setTimeout((()=>{var t,s;if(i==="from"){(t=this.dateRefs[e])===null||t===void 0?void 0:t.to.openDatePicker()}else{const e=n.findIndex((e=>e.from===null));if(e>-1){(s=this.dateRefs[e])===null||s===void 0?void 0:s.from.openDatePicker()}}}),100)}addDateRow(){const e=this.dates[this.dates.length-1];if(!e.from||!e.to){this.errors="dates";return}this.errors=null;this.dates=[...this.dates,{from:null,to:null}];setTimeout((()=>{var e;(e=this.dateRefs[this.dates.length-1].to)===null||e===void 0?void 0:e.scrollIntoView({behavior:"smooth",block:"center"})}),100)}render(){return i("form",{key:"d4bbba8aacb640191b1eed43688da9357a3d7d5f",class:"bulk-sheet-container",onSubmit:e=>{e.preventDefault();this.addBlockDates()}},i("div",{key:"61c4f712621021418cf979bf4109bdaccd1a313d",class:"sheet-body px-1"},i("div",{key:"0132c4a7e929056f7b1b68c88ceaf8df8df61038",class:"text-muted text-left py-0 my-0"},i("p",{key:"9768f2980929585ccdc1b3e0c964f06c2f4ac3ee"},"Select the types to stop or open sales for all related rate plans")),i("div",{key:"75a0aab79ae60fc907e837ba2cf8cd33a9242f60"},this.errors==="rooms"&&i("p",{key:"f178eac6942c2a027ecddde715cad5d32a5e7681",class:"text-danger text-left smaller p-0 ",style:{"margin-bottom":"0.5rem"}},_.is_vacation_rental?Y.entries.Lcz_PlzSelectOneListing:Y.entries.Lcz_PlzSelectOneUnit),i("table",{key:"0a611df7857163883b975bb2de9f7a897ba133d6",ref:e=>this.unitSections=e},i("thead",{key:"6ed448fc4837043a9cb01acd697f4db97b3f3c7f"},i("tr",{key:"9bc7f496564d353b1bddb9ef4aae511493515473"},i("th",{key:"4f6356b63263dd46afac1e01fc7ff3d591be2bc8",class:"sr-only"},"choice"),i("th",{key:"d5b6b6a267de7407c272da020ecf0f0924d8512c",class:"sr-only"},"room type"))),i("tbody",{key:"71bd84d1280939a7a45c47a63d1dc86e67eeb921"},_.roomsInfo.map(((e,t)=>{const s=t===_.roomsInfo.length-1?"":"pb-1";return i("tr",{key:e.id},i("td",{class:`choice-row ${s}`},i("div",{class:"d-flex justify-content-end"},i("ir-select",{firstOption:`${Y.entries.Lcz_Select}...`,data:[{value:"open",text:Y.entries.Lcz_Open},{value:"closed",text:Y.entries.Lcz_StopSale}],onSelectChange:t=>{const i=t.detail;const s=this.selectedRoomTypes.filter((t=>t.id!==e.id));if(i){s.push({id:e.id,result:i})}this.selectedRoomTypes=s}}))),i("td",{class:`pl-1 text-left ${s}`},e.name))}))))),i("p",{key:"950c7cb81af339bd2f018c7258a8abd6c045b023",class:"text-left mt-2 text-muted"},"Included days"),this.errors==="weekdays"&&i("p",{key:"56cb2e2ef86ec1090df55b423d84b458701af87a",class:"text-danger text-left smaller m-0 p-0"},"Please select at least one day"),i("ir-weekday-selector",{key:"91ead627aaf665bce0de34cd8da2178a86f52a8f",ref:e=>this.weekdaysSections=e,weekdays:Array.from(this.selectedWeekdays),onWeekdayChange:e=>{e.stopPropagation();e.stopImmediatePropagation();this.selectedWeekdays=new Set(e.detail)}}),i("table",{key:"df57cf5b2f30444e722d6cc6fff264f38122afba",class:"mt-1",ref:e=>this.datesSections=e},i("thead",{key:"7cfdb23e6600611b44a87b912609dfbf5edb9913"},i("tr",{key:"725f1aafc4052cff517032b79a96376ce4dd7cd6"},i("th",{key:"893d5e2024397ee53683799ab7bbeab0ac70c041",class:"text-left"},Y.entries.Lcz_From),i("th",{key:"679d429bd6493f1beefd5f4a144ed35118a575a7",class:"text-left"},Y.entries.Lcz_ToExclusive),i("td",{key:"815bb3eef757a4073631ceabad36a4df326342c6"},this.dates.length!==this.maxDatesLength&&i("ir-button",{key:"095424582a9b71e33baa53d76077ee568456103e",variant:"icon",icon_name:"plus",onClickHandler:()=>{this.addDateRow()}})))),i("tbody",{key:"1410c6b0995b016bb47e5c09267355789ecc17ff"},this.dates.map(((e,t)=>{var s,o,n,a,l,r,d;if(!this.dateRefs[t]){this.dateRefs[t]={}}const c=t>0?(n=(o=(s=this.dates[t-1])===null||s===void 0?void 0:s.to.clone().add(1,"days"))===null||o===void 0?void 0:o.format("YYYY-MM-DD"))!==null&&n!==void 0?n:this.minDate:this.minDate;const h=this.dates[t].from?(l=(a=this.dates[t])===null||a===void 0?void 0:a.from.clone())===null||l===void 0?void 0:l.format("YYYY-MM-DD"):this.minDate;return i("tr",{key:`date_${t}`},i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{ref:e=>{this.dateRefs[t].from=e},forceDestroyOnUpdate:true,minDate:c,"data-testid":"pickup_arrival_date",date:(r=e.from)===null||r===void 0?void 0:r.format("YYYY-MM-DD"),emitEmptyDate:true,"aria-invalid":String(this.errors==="dates"&&!e.from),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"from"})},onDatePickerFocus:e=>{var i,s,o;e.stopImmediatePropagation();e.stopPropagation();if(t===0){return}const n=this.dates.findIndex((e=>!e.from||!e.to));if(!((i=this.dates[n])===null||i===void 0?void 0:i.from)){(s=this.dateRefs[n])===null||s===void 0?void 0:s.from.openDatePicker();return}if(!((o=this.dates[n])===null||o===void 0?void 0:o.to)){this.dateRefs[n].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.from?e.from.format("MMM DD, YYYY"):null,class:`form-control input-sm ${this.errors==="dates"&&!e.to?"border-danger":""} text-center`,style:{width:"100%"}}))),i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{forceDestroyOnUpdate:true,ref:e=>{this.dateRefs[t].to=e},"data-testid":"pickup_arrival_date",date:(d=e.to)===null||d===void 0?void 0:d.format("YYYY-MM-DD"),emitEmptyDate:true,minDate:h,"aria-invalid":String(this.errors==="dates"&&!e.to),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"to"})},onDatePickerFocus:e=>{var t,i,s,o;e.stopImmediatePropagation();e.stopPropagation();const n=this.dates.findIndex((e=>!e.from||!e.to));if(!((t=this.dates[n])===null||t===void 0?void 0:t.from)){(s=(i=this.dateRefs[n])===null||i===void 0?void 0:i.from)===null||s===void 0?void 0:s.openDatePicker();return}if(!((o=this.dates[n])===null||o===void 0?void 0:o.to)){this.dateRefs[n].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.to?e.to.format("MMM DD, YYYY"):null,class:`form-control input-sm \n                          ${this.errors==="dates"&&!e.to?"border-danger":""}\n                          text-center`,style:{width:"100%"}}))),t>0&&i("td",{class:"pb-1"},i("ir-button",{variant:"icon",icon_name:"minus",onClickHandler:()=>{this.dates=this.dates.filter(((e,i)=>i!==t))}})))}))))),i("div",{key:"721c15f47012d6125fa52d23a7fc312db652e7b2",class:"sheet-footer"},i("ir-button",{key:"68f44bd2e95fe53a73bd41eb43a44ae292d63aac",text:Y.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"4728484d390d80b57b3e2f522de197e52765b45e",isLoading:this.isLoading,text:Y.entries.Lcz_Save,btn_type:"submit",class:"flex-fill"})))}};ee.style=J+Q;const te=".sc-igl-cal-body-h{display:block}.bodyContainer.sc-igl-cal-body{position:relative}.roomRow.sc-igl-cal-body{width:max-content}.roomRow.sc-igl-cal-body:first-child{margin-top:80px}.categoryName.sc-igl-cal-body{font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.cellData[data-dirty-room='true'].sc-igl-cal-body::after{content:'';position:absolute;bottom:0;height:100%;left:30%;right:30%;background-color:#d4d0be !important}.cellData.disabled.sc-igl-cal-body{background:rgba(153, 153, 153, 15%);cursor:var(--cell-cursor, not-allowed);transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body{cursor:pointer;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body:hover{background:#e0e0e0}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body:hover[data-hk-enabled='false']{background:white;cursor:default}.cellData.sc-igl-cal-body{width:58px;height:30px;display:inline-grid;border-top:1px solid #e0e0e0;border-left:1px solid #e0e0e0;vertical-align:top}.triangle-button.sc-igl-cal-body{--size:10px;position:absolute;right:-6px;top:-1px;width:0;height:0;padding:0;border:none;background:transparent;cursor:pointer;width:0;height:0;border-left:var(--size) solid transparent;border-right:var(--size) solid transparent;border-bottom:var(--size) solid var(--in-toggle-color);transform:rotate(45deg)}.cellData.sc-igl-cal-body:nth-child(2){border-left:0px}.cellData.sc-igl-cal-body:last-child{border-right:1px solid rgba(186, 191, 199, 0.5)}.roomHeaderCell.sc-igl-cal-body{position:-webkit-sticky;position:sticky;left:0;background:#fff;border-right:1px solid #ccc;width:170px;z-index:1}.currentDay.sc-igl-cal-body{background-color:#e3f3fa}.dragOverHighlight.sc-igl-cal-body{background-color:#f5f5dc !important}.selectedDay.sc-igl-cal-body{background-color:#f9f9c9 !important}.categoryTitle.sc-igl-cal-body{grid-template-columns:1fr 20px;padding-left:10px;cursor:pointer;height:40px;font-size:0.9em}.categoryTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.sc-igl-cal-body{padding-left:20px;font-size:0.9em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.roomTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.pl10.sc-igl-cal-body{padding-left:10px}.categoryPriceColumn.sc-igl-cal-body{align-items:center;height:40px;-webkit-user-select:none;user-select:none;position:relative}.bookingEventsContainer.sc-igl-cal-body{position:absolute;top:0;left:0}";const ie=te;const se=class{constructor(i){e(this,i);this.addBookingDatasEvent=t(this,"addBookingDatasEvent",7);this.showBookingPopup=t(this,"showBookingPopup",7);this.scrollPageToRoom=t(this,"scrollPageToRoom",7);this.dragOverElement="";this.renderAgain=false;this.isLoading=null;this.selectedRooms={};this.fromRoomId=-1;this.currentDate=new Date;this.housekeepingService=new E;this.bookingMap=new Map;this.interactiveTitle=[];this.dayRateMap=new Map}componentWillLoad(){this.currentDate.setHours(0,0,0,0);this.bookingMap=this.getBookingMap(this.getBookingData());h.days.forEach((e=>{this.dayRateMap.set(e.day,e.rate)}));this.updateDisabledCellsCache()}handleCalendarDataChange(){this.bookingMap=this.getBookingMap(this.getBookingData());this.updateDisabledCellsCache()}dragOverHighlightElementHandler(e){this.dragOverElement=e.detail.dragOverElement}gotoRoom(e){let t=e.detail.roomId;let i=this.getRoomCategoryByRoomId(t);if(!i.expanded){this.toggleCategory(i);setTimeout((()=>{this.scrollToRoom(t)}),10)}else{this.scrollToRoom(t)}}addToBeAssignedEvents(e){this.addBookingDatas(e.detail.data);this.renderElement()}closeWindow(){let e=this.getBookingData().findIndex((e=>e.ID==="NEW_TEMP_EVENT"));if(e!==-1){this.getBookingData().splice(e,1);console.log("removed item..");this.renderElement()}}scrollToRoom(e){this.scrollPageToRoom.emit({key:"scrollPageToRoom",id:e,refClass:"room_"+e})}getRoomCategoryByRoomId(e){return this.calendarData.roomsInfo.find((t=>this.getCategoryRooms(t).find((t=>this.getRoomId(t)===e))))}getCategoryName(e){return e.name}getCategoryId(e){return e.id}getTotalPhysicalRooms(e){return this.getCategoryRooms(e).length}getCategoryRooms(e){return e&&e.physicalrooms||[]}getRoomName(e){return e.name}getRoomId(e){return e.id}getRoomById(e,t){return e.find((e=>this.getRoomId(e)===t))}getBookingData(){return this.calendarData.bookingEvents}addBookingDatas(e){this.addBookingDatasEvent.emit(e)}getSelectedCellRefName(e,t){return"room_"+e+"_"+t.currentDate}getSplitBookingEvents(e){console.log(e.FROM_DATE);return this.getBookingData().some((t=>{if(!["003","002","004"].includes(t.STATUS_CODE)){if(new Date(e.FROM_DATE).getTime()>=new Date(t.FROM_DATE).getTime()&&new Date(e.FROM_DATE).getTime()<=new Date(t.TO_DATE).getTime()){return t}}}))}addNewEvent(e){let t=Object.keys(this.selectedRooms);let s,o;if(this.selectedRooms[t[0]].currentDate<this.selectedRooms[t[1]].currentDate){s=new Date(this.selectedRooms[t[0]].currentDate);o=new Date(this.selectedRooms[t[1]].currentDate)}else{s=new Date(this.selectedRooms[t[1]].currentDate);o=new Date(this.selectedRooms[t[0]].currentDate)}const n=Math.round(Math.abs((o.getTime()-s.getTime())/864e5));this.newEvent={ID:"NEW_TEMP_EVENT",NAME:i("span",null,"Â "),EMAIL:"",PHONE:"",convertBooking:false,REFERENCE_TYPE:"PHONE",FROM_DATE:s.getFullYear()+"-"+this.getTwoDigitNumStr(s.getMonth()+1)+"-"+this.getTwoDigitNumStr(s.getDate()),TO_DATE:o.getFullYear()+"-"+this.getTwoDigitNumStr(o.getMonth()+1)+"-"+this.getTwoDigitNumStr(o.getDate()),BALANCE:"",NOTES:"",RELEASE_AFTER_HOURS:0,PR_ID:this.selectedRooms[t[0]].roomId,ENTRY_DATE:"",NO_OF_DAYS:n,ADULTS_COUNT:1,COUNTRY:"",INTERNAL_NOTE:"",RATE:"",TOTAL_PRICE:"",RATE_PLAN:"",ARRIVAL_TIME:"",TITLE:Y.entries.Lcz_NewBookingFor,roomsInfo:[e],CATEGORY:e.name,event_type:"BAR_BOOKING",STATUS:"TEMP-EVENT",defaultDateRange:{fromDate:null,fromDateStr:"",toDate:null,toDateStr:"",dateDifference:n,editable:false,message:"Including 5.00% City Tax - Excluding 11.00% VAT"}};let a=e.name+" "+this.getRoomName(this.getRoomById(this.getCategoryRooms(e),this.selectedRooms[t[0]].roomId));this.newEvent.BLOCK_DATES_TITLE=`${Y.entries.Lcz_BlockDatesFor} ${a}`;this.newEvent.TITLE+=a;this.newEvent.defaultDateRange.toDate=new Date(this.newEvent.TO_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDate=new Date(this.newEvent.FROM_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDateStr=this.getDateStr(this.newEvent.defaultDateRange.fromDate);this.newEvent.defaultDateRange.toDateStr=this.getDateStr(this.newEvent.defaultDateRange.toDate);this.newEvent.ENTRY_DATE=(new Date).toISOString();this.newEvent.legendData=this.calendarData.formattedLegendData;let l=this.getSplitBookingEvents(this.newEvent);if(l){this.newEvent.splitBookingEvents=l}this.getBookingData().push(this.newEvent);return this.newEvent}getTwoDigitNumStr(e){return e<=9?"0"+e:e}getDateStr(e,t="default"){return e.getDate()+" "+e.toLocaleString(t,{month:"short"})+" "+e.getFullYear()}removeNewEvent(){this.calendarData.bookingEvents=this.calendarData.bookingEvents.filter((e=>e.ID!=="NEW_TEMP_EVENT"));this.newEvent=null}clickCell(e,t,i){if(!this.isScrollViewDragging&&t.currentDate>=this.currentDate.getTime()){let s=this.getSelectedCellRefName(e,t);if(this.selectedRooms.hasOwnProperty(s)){this.removeNewEvent();delete this.selectedRooms[s];this.renderElement();return}else if(Object.keys(this.selectedRooms).length!=1||this.fromRoomId!=e){this.removeNewEvent();this.selectedRooms={};this.selectedRooms[s]=Object.assign(Object.assign({},t),{roomId:e});this.fromRoomId=e;this.renderElement()}else{const o=Object.keys(this.selectedRooms);const n=w(this.selectedRooms[o[0]].value,"YYYY-MM-DD");const a=w(t.value,"YYYY-MM-DD");let l=n.clone().add(1,"days");let r=0;while(l.isBefore(a,"day")){const t=l.format("YYYY-MM-DD");if(this.isCellDisabled(e,t)){r++}l.add(1,"days")}if(r>=1){this.selectedRooms={};this.fromRoomId=e;this.renderElement();return}this.selectedRooms[s]=Object.assign(Object.assign({},t),{roomId:e});this.addNewEvent(i);this.selectedRooms={};this.renderElement();this.showNewBookingPopup(this.newEvent)}}}showNewBookingPopup(e){console.log(e)}renderElement(){this.renderAgain=!this.renderAgain}getBookingMap(e){var t,i;const s=new Map;const o=w().startOf("day");for(const n of e){const e=w(n.FROM_DATE,"YYYY-MM-DD").startOf("day");const a=w(n.TO_DATE,"YYYY-MM-DD").startOf("day");if(o.isSameOrAfter(e)&&o.isSameOrBefore(a)){if(!s.has(n.PR_ID)){s.set(n.PR_ID,n.BOOKING_NUMBER)}else{if(u(w().toDate(),p((t=_.checkin_checkout_hours)===null||t===void 0?void 0:t.offset,(i=_.checkin_checkout_hours)===null||i===void 0?void 0:i.hour))){s.set(n.PR_ID,n.BOOKING_NUMBER)}}}}return s}getGeneralCategoryDayColumns(e,t=false,o){return h.days.map((n=>i("div",{class:`cellData  font-weight-bold categoryPriceColumn ${e+"_"+n.day} ${n.day===this.today||n.day===this.highlightedDate?"currentDay":""}`},t?i(s,null,i("span",{class:"categoryName"},n.rate[o].exposed_inventory.rts)):"")))}getGeneralRoomDayColumns(e,t,s){return this.calendarData.days.map((o=>{var n;const a=this.isCellDisabled(Number(e),o.value);const l=w(o.value,"YYYY-MM-DD").add(-1,"days").format("YYYY-MM-DD");const r=a&&Object.keys(this.selectedRooms).length===0||a&&this.isCellDisabled(Number(e),l);const d=this.selectedRooms.hasOwnProperty(this.getSelectedCellRefName(e,o));const c=o.day===this.today||o.day===this.highlightedDate;const g=h.cleaningTasks.has(+e)?h.cleaningTasks.get(+e):null;const b=["001","003"].includes((n=_.cleaning_frequency)===null||n===void 0?void 0:n.code)?false:g===null||g===void 0?void 0:g.has(o.value);return i("div",{class:`cellData position-relative roomCell ${a?"disabled":""} ${"room_"+e+"_"+o.day} ${c?"currentDay":""} ${this.dragOverElement===e+"_"+o.day?"dragOverHighlight":""} ${d?"selectedDay":""}`,style:!r&&{"--cell-cursor":"default"},onClick:()=>{if(r){return}this.clickCell(Number(e),o,t)},"aria-label":s,role:"gridcell","data-room-id":e,"data-date":o.value,"aria-current":c?"date":undefined,"data-room-name":s,"data-dirty-room":String(b),"aria-disabled":String(r),"aria-selected":Boolean(d)})}))}toggleCategory(e){e.expanded=!e.expanded;this.renderElement()}getRoomCategoryRow(e,t){if(this.getTotalPhysicalRooms(e)<=1||!e.is_active){return null}return i("div",{class:"roomRow"},i("div",{class:`cellData text-left align-items-center roomHeaderCell categoryTitle ${"category_"+this.getCategoryId(e)}`,onClick:()=>this.toggleCategory(e)},i("div",{class:"categoryName"},i("ir-interactive-title",{popoverTitle:this.getCategoryName(e)})),e.expanded?i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"})):i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"}))),this.getGeneralCategoryDayColumns("category_"+this.getCategoryId(e),true,t))}getRoomsByCategory(e){var t;if(!e.expanded){return null}return(t=this.getCategoryRooms(e))===null||t===void 0?void 0:t.map((t=>{if(!t.is_active){return null}const s=this.getTotalPhysicalRooms(e)<=1;const o=s?this.getCategoryName(e):this.getRoomName(t);return i("div",{class:"roomRow"},i("div",{class:`cellData room text-left align-items-center roomHeaderCell  roomTitle ${this.getTotalPhysicalRooms(e)<=1?"pl10":""} ${"room_"+this.getRoomId(t)}`,"data-room-name":o,"data-hk-enabled":String(_.housekeeping_enabled),"data-room":this.getRoomId(t),onClick:()=>{if(!_.housekeeping_enabled){return}this.selectedRoom=t;this.hkModal.openModal()},onMouseEnter:()=>{var e,i;(i=(e=this.interactiveTitle[t.id])===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.setProperty("--ir-interactive-hk-bg","#e0e0e0")},onMouseLeave:()=>{var e,i;(i=(e=this.interactiveTitle[t.id])===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.removeProperty("--ir-interactive-hk-bg")}},i("ir-interactive-title",{ref:e=>{if(e)this.interactiveTitle[t.id]=e},style:t.hk_status==="003"&&{"--dot-color":"#ededed"},hkStatus:_.housekeeping_enabled&&t.hk_status!=="001",popoverTitle:o},t.hk_status!=="001"&&i("div",{slot:"end",class:"d-flex align-items-center",style:{gap:"0.5rem"}},t.hk_status==="004"?i("svg",{height:14,width:14,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"},i("title",null,"Inspected"),i("path",{fill:"green",d:"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"})):i("svg",{xmlns:"http://www.w3.org/2000/svg",height:"12",width:"13.5",viewBox:"0 0 576 512",style:{display:"block"}},t.hk_status==="002"&&i("title",null,"This unit is dirty"),i("path",{fill:"currentColor",d:"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z"}))))),this.getGeneralRoomDayColumns(this.getRoomId(t),e,o))}))}getRoomRows(){var e;return(e=this.calendarData.roomsInfo)===null||e===void 0?void 0:e.map(((e,t)=>{if(e.is_active){return i(s,null,this.getRoomCategoryRow(e,t),e.expanded&&this.getRoomsByCategory(e))}else{return null}}))}async confirmHousekeepingUpdate(e,t){var i,s,o,n,a,l;e.stopImmediatePropagation();e.stopPropagation();try{this.isLoading=t==="004"?"right":"middle";await this.housekeepingService.setExposedUnitHKStatus({property_id:this.propertyId,status:{code:t},unit:{id:(i=this.selectedRoom)===null||i===void 0?void 0:i.id}});if(["001","004"].includes(t)){await this.housekeepingService.executeHKAction({actions:[{description:"Cleaned",hkm_id:((o=(s=this.selectedRoom)===null||s===void 0?void 0:s.housekeeper)===null||o===void 0?void 0:o.id)||null,unit_id:(n=this.selectedRoom)===null||n===void 0?void 0:n.id,booking_nbr:(l=this.bookingMap.get((a=this.selectedRoom)===null||a===void 0?void 0:a.id))!==null&&l!==void 0?l:null,status:t}]})}}finally{this.isLoading=null;this.selectedRoom=null;this.hkModal.closeModal()}}render(){var e,t;return i(o,{key:"15cd90798eb406a44a5966b10acfc58eb33a5800"},i("div",{key:"5d0119280b4c06f69d364a106c8fba8537a1d7e2",class:"bodyContainer"},this.getRoomRows(),i("div",{key:"fb4230ddfa1429de8046e1dbe36e3e4e0c02d359",class:"bookingEventsContainer preventPageScroll"},(e=this.getBookingData())===null||e===void 0?void 0:e.map((e=>{var t,s,o;return i("igl-booking-event",{"data-testid":`booking_${e.BOOKING_NUMBER}`,"data-room-name":(o=(s=(t=e.roomsInfo)===null||t===void 0?void 0:t.find((t=>t.id===e.RATE_TYPE)))===null||s===void 0?void 0:s.physicalrooms.find((t=>t.id===e.PR_ID)))===null||o===void 0?void 0:o.name,language:this.language,is_vacation_rental:this.calendarData.is_vacation_rental,countries:this.countries,currency:this.currency,"data-component-id":e.ID,bookingEvent:e,allBookingEvents:this.getBookingData()})})))),i("ir-modal",{key:"1efa57a1256c4d6702c72c76842687c4536908bf",ref:e=>this.hkModal=e,leftBtnText:(t=Y===null||Y===void 0?void 0:Y.entries)===null||t===void 0?void 0:t.Lcz_Cancel,middleBtnText:this.renderModalMiddleButtonText(),middleBtnActive:true,rightBtnText:this.renderModalRightButtonText(),modalBody:this.renderModalBody(),onConfirmModal:e=>this.confirmHousekeepingUpdate(e,"004"),onMiddleModal:e=>{var t;return this.confirmHousekeepingUpdate(e,((t=this.selectedRoom)===null||t===void 0?void 0:t.hk_status)==="002"?"001":"002")},autoClose:false,isMiddleButtonLoading:this.isLoading==="middle",isLoading:this.isLoading==="right",onCancelModal:e=>{e.stopImmediatePropagation();e.stopPropagation();this.selectedRoom=null;this.hkModal.closeModal()}}))}renderModalBody(){var e;if(!this.selectedRoom){return null}return i("p",null,"Update unit ",(e=this.selectedRoom)===null||e===void 0?void 0:e.name," to ...")}renderModalMiddleButtonText(){if(!this.selectedRoom){return null}return this.selectedRoom.hk_status==="002"?"Clean":"Dirty"}renderModalRightButtonText(){if(!this.selectedRoom){return null}return this.selectedRoom.hk_status!=="004"?"Clean & Inspected":"Clean"}updateDisabledCellsCache(){var e;h.disabled_cells.clear();(e=this.calendarData.roomsInfo)===null||e===void 0?void 0:e.forEach(((e,t)=>{var i;if(e.is_active){(i=this.getCategoryRooms(e))===null||i===void 0?void 0:i.forEach((e=>{if(e.is_active){this.calendarData.days.forEach((i=>{const s=this.getCellKey(e.id,i.value);h.disabled_cells.set(s,{disabled:!i.rate[t].is_available_to_book,reason:"stop_sale"})}))}}))}}))}getCellKey(e,t){return`${e}_${t}`}isCellDisabled(e,t){const i=this.getCellKey(e,t);if(!h.disabled_cells.has(i)){return false}const{disabled:s}=h.disabled_cells.get(i);return s}static get watchers(){return{calendarData:["handleCalendarDataChange"]}}};se.style=ie;const oe=".sc-igl-cal-footer-h{display:block;position:sticky;bottom:0;width:max-content;z-index:3}.footerCell.sc-igl-cal-footer{display:-moz-inline-grid;display:-ms-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;bottom:0;width:58px;height:40px;background:#fff;vertical-align:top;border-top:1px solid #e0e0e0}.bottomLeftCell.sc-igl-cal-footer{left:-1px;z-index:2;width:170px;text-align:left;padding-left:15px;color:#000000}.footerCell.sc-igl-cal-footer i.sc-igl-cal-footer{margin-right:5px}.legendBtn.sc-igl-cal-footer{color:#41bff3;cursor:pointer}.legendBtn.sc-igl-cal-footer:hover{color:#1e29ca}.isOnline.sc-igl-cal-footer i.sc-igl-cal-footer{color:#2f9c3f;font-weight:bold}.isOffline.sc-igl-cal-footer i.sc-igl-cal-footer{font-weight:bold}.isOffline.sc-igl-cal-footer{color:#a40000}.dayTitle.sc-igl-cal-footer{font-size:0.8em;font-weight:600;display:grid;user-select:none}.currentDay.sc-igl-cal-footer .dayTitle.sc-igl-cal-footer{font-weight:bold}.currentDay.sc-igl-cal-footer{background-color:#e3f3fa}.dayCapacityPercent.sc-igl-cal-footer{font-size:0.75em}.badge-pill.sc-igl-cal-footer{padding-left:1em;padding-right:1em;font-size:0.7em;margin-bottom:2px}";const ne=oe;const ae=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7)}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}render(){return i(o,{key:"287017b1f9c5646ce1332d88512058348725f20f",class:"footerContainer"},i("div",{key:"10542a159d54738f508fdb8fa777baee7d76480c",class:"footerCell bottomLeftCell align-items-center preventPageScroll",style:{paddingLeft:"10px"}},i("button",{key:"bb9fec55a8a12c923d416b1fe907e19ccdb70a83",class:"m-0 p-0 btn btn-sm  legendBtn d-flex align-items-center",style:{gap:"0.25rem"},onClick:()=>this.handleOptionEvent("showLegend")},i("svg",{key:"86f85793975db56e4801eb3544b0f0ebbbce31c7",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640",height:16,width:16},i("path",{key:"59d696b7bd29780f2ab505ce7586bf9dc90be9b9",fill:"currentColor",d:"M535.1 342.6C547.6 330.1 547.6 309.8 535.1 297.3L375.1 137.3C362.6 124.8 342.3 124.8 329.8 137.3C317.3 149.8 317.3 170.1 329.8 182.6L467.2 320L329.9 457.4C317.4 469.9 317.4 490.2 329.9 502.7C342.4 515.2 362.7 515.2 375.2 502.7L535.2 342.7zM183.1 502.6L343.1 342.6C355.6 330.1 355.6 309.8 343.1 297.3L183.1 137.3C170.6 124.8 150.3 124.8 137.8 137.3C125.3 149.8 125.3 170.1 137.8 182.6L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7z"})),i("span",{key:"c4e7855f1a802ef7946195a7a375ab0814dae115"},Y.entries.Lcz_Legend),i("span",{key:"711ec1c3cedc5c1c1661029ee5612b20e53f4cc0"},"v1.02"),i("ir-new-badge",{key:"6b6caa9aa4110de0f234f3f058af2ed6393ed9a0",style:{marginLeft:"0.25rem"}}))),this.calendarData.days.map((e=>i("div",{class:"footerCell align-items-center"},i("div",{class:`dayTitle full-height align-items-center ${e.day===this.today||this.highlightedDate===e.day?"currentDay":""}`},e.dayDisplayName)))))}};ae.style=ne;const le=".sc-igl-cal-header-h{display:block;position:absolute;top:0;height:100%}.svg-icon.sc-igl-cal-header{height:20px;width:20px}.darkGrey.sc-igl-cal-header{background:#ececec}.btn.sc-igl-cal-header{pointer-events:auto}.stickyCell.sc-igl-cal-header{display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;top:0px;height:82px;display:inline-block;vertical-align:top;z-index:2}.headersContainer.sc-igl-cal-header{background-color:#ffffff}.headerCell.sc-igl-cal-header{display:inline-grid;width:58px;height:58px;vertical-align:top;background-color:#ffffff;border-bottom:1px solid #e0e0e0}.monthsContainer.sc-igl-cal-header{height:20px;background-color:#ffffff;margin-bottom:0.2em}.monthCell.sc-igl-cal-header{display:inline-grid;height:20px;background-color:#ececec;border-right:1px solid #c7c7c7;vertical-align:top}.monthCell.sc-igl-cal-header:nth-child(odd){background-color:#dddddd}.monthTitle.sc-igl-cal-header{overflow:hidden;text-overflow:ellipsis;font-size:0.9em;text-transform:uppercase;font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.topLeftCell.sc-igl-cal-header{left:0px;z-index:3;width:170px;background-color:#ffffff;display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid}.datePickerHidden.sc-igl-cal-header{position:absolute;height:100%;width:100%;opacity:0;cursor:pointer;z-index:1}.date_btn.sc-igl-cal-header{cursor:pointer;display:flex;align-items:center;justify-content:center;position:relative}.date_btn.sc-igl-cal-header:hover{background:#f6f6f6;border-radius:0.3rem}.caledarBtns.sc-igl-cal-header{position:relative;cursor:pointer;padding:0.4rem}.caledarBtns.sc-igl-cal-header:hover{background-color:#f6f6f6}.dayTitle.sc-igl-cal-header{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.currentDay.sc-igl-cal-header .dayTitle.sc-igl-cal-header{font-weight:bold}.currentDay.sc-igl-cal-header{background-color:#e3f3fa}.dayCapacityPercent.sc-igl-cal-header{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.badge-pill.sc-igl-cal-header{padding:3px 1em;font-size:0.8em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.pointer.sc-igl-cal-header{cursor:pointer}.searchContiner.sc-igl-cal-header{padding-left:10px;padding-right:10px}.searchListContainer.sc-igl-cal-header{background:#fff;border:1px solid #ccc;border-bottom:none}.searchListItem.sc-igl-cal-header{background:white;border-bottom:1px solid #ccc;padding-left:8px}.badge-light.sc-igl-cal-header{background-color:#999999;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.min-width-full.sc-igl-cal-header{min-width:100%}";const re=le;const de=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.gotoRoomEvent=t(this,"gotoRoomEvent",7);this.gotoToBeAssignedDate=t(this,"gotoToBeAssignedDate",7);this.renderAgain=false;this.unassignedRoomsNumber={};this.roomsList=[];this.toBeAssignedService=new O}componentWillLoad(){try{this.initializeRoomsList();if(!this.calendarData.is_vacation_rental){T("unassigned_dates",(e=>{if(Object.keys(e).length>0){this.fetchAndAssignUnassignedRooms()}}))}}catch(e){console.error("Error in componentWillLoad:",e)}}handleCalendarDataChanged(){this.fetchAndAssignUnassignedRooms()}initializeRoomsList(){this.roomsList=[];this.calendarData.roomsInfo.forEach((e=>{this.roomsList=this.roomsList.concat(...e.physicalrooms)}))}async fetchAndAssignUnassignedRooms(){await this.assignRoomsToDate()}async assignRoomsToDate(){try{const{fromDate:e,toDate:t,data:i}=this.unassignedDates;let s=new Date(e);s.setHours(0,0,0,0);let o=s.getTime();while(o<=new Date(t).getTime()){const e=w(o).format("D_M_YYYY");if(i[o]){const t=await this.toBeAssignedService.getUnassignedRooms({from_date:this.calendarData.from_date,to_date:this.calendarData.to_date},this.propertyid,v(new Date(o)),this.calendarData.roomsInfo,this.calendarData.formattedLegendData);this.unassignedRoomsNumber[e]=t.length}else if(this.unassignedRoomsNumber[e]){const t=this.unassignedRoomsNumber[e]-1;this.unassignedRoomsNumber[e]=t<0?0:t}const t=w(o).add(1,"days").toDate();t.setHours(0,0,0,0);o=t.getTime();this.renderView()}}catch(e){console.error(e)}}handleReduceAvailableUnitEvent(e){e.stopImmediatePropagation();e.stopPropagation();const{fromDate:t,toDate:i}=e.detail;let s=new Date(t).getTime();while(s<new Date(i).getTime()){const e=w(s).format("D_M_YYYY");this.unassignedRoomsNumber[e]=this.unassignedRoomsNumber[e]-1;s=w(s).add(1,"days").toDate().getTime()}this.renderView()}showToBeAssigned(e){if(this.unassignedRoomsNumber[e.day]||0){this.handleOptionEvent("showAssigned");setTimeout((()=>{this.gotoToBeAssignedDate.emit({key:"gotoToBeAssignedDate",data:e.currentDate})}),100)}}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}handleDateSelect(e){if(Object.keys(e.detail).length>0){this.handleOptionEvent("calendar",e.detail)}}handleClearSearch(){this.renderView()}handleFilterRooms(e){const t=e.target;let i=t.value.trim();i=i.toLowerCase();if(i===""){this.handleClearSearch()}this.renderView()}handleScrollToRoom(e){this.handleClearSearch();this.gotoRoomEvent.emit({key:"gotoRoom",roomId:e})}getStringDateFormat(e){return e.getFullYear()+"-"+(e.getMonth()<9?"0":"")+(e.getMonth()+1)+"-"+(e.getDate()<=9?"0":"")+e.getDate()}getNewBookingModel(){let e=new Date;e.setHours(0,0,0,0);let t=this.getStringDateFormat(e);e.setDate(e.getDate()+1);e.setHours(0,0,0,0);let i=this.getStringDateFormat(e);return{ID:"",NAME:"",EMAIL:"",PHONE:"",REFERENCE_TYPE:"PHONE",FROM_DATE:t,TO_DATE:i,roomsInfo:this.calendarData.roomsInfo,TITLE:Y.entries.Lcz_NewBooking,event_type:"PLUS_BOOKING",legendData:this.calendarData.formattedLegendData,defaultDateRange:{fromDate:new Date(t),fromDateStr:"",toDate:new Date(i),toDateStr:"",dateDifference:0,editabled:true,message:""}}}renderView(){this.renderAgain=!this.renderAgain}render(){return i(o,{key:"ce9127343ea0438b6afcfb16c0b0759ebb4fa8a1"},i("div",{key:"1e1bc6fb8b4f6028791fb6b6482f14fd4b78c9fd",class:"stickyCell align-items-center topLeftCell preventPageScroll"},i("div",{key:"347ac0ee863b63563888862b1fe5c92287df48d5",class:"row justify-content-around no-gutters"},!this.calendarData.is_vacation_rental&&i("ir-button",{key:"98a62425db000d20551c29d191bbde9dc37d1e1f",variant:"icon",icon_name:"server",style:Object.assign(Object.assign({},R.secondary),{"--icon-size":"1.5rem"}),"data-toggle":"tooltip","data-placement":"bottom",title:Y.entries.Lcz_UnassignedUnitsTooltip,onClickHandler:()=>this.handleOptionEvent("showAssigned"),btn_styles:"caledarBtns",visibleBackgroundOnHover:true}),i("ir-date-picker",{key:"386f0e7a6123062c6c83e90980efe68175e880bd",minDate:w().add(-2,"months").startOf("month").format("YYYY-MM-DD"),onDateChanged:e=>{console.log("evt",e);this.handleDateSelect(e)},class:"date_btn",title:Y.entries.Lcz_Navigate,"data-toggle":"tooltip","data-placement":"bottom"},i("ir-button",{key:"605f53d1e57c166ba34698fe6cb6e9bda68a76a0",slot:"trigger",btn_styles:"caledarBtns",variant:"icon",icon_name:"calendar",style:Object.assign(Object.assign({},R.secondary),{"--icon-size":"1.5rem"}),onClickHandler:()=>this.handleOptionEvent("calendar"),visibleBackgroundOnHover:true,ref:e=>this.dateRef=e})),i("ir-button",{key:"6004f82b8c2f605a2252b513e421315ccb748e86",variant:"icon",btn_styles:"caledarBtns",class:"pointer",icon_name:"clock",visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},R.secondary),{"--icon-size":"1.5rem"}),"data-toggle":"tooltip","data-placement":"bottom",title:Y.entries.Lcz_Today,onClickHandler:()=>this.handleOptionEvent("gotoToday")}),i("ir-button",{key:"ee810d38aa47cd268b6904c27560b2029a263913",variant:"icon",btn_styles:"caledarBtns",icon_name:"plus","data-toggle":"tooltip","data-placement":"bottom","data-testid":"new_booking_btn",title:Y.entries.Lcz_CreateNewBooking,visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},R.secondary),{"--icon-size":"1.5rem"}),onClickHandler:()=>this.handleOptionEvent("add",this.getNewBookingModel())}),i("ir-button",{key:"c12867f9a93b58a452a1acca2b377cbd36720e28",variant:"icon",btn_styles:"caledarBtns",icon_name:"calendar-xmark","data-toggle":"tooltip","data-placement":"bottom","data-testid":"new_bulk_btn",title:Y.entries.Lcz_StopOpenSale,visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},R.secondary),{"--icon-size":"1.5rem"}),onClickHandler:()=>this.handleOptionEvent("bulk",this.getNewBookingModel())})),i("div",{key:"a1752a5244e782d221c868bed63c5ef72cf0db64",class:"row justify-content-around no-gutters searchContiner"},i("ir-m-combobox",{key:"67a35b4a388d3a605249f6ff25e0354765b739e5",placeholder:Y.entries.Lcz_FindUnit,options:this.roomsList.map((e=>({label:e.name,value:e.id}))),onOptionChange:e=>{this.handleScrollToRoom(e.detail.value)}}))),i("div",{key:"8de1fb6e1e858a4b8ef31a22d7b14e9b2f8febaf",class:"stickyCell headersContainer"},i("div",{key:"ddd8b1872ae6b069330ce591742b5f39e646b4e4",class:"monthsContainer"},this.calendarData.monthsInfo.map((e=>i("div",{class:"monthCell",style:{width:e.daysCount*58+"px"}},i("div",{class:"monthTitle"},e.monthName))))),this.calendarData.days.map((e=>i("div",{class:`headerCell align-items-center ${"day-"+e.day} ${e.day===this.today||e.day===this.highlightedDate?"currentDay":""}`,"data-day":e.day},!this.calendarData.is_vacation_rental&&i("div",{class:"preventPageScroll"},i("span",{class:`badge badge-${this.unassignedRoomsNumber[e.day]||e.unassigned_units_nbr!==0?"info pointer":"light"} badge-pill`,onClick:()=>this.showToBeAssigned(e)},this.unassignedRoomsNumber[e.day]||e.unassigned_units_nbr)),i("div",{class:"dayTitle"},e.dayDisplayName),i("div",{class:"dayCapacityPercent"},e.occupancy,"%"))))))}static get watchers(){return{unassignedDates:["handleCalendarDataChanged"]}}};de.style=re;const ce=".sc-igl-legends-h{display:block}.legendHeader.sc-igl-legends{font-weight:500;letter-spacing:0.05rem;font-size:1.12rem;padding-top:5px;margin-bottom:1rem}.legendCloseBtn.sc-igl-legends{position:absolute;top:50%;right:0;cursor:pointer;font-size:1.75em;line-height:1em;padding:0.4rem;display:flex;align-items:center;justify-content:center;border-radius:3px;transform:translateY(-50%)}.legendCloseBtn.sc-igl-legends:hover{background-color:#f6f6f6}.stickyHeader.sc-igl-legends{position:-webkit-sticky;position:sticky;top:0;background-color:#ffffff;z-index:1}.legendRow.sc-igl-legends{position:relative;vertical-align:middle;margin-bottom:0.3rem}.legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle}.legend_skew.sc-igl-legends,.legend_skew-bordered.sc-igl-legends,.legend_skewsplit.sc-igl-legends{transform:skew(-22deg);width:15px;height:16px;border-radius:4px;background-color:var(--ir-skew-background)}.legend_skew.striped.vertical.sc-igl-legends{--stripe-period:17px;--stripe-angle:360deg}.legend_skew.striped.sc-igl-legends{--stripe-period:6px;background:repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-skew-background) 0,\n    var(--ir-skew-background) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  )}.legend_skew.split.sc-igl-legends{border-right:4px solid black}.legend_skew-bordered.sc-igl-legends{border:1px solid black}.legend_dirty-unit.sc-igl-legends{background-color:white !important;border:1px solid #e0e0e0;height:12px;width:20px;margin-right:1rem;position:relative}.legend_dirty-unit.sc-igl-legends::after{content:'';position:absolute;bottom:0;height:100%;left:30%;right:30%;background-color:#d4d0be !important}.legend_circle.sc-igl-legends{border-radius:100%;width:10px;height:10px;margin:3px 3px 3px 2px}.legend_skewsplit.sc-igl-legends{border-right:2px solid #000000}.headerCell.sc-igl-legends .blueColor.sc-igl-legends{background-color:#31bef1}.greenColor.sc-igl-legends{background-color:#45b16d}.yellowColor.sc-igl-legends{background-color:#f4d552}.greyColor.sc-igl-legends{background-color:#a0a0a0}.redColor.sc-igl-legends{background-color:#f34752}.pinkColor.sc-igl-legends{background-color:#f9b4b7}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends{margin-bottom:0}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends:first-child .legendCal.sc-igl-legends{background-color:#ececec}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.total-availability.sc-igl-legends{font-size:1em !important}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends{width:80px;height:25px;text-align:center;display:inline-grid !important;align-content:center;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends .badge.sc-igl-legends{margin-top:0.2rem;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.legendCal-h2.sc-igl-legends{height:40px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.br-t.sc-igl-legends{border-top:1px solid #a0a0a0}.br-s.sc-igl-legends{border-left:1px solid #a0a0a0;border-right:1px solid #a0a0a0}.br-bt.sc-igl-legends{border-bottom:1px solid #a0a0a0}.highphenLegend.sc-igl-legends{font-size:0.9em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.highphenLegend.sc-igl-legends::before{width:12px;height:0.5px;content:' ';background-color:#000000;vertical-align:middle;display:inline-block;margin-left:5px;margin-right:5px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.badge-pill.sc-igl-legends{padding:3px 1em;font-size:0.8em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendRow-editor.sc-igl-legends{vertical-align:top}.legendColorCell.sc-igl-legends{display:flex;align-items:center;gap:0.5rem;padding-right:0.5rem}.legendColorPicker.sc-igl-legends{appearance:none;border:none;background:none;cursor:pointer;width:30px;height:30px;padding:0}.legendColorPicker.sc-igl-legends::-webkit-color-swatch{border:1px solid #e0e0e0;border-radius:4px}.legendColorPicker.sc-igl-legends::-moz-color-swatch{border:1px solid #e0e0e0;border-radius:4px}.legendDetailsCell.sc-igl-legends{min-width:220px}.legendInput.sc-igl-legends,.legendTextarea.sc-igl-legends{width:100%;border:1px solid #d8d8d8;border-radius:4px;padding:0.4rem 0.6rem;font-size:0.85rem;display:block}.legendInput.sc-igl-legends{margin-bottom:0.4rem}.legendTextarea.sc-igl-legends{resize:vertical}.legendActionsCell.sc-igl-legends{width:32px;text-align:right}.legendRemoveBtn.sc-igl-legends{border:none;background:none;cursor:pointer;font-size:1.2rem;line-height:1;color:#a0a0a0;padding:0}.legendRemoveBtn.sc-igl-legends:hover,.legendRemoveBtn.sc-igl-legends:focus{color:#5c5c5c}.legendEditorFooter.sc-igl-legends{margin-top:0.75rem;display:flex;align-items:center;gap:1rem}.legendAddBtn.sc-igl-legends{border:1px solid #d8d8d8;border-radius:4px;background-color:#ffffff;padding:0.35rem 0.75rem;font-size:0.85rem;cursor:pointer}.legendAddBtn.sc-igl-legends:hover,.legendAddBtn.sc-igl-legends:focus{border-color:#b3b3b3}.legendStatus.sc-igl-legends{font-size:0.75rem}.legendStatus.saving.sc-igl-legends{color:#6b6f82}.legendStatus.success.sc-igl-legends{color:#2e7d32}.legendStatus.error.sc-igl-legends{color:#d32f2f}.headerCell.sc-igl-legends{width:70px;display:flex;align-items:center;justify-content:center}.dayTitle.sc-igl-legends{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.dayCapacityPercent.sc-igl-legends{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legend_rectangle.sc-igl-legends{height:12px;width:20px;margin-right:1rem}";const he=ce;const ge=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.propertyService=new D;this.bookingColors=[];this.saveState="idle";this.loadingIndex=[]}disconnectedCallback(){if(this.saveTimeout){clearTimeout(this.saveTimeout)}}handleSaveStateChange(e){if(e==="error"||e==="idle"){this.loadingIndex=[]}}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}syncCalendarExtra(e){var t;const i=(t=_.property.calendar_extra)!==null&&t!==void 0?t:{};_.property.calendar_extra=Object.assign(Object.assign({},i),{booking_colors:e.map((e=>Object.assign({},e)))})}get propertyId(){var e,t,i;return(i=(t=(e=_.property)===null||e===void 0?void 0:e.id)!==null&&t!==void 0?t:_.property.id)!==null&&i!==void 0?i:null}updateBookingColor(e,t){var i;const s=(i=_.property.calendar_extra)===null||i===void 0?void 0:i.booking_colors.map(((i,s)=>s===e?Object.assign(Object.assign({},i),t):i));this.syncCalendarExtra(s);if(this.saveState==="saved"){this.saveState="idle"}}async persistBookingColors(){const e=this.propertyId;if(!e){return}if(this.saveState==="saving"){return}this.saveState="saving";this.saveError=undefined;try{await this.propertyService.setPropertyCalendarExtra({property_id:e,value:JSON.stringify(_.property.calendar_extra)});this.saveState="saved";if(this.saveTimeout){clearTimeout(this.saveTimeout)}this.saveTimeout=window.setTimeout((()=>{this.saveState="idle";this.saveTimeout=undefined}),2e3)}catch(e){this.saveState="error";this.saveError=e instanceof Error?e.message:String(e)}}handleNameInput(e,t){this.updateBookingColor(e,{name:t})}handleBlur(e){this.persistBookingColors();if(!this.loadingIndex.includes(e)){this.loadingIndex=[...this.loadingIndex,e]}}handleLoaderComplete(e){this.loadingIndex=this.loadingIndex.filter((t=>t!==e))}render(){var e;return i(o,{key:"7993e5d784c6664e89051f3181acd63b5493df21",class:"legendContainer pr-1 text-left pb-4"},i("div",{key:"dc9348002b82a690f0a968eac5b1f15ae652a825",class:"w-full"},i("div",{key:"7cb6efdaaab206c60dd3c1a01b3f2243b2e0743b",class:"w-full"},i("div",{key:"bdee4778906c952dbd88c140ca37f6e7dfacc7d1",class:"stickyHeader pt-1 "},i("p",{key:"62f80f4bb330c4ab715b531209b05c5bd96e887b",class:"legendHeader"},Y.entries.Lcz_Legend),i("div",{key:"c68b410aa1870d91638e2e24f436453273349f48",class:"legendCloseBtn",onClick:()=>this.handleOptionEvent("closeSideMenu")},i("svg",{key:"10a2e7ae45f96e165ea6053fdf6d515a11f1813a",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},i("path",{key:"cb79d15821c2bc329553fe47dc1754986e9e6d6e",fill:"#6b6f82",d:"M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160zm352-160l-160 160c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L301.3 256 438.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0z"}))),i("hr",{key:"6ca44508c19b4bb2b26313c049046121ac8aea41"})),i("div",{key:"43898db92b59861fa1d357a23610ec4c71988425",class:"mt-2 pl-1"},i("table",{key:"0838e04ea6b02945b3724d5ee6e9bd44892f3acb"},(()=>{const e=this.legendData.find((e=>e.id==="14"));return i("tr",null,i("td",null,i("div",{class:`legend_${e.design}`,style:{"--ir-skew-background":e.color}})),i("td",null,i("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("span",{class:"font-small-3"},e.name),i("ir-new-badge",null))))})(),this.legendData.map((e=>{if(["1","2","3","14"].includes(e.id)){return null}const t=_.colorsForegrounds[e===null||e===void 0?void 0:e.color];return i("tr",{key:`legend_${e.id}`,class:"legendRow "},i("td",null,e.design==="broom"?i("svg",{xmlns:"http://www.w3.org/2000/svg",height:"12",width:"13.5",viewBox:"0 0 576 512",style:{display:"block"}},i("path",{fill:"black",d:"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z"})):e.design==="check"?i("svg",{height:14,width:14,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"},i("path",{fill:"green",d:"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"})):i("div",{class:`legend_${e.design} ${["1","7"].includes(e.id.toString())?`striped ${e.id.toString()==="1"?"vertical":""}`:""}`,style:{"--ir-skew-background":e.color,"--ir-event-bg-stripe-color":t===null||t===void 0?void 0:t.stripe,backgroundColor:e.color}})),i("td",null,i("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("span",{class:"font-small-3"},e.name))))})),i("tr",{key:"8f2ba39b9f23ab730af89b73011200793c39fd77"},i("td",{key:"068fed0ecb17ac6af8e34e64a00887e8e5496fa6",colSpan:2},i("hr",{key:"bd096b403817d5059fc26f074996281e9af3d02b",style:{marginTop:"0.5rem",marginBottom:"0.5rem"}}))),i("tr",{key:"7905f0955b8aef8f70e3616b57ab4f27bfb4bd71"},i("th",{key:"764693a7a034025ae0a3898fb6390180cec16b1e",colSpan:2,class:"",style:{paddingBottom:"0.5rem"}},i("div",{key:"be846fdde2a31f10f8f1c7081ffd79cb5d3135f0",class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("span",{key:"112714c9937ff62b8f8b648af49bae2e05599211"},"Default colors")))),this.legendData.map((e=>{if(!["1","2","3"].includes(e.id)){return null}const t=_.colorsForegrounds[e===null||e===void 0?void 0:e.color];return i("tr",{key:`legend_${e.id}`,class:"legendRow "},i("td",null,e.design==="broom"?i("svg",{xmlns:"http://www.w3.org/2000/svg",height:"12",width:"13.5",viewBox:"0 0 576 512",style:{display:"block"}},i("path",{fill:"black",d:"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z"})):e.design==="check"?i("svg",{height:14,width:14,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"},i("path",{fill:"green",d:"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"})):i("div",{class:`legend_${e.design} ${["1","7"].includes(e.id.toString())?`striped ${e.id.toString()==="1"?"vertical":""}`:""}`,style:{"--ir-skew-background":e.color,"--ir-event-bg-stripe-color":t===null||t===void 0?void 0:t.stripe,backgroundColor:e.color}})),i("td",null,i("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("span",{class:"font-small-3"},e.name),e.id==="14"&&i("ir-new-badge",null))))})),i("tr",{key:"ac875c89b8d3ca23df67a6b6edd72ce18bba6ce8"},i("td",{key:"c4acef1c7990913425cfe38e756a2a23388633bc",colSpan:2},i("hr",{key:"5b97a34c2e5e9bb51d2fde292a33fc5fb09032c5",style:{marginTop:"0.5rem",marginBottom:"0.5rem"}}))),i("tr",{key:"9d9f5a840fa44bbc1aec28cff346ca7454af7fd0"},i("th",{key:"ed037c0970708d11c0e4501e8b501ac5c8618288",colSpan:2,style:{paddingBottom:"0.5rem"}},i("div",{key:"2b6323ef8bc5660255d51d8af69558157090acaa",class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("span",{key:"3496f90058d9dfd51d201e9e1db576b482a568a6"},"Use your own colors"),i("ir-new-badge",{key:"af54cee714c2f6ca30096585046f4d8b055712c5"})))),(e=_.property.calendar_extra)===null||e===void 0?void 0:e.booking_colors.map(((e,t)=>{const s=`legend_${e.design}`;return i("tr",{key:`legend_${t}`,class:"legendRow "},i("td",null,i("div",{class:s,style:{backgroundColor:e.color}})),i("td",{class:"legendDetailsCell"},i("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("ir-input-text",{class:"legendTextarea border-0 m-0 p-0",value:e.name,inputContainerStyle:{margin:"0"},placeholder:"Reason for this color",onTextChange:e=>this.handleNameInput(t,e.detail),onInputBlur:()=>this.handleBlur(t)}),this.loadingIndex.includes(t)&&(this.saveState==="saving"||this.saveState==="saved")?i("ir-success-loader",{onLoaderComplete:()=>this.handleLoaderComplete(t)}):null)))})))),i("hr",{key:"1d2bb4f591b164daf6623ff45973cfd146dd0937",style:{marginTop:"1rem",marginBottom:"0.5rem"}}),i("div",{key:"73d07c5abc36ec73968ca8de14c30d80b14cb94f",class:"mt-1"},i("div",{key:"7dad72b79320775db336612220ce39749017943d",class:"legendCalendar"},i("div",{key:"ca25780b726e77a63f3f8c1f61331b93e11da964",class:"legendRow align-items-center"},i("div",{key:"a1615e4c0b5d9d05aeaf60aafb393cb1ec7804eb",class:"legendCal br-t br-s br-bt"},i("strong",{key:"86b8a299745312c5e77f6ea8756714698cf3a863"},"MAR 2022")),i("div",{key:"59ad10383106694737de87508b1153918ec56275",class:"highphenLegend"},Y.entries.Lcz_MonthAndYear)),i("div",{key:"dc6a5f25377e6ecb30619ccee8d813f378582b11",class:"legendRow"},i("div",{key:"9e8623cc9e360d0af8ca90b2e56163bfe7aa6fa8",class:"legendCal headerCell align-items-center br-s"},i("span",{key:"9a58b7616445d5de111f5c058056139142e26b02",class:"badge badge-info  badge-pill"},"3")),i("div",{key:"87e89a6b32f47d4300d15daa01a03ad56ee7f236",class:"highphenLegend"},i("div",{key:"5f1073d707f27fedd3f9a0d06c7af23764982301"},Y.entries.Lcz_UnassignedUnits))),i("div",{key:"78d1ddb8f5ea545cccabca305dbf5cb03bb911af",class:"legendRow"},i("div",{key:"0ffbdbd0da798912046d619328596a3eec746f53",class:"legendCal dayTitle br-s"},"Fri 18"),i("div",{key:"a10d43f8505764e5feb8ba50e69ea19d177fba37",class:"highphenLegend"},Y.entries.Lcz_Date)),i("div",{key:"c9a943ddda3880c161447ad84bc79bd4bf5ccea2",class:"legendRow"},i("div",{key:"f95a02c1e34fb9ad98bf0ddd576922b8c9aaea9e",class:"legendCal br-s br-bt dayCapacityPercent"},"15%"),i("div",{key:"3b183c69dbbc5e800d3f0b804bd8c92d8f9d8793",class:"highphenLegend"},Y.entries.Lcz_Occupancy)),i("div",{key:"5644122ab47fc06165cf3b025c85e2367867f14c",class:"legendRow"},i("div",{key:"7af8ed1981f451885c4471f2cf902367f396566e",class:"legendCal br-s br-bt  font-weight-bold total-availability"},"20"),i("div",{key:"90ef267c25f9db50c347b71404a1f0a614d0122c",class:"highphenLegend"},Y.entries.Lcz_TotalAvailability)))))))}static get watchers(){return{saveState:["handleSaveStateChange"]}}};ge.style=he;const be=".sc-igl-reallocation-dialog-h{display:block}.dialog-body.sc-igl-reallocation-dialog{display:grid;gap:1.5rem}.dialog-body__description.sc-igl-reallocation-dialog{margin:0}.dialog-footer.sc-igl-reallocation-dialog{display:flex;justify-content:flex-end;gap:0.75rem}";const fe=be;const ue=class{constructor(i){e(this,i);this.dialogClose=t(this,"dialogClose",7);this.revertBooking=t(this,"revertBooking",7);this.resetModalState=t(this,"resetModalState",7);this.showRateplanError=false;this.eventsService=new x;this.handleDialogVisibilityChange=e=>{if(!e.detail){this.dialogClose.emit(false)}};this.handleRateplanChange=e=>{this.selectedRateplan=e.detail;this.showRateplanError=false};this.handleCancelClick=()=>{var e;(e=this.dialogEl)===null||e===void 0?void 0:e.closeModal();this.dialogClose.emit(false)}}handleDataChange(e){var t,i;this.resetState(e);if(e){(t=this.dialogEl)===null||t===void 0?void 0:t.openModal()}else{(i=this.dialogEl)===null||i===void 0?void 0:i.closeModal()}}async reallocateUnit(){var e;if(!this.data){return}if(!this.validateRateplanSelection()){return}const{pool:t,toRoomId:i,from_date:s,to_date:o}=this.data;try{await this.eventsService.reallocateEvent(t,i,s,o,this.data.rateplans?Number(this.selectedRateplan):undefined)}catch(e){console.log(e);this.revertBooking.emit(t)}finally{(e=this.dialogEl)===null||e===void 0?void 0:e.closeModal();this.resetModalState.emit()}}get rateplanOptions(){var e;if(!Array.isArray((e=this.data)===null||e===void 0?void 0:e.rateplans)){return[]}return this.data.rateplans.map((e=>Object.assign(Object.assign({},e),{text:this.formatRateplanLabel(e)})))}formatRateplanLabel(e){if(!e){return""}const t=e.custom_text?` | ${e.custom_text}`:"";return`${e.text}${t}`.trim()}hasRateplanRequirement(){return this.rateplanOptions.length>0}validateRateplanSelection(){if(!this.hasRateplanRequirement()){return true}if(!this.selectedRateplan){this.showRateplanError=true;this.focusRateplanSelect();return false}return true}focusRateplanSelect(){var e,t,i,s;const o=(i=(t=(e=this.rateplanSelectEl)===null||e===void 0?void 0:e.shadowRoot)===null||t===void 0?void 0:t.querySelector("select"))!==null&&i!==void 0?i:(s=this.rateplanSelectEl)===null||s===void 0?void 0:s.querySelector("select");if(o){o.focus()}}resetState(e){if(!e){this.selectedRateplan=undefined;this.showRateplanError=false;return}this.selectedRateplan=undefined;this.showRateplanError=false}render(){const e=this.hasRateplanRequirement();return i("ir-dialog",{key:"f8d05ecefbfa825c6960cc9e5c03bf492cd1c4a2",ref:e=>this.dialogEl=e,onOpenChange:this.handleDialogVisibilityChange},this.data&&i(s,{key:"3dc3978f5818ca0c41a86805f823daaac9437480"},this.data.title&&i("div",{key:"4728c2068d04f7393b2301502877cdf07d801e86",slot:"modal-title"},this.data.title),i("div",{key:"b2ddd9020373860b26e9a6904f89767a6993988d",slot:"modal-body",class:"dialog-body"},i("p",{key:"b9cfea3802ca93dc624877169f387d742a0a1bdf",class:"text-left dialog-body__description m-0 p-0"},this.data.description),e&&i("ir-select",{key:"9ca1947dbac2c5294d1a535bf99bd43d637dad66",ref:e=>this.rateplanSelectEl=e,required:true,firstOption:"Select rate plan...",data:this.rateplanOptions.map((e=>({text:e.text,value:e.value}))),error:this.showRateplanError,onSelectChange:this.handleRateplanChange})),i("div",{key:"ee7537c6b375fb2bd85b2150d3107c5f5fe88c3d",class:"dialog-footer",slot:"modal-footer"},i("ir-button",{key:"ebd80de6ec4512d73fae72e0302d01554fe68f9b",onClick:this.handleCancelClick,text:"Cancel",size:"md",btn_color:"secondary"}),i("ir-button",{key:"a2f819e6227f20850e7f771d4998bbf23959bd97",text:"Confirm",onClick:()=>this.reallocateUnit(),size:"md",isLoading:S("/ReAllocate_Exposed_Room")}))))}get hostEl(){return n(this)}static get watchers(){return{data:["handleDataChange"]}}};ue.style=fe;const pe=C.object({roomtype_id:C.coerce.number(),unit_id:C.coerce.number(),rateplan_id:C.coerce.number()});const ve=".sc-igl-split-booking-h{display:block}.sc-igl-split-booking-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-split-booking{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-split-booking{transition:all 0.5s ease}.physical-room.sc-igl-split-booking{margin-left:1rem !important}.physical-room.sc-igl-split-booking>td.sc-igl-split-booking:last-child{padding-left:1rem}.room-type-list.sc-igl-split-booking{padding:0;margin:0}.room-type-list.sc-igl-split-booking>li.sc-igl-split-booking,.physical-room.sc-igl-split-booking,.room-type-row.sc-igl-split-booking{list-style:none}";const me=ve;const ke=".sc-igl-split-booking-h{height:100%}.sheet-container.sc-igl-split-booking{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-split-booking{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-split-booking{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-split-booking{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-split-booking{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-split-booking{flex-direction:row;align-items:center}}";const ye=ke;const we=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.roomTypes=[];this.selectedUnit={};this.mealPlanOptions=null;this.bookingService=new a}componentWillLoad(){this.room=this.getRoom();this.defaultDates=Object.assign({},this.generateDates(this.room));this.selectedDates=Object.assign({},this.defaultDates);console.log(this.booking)}getRoom(){if(!this.booking){throw new Error("Missing booking")}if(!this.identifier){throw new Error("Missing Identifier")}const e=this.booking.rooms.find((e=>e.identifier===this.identifier));if(!e){throw new Error(`Couldn't find room with identifier ${this.identifier}`)}return e}generateDates(e){let t=w(e.from_date,"YYYY-MM-DD");const i=w(e.to_date,"YYYY-MM-DD").add(-1,"days");const s=w();if(t.isBefore(s)){t=s.clone()}if(t.isSame(s)){return{from_date:t,to_date:i}}if(t.isSameOrAfter(s)){return{from_date:t.clone().add(1,"days"),to_date:i}}return{from_date:s.clone().add(1,"days"),to_date:i}}async checkBookingAvailability(){l();const e=this.selectedDates.from_date.format("YYYY-MM-DD");const t=this.selectedDates.to_date.format("YYYY-MM-DD");const i=this.booking.agent!==null;try{const s=await this.bookingService.getBookingAvailability({from_date:e,to_date:t,propertyid:this.booking.property.id,adultChildCount:{adult:1,child:0},language:"en",room_type_ids:[],currency:this.booking.currency,agent_id:i?this.booking.agent.id:null,is_in_agent_mode:i,room_type_ids_to_update:[]});this.roomTypes=s}catch(e){console.error("Error initializing booking availability:",e)}}async doReservation(){try{this.isLoading=true;this.errors=null;const e=pe.parse(this.selectedUnit);const t=this.booking.rooms.filter((e=>e.identifier!==this.identifier));let i=[...t,Object.assign(Object.assign({},this.room),{from_date:this.room.from_date,to_date:this.selectedDates.from_date.format("YYYY-MM-DD"),days:this.room.days.filter((e=>w(e.date,"YYYY-MM-DD").isBefore(this.selectedDates.from_date,"dates"))),departure_time:null}),Object.assign(Object.assign({},this.room),{identifier:null,assigned_units_pool:null,parent_room_identifier:this.room.identifier,is_split:true,roomtype:{id:e.roomtype_id},rateplan:{id:e.rateplan_id||this.room.rateplan.id},departure_time:this.room.departure_time,unit:{id:e.unit_id},from_date:this.selectedDates.from_date.format("YYYY-MM-DD"),days:this.room.days.filter((e=>w(e.date,"YYYY-MM-DD").isSameOrAfter(this.selectedDates.from_date,"dates")))})];const s={assign_units:true,is_pms:true,is_direct:this.booking.is_direct,is_backend:true,is_in_loyalty_mode:this.booking.is_in_loyalty_mode,promo_key:this.booking.promo_key,extras:this.booking.extras,agent:this.booking.agent,booking:{from_date:this.booking.from_date,to_date:this.booking.to_date,remark:this.booking.remark,booking_nbr:this.booking.booking_nbr,property:this.booking.property,booked_on:this.booking.booked_on,source:this.booking.source,rooms:i,currency:this.booking.currency,arrival:this.booking.arrival,guest:this.booking.guest},pickup_info:this.booking.pickup_info};await this.bookingService.doReservation(s);this.closeModal.emit(null)}catch(e){const t={};if(e instanceof M){console.error(e);e.issues.forEach((e=>{t[e.path[0]]=true}));this.errors=Object.assign({},t)}}finally{this.isLoading=false}}updateSelectedUnit(e){var t;const i=Object.assign(Object.assign({},this.selectedUnit),e);const s=(t=_===null||_===void 0?void 0:_.property)===null||t===void 0?void 0:t.roomtypes;const o=f({rateplan_id:this.room.rateplan.id.toString(),roomTypeId:i===null||i===void 0?void 0:i.roomtype_id,roomTypes:s});const n=Object.prototype.hasOwnProperty.call(e,"rateplan_id");if(Array.isArray(o)){this.mealPlanOptions=o;if(!n){delete i.rateplan_id}}else{this.mealPlanOptions=null;if(!n){if(o){i.rateplan_id=Number(o.value)}else{delete i.rateplan_id}}}this.selectedUnit=i}render(){var e,t,o,n,a,l,r;return i("form",{key:"bd5e1dc2cfda4b97eaf69b781b7668520c233ff9",onSubmit:e=>{e.preventDefault();this.doReservation()},class:"sheet-container"},i("ir-title",{key:"19c6b7a3614944709ef1a0c34f4704a4e6eaf397",class:"px-1 sheet-header mb-0",displayContext:"sidebar",onCloseSideBar:()=>this.closeModal.emit(),label:`Split unit ${(e=this.room)===null||e===void 0?void 0:e.unit["name"]}`}),i("section",{key:"06d86ae9845bf6e150de729c9fb0a156bf9256da",class:"px-1 sheet-body"},i("div",{key:"3c616bf3cdd3d6d942c5bcb333a54d067a3e1519",class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("div",{key:"3a213c7df5db1bd348860b1dee35ac45445b0e31"},i("ir-date-view",{key:"c2a3dd1fa6d042ce7f1687de2a6441081a805307",from_date:this.room.from_date,to_date:this.room.to_date,showDateDifference:false})),i("p",{key:"9fae47841b6b58be624fb4d50abc3307295fa481",class:"m-0 p-0"},this.room.rateplan.short_name," ",this.room.rateplan.is_non_refundable?Y.entries.Lcz_NonRefundable:"")),i("div",{key:"7ce35830363a43d70ccdc5876438e348d95670df",class:"d-flex align-items-center mt-1",style:{gap:"0.5rem"}},i("span",{key:"e6b9eccfbfa84cf0b441dc51baf151c5eb383243"},"From:"),i("ir-date-picker",{key:"b92cbea1093568603c8d31f9f72caa9b3889698a","data-testid":"pickup_arrival_date",date:(o=(t=this.selectedDates)===null||t===void 0?void 0:t.from_date)===null||o===void 0?void 0:o.format("YYYY-MM-DD"),maxDate:(n=this.defaultDates)===null||n===void 0?void 0:n.to_date.format("YYYY-MM-DD"),minDate:(a=this.defaultDates)===null||a===void 0?void 0:a.from_date.format("YYYY-MM-DD"),emitEmptyDate:true,onDateChanged:e=>{this.selectedDates=Object.assign(Object.assign({},this.selectedDates),{from_date:e.detail.start})}},i("input",{key:"f86cdcec2491029f169b8050cf79c63bfd750b0e",type:"text",slot:"trigger",value:this.selectedDates.from_date?this.selectedDates.from_date.format("MMM DD, YYYY"):null,class:`form-control input-sm  text-center`,style:{width:"120px"}})),i("ir-button",{key:"9b4ee505d797d617c5a690f73cca825c5454c687",isLoading:S("/Check_Availability"),text:"Check available units",size:"sm",onClick:()=>this.checkBookingAvailability()})),((l=this.errors)===null||l===void 0?void 0:l.roomtype_id)&&i("p",{key:"ce1e9e4d3966121f91f86abe704f9946a0639174",class:"text-danger text-left mt-2"},"Please select a room"),i("ul",{key:"d7e484ea496c3487c7c99d5e1a66aa1be7c93a83",class:"room-type-list mt-2"},(r=this.roomTypes)===null||r===void 0?void 0:r.map((e=>{if(!e.is_available_to_book){return null}const t=(()=>{const t=new Map;for(const i of e.rateplans){for(const e of i.assignable_units){if(e.Is_Fully_Available){t.set(e.pr_id,e.name)}}}return Array.from(t,(([e,t])=>({id:e,name:t})))})();return i(s,null,i("li",{key:`roomTypeRow-${e.id}`,class:`room-type-row`},i("div",{class:"d-flex choice-row"},i("span",{class:"text-left room-type-name"},e.name))),t.map(((t,s)=>{var o,n,a,l;const r=s===e.physicalrooms.length-1?"pb-1":"";const d=((o=this.selectedUnit)===null||o===void 0?void 0:o.unit_id)===t.id&&Array.isArray(this.mealPlanOptions)&&this.mealPlanOptions.length>0;return i("li",{key:`physicalRoom-${t.id}-${s}`,class:`physical-room ${r}`},i("div",{class:"d-flex choice-row align-items-center",style:{gap:"0.5rem"}},i("ir-radio",{class:"pl-1",name:"unit",checked:((n=this.selectedUnit)===null||n===void 0?void 0:n.unit_id)===t.id,onCheckChange:()=>this.updateSelectedUnit({roomtype_id:e.id,unit_id:t.id}),label:t.name}),d&&i("ir-select",{firstOption:"Select a new rateplan...",error:((a=this.errors)===null||a===void 0?void 0:a.rateplan_id)&&!((l=this.selectedUnit)===null||l===void 0?void 0:l.rateplan_id),onSelectChange:e=>{const t=e.detail===null||e.detail===undefined||e.detail===""?undefined:Number(e.detail);this.updateSelectedUnit({rateplan_id:t})},data:this.mealPlanOptions.map((e=>Object.assign(Object.assign({},e),{text:e.text+`${e.custom_text?" | ":""}${e.custom_text}`})))})))})))})))),i("div",{key:"351a4b4f20eabd514008fb5eeec077224a07e388",class:"sheet-footer"},i("ir-button",{key:"514e1dc46774a5971413b02ef4889d776f8912e5",text:Y.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"5de04d8e382927d2f44355cda992deb56d11c857",isLoading:this.isLoading,text:Y.entries.Lcz_Confirm,btn_type:"submit",class:"flex-fill"})))}};we.style=me+ye;const xe=".sc-igl-tba-category-view-h{display:block}";const De=xe;const Ye=class{constructor(i){e(this,i);this.assignUnitEvent=t(this,"assignUnitEvent",7);this.categoriesData={};this.renderAgain=false}handleAssignRoomEvent(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;this.eventDatas=this.eventDatas.filter((e=>e.ID!=t.data.ID));this.calendarData.bookingEvents.push(t.data);this.assignUnitEvent.emit({key:"assignUnit",data:{RT_ID:this.categoryId,selectedDate:this.selectedDate,assignEvent:t.data,calendarData:this.calendarData}});this.renderView()}getEventView(e,t){return t.map(((t,s)=>i("igl-tba-booking-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,eventData:t,categoriesData:this.categoriesData,categoryId:e,categoryIndex:this.categoryIndex,eventIndex:s,onAssignRoomEvent:e=>this.handleAssignRoomEvent(e)})))}renderView(){this.renderAgain=!this.renderAgain}render(){var e;return i(o,{key:"cecb8a951ad656ecfec0d005505ca23785ef96fb"},i("div",{key:"96976cc9b64f3a183446404404907c97e75ddb41",class:"sectionContainer"},i("div",{key:"f567c916f0812d2c0ff38d074aa1ff1da9d636a2",class:"font-weight-bold mt-1 font-small-3"},(e=this.categoriesData[this.categoryId])===null||e===void 0?void 0:e.name),this.getEventView(this.categoryId,this.eventDatas)))}};Ye.style=De;const _e=".sc-igl-to-be-assigned-h{display:block}.custom-dropdown.sc-igl-to-be-assigned{cursor:pointer;padding:5px 10px;width:min-content;margin-left:auto;margin-right:auto}.dropdown-toggle.sc-igl-to-be-assigned{all:unset;display:flex;width:max-content;align-items:center;gap:10px}.close_btn_style.sc-igl-to-be-assigned{padding:0.4rem}.close_btn_style.sc-igl-to-be-assigned:hover{background-color:#f6f6f6}.dropdown-menu.sc-igl-to-be-assigned{max-height:250px;overflow-y:auto}.tobeAssignedHeader.sc-igl-to-be-assigned{font-weight:500;letter-spacing:0.05rem;font-size:1.12rem;padding:0;margin:0}.assignment_header.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:space-between;padding-top:5px;margin-bottom:1rem}.dropdown-toggle.sc-igl-to-be-assigned::after{content:none;display:none}.dropdown-toggle.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transition:transform 0.2s ease}.show.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transform:rotate(-180deg)}.stickyHeader.sc-igl-to-be-assigned{position:-webkit-sticky;position:sticky;top:0;background-color:#ffffff;z-index:1}.pointer.sc-igl-to-be-assigned{cursor:pointer}.dots.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:center;margin:0 3px;padding:0}.dot.sc-igl-to-be-assigned{width:5px;height:5px;margin:5px 4px 0;background-color:#6b6f82;border-radius:50%;animation:dotFlashing 1s infinite linear alternate}.dot.sc-igl-to-be-assigned:nth-child(2){animation-delay:0.2s}.dot.sc-igl-to-be-assigned:nth-child(3){animation-delay:0.4s}@keyframes dotFlashing{0%{opacity:0}50%,100%{opacity:1}}";const Ce=_e;const Me=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.reduceAvailableUnitEvent=t(this,"reduceAvailableUnitEvent",7);this.showBookingPopup=t(this,"showBookingPopup",7);this.addToBeAssignedEvent=t(this,"addToBeAssignedEvent",7);this.highlightToBeAssignedBookingEvent=t(this,"highlightToBeAssignedBookingEvent",7);this.showDatesList=false;this.renderAgain=false;this.orderedDatesList=[];this.noScroll=false;this.isGotoToBeAssignedDate=false;this.isLoading=true;this.selectedDate=null;this.data={};this.today=new Date;this.categoriesData={};this.toBeAssignedService=new O}componentWillLoad(){this.reArrangeData();this.loadingMessage=Y.entries.Lcz_FetchingUnAssignedUnits}handleUnassignedDatesToBeAssignedChange(e){const{fromDate:t,toDate:i,data:s}=e;let o=new Date(t);o.setHours(0);o.setMinutes(0);o.setSeconds(0);let n=o.getTime();while(n<=new Date(i).getTime()){if(s&&!s[n]&&this.unassignedDates.hasOwnProperty(n)){delete this.unassignedDates[n]}else if(s&&s[n]){this.unassignedDates[n]=s[n]}n=w(n).add(1,"days").toDate().getTime()}this.data=Object.assign({},this.unassignedDates);this.orderedDatesList=Object.keys(this.data).sort(((e,t)=>parseInt(e)-parseInt(t)));if(this.orderedDatesList.length){if(!this.data.hasOwnProperty(this.selectedDate)){this.selectedDate=this.orderedDatesList.length?this.orderedDatesList[0]:null}this.showForDate(this.selectedDate,false);this.renderView()}else{this.selectedDate=null}}handleAssignUnit(e){var t,i,s,o,n;const a=e.detail;const l=a.data;e.stopImmediatePropagation();e.stopPropagation();if((a===null||a===void 0?void 0:a.key)==="assignUnit"&&this.data){if((l===null||l===void 0?void 0:l.selectedDate)&&this.data[l.selectedDate]){if(((t=this.data[l.selectedDate])===null||t===void 0?void 0:t.categories)&&((s=Object.keys(((i=this.data[l.selectedDate])===null||i===void 0?void 0:i.categories)||{}))===null||s===void 0?void 0:s.length)===1){this.isLoading=true;this.noScroll=true}if((l===null||l===void 0?void 0:l.RT_ID)&&((o=this.data[l.selectedDate])===null||o===void 0?void 0:o.categories)&&this.data[l.selectedDate].categories[l.RT_ID]&&Array.isArray(this.data[l.selectedDate].categories[l.RT_ID])&&((n=l===null||l===void 0?void 0:l.assignEvent)===null||n===void 0?void 0:n.ID)){this.data[l.selectedDate].categories[l.RT_ID]=this.data[l.selectedDate].categories[l.RT_ID].filter((e=>e&&e.ID!==l.assignEvent.ID))}if(l===null||l===void 0?void 0:l.calendarData){this.calendarData=l.calendarData}this.renderView()}}}async updateCategories(e,t){try{let i={};const s=await this.toBeAssignedService.getUnassignedRooms({from_date:t.from_date,to_date:t.to_date},this.propertyid,v(new Date(+e)),t.roomsInfo,t.formattedLegendData);s.forEach((e=>{if(!i.hasOwnProperty(e.RT_ID)){i[e.RT_ID]=[e]}else{i[e.RT_ID].push(e)}}));this.unassignedDates[e].categories=i}catch(e){}}async reArrangeData(){try{this.today.setHours(0,0,0,0);this.calendarData.roomsInfo.forEach((e=>{this.categoriesData[e.id]={name:e.name,roomsList:e.physicalrooms,roomIds:e.physicalrooms.map((e=>e.id))}}));this.selectedDate=null;this.unassignedDates=B();console.log(this.unassignedDates);this.data=this.unassignedDates;this.orderedDatesList=Object.keys(this.data).sort(((e,t)=>parseInt(e)-parseInt(t)));if(!this.selectedDate&&this.orderedDatesList.length){this.selectedDate=this.orderedDatesList[0]}}catch(e){console.error("Error fetching unassigned dates:",e)}}async componentDidLoad(){setTimeout((()=>{if(!this.isGotoToBeAssignedDate&&Object.keys(this.unassignedDates).length>0){const e=Object.keys(this.unassignedDates)[0];this.showForDate(e)}}),100)}async gotoDate(e){this.isGotoToBeAssignedDate=true;this.showForDate(e.detail.data);this.showDatesList=false;this.renderView()}handleToBeAssignedDate(e){this.showBookingPopup.emit({key:"calendar",data:new Date(e.detail.data.fromDate).getTime()-864e5,noScroll:false})}async showForDate(e,t=true){try{if(t){this.isLoading=true}if(this.showDatesList){this.showUnassignedDate()}await this.updateCategories(e,this.calendarData);this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.showBookingPopup.emit({key:"calendar",data:parseInt(e)-864e5,noScroll:this.noScroll});if(this.isGotoToBeAssignedDate){this.isGotoToBeAssignedDate=false}this.isLoading=false;this.selectedDate=e;this.renderView()}catch(e){}}getDay(e){const t=new Date(e);const i="default";const s=this.getLocalizedDayOfWeek(t,i);return s+" "+t.getDate()+", "+t.getFullYear()}getLocalizedDayOfWeek(e,t){const i={weekday:"short"};return e.toLocaleDateString(t,i)}handleOptionEvent(e,t=""){this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:"----"}});this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.optionEvent.emit({key:e,data:t})}showUnassignedDate(){this.showDatesList=!this.showDatesList}getToBeAssignedEntities(){}getCategoryView(){if(this.orderedDatesList.length&&this.selectedDate&&this.data[this.selectedDate]){return Object.entries(this.data[this.selectedDate].categories).map((([e,t],s)=>i("igl-tba-category-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,categoryId:e,categoryIndex:s,categoriesData:this.categoriesData,eventDatas:t,onAssignUnitEvent:e=>this.handleAssignUnit(e)})))}else{return null}}renderView(){this.renderAgain=!this.renderAgain}render(){var e;return i(o,{key:"0973d0b19154b4cb6e1e37ad7dbd79e62b4de0b7",class:"tobeAssignedContainer pr-1 text-left"},i("div",{key:"7eae8a3bd675ebb3acc7521b829298a213de0cc3"},i("div",{key:"5a3b26a35fab0ffa2a79efc29bac35338f12a7db"},i("div",{key:"8de852a09ec52ed94db031f808e8c8daea3e9db0",class:"stickyHeader pt-1"},i("div",{key:"f7216bb1e80e78d4a59a379d1a2b20e5f5ab4e08",class:"assignment_header"},i("p",{key:"7f3eb8c5510a85cb08cf1a96d1522216fa18744c",class:"tobeAssignedHeader "},Y.entries.Lcz_Assignments),i("ir-button",{key:"9cd8dd1b27ff617f2f6940fbe7f40928fd41bef1",class:"close_btn",variant:"icon",btn_styles:"close_btn_style",icon_name:"double_caret_left",style:R.secondary,onClickHandler:()=>this.handleOptionEvent("closeSideMenu"),visibleBackgroundOnHover:true})),i("hr",{key:"447aa305992c52f803453d2838bde5b5cea5cc25"}),Object.keys(this.data).length===0?i("p",null,Y.entries.Lcz_AllBookingsAreAssigned):this.isLoading?i("p",{class:"d-flex align-items-center"},i("span",{class:"p-0"},this.loadingMessage),i("div",{class:"dots"},i("div",{class:"dot"}),i("div",{class:"dot"}),i("div",{class:"dot"}))):i(s,null,this.orderedDatesList.length?i("div",{class:`custom-dropdown border border-light rounded text-center `+(this.showDatesList?"show":""),id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i("div",{class:"dropdown-toggle"},i("span",{class:"font-weight-bold"},this.data[this.selectedDate].dateStr),i("svg",{class:"caret-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"}))),i("div",{class:"dropdown-menu dropdown-menu-right full-width","aria-labelledby":"dropdownMenuButton"},(e=this.orderedDatesList)===null||e===void 0?void 0:e.map((e=>i("div",{class:"dropdown-item pointer",onClick:()=>this.showForDate(e)},this.data[e].dateStr))))):Y.entries.Lcz_AllBookingsAreAssigned)),!this.isLoading&&i("div",{key:"847d04ff658f1828953b1cfb93e5db2a9c7e864d",class:"scrollabledArea"},this.orderedDatesList.length?Object.keys(this.data[this.selectedDate].categories).length?this.getCategoryView():i("div",{class:"mt-1"},Y.entries.Lcz_AllAssignForThisDay):null))))}static get watchers(){return{unassignedDatesProp:["handleUnassignedDatesToBeAssignedChange"]}}};Me.style=Ce;const Ee=".sc-ir-interactive-title-h{display:block;width:100%;--hk-green:green}*.sc-ir-interactive-title{box-sizing:border-box}.popover-title.sc-ir-interactive-title{position:relative;width:100%;height:100%;margin:0;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;z-index:10;left:0;display:flex;align-items:center}.popover-container.sc-ir-interactive-title{position:absolute;bottom:0px;left:var(--ir-popover-left, 10px);background:rgb(0, 0, 0);color:white;min-width:100%;box-shadow:rgba(0, 0, 0, 0.2) 0px 2px 10px;z-index:9999;padding:3.5px 7px;border-radius:5px;pointer-events:none;opacity:0;transition:all 100ms ease;font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-style:normal;font-weight:400;line-height:1.45;text-decoration:none;text-shadow:none;font-size:0.875rem}.popover-container[data-state='show'].sc-ir-interactive-title{opacity:1}.hk-dot.sc-ir-interactive-title{inset:0;position:absolute;display:flex;align-items:center;justify-content:center;width:fit-content;padding:4px;left:auto;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;padding-inline:var(--ir-popover-left);background:var(--ir-interactive-hk-bg, white);color:var(--dot-color, black)}.hk-dot.sc-ir-interactive-title-s>*[name='end']{height:12px}";const Oe=Ee;const Te=class{constructor(t){e(this,t);this.popoverTitle="";this.irPopoverLeft="10px";this.hkStatus=false;this.cropSize=20;this.lastRenderedTitle=""}initializePopoverIfNeeded(e,t){if(this.lastRenderedTitle===t&&this.popoverInstance){return}this.disposePopover();const i=document.createElement("span");i.style.visibility="hidden";i.style.position="absolute";i.style.whiteSpace="nowrap";i.textContent=t;document.body.appendChild(i);const s=i.offsetWidth;document.body.removeChild(i);const o=e.clientWidth;const n=this.hkStatus?20:0;const a=s+n>o;if(a&&typeof $!=="undefined"){try{this.popoverInstance=$(e).popover({trigger:"hover",content:t,placement:"top",html:false,sanitize:true,delay:{show:300,hide:100}})}catch(e){console.error("Failed to initialize popover:",e)}}this.lastRenderedTitle=t}disposePopover(){if(this.popoverInstance&&typeof $!=="undefined"){try{$(this.titleContainerRef).popover("dispose");this.popoverInstance=null}catch(e){console.error("Failed to dispose popover:",e)}}}disconnectedCallback(){this.disposePopover()}render(){const e=this.popoverTitle||"";const t=e.length>this.cropSize;const s=t?e.slice(0,this.cropSize)+"...":e;return i(o,{key:"5e5d958cc28c179d36046216aa31840ec73222f3",style:{"--ir-popover-left":this.irPopoverLeft}},i("p",{key:"443214bc0cae1c197931c9da74b711b18acae869",ref:t=>{this.titleContainerRef=t;if(t&&e){setTimeout((()=>this.initializePopoverIfNeeded(t,e)),0)}},class:"popover-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center",gap:"4px"}},i("span",{key:"10d45a69788a9159b106a7027fdcd8873fa01365",class:"cropped-title",style:{flexShrink:"1",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis"}},s),this.hkStatus&&i("div",{key:"61a887712b59033ed648755aa83fd5eed42341d3",title:this.broomTooltip,class:"hk-dot",style:{flexShrink:"0"}},i("slot",{key:"34dc58fa219d7d6a39e2203108eeddf8b501bd7f",name:"end"}))))}get el(){return n(this)}};Te.style=Oe;const Be=".sc-ir-room-nights-h{display:block;box-sizing:border-box;margin:0;position:relative}.loading-container.sc-ir-room-nights{position:relative;height:100%;width:100%;display:flex;align-items:center;justify-content:center}.close-icon.sc-ir-room-nights{position:absolute;top:18px;right:33px;outline:none}.close.sc-ir-room-nights{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.card.sc-ir-room-nights{top:0;z-index:1000}.card-title.sc-ir-room-nights{border-bottom:1px solid #e4e5ec;width:100%}.irfontgreen.sc-ir-room-nights{color:#0e930e}.currency.sc-ir-room-nights{display:block;position:absolute;margin:0;padding:0;height:auto;left:10px}.rate-input.sc-ir-room-nights{font-size:14px;line-height:0;padding:0;height:0;border-left:0;border-radius:0.25rem !important}.rate-input-container.sc-ir-room-nights{display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;flex:1}.new-currency.sc-ir-room-nights{color:#3b4781;border:1px solid #cacfe7;font-size:0.975rem;height:2rem;background:rgb(255, 255, 255);padding-right:0 !important;border-right:0;border-top-right-radius:0;border-bottom-right-radius:0;transition:border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.input-group-prepend.sc-ir-room-nights span[data-state='focus'].sc-ir-room-nights{border-color:var(--blue)}.input-group-prepend.sc-ir-room-nights span[data-disabled].sc-ir-room-nights{background-color:#eceff1;border-color:rgba(118, 118, 118, 0.3)}.rateInputBorder.sc-ir-room-nights{padding-left:5px !important;padding-right:5px !important;border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}";const Re=Be;const Se=".sc-ir-room-nights-h{height:100%}.sheet-container.sc-ir-room-nights{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-room-nights{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-room-nights{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-room-nights{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-room-nights{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-room-nights{flex-direction:row;align-items:center}}";const Ne=Se;const Ae=class{constructor(i){e(this,i);this.closeRoomNightsDialog=t(this,"closeRoomNightsDialog",7);this.rates=[];this.isLoading=false;this.initialLoading=false;this.inventory=null;this.isEndDateBeforeFromDate=false;this.defaultTotalNights=0;this.isInputFocused=-1;this.dates={from_date:new Date,to_date:new Date};this.bookingService=new a}componentWillLoad(){this.dates={from_date:new Date(this.fromDate),to_date:new Date(this.toDate)};this.init()}isButtonDisabled(){return this.isLoading||this.rates.some((e=>e.amount===-1))||this.inventory===0||this.inventory===null}async init(){var e;try{const{from_date:t}=this.defaultDates;if(w(t,"YYYY-MM-DD").isBefore(w(this.fromDate,"YYYY-MM-DD"))){this.dates.from_date=new Date(t)}else{this.dates.from_date=new Date(this.fromDate)}this.dates.to_date=new Date(this.toDate);this.bookingEvent=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);if(this.bookingEvent){const t=this.bookingEvent.rooms.filter((e=>e.identifier===this.identifier));this.selectedRoom=t[0];const i=(e=this.selectedRoom)===null||e===void 0?void 0:e.days[this.selectedRoom.days.length-1];if(w(this.toDate).add(-1,"days").isSame(w(i.date))){console.log("here1");const e=await this.fetchBookingAvailability(this.fromDate,this.selectedRoom.days[0].date,this.selectedRoom.rateplan.id);const t=m(this.selectedRoom.days[0].date,this.fromDate);this.isEndDateBeforeFromDate=true;this.rates=[...t.map((i=>({amount:e/t.length,date:i,cost:null}))),...this.selectedRoom.days];this.defaultTotalNights=this.rates.length-this.selectedRoom.days.length}else{console.log("here2");console.log(i);const e=await this.fetchBookingAvailability(this.bookingEvent.to_date,w(this.toDate,"YYYY-MM-DD").format("YYYY-MM-DD"),this.selectedRoom.rateplan.id);const t=m(i.date,this.toDate);this.rates=[...this.selectedRoom.days,...t.map((i=>({amount:e/t.length,date:i,cost:null})))]}}}catch(e){console.log(e)}}handleInput(e,t){let i=e;let s=[...this.rates];i=i.replace(/[^0-9.]/g,"");if(i===""){s[t].amount=-1}else{if(!isNaN(Number(i))){s[t].amount=Number(i)}}this.rates=s}async fetchBookingAvailability(e,t,i){var s;try{this.initialLoading=true;const o=await this.bookingService.getBookingAvailability({from_date:e,to_date:t,propertyid:this.propertyId,adultChildCount:{adult:this.selectedRoom.rateplan.selected_variation.adult_nbr,child:this.selectedRoom.rateplan.selected_variation.child_nbr},language:this.language,currency:this.bookingEvent.currency,room_type_ids:[this.selectedRoom.roomtype.id],rate_plan_ids:[i]});console.log(o[0],i);this.inventory=o[0].inventory;const n=o[0].rateplans.find((e=>e.id===i));if(!n||!n.variations){this.inventory=null;return null}const a=(s=n.variations)===null||s===void 0?void 0:s.find((e=>e.adult_nbr===this.selectedRoom.rateplan.selected_variation.adult_nbr&&e.child_nbr===this.selectedRoom.rateplan.selected_variation.child_nbr));if(!a){return null}return a.discounted_gross_amount}catch(e){console.error(e)}finally{this.initialLoading=false}}renderInputField(e,t,s){return i("div",{class:"col-3 ml-1 position-relative  m-0 p-0 rate-input-container"},i("ir-price-input",{value:s.amount>0?s.amount.toString():"",disabled:this.inventory===0||this.inventory===null,currency:t,"aria-label":"rate","aria-describedby":"rate cost",onTextChange:t=>this.handleInput(t.detail,e)}))}renderReadOnlyField(e,t){return i("p",{class:"col-9 ml-1 m-0 p-0"},`${e}${Number(t.amount).toFixed(2)}`)}renderRateFields(e,t,i){if(this.isEndDateBeforeFromDate){if(e<this.defaultTotalNights){return this.renderInputField(e,t,i)}else{return this.renderReadOnlyField(t,i)}}else{return e<this.selectedRoom.days.length?this.renderReadOnlyField(t,i):this.renderInputField(e,t,i)}}renderDates(){var e;const t=this.bookingEvent.currency.symbol;return i("div",{class:"mt-2 m-0"},(e=this.rates)===null||e===void 0?void 0:e.map(((e,s)=>i("div",{class:"row m-0 mt-1 align-items-center"},i("p",{class:"col-2 m-0 p-0"},k(e.date)),this.renderRateFields(s,t,e)))))}async handleRoomConfirmation(){try{this.isLoading=true;let e=[...this.bookingEvent.rooms];let t=e.findIndex((e=>e.identifier===this.identifier));if(t===-1){throw new Error("Invalid Pool")}e[t]=Object.assign(Object.assign({},e[t]),{days:this.rates,to_date:w(this.dates.to_date).format("YYYY-MM-DD"),from_date:w(this.dates.from_date).format("YYYY-MM-DD")});const i={assign_units:true,check_in:true,is_pms:true,is_direct:true,pickup_info:this.bookingEvent.pickup_info,extra_services:this.bookingEvent.extra_services,booking:{booking_nbr:this.bookingNumber,from_date:w(this.dates.from_date).format("YYYY-MM-DD"),to_date:w(this.dates.to_date).format("YYYY-MM-DD"),remark:this.bookingEvent.remark,property:this.bookingEvent.property,source:this.bookingEvent.source,currency:this.bookingEvent.currency,arrival:this.bookingEvent.arrival,guest:this.bookingEvent.guest,rooms:e}};await this.bookingService.doReservation(i);this.closeRoomNightsDialog.emit({type:"confirm",pool:this.pool})}catch(e){}finally{this.isLoading=false}}render(){var e,t,o;if(!this.bookingEvent){return i("div",{class:"loading-container"},i("ir-loading-screen",null))}return i("div",{class:"sheet-container"},i("ir-title",{class:"p-1 sheet-header",onCloseSideBar:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool}),label:`${Y.entries.Lcz_AddingRoomNightsTo} ${(t=(e=this.selectedRoom)===null||e===void 0?void 0:e.roomtype)===null||t===void 0?void 0:t.name} ${((o=this.selectedRoom)===null||o===void 0?void 0:o.unit).name}`,displayContext:"sidebar"}),i("section",{class:"text-left px-1 pt-0 sheet-body"},i("p",{class:"font-medium-1"},`${Y.entries.Lcz_Booking}#`," ",this.bookingNumber),this.initialLoading?i("p",{class:"mt-2 text-secondary"},Y.entries["Lcz_CheckingRoomAvailability "]):i(s,null,i("p",{class:"font-weight-bold font-medium-1"},`${y(w(this.dates.from_date).format("YYYY-MM-DD"),"YYYY-MM-DD")} - ${y(w(this.dates.to_date).format("YYYY-MM-DD"),"YYYY-MM-DD")}`),i("p",{class:"font-medium-1 mb-0"},`${this.selectedRoom.rateplan.name}`," ",this.selectedRoom.rateplan.is_non_refundable&&i("span",{class:"irfontgreen"},Y.entries.Lcz_NonRefundable)),(this.inventory===0||this.inventory===null)&&i("p",{class:"font-medium-1 text danger"},Y.entries.Lcz_NoAvailabilityForAdditionalNights),this.selectedRoom.rateplan.custom_text&&i("p",{class:"text-secondary mt-0"},this.selectedRoom.rateplan.custom_text),this.renderDates())),i("section",{class:"sheet-footer"},i("ir-button",{btn_color:"secondary",btn_disabled:this.isLoading,text:Y===null||Y===void 0?void 0:Y.entries.Lcz_Cancel,class:"full-width",btn_styles:"justify-content-center",onClickHandler:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool})}),this.inventory>0&&this.inventory!==null&&i("ir-button",{isLoading:this.isLoading,text:Y===null||Y===void 0?void 0:Y.entries.Lcz_Confirm,btn_disabled:this.isButtonDisabled(),class:"full-width",btn_styles:"justify-content-center",onClickHandler:this.handleRoomConfirmation.bind(this)})))}};Ae.style=Re+Ne;const Ie=":host{display:block}.spinner{transform-origin:center;animation:spinner_svv2 0.75s infinite linear}@keyframes spinner_svv2{100%{transform:rotate(360deg)}}";const Le=Ie;const $e=class{constructor(i){e(this,i);this.loaderComplete=t(this,"loaderComplete",7);this.spinnerDuration=1500;this.successDuration=1e3;this.autoStart=true;this.active=true;this.phase="spinner"}componentWillLoad(){if(this.autoStart&&this.active){this.startCycle()}}disconnectedCallback(){this.clearTimers()}onActiveChange(e){if(e){if(this.autoStart){this.startCycle()}}else{this.resetCycle()}}onDurationChange(){if(this.active&&this.autoStart){this.startCycle()}}startCycle(){this.clearTimers();this.phase="spinner";const e=Math.max(0,Number(this.spinnerDuration)||0);if(e===0){this.showSuccess();return}this.spinnerTimer=window.setTimeout((()=>this.showSuccess()),e)}showSuccess(){this.phase="success";const e=Math.max(0,Number(this.successDuration)||0);if(e===0){this.handleCompletion();return}this.successTimer=window.setTimeout((()=>this.handleCompletion()),e)}handleCompletion(){this.loaderComplete.emit();this.active=false}resetCycle(){this.clearTimers();this.phase="spinner"}clearTimers(){if(this.spinnerTimer){clearTimeout(this.spinnerTimer);this.spinnerTimer=undefined}if(this.successTimer){clearTimeout(this.successTimer);this.successTimer=undefined}}render(){return i(o,{key:"8d7d71a398ae473eaf194fc3f718d27de84fd3b5"},this.phase==="spinner"?i("svg",{part:"spinner",width:"18",height:"18",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},i("path",{d:"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z",class:"spinner"})):i("ir-icons",{part:"check",name:"check",style:{color:"#45b16d"}}))}static get watchers(){return{active:["onActiveChange"],spinnerDuration:["onDurationChange"],successDuration:["onDurationChange"]}}};$e.style=Le;const je=".sc-ir-tabs-h{display:flex;align-items:center;position:relative;overflow-x:auto;gap:1rem;padding:0 1rem}.tab.sc-ir-tabs{font-size:0.95rem;font-weight:400;cursor:pointer;position:relative;margin:0;padding:0rem;padding-bottom:1rem;transition:color 0.3s ease;user-select:none;background-color:transparent;border:none;outline:none;flex:1 1 0%;text-align:center;white-space:nowrap}.tab[data-disabled].sc-ir-tabs{cursor:auto}.tab.sc-ir-tabs:hover{opacity:80%}.tab[data-state='selected'].sc-ir-tabs,.tab[data-state='selected'].sc-ir-tabs:hover{color:var(--blue, #1e9ff2);opacity:100%}.active-indicator.sc-ir-tabs{padding:0;bottom:0px;position:absolute;height:3px;border-radius:4px;transition:transform 0.3s ease, width 0.3s ease;background:var(--blue, #1e9ff2)}";const ze=je;const Pe=class{constructor(i){e(this,i);this.tabChanged=t(this,"tabChanged",7);this.tabs=[];this.disabled=false;this.ariaLabel="Tabs";this.remSize=(()=>{const e=getComputedStyle(document.documentElement).fontSize;return parseFloat(e)})()}componentWillLoad(){var e,t;const i=(e=this.tabs)===null||e===void 0?void 0:e.find((e=>e.id===this.initialTab));if(i){this.selectTab(i)}else if(((t=this.tabs)===null||t===void 0?void 0:t.length)>0){this.selectTab(this.tabs[0])}}disconnectedCallback(){if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}}updateActiveIndicator(){if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}requestAnimationFrame((()=>{const e=this.el.querySelector(`.tab[data-state="selected"]`);if(e){const{left:t,width:i}=e.getBoundingClientRect();const s=this.el.getBoundingClientRect().left;const o=t-s-this.remSize;this.activeIndicator.style.width=`${i-this.remSize}px`;this.activeIndicator.style.transform=`translateX(${o}px)`}}))}selectTab(e){if(this.disabled)return;this._selectedTab=e;this.updateActiveIndicator();this.tabChanged.emit(e)}handleKeyDown(e,t){if(this.disabled)return;const i=this.tabs.findIndex((e=>e.id===t.id));let s=i;switch(e.key){case"ArrowRight":e.preventDefault();s=(i+1)%this.tabs.length;break;case"ArrowLeft":e.preventDefault();s=i===0?this.tabs.length-1:i-1;break;case"Home":e.preventDefault();s=0;break;case"End":e.preventDefault();s=this.tabs.length-1;break;case"Enter":case" ":e.preventDefault();this.selectTab(t);return;default:return}const o=this.tabs[s];if(o){this.selectTab(o);requestAnimationFrame((()=>{const e=this.el.querySelector(`button.tab[data-tab-id="${o.id}"]`);if(e){e.focus()}}))}}render(){return i(o,{key:"55878aae70d318b44526da6b192a252a3ea94a81",role:"tablist","aria-label":this.ariaLabel,"aria-orientation":"horizontal"},this.tabs.map((e=>{var t,s,o;return i("button",{class:"tab",key:e.id,type:"button","data-tab-id":e.id,role:"tab",tabindex:((t=this._selectedTab)===null||t===void 0?void 0:t.id)===e.id?0:-1,"aria-selected":((s=this._selectedTab)===null||s===void 0?void 0:s.id)===e.id?"true":"false","aria-controls":`tabpanel-${e.id}`,id:`tab-${e.id}`,disabled:this.disabled,"data-state":((o=this._selectedTab)===null||o===void 0?void 0:o.id)===e.id?"selected":undefined,onClick:()=>this.selectTab(e),onKeyDown:t=>this.handleKeyDown(t,e)},e.label)})),i("span",{key:"0107bde305b385610dc935d0d817a0504fc69a1f",class:"active-indicator",ref:e=>this.activeIndicator=e}))}get el(){return n(this)}};Pe.style=ze;export{L as igl_booking_event,U as igl_bulk_block,X as igl_bulk_operations,ee as igl_bulk_stop_sale,se as igl_cal_body,ae as igl_cal_footer,de as igl_cal_header,ge as igl_legends,ue as igl_reallocation_dialog,we as igl_split_booking,Ye as igl_tba_category_view,Me as igl_to_be_assigned,Te as ir_interactive_title,Ae as ir_room_nights,$e as ir_success_loader,Pe as ir_tabs};
//# sourceMappingURL=p-02aed54c.entry.js.map