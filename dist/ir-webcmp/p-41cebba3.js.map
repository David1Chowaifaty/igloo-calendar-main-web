{"version":3,"names":["initialState","bookings","filteredBookings","paginatedBookings","needsCheckInBookings","inHouseBookings","searchTerm","pagination","page","pageSize","total","totalPages","today","getTodayString","state","arrivalsStore","onChange","onArrivalsStoreChange","createStore","initializeArrivalsStore","arrivalsMockData","Array","isArray","runArrivalsPipeline","setArrivalsSearchTerm","term","bookingsForToday","getBookingsForDate","searchedBookings","filterBookingsBySearch","length","Math","ceil","safePage","clamp","start","paginated","slice","split","splitBookingsByStatus","needsCheckIn","inHouse","date","map","booking","roomsForToday","rooms","filter","room","normalizeDate","from_date","Boolean","normalizedTerm","trim","toLowerCase","matchesSearchTerm","bookingNumber","booking_nbr","includes","buildName","guest","some","reduce","acc","needsCheckInRooms","isNeedsCheckIn","push","inHouseRooms","isInHouse","code","in_out","person","full","first_name","last_name","formatDateInput","Date","value","year","getFullYear","month","getMonth","padStart","day","getDate","min","max"],"sources":["src/stores/arrivals.store.ts"],"sourcesContent":["import { Booking, Room } from '@/models/booking.dto';\nimport { createStore } from '@stencil/store';\nimport { data as arrivalsMockData } from '@/components/ir-arrivals/_data';\n\nexport interface ArrivalsPagination {\n  page: number;\n  pageSize: number;\n  total: number;\n  totalPages: number;\n}\n\nexport interface ArrivalsStore {\n  bookings: Booking[];\n  filteredBookings: Booking[];\n  paginatedBookings: Booking[];\n  needsCheckInBookings: Booking[];\n  inHouseBookings: Booking[];\n  searchTerm: string;\n  pagination: ArrivalsPagination;\n  today: string;\n}\n\nconst initialState: ArrivalsStore = {\n  bookings: [],\n  filteredBookings: [],\n  paginatedBookings: [],\n  needsCheckInBookings: [],\n  inHouseBookings: [],\n  searchTerm: '',\n  pagination: {\n    page: 1,\n    pageSize: 20,\n    total: 0,\n    totalPages: 1,\n  },\n  today: getTodayString(),\n};\n\nexport const { state: arrivalsStore, onChange: onArrivalsStoreChange } = createStore<ArrivalsStore>(initialState);\n\nexport function initializeArrivalsStore(bookings: Booking[] = arrivalsMockData as any[]) {\n  arrivalsStore.bookings = Array.isArray(bookings) ? [...bookings] : [];\n  runArrivalsPipeline();\n}\n\nexport function setArrivalsSearchTerm(term: string) {\n  arrivalsStore.searchTerm = term ?? '';\n  runArrivalsPipeline();\n}\n\nexport function setArrivalsPage(page: number) {\n  const safePage = Number.isFinite(page) && page > 0 ? Math.floor(page) : 1;\n  arrivalsStore.pagination = { ...arrivalsStore.pagination, page: safePage };\n  runArrivalsPipeline();\n}\n\nexport function setArrivalsPageSize(pageSize: number) {\n  if (!Number.isFinite(pageSize) || pageSize <= 0) {\n    return;\n  }\n  arrivalsStore.pagination = { ...arrivalsStore.pagination, pageSize: Math.floor(pageSize), page: 1 };\n  runArrivalsPipeline();\n}\n\nexport function setArrivalsReferenceDate(date: string | Date) {\n  arrivalsStore.today = formatDateInput(date ?? new Date());\n  runArrivalsPipeline();\n}\n\nfunction runArrivalsPipeline() {\n  const bookingsForToday = getBookingsForDate(arrivalsStore.bookings, arrivalsStore.today);\n  const searchedBookings = filterBookingsBySearch(bookingsForToday, arrivalsStore.searchTerm);\n\n  const total = searchedBookings.length;\n  const { pageSize } = arrivalsStore.pagination;\n  const totalPages = total === 0 ? 1 : Math.ceil(total / pageSize);\n  const safePage = clamp(arrivalsStore.pagination.page, 1, totalPages);\n  const start = (safePage - 1) * pageSize;\n  const paginated = searchedBookings.slice(start, start + pageSize);\n\n  arrivalsStore.filteredBookings = searchedBookings;\n  arrivalsStore.pagination = { ...arrivalsStore.pagination, total, totalPages, page: safePage };\n  arrivalsStore.paginatedBookings = paginated;\n\n  const split = splitBookingsByStatus(paginated);\n  arrivalsStore.needsCheckInBookings = split.needsCheckIn;\n  arrivalsStore.inHouseBookings = split.inHouse;\n}\n\nfunction getBookingsForDate(bookings: Booking[], date: string) {\n  if (!date) {\n    return [];\n  }\n  return bookings\n    .map(booking => {\n      const roomsForToday = (booking.rooms ?? []).filter(room => normalizeDate(room.from_date) === date);\n      if (!roomsForToday.length) {\n        return null;\n      }\n      return { ...booking, rooms: roomsForToday };\n    })\n    .filter((booking): booking is Booking => Boolean(booking));\n}\n\nfunction filterBookingsBySearch(bookings: Booking[], term: string) {\n  const normalizedTerm = term?.trim().toLowerCase();\n  if (!normalizedTerm) {\n    return bookings;\n  }\n  return bookings.filter(booking => matchesSearchTerm(booking, normalizedTerm));\n}\n\nfunction matchesSearchTerm(booking: Booking, term: string) {\n  if (!term) {\n    return true;\n  }\n  const bookingNumber = booking.booking_nbr?.toLowerCase() ?? '';\n  if (bookingNumber.includes(term)) {\n    return true;\n  }\n  if (buildName(booking.guest).includes(term)) {\n    return true;\n  }\n  return (booking.rooms ?? []).some(room => buildName(room.guest).includes(term));\n}\n\nfunction splitBookingsByStatus(bookings: Booking[]) {\n  return bookings.reduce(\n    (acc, booking) => {\n      const rooms = booking.rooms ?? [];\n      const needsCheckInRooms = rooms.filter(room => isNeedsCheckIn(room));\n      if (needsCheckInRooms.length) {\n        acc.needsCheckIn.push({ ...booking, rooms: needsCheckInRooms });\n      }\n      const inHouseRooms = rooms.filter(room => isInHouse(room));\n      if (inHouseRooms.length) {\n        acc.inHouse.push({ ...booking, rooms: inHouseRooms });\n      }\n      return acc;\n    },\n    { needsCheckIn: [] as Booking[], inHouse: [] as Booking[] },\n  );\n}\n\nfunction isNeedsCheckIn(room: Room) {\n  const code = room.in_out?.code ?? '';\n  return code === '000';\n}\n\nfunction isInHouse(room: Room) {\n  return room.in_out?.code === '001';\n}\n\nfunction buildName(person?: { first_name?: string | null; last_name?: string | null } | null) {\n  const full = `${person?.first_name ?? ''} ${person?.last_name ?? ''}`.trim();\n  return full.toLowerCase();\n}\n\nfunction getTodayString() {\n  return formatDateInput(new Date());\n}\n\nfunction formatDateInput(value: string | Date) {\n  if (value instanceof Date) {\n    const year = value.getFullYear();\n    const month = `${value.getMonth() + 1}`.padStart(2, '0');\n    const day = `${value.getDate()}`.padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  }\n  return normalizeDate(value);\n}\n\nfunction normalizeDate(value?: string | null) {\n  if (!value) {\n    return '';\n  }\n  return value.slice(0, 10);\n}\n\nfunction clamp(value: number, min: number, max: number) {\n  return Math.min(Math.max(value, min), max);\n}\n\ninitializeArrivalsStore();\n"],"mappings":"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","ignoreList":[]}