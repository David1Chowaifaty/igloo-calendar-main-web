import{h as n}from"./p-6c4ba7c0.js";import{j as t,i as o}from"./p-e1644f24.js";import{a as e}from"./p-bf44a732.js";import{l as s}from"./p-4e493fea.js";import{c as a}from"./p-c5894a47.js";import{c}from"./p-99cb260a.js";const r={days:[],months:[],fromDate:"",toDate:"",disabled_cells:new Map,cleaningTasks:new Map};const{state:_,onChange:E}=a(r);function T(n){const t=new Map;for(const o of n){const n=new Map(t.get(o.unit.id)??new Map);n.set(o.date,o);t.set(o.unit.id,n)}_.cleaningTasks=new Map(t)}function i({unitId:n,date:t}){const o=new Map(_.cleaningTasks);if(!o.has(n)){return}const e=new Map(o.get(n));e.delete(t);o.set(n,e);_.cleaningTasks=new Map(o)}function f({unitId:n,date:t,task:o}){const e=new Map(_.cleaningTasks);const s=new Map(e.get(n)??new Map);s.set(t,o??t);e.set(n,s);_.cleaningTasks=new Map(e)}function O(n){if(!n){return}const t=new Map;const o=new Map;for(const e of n){if(!e?.identifier)continue;const n=e.identifier;const s=e.parent_room_identifier??null;t.set(n,s);if(s){if(!o.has(s))o.set(s,[]);o.get(s).push(n)}else{if(!o.has(n))o.set(n,[])}}const e=new Map(n.map((n=>[n.identifier,n])));for(const[n,t]of o){t.sort(((n,t)=>{const o=e.get(n)?.from_date??"";const s=e.get(t)?.from_date??"";if(o<s)return-1;if(o>s)return 1;return n.localeCompare(t)}))}const s=[];for(const n of t.keys()){const o=t.get(n);if(!o||!t.has(o))s.push(n)}const a=new Map;const c=new Map;const r=n=>{const t=[];const e=new Set;let s=n;while(s&&!e.has(s)){e.add(s);t.push(s);const n=o.get(s)??[];s=n[0]}for(let n=0;n<t.length;n++){const o=t[n];const e=n>0;const s=n<t.length-1;const r=e&&s?"fullSplit":e?"leftSplit":s?"rightSplit":null;a.set(o,r);c.set(o,t)}};for(const n of s)r(n);for(const n of t.keys()){if(!c.has(n))r(n)}return{parentOf:t,childrenOf:o,roleOf:a,chainOf:c,heads:s}}function D(n,t){return n.roleOf.get(t)??null}async function u(n){if(!n?.length){return[]}const t=await Y();const o=new Map(t.map((n=>[n.code,n.value])));const e=new Map;for(const t of n){for(const n of t.days){for(const t of n.room_types){A(t.physicalrooms,e,o)}}}return Array.from(e.values())}function A(n,t,o){if(!n?.length){return}for(const e of n){const n=e?.calendar_cell?Object.values(e.calendar_cell):[];for(const e of n){if(e?.Is_Available===false){d(e,t,o)}}}}const R={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const M={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function l(n,t){if(n===null&&t===null||!n)return"";if(!!t){return`${n??""} ${t??""}`}return n}async function Y(){try{const{data:n}=await e.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return n.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}catch(n){console.log(n);return[]}}function N(t,o,e){const a=new Date(t);a.setHours(o);a.setMinutes(e);return`${s.entries.Lcz_BlockedTill} ${n(a).format("MMM DD, HH:mm")}`}function S(e,s){if(o(e.STAY_STATUS_CODE)){const o=n(e.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(e.DATE)?e.My_Block_Info.from_date:e.DATE;const a=n(e.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(e.DATE)?e.My_Block_Info.to_date:e.DATE;return{ID:e.POOL,NOTES:"",BALANCE:"",NAME:e.My_Block_Info.NOTES!==""&&e.My_Block_Info.NOTES!==null?e.My_Block_Info.NOTES:e.STAY_STATUS_CODE==="003"?N(e.My_Block_Info.BLOCKED_TILL_DATE,e.My_Block_Info.BLOCKED_TILL_HOUR,e.My_Block_Info.BLOCKED_TILL_MINUTE):s.get(e.STAY_STATUS_CODE)||"",RELEASE_AFTER_HOURS:e.My_Block_Info.DESCRIPTION,PR_ID:e.My_Block_Info.pr_id,ENTRY_DATE:e.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:e.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:e.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:e.My_Block_Info.NOTES,FROM_DATE:o,TO_DATE:a,NO_OF_DAYS:t(o,a),STATUS:R[e.STAY_STATUS_CODE],POOL:e.POOL,STATUS_CODE:e.STAY_STATUS_CODE,OUT_OF_SERVICE:e.STAY_STATUS_CODE==="004",FROM_DATE_STR:e.My_Block_Info.format.from_date,TO_DATE_STR:e.My_Block_Info.format.to_date,defaultDates:{from_date:e.My_Block_Info.from_date,to_date:e.My_Block_Info.to_date}}}try{const o=n(e.room.from_date,"YYYY-MM-DD").isAfter(e.DATE)?e.room.from_date:e.DATE;const s=n(e.room.to_date,"YYYY-MM-DD").isAfter(e.DATE)?e.room.to_date:e.DATE;const a=e.room.sharing_persons?.find((n=>n.is_main));return{ID:e.POOL,FROM_DATE:o,TO_DATE:s,NO_OF_DAYS:t(o,s),STATUS:M[e.booking?.status.code],NAME:l(a?.first_name,a?.last_name)||l(e?.booking.guest?.first_name,e?.booking?.guest?.last_name),IDENTIFIER:e.room.identifier,PR_ID:e.pr_id,POOL:e.POOL,BOOKING_NUMBER:e.booking.booking_nbr,NOTES:e.booking.is_direct?e.booking.remark:null,PRIVATE_NOTE:p(e.booking.extras),is_direct:e.booking.is_direct,BALANCE:e.booking.financial?.due_amount,channel_booking_nbr:e.booking.channel_booking_nbr,ARRIVAL_TIME:e.booking.arrival.description,defaultDates:{from_date:e.room.from_date,to_date:e.room.to_date},DEPARTURE_TIME:e.room.departure_time,ENTRY_DATE:e.booking.booked_on.date,PHONE_PREFIX:e.booking.guest.country_phone_prefix,IS_EDITABLE:e.booking.is_editable,ARRIVAL:e.booking.arrival,PHONE:e.booking.guest.mobile_without_prefix??"",RATE:e.room.total,RATE_PLAN:e.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:e.room.rateplan.id,RATE_TYPE:e.room?.roomtype?.id,ADULTS_COUNT:e.room.occupancy.adult_nbr,CHILDREN_COUNT:e.room.occupancy.children_nbr,origin:e.booking.origin,GUEST:e.booking.guest,ROOMS:e.booking.rooms,cancelation:e.room.rateplan.cancelation,guarantee:e.room.rateplan.guarantee,TOTAL_PRICE:e.booking.financial?.gross_total,COUNTRY:e.booking.guest.country_id,FROM_DATE_STR:e.booking.format.from_date,TO_DATE_STR:e.booking.format.to_date,adult_child_offering:e.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:e.booking.source.code,description:e.booking.source.description,tag:e.booking.source.tag},CHECKIN:e.room.in_out?.code==="001",CHECKOUT:e.room.in_out?.code==="002",ROOM_INFO:{occupancy:e.room.occupancy,sharing_persons:e.room.sharing_persons,unit:e.room.unit,in_out:e.room.in_out,calendar_extra:e.room.calendar_extra?JSON.parse(e.room.calendar_extra):null,parent_room_identifier:e.room.parent_room_identifier},BASE_STATUS_CODE:e.booking.status?.code}}catch(n){console.error(`Something went wrong in cell`);console.log(e);console.error(n)}}function I(t){const{in_out:o,status_code:e,from_date:s,to_date:a}=t;if(c.checkin_enabled){if(o?.code==="001"){return M["000"]}else if(o?.code==="002"){if(!c.is_automatic_check_in_out){const t=n();const o=n(a,"YYYY-MM-DD");const e=n(s,"YYYY-MM-DD");const r=P(t.toDate(),w(c.checkin_checkout_hours?.offset,c.checkin_checkout_hours?.hour));if(t.isSame(o,"days")&&t.isAfter(e,"days")&&r||t.isAfter(o,"days")){return M["003"]}else{return M["002"]}}}return M[e||"001"]}else{const t=n();const o=n(a,"YYYY-MM-DD");const c=n(s,"YYYY-MM-DD");if(e!=="PENDING"){if(c.isSame(t,"day")&&t.hour()>=12){return M["000"]}else if(t.isAfter(c,"day")&&t.isBefore(o,"day")){return M["000"]}else if(o.isSame(t,"day")&&t.hour()<12){return M["000"]}else if(o.isSame(t,"day")&&t.hour()>=12||o.isBefore(t,"day")){return M["003"]}else{return M[e||"001"]}}}}function d(n,t,o){if(!n?.POOL||t.has(n.POOL)){return}const e=S(n,o);if(e){t.set(n.POOL,e)}}function p(n){if(!n){return null}return n.find((n=>n.key==="private_note"))?.value||null}function C(o){let e=[];const s=o.rooms.filter((n=>!!n["assigned_units_pool"]));s.forEach((s=>{const a=n(s.from_date,"YYYY-MM-DD").isAfter(n(_.fromDate,"YYYY-MM-DD"))?s.from_date:_.fromDate;const c=s.to_date;if(n(s.to_date,"YYYY-MM-DD").isBefore(n(_.fromDate,"YYYY-MM-DD"))){return}const r=s.sharing_persons?.find((n=>n.is_main));e.push({CHECKIN:false,CHECKOUT:false,ID:s["assigned_units_pool"],TO_DATE:c,FROM_DATE:a,PRIVATE_NOTE:p(o.extras),NO_OF_DAYS:t(a,c),ARRIVAL:o.arrival,IS_EDITABLE:true,BALANCE:o.financial?.due_amount,STATUS:I({in_out:s.in_out,from_date:s.from_date,to_date:s.to_date,status_code:o.status?.code}),NAME:l(r?.first_name,r.last_name)||l(s.guest.first_name,s.guest.last_name),PHONE:o.guest.mobile_without_prefix??"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:o.guest.country_phone_prefix,RATE:s.total,RATE_PLAN:s.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:s.rateplan.id,IDENTIFIER:s.identifier,RATE_TYPE:s.roomtype.id,ADULTS_COUNT:s.occupancy.adult_nbr,CHILDREN_COUNT:s.occupancy.children_nbr,PR_ID:+s.unit.id,POOL:s["assigned_units_pool"],GUEST:o.guest,ROOMS:o.rooms,BOOKING_NUMBER:o.booking_nbr,cancelation:s.rateplan.cancelation,guarantee:s.rateplan.guarantee,TOTAL_PRICE:o.financial?.gross_total,COUNTRY:o.guest.country_id,FROM_DATE_STR:o.format.from_date,TO_DATE_STR:o.format.to_date,adult_child_offering:s.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:o.arrival.description,origin:o.origin,channel_booking_nbr:o.channel_booking_nbr,is_direct:o.is_direct,NOTES:o.is_direct?o.remark:null,DEPARTURE_TIME:s.departure_time,SOURCE:{code:o.source.code,description:o.source.description,tag:o.source.tag},ota_notes:o.ota_notes,defaultDates:{from_date:s.from_date,to_date:s.to_date},ROOM_INFO:{occupancy:s.occupancy,sharing_persons:s.sharing_persons,unit:s.unit,in_out:s.in_out,parent_room_identifier:s.parent_room_identifier,calendar_extra:s.calendar_extra?JSON.parse(s.calendar_extra):null},BASE_STATUS_CODE:o.status?.code})}));return e}async function U(n){const t=await Y();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""&&n.NOTES!==null?n.NOTES:n.STAY_STATUS_CODE==="003"?N(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):t.find((t=>t.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:L(n.from_date,n.to_date),STATUS:R[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date,defaultDates:{from_date:n.from_date,to_date:n.to_date}}}function L(t,o){const e=n(t,"YYYY-MM-DD").startOf("day");const s=n(o,"YYYY-MM-DD").endOf("day");const a=s.diff(e,"days");return a||1}function P(n,t){return n.getHours()>=t.getHours()&&n.getMinutes()>=t.getMinutes()}function w(n,t){const o=new Date;const e=n*60*60*1e3;const s=new Date(o.getTime()+e);const a=s.getUTCFullYear();const c=s.getUTCMonth();const r=s.getUTCDate();const _=t-n;return new Date(Date.UTC(a,c,r,_))}export{L as a,O as b,_ as c,P as d,w as e,T as f,D as g,l as h,I as i,i as j,f as k,U as l,M as m,p as n,u as o,C as t};
//# sourceMappingURL=p-94f15b90.js.map