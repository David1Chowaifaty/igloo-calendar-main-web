import{r as e,c as t,h as i,H as s}from"./p-acddcbeb.js";import{T as o}from"./p-7fce6661.js";import{l as a}from"./p-e58470d9.js";import{n}from"./p-302d9960.js";import{v as d}from"./p-4ed69de7.js";import"./p-bf44a732.js";import"./p-6c4ba7c0.js";import"./p-2925ded6.js";import"./p-e7d273da.js";import"./p-d6d6fb27.js";const l=".sc-igl-tba-booking-view-h{display:block}.guestTitle.sc-igl-tba-booking-view{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:2px;margin-bottom:5px;margin-top:5px;padding-left:5px;padding-right:5px}.guestTitle.selectedOrder.sc-igl-tba-booking-view{background-color:#f9f9c9}.pointer.sc-igl-tba-booking-view{cursor:pointer}hr.sc-igl-tba-booking-view{margin-top:8px;margin-bottom:0px}.bookingContainer.sc-igl-tba-booking-view{background-color:#ececec}.actionsContainer.sc-igl-tba-booking-view{display:flex;align-items:center;padding:5px !important;width:100%;gap:16px}.room-select.sc-igl-tba-booking-view{flex:1}.selectContainer.sc-igl-tba-booking-view{width:195px;margin-right:8px}.buttonsContainer.sc-igl-tba-booking-view{box-sizing:border-box;display:flex;align-items:center;justify-content:flex-end;padding:0;margin:0;gap:0.5rem}";const r=l;const c=class{constructor(i){e(this,i);this.highlightToBeAssignedBookingEvent=t(this,"highlightToBeAssignedBookingEvent",7);this.openCalendarSidebar=t(this,"openCalendarSidebar",7);this.addToBeAssignedEvent=t(this,"addToBeAssignedEvent",7);this.scrollPageToRoom=t(this,"scrollPageToRoom",7);this.assignRoomEvent=t(this,"assignRoomEvent",7)}calendarData;selectedDate;eventData={};categoriesData={};categoryId;categoryIndex;eventIndex;renderAgain=false;selectedRoom=-1;isLoading=null;highlightSection=false;allRoomsList=[];toBeAssignedService=new o;highlightToBeAssignedBookingEvent;openCalendarSidebar;addToBeAssignedEvent;scrollPageToRoom;assignRoomEvent;componentShouldUpdate(e,t,i){if(i==="selectedDate"&&e!==t){this.highlightSection=false;this.selectedRoom=-1;return true}else if(i==="eventData"&&e!==t){this.selectedRoom=-1;return true}return true}componentWillLoad(){if(this.categoryIndex===0&&this.eventIndex===0){setTimeout((()=>{this.handleHighlightAvailability()}),100)}}highlightBookingEvent(e){let t=e.detail.data;if(t.bookingId!=this.eventData.ID){this.highlightSection=false;this.selectedRoom=-1;this.renderView()}else{this.highlightSection=true;this.renderView()}}onSelectRoom(e){if(e.stopImmediatePropagation){e.stopImmediatePropagation();e.stopPropagation()}this.selectedRoom=parseInt(e.target.value)}async handleAssignUnit(e,t=false){try{e.stopImmediatePropagation();e.stopPropagation();if(this.selectedRoom){this.isLoading=t?"checkin":"default";const e=await this.toBeAssignedService.assignUnit({booking_nbr:this.eventData.BOOKING_NUMBER,identifier:this.eventData.ID,pr_id:this.selectedRoom,check_in:t});const i=e.rooms.find((e=>e.identifier===this.eventData.identifier));console.log("room=>",i);if(i&&t){const{adult_nbr:e,children_nbr:t,infant_nbr:s}=i.occupancy;window.dispatchEvent(new CustomEvent("openCalendarSidebar",{detail:{type:"room-guests",payload:{identifier:this.eventData.ID,bookingNumber:this.eventData.BOOKING_NUMBER,checkin:false,roomName:i.unit?.name??"",sharing_persons:i.sharing_persons,totalGuests:e+t+s}},bubbles:true,composed:true}));console.log("event emitted directly to window ðŸ”¥")}let s={...this.eventData,PR_ID:this.selectedRoom};this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[s]});this.assignRoomEvent.emit({key:"assignRoom",data:s})}}catch(e){console.log(e)}finally{this.isLoading=null}}handleHighlightAvailability(){this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:this.eventData.ID,fromDate:this.eventData.FROM_DATE}});if(!this.selectedDate){return}let e=[];let t=[];e=this.eventData.availableRooms.map((e=>{t.push({calendar_cell:null,id:e.PR_ID,name:e.roomName});return{...e,defaultDateRange:this.eventData.defaultDateRange,identifier:this.eventData.identifier}}));this.allRoomsList=t;this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:e});this.scrollPageToRoom.emit({key:"scrollPageToRoom",id:this.categoryId,refClass:"category_"+this.categoryId});this.renderView()}handleCloseAssignment(e){e.stopImmediatePropagation();e.stopPropagation();this.highlightSection=false;this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:"----"}});this.onSelectRoom({target:{value:""}});this.selectedRoom=-1;this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.renderView()}renderView(){this.renderAgain=!this.renderAgain}canCheckIn(){return n({from_date:this.eventData.FROM_DATE,to_date:this.eventData.TO_DATE})}render(){return i(s,{key:"2257b3407e532570e2fcadec1918e8c5ed72b2c5"},i("div",{key:"fd6e065c0d64f2419827cf77e158b321fa1a4250",class:"bookingContainer",onClick:()=>this.handleHighlightAvailability()},i("div",{key:"d26b1fc06bd4f1a10ad9bfbaacc6280c0d458f7d",class:`guestTitle ${this.highlightSection?"selectedOrder":""} pointer font-small-3`,"data-toggle":"tooltip","data-placement":"top","data-original-title":"Click to assign unit"},`Book# ${this.eventData.BOOKING_NUMBER} - ${this.eventData.NAME}`),i("div",{key:"6b4edd0a01b969f8f84c3b53daf9f07ca94e2457",class:"row m-0 p-0 actionsContainer"},i("select",{key:"50e0620d0372b7bbc17f02229868ede8340af58d",class:"form-control input-sm room-select flex-grow-1",id:d(),onChange:e=>this.onSelectRoom(e)},i("option",{key:"680ddd34c4610e31becc534d3db4a70e4869237d",value:"",selected:this.selectedRoom==-1},a.entries.Lcz_AssignUnit),this.allRoomsList.map((e=>i("option",{value:e.id,selected:this.selectedRoom==e.id},e.name)))),this.highlightSection?i("div",{class:"buttonsContainer bg-red"},i("button",{type:"button",class:"btn btn-secondary btn-sm mx-0",onClick:e=>this.handleCloseAssignment(e)},i("svg",{class:"m-0 p-0",xmlns:"http://www.w3.org/2000/svg",height:"12",width:"9",viewBox:"0 0 384 512"},i("path",{fill:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"})))):null),i("div",{key:"9e235a74d71bc080bb960f82cd3ce1d263086fd0",class:"d-flex align-items-center ",style:{gap:"0.5rem",paddingInline:"5px"}},i("ir-button",{key:"1ec0e47a6de20a67ae7364c2d3217d156f09a5a2",isLoading:this.isLoading==="default",size:"sm",class:"flex-grow-1",text:a.entries.Lcz_Assign,onClickHandler:e=>this.handleAssignUnit(e),btn_disabled:this.selectedRoom===-1}),this.canCheckIn()&&i("ir-button",{key:"4e488cf23a379153c1448a04228c57aa5413fd8a",isLoading:this.isLoading==="checkin",size:"sm",class:"flex-grow-1",text:a.entries.Lcz_AssignedAndChecIn,onClickHandler:e=>this.handleAssignUnit(e,true),btn_disabled:this.selectedRoom===-1})),i("hr",{key:"620438eb33e10050072bfc74603413a5b025ea5e"})))}};c.style=r;export{c as igl_tba_booking_view};
//# sourceMappingURL=p-df70ac51.entry.js.map