import{r as t,c as i,g as o,h as s,H as e}from"./p-d239357b.js";import{v as r}from"./p-4ed69de7.js";const h=".sc-ir-m-combobox-h{position:relative;display:block}.input-wrapper.sc-ir-m-combobox{position:relative;width:100%}.prefix-container.sc-ir-m-combobox,.suffix-container.sc-ir-m-combobox{position:absolute;top:0;bottom:0;display:inline-flex;align-items:center;color:var(--ir-combobox-affix-color, #6c757d);pointer-events:none}.dropdown-item.sc-ir-m-combobox{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.prefix-container.sc-ir-m-combobox{left:0.5rem}.suffix-container.sc-ir-m-combobox{right:0.5rem}.sc-ir-m-combobox-s>[slot='prefix'],.sc-ir-m-combobox-s>[slot='suffix']{display:inline-flex;width:var(--ir-combobox-affix-size, 1rem);height:var(--ir-combobox-affix-size, 1rem)}.has-prefix.sc-ir-m-combobox-h input.form-control.sc-ir-m-combobox{padding-left:calc(0.75rem + var(--ir-combobox-affix-size, 1rem))}.has-suffix.sc-ir-m-combobox-h input.form-control.sc-ir-m-combobox{padding-right:calc(0.75rem + var(--ir-combobox-affix-size, 1rem))}.dropdown.sc-ir-m-combobox{position:absolute;top:100%;left:0;z-index:1000;width:100%}.dropdown-menu.sc-ir-m-combobox{max-height:var(--ir-combobox-height, 200px);overflow-y:auto;min-width:100%;width:var(--ir-combobox-width, 100%) !important;scroll-behavior:smooth}.dropdown-item.loading.sc-ir-m-combobox,.dropdown-item.no-results.sc-ir-m-combobox{color:#6c757d;cursor:default;pointer-events:none}.dropdown-item.sc-ir-m-combobox{padding:0.5rem 1rem !important}.dropdown-item.active.sc-ir-m-combobox,.dropdown-item.sc-ir-m-combobox:active,.dropdown-item.focused.sc-ir-m-combobox{background-color:var(--blue, #1e9ff2) !important;color:white !important}[slot='dropdown-content'].sc-ir-m-combobox .dropdown-item.focused.sc-ir-m-combobox,[slot='dropdown-content'].sc-ir-m-combobox .dropdown-item.active.sc-ir-m-combobox{background-color:#1e9ff2 !important;color:white !important}[slot='dropdown-content'].sc-ir-m-combobox [data-option].focused.sc-ir-m-combobox,[slot='dropdown-content'].sc-ir-m-combobox [data-option].active.sc-ir-m-combobox{background-color:#1e9ff2 !important;color:white !important}";const a=h;const n=class{constructor(o){t(this,o);this.optionChange=i(this,"optionChange",7);this.searchQuery=i(this,"searchQuery",7)}get el(){return o(this)}placeholder;defaultOption;dataMode="static";options=[];debounceDelay=300;loading=false;useSlot=false;isOpen=false;selectedOption;focusedIndex=-1;filteredOptions=[];slotElements=[];hasPrefix=false;hasSuffix=false;itemChildren=[];optionChange;searchQuery;async selectOptionFromSlot(t){this.selectOption(t)}inputRef;dropdownRef;id=r();dropdownId=`dropdown-${this.id}`;debounceTimeout;prefixSlotRef;suffixSlotRef;mo=null;get isCompositionMode(){return this.itemChildren.length>0}watchOptionsChanged(t){this.filteredOptions=t||[];if(this.useSlot){this.updateSlotElements()}}watchDefaultValueChanged(t){if(t!==this.selectedOption.value){this.applyDefaultOption()}}watchUseSlotChanged(){if(this.useSlot){setTimeout((()=>this.updateSlotElements()),0)}}componentWillLoad(){this.initializeOptions();this.collectItemChildren();this.mo=new MutationObserver((()=>this.collectItemChildren()));this.mo.observe(this.el,{childList:true,subtree:true})}componentDidLoad(){document.addEventListener("click",this.handleDocumentClick.bind(this));if(this.useSlot){setTimeout((()=>this.updateSlotElements()),0)}setTimeout((()=>this.updateAffixPresence()),0);setTimeout((()=>{this.applyDefaultOption()}),0);this.prefixSlotRef?.addEventListener("slotchange",this.updateAffixPresence);this.suffixSlotRef?.addEventListener("slotchange",this.updateAffixPresence)}disconnectedCallback(){document.removeEventListener("click",this.handleDocumentClick.bind(this));if(this.debounceTimeout)clearTimeout(this.debounceTimeout);this.prefixSlotRef?.removeEventListener("slotchange",this.updateAffixPresence);this.suffixSlotRef?.removeEventListener("slotchange",this.updateAffixPresence);this.mo?.disconnect()}handleDocumentKeyDown(t){if(!this.isOpen)return;if(t.key==="Escape"){this.closeDropdown();this.inputRef?.focus()}}handleComboboxItemSelect(t){t.stopPropagation();console.log(t.detail);this.selectOption(t.detail)}handleComboboxItemRegister(){this.collectItemChildren()}handleComboboxItemUnregister(){this.collectItemChildren()}applyDefaultOption(){if(!this.defaultOption||!Array.isArray(this.options))return;const t=this.options.find((t=>t.value===this.defaultOption));if(t)this.selectedOption={...t}}initializeOptions(){this.filteredOptions=this.options.length>0?this.options:[]}handleDocumentClick=t=>{if(!this.el.contains(t.target)){this.closeDropdown()}};openDropdown(){this.isOpen=true;if(this.isCompositionMode||this.useSlot){this.focusedIndex=-1;setTimeout((()=>this.isCompositionMode?this.updateSlotElementsForItems():this.updateSlotElements()),0)}else{this.focusedIndex=this.selectedOption?this.filteredOptions.findIndex((t=>t.value===this.selectedOption.value)):-1}}emitSearchQuery(t){if(this.debounceTimeout){clearTimeout(this.debounceTimeout)}this.debounceTimeout=setTimeout((()=>{this.searchQuery.emit(t)}),this.debounceDelay)}closeDropdown(){this.isOpen=false;this.focusedIndex=-1;this.removeSlotFocus()}updateSlotElements(){if(!this.useSlot||!this.dropdownRef)return;const t=this.dropdownRef.querySelector('slot[name="dropdown-content"]');if(t){const i=t.assignedElements?t.assignedElements():Array.from(this.el.querySelectorAll('[slot="dropdown-content"] [data-option]'));this.slotElements=i.length>0?i:Array.from(this.dropdownRef.querySelectorAll('[data-option], .dropdown-item[style*="cursor"]'));this.slotElements.forEach(((t,i)=>{t.setAttribute("data-slot-index",i.toString());t.setAttribute("role","option");t.setAttribute("tabindex","-1")}))}}updateAffixPresence=()=>{try{const t=this.prefixSlotRef&&this.prefixSlotRef.assignedElements?this.prefixSlotRef.assignedElements():Array.from(this.el.querySelectorAll('[slot="prefix"]'));const i=this.suffixSlotRef&&this.suffixSlotRef.assignedElements?this.suffixSlotRef.assignedElements():Array.from(this.el.querySelectorAll('[slot="suffix"]'));this.hasPrefix=Array.isArray(t)?t.length>0:false;this.hasSuffix=Array.isArray(i)?i.length>0:false}catch(t){const i=this.el.querySelector('[slot="prefix"]');const o=this.el.querySelector('[slot="suffix"]');this.hasPrefix=!!i;this.hasSuffix=!!o}};removeSlotFocus(){this.slotElements.forEach((t=>{t.classList.remove("focused","active");t.removeAttribute("aria-selected")}))}focusSlotElement(t){this.removeSlotFocus();if(t>=0&&t<this.slotElements.length){const i=this.slotElements[t];i.classList.add("focused","active");i.setAttribute("aria-selected","true");i.scrollIntoView({block:"nearest"})}}selectSlotElement(t){if(t>=0&&t<this.slotElements.length){const i=this.slotElements[t];i.click()}}handleKeyDown=t=>{const i=this.useSlot?this.slotElements.length-1:this.filteredOptions.length-1;switch(t.key){case"ArrowDown":t.preventDefault();if(!this.isOpen){this.openDropdown()}else{this.focusedIndex=Math.min(this.focusedIndex+1,i);if(this.useSlot){this.focusSlotElement(this.focusedIndex)}else{this.scrollToFocusedOption()}}break;case"ArrowUp":t.preventDefault();if(this.isOpen){this.focusedIndex=Math.max(this.focusedIndex-1,0);if(this.useSlot){this.focusSlotElement(this.focusedIndex)}else{this.scrollToFocusedOption()}}break;case"Enter":t.preventDefault();if(this.isOpen&&this.focusedIndex>=0){if(this.useSlot){this.selectSlotElement(this.focusedIndex)}else{this.selectOption(this.filteredOptions[this.focusedIndex])}}else if(!this.isOpen){this.openDropdown()}break;case"Escape":t.preventDefault();this.closeDropdown();break;case"Tab":if(this.isOpen){this.closeDropdown()}break}};selectOption(t){this.selectedOption=t;this.optionChange.emit(t);this.closeDropdown();this.inputRef?.focus()}scrollToFocusedOption(){if(this.focusedIndex<0||!this.dropdownRef||this.useSlot)return;const t=this.dropdownRef.querySelector(`#${this.dropdownId}-option-${this.focusedIndex}`);if(t){t.scrollIntoView({block:"nearest"})}}handleInput=t=>{const i=t.target;const o=i.value;if(this.dataMode==="external"&&!this.isCompositionMode){this.emitSearchQuery(o)}else if(this.isCompositionMode){this.filterComposition(o)}else{const t=this.options.length>0?this.options:[];this.filteredOptions=o?t.filter((t=>t.label.toLowerCase().includes(o.toLowerCase()))):t}this.focusedIndex=-1;if(!this.isOpen){this.openDropdown()}};collectItemChildren(){const t=Array.from(this.el.querySelectorAll("ir-m-combobox-item"));this.itemChildren=t;console.log(t);if(this.isCompositionMode){this.useSlot=true;setTimeout((()=>this.updateSlotElementsForItems()),0)}}updateSlotElementsForItems(){this.slotElements=this.itemChildren;this.slotElements.forEach(((t,i)=>{t.setAttribute("data-slot-index",String(i));t.setAttribute("role","option");t.setAttribute("tabindex","-1")}))}async filterComposition(t){const i=await Promise.all(this.itemChildren.map((i=>i.matchesQuery(t))));await Promise.all(this.itemChildren.map(((o,s)=>o.setHidden(t?!i[s]:false))));this.updateSlotElementsForItems()}render(){return s(e,{key:"32e3daf38d83ad00db898c0e52a731904c578afc",class:{"has-prefix":this.hasPrefix,"has-suffix":this.hasSuffix}},s("div",{key:"e4fb387f066fd5b2efb64de2f45214b258e14644",class:"input-wrapper"},s("span",{key:"4f5c8f321e4f1357970b68ad6ab731fad9ff7003",class:"prefix-container","aria-hidden":!this.hasPrefix},s("slot",{key:"72d3bf515d857c48ea5123d02b66e4ff3d210277",name:"prefix",ref:t=>this.prefixSlotRef=t})),s("input",{key:"dcb3acb4f0f3e0c2783195378302eee4b25ed8e2",ref:t=>this.inputRef=t,type:"text",class:"form-control",role:"combobox",id:this.id,value:this.selectedOption?.label||"",placeholder:this.placeholder,"aria-expanded":String(this.isOpen),"aria-autocomplete":"list","aria-controls":this.dropdownId,"data-reference":"parent","aria-haspopup":"listbox","aria-activedescendant":this.focusedIndex>=0?`${this.dropdownId}-option-${this.focusedIndex}`:null,"aria-label":"Combobox","aria-required":true,onKeyDown:this.handleKeyDown,onInput:this.handleInput}),s("span",{key:"b10ec5b85862850611ecb0cbfd3290d886687c5a",class:"suffix-container","aria-hidden":!this.hasSuffix},s("slot",{key:"482b06552e9d8726718f2f13dcdef646ede695c7",name:"suffix",ref:t=>this.suffixSlotRef=t}))),s("div",{key:"056ae80e06aad8510fa0ca224063f7eef8ef112d",class:`dropdown ${this.isOpen?"show":""}`},s("div",{key:"7f9bda6c0e10a6c07db5b5ac233718a18e0e6547",ref:t=>this.dropdownRef=t,class:`dropdown-menu ${this.isOpen?"show":""}`,id:this.dropdownId,role:"listbox","aria-expanded":String(this.isOpen)},this.isCompositionMode?s("slot",null):this.useSlot?s("slot",{name:"dropdown-content"}):[this.loading&&s("div",{class:"dropdown-item loading"},"Loading..."),!this.loading&&this.filteredOptions.length===0&&s("div",{class:"dropdown-item no-results"},"No results found"),!this.loading&&this.filteredOptions.map(((t,i)=>s("button",{id:`${this.dropdownId}-option-${i}`,class:`dropdown-item ${this.focusedIndex===i?"active":""}`,role:"option","aria-selected":this.selectedOption?.value===t.value?"true":"false",onClick:()=>this.selectOption(t),onMouseEnter:()=>this.focusedIndex=i,innerHTML:t.html_content},t.html_content?null:t.label)))])))}static get watchers(){return{options:["watchOptionsChanged"],defaultOption:["watchDefaultValueChanged"],useSlot:["watchUseSlotChanged"]}}};n.style=a;export{n as ir_m_combobox};
//# sourceMappingURL=p-b290312d.entry.js.map