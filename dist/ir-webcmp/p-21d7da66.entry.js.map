{"version":3,"names":["irHkTasksCss","IrHkTasksStyle0","IrHkTasks","this","roomService","RoomService","houseKeepingService","HouseKeepingService","componentWillLoad","baseurl","axios","defaults","baseURL","ticket","setToken","updateHKStore","token","property_id","propertyid","language","initializeApp","handleResetData","e","stopImmediatePropagation","stopPropagation","arrival","arrival_time","housekeeper","unit","status","selectedRoom","executeHKAction","id","code","getExposedHKSetup","ticketChanged","newValue","oldValue","handleCheckChange","action","detail","modalOpenTimeOut","setTimeout","modal","el","querySelector","openModal","handleCloseSidebar","archiveOpened","disconnectedCallback","clearTimeout","getPendingActions","getHKPendingActions","bracket","selectedDuration","selectedHouseKeeper","isLoading","Promise","all","getExposedHKStatusCriteria","fetchData","fetchLanguage","housekeeping_store","hk_tasks","brackets","error","console","handleConfirm","preventDefault","render","h","Host","class","label","locales","entries","Lcz_HousekeepingTasks","justifyContent","slot","text","Lcz_Archive","size","onClickHanlder","selectedValue","onSelectChange","data","map","description","value","showFirstOption","LabelAvailable","housekeepers","name","toString","Lcz_Unit","Lcz_Status","Lcz_Arrivaldate","Lcz_ArrivalTime","Lcz_Housekeeper","Lcz_Done","_a","pending_housekeepers","key","onCheckChange","checked","leftBtnText","Lcz_No","rightBtnText","Lcz_Yes","onConfirmModal","bind","onCancelModal","modalBody"],"sources":["src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.css?tag=ir-hk-tasks&encapsulation=scoped","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n.checkbox-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.table-container {\n  overflow-x: auto;\n  max-width: 100%;\n  width: max-content;\n}\n.table,\nth,\ntd {\n  border-color: white !important;\n}\n\n.select-container {\n  max-width: 500px;\n}\n\n@media only screen and (min-width: 900px) {\n  td {\n    min-width: 140px !important;\n    width: max-content !important;\n  }\n}\n@media only screen and (max-width: 900px) {\n  td {\n    min-width: 100px !important;\n  }\n  .table-container {\n    width: max-content !important;\n  }\n}\n","import { IPendingActions } from '@/models/housekeeping';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport housekeeping_store, { updateHKStore } from '@/stores/housekeeping.store';\nimport locales from '@/stores/locales.store';\nimport { Component, Host, Listen, Prop, State, Watch, h, Element } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-hk-tasks',\n  styleUrl: 'ir-hk-tasks.css',\n  scoped: true,\n})\nexport class IrHkTasks {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() baseurl: string = '';\n  @Prop() propertyid: number;\n\n  @State() isLoading = false;\n  @State() selectedDuration = '';\n  @State() selectedHouseKeeper = '0';\n  @State() selectedRoom: IPendingActions | null = null;\n  @State() archiveOpened = false;\n\n  private modalOpenTimeOut: NodeJS.Timeout;\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n\n  componentWillLoad() {\n    if (this.baseurl) {\n      axios.defaults.baseURL = this.baseurl;\n    }\n    if (this.ticket !== '') {\n      this.roomService.setToken(this.ticket);\n      this.houseKeepingService.setToken(this.ticket);\n      updateHKStore('default_properties', { token: this.ticket, property_id: this.propertyid, language: this.language });\n      this.initializeApp();\n    }\n  }\n\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { arrival, arrival_time, housekeeper, unit, status } = this.selectedRoom;\n    this.houseKeepingService.executeHKAction({\n      property_id: this.propertyid,\n      arrival,\n      arrival_time,\n      housekeeper: {\n        id: housekeeper.id,\n      },\n      status: {\n        code: status.code,\n      },\n      unit: {\n        id: unit.id,\n      },\n    });\n    await this.houseKeepingService.getExposedHKSetup(this.propertyid);\n  }\n\n  @Watch('ticket')\n  async ticketChanged(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.roomService.setToken(this.ticket);\n      this.houseKeepingService.setToken(this.ticket);\n      updateHKStore('default_properties', { token: this.ticket, property_id: this.propertyid, language: this.language });\n      this.initializeApp();\n    }\n  }\n  handleCheckChange(e: CustomEvent, action: IPendingActions) {\n    if (e.detail) {\n      this.selectedRoom = action;\n      this.modalOpenTimeOut = setTimeout(() => {\n        const modal = this.el.querySelector('ir-modal');\n        if (modal) {\n          (modal as HTMLIrModalElement).openModal();\n        }\n      }, 50);\n    }\n  }\n  @Listen('closeSideBar')\n  handleCloseSidebar(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.archiveOpened = false;\n  }\n  disconnectedCallback() {\n    if (this.modalOpenTimeOut) {\n      clearTimeout(this.modalOpenTimeOut);\n    }\n  }\n  async getPendingActions() {\n    await this.houseKeepingService.getHKPendingActions({\n      property_id: this.propertyid,\n      bracket: {\n        code: this.selectedDuration,\n      },\n      housekeeper: {\n        id: +this.selectedHouseKeeper,\n      },\n    });\n  }\n  async initializeApp() {\n    try {\n      this.isLoading = true;\n      await Promise.all([\n        this.houseKeepingService.getExposedHKStatusCriteria(this.propertyid),\n        this.roomService.fetchData(this.propertyid, this.language),\n        this.roomService.fetchLanguage(this.language, ['_HK_FRONT']),\n      ]);\n      this.selectedDuration = housekeeping_store.hk_tasks.brackets[0].code;\n      await this.getPendingActions();\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  async handleConfirm(e: CustomEvent) {\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.getPendingActions();\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.selectedRoom = null;\n    }\n  }\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2\">\n          <ir-title class=\"d-none d-md-flex\" label={locales.entries.Lcz_HousekeepingTasks} justifyContent=\"space-between\">\n            <ir-button slot=\"title-body\" text={locales.entries.Lcz_Archive} size=\"sm\"></ir-button>\n          </ir-title>\n          <div class=\"d-flex align-items-center mb-2 justify-content-between d-md-none\">\n            <ir-title class=\"mb-0\" label={locales.entries.Lcz_HousekeepingTasks} justifyContent=\"space-between\"></ir-title>\n            <ir-button slot=\"title-body\" text={locales.entries.Lcz_Archive} size=\"sm\" onClickHanlder={() => (this.archiveOpened = true)}></ir-button>\n          </div>\n          <div class=\"d-flex flex-column flex-sm-row align-items-center mb-1  select-container\">\n            <ir-select\n              selectedValue={this.selectedDuration}\n              onSelectChange={e => {\n                this.selectedDuration = e.detail;\n                this.getPendingActions();\n              }}\n              data={housekeeping_store.hk_tasks.brackets.map(bracket => ({\n                text: bracket.description,\n                value: bracket.code,\n              }))}\n              class=\"mb-1 w-100 mb-sm-0\"\n              showFirstOption={false}\n              LabelAvailable={false}\n            ></ir-select>\n            <ir-select\n              onSelectChange={e => {\n                this.selectedHouseKeeper = e.detail;\n                this.getPendingActions();\n              }}\n              selectedValue={this.selectedHouseKeeper}\n              data={[\n                { text: 'All housekeepers', value: '0' },\n                ...housekeeping_store.hk_tasks.housekeepers.map(bracket => ({\n                  text: bracket.name,\n                  value: bracket.id.toString(),\n                })),\n              ]}\n              showFirstOption={false}\n              LabelAvailable={false}\n              class=\"ml-sm-2 w-100\"\n            ></ir-select>\n          </div>\n          <div class=\"card p-1\">\n            <div class=\"table-container\">\n              <table class=\"table\">\n                <thead>\n                  <tr>\n                    <th class=\"text-left\">{locales.entries.Lcz_Unit}</th>\n                    <th class=\"text-left\">{locales.entries.Lcz_Status}</th>\n                    <th class=\"text-left\">{locales.entries.Lcz_Arrivaldate}</th>\n                    <th class=\"text-left\">{locales.entries.Lcz_ArrivalTime}</th>\n                    <th class=\"text-left\">{locales.entries.Lcz_Housekeeper}</th>\n                    <th class=\"text-center\">{locales.entries.Lcz_Done}</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {housekeeping_store.pending_housekeepers?.map(action => (\n                    <tr key={action.housekeeper.id}>\n                      <td class=\"text-left\">{action.unit.name}</td>\n                      <td class=\"text-left\">{action.status.description}</td>\n                      <td class=\"text-left\">{action.arrival}</td>\n                      <td class=\"text-left\">{action.arrival_time}</td>\n                      <td class=\"text-left\">{action.housekeeper.name}</td>\n                      <td>\n                        <div class=\"checkbox-container\">\n                          <ir-checkbox onCheckChange={e => this.handleCheckChange(e, action)} checked={this.selectedRoom?.unit.id === action.unit.id}></ir-checkbox>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </section>\n        {this.selectedRoom && (\n          <ir-modal\n            leftBtnText={locales.entries.Lcz_No}\n            rightBtnText={locales.entries.Lcz_Yes}\n            onConfirmModal={this.handleConfirm.bind(this)}\n            onCancelModal={() => (this.selectedRoom = null)}\n            modalBody={`Is ${this.selectedRoom.unit.name} cleaned?`}\n          ></ir-modal>\n        )}\n        {/* <ir-sidebar open={this.archiveOpened} showCloseButton={false} onIrSidebarToggle={() => (this.archiveOpened = false)}>\n          {this.archiveOpened && <ir-hk-archive slot=\"sidebar-body\"></ir-hk-archive>}\n        </ir-sidebar> */}\n      </Host>\n    );\n  }\n}\n"],"mappings":"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"}