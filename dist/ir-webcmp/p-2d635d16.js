import{a as t}from"./p-06203439.js";import{e as r,q as e,s as o,d as n}from"./p-32d0e309.js";import{e as a}from"./p-0e9d12af.js";var s=undefined&&undefined.__rest||function(t,r){var e={};for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&r.indexOf(o)<0)e[o]=t[o];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var n=0,o=Object.getOwnPropertySymbols(t);n<o.length;n++){if(r.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n]))e[o[n]]=t[o[n]]}return e};class c{async getCalendarData(n,s,c){try{const{data:i}=await t.post(`/Get_Exposed_Calendar`,{propertyid:n,from_date:s,to_date:c,extras:r});if(i.ExceptionMsg!==""){throw new Error(i.ExceptionMsg)}const l=i.My_Result.months;const _=[];const u=await a(l);const d=l.map((t=>{_.push({daysCount:t.days.length,monthName:t.description});return t.days.map((r=>({day:e(r.description,t.description),currentDate:o(r.description,t.description),dayDisplayName:r.description,rate:r.room_types,unassigned_units_nbr:r.unassigned_units_nbr,occupancy:r.occupancy})))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:n,FROM:i.My_Params_Get_Exposed_Calendar.from_date,TO:i.My_Params_Get_Exposed_Calendar.to_date},days:d,months:_,myBookings:u,defaultMonths:l})}catch(t){console.error(t)}}async fetchGuest(r){try{const{data:e}=await t.post(`/Get_Exposed_Guest`,{email:r});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(t){console.log(t);throw new Error(t)}}async fetchPMSLogs(r){try{const{data:e}=await t.post(`/Get_Exposed_PMS_Logs`,{booking_nbr:r});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(t){console.log(t);throw new Error(t)}}async editExposedGuest(r,e){try{const{data:o}=await t.post(`/Edit_Exposed_Guest`,Object.assign(Object.assign({},r),{book_nbr:e}));if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}catch(t){console.log(t);throw new Error(t)}}async getBookingAvailability(r){try{const{adultChildCount:e,currency:o}=r,n=s(r,["adultChildCount","currency"]);const{data:a}=await t.post(`/Get_Exposed_Booking_Availability`,Object.assign(Object.assign({},n),{adult_nbr:e.adult,child_nbr:e.child,currency_ref:o.code,is_backend:true}));if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async getCountries(r){try{const{data:e}=await t.post(`/Get_Exposed_Countries`,{language:r});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(t){console.error(t);throw new Error(t)}}async fetchSetupEntries(){try{const{data:r}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}const e=r.My_Result;return{arrivalTime:e.filter((t=>t.TBL_NAME==="_ARRIVAL_TIME")),ratePricingMode:e.filter((t=>t.TBL_NAME==="_RATE_PRICING_MODE")),bedPreferenceType:e.filter((t=>t.TBL_NAME==="_BED_PREFERENCE_TYPE"))}}catch(t){console.error(t);throw new Error(t)}}async getBlockedInfo(){try{const{data:r}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:["_CALENDAR_BLOCKED_TILL"]});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.error(t);throw new Error(t)}}async getUserDefaultCountry(){try{const{data:r}=await t.post(`/Get_Country_By_IP`,{IP:""});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async blockUnit(r){try{const{data:e}=await t.post(`/Block_Exposed_Unit`,r);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}console.log(e);return e["My_Params_Block_Exposed_Unit"]}catch(t){console.error(t);throw new Error(t)}}async getUserInfo(r){try{const{data:e}=await t.post(`/GET_EXPOSED_GUEST`,{email:r});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(t){console.error(t);throw new Error(t)}}async getExposedBooking(e,o,n=true){try{const{data:a}=await t.post(`/Get_Exposed_Booking`,{booking_nbr:e,language:o,extras:n?r:null});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a.My_Result}catch(t){console.error(t)}}generateDays(t,r,e){const o=new Date(t);const n=new Date(r);const a=[];while(o<n){a.push({date:o.toISOString().split("T")[0],amount:e,cost:null});o.setDate(o.getDate()+1)}return a}calculateTotalRate(t,r,e,o){if(e&&o===2){return+t}return+t/+r}async fetchExposedGuest(r,e){try{const{data:o}=await t.post(`/Fetch_Exposed_Guests`,{email:r,property_id:e});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async fetchExposedBookings(r,e,o,n){try{const{data:a}=await t.post(`/Fetch_Exposed_Bookings`,{booking_nbr:r,property_id:e,from_date:o,to_date:n});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async getPCICardInfoURL(r){try{const{data:e}=await t.post(`/Get_PCI_Card_Info_URL`,{BOOK_NBR:r});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async doReservation(e){const{data:o}=await t.post(`/DoReservation`,Object.assign(Object.assign({},e),{extras:e.extras?e.extras:r}));if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}console.log(o["My_Result"]);return o["My_Result"]}async bookUser({bookedByInfoData:t,check_in:r,currency:e,extras:o=null,fromDate:a,guestData:s,pickup_info:c,propertyid:i,rooms:l,source:_,toDate:u,totalNights:d,arrivalTime:w,bookingNumber:y,defaultGuest:E,identifier:h,pr_id:f}){try{const p=n(a);const b=n(u);let m={email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.contactNumber===null?"":t.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:t.emailGuest||false,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null};if(E){m=Object.assign(Object.assign({},E),{email:E.email===""?null:E.email})}if(t.id){m=Object.assign(Object.assign({},m),{id:t.id})}const g={assign_units:true,check_in:r,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:o,booking:{booking_nbr:y||"",from_date:p,to_date:b,remark:t.message||null,property:{id:i},source:_,currency:e,arrival:{code:w?w:t.selectedArrivalTime},guest:m,rooms:[...s.map((t=>({identifier:h||null,roomtype:{id:t.roomCategoryId,name:t.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:t.inventory,rate:t.rate/d},rateplan:{id:t.ratePlanId,name:t.ratePlanName,rate_restrictions:null,variations:null,cancelation:t.cancelation,guarantee:t.guarantee},unit:typeof f==="undefined"&&t.roomId===""?null:{id:+f||+t.roomId},occupancy:{adult_nbr:t.adultCount,children_nbr:t.childrenCount,infant_nbr:null},bed_preference:t.preference,from_date:p,to_date:b,notes:null,days:this.generateDays(p,b,this.calculateTotalRate(t.rate,d,t.isRateModified,t.rateType)),guest:{email:null,first_name:t.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),...l]},pickup_info:c};console.log("book user payload",g);const k=await this.doReservation(g);return k}catch(t){console.error(t);throw new Error(t)}}}export{c as B};
//# sourceMappingURL=p-2d635d16.js.map