{"version":3,"names":["iglBookingEventCss","IglBookingEvent","constructor","hostRef","this","is_vacation_rental","allBookingEvents","renderElement","isShrinking","dayWidth","eventSpace","vertSpace","showInfoPopup","bubbleInfoTopSide","isStreatch","eventsService","EventsService","bookingService","BookingService","resizeSide","isDragging","animationFrameId","handleMouseMoveBind","handleMouseMove","bind","handleMouseUpBind","handleMouseUp","handleClickOutsideBind","handleClickOutside","componentWillLoad","window","addEventListener","fetchAndAssignBookingData","console","log","bookingEvent","BOOKING_NUMBER","validStatuses","includes","STATUS","data","getExposedBooking","filteredRooms","rooms","filter","room","ID","length","Error","some","transformedBooking","transformNewBooking","otherBookingData","__rest","Object","assign","booking","PHONE","PHONE_PREFIX","PRIVATE_NOTE","updateBookingEvent","emit","showEventInfo","error","message","componentDidLoad","isNewEvent","hideBubble","setTimeout","async","STATUS_CODE","renderAgain","disconnectedCallback","removeEventListener","cancelAnimationFrame","event","clickedElement","target","element","contains","hideBubbleInfoPopup","detail","currentInfoBubbleId","getBookingId","key","moveBookingToHandler","bookingId","moveToDay","toRoomId","FROM_DATE","fromRoomId","isTouchStart","moveDiffereneX","moveDiffereneY","isBlockUnit","requestAnimationFrame","resetBookingToInitialPosition","pool","to_date","from_date","checkIfSlotOccupied","reallocateEvent","catch","description","status","getModalDescription","hideConfirmButton","oldFromDate","defaultDates","oldToDate","diffDays","calculateDaysBetweenDates","shrinkingDirection","fromDate","toDate","moment","isAfter","isBefore","newToDate","add","format","subtract","warn","showDialog","reason","title","showRoomNightsDialog","bookingNumber","identifier","IDENTIFIER","toast","position","type","findRoomType","roomId","roomType","roomsInfo","physicalrooms","r","id","is_direct","locales","entries","Lcz_YouWillLoseFutureUpdates","isSame","TO_DATE","initialRT","PR_ID","targetRT","Lcz_AreYouSureWantToMoveAnotherUnit","origin","Label","Lcz_SameRatesWillBeKept","Lcz_CannotChangeCHBookings","Number","toString","Lcz_ConfrmModiication","style","left","initialLeft","width","initialWidth","finalWidth","top","dragInitPos","handleRevertBooking","POOL","fromTime","toTime","isOccupied","eventFromTime","eventToTime","isSameOrAfter","getUniqueId","Date","getTime","isSplitBooking","SPLIT_BOOKING","isHighlightEventType","getEventType","getBookingStatus","getBookedBy","NAME","getBookedRoomId","getEventStartingDate","getEventEndingDate","event_type","getEventLegend","_a","legendData","statusId","orderRide","color","_b","getLegendOfStatus","aStatusId","getNoteNode","NOTES","INTERNAL_NOTE","getBalanceNode","BALANCE","setStayDays","aStayDays","NO_OF_DAYS","getStayDays","getPosition","startingDate","startingCellClass","getDate","getMonth","getFullYear","bodyContainer","document","querySelector","startingCell","pos","height","getBoundingClientRect","bodyContainerRect","boundingRect","getNumber","aData","parseFloat","startDragging","side","preventDefault","stopPropagation","stopImmediatePropagation","initialX","clientX","touches","initialY","clientY","elementRect","offsetX","offsetY","x","y","dragEndPos","dragOverEventData","offsetWidth","offsetLeft","currentX","distanceX","currentY","distanceY","newWidth","Math","min","max","newLeft","abs","nbOfDays","numberOfDays","round","initialStayDays","isNaN","replace","offset","updateData","updateEventData","calculateHoverPosition","barRect","barWidth","barLeft","screenWidth","innerWidth","hoverLeft","transform","renderEventBookingNumber","channel_booking_nbr","showInfo","midPoint","hideBubbleInfo","render","legend","noteNode","balanceNode","h","Host","class","clsName","backgroundColor","onTouchStart","onMouseDown","Fragment","countries","currency","bubbleInfoTop","iglBookingEventHoverCss","IglBookingEventHover","shouldHideUnassignUnit","eventService","hideButtons","selectedRt","find","RATE_TYPE","canCheckInOrCheckout","handleKeyDown","handleBookingEventChange","newValue","oldValue","getTotalOccupants","CHILDREN_COUNT","ADULTS_COUNT","Lcz_AdultsCaption","toLowerCase","Lcz_Single_Adult","Lcz_ChildCaption","_c","Lcz_Single_Child","getPhoneNumber","getCountry","findCountry","COUNTRY","name","getPhoneCode","phone_prefix","renderPhone","getInternalNote","getTotalPrice","TOTAL_PRICE","getArrivalTime","ARRIVAL_TIME","getRatePlan","RATE_PLAN","getEntryDate","ENTRY_DATE","isNewBooking","isCheckedIn","isBlockedDateEvent","hasSplitBooking","hasOwnProperty","splitBookingEvents","canCheckIn","canCheckOut","calendar_data","checkin_enabled","is_automatic_check_in_out","now","ROOM_INFO","in_out","code","compareTime","createDateWithOffsetAndHour","checkin_checkout_hours","_d","hour","handleBlockDateUpdate","opt","handleEditBooking","TITLE","Lcz_EditBookingFor","handleBookingOption","getStringDateFormat","dt","handleAddRoom","setHours","from_date_str","to_date_str","eventData","ARRIVAL","ADD_ROOM_TO_BOOKING","ROOMS","GUEST","SOURCE","defaultDateRange","fromDateStr","toDateStr","dateDifference","editabled","handleCustomerCheckIn","adult_nbr","children_nbr","infant_nbr","occupancy","roomIdentifier","roomName","roomUnit","sidebarPayload","checkin","unit","sharing_persons","totalGuests","handleCustomerCheckOut","handleDeleteEvent","deleteButton","handleUpdateBlockedDates","isLoading","updateBlockedEvent","handleConvertBlockedDateToBooking","getRoomInfo","roomIdToFind","selectedRoom","physicalRoom","CATEGORY","ROOM_NAME","ROOMS_INFO","renderTitle","eventType","roomInfo","Lcz_AddingUnitToBooking","Lcz_Adding","Lcz_NewBookingFor","roomData","RELEASE_AFTER_HOURS","OPTIONAL_REASON","ENTRY_MINUTE","ENTRY_HOUR","block_exposed_unit_props","pr_id","STAY_STATUS_CODE","DESCRIPTION","BLOCKED_TILL_DATE","BLOCKED_TILL_HOUR","BLOCKED_TILL_MINUTE","showBookingPopup","getInfoElement","src","Icon","alt","formatAmount","symbol","Lcz_Balance","showDateDifference","containerStyle","padding","margin","labelText","Lcz_ArrivalTime","content","Lcz_Occupancy","Lcz_Phone","Lcz_RatePlan","Lcz_BookingPrivateNote","display","Lcz_GuestRemark","label","Lcz_ChannelNotes","remarks","ota_notes","maxVisibleItems","_e","Lcz_InternalRemark","gap","role","onClickHandler","btn_block","text","Lcz_Edit","icon_name","btn_styles","size","IS_EDITABLE","Lcz_AddRoom","Lcz_CheckIn","Lcz_CheckOut","Lcz_Unassign","_","getNewBookingOptions","shouldDisplayButtons","rateplans","rate","is_active","Lcz_CreateNewBooking","Lcz_AssignUnitToExistingBooking","Lcz_NoRatePlanDefined","Lcz_Blockdates","getBlockedView","isEventHover","entryHour","entryMinute","defaultData","entryDate","onDataUpdateEvent","btn_disabled","Lcz_Update","Lcz_ConvertToBooking","btn_color","Lcz_Delete","irInteractiveTitleCss","IrInteractiveTitle","irPopoverLeft","cropSize","croppedTitle","popoverTitle","initializePopover","titleElement","el","isOverflowing","scrollWidth","slice","croppedTitleEl","innerHTML","$","popover","trigger","placement","whiteSpace","overflow","textOverflow","ref","hkStatus","xmlns","viewBox","d"],"sources":["src/components/igloo-calendar/igl-booking-event/igl-booking-event.css?tag=igl-booking-event&encapsulation=scoped","src/components/igloo-calendar/igl-booking-event/igl-booking-event.tsx","src/components/igloo-calendar/igl-booking-event-hover/igl-booking-event-hover.css?tag=igl-booking-event-hover&encapsulation=scoped","src/components/igloo-calendar/igl-booking-event-hover/igl-booking-event-hover.tsx","src/components/ui/ir-interactive-title/ir-interactive-title.css?tag=ir-interactive-title&encapsulation=scoped","src/components/ui/ir-interactive-title/ir-interactive-title.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n  position: absolute;\r\n}\r\n\r\n.bookingEventBase {\r\n  position: absolute;\r\n  background-color: rgb(49, 190, 241);\r\n  width: 100%;\r\n  height: 100%;\r\n  border-radius: 4px;\r\n  transform: skewX(-22deg);\r\n}\r\n\r\n.bookingEventBase.skewedLeft::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0px;\r\n  bottom: 0;\r\n  left: -4px;\r\n  width: 50%;\r\n  height: 100%;\r\n  background-color: var(--ir-event-bg);\r\n  transform-origin: right;\r\n  transform: skewX(22deg);\r\n  border-radius: 4px;\r\n  border-top-left-radius: 0;\r\n  border-bottom-left-radius: 0;\r\n}\r\n.bookingEventBase.skewedRight::before {\r\n  content: '';\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  right: -4px;\r\n  width: 50%;\r\n  height: 100%;\r\n  background-color: var(--ir-event-bg);\r\n  transform-origin: left;\r\n  transform: skewX(22deg);\r\n  border-radius: 4px;\r\n  border-top-right-radius: 0;\r\n  border-bottom-right-radius: 0;\r\n}\r\n.bookingEventBase.border.skewedLeft::before {\r\n  border: 2px solid #424242;\r\n  border-right: 0;\r\n  border-left: 0;\r\n  border-top-right-radius: 0;\r\n  border-bottom-right-radius: 0;\r\n  top: -1px;\r\n  height: 20px;\r\n  left: -4px;\r\n}\r\n.ota-booking-event {\r\n  border-width: 2px !important;\r\n}\r\n.bookingEventBase.border.skewedRight::before {\r\n  border: 2px solid #424242;\r\n  border-left: 0;\r\n  border-right: 0;\r\n  border-top-left-radius: 0;\r\n  border-bottom-left-radius: 0;\r\n  top: -1px;\r\n  height: 20px;\r\n  right: -4px;\r\n}\r\n.bookingEvent {\r\n  cursor: pointer;\r\n}\r\n.bookingEventBase {\r\n  cursor: pointer;\r\n}\r\n.bookingEventHiddenBase {\r\n  position: absolute;\r\n  top: 0;\r\n  left: -4px;\r\n  width: calc(100% + 8);\r\n}\r\n\r\n.bookingEventDragHandle {\r\n  position: absolute;\r\n  top: 0;\r\n  width: 15px;\r\n  height: 100%;\r\n  opacity: 0.1;\r\n  background-color: rgba(0, 0, 0, 0.15);\r\n  transform: skewX(-22deg);\r\n  border-radius: 4px;\r\n  /* display: none; */\r\n  cursor: pointer;\r\n}\r\n\r\n.splitBooking {\r\n  border-right: 2px solid #000000;\r\n}\r\n\r\n:host:hover .bookingEventDragHandle {\r\n  display: block;\r\n  opacity: 1;\r\n}\r\n\r\n:host.newEvent:hover .bookingEventDragHandle {\r\n  display: none;\r\n  opacity: 1;\r\n}\r\n\r\n.leftSide {\r\n  left: 0;\r\n}\r\n.leftSide.skewedLeft {\r\n  transform: skewX(0);\r\n}\r\n.rightSide.skewedRight {\r\n  transform: skewX(0);\r\n}\r\n.rightSide {\r\n  right: 0;\r\n}\r\n\r\n.bookingEventTitle {\r\n  color: #fff;\r\n  font-size: 0.8em;\r\n  position: relative;\r\n  max-width: calc(100% - 10px);\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  top: 2px;\r\n  left: 5px;\r\n  -webkit-user-select: none;\r\n  user-select: none;\r\n  -webkit-user-drag: none;\r\n  cursor: pointer;\r\n}\r\n\r\n.legend_circle {\r\n  border-radius: 100%;\r\n  width: 10px;\r\n  height: 10px;\r\n  margin: 3px 3px 3px 2px;\r\n  border: 1px solid #fff;\r\n}\r\n\r\n.noteIcon {\r\n  position: absolute;\r\n  bottom: -8px;\r\n  left: 2px;\r\n}\r\n\r\n.balanceIcon {\r\n  position: absolute;\r\n  top: -8px;\r\n  right: 2px;\r\n}\r\n","import { Component, Element, Event, EventEmitter, Fragment, Host, Listen, Prop, State, h } from '@stencil/core';\r\nimport { BookingService } from '@/services/booking.service';\r\nimport { calculateDaysBetweenDates, transformNewBooking } from '@/utils/booking';\r\nimport { isBlockUnit } from '@/utils/utils';\r\nimport { IRoomNightsData, CalendarModalEvent } from '@/models/property-types';\r\nimport moment from 'moment';\r\nimport { IToast } from '@components/ui/ir-toast/toast';\r\nimport { EventsService } from '@/services/events.service';\r\nimport locales from '@/stores/locales.store';\r\nimport { ICountry } from '@/models/IBooking';\r\n\r\n@Component({\r\n  tag: 'igl-booking-event',\r\n  styleUrl: 'igl-booking-event.css',\r\n  scoped: true,\r\n})\r\nexport class IglBookingEvent {\r\n  @Element() private element: HTMLElement;\r\n\r\n  @Prop() currency;\r\n  @Prop() is_vacation_rental: boolean = false;\r\n  @Prop() language: string;\r\n  @Prop({ mutable: true }) bookingEvent: { [key: string]: any };\r\n  @Prop() allBookingEvents: { [key: string]: any } = [];\r\n  @Prop() countries: ICountry[];\r\n\r\n  @Event({ bubbles: true, composed: true }) hideBubbleInfo: EventEmitter;\r\n  @Event() updateEventData: EventEmitter;\r\n  @Event() dragOverEventData: EventEmitter;\r\n  @Event() showRoomNightsDialog: EventEmitter<IRoomNightsData>;\r\n  @Event() showDialog: EventEmitter<CalendarModalEvent>;\r\n  @Event() resetStreachedBooking: EventEmitter<string>;\r\n  @Event() toast: EventEmitter<IToast>;\r\n  @Event() updateBookingEvent: EventEmitter<{ [key: string]: any }>;\r\n\r\n  @State() renderElement: boolean = false;\r\n  @State() position: { [key: string]: any };\r\n  @State() isShrinking: boolean | null = null;\r\n\r\n  dayWidth: number = 0;\r\n  eventSpace: number = 8;\r\n\r\n  vertSpace: number = 10;\r\n\r\n  /* show bubble */\r\n  private showInfoPopup: boolean = false;\r\n  private bubbleInfoTopSide: boolean = false;\r\n  private isStreatch = false;\r\n  /*Services */\r\n  private eventsService = new EventsService();\r\n  private bookingService = new BookingService();\r\n  /* Resize props */\r\n  resizeSide: string = '';\r\n  isDragging: boolean = false;\r\n  initialX: number;\r\n  initialY: number;\r\n  currentX: number;\r\n  currentY: number;\r\n  initialWidth: number;\r\n  initialLeft: number;\r\n  finalWidth: number;\r\n  dragInitPos: { [key: string]: any };\r\n  dragEndPos: { [key: string]: any };\r\n  elementRect: { [key: string]: any };\r\n  isTouchStart: boolean;\r\n  moveDiffereneX: number;\r\n  moveDiffereneY: number;\r\n  private animationFrameId: number | null = null;\r\n\r\n  handleMouseMoveBind = this.handleMouseMove.bind(this);\r\n  handleMouseUpBind = this.handleMouseUp.bind(this);\r\n  handleClickOutsideBind = this.handleClickOutside.bind(this);\r\n\r\n  componentWillLoad() {\r\n    window.addEventListener('click', this.handleClickOutsideBind);\r\n  }\r\n\r\n  async fetchAndAssignBookingData() {\r\n    try {\r\n      console.log('clicked on book#', this.bookingEvent.BOOKING_NUMBER);\r\n\r\n      const validStatuses = ['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'];\r\n      if (!validStatuses.includes(this.bookingEvent.STATUS)) {\r\n        return;\r\n      }\r\n\r\n      const data = await this.bookingService.getExposedBooking(this.bookingEvent.BOOKING_NUMBER, 'en');\r\n      const filteredRooms = data.rooms.filter(room => room['assigned_units_pool'] === this.bookingEvent.ID);\r\n\r\n      if (filteredRooms.length === 0) {\r\n        throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty array`);\r\n      }\r\n\r\n      if (filteredRooms.some(room => room['assigned_units_pool'] === null)) {\r\n        throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty pool`);\r\n      }\r\n\r\n      data.rooms = filteredRooms;\r\n\r\n      const transformedBooking = transformNewBooking(data)[0];\r\n      const { ID, TO_DATE, FROM_DATE, NO_OF_DAYS, STATUS, NAME, IDENTIFIER, PR_ID, POOL, BOOKING_NUMBER, NOTES, is_direct, BALANCE, ...otherBookingData } = transformedBooking;\r\n      this.bookingEvent = {\r\n        ...otherBookingData,\r\n        ...this.bookingEvent,\r\n        booking: data,\r\n        PHONE: otherBookingData.PHONE,\r\n        PHONE_PREFIX: otherBookingData.PHONE_PREFIX,\r\n        PRIVATE_NOTE: otherBookingData.PRIVATE_NOTE,\r\n      };\r\n      this.updateBookingEvent.emit(this.bookingEvent);\r\n      this.showEventInfo(true);\r\n    } catch (error) {\r\n      console.error(error.message);\r\n    }\r\n  }\r\n\r\n  componentDidLoad() {\r\n    if (this.isNewEvent()) {\r\n      if (!this.bookingEvent.hideBubble) {\r\n        /* auto matically open the popup, calling the method shows bubble either top or bottom based on available space. */\r\n        setTimeout(async () => {\r\n          if (['003', '002', '004'].includes(this.bookingEvent.STATUS_CODE)) {\r\n            this.showEventInfo(true);\r\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\r\n            await this.fetchAndAssignBookingData();\r\n          } else {\r\n            this.showEventInfo(true);\r\n          }\r\n          this.renderAgain();\r\n        }, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    window.removeEventListener('click', this.handleClickOutsideBind);\r\n    if (this.animationFrameId) {\r\n      cancelAnimationFrame(this.animationFrameId);\r\n    }\r\n  }\r\n\r\n  @Listen('click', { target: 'window' })\r\n  handleClickOutside(event: Event) {\r\n    const clickedElement = event.target as HTMLElement;\r\n    // Check if the clicked element is not within the target div\r\n    if (!this.element.contains(clickedElement)) {\r\n      // The click occurred outside the target div\r\n      this.showEventInfo(false);\r\n    }\r\n  }\r\n\r\n  @Listen('hideBubbleInfo', { target: 'window' })\r\n  hideBubbleInfoPopup(event: CustomEvent) {\r\n    if (event.detail.currentInfoBubbleId != this.getBookingId() || (event.detail.key === 'hidebubble' && event.detail.currentInfoBubbleId === this.getBookingId())) {\r\n      this.showInfoPopup = false;\r\n      this.renderAgain();\r\n    }\r\n  }\r\n\r\n  @Listen('moveBookingTo', { target: 'window' })\r\n  async moveBookingToHandler(event: CustomEvent) {\r\n    try {\r\n      if (event.detail.bookingId !== this.getBookingId()) {\r\n        this.showEventInfo(false);\r\n        return;\r\n      }\r\n\r\n      if (event.detail.moveToDay === 'revert' || event.detail.toRoomId === 'revert') {\r\n        event.detail.moveToDay = this.bookingEvent.FROM_DATE;\r\n        event.detail.toRoomId = event.detail.fromRoomId;\r\n        if (this.isTouchStart && this.moveDiffereneX <= 5 && this.moveDiffereneY <= 5 && !this.isStreatch) {\r\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n            this.showEventInfo(true);\r\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\r\n            await this.fetchAndAssignBookingData();\r\n          }\r\n        } else {\r\n          this.animationFrameId = requestAnimationFrame(() => {\r\n            this.resetBookingToInitialPosition();\r\n          });\r\n          return;\r\n        }\r\n      } else {\r\n        if (this.isTouchStart && this.moveDiffereneX <= 5 && this.moveDiffereneY <= 5 && !this.isStreatch) {\r\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n            this.showEventInfo(true);\r\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\r\n            await this.fetchAndAssignBookingData();\r\n          }\r\n        } else {\r\n          const { pool, to_date, from_date, toRoomId } = event.detail as any;\r\n          if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\r\n            this.animationFrameId = requestAnimationFrame(() => {\r\n              this.resetBookingToInitialPosition();\r\n            });\r\n            throw new Error('Overlapping Dates');\r\n          }\r\n          if (pool) {\r\n            if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n              // let fromDate = moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(moment(new Date(from_date)))\r\n              //   ? this.bookingEvent.defaultDates.from_date\r\n              //   : from_date;\r\n              // console.log('room', fromDate, this.bookingEvent.defaultDates.from_date, from_date);\r\n              await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date).catch(() => {\r\n                this.resetBookingToInitialPosition();\r\n              });\r\n            } else {\r\n              if (this.isShrinking || !this.isStreatch) {\r\n                // try {\r\n                //   if (this.bookingEvent.PR_ID.toString() === toRoomId.toString()) {\r\n                //     await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date);\r\n                //     return;\r\n                //   }\r\n                // } catch (error) {\r\n                //   this.resetBookingToInitialPosition();\r\n                //   return;\r\n                // }\r\n                const { description, status } = this.getModalDescription(toRoomId, from_date, to_date);\r\n                let hideConfirmButton = false;\r\n                if (status === '400') {\r\n                  hideConfirmButton = true;\r\n                }\r\n                const oldFromDate = this.bookingEvent.defaultDates.from_date;\r\n                const oldToDate = this.bookingEvent.defaultDates.to_date;\r\n                const diffDays = calculateDaysBetweenDates(oldFromDate, oldToDate);\r\n\r\n                let shrinkingDirection = null;\r\n                let fromDate = oldFromDate;\r\n                let toDate = oldToDate;\r\n                if (this.isShrinking) {\r\n                  if (moment(from_date, 'YYYY-MM-DD').isAfter(moment(oldFromDate, 'YYYY-MM-DD')) && moment(to_date, 'YYYY-MM-DD').isBefore(moment(oldToDate, 'YYYY-MM-DD'))) {\r\n                    fromDate = oldFromDate;\r\n                    toDate = to_date;\r\n                  } else {\r\n                    shrinkingDirection = moment(from_date, 'YYYY-MM-DD').isAfter(moment(oldFromDate, 'YYYY-MM-DD'))\r\n                      ? 'left'\r\n                      : moment(to_date, 'YYYY-MM-DD').isBefore(moment(oldToDate, 'YYYY-MM-DD'))\r\n                      ? 'right'\r\n                      : null;\r\n                    if (shrinkingDirection === 'left') {\r\n                      fromDate = from_date;\r\n                    }\r\n\r\n                    if (shrinkingDirection === 'right') {\r\n                      toDate = to_date;\r\n                    }\r\n                  }\r\n                } else {\r\n                  if (moment(from_date, 'YYYY-MM-DD').isBefore(moment(oldFromDate, 'YYYY-MM-DD'))) {\r\n                    fromDate = from_date;\r\n                    const newToDate = moment(from_date, 'YYYY-MM-DD').add(diffDays, 'days');\r\n                    toDate = newToDate.isBefore(moment(to_date, 'YYYY-MM-DD'), 'days') ? to_date : newToDate.format('YYYY-MM-DD');\r\n                  } else if (moment(to_date, 'YYYY-MM-DD').isAfter(moment(oldToDate, 'YYYY-MM-DD'))) {\r\n                    toDate = to_date;\r\n                    fromDate = moment(to_date, 'YYYY-MM-DD').subtract(diffDays, 'days').format('YYYY-MM-DD');\r\n                  }\r\n                }\r\n                console.warn({ fromDate, toDate });\r\n                this.showDialog.emit({ reason: 'reallocate', ...event.detail, description, title: '', hideConfirmButton, from_date: fromDate, to_date: toDate });\r\n              } else {\r\n                // if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\r\n                //   this.animationFrameId = requestAnimationFrame(() => {\r\n                //     this.resetBookingToInitialPosition();\r\n                //   });\r\n                //   throw new Error('Overlapping Dates');\r\n                // } else {\r\n                this.showRoomNightsDialog.emit({\r\n                  bookingNumber: this.bookingEvent.BOOKING_NUMBER,\r\n                  identifier: this.bookingEvent.IDENTIFIER,\r\n                  to_date,\r\n                  pool,\r\n                  from_date,\r\n                  defaultDates: this.bookingEvent.defaultDates,\r\n                });\r\n                // }\r\n              }\r\n            }\r\n            this.isShrinking = null;\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      this.toast.emit({\r\n        position: 'top-right',\r\n        title: error.message,\r\n        description: '',\r\n        type: 'error',\r\n      });\r\n      console.log('something went wrong');\r\n    }\r\n  }\r\n  private getModalDescription(toRoomId: number, from_date, to_date): { status: '200' | '400'; description: string } {\r\n    const findRoomType = (roomId: number) => {\r\n      let roomType = this.bookingEvent.roomsInfo.filter(room => room.physicalrooms.some(r => r.id === +roomId));\r\n      if (roomType.length) {\r\n        return roomType[0].id;\r\n      }\r\n      return null;\r\n    };\r\n    if (!this.bookingEvent.is_direct) {\r\n      if (this.isShrinking) {\r\n        return {\r\n          description: `${locales.entries.Lcz_YouWillLoseFutureUpdates}.`,\r\n          status: '200',\r\n        };\r\n      } else {\r\n        if (\r\n          moment(from_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.FROM_DATE, 'YYYY-MM-DD')) &&\r\n          moment(to_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD'))\r\n        ) {\r\n          const initialRT = findRoomType(this.bookingEvent.PR_ID);\r\n          const targetRT = findRoomType(toRoomId);\r\n          if (initialRT === targetRT) {\r\n            return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\r\n          } else {\r\n            return {\r\n              description: `${locales.entries.Lcz_YouWillLoseFutureUpdates} ${this.bookingEvent.origin ? this.bookingEvent.origin.Label : ''}. ${\r\n                locales.entries.Lcz_SameRatesWillBeKept + '.'\r\n              }`,\r\n              status: '200',\r\n            };\r\n          }\r\n        }\r\n        return { description: locales.entries.Lcz_CannotChangeCHBookings + '.', status: '400' };\r\n      }\r\n    } else {\r\n      if (!this.isShrinking) {\r\n        const initialRT = findRoomType(Number(this.bookingEvent.PR_ID));\r\n        const targetRT = findRoomType(Number(toRoomId));\r\n        if (initialRT === targetRT) {\r\n          console.log('same rt');\r\n          if (this.bookingEvent.PR_ID.toString() === toRoomId.toString()) {\r\n            //TODO add the description\r\n            return { description: locales.entries.Lcz_ConfrmModiication + '.', status: '200' };\r\n          }\r\n          return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\r\n        } else {\r\n          return {\r\n            description: locales.entries.Lcz_SameRatesWillBeKept + '.',\r\n            status: '200',\r\n          };\r\n        }\r\n      }\r\n      return { description: locales.entries.Lcz_ConfrmModiication + '.', status: '200' };\r\n    }\r\n  }\r\n  private resetBookingToInitialPosition() {\r\n    if (this.isStreatch) {\r\n      this.element.style.left = `${this.initialLeft}px`;\r\n      this.element.style.width = `${this.initialWidth}px`;\r\n      this.isStreatch = false;\r\n      this.finalWidth = this.initialWidth;\r\n      this.isShrinking = null;\r\n    } else {\r\n      this.element.style.top = `${this.dragInitPos.top}px`;\r\n      this.element.style.left = `${this.dragInitPos.left}px`;\r\n    }\r\n  }\r\n  @Listen('revertBooking', { target: 'window' })\r\n  handleRevertBooking(event: CustomEvent<string>) {\r\n    if (this.bookingEvent.POOL === event.detail) {\r\n      this.resetBookingToInitialPosition();\r\n    }\r\n  }\r\n  checkIfSlotOccupied(toRoomId, from_date, to_date) {\r\n    const fromTime = moment(from_date, 'YYYY-MM-DD');\r\n    const toTime = moment(to_date, 'YYYY-MM-DD');\r\n    const isOccupied = this.allBookingEvents.some(event => {\r\n      if (event.POOL === this.bookingEvent.POOL) {\r\n        return false;\r\n      }\r\n      const eventFromTime = moment(event.FROM_DATE, 'YYYY-MM-DD').add(1, 'days');\r\n      const eventToTime = moment(event.TO_DATE, 'YYYY-MM-DD');\r\n      return event.PR_ID === +toRoomId && toTime.isSameOrAfter(eventFromTime) && fromTime.isBefore(eventToTime);\r\n    });\r\n    return isOccupied;\r\n  }\r\n\r\n  renderAgain() {\r\n    this.renderElement = !this.renderElement;\r\n  }\r\n\r\n  getUniqueId() {\r\n    return new Date().getTime();\r\n  }\r\n\r\n  isSplitBooking() {\r\n    return !!this.bookingEvent.SPLIT_BOOKING;\r\n  }\r\n\r\n  isNewEvent() {\r\n    return this.getBookingId() === 'NEW_TEMP_EVENT';\r\n  }\r\n\r\n  isHighlightEventType() {\r\n    return this.getEventType() === 'HIGH_LIGHT';\r\n  }\r\n\r\n  getBookingId() {\r\n    return this.bookingEvent.ID;\r\n  }\r\n\r\n  getBookingStatus() {\r\n    return this.bookingEvent.STATUS;\r\n  }\r\n\r\n  getBookedBy() {\r\n    return this.bookingEvent.NAME;\r\n  }\r\n\r\n  getBookedRoomId() {\r\n    return this.bookingEvent.PR_ID;\r\n  }\r\n\r\n  getEventStartingDate() {\r\n    return new Date(this.bookingEvent.FROM_DATE);\r\n  }\r\n\r\n  getEventEndingDate() {\r\n    return new Date(this.bookingEvent.TO_DATE);\r\n  }\r\n\r\n  getEventType() {\r\n    return this.bookingEvent.event_type;\r\n  }\r\n\r\n  getEventLegend() {\r\n    // console.log(this.getBookingStatus());\r\n    let status = this.bookingEvent?.legendData.statusId[this.getBookingStatus()];\r\n    let orderRide = this.isNewEvent() ? { color: '#f9f9c9' } : {};\r\n    return {\r\n      ...this.bookingEvent?.legendData[status.id],\r\n      ...status,\r\n      ...orderRide,\r\n    };\r\n  }\r\n\r\n  getLegendOfStatus(aStatusId) {\r\n    // console.log(aStatusId);\r\n    let status = this.bookingEvent?.legendData.statusId[aStatusId];\r\n    return { ...this.bookingEvent.legendData[status.id], ...status };\r\n  }\r\n\r\n  getNoteNode() {\r\n    if (this.bookingEvent.NOTES || this.bookingEvent.INTERNAL_NOTE || this.bookingEvent.PRIVATE_NOTE) {\r\n      return this.getLegendOfStatus('NOTES');\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getBalanceNode() {\r\n    if (this.bookingEvent.BALANCE !== null && this.bookingEvent.BALANCE >= 1) {\r\n      return this.getLegendOfStatus('OUTSTANDING-BALANCE');\r\n    }\r\n    return null;\r\n  }\r\n\r\n  setStayDays(aStayDays: number) {\r\n    this.bookingEvent.NO_OF_DAYS = aStayDays;\r\n    this.renderAgain();\r\n    // this.updateData({id: this.getBookedRoomId(), data: { NO_OF_DAYS: aStayDays }});\r\n  }\r\n\r\n  getStayDays() {\r\n    return this.bookingEvent.NO_OF_DAYS;\r\n  }\r\n\r\n  getPosition() {\r\n    let startingDate = this.getEventStartingDate();\r\n    let startingCellClass = '.room_' + this.getBookedRoomId() + '_' + startingDate.getDate() + '_' + (startingDate.getMonth() + 1) + '_' + startingDate.getFullYear();\r\n    let bodyContainer = document.querySelector('.bodyContainer');\r\n    let startingCell = document.querySelector(startingCellClass);\r\n    let pos = { top: '0', left: '0', width: '0', height: '20px' };\r\n    if (startingCell && bodyContainer && startingCell.getBoundingClientRect() && bodyContainer.getBoundingClientRect()) {\r\n      let bodyContainerRect = bodyContainer.getBoundingClientRect();\r\n      let boundingRect = startingCell.getBoundingClientRect();\r\n      this.dayWidth = this.dayWidth || boundingRect.width;\r\n      pos.top = boundingRect.top + boundingRect.height / 2 - this.vertSpace - bodyContainerRect.top + 'px';\r\n      // pos.left = boundingRect.left + this.dayWidth / 2 + this.eventSpace / 2 - bodyContainerRect.left + 'px';\r\n      // pos.width = this.getStayDays() * this.dayWidth - this.eventSpace + 'px';\r\n      pos.left =\r\n        boundingRect.left +\r\n        (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 0 : this.dayWidth / 2) +\r\n        this.eventSpace / 2 -\r\n        bodyContainerRect.left +\r\n        'px';\r\n      pos.width =\r\n        (this.getStayDays() + (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 0.5 : 0)) *\r\n          this.dayWidth -\r\n        this.eventSpace +\r\n        'px';\r\n    } else {\r\n      console.log(this.bookingEvent);\r\n      console.log('Locating event cell failed ', startingCellClass);\r\n    }\r\n    //console.log(pos);\r\n    return pos;\r\n  }\r\n\r\n  getNumber(aData) {\r\n    return aData ? parseFloat(aData) : 0;\r\n  }\r\n\r\n  startDragging(event: any, side: string) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    event.stopImmediatePropagation();\r\n\r\n    if (this.isNewEvent() || this.isHighlightEventType()) {\r\n      return null;\r\n    }\r\n\r\n    this.resizeSide = side;\r\n    this.isDragging = true;\r\n\r\n    this.showEventInfo(false);\r\n    this.isStreatch = side !== 'move';\r\n    if (side === 'move') {\r\n      this.initialX = event.clientX || event.touches[0].clientX;\r\n      this.initialY = event.clientY || event.touches[0].clientY;\r\n      this.elementRect = this.element.getBoundingClientRect();\r\n      const offsetX = 0;\r\n      const offsetY = 0;\r\n      this.dragInitPos = {\r\n        id: this.getBookingId(),\r\n        fromRoomId: this.getBookedRoomId(),\r\n        top: this.getNumber(this.element.style.top) + offsetY,\r\n        left: this.getNumber(this.element.style.left) + offsetX,\r\n      };\r\n      this.dragInitPos.x = this.dragInitPos.left;\r\n      this.dragInitPos.y = this.dragInitPos.top;\r\n      this.dragEndPos = { ...this.dragInitPos };\r\n      this.element.style.top = `${this.dragInitPos.top}px`;\r\n      this.element.style.left = `${this.dragInitPos.left}px`;\r\n      this.isTouchStart = true; // !!(event.touches && event.touches.length);\r\n      this.dragOverEventData.emit({\r\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\r\n        data: this.dragInitPos,\r\n      });\r\n    } else {\r\n      this.initialWidth = this.element.offsetWidth;\r\n      this.initialLeft = this.element.offsetLeft;\r\n      this.initialX = event.clientX || event.touches[0].clientX;\r\n      this.dragOverEventData.emit({\r\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\r\n        data: {\r\n          id: this.getBookingId(),\r\n          fromRoomId: this.getBookedRoomId(),\r\n          top: this.getNumber(this.element.style.top),\r\n          left: this.initialLeft,\r\n          x: this.initialX,\r\n          y: event.clientY || event.touches[0].clientY,\r\n        },\r\n      });\r\n    }\r\n\r\n    document.addEventListener('mousemove', this.handleMouseMoveBind);\r\n    document.addEventListener('touchmove', this.handleMouseMoveBind);\r\n    document.addEventListener('pointermove', this.handleMouseMoveBind);\r\n\r\n    document.addEventListener('mouseup', this.handleMouseUpBind);\r\n    document.addEventListener('touchup', this.handleMouseUpBind);\r\n    document.addEventListener('pointerup', this.handleMouseUpBind);\r\n  }\r\n\r\n  handleMouseMove(event: any) {\r\n    if (this.isDragging) {\r\n      this.currentX = event.clientX || event.touches[0].clientX;\r\n      let distanceX = this.currentX - this.initialX;\r\n      if (this.resizeSide === 'move') {\r\n        this.currentY = event.clientY || event.touches[0].clientY;\r\n        let distanceY = this.currentY - this.initialY;\r\n        this.element.style.top = `${this.dragInitPos.top + distanceY}px`;\r\n        this.element.style.left = `${this.dragInitPos.left + distanceX}px`;\r\n        this.dragEndPos = {\r\n          id: this.getBookingId(),\r\n          fromRoomId: this.getBookedRoomId(),\r\n          top: this.dragInitPos.top + distanceY,\r\n          left: this.dragInitPos.left + distanceX,\r\n        };\r\n        this.dragEndPos.x = this.dragEndPos.left; // + 18;\r\n        this.dragEndPos.y = this.dragEndPos.top; // + (this.elementRect.height/2);\r\n        this.dragOverEventData.emit({ id: 'DRAG_OVER', data: this.dragEndPos });\r\n      } else {\r\n        if (!this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n          return;\r\n        }\r\n        let newWidth = this.initialWidth;\r\n        if (this.resizeSide == 'rightSide') {\r\n          newWidth = this.initialWidth + distanceX;\r\n          newWidth = Math.min(newWidth, this.initialX + this.element.offsetWidth);\r\n          newWidth = Math.max(this.dayWidth - this.eventSpace, newWidth);\r\n          this.element.style.width = `${newWidth}px`;\r\n          this.isShrinking = distanceX < 0;\r\n        } else if (this.resizeSide == 'leftSide') {\r\n          this.isShrinking = distanceX > 0;\r\n          newWidth = Math.max(this.dayWidth - this.eventSpace, this.initialWidth - distanceX);\r\n          let newLeft = this.initialLeft + (this.initialWidth - newWidth);\r\n          this.element.style.left = `${newLeft}px`;\r\n          this.element.style.width = `${newWidth}px`;\r\n        }\r\n        this.finalWidth = newWidth;\r\n      }\r\n    } else {\r\n      console.log('still mouse move listening...');\r\n    }\r\n  }\r\n\r\n  handleMouseUp() {\r\n    if (this.isDragging) {\r\n      if (this.resizeSide === 'move') {\r\n        // console.log(\"Initial X::\"+this.dragInitPos.x);\r\n        // console.log(\"Initial Y::\"+this.dragInitPos.y);\r\n        // console.log(\"End X::\"+this.dragEndPos.x);\r\n        // console.log(\"End Y::\"+this.dragEndPos.y);\r\n        if (this.isTouchStart) {\r\n          this.moveDiffereneX = Math.abs(this.dragEndPos.x - this.dragInitPos.x);\r\n          this.moveDiffereneY = Math.abs(this.dragEndPos.y - this.dragInitPos.y);\r\n        }\r\n        this.dragOverEventData.emit({\r\n          id: 'DRAG_OVER_END',\r\n          data: {\r\n            ...this.dragEndPos,\r\n            pool: this.bookingEvent.POOL,\r\n            nbOfDays: this.bookingEvent.NO_OF_DAYS,\r\n          },\r\n        });\r\n      } else {\r\n        const finalWidth =\r\n          this.finalWidth -\r\n          (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? this.dayWidth / 2 : 0);\r\n        const numberOfDays = Math.round(finalWidth / this.dayWidth);\r\n        console.log(finalWidth, this.dayWidth, numberOfDays);\r\n        let initialStayDays = this.getStayDays();\r\n        if (initialStayDays != numberOfDays && !isNaN(numberOfDays)) {\r\n          //this.setStayDays(numberOfDays);\r\n          if (this.resizeSide == 'leftSide') {\r\n            this.element.style.left = `${this.initialLeft + (initialStayDays - numberOfDays) * this.dayWidth}px`;\r\n            // set FROM_DATE = TO_DATE - numberOfDays\r\n          } else {\r\n            if (numberOfDays < initialStayDays) {\r\n              this.isShrinking = true;\r\n            }\r\n            // set TO_DATE = FROM_DATE + numberOfDays\r\n          }\r\n          // const nbrOfDays =\r\n          // !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? numberOfDays - 1 : numberOfDays;\r\n          this.dragOverEventData.emit({\r\n            id: 'STRETCH_OVER_END',\r\n            data: {\r\n              id: this.getBookingId(),\r\n              fromRoomId: +this.getBookedRoomId(),\r\n              x: +this.element.style.left.replace('px', ''),\r\n              y: +this.element.style.top.replace('px', ''),\r\n              pool: this.bookingEvent.POOL,\r\n              nbOfDays: numberOfDays,\r\n            },\r\n          });\r\n          const offset = !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? +this.dayWidth / 2 : 0;\r\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace + offset}px`;\r\n        } else {\r\n          this.element.style.left = `${this.initialLeft}px`;\r\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace}px`;\r\n        }\r\n      }\r\n    } else {\r\n      console.log('still mouse up listening...');\r\n    }\r\n    this.isDragging = false;\r\n\r\n    document.removeEventListener('mousemove', this.handleMouseMoveBind);\r\n    document.removeEventListener('touchmove', this.handleMouseMoveBind);\r\n    document.removeEventListener('pointermove', this.handleMouseMoveBind);\r\n\r\n    document.removeEventListener('mouseup', this.handleMouseUpBind);\r\n    document.removeEventListener('touchup', this.handleMouseUpBind);\r\n    document.removeEventListener('pointerup', this.handleMouseUpBind);\r\n  }\r\n\r\n  updateData(data: any) {\r\n    this.updateEventData.emit(data);\r\n  }\r\n  private calculateHoverPosition() {\r\n    const barRect = this.element.getBoundingClientRect();\r\n    const barWidth = barRect.width;\r\n    const barLeft = barRect.left;\r\n    const screenWidth = window.innerWidth;\r\n\r\n    let hoverLeft;\r\n\r\n    if (barWidth <= screenWidth) {\r\n      hoverLeft = barWidth / 2;\r\n    } else {\r\n      hoverLeft = screenWidth / 2 - barLeft;\r\n    }\r\n    return {\r\n      position: 'absolute',\r\n      left: `${hoverLeft}px`,\r\n      transform: 'translateX(-50%)',\r\n    };\r\n  }\r\n  renderEventBookingNumber() {\r\n    if (this.bookingEvent.STATUS === 'TEMP-EVENT' || this.bookingEvent.ID === 'NEW_TEMP_EVENT') {\r\n      return '';\r\n    }\r\n    if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\r\n      return '';\r\n    }\r\n    if (!this.bookingEvent.is_direct) {\r\n      return ` - ${this.bookingEvent.channel_booking_nbr}`;\r\n    }\r\n    return ` - ${this.bookingEvent.BOOKING_NUMBER}`;\r\n  }\r\n  showEventInfo(showInfo) {\r\n    // if (this.isHighlightEventType() || this.bookingEvent.hideBubble) {\r\n    //   return null;\r\n    // }\r\n\r\n    // if (showInfo) {\r\n    //   // Calculate which side we need to show the bubble, top side or bottom.\r\n    //   let bodyContainer = document.querySelector('.calendarScrollContainer');\r\n    //   let bodyContainerRect: { [key: string]: any } = bodyContainer.getBoundingClientRect();\r\n    //   let elementRect: { [key: string]: any } = this.element.getBoundingClientRect();\r\n    //   let midPoint = bodyContainerRect.height / 2 + bodyContainerRect.top + 50;\r\n    //   // let topDifference = elementRect.top - bodyContainerRect.top;\r\n    //   // let bottomDifference = bodyContainerRect.bottom - elementRect.bottom;\r\n\r\n    //   if (elementRect.top < midPoint) {\r\n    //     this.bubbleInfoTopSide = false;\r\n    //   } else {\r\n    //     this.bubbleInfoTopSide = true;\r\n    //   }\r\n    // }\r\n\r\n    // // showInfo = true;\r\n    // if (showInfo) {\r\n    //   this.hideBubbleInfo.emit({\r\n    //     key: 'hidePopup',\r\n    //     currentInfoBubbleId: this.getBookingId(),\r\n    //   });\r\n    // }\r\n    // this.showInfoPopup = showInfo;\r\n    // this.renderAgain();\r\n    if (this.isHighlightEventType() || this.bookingEvent.hideBubble) {\r\n      return null;\r\n    }\r\n\r\n    if (showInfo) {\r\n      // Calculate which side we need to show the bubble, top side or bottom.\r\n      let bodyContainer = document.querySelector('.calendarScrollContainer');\r\n      let bodyContainerRect: { [key: string]: any } = bodyContainer.getBoundingClientRect();\r\n      let elementRect: { [key: string]: any } = this.element.getBoundingClientRect();\r\n      let midPoint = bodyContainerRect.height / 2 + bodyContainerRect.top + 50;\r\n\r\n      if (elementRect.top < midPoint) {\r\n        this.bubbleInfoTopSide = false;\r\n      } else {\r\n        this.bubbleInfoTopSide = true;\r\n      }\r\n    }\r\n\r\n    if (showInfo) {\r\n      this.hideBubbleInfo.emit({\r\n        key: 'hidePopup',\r\n        currentInfoBubbleId: this.getBookingId(),\r\n      });\r\n    }\r\n    this.showInfoPopup = showInfo;\r\n    this.renderAgain();\r\n  }\r\n\r\n  render() {\r\n    // onMouseLeave={()=>this.showEventInfo(false)}\r\n    let legend = this.getEventLegend();\r\n    let noteNode = this.getNoteNode();\r\n    let balanceNode = this.getBalanceNode();\r\n    // console.log(this.bookingEvent.BOOKING_NUMBER === '46231881' ? this.bookingEvent : '');\r\n    return (\r\n      <Host\r\n        class={`bookingEvent  ${this.isNewEvent() || this.isHighlightEventType() ? 'newEvent' : ''} ${legend.clsName} `}\r\n        style={this.getPosition()}\r\n        id={'event_' + this.getBookingId()}\r\n      >\r\n        {/* onMouseOver={() =>this.showEventInfo(true)}  */}\r\n        <div\r\n          class={`bookingEventBase  ${\r\n            !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\r\n          }\r\n          ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}\r\n          ${\r\n            !this.bookingEvent.is_direct &&\r\n            !isBlockUnit(this.bookingEvent.STATUS_CODE) &&\r\n            this.bookingEvent.STATUS !== 'TEMP-EVENT' &&\r\n            this.bookingEvent.ID !== 'NEW_TEMP_EVENT' &&\r\n            'border border-dark ota-booking-event'\r\n          }  ${this.isSplitBooking() ? 'splitBooking' : ''}`}\r\n          style={{ 'backgroundColor': legend.color, '--ir-event-bg': legend.color }}\r\n          onTouchStart={event => this.startDragging(event, 'move')}\r\n          onMouseDown={event => this.startDragging(event, 'move')}\r\n        ></div>\r\n        {noteNode ? <div class=\"legend_circle noteIcon\" style={{ backgroundColor: noteNode.color }}></div> : null}\r\n        {balanceNode ? <div class=\"legend_circle balanceIcon\" style={{ backgroundColor: balanceNode.color }}></div> : null}\r\n        {/* onMouseOver={() => this.showEventInfo(true)}  */}\r\n        <div class=\"bookingEventTitle\" onTouchStart={event => this.startDragging(event, 'move')} onMouseDown={event => this.startDragging(event, 'move')}>\r\n          {this.getBookedBy()}\r\n          {this.renderEventBookingNumber()}\r\n        </div>\r\n\r\n        {(this.bookingEvent.is_direct || isBlockUnit(this.bookingEvent.STATUS_CODE)) && (\r\n          <Fragment>\r\n            <div\r\n              class={`bookingEventDragHandle leftSide ${\r\n                !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\r\n              }\r\n            ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}`}\r\n              onTouchStart={event => this.startDragging(event, 'leftSide')}\r\n              onMouseDown={event => this.startDragging(event, 'leftSide')}\r\n            ></div>\r\n            <div\r\n              class={`bookingEventDragHandle rightSide ${\r\n                !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\r\n              }\r\n              ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}`}\r\n              onTouchStart={event => this.startDragging(event, 'rightSide')}\r\n              onMouseDown={event => this.startDragging(event, 'rightSide')}\r\n            ></div>\r\n          </Fragment>\r\n        )}\r\n\r\n        {this.showInfoPopup ? (\r\n          <igl-booking-event-hover\r\n            is_vacation_rental={this.is_vacation_rental}\r\n            countries={this.countries}\r\n            currency={this.currency}\r\n            class=\"top\"\r\n            bookingEvent={this.bookingEvent}\r\n            bubbleInfoTop={this.bubbleInfoTopSide}\r\n            style={this.calculateHoverPosition()}\r\n          ></igl-booking-event-hover>\r\n        ) : null}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n  position: relative;\r\n  z-index: 100;\r\n}\r\n\r\n.btn {\r\n  padding-left: 4px !important;\r\n  padding-right: 4px !important;\r\n}\r\n.balance_amount {\r\n  color: #ff4961;\r\n  font-size: 0.75rem;\r\n}\r\n.user-notes {\r\n  margin-left: 4px;\r\n  display: -webkit-box;\r\n  -webkit-box-orient: vertical;\r\n  -webkit-line-clamp: 5;\r\n  line-clamp: 5;\r\n  overflow: hidden;\r\n  max-width: 100%;\r\n  height: auto;\r\n}\r\n.events_btns {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 0.5rem;\r\n}\r\n.mx-01 {\r\n  --m: 5px;\r\n  margin-left: var(--m) !important;\r\n  margin-right: var(--m) !important;\r\n}\r\n\r\n.pointerContainerTop {\r\n  top: -26px;\r\n}\r\n\r\n.pointerContainer {\r\n  position: absolute;\r\n  height: 10px;\r\n  width: 350px;\r\n  left: var(--el-left, 50%);\r\n  transform: translateX(-50%);\r\n}\r\n\r\n.iglPopOver {\r\n  /* max-width: 350px; */\r\n  position: absolute;\r\n  background-color: #fff;\r\n  padding: 10px;\r\n  border: 1px solid #656ee7;\r\n  border-radius: 6px;\r\n  left: var(--el-left, 50%);\r\n  transform: translateX(-50%) translateY(10px);\r\n  box-shadow: 1px 0px 20px rgba(0, 0, 0, 0.2);\r\n}\r\n\r\n.iglPopOver.infoBubble {\r\n  min-width: 350px;\r\n}\r\n\r\n.iglPopOver.blockedView {\r\n  max-width: 400px;\r\n  width: 400px;\r\n}\r\n\r\n.iglPopOver.newBookingOptions {\r\n  overflow-wrap: break-word !important;\r\n  min-width: 230px;\r\n  width: fit-content;\r\n}\r\n\r\n.bubblePointer {\r\n  position: absolute;\r\n  width: 0;\r\n  height: 0;\r\n  left: 50%;\r\n  border-left: 10px solid transparent;\r\n  border-right: 10px solid transparent;\r\n  transform: translate(-50%, 0px);\r\n}\r\n\r\n.bubblePointTop {\r\n  border-top: 10px solid #656ee7;\r\n}\r\n\r\n.bubblePointBottom {\r\n  border-bottom: 10px solid #656ee7;\r\n}\r\n\r\n.bubbleInfoAbove {\r\n  bottom: 35px;\r\n}\r\n\r\n.updateBtnIcon {\r\n  margin-right: 4px;\r\n}\r\n.icon-image {\r\n  height: 1.5rem;\r\n  width: 1.5rem;\r\n  margin-right: 5px;\r\n}\r\n","import { Component, Host, h, Prop, Event, EventEmitter, State, Element, Fragment, Watch } from '@stencil/core';\r\nimport { canCheckIn, findCountry, formatAmount } from '@/utils/utils';\r\nimport { ICountry } from '@/models/IBooking';\r\nimport { EventsService } from '@/services/events.service';\r\nimport moment from 'moment';\r\nimport locales from '@/stores/locales.store';\r\nimport calendar_data from '@/stores/calendar-data';\r\nimport { CalendarModalEvent } from '@/models/property-types';\r\nimport { compareTime, createDateWithOffsetAndHour } from '@/utils/booking';\r\n//import { transformNewBLockedRooms } from '../../../utils/booking';\r\n\r\n@Component({\r\n  tag: 'igl-booking-event-hover',\r\n  styleUrl: 'igl-booking-event-hover.css',\r\n  scoped: true,\r\n})\r\nexport class IglBookingEventHover {\r\n  @Element() element: HTMLIglBookingEventHoverElement;\r\n\r\n  @Prop({ mutable: true }) bookingEvent: { [key: string]: any };\r\n  @Prop() bubbleInfoTop: boolean = false;\r\n  @Prop() currency;\r\n  @Prop() countries: ICountry[];\r\n  @Prop() is_vacation_rental: boolean = false;\r\n\r\n  @State() isLoading: string;\r\n  @State() shouldHideUnassignUnit = false;\r\n  @State() canCheckInOrCheckout: boolean;\r\n\r\n  @Event() showBookingPopup: EventEmitter;\r\n  @Event({ bubbles: true, composed: true }) hideBubbleInfo: EventEmitter;\r\n  @Event({ bubbles: true, composed: true }) deleteButton: EventEmitter<string>;\r\n  @Event() bookingCreated: EventEmitter<{ pool?: string; data: any[] }>;\r\n  @Event() showDialog: EventEmitter<CalendarModalEvent>;\r\n\r\n  private eventService = new EventsService();\r\n  private hideButtons = false;\r\n\r\n  componentWillLoad() {\r\n    let selectedRt = this.bookingEvent.roomsInfo.find(r => r.id === this.bookingEvent.RATE_TYPE);\r\n    if (selectedRt) {\r\n      this.shouldHideUnassignUnit = selectedRt.physicalrooms.length === 1;\r\n    }\r\n    if (moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD').isBefore(moment())) {\r\n      this.hideButtons = true;\r\n    }\r\n\r\n    this.canCheckInOrCheckout = moment().isSameOrAfter(new Date(this.bookingEvent.FROM_DATE), 'days') && moment().isBefore(new Date(this.bookingEvent.TO_DATE), 'days');\r\n\r\n    this.handleKeyDown = this.handleKeyDown.bind(this);\r\n  }\r\n\r\n  componentDidLoad() {\r\n    document.addEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n  @Watch('bookingEvent')\r\n  handleBookingEventChange(newValue, oldValue) {\r\n    if (newValue !== oldValue)\r\n      this.canCheckInOrCheckout =\r\n        moment(new Date()).isSameOrAfter(new Date(this.bookingEvent.FROM_DATE), 'days') && moment(new Date()).isBefore(new Date(this.bookingEvent.TO_DATE), 'days');\r\n  }\r\n  private getBookingId() {\r\n    return this.bookingEvent.ID;\r\n  }\r\n  private hideBubble() {\r\n    this.hideBubbleInfo.emit({\r\n      key: 'hidebubble',\r\n      currentInfoBubbleId: this.getBookingId(),\r\n    });\r\n    document.removeEventListener('keydown', this.handleKeyDown);\r\n  }\r\n\r\n  private handleKeyDown(event: KeyboardEvent) {\r\n    if (event.key === 'Escape') {\r\n      this.hideBubble();\r\n    } else return;\r\n  }\r\n\r\n  private getTotalOccupants() {\r\n    const { CHILDREN_COUNT, ADULTS_COUNT } = this.bookingEvent;\r\n    if (CHILDREN_COUNT === 0) {\r\n      return `${ADULTS_COUNT} ${ADULTS_COUNT > 1 ? locales.entries.Lcz_AdultsCaption.toLowerCase() : locales.entries.Lcz_Single_Adult?.toLowerCase()}`;\r\n    }\r\n    return `${ADULTS_COUNT} ${ADULTS_COUNT > 1 ? locales.entries.Lcz_AdultsCaption.toLowerCase() : locales.entries.Lcz_Single_Adult?.toLowerCase()}, ${CHILDREN_COUNT} ${\r\n      CHILDREN_COUNT > 1 ? locales.entries.Lcz_ChildCaption.toLowerCase() : locales.entries.Lcz_Single_Child?.toLowerCase()\r\n    }`;\r\n  }\r\n\r\n  private getPhoneNumber() {\r\n    return this.bookingEvent.PHONE;\r\n  }\r\n\r\n  private getCountry() {\r\n    return findCountry(this.bookingEvent.COUNTRY, this.countries).name;\r\n  }\r\n  private getPhoneCode() {\r\n    if (this.bookingEvent.PHONE_PREFIX) {\r\n      return this.bookingEvent.PHONE_PREFIX;\r\n    }\r\n    return findCountry(this.bookingEvent.COUNTRY, this.countries).phone_prefix;\r\n  }\r\n  private renderPhone() {\r\n    return this.bookingEvent.COUNTRY ? `${this.bookingEvent.is_direct ? this.getPhoneCode() + '-' : ''}${this.getPhoneNumber()} - ${this.getCountry()}` : this.getPhoneNumber();\r\n  }\r\n\r\n  // private getGuestNote() {\r\n  //   return this.bookingEvent.NOTES && <p class={'user-notes p-0 my-0'}>{this.bookingEvent.NOTES}</p>;\r\n  // }\r\n\r\n  private getInternalNote() {\r\n    return this.bookingEvent.INTERNAL_NOTE;\r\n  }\r\n\r\n  private getTotalPrice() {\r\n    return this.bookingEvent.TOTAL_PRICE;\r\n  }\r\n\r\n  private getArrivalTime() {\r\n    return this.bookingEvent.ARRIVAL_TIME;\r\n  }\r\n\r\n  private getRatePlan() {\r\n    return this.bookingEvent.RATE_PLAN;\r\n  }\r\n\r\n  private getEntryDate() {\r\n    return this.bookingEvent.ENTRY_DATE;\r\n  }\r\n\r\n  private isNewBooking() {\r\n    return this.getBookingId() === 'NEW_TEMP_EVENT';\r\n  }\r\n\r\n  private isCheckedIn() {\r\n    return this.bookingEvent.STATUS === 'IN-HOUSE';\r\n  }\r\n\r\n  private isBlockedDateEvent() {\r\n    return this.bookingEvent.STATUS === 'BLOCKED' || this.bookingEvent.STATUS === 'BLOCKED-WITH-DATES';\r\n  }\r\n\r\n  private hasSplitBooking() {\r\n    return this.bookingEvent.hasOwnProperty('splitBookingEvents') && this.bookingEvent.splitBookingEvents;\r\n  }\r\n\r\n  private canCheckIn() {\r\n    // if (!calendar_data.checkin_enabled || calendar_data.is_automatic_check_in_out) {\r\n    //   return false;\r\n    // }\r\n    // if (this.isCheckedIn()) {\r\n    //   return false;\r\n    // }\r\n    // const now = moment();\r\n    // if (\r\n    //   this.canCheckInOrCheckout ||\r\n    //   (moment().isSame(new Date(this.bookingEvent.TO_DATE), 'days') &&\r\n    //     !compareTime(now.toDate(), createDateWithOffsetAndHour(calendar_data.checkin_checkout_hours?.offset, calendar_data.checkin_checkout_hours?.hour)))\r\n    // ) {\r\n    //   return true;\r\n    // }\r\n    // return false;\r\n    return canCheckIn({\r\n      from_date: this.bookingEvent.FROM_DATE,\r\n      to_date: this.bookingEvent.TO_DATE,\r\n      isCheckedIn: this.isCheckedIn(),\r\n    });\r\n  }\r\n\r\n  private canCheckOut() {\r\n    if (!calendar_data.checkin_enabled || calendar_data.is_automatic_check_in_out) {\r\n      return false;\r\n    }\r\n    if (this.isCheckedIn()) {\r\n      return true;\r\n    }\r\n    const now = moment();\r\n    if (\r\n      this.bookingEvent.ROOM_INFO?.in_out?.code === '000' &&\r\n      moment().isSameOrAfter(new Date(this.bookingEvent.TO_DATE), 'days') &&\r\n      compareTime(now.toDate(), createDateWithOffsetAndHour(calendar_data.checkin_checkout_hours?.offset, calendar_data.checkin_checkout_hours?.hour))\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  private handleBlockDateUpdate(event: CustomEvent<{ [key: string]: any }>) {\r\n    event.stopImmediatePropagation();\r\n    event.stopPropagation();\r\n    const opt: { [key: string]: any } = event.detail;\r\n    this.bookingEvent = { ...this.bookingEvent, ...opt.data };\r\n    //console.log(\"blocked date booking event\", this.bookingEvent);\r\n  }\r\n\r\n  private handleEditBooking() {\r\n    // console.log(\"Edit booking\");\r\n    this.bookingEvent.TITLE = locales.entries.Lcz_EditBookingFor;\r\n    this.handleBookingOption('EDIT_BOOKING');\r\n  }\r\n\r\n  private getStringDateFormat(dt) {\r\n    return dt.getFullYear() + '-' + (dt.getMonth() < 9 ? '0' : '') + (dt.getMonth() + 1) + '-' + (dt.getDate() <= 9 ? '0' : '') + dt.getDate();\r\n  }\r\n\r\n  private handleAddRoom() {\r\n    let fromDate = new Date(this.bookingEvent.FROM_DATE);\r\n    fromDate.setHours(0, 0, 0, 0);\r\n    let from_date_str = this.getStringDateFormat(fromDate);\r\n\r\n    let toDate = new Date(this.bookingEvent.TO_DATE);\r\n    //toDate.setDate(toDate.getDate() + 1);\r\n    toDate.setHours(0, 0, 0, 0);\r\n    let to_date_str = this.getStringDateFormat(toDate);\r\n    // console.log(this.bookingEvent);\r\n    let eventData = {\r\n      ID: '',\r\n      NAME: '',\r\n      BOOKING_NUMBER: this.bookingEvent.BOOKING_NUMBER,\r\n      FROM_DATE: from_date_str, // \"2023-07-09\",\r\n      TO_DATE: to_date_str, // \"2023-07-11\",\r\n      roomsInfo: this.bookingEvent.roomsInfo,\r\n      ARRIVAL: this.bookingEvent.ARRIVAL,\r\n      ADD_ROOM_TO_BOOKING: this.bookingEvent.ID,\r\n      TITLE: 'Add Room to #' + this.bookingEvent.BOOKING_NUMBER,\r\n      event_type: 'ADD_ROOM',\r\n      ROOMS: this.bookingEvent.ROOMS,\r\n      GUEST: this.bookingEvent.GUEST,\r\n      message: this.bookingEvent.NOTES,\r\n      SOURCE: this.bookingEvent.SOURCE,\r\n      booking: this.bookingEvent?.booking,\r\n      defaultDateRange: {\r\n        fromDate: fromDate,\r\n        fromDateStr: '',\r\n        toDate: toDate,\r\n        toDateStr: '',\r\n        dateDifference: 0,\r\n        editabled: true,\r\n        message: 'Including 5.00% City Tax - Excluding 11.00% VAT',\r\n      },\r\n    };\r\n\r\n    this.handleBookingOption('ADD_ROOM', eventData);\r\n  }\r\n\r\n  private handleCustomerCheckIn() {\r\n    const { adult_nbr, children_nbr, infant_nbr } = this.bookingEvent.ROOM_INFO.occupancy;\r\n    this.showDialog.emit({\r\n      reason: 'checkin',\r\n      bookingNumber: this.bookingEvent.BOOKING_NUMBER,\r\n      roomIdentifier: this.bookingEvent.IDENTIFIER,\r\n      roomName: '',\r\n      roomUnit: '',\r\n      sidebarPayload: {\r\n        identifier: this.bookingEvent.IDENTIFIER,\r\n        bookingNumber: this.bookingEvent.BOOKING_NUMBER,\r\n        checkin: false,\r\n        roomName: this.bookingEvent.ROOM_INFO.unit?.name ?? '',\r\n        sharing_persons: this.bookingEvent.ROOM_INFO.sharing_persons,\r\n        totalGuests: adult_nbr + children_nbr + infant_nbr,\r\n      },\r\n    });\r\n  }\r\n\r\n  private handleCustomerCheckOut() {\r\n    this.showDialog.emit({ reason: 'checkout', bookingNumber: this.bookingEvent.BOOKING_NUMBER, roomIdentifier: this.bookingEvent.IDENTIFIER, roomName: '', roomUnit: '' });\r\n  }\r\n\r\n  private handleDeleteEvent() {\r\n    this.hideBubble();\r\n    this.deleteButton.emit(this.bookingEvent.POOL);\r\n    console.log('Delete Event');\r\n  }\r\n\r\n  private async handleUpdateBlockedDates() {\r\n    try {\r\n      this.isLoading = 'update';\r\n      setTimeout(() => {\r\n        this.hideBubble();\r\n      }, 50);\r\n      await this.eventService.updateBlockedEvent(this.bookingEvent);\r\n      this.isLoading = '';\r\n    } catch (error) {\r\n      //   toastr.error(error);\r\n    }\r\n  }\r\n\r\n  private handleConvertBlockedDateToBooking() {\r\n    this.handleBookingOption('BAR_BOOKING');\r\n  }\r\n\r\n  private getRoomInfo() {\r\n    const roomIdToFind = +this.bookingEvent.PR_ID;\r\n    let selectedRoom: any = {};\r\n\r\n    for (const room of this.bookingEvent.roomsInfo) {\r\n      for (const physicalRoom of room.physicalrooms) {\r\n        if (roomIdToFind === physicalRoom.id) {\r\n          selectedRoom.CATEGORY = room.name;\r\n          selectedRoom.ROOM_NAME = physicalRoom.name;\r\n          selectedRoom.ROOMS_INFO = room;\r\n          return selectedRoom;\r\n        }\r\n      }\r\n    }\r\n\r\n    return selectedRoom;\r\n  }\r\n  private renderTitle(eventType, roomInfo) {\r\n    switch (eventType) {\r\n      case 'EDIT_BOOKING':\r\n        return `${locales.entries.Lcz_EditBookingFor} ${roomInfo.CATEGORY} ${roomInfo.ROOM_NAME}`;\r\n      case 'ADD_ROOM':\r\n        return `${locales.entries.Lcz_AddingUnitToBooking}# ${this.bookingEvent.BOOKING_NUMBER}`;\r\n      case 'SPLIT_BOOKING':\r\n        return locales.entries.Lcz_Adding + ` ${roomInfo.CATEGORY} ${roomInfo.ROOM_NAME}`;\r\n      default:\r\n        return `${locales.entries.Lcz_NewBookingFor} ${roomInfo.CATEGORY} ${roomInfo.ROOM_NAME}`;\r\n    }\r\n  }\r\n  private handleBookingOption(eventType, roomData = null) {\r\n    const roomInfo = this.getRoomInfo();\r\n    let data = roomData ? roomData : this.bookingEvent;\r\n    data.event_type = eventType;\r\n    data.TITLE = this.renderTitle(eventType, roomInfo);\r\n\r\n    if (['003', '002', '004'].includes(this.bookingEvent.STATUS_CODE)) {\r\n      data.roomsInfo = [roomInfo.ROOMS_INFO];\r\n    }\r\n    if (eventType === 'BAR_BOOKING' && this.bookingEvent.STATUS !== 'TEMP-EVENT') {\r\n      const { FROM_DATE, TO_DATE, PR_ID, RELEASE_AFTER_HOURS, ENTRY_DATE, OPTIONAL_REASON, ENTRY_MINUTE, ENTRY_HOUR, STATUS_CODE } = this.bookingEvent;\r\n      data.block_exposed_unit_props = {\r\n        from_date: FROM_DATE,\r\n        to_date: TO_DATE,\r\n        NOTES: OPTIONAL_REASON,\r\n        pr_id: PR_ID,\r\n        STAY_STATUS_CODE: STATUS_CODE,\r\n        DESCRIPTION: RELEASE_AFTER_HOURS,\r\n        BLOCKED_TILL_DATE: ENTRY_DATE,\r\n        BLOCKED_TILL_HOUR: ENTRY_HOUR,\r\n        BLOCKED_TILL_MINUTE: ENTRY_MINUTE,\r\n      };\r\n      this.handleDeleteEvent();\r\n    }\r\n    this.showBookingPopup.emit({\r\n      key: 'add',\r\n      data: {\r\n        ...data,\r\n        //roomsInfo: [roomInfo.ROOMS_INFO],\r\n      },\r\n    });\r\n    this.hideBubbleInfo.emit({\r\n      key: 'hidebubble',\r\n      currentInfoBubbleId: this.getBookingId(),\r\n    });\r\n  }\r\n  // private renderNote() {\r\n  //   const { is_direct, ota_notes } = this.bookingEvent;\r\n  //   const guestNote = this.getGuestNote();\r\n  //   const noteLabel = locales.entries.Lcz_Note + ':';\r\n\r\n  //   if (!is_direct && ota_notes) {\r\n  //     return (\r\n  //       <div class=\"row p-0 m-0\">\r\n  //         <div class=\"col-12 px-0 text-wrap d-flex\">\r\n  //           <ota-label label={noteLabel} remarks={ota_notes}></ota-label>\r\n  //         </div>\r\n  //       </div>\r\n  //     );\r\n  //   } else if (is_direct && guestNote) {\r\n  //     return (\r\n  //       <div class=\"row p-0 m-0\">\r\n  //         <div class=\"col-12 px-0 text-wrap d-flex\">\r\n  //           <Fragment>\r\n  //             <span class=\"font-weight-bold\">{noteLabel} </span>\r\n  //             {guestNote}\r\n  //           </Fragment>\r\n  //         </div>\r\n  //       </div>\r\n  //     );\r\n  //   }\r\n  //   return null;\r\n  // }\r\n\r\n  private getInfoElement() {\r\n    return (\r\n      <div class={`iglPopOver infoBubble ${this.bubbleInfoTop ? 'bubbleInfoAbove' : ''} text-left`}>\r\n        <div class={`row p-0 m-0  ${this.bookingEvent.BALANCE > 1 ? 'pb-0' : 'pb-1'}`}>\r\n          <div class=\"px-0  col-8 font-weight-bold font-medium-1 d-flex align-items-center\">\r\n            <img src={this.bookingEvent?.origin?.Icon} alt={this.bookingEvent?.origin?.Label} class={'icon-image'} />\r\n            <p class={'p-0 m-0'}>{!this.bookingEvent.is_direct ? this.bookingEvent.channel_booking_nbr : this.bookingEvent.BOOKING_NUMBER}</p>\r\n          </div>\r\n          <div class=\"pr-0 col-4 text-right\">{formatAmount(this.currency.symbol, this.getTotalPrice())}</div>\r\n        </div>\r\n        {this.bookingEvent.BALANCE > 1 && (\r\n          <p class=\"pr-0 m-0 p-0 text-right balance_amount\">\r\n            {locales.entries.Lcz_Balance}: {formatAmount(this.currency.symbol, this.bookingEvent.BALANCE)}\r\n          </p>\r\n        )}\r\n        <div class=\"row p-0 m-0\">\r\n          <div class=\"px-0 pr-0 col-12\">\r\n            <ir-date-view from_date={this.bookingEvent.defaultDates.from_date} to_date={this.bookingEvent.defaultDates.to_date} showDateDifference={false}></ir-date-view>\r\n            {/* <span class=\"font-weight-bold\">{locales.entries.Lcz_In}: </span> */}\r\n          </div>\r\n        </div>\r\n        {this.getArrivalTime() && (\r\n          // <div class=\"row p-0 m-0\">\r\n          //   <div class=\"px-0 col-12\">\r\n          //     <span class=\"font-weight-bold\">{locales.entries.Lcz_ArrivalTime}: </span>\r\n          //     {this.getArrivalTime()}\r\n          //   </div>\r\n          // </div>\r\n          <ir-label containerStyle={{ padding: '0', margin: '0' }} class=\"m-0 p-0\" labelText={`${locales.entries.Lcz_ArrivalTime}:`} content={this.getArrivalTime()}></ir-label>\r\n        )}\r\n        {this.getTotalOccupants() && (\r\n          // <div class=\"row p-0 m-0\">\r\n          //   <div class=\"px-0  col-12\">\r\n          //     <span class=\"font-weight-bold\">{locales.entries.Lcz_Occupancy}: </span>\r\n          //     {this.getTotalOccupants()}\r\n          //   </div>\r\n          // </div>\r\n\r\n          <ir-label class=\"m-0 p-0\" containerStyle={{ padding: '0', margin: '0' }} labelText={`${locales.entries.Lcz_Occupancy}:`} content={this.getTotalOccupants()}></ir-label>\r\n        )}\r\n        {this.getPhoneNumber() && (\r\n          // <div class=\"row p-0 m-0\">\r\n          //   <div class=\"px-0  col-12 text-wrap\">\r\n          //     <span class=\"font-weight-bold\">{locales.entries.Lcz_Phone}: </span>\r\n          //     {this.renderPhone()}\r\n          //   </div>\r\n          // </div>\r\n          <ir-label containerStyle={{ padding: '0', margin: '0' }} class=\"m-0 p-0\" labelText={`${locales.entries.Lcz_Phone}:`} content={this.renderPhone()}></ir-label>\r\n        )}\r\n        {this.getRatePlan() && (\r\n          // <div class=\"row p-0 m-0\">\r\n          //   <div class=\"px-0  col-12\">\r\n          //     <span class=\"font-weight-bold\">{locales.entries.Lcz_RatePlan}: </span>\r\n          //     {this.getRatePlan()}\r\n          //   </div>\r\n          // </div>\r\n          <ir-label containerStyle={{ padding: '0', margin: '0' }} class=\"m-0 p-0\" labelText={`${locales.entries.Lcz_RatePlan}:`} content={this.getRatePlan()}></ir-label>\r\n        )}\r\n        {this.bookingEvent.PRIVATE_NOTE && (\r\n          // <div class=\"row p-0 m-0\">\r\n          //   <div class=\"px-0  col-12 text-wrap\">\r\n          //     <span class=\"font-weight-bold\">{locales.entries.Lcz_PrivateNote}: </span>\r\n          //     {this.bookingEvent.PRIVATE_NOTE}\r\n          //   </div>\r\n          // </div>\r\n          <ir-label\r\n            containerStyle={{ padding: '0', margin: '0' }}\r\n            class=\"m-0 p-0\"\r\n            labelText={`${locales.entries.Lcz_BookingPrivateNote}:`}\r\n            display=\"inline\"\r\n            content={this.bookingEvent.PRIVATE_NOTE}\r\n          ></ir-label>\r\n        )}\r\n\r\n        {/* {this.renderNote()} */}\r\n        {this.bookingEvent.is_direct ? (\r\n          <ir-label containerStyle={{ padding: '0', margin: '0' }} labelText={`${locales.entries.Lcz_GuestRemark}:`} display=\"inline\" content={this.bookingEvent.NOTES}></ir-label>\r\n        ) : (\r\n          <ota-label\r\n            class={'m-0 p-0'}\r\n            label={`${locales.entries.Lcz_ChannelNotes || 'Channel notes'}:`}\r\n            remarks={this.bookingEvent.ota_notes}\r\n            maxVisibleItems={this.bookingEvent.ota_notes?.length}\r\n          ></ota-label>\r\n        )}\r\n        {/* {this.getInternalNote() ? (\r\n          <div class=\"row p-0 m-0\">\r\n            <div class=\"col-12 px-0 text-wrap\">\r\n              {this.bookingEvent.is_direct ? (\r\n                <Fragment>\r\n                  <span class=\"font-weight-bold\">{locales.entries.Lcz_InternalRemark}: </span>\r\n                  {this.getInternalNote()}\r\n                </Fragment>\r\n              ) : (\r\n                <ota-label label={`${locales.entries.Lcz_InternalRemark}:`} remarks={this.bookingEvent.ota_notes}></ota-label>\r\n              )}\r\n            </div>\r\n          </div>\r\n        ) : null} */}\r\n        {this.getInternalNote() && <ir-label labelText={`${locales.entries.Lcz_InternalRemark}:`} content={this.getInternalNote()}></ir-label>}\r\n        <div class=\"row p-0 m-0 mt-2\">\r\n          <div class=\"full-width d-flex align-items-center\" style={{ gap: '0.25rem' }} role=\"group\">\r\n            <ir-button\r\n              style={{ '--icon-size': '0.875rem' }}\r\n              onClickHandler={() => this.handleEditBooking()}\r\n              class={'w-100'}\r\n              btn_block\r\n              text={locales.entries.Lcz_Edit}\r\n              icon_name=\"edit\"\r\n              btn_styles=\"h-100\"\r\n              size=\"sm\"\r\n            ></ir-button>\r\n            {this.bookingEvent.is_direct && this.bookingEvent.IS_EDITABLE && !this.hideButtons && (\r\n              <ir-button\r\n                style={{ '--icon-size': '0.875rem' }}\r\n                text={locales.entries.Lcz_AddRoom}\r\n                icon_name=\"square_plus\"\r\n                size=\"sm\"\r\n                class={'w-100'}\r\n                btn_styles=\"h-100\"\r\n                onClickHandler={() => this.handleAddRoom()}\r\n              ></ir-button>\r\n            )}\r\n            {this.canCheckIn() && (\r\n              <ir-button\r\n                class={'w-100'}\r\n                style={{ '--icon-size': '0.875rem' }}\r\n                text={locales.entries.Lcz_CheckIn}\r\n                onClickHandler={() => this.handleCustomerCheckIn()}\r\n                icon_name=\"edit\"\r\n                btn_styles=\"h-100\"\r\n                size=\"sm\"\r\n              ></ir-button>\r\n            )}\r\n            {this.canCheckOut() && (\r\n              <ir-button\r\n                class={'w-100'}\r\n                btn_styles=\"h-100\"\r\n                style={{ '--icon-size': '0.875rem' }}\r\n                text={locales.entries.Lcz_CheckOut}\r\n                icon_name=\"edit\"\r\n                onClickHandler={() => this.handleCustomerCheckOut()}\r\n                size=\"sm\"\r\n              ></ir-button>\r\n            )}\r\n            {this.hideButtons\r\n              ? null\r\n              : !this.shouldHideUnassignUnit && (\r\n                  <ir-button\r\n                    class={'w-100'}\r\n                    btn_styles=\"h-100\"\r\n                    style={{ '--icon-size': '0.875rem' }}\r\n                    size=\"sm\"\r\n                    text={locales.entries.Lcz_Unassign}\r\n                    icon_name=\"xmark\"\r\n                    onClickHandler={_ => {\r\n                      this.handleDeleteEvent();\r\n                    }}\r\n                  ></ir-button>\r\n                )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private getNewBookingOptions() {\r\n    const shouldDisplayButtons = this.bookingEvent.roomsInfo[0].rateplans.some(rate => rate.is_active);\r\n    return (\r\n      <div class={`iglPopOver d-flex flex-column newBookingOptions ${this.bubbleInfoTop ? 'bubbleInfoAbove' : ''} text-left`} style={{ gap: '0.5rem' }}>\r\n        {shouldDisplayButtons ? (\r\n          <Fragment>\r\n            {/* <div class={'mb-1'}> */}\r\n            <ir-button\r\n              size=\"sm\"\r\n              btn_block\r\n              data-testid=\"bar_booking_btn\"\r\n              text={locales.entries.Lcz_CreateNewBooking}\r\n              onClickHandler={_ => {\r\n                this.handleBookingOption('BAR_BOOKING');\r\n              }}\r\n            ></ir-button>\r\n            {/* </div> */}\r\n            {/* <div> */}\r\n            {this.hasSplitBooking() && (\r\n              // <div class=\"mb-1\">\r\n              <ir-button\r\n                size=\"sm\"\r\n                btn_block\r\n                text={locales.entries.Lcz_AssignUnitToExistingBooking}\r\n                onClickHandler={_ => {\r\n                  this.handleBookingOption('SPLIT_BOOKING');\r\n                }}\r\n              ></ir-button>\r\n              // </div>\r\n            )}\r\n            {/* </div> */}\r\n          </Fragment>\r\n        ) : (\r\n          <p class={'text-danger'}>{locales.entries.Lcz_NoRatePlanDefined}</p>\r\n        )}\r\n        {/* <div> */}\r\n        <ir-button\r\n          size=\"sm\"\r\n          text={locales.entries.Lcz_Blockdates}\r\n          btn_block\r\n          onClickHandler={_ => {\r\n            this.handleBookingOption('BLOCK_DATES');\r\n          }}\r\n        ></ir-button>\r\n        {/* </div> */}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private getBlockedView() {\r\n    console.log('booking event', this.bookingEvent);\r\n    // let defaultData = {RELEASE_AFTER_HOURS: 0, OPTIONAL_REASON: \"\", OUT_OF_SERVICE: false};\r\n    return (\r\n      <div class={`iglPopOver blockedView ${this.bubbleInfoTop ? 'bubbleInfoAbove' : ''} text-left`}>\r\n        <igl-block-dates-view\r\n          isEventHover={true}\r\n          entryHour={this.bookingEvent.ENTRY_HOUR}\r\n          entryMinute={this.bookingEvent.ENTRY_MINUTE}\r\n          defaultData={this.bookingEvent}\r\n          fromDate={this.bookingEvent.defaultDates.from_date}\r\n          toDate={this.bookingEvent.defaultDates.to_date}\r\n          entryDate={this.getEntryDate()}\r\n          onDataUpdateEvent={event => this.handleBlockDateUpdate(event)}\r\n        ></igl-block-dates-view>\r\n        <div class=\"row p-0 m-0 mt-2\">\r\n          <div class=\"full-width d-flex align-items-center\" style={{ gap: '0.25rem' }} role=\"group\">\r\n            <ir-button\r\n              btn_disabled={this.isLoading === 'update'}\r\n              text={locales.entries.Lcz_Update}\r\n              onClickHandler={_ => {\r\n                this.handleUpdateBlockedDates();\r\n              }}\r\n              icon_name=\"edit\"\r\n              size=\"sm\"\r\n              btn_styles=\"h-100\"\r\n              isLoading={this.isLoading === 'update'}\r\n              style={{ '--icon-size': '0.875rem' }}\r\n              btn_block\r\n              class={'w-100'}\r\n            ></ir-button>\r\n            <ir-button\r\n              class={'w-100 h-100 my-0'}\r\n              btn_block\r\n              btn_styles=\"h-100\"\r\n              size=\"sm\"\r\n              text={locales.entries.Lcz_ConvertToBooking}\r\n              onClickHandler={() => {\r\n                this.handleConvertBlockedDateToBooking();\r\n              }}\r\n            ></ir-button>\r\n\r\n            <ir-button\r\n              class={'w-100'}\r\n              btn_styles=\"h-100\"\r\n              btn_block\r\n              size=\"sm\"\r\n              style={{ '--icon-size': '0.875rem' }}\r\n              icon_name=\"trash\"\r\n              btn_color=\"danger\"\r\n              onClickHandler={_ => {\r\n                this.handleDeleteEvent();\r\n              }}\r\n              text={locales.entries.Lcz_Delete}\r\n            ></ir-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <div class={`pointerContainer ${this.bubbleInfoTop ? 'pointerContainerTop' : ''}`}>\r\n          <div class={`bubblePointer ${this.bubbleInfoTop ? 'bubblePointTop' : 'bubblePointBottom'}`}></div>\r\n        </div>\r\n        {this.isBlockedDateEvent() ? this.getBlockedView() : null}\r\n        {this.isNewBooking() ? this.getNewBookingOptions() : null}\r\n        {!this.isBlockedDateEvent() && !this.isNewBooking() ? this.getInfoElement() : null}\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n",":host {\r\n  display: block;\r\n  width: 100%;\r\n  --hk-green: green;\r\n}\r\n* {\r\n  box-sizing: border-box;\r\n}\r\n.popover-title {\r\n  position: relative;\r\n  width: 100%;\r\n  height: 100%;\r\n  margin: 0;\r\n  padding: 0;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  z-index: 10;\r\n  left: 0;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.popover-container {\r\n  position: absolute;\r\n  bottom: 0px;\r\n  left: var(--ir-popover-left, 10px);\r\n  background: rgb(0, 0, 0);\r\n  color: white;\r\n  min-width: 100%;\r\n  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 10px;\r\n  z-index: 9999;\r\n  padding: 3.5px 7px;\r\n  border-radius: 5px;\r\n  pointer-events: none;\r\n  opacity: 0;\r\n  transition: all 100ms ease;\r\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\r\n  font-style: normal;\r\n  font-weight: 400;\r\n  line-height: 1.45;\r\n  text-decoration: none;\r\n  text-shadow: none;\r\n  font-size: 0.875rem;\r\n}\r\n.popover-container[data-state='show'] {\r\n  opacity: 1;\r\n}\r\n.hk-dot {\r\n  inset: 0;\r\n  position: absolute;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: fit-content;\r\n  padding: 4px;\r\n  left: auto;\r\n  padding-inline: var(--ir-popover-left);\r\n\r\n  color: var(--dot-color, #ffffff);\r\n}\r\n/* .hk-dot::after {\r\n  content: '';\r\n  height: 8px;\r\n  aspect-ratio: 1;\r\n  border-radius: 9999999px;\r\n  background: var(--dot-color, #ffffff);\r\n} */\r\n","import { Component, Host, Prop, h, Element } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'ir-interactive-title',\r\n  styleUrl: 'ir-interactive-title.css',\r\n  scoped: true,\r\n})\r\nexport class IrInteractiveTitle {\r\n  @Element() el: HTMLElement;\r\n\r\n  @Prop() popoverTitle: string;\r\n  @Prop() irPopoverLeft: string = '10px';\r\n  @Prop() hkStatus: boolean;\r\n  @Prop() cropSize: number = 15;\r\n\r\n  private croppedTitle: string;\r\n  private croppedTitleEl: HTMLSpanElement;\r\n\r\n  // private hkStatusColors = {\r\n  //   green: '#57f707',\r\n  //   red: 'rgb(199, 139, 36)',\r\n  //   orange: '#ff9149',\r\n  //   black: '#ff4961',\r\n  // };\r\n  componentWillLoad() {\r\n    this.croppedTitle = this.popoverTitle;\r\n  }\r\n  componentDidLoad() {\r\n    this.initializePopover();\r\n  }\r\n\r\n  initializePopover() {\r\n    const titleElement = this.el.querySelector('.popover-title') as HTMLElement;\r\n\r\n    if (titleElement) {\r\n      const isOverflowing = titleElement.scrollWidth > titleElement.offsetWidth;\r\n\r\n      if (isOverflowing) {\r\n        this.croppedTitle = this.popoverTitle.slice(0, this.cropSize) + '...';\r\n        this.croppedTitleEl.innerHTML = this.croppedTitle;\r\n        ($(titleElement) as any).popover({\r\n          trigger: 'hover',\r\n          content: this.popoverTitle,\r\n          placement: 'top',\r\n        });\r\n      } else {\r\n        ($(titleElement) as any).popover('dispose');\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host style={{ '--ir-popover-left': this.irPopoverLeft }}>\r\n        <p\r\n          class=\"popover-title\"\r\n          style={{\r\n            whiteSpace: 'nowrap',\r\n            overflow: 'hidden',\r\n            textOverflow: 'ellipsis',\r\n          }}\r\n        >\r\n          <span ref={el => (this.croppedTitleEl = el)} class=\"croppedTitle\">\r\n            {this.croppedTitle}\r\n          </span>\r\n          {/* {this.hkStatus && this.hkStatusColors[this.hkStatus] && <div title=\"occupied\" style={{ '--dot-color': this.hkStatusColors[this.hkStatus] }} class={`hk-dot`}></div>} */}\r\n          {this.hkStatus && (\r\n            <div title=\"This unit is dirty\" class={`hk-dot`}>\r\n              <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"13.5\" viewBox=\"0 0 576 512\">\r\n                <path\r\n                  // fill=\"currentColor\"\r\n                  d=\"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n          )}\r\n        </p>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}