import{a as t}from"./p-06203439.js";import{i as e,b as n,e as o,c as r,h as a,d as s}from"./p-4743e9d1.js";import{h as i}from"./p-6c4ba7c0.js";import{l as c}from"./p-806fad31.js";import{c as _}from"./p-6bab2172.js";import{c as l}from"./p-4eb12235.js";import{T as E}from"./p-dfa14c12.js";const u={days:[],months:[],fromDate:"",toDate:""};const{state:d,onChange:T}=l(u);async function f(t){const e=[];const n=await A();for(const o of t){for(const t of o.days){for(const o of t.room_types){O(o.physicalrooms,e,n)}}}return e}function O(t,e,n){for(const o of t){for(const t in o.calendar_cell){if(o.calendar_cell[t].Is_Available===false){N(o.calendar_cell[t],e,n)}}}}const h={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const w={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function D(t,e){if(t===null&&e===null)return"";if(e!==null&&e!==""){return`${t!==null&&t!==void 0?t:""} , ${e!==null&&e!==void 0?e:""}`}return t}async function A(){try{const e=_.token;if(e){const{data:n}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_Multi?Ticket=${e}`,{TBL_NAMES:["_STAY_STATUS"]});return n.My_Result.map((t=>({code:t.CODE_NAME,value:t.CODE_VALUE_EN})))}else{throw new Error("Invalid Token")}}catch(t){console.log(t)}}function R(t,e,n){const o=new Date(t);o.setHours(e);o.setMinutes(n);return`${c.entries.Lcz_BlockedTill} ${i(o).format("MMM DD, HH:mm")}`}function y(t,o){var r,a,s,c;if(e(t.STAY_STATUS_CODE)){const e=i(t.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.from_date:t.DATE;const r=i(t.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.to_date:t.DATE;return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.My_Block_Info.NOTES!==""?t.My_Block_Info.NOTES:t.STAY_STATUS_CODE==="003"?R(t.My_Block_Info.BLOCKED_TILL_DATE,t.My_Block_Info.BLOCKED_TILL_HOUR,t.My_Block_Info.BLOCKED_TILL_MINUTE):o.find((e=>e.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.My_Block_Info.DESCRIPTION,PR_ID:t.My_Block_Info.pr_id,ENTRY_DATE:t.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:t.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.My_Block_Info.NOTES,FROM_DATE:e,TO_DATE:r,NO_OF_DAYS:n(e,r),STATUS:h[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.My_Block_Info.format.from_date,TO_DATE_STR:t.My_Block_Info.format.to_date,defaultDates:{from_date:t.My_Block_Info.from_date,to_date:t.My_Block_Info.to_date}}}if(t.booking.booking_nbr.toString()==="23080178267"){console.log("booking",t)}const _=i(t.room.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.from_date:t.DATE;const l=i(t.room.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.to_date:t.DATE;return{ID:t.POOL,FROM_DATE:_,TO_DATE:l,NO_OF_DAYS:n(_,l),STATUS:w[(r=t.booking)===null||r===void 0?void 0:r.status.code],NAME:D(t.room.guest.first_name,t.room.guest.last_name),IDENTIFIER:t.room.identifier,PR_ID:t.pr_id,POOL:t.POOL,BOOKING_NUMBER:t.booking.booking_nbr,NOTES:t.booking.is_direct?t.booking.remark:null,PRIVATE_NOTE:I(t.booking.extras),is_direct:t.booking.is_direct,BALANCE:(a=t.booking.financial)===null||a===void 0?void 0:a.due_amount,channel_booking_nbr:t.booking.channel_booking_nbr,ARRIVAL_TIME:t.booking.arrival.description,defaultDates:{from_date:t.room.from_date,to_date:t.room.to_date},ENTRY_DATE:t.booking.booked_on.date,PHONE_PREFIX:t.booking.guest.country_phone_prefix,IS_EDITABLE:t.booking.is_editable,ARRIVAL:t.booking.arrival,PHONE:(s=t.booking.guest.mobile)!==null&&s!==void 0?s:"",RATE:t.room.total,RATE_PLAN:t.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:t.room.rateplan.id,RATE_TYPE:1,ADULTS_COUNT:t.room.occupancy.adult_nbr,CHILDREN_COUNT:t.room.occupancy.children_nbr,origin:t.booking.origin,GUEST:t.booking.guest,ROOMS:t.booking.rooms,cancelation:t.room.rateplan.cancelation,guarantee:t.room.rateplan.guarantee,TOTAL_PRICE:(c=t.booking.financial)===null||c===void 0?void 0:c.gross_total,COUNTRY:t.booking.guest.country_id,FROM_DATE_STR:t.booking.format.from_date,TO_DATE_STR:t.booking.format.to_date,adult_child_offering:t.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:t.booking.source.code,description:t.booking.source.description,tag:t.booking.source.tag}}}function N(t,e,n){const o=e.findIndex((e=>e.POOL===t.POOL));if(o===-1){const o=y(t,n);e.push(o)}}function I(t){var e;if(!t){return null}return((e=t.find((t=>t.key==="private_note")))===null||e===void 0?void 0:e.value)||null}function p(t){let e=[];const n=e=>{const n=i();const o=i(e.to_date,"YYYY-MM-DD");const r=i(e.from_date,"YYYY-MM-DD");if(r.isSame(n,"day")&&n.hour()>=12){return w["000"]}else if(n.isAfter(r,"day")&&n.isBefore(o,"day")){return w["000"]}else if(o.isSame(n,"day")&&n.hour()<12){return w["000"]}else if(o.isSame(n,"day")&&n.hour()>=12||o.isBefore(n,"day")){return w["003"]}else{return w[(t===null||t===void 0?void 0:t.status.code)||"001"]}};const o=t.rooms.filter((t=>!!t["assigned_units_pool"]));o.forEach((o=>{var r,a,s;const c=i(o.from_date,"YYYY-MM-DD").isAfter(i(d.fromDate,"YYYY-MM-DD"))?o.from_date:d.fromDate;const _=i(o.to_date,"YYYY-MM-DD").isAfter(i(d.toDate,"YYYY-MM-DD"))?o.to_date:d.toDate;console.log(_,c,o.from_date,o.to_date);e.push({ID:o["assigned_units_pool"],TO_DATE:o.to_date,FROM_DATE:o.from_date,PRIVATE_NOTE:I(t.extras),NO_OF_DAYS:o.days.length,ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(r=t.financial)===null||r===void 0?void 0:r.due_amount,STATUS:n(o),NAME:D(o.guest.first_name,o.guest.last_name),PHONE:(a=t.guest.mobile)!==null&&a!==void 0?a:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:o.total,RATE_PLAN:o.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:o.rateplan.id,IDENTIFIER:o.identifier,RATE_TYPE:o.roomtype.id,ADULTS_COUNT:o.occupancy.adult_nbr,CHILDREN_COUNT:o.occupancy.children_nbr,PR_ID:+o.unit.id,POOL:o["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:o.rateplan.cancelation,guarantee:o.rateplan.guarantee,TOTAL_PRICE:(s=t.financial)===null||s===void 0?void 0:s.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:o.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:o.from_date,to_date:o.to_date}})}));return e}async function M(t){const e=await A();return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.NOTES!==""?t.NOTES:t.STAY_STATUS_CODE==="003"?R(t.BLOCKED_TILL_DATE,t.BLOCKED_TILL_HOUR,t.BLOCKED_TILL_MINUTE):e.find((e=>e.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.DESCRIPTION,PR_ID:t.pr_id,ENTRY_DATE:t.BLOCKED_TILL_DATE,ENTRY_HOUR:t.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.NOTES,FROM_DATE:t.from_date,TO_DATE:t.to_date,NO_OF_DAYS:Y(t.from_date,t.to_date),STATUS:h[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,defaultDates:{from_date:t.from_date,to_date:t.to_date}}}function Y(t,e){const n=i(t,"YYYY-MM-DD");const o=i(e,"YYYY-MM-DD");const r=o.diff(n,"days");return r||1}var S=undefined&&undefined.__rest||function(t,e){var n={};for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0)n[o]=t[o];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++){if(e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r]))n[o[r]]=t[o[r]]}return n};class b extends E{async getCalendarData(e,n,s){try{const i=this.getToken();if(i!==null){const{data:c}=await t.post(`/Get_Exposed_Calendar?Ticket=${i}`,{propertyid:e,from_date:n,to_date:s,extras:o});if(c.ExceptionMsg!==""){throw new Error(c.ExceptionMsg)}const _=c.My_Result.months;const l=[];const E=await f(_);const u=_.map((t=>{l.push({daysCount:t.days.length,monthName:t.description});return t.days.map((e=>({day:r(e.description,t.description),currentDate:a(e.description,t.description),dayDisplayName:e.description,rate:e.room_types,unassigned_units_nbr:e.unassigned_units_nbr,occupancy:e.occupancy})))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:e,FROM:c.My_Params_Get_Exposed_Calendar.from_date,TO:c.My_Params_Get_Exposed_Calendar.to_date},days:u,months:l,myBookings:E,defaultMonths:_})}}catch(t){console.error(t)}}async fetchGuest(e){try{const n=this.getToken();if(n!==null){const{data:o}=await t.post(`/Get_Exposed_Guest?Ticket=${n}`,{email:e});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}}catch(t){console.log(t);throw new Error(t)}}async fetchPMSLogs(e){try{const n=this.getToken();if(n!==null){const{data:o}=await t.post(`/Get_Exposed_PMS_Logs?Ticket=${n}`,{booking_nbr:e});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}}catch(t){console.log(t);throw new Error(t)}}async editExposedGuest(e,n){try{const o=this.getToken();if(o!==null){const{data:r}=await t.post(`/Edit_Exposed_Guest?Ticket=${o}`,Object.assign(Object.assign({},e),{book_nbr:n}));if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}}catch(t){console.log(t);throw new Error(t)}}async getBookingAvailability(e){try{const n=this.getToken();if(n){const{adultChildCount:o,currency:r}=e,a=S(e,["adultChildCount","currency"]);const{data:s}=await t.post(`/Get_Exposed_Booking_Availability?Ticket=${n}`,Object.assign(Object.assign({},a),{adult_nbr:o.adult,child_nbr:o.child,currency_ref:r.code,is_backend:true}));if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}return s["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async getCountries(e){try{const n=this.getToken();if(n){const{data:o}=await t.post(`/Get_Exposed_Countries?Ticket=${n}`,{language:e});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}}catch(t){console.error(t);throw new Error(t)}}async fetchSetupEntries(){try{const e=this.getToken();if(e){const{data:n}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI?Ticket=${e}`,{TBL_NAMES:["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}const o=n.My_Result;return{arrivalTime:o.filter((t=>t.TBL_NAME==="_ARRIVAL_TIME")),ratePricingMode:o.filter((t=>t.TBL_NAME==="_RATE_PRICING_MODE")),bedPreferenceType:o.filter((t=>t.TBL_NAME==="_BED_PREFERENCE_TYPE"))}}}catch(t){console.error(t);throw new Error(t)}}async getBlockedInfo(){try{const e=this.getToken();if(e){const{data:n}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI?Ticket=${e}`,{TBL_NAMES:["_CALENDAR_BLOCKED_TILL"]});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}}catch(t){console.error(t);throw new Error(t)}}async getUserDefaultCountry(){try{const e=this.getToken();if(e){const{data:n}=await t.post(`/Get_Country_By_IP?Ticket=${e}`,{IP:""});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n["My_Result"]}}catch(t){console.error(t);throw new Error(t)}}async blockUnit(e){try{const n=this.getToken();if(n){const{data:o}=await t.post(`/Block_Exposed_Unit?Ticket=${n}`,e);if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}console.log(o);return o["My_Params_Block_Exposed_Unit"]}}catch(t){console.error(t);throw new Error(t)}}async getUserInfo(e){try{const n=this.getToken();if(n){const{data:o}=await t.post(`/GET_EXPOSED_GUEST?Ticket=${n}`,{email:e});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}else{throw new Error("Invalid Token")}}catch(t){console.error(t);throw new Error(t)}}async getExposedBooking(e,n,r=true){try{const a=this.getToken();if(a){const{data:s}=await t.post(`/Get_Exposed_Booking?Ticket=${a}`,{booking_nbr:e,language:n,extras:r?o:null});if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}return s.My_Result}else{throw new Error("Invalid Token")}}catch(t){console.error(t)}}generateDays(t,e,n){const o=new Date(t);const r=new Date(e);const a=[];while(o<r){a.push({date:o.toISOString().split("T")[0],amount:n,cost:null});o.setDate(o.getDate()+1)}return a}calculateTotalRate(t,e,n,o){if(n&&o===2){return+t}return+t/+e}async fetchExposedGuest(e,n){try{const o=this.getToken();if(o){const{data:r}=await t.post(`/Fetch_Exposed_Guests?Ticket=${o}`,{email:e,property_id:n});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async fetchExposedBookings(e,n,o,r){try{const a=this.getToken();if(a){const{data:s}=await t.post(`/Fetch_Exposed_Bookings?Ticket=${a}`,{booking_nbr:e,property_id:n,from_date:o,to_date:r});if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}return s["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async getPCICardInfoURL(e){try{const n=this.getToken();if(n){const{data:o}=await t.post(`/Get_PCI_Card_Info_URL?Ticket=${n}`,{BOOK_NBR:e});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async doReservation(e){const n=this.getToken();if(!n){throw new Error("Missing token")}const{data:r}=await t.post(`/DoReservation?Ticket=${n}`,Object.assign(Object.assign({},e),{extras:e.extras?e.extras:o}));if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}console.log(r["My_Result"]);return r["My_Result"]}async bookUser({bookedByInfoData:t,check_in:e,currency:n,extras:o=null,fromDate:r,guestData:a,pickup_info:i,propertyid:c,rooms:_,source:l,toDate:E,totalNights:u,arrivalTime:d,bookingNumber:T,defaultGuest:f,identifier:O,pr_id:h}){try{const w=this.getToken();if(w){const w=s(r);const D=s(E);let A={email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.contactNumber===null?"":t.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:t.emailGuest||false,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null};if(f){A=Object.assign(Object.assign({},f),{email:f.email===""?null:f.email})}if(t.id){A=Object.assign(Object.assign({},A),{id:t.id})}const R={assign_units:true,check_in:e,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:o,booking:{booking_nbr:T||"",from_date:w,to_date:D,remark:t.message||null,property:{id:c},source:l,currency:n,arrival:{code:d?d:t.selectedArrivalTime},guest:A,rooms:[...a.map((t=>({identifier:O||null,roomtype:{id:t.roomCategoryId,name:t.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:t.inventory,rate:t.rate/u},rateplan:{id:t.ratePlanId,name:t.ratePlanName,rate_restrictions:null,variations:null,cancelation:t.cancelation,guarantee:t.guarantee},unit:typeof h==="undefined"&&t.roomId===""?null:{id:+h||+t.roomId},occupancy:{adult_nbr:t.adultCount,children_nbr:t.childrenCount,infant_nbr:null},bed_preference:t.preference,from_date:w,to_date:D,notes:null,days:this.generateDays(w,D,this.calculateTotalRate(t.rate,u,t.isRateModified,t.rateType)),guest:{email:null,first_name:t.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),..._]},pickup_info:i};console.log("book user payload",R);const y=await this.doReservation(R);return y}else{throw new Error("Invalid token")}}catch(t){console.error(t);throw new Error(t)}}}export{b as B,d as a,p as b,Y as c,w as d,D as f,I as g,M as t};
//# sourceMappingURL=p-2e24fdee.js.map