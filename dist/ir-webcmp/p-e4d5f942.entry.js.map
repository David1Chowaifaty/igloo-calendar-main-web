{"version":3,"names":["irPropertySwitcherDialogContentCss","IrPropertySwitcherDialogContentStyle0","IrPropertySwitcherDialogContent","open","selectedPropertyId","propertySelected","properties","filteredProperties","searchTerm","highlightedIndex","isLoading","error","inputRef","componentWillLoad","this","loadProperties","handleOpenChange","isOpen","requestAnimationFrame","focusInput","resetFilters","handleSelectedPropertyIdChange","syncHighlightedIndex","console","message","applyFilters","resetHighlight","query","trim","toLowerCase","filtered","filter","property","name","includes","length","selectedIndex","getSelectedIndex","ensureHighlightedVisible","list","findIndex","id","Math","min","max","handleSearchChange","event","detail","handleKeyDown","key","preventDefault","selectProperty","options","el","querySelectorAll","option","scrollIntoView","block","inline","emit","renderStatus","text","h","class","render","Host","autoFocus","ref","placeholder","value","onKeyDown","withClear","tabIndex","map","index","toString","onClick","selected","current"],"sources":["src/components/ir-property-switcher/ir-property-switcher-dialog-content.css?tag=ir-property-switcher-dialog-content&encapsulation=scoped","src/components/ir-property-switcher/ir-property-switcher-dialog-content.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.property-switcher__search-input {\n  padding: 1rem;\n}\n\n.property-switcher__results {\n  max-height: 250px;\n  overflow-y: auto;\n}\n\n.property-switcher__status {\n  padding: 1rem;\n  font-size: 0.875rem;\n  color: var(--ir-color-text-muted, #646464);\n}\n","import { Component, Element, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { AllowedProperties } from '@/services/property.service';\n\ntype AllowedProperty = NonNullable<AllowedProperties>[number];\n\n/**\n * Internal component responsible for rendering the searchable list of properties inside the switcher dialog.\n * It owns the data fetching, filtering and keyboard navigation logic so the parent dialog stays lean.\n */\n@Component({\n  tag: 'ir-property-switcher-dialog-content',\n  styleUrl: 'ir-property-switcher-dialog-content.css',\n  scoped: true,\n})\nexport class IrPropertySwitcherDialogContent {\n  @Element() el: HTMLIrPropertySwitcherDialogContentElement;\n\n  /** Whether the surrounding dialog is open. Used to focus and reset the search input as needed. */\n  @Prop() open: boolean = false;\n\n  /** ID of the property that is currently selected in the parent component. */\n  @Prop() selectedPropertyId?: number;\n\n  /** Emits whenever the user picks a property from the list. */\n  @Event({ bubbles: true, composed: true }) propertySelected: EventEmitter<AllowedProperty>;\n\n  @State() private properties: AllowedProperty[] = [];\n  @State() private filteredProperties: AllowedProperty[] = [];\n  @State() private searchTerm: string = '';\n  @State() private highlightedIndex: number = -1;\n  @State() private isLoading = false;\n  @State() private error: string | null = null;\n\n  // private propertyService = new PropertyService();\n  private inputRef?: HTMLIrInputElement;\n\n  componentWillLoad() {\n    this.loadProperties();\n  }\n\n  @Watch('open')\n  handleOpenChange(isOpen: boolean) {\n    if (!isOpen) {\n      return;\n    }\n    requestAnimationFrame(() => {\n      this.inputRef?.focusInput();\n      this.resetFilters();\n    });\n  }\n\n  @Watch('selectedPropertyId')\n  handleSelectedPropertyIdChange() {\n    this.syncHighlightedIndex();\n  }\n\n  private async loadProperties() {\n    this.isLoading = true;\n    this.error = null;\n    try {\n      // const result = await this.propertyService.getExposedAllowedProperties();\n      // this.properties = Array.isArray(result) ? result : [];\n      // this.applyFilters(true);\n    } catch (error) {\n      console.error('Failed to fetch allowed properties', error);\n      this.error = (error as Error)?.message ?? 'Unable to fetch properties.';\n      this.properties = [];\n      this.applyFilters(true);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private resetFilters() {\n    this.searchTerm = '';\n    this.applyFilters(true);\n  }\n\n  private applyFilters(resetHighlight = false) {\n    const query = this.searchTerm.trim().toLowerCase();\n    const filtered = !query ? [...this.properties] : this.properties.filter(property => property.name.toLowerCase().includes(query));\n    this.filteredProperties = filtered;\n\n    if (!filtered.length) {\n      this.highlightedIndex = -1;\n      return;\n    }\n\n    if (resetHighlight) {\n      const selectedIndex = this.getSelectedIndex(filtered);\n      this.highlightedIndex = selectedIndex >= 0 ? selectedIndex : 0;\n    } else {\n      this.syncHighlightedIndex();\n    }\n    requestAnimationFrame(() => this.ensureHighlightedVisible());\n  }\n\n  private getSelectedIndex(list: AllowedProperty[]) {\n    if (!this.selectedPropertyId) {\n      return -1;\n    }\n    return list.findIndex(property => property.id === this.selectedPropertyId);\n  }\n\n  private syncHighlightedIndex() {\n    if (!this.filteredProperties.length) {\n      this.highlightedIndex = -1;\n      return;\n    }\n\n    const selectedIndex = this.getSelectedIndex(this.filteredProperties);\n    if (selectedIndex >= 0) {\n      this.highlightedIndex = selectedIndex;\n      return;\n    }\n\n    this.highlightedIndex = Math.min(Math.max(this.highlightedIndex, 0), this.filteredProperties.length - 1);\n  }\n\n  private handleSearchChange = (event: CustomEvent<string>) => {\n    this.searchTerm = event.detail ?? '';\n    this.applyFilters(true);\n  };\n\n  private handleKeyDown = (event: KeyboardEvent) => {\n    if (!this.filteredProperties.length) {\n      return;\n    }\n\n    switch (event.key) {\n      case 'ArrowDown':\n        event.preventDefault();\n        this.highlightedIndex = Math.min(this.filteredProperties.length - 1, this.highlightedIndex + 1);\n        this.ensureHighlightedVisible();\n        break;\n      case 'ArrowUp':\n        event.preventDefault();\n        this.highlightedIndex = Math.max(0, this.highlightedIndex - 1);\n        this.ensureHighlightedVisible();\n        break;\n      case 'Enter':\n        event.preventDefault();\n        this.selectProperty(this.filteredProperties[this.highlightedIndex]);\n        break;\n    }\n  };\n\n  private ensureHighlightedVisible() {\n    if (this.highlightedIndex < 0) {\n      return;\n    }\n    const options = this.el.querySelectorAll('wa-option');\n    const option = options?.[this.highlightedIndex];\n    option?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n  }\n\n  private selectProperty(property?: AllowedProperty) {\n    if (!property) {\n      return;\n    }\n    this.propertySelected.emit(property);\n  }\n\n  private renderStatus(text: string) {\n    return <div class=\"property-switcher__status\">{text}</div>;\n  }\n\n  render() {\n    return (\n      <Host>\n        <ir-input\n          autoFocus\n          ref={el => (this.inputRef = el)}\n          placeholder=\"Find property\"\n          class=\"property-switcher__search-input\"\n          value={this.searchTerm}\n          onText-change={this.handleSearchChange}\n          onKeyDown={this.handleKeyDown}\n          withClear\n        ></ir-input>\n        <div tabIndex={-1} class=\"property-switcher__results\">\n          {this.isLoading && this.renderStatus('Loading properties...')}\n          {!this.isLoading && this.error && this.renderStatus(this.error)}\n          {!this.isLoading && !this.error && this.filteredProperties.length === 0 && this.renderStatus('No properties found')}\n          {!this.isLoading &&\n            !this.error &&\n            this.filteredProperties.map((property, index) => (\n              <wa-option\n                value={property.id?.toString()}\n                onClick={() => this.selectProperty(property)}\n                selected={this.selectedPropertyId === property.id}\n                current={this.highlightedIndex === index}\n              >\n                {property.name}\n              </wa-option>\n            ))}\n        </div>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}