{"version":3,"names":["irArrivalsCss","IrArrivalsStyle0","IrArrivals","ticket","propertyid","language","p","pageSize","bookingNumber","booking","paymentEntries","isPageLoading","payment","roomGuestState","countries","tokenService","Token","roomService","RoomService","bookingService","BookingService","paymentFolioRef","componentWillLoad","this","setToken","init","setArrivalsPageSize","onArrivalsStoreChange","_","getBookings","handlePageSizeChange","newValue","oldValue","handleTicketChange","handleBookingPayment","e","stopImmediatePropagation","stopPropagation","booking_nbr","detail","arrivalsStore","bookings","find","b","paymentType","types","CODE_NAME","payment_type","code","description","CODE_VALUE_EN","operation","NOTES","openFolio","handleOpen","handleResetExposedCancellationDueAmount","Error","propertyId","getExposedProperty","id","aname","is_backend","__","setupEntries","Promise","all","calendar_data","property","resolve","fetchLanguage","getCountries","getSetupEntriesByTableNameMulti","pay_type","pay_type_group","pay_method","groupEntryTablesResult","groups","methods","error","total_count","getRoomsToCheckIn","property_id","toString","check_in_date","today","page_index","pagination","currentPage","page_size","setArrivalsTotal","initializeArrivalsStore","handlePaginationChange","event","nextPage","setArrivalsPage","handlePaginationPageSizeChange","nextPageSize","Number","isFinite","normalizedPageSize","Math","floor","handleCheckingRoom","handleResetBooking","render","h","Host","handledEndpoints","class","onCheckInRoom","onRequestPageChange","onRequestPageSizeChange","open","onBookingDetailsDrawerClosed","style","height","mode","ref","el","onCloseModal","identifier","roomName","totalGuests","sharedPersons","sharing_persons","checkIn","checkin","irBookingEmailLogsCss","IrBookingEmailLogsStyle0","IrBookingEmailLogs","data","token","key","gap","inputContainerStyle","margin","value","onTextChange","placeholder","size","text","onClickHandler","async","axios","post","BOOK_NBR","ExceptionMsg","My_Result","JSON","stringify","getAllParams","params","URLSearchParams","window","location","search","out","entries","irBookingListingCss","IrBookingListingStyle0","IrBookingListing","rowCount","baseUrl","userType","isLoading","editBookingItem","showCost","bookingListingService","BookingListingService","propertyService","PropertyService","listingModal","listingModalTimeout","allowedProperties","havePrivilege","setBaseUrl","updateUserSelection","booking_listing","setPaginationPageSize","initializeApp","onBookingListingChange","updatePaginationFromSelection","some","financial","gross_cost","ticketChanged","fetchBookings","getExposedBookings","userSelection","is_to_export","isPrivilegedUser","propertyData","parallelRequests","getExposedBookingsCriteria","allowedPropertiesIndex","push","length","getExposedAllowedProperties","results","map","updateUserSelections","property_ids","userTypeCode","console","handleSideBarToggle","geSearchFiltersFromParams","log","obj","s","status","filter","from","to","openModal","setTimeout","querySelector","editBooking","disconnectedCallback","clearTimeout","setPaginationPage","handleResetStoreData","handleBookingChanged","findBooking","handleSelectGuestEvent","cause","handleGuestChanged","guest","newGuest","onGuestInfoDrawerClosed","email","irDailyRevenueCss","IrDailyRevenueStyle0","IrDailyRevenue","groupedPayment","previousDateGroupedPayments","filters","date","moment","format","users","sideBarEvent","preventPageLoad","handleOpenSidebar","handleFetchNewReports","getPaymentReports","handleSidebarClose","renderSidebarBody","type","slot","hasPrint","hasReceipt","hasCloseButton","onCloseSidebar","is_from_front_desk","hasRoomEdit","hasRoomDelete","payload","hasRoomAdd","include_units_hk_status","requests","groupPaymentsByName","payments","Map","payTypeCode","payMethodCode","get","set","sort","a","aNum","bNum","isNaN","localeCompare","isExportToExcel","excludeYesterday","getReportObj","report","method","METHOD","PAY_TYPE_CODE","PAY_METHOD_CODE","amount","AMOUNT","DATE","hour","HOUR","minute","MINUTE","user","USER","currency","CURRENCY","bookingNbr","BOOKING_NBR","v4","getDailyRevenueReport","is_export_to_excel","add","btn_color","locales","Lcz_Export","btnStyle","iconPosition","icon_name","icon_style","groupedPayments","sidebarStyles","width","background","Boolean","showCloseButton","onIrSidebarToggle","irDeparturesCss","IrDeparturesStyle0","IrDepartures","checkoutState","invoiceState","onDeparturesStoreChange","departuresStore","getRoomsToCheckout","check_out_date","setDepartureTotal","initializeDeparturesStore","handleCheckoutRoom","setDeparturesPage","handleCheckoutDialogClosed","state","reason","setDeparturesPageSize","handleInvoiceClose","onCheckoutRoom","onCheckoutDialogClosed","onInvoiceClose","roomIdentifier","irHkTasksCss","IrHkTasksStyle0","IrHkTasks","isCleaningLoading","selectedDuration","selectedHouseKeeper","selectedRoom","archiveOpened","isSidebarOpen","isApplyFiltersLoading","modalCauses","clearSelectedHkTasks","hkNameCache","houseKeepingService","HouseKeepingService","table_sorting","modal","handleCloseSidebar","handleSortingChanged","field","direction","handleSkipSelectedTask","task","setLoading","getExposedHKSetup","tasksResult","getHkTasks","from_date","to_date","housekeepers","cleaning_frequency","housekeeping_store","hk_criteria","cleaning_frequencies","dusty_window","dusty_periods","highlight_window","highlight_checkin_options","tasks","updateTasks","buildHousekeeperNameCache","forEach","hk","name","updateTasksStore","t","housekeeper","hkm_id","hkName","handleHeaderButtonPress","sortingArray","Array","url","fetchTasksWithFilters","downloadFile","handleSelectedTaskCleaningEvent","handleModalConfirmation","hkTasksStore","selectedTasks","unit","editHkSkip","COMMENT","HK_SKIP_ID","HK_SKIP_REASON_CODE","PR_ID","executeHKAction","actions","unit_id","clearSelectedTasks","closeModal","applyFilters","export_to_excel","cleaning_periods","dusty_units","highlight_check_ins","onApplyFilters","onRowSelectChange","updateSelectedTasks","autoClose","onConfirmModal","bind","onCancelModal","iconAvailable","icon","leftBtnText","Lcz_Cancel","rightBtnText","Lcz_Confirm","leftBtnColor","rightBtnColor","modalTitle","Lcz_Confirmation","modalBody","getToken","irHousekeepingCss","IrHousekeepingStyle0","IrHousekeeping","toast","selectedCleaningFrequency","handleResetData","include_sales_rate_plans","updateHKStore","housekeeping_enabled","saveAutomaticCheckInCheckout","SetAutomaticCheckInOut","default_properties","flag","emit","position","title","saveCleaningFrequency","setExposedCleaningFrequency","Lcz_HouseKeepingAndCheckInSetup","borderShown","label","Lcz_CheckInOutGuestsAutomatically","showFirstOption","selectedValue","is_automatic_check_in_out","onSelectChange","Lcz_YesAsPerPropertyPolicy","Lcz_NoIWillDoItManually","Lcz_CleaningFrequency","v","isRequestPending","irMonthlyBookingsReportCss","IrMonthlyBookingsReportStyle0","IrMonthlyBookingsReport","reports","stats","baseFilters","firstOfMonth","startOf","lastOfMonth","endOf","include_previous_year","handleApplyFiltersChange","getReports","day","Date","units_booked","Units_booked","occupancy_percent","Occupancy","adr","ADR","rooms_revenue","Rooms_Revenue","total_guests","Total_Guests","getMonthlyStats","currentReports","enrichedReports","DailyStats","rest","previousYearReports","formattedReports","current","previous","prev","last_year","alignItems","Occupancy_Difference_From_Previous_Month","cardTitle","AverageOccupancy","toFixed","subtitle","TotalUnitsBooked","PeakDays","pd","concat","join","max","OccupancyPercent","irSalesByChannelCss","IrSalesByChannelStyle0","IrSalesByChannel","salesData","channelSalesFilters","propertyID","FROM_DATE","TO_DATE","BOOK_CASE","WINDOW","unshift","properties","LIST_AC_ID","getChannelSales","filterParams","currentSales","AC_ID","undefined","shouldFetchPreviousYear","enrichedSales","previousYearSales","subtract","SOURCE","toLowerCase","record","groupSalesRecordsBySource","records","getCurrencyId","r","createKey","source","trim","currencyId","sumValues","mergeLastYear","base","incoming","NIGHTS","PCT","REVENUE","PROPERTY_ID","PROPERTY_NAME","grouped","existing","merged","result","values","totalRevenue","reduce","sum","lastYearTotal","irSalesByCountryCss","IrSalesByCountryStyle0","IrSalesByCountry","salesFilters","getCountrySales","mappedCountries","country","formatSalesData","COUNTRY","country_id","COUNTRY_ID","nights","percentage","revenue","number_of_guests","salesReports","irUserManagementCss","IrUserManagementStyle0","IrUserManagement","isSuperAdmin","baseUserTypeCode","userId","allowedUsersTypes","userService","UserService","userTypes","socket","superAdminId","fetchUsers","fetchUserTypes","io","on","msg","handleSocketMessage","msgAsObject","parse","REASON","KEY","PAYLOAD","reasonHandlers","EMAIL_VERIFIED","updateUserVerificationStatus","handler","call","warn","idx","findIndex","u","is_email_verified","getExposedPropertyUsers","u1","u2","priority","p1","p2","username","res","getSetupEntriesByTableName","getLov","allowedUsers","allowed_user_types","toUpperCase","f","disconnect","suppressToastEndpoints","Lcz_ExtranetUsers","haveAdminPrivileges","includes"],"sources":["src/components/ir-arrivals/ir-arrivals.css?tag=ir-arrivals&encapsulation=scoped","src/components/ir-arrivals/ir-arrivals.tsx","src/components/ir-booking-email-logs/ir-booking-email-logs.css?tag=ir-booking-email-logs&encapsulation=scoped","src/components/ir-booking-email-logs/ir-booking-email-logs.tsx","src/utils/browserHistory.ts","src/components/ir-booking-listing/ir-booking-listing.css?tag=ir-booking-listing&encapsulation=scoped","src/components/ir-booking-listing/ir-booking-listing.tsx","src/components/ir-daily-revenue/ir-daily-revenue.css?tag=ir-daily-revenue&encapsulation=scoped","src/components/ir-daily-revenue/ir-daily-revenue.tsx","src/components/ir-departures/ir-departures.css?tag=ir-departures&encapsulation=scoped","src/components/ir-departures/ir-departures.tsx","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.css?tag=ir-hk-tasks&encapsulation=scoped","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.tsx","src/components/ir-housekeeping/ir-housekeeping.css?tag=ir-housekeeping&encapsulation=scoped","src/components/ir-housekeeping/ir-housekeeping.tsx","src/components/ir-monthly-bookings-report/ir-monthly-bookings-report.css?tag=ir-monthly-bookings-report&encapsulation=scoped","src/components/ir-monthly-bookings-report/ir-monthly-bookings-report.tsx","src/components/ir-sales-by-channel/ir-sales-by-channel.css?tag=ir-sales-by-channel&encapsulation=scoped","src/components/ir-sales-by-channel/ir-sales-by-channel.tsx","src/components/ir-sales-by-country/ir-sales-by-country.css?tag=ir-sales-by-country&encapsulation=scoped","src/components/ir-sales-by-country/ir-sales-by-country.tsx","src/components/ir-user-management/ir-user-management.css?tag=ir-user-management&encapsulation=scoped","src/components/ir-user-management/ir-user-management.tsx"],"sourcesContent":[".page-title {\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-xl);\n}\n:host {\n  height: 100% !important;\n  overflow-y: auto !important;\n}\n","import type { PaginationChangeEvent } from '@/components/ir-pagination/ir-pagination';\nimport { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { RoomService } from '@/services/room.service';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries, RoomGuestsPayload } from '../ir-booking-details/types';\nimport { arrivalsStore, initializeArrivalsStore, onArrivalsStoreChange, setArrivalsPage, setArrivalsPageSize, setArrivalsTotal } from '@/stores/arrivals.store';\nimport { ICountry } from '@/models/IBooking';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-arrivals',\n  styleUrls: ['ir-arrivals.css'],\n  scoped: true,\n})\nexport class IrArrivals {\n  /**\n   * Authentication token issued by the PMS backend.\n   * Required for initializing the component and making API calls.\n   */\n  @Prop() ticket: string;\n\n  /**\n   * ID of the property (hotel) for which arrivals should be displayed.\n   * Used in API calls related to rooms, bookings, and check-ins.\n   */\n  @Prop() propertyid: number;\n\n  /**\n   * Two-letter language code (ISO) used for translations and API locale.\n   * Defaults to `'en'`.\n   */\n  @Prop() language: string = 'en';\n\n  /**\n   * Property alias or short identifier used by backend endpoints (aname).\n   * Passed to `getExposedProperty` when initializing the component.\n   */\n  @Prop() p: string;\n\n  /**\n   * Number of arrivals to load per page in the arrivals table.\n   * Used to configure pagination via Arrivals Store.\n   * Defaults to `20`.\n   */\n  @Prop() pageSize: number = 20;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n  @State() roomGuestState: RoomGuestsPayload = null;\n  @State() countries: ICountry[];\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n    setArrivalsPageSize(this.pageSize);\n    onArrivalsStoreChange('today', _ => {\n      this.getBookings();\n    });\n  }\n\n  @Watch('pageSize')\n  handlePageSizeChange(newValue: number, oldValue: number) {\n    if (newValue !== oldValue) setArrivalsPageSize(newValue);\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = arrivalsStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n  @Listen('resetExposedCancellationDueAmount')\n  async handleResetExposedCancellationDueAmount(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.getBookings();\n  }\n  private async init() {\n    try {\n      this.isPageLoading = true;\n\n      if (!this.propertyid && !this.p) {\n        throw new Error('Missing credentials');\n      }\n      let propertyId = this.propertyid;\n\n      if (!propertyId) {\n        await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n      }\n\n      const [_, __, countries, setupEntries] = await Promise.all([\n        calendar_data?.property ? Promise.resolve(null) : this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getCountries(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getBookings(),\n      ]);\n      this.countries = countries;\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getBookings() {\n    const { bookings, total_count } = await this.bookingService.getRoomsToCheckIn({\n      property_id: calendar_data.property?.id?.toString() || this.propertyid?.toString(),\n      check_in_date: arrivalsStore.today,\n      page_index: arrivalsStore.pagination.currentPage,\n      page_size: arrivalsStore.pagination.pageSize,\n    });\n    setArrivalsTotal(total_count ?? 0);\n    initializeArrivalsStore(bookings);\n  }\n\n  private async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPage = event.detail?.currentPage ?? 1;\n    if (nextPage === arrivalsStore.pagination.currentPage) {\n      return;\n    }\n    setArrivalsPage(nextPage);\n    await this.getBookings();\n  }\n\n  private async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPageSize = event.detail?.pageSize;\n    if (!Number.isFinite(nextPageSize)) {\n      return;\n    }\n    const normalizedPageSize = Math.floor(Number(nextPageSize));\n    if (normalizedPageSize === arrivalsStore.pagination.pageSize) {\n      return;\n    }\n    setArrivalsPageSize(normalizedPageSize);\n    await this.getBookings();\n  }\n  private handleCheckingRoom(event: CustomEvent<RoomGuestsPayload>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.roomGuestState = event.detail;\n  }\n\n  @Listen('updateRoomGuests')\n  handleResetBooking(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.getBookings();\n  }\n  // @Listen(\"resetBookingEvt\")\n  // handleResetBookings(e:CustomEvent){\n  //   e.stopImmediatePropagation();\n  //   e.stopPropagation();\n  //   this.\n  // }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor handledEndpoints={['/Get_Rooms_To_Check_in']}></ir-interceptor>\n        <div class=\"ir-page__container\">\n          <h3 class=\"page-title\">Check-ins</h3>\n          {/* <ir-arrivals-filters></ir-arrivals-filters> */}\n          <ir-arrivals-table\n            onCheckInRoom={event => this.handleCheckingRoom(event as CustomEvent<RoomGuestsPayload>)}\n            onRequestPageChange={event => this.handlePaginationChange(event as CustomEvent<PaginationChangeEvent>)}\n            onRequestPageSizeChange={event => this.handlePaginationPageSizeChange(event as CustomEvent<PaginationChangeEvent>)}\n          ></ir-arrivals-table>\n          <ir-booking-details-drawer\n            open={!!this.bookingNumber}\n            propertyId={this.propertyid as any}\n            bookingNumber={this.bookingNumber?.toString()}\n            ticket={this.ticket}\n            language={this.language}\n            onBookingDetailsDrawerClosed={() => (this.bookingNumber = null)}\n          ></ir-booking-details-drawer>\n          <ir-payment-folio\n            style={{ height: 'auto' }}\n            bookingNumber={this.booking?.booking_nbr}\n            paymentEntries={this.paymentEntries}\n            payment={this.payment}\n            mode={'payment-action'}\n            ref={el => (this.paymentFolioRef = el)}\n            onCloseModal={() => {\n              this.booking = null;\n              this.payment = null;\n            }}\n          ></ir-payment-folio>\n          <ir-room-guests\n            open={this.roomGuestState !== null}\n            countries={this.countries}\n            language={this.language}\n            identifier={this.roomGuestState?.identifier}\n            bookingNumber={this.roomGuestState?.booking_nbr?.toString()}\n            roomName={this.roomGuestState?.roomName}\n            totalGuests={this.roomGuestState?.totalGuests}\n            sharedPersons={this.roomGuestState?.sharing_persons}\n            checkIn={this.roomGuestState?.checkin}\n            onCloseModal={() => (this.roomGuestState = null)}\n          ></ir-room-guests>\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-booking-email-logs',\n  styleUrl: 'ir-booking-email-logs.css',\n  scoped: true,\n})\nexport class IrBookingEmailLogs {\n  @Prop() ticket: string;\n\n  @State() data: any[];\n  @State() bookingNumber: string;\n\n  private token = new Token();\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n    }\n  }\n\n  @Watch('ticket')\n  handleTicketChange() {\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n    }\n  }\n\n  render() {\n    return (\n      <Host class=\"p-1\">\n        <ir-interceptor handledEndpoints={['/Get_Email_log_By_BOOK_NBR']}></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"d-flex align-items-center mb-1\" style={{ gap: '0.5rem' }}>\n          <ir-input-text\n            class=\"m-0\"\n            inputContainerStyle={{ margin: '0' }}\n            value={this.bookingNumber}\n            onTextChange={e => (this.bookingNumber = e.detail)}\n            placeholder=\"booking number\"\n          ></ir-input-text>\n          <ir-button\n            size=\"sm\"\n            text=\"search\"\n            onClickHandler={async () => {\n              const { data } = await axios.post('/Get_Email_log_By_BOOK_NBR', {\n                BOOK_NBR: this.bookingNumber,\n              });\n              if (data.ExceptionMsg) {\n                return;\n              }\n              this.data = data.My_Result;\n            }}\n          ></ir-button>\n        </div>\n        <p>{JSON.stringify(this.data, null, 2)}</p>\n      </Host>\n    );\n  }\n}\n","// src/utils/browserHistory.ts\n\n/**\n * A small utility for reading and writing browser history\n * and manipulating URL search params in a type-safe way.\n */\n\ntype Parser<T> = (value: string | null) => T;\n\n// Common parsers/serializers\nexport const ParamTypes = {\n  string: {\n    parse: (v: string | null): string => v ?? '',\n    serialize: (v: string): string => v,\n  },\n  number: {\n    parse: (v: string | null): number => {\n      if (v == null || v === '') return NaN;\n      const n = Number(v);\n      return isNaN(n) ? NaN : n;\n    },\n    serialize: (v: number): string => String(v),\n  },\n  boolean: {\n    parse: (v: string | null): boolean => v === 'true',\n    serialize: (v: boolean): string => (v ? 'true' : 'false'),\n  },\n} as const;\n\n/**\n * Read a single search‑param, parse it, and return a typed value.\n * Falls back to defaultValue if missing or parse fails.\n */\nexport function getParam<T>(key: string, { parse }: { parse: Parser<T> }, defaultValue: T): T {\n  const params = new URLSearchParams(window.location.search);\n  const raw = params.get(key);\n  try {\n    if (raw == null) return defaultValue;\n    return parse(raw);\n  } catch {\n    return defaultValue;\n  }\n}\n\n/** Helpers for the three built‑in types */\nexport function getStringParam(key: string, defaultValue = ''): string {\n  return getParam(key, ParamTypes.string, defaultValue);\n}\n\nexport function getNumberParam(key: string, defaultValue = NaN): number {\n  return getParam(key, ParamTypes.number, defaultValue);\n}\n\nexport function getBooleanParam(key: string, defaultValue = false): boolean {\n  return getParam(key, ParamTypes.boolean, defaultValue);\n}\n\n/**\n * Read all current search params into a Record<string, string>\n */\nexport function getAllParams(): Record<string, string> {\n  const params = new URLSearchParams(window.location.search);\n  const out: Record<string, string> = {};\n  for (const [key, value] of params.entries()) {\n    out[key] = value;\n  }\n  return out;\n}\n\ninterface SetParamsOptions {\n  /** if true, uses replaceState instead of pushState */\n  replace?: boolean;\n}\n\n/**\n * Update one or more search params.\n * Pass null to delete a param.\n * By default uses history.pushState; set replace: true to call replaceState.\n */\nexport function setParams(updates: Record<string, string | number | boolean | null>, options: SetParamsOptions = {}): void {\n  const params = new URLSearchParams(window.location.search);\n\n  for (const [key, value] of Object.entries(updates)) {\n    if (!value) {\n      params.delete(key);\n    } else {\n      params.set(key, String(value));\n    }\n  }\n\n  const newSearch = params.toString();\n  const newUrl = window.location.pathname + (newSearch ? `?${newSearch}` : '') + window.location.hash;\n\n  if (options.replace) {\n    window.history.replaceState(window.history.state, '', newUrl);\n  } else {\n    window.history.pushState(window.history.state, '', newUrl);\n  }\n}\n\n/**\n * Push a new history entry.\n * `path` may include search or hash.\n * `state` is the history state object.\n */\nexport function pushHistory(path: string, state: any = {}): void {\n  window.history.pushState(state, '', path);\n}\n\n/**\n * Replace the current history entry.\n * `path` may include search or hash.\n * `state` is the history state object.\n */\nexport function replaceHistory(path: string, state: any = {}): void {\n  window.history.replaceState(state, '', path);\n}\n",":host {\n  display: block;\n  padding: var(--wa-space-l);\n  position: relative;\n  height: 100% !important;\n  overflow-y: auto !important;\n}\n","import { Booking } from '@/models/booking.dto';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { RoomService } from '@/services/room.service';\nimport booking_listing, {\n  updateUserSelection,\n  onBookingListingChange,\n  updateUserSelections,\n  ExposedBookingsParams,\n  setPaginationPage,\n  setPaginationPageSize,\n  updatePaginationFromSelection,\n} from '@/stores/booking_listing.store';\nimport { isPrivilegedUser } from '@/utils/utils';\nimport { Component, Host, Prop, State, Watch, h, Element, Listen } from '@stencil/core';\nimport Token from '@/models/Token';\nimport { getAllParams } from '@/utils/browserHistory';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { AllowedProperties, PropertyService } from '@/services/property.service';\nimport type { PaginationChangeEvent } from '@/components/ir-pagination/ir-pagination';\nimport { GuestChangedEvent } from '@/components';\n\n@Component({\n  tag: 'ir-booking-listing',\n  styleUrls: ['ir-booking-listing.css'],\n  scoped: true,\n})\nexport class IrBookingListing {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() rowCount: number = 20;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n  @Prop() userType: number;\n\n  @State() isLoading = false;\n  @State() editBookingItem: { booking: Booking; cause: 'edit' | 'payment' | 'delete' | 'guest' } | null = null;\n  @State() showCost = false;\n  @State() paymentEntries: PaymentEntries;\n  @State() payment: Payment;\n  @State() booking: Booking;\n\n  private bookingListingService = new BookingListingService();\n  private bookingService = new BookingService();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private token = new Token();\n\n  private listingModal: HTMLIrListingModalElement;\n  private listingModalTimeout: NodeJS.Timeout;\n  private allowedProperties: number[];\n  private havePrivilege: boolean;\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    updateUserSelection('end_row', this.rowCount);\n    booking_listing.rowCount = this.rowCount;\n    setPaginationPageSize(this.rowCount);\n    if (this.ticket !== '') {\n      booking_listing.token = this.ticket;\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n    onBookingListingChange('userSelection', newValue => {\n      updatePaginationFromSelection(newValue);\n    });\n    onBookingListingChange('bookings', newValue => {\n      this.showCost = newValue.some(booking => booking.financial.gross_cost !== null && booking.financial.gross_cost > 0);\n    });\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    booking_listing.token = this.ticket;\n    this.initializeApp();\n  }\n\n  private async fetchBookings() {\n    await this.bookingListingService.getExposedBookings({\n      ...booking_listing.userSelection,\n      is_to_export: false,\n    });\n  }\n\n  private async initializeApp() {\n    try {\n      this.isLoading = true;\n      this.havePrivilege = isPrivilegedUser(this.userType);\n\n      let propertyId = this.propertyid;\n      if (!this.havePrivilege) {\n        if (!this.propertyid && !this.p) {\n          throw new Error('Property ID or username is required');\n        }\n\n        if (!propertyId) {\n          const propertyData = await this.roomService.getExposedProperty({\n            id: 0,\n            aname: this.p,\n            language: this.language,\n            is_backend: true,\n          });\n          propertyId = propertyData.My_Result.id;\n        }\n      }\n\n      const parallelRequests: Promise<unknown>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.bookingListingService.getExposedBookingsCriteria(this.havePrivilege ? null : propertyId),\n        this.roomService.fetchLanguage(this.language, ['_BOOKING_LIST_FRONT']),\n      ];\n\n      // let propertyDataIndex: number | null = null;\n      let allowedPropertiesIndex: number | null = null;\n\n      if (this.propertyid && !this.havePrivilege) {\n        // propertyDataIndex = parallelRequests.length;\n        parallelRequests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n          }),\n        );\n      }\n\n      if (this.havePrivilege) {\n        allowedPropertiesIndex = parallelRequests.length;\n        parallelRequests.push(this.propertyService.getExposedAllowedProperties());\n      }\n\n      const results = await Promise.all(parallelRequests);\n\n      const [setupEntries] = results;\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries as any);\n\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n\n      this.allowedProperties = allowedPropertiesIndex !== null ? (results[allowedPropertiesIndex] as AllowedProperties)?.map(p => p.id) : null;\n\n      updateUserSelection('property_id', propertyId);\n\n      updateUserSelections({\n        property_ids: this.allowedProperties,\n        userTypeCode: this.userType,\n      });\n\n      await this.fetchBookings();\n    } catch (error) {\n      console.error('Error initializing app:', error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  handleSideBarToggle(e: CustomEvent<boolean>) {\n    if (e.detail) {\n      this.editBookingItem = null;\n    }\n  }\n  geSearchFiltersFromParams() {\n    //e=10&status=002&from=2025-04-15&to=2025-04-22&filter=2&c=Alitalia+Cabin+Crew\n    const params = getAllParams();\n    if (params) {\n      console.log('update params');\n      let obj: Partial<ExposedBookingsParams> = {};\n      if (params.e) {\n        obj['end_row'] = Number(params.e);\n      }\n      if (params.s) {\n        obj['start_row'] = Number(params.s);\n      }\n      if (params.status) {\n        obj['booking_status'] = params.status;\n      }\n      if (params.filter) {\n        obj['filter_type'] = params.filter;\n      }\n      if (params.from) {\n        obj['from'] = params.from;\n      }\n      if (params.to) {\n        obj['to'] = params.to;\n      }\n      updateUserSelections(obj);\n    }\n    console.log('params=>', params);\n  }\n  openModal() {\n    this.listingModalTimeout = setTimeout(() => {\n      this.listingModal = this.el.querySelector('ir-listing-modal');\n      this.listingModal.editBooking = this.editBookingItem;\n      this.listingModal.openModal();\n    }, 100);\n  }\n  disconnectedCallback() {\n    clearTimeout(this.listingModalTimeout);\n  }\n\n  @Listen('requestPageChange')\n  async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    if (!event.detail) {\n      return;\n    }\n    setPaginationPage(event.detail.currentPage);\n    await this.fetchBookings();\n  }\n\n  @Listen('requestPageSizeChange')\n  async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    if (!event.detail || !event.detail.pageSize) {\n      return;\n    }\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    setPaginationPageSize(event.detail.pageSize);\n    await this.fetchBookings();\n  }\n\n  @Listen('resetBookingData')\n  async handleResetStoreData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchBookings();\n  }\n\n  @Listen('bookingChanged')\n  handleBookingChanged(e: CustomEvent<Booking>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    booking_listing.bookings = [\n      ...booking_listing.bookings.map(b => {\n        if (b.booking_nbr === e.detail.booking_nbr) {\n          return e.detail;\n        }\n        return b;\n      }),\n    ];\n  }\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = this.findBooking(booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n  @Listen('guestSelected')\n  handleSelectGuestEvent(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const booking = this.findBooking(e.detail);\n    if (!booking) {\n      return;\n    }\n    this.editBookingItem = {\n      booking,\n      cause: 'guest',\n    };\n  }\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation;\n    const booking = this.findBooking(e.detail);\n    if (!booking) {\n      return;\n    }\n    this.editBookingItem = {\n      booking,\n      cause: 'edit',\n    };\n  }\n\n  @Listen('resetExposedCancellationDueAmount')\n  async handleResetExposedCancellationDueAmount(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchBookings();\n  }\n\n  @Listen('guestChanged')\n  handleGuestChanged(e: CustomEvent<GuestChangedEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n\n    booking_listing.bookings = booking_listing.bookings.map(b => {\n      const guest = { ...b.guest };\n      const newGuest = e.detail;\n      if (guest.id === newGuest.id) {\n        return { ...b, guest: { ...guest, ...newGuest } };\n      }\n      return b;\n    });\n  }\n\n  private findBooking(bookingNumber: Booking['booking_nbr']) {\n    return booking_listing.bookings.find(b => b.booking_nbr === bookingNumber);\n  }\n  render() {\n    if (this.isLoading || this.ticket === '') {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"main-container\">\n          <ir-listing-header propertyId={this.propertyid} p={this.p} language={this.language}></ir-listing-header>\n          <section class=\"mt-2\">\n            <ir-booking-listing-table></ir-booking-listing-table>\n          </section>\n        </div>\n        <ir-booking-details-drawer\n          open={this.editBookingItem?.cause === 'edit'}\n          propertyId={this.editBookingItem?.booking?.property?.id}\n          bookingNumber={this.editBookingItem?.booking?.booking_nbr.toString()}\n          ticket={this.ticket}\n          language={this.language}\n          onBookingDetailsDrawerClosed={() => (this.editBookingItem = null)}\n        ></ir-booking-details-drawer>\n        <ir-guest-info-drawer\n          onGuestInfoDrawerClosed={() => {\n            this.editBookingItem = null;\n          }}\n          booking_nbr={this.editBookingItem?.booking?.booking_nbr}\n          email={this.editBookingItem?.booking?.guest.email}\n          language={this.language}\n          open={this.editBookingItem?.cause === 'guest'}\n        ></ir-guest-info-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n.daily-revenue__meta {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.daily-revenue__table {\n  flex: 1 1 0%;\n}\n\n/*sm*/\n@media (min-width: 768px) {\n  .daily-revenue__meta {\n    flex-direction: row;\n  }\n}\n","import Token from '@/models/Token';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { DailyPaymentFilter, FolioPayment, GroupedFolioPayment, SidebarOpenEvent } from './types';\nimport { v4 } from 'uuid';\nimport moment from 'moment';\nimport { PaymentEntries } from '../ir-booking-details/types';\n\n@Component({\n  tag: 'ir-daily-revenue',\n  styleUrl: 'ir-daily-revenue.css',\n  scoped: true,\n})\nexport class IrDailyRevenue {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isPageLoading: boolean;\n  @State() property_id: number;\n  @State() groupedPayment: GroupedFolioPayment;\n  @State() previousDateGroupedPayments: GroupedFolioPayment;\n  @State() isLoading: string;\n  @State() filters: DailyPaymentFilter = { date: moment().format('YYYY-MM-DD'), users: null };\n  @State() sideBarEvent: SidebarOpenEvent | null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private bookingService = new BookingService();\n  private paymentEntries: PaymentEntries;\n\n  @Event() preventPageLoad: EventEmitter<null>;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.tokenService.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  @Listen('revenueOpenSidebar')\n  handleOpenSidebar(e: CustomEvent<SidebarOpenEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = e.detail;\n  }\n  @Listen('fetchNewReports')\n  handleFetchNewReports(e: CustomEvent<DailyPaymentFilter>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.filters = { ...e.detail };\n    this.getPaymentReports();\n  }\n  @Listen('resetBookingEvt')\n  async handleResetBooking(e: CustomEvent) {\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    this.getPaymentReports(false, true);\n  }\n\n  private handleSidebarClose = (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = null;\n  };\n\n  private renderSidebarBody() {\n    if (!this.sideBarEvent) {\n      return;\n    }\n    switch (this.sideBarEvent.type) {\n      case 'booking':\n        return (\n          <ir-booking-details\n            slot=\"sidebar-body\"\n            hasPrint\n            hasReceipt\n            hasCloseButton\n            onCloseSidebar={this.handleSidebarClose}\n            is_from_front_desk\n            propertyid={this.property_id}\n            hasRoomEdit\n            hasRoomDelete\n            bookingNumber={this.sideBarEvent.payload.bookingNumber.toString()}\n            ticket={this.ticket}\n            language={this.language}\n            hasRoomAdd\n          ></ir-booking-details>\n        );\n      default:\n        return null;\n    }\n  }\n\n  private async initializeApp() {\n    this.isPageLoading = true;\n\n    try {\n      let propertyId = this.propertyid;\n      if (!propertyId && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n\n      this.property_id = propertyId;\n\n      const requests: Promise<any>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getPaymentReports(),\n        this.roomService.fetchLanguage(this.language),\n      ];\n      if (propertyId) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [setupEntries] = await Promise.all(requests);\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n  private groupPaymentsByName(payments: FolioPayment[]): GroupedFolioPayment {\n    const groupedPayment: GroupedFolioPayment = new Map();\n\n    for (const payment of payments) {\n      const key = `${payment.payTypeCode}_${payment.payMethodCode}`;\n      const p = groupedPayment.get(key) ?? [];\n      groupedPayment.set(key, [...p, payment]);\n    }\n    return new Map(\n      [...groupedPayment.entries()].sort(([a], [b]) => {\n        const aNum = Number(a);\n        const bNum = Number(b);\n        if (!isNaN(aNum) && !isNaN(bNum)) {\n          return aNum - bNum;\n        }\n        return a.localeCompare(b);\n      }),\n    );\n  }\n\n  private async getPaymentReports(isExportToExcel = false, excludeYesterday = false) {\n    try {\n      const getReportObj = (report): FolioPayment => {\n        return {\n          method: report.METHOD,\n          payTypeCode: report.PAY_TYPE_CODE,\n          payMethodCode: report.PAY_METHOD_CODE,\n          amount: report.AMOUNT,\n          date: report.DATE,\n          hour: report.HOUR,\n          minute: report.MINUTE,\n          user: report.USER,\n          currency: report.CURRENCY,\n          bookingNbr: report.BOOKING_NBR,\n          id: v4(),\n        };\n      };\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n\n      const requests = [\n        this.propertyService.getDailyRevenueReport({\n          date: this.filters.date,\n          property_id: this.property_id?.toString(),\n          is_export_to_excel: isExportToExcel,\n        }),\n      ];\n      if (!isExportToExcel && !excludeYesterday) {\n        requests.push(\n          this.propertyService.getDailyRevenueReport({\n            date: moment(this.filters.date, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD'),\n            property_id: this.property_id?.toString(),\n            is_export_to_excel: isExportToExcel,\n          }),\n        );\n      }\n\n      const results = await Promise.all(requests);\n      if (!isExportToExcel) {\n        if (results[0]) {\n          this.groupedPayment = this.groupPaymentsByName(results[0]?.map(getReportObj));\n        } else {\n          this.groupedPayment = new Map();\n        }\n        if (results[1]) this.previousDateGroupedPayments = this.groupPaymentsByName(results[1]?.map(getReportObj));\n      }\n    } catch (e) {\n      console.log(e);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Daily Revenue</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getPaymentReports(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <ir-revenue-summary\n            previousDateGroupedPayments={this.previousDateGroupedPayments}\n            groupedPayments={this.groupedPayment}\n            paymentEntries={this.paymentEntries}\n          ></ir-revenue-summary>\n          <div class=\"daily-revenue__meta\">\n            <ir-daily-revenue-filters isLoading={this.isLoading === 'filter'} payments={this.groupedPayment}></ir-daily-revenue-filters>\n            <ir-revenue-table filters={this.filters} class={'daily-revenue__table'} paymentEntries={this.paymentEntries} payments={this.groupedPayment}></ir-revenue-table>\n          </div>\n        </section>\n        <ir-sidebar\n          sidebarStyles={{\n            width: this.sideBarEvent?.type === 'booking' ? '80rem' : 'var(--sidebar-width,40rem)',\n            background: this.sideBarEvent?.type === 'booking' ? '#F2F3F8' : 'white',\n          }}\n          open={Boolean(this.sideBarEvent)}\n          showCloseButton={false}\n          onIrSidebarToggle={this.handleSidebarClose}\n        >\n          {this.renderSidebarBody()}\n        </ir-sidebar>\n      </Host>\n    );\n  }\n}\n",".page-title {\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-xl);\n\n  /* margin-bottom: 1rem; */\n}\n\n:host {\n  height: 100% !important;\n  overflow-y: auto !important;\n}\n","import { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { departuresStore, initializeDeparturesStore, onDeparturesStoreChange, setDeparturesPage, setDeparturesPageSize, setDepartureTotal } from '@/stores/departures.store';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { RoomService } from '@/services/room.service';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { PaginationChangeEvent } from '../ir-pagination/ir-pagination';\nimport { CheckoutDialogCloseEvent, CheckoutRoomEvent } from '@/components';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-departures',\n  styleUrls: ['ir-departures.css'],\n  scoped: true,\n})\nexport class IrDepartures {\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() language: string = 'en';\n  @Prop() p: string;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n  @State() checkoutState: CheckoutRoomEvent = null;\n  @State() invoiceState: CheckoutRoomEvent = null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n    onDeparturesStoreChange('today', _ => {\n      this.getBookings();\n    });\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = departuresStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n  @Listen('resetExposedCancellationDueAmount')\n  async handleResetExposedCancellationDueAmount(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.getBookings();\n  }\n  private async init() {\n    try {\n      this.isPageLoading = true;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Missing credentials');\n      }\n      let propertyId = this.propertyid;\n\n      if (!propertyId) {\n        await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n      }\n      const [_, __, setupEntries] = await Promise.all([\n        calendar_data?.property ? Promise.resolve(null) : this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getBookings(),\n      ]);\n\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getBookings() {\n    const { bookings, total_count } = await this.bookingService.getRoomsToCheckout({\n      property_id: calendar_data.property?.id?.toString() || this.propertyid?.toString(),\n      check_out_date: departuresStore.today,\n      page_index: departuresStore.pagination.currentPage,\n      page_size: departuresStore.pagination.pageSize,\n    });\n    setDepartureTotal(total_count ?? 0);\n    initializeDeparturesStore(bookings);\n  }\n  private handleCheckoutRoom(event: CustomEvent<CheckoutRoomEvent>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.checkoutState = event.detail;\n  }\n  private async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPage = event.detail?.currentPage ?? 1;\n    if (nextPage === departuresStore.pagination.currentPage) {\n      return;\n    }\n    setDeparturesPage(nextPage);\n    await this.getBookings();\n  }\n\n  private async handleCheckoutDialogClosed(event: CustomEvent<CheckoutDialogCloseEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const state = { ...this.checkoutState };\n    this.checkoutState = null;\n    switch (event.detail.reason) {\n      case 'checkout':\n        await this.getBookings();\n        break;\n      case 'openInvoice':\n        this.invoiceState = { ...state };\n        await this.getBookings();\n        break;\n    }\n  }\n\n  private async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPageSize = event.detail?.pageSize;\n    if (!Number.isFinite(nextPageSize)) {\n      return;\n    }\n    const normalizedPageSize = Math.floor(Number(nextPageSize));\n    if (normalizedPageSize === departuresStore.pagination.pageSize) {\n      return;\n    }\n    setDeparturesPageSize(normalizedPageSize);\n    await this.getBookings();\n  }\n  private handleInvoiceClose(event: CustomEvent<void>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.invoiceState = null;\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor handledEndpoints={['/Get_Rooms_To_Check_Out']}></ir-interceptor>\n        <div class={'ir-page__container'}>\n          <h3 class=\"page-title\">Check-outs</h3>\n          {/* <ir-departures-filter></ir-departures-filter> */}\n          <ir-departures-table\n            onCheckoutRoom={event => this.handleCheckoutRoom(event as CustomEvent<CheckoutRoomEvent>)}\n            onRequestPageChange={event => this.handlePaginationChange(event as CustomEvent<PaginationChangeEvent>)}\n            onRequestPageSizeChange={event => this.handlePaginationPageSizeChange(event as CustomEvent<PaginationChangeEvent>)}\n          ></ir-departures-table>\n        </div>\n        <ir-booking-details-drawer\n          open={!!this.bookingNumber}\n          propertyId={this.propertyid as any}\n          bookingNumber={this.bookingNumber?.toString()}\n          ticket={this.ticket}\n          language={this.language}\n          onBookingDetailsDrawerClosed={() => (this.bookingNumber = null)}\n        ></ir-booking-details-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n        <ir-checkout-dialog\n          booking={this.checkoutState?.booking}\n          identifier={this.checkoutState?.identifier}\n          open={this.checkoutState !== null}\n          onCheckoutDialogClosed={event => this.handleCheckoutDialogClosed(event as CustomEvent<CheckoutDialogCloseEvent>)}\n        ></ir-checkout-dialog>\n        <ir-invoice\n          onInvoiceClose={event => this.handleInvoiceClose(event as CustomEvent<void>)}\n          booking={this.invoiceState?.booking}\n          roomIdentifier={this.invoiceState?.identifier}\n          open={this.invoiceState !== null}\n        ></ir-invoice>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  box-sizing: border-box;\n}\n:host * {\n  box-sizing: border-box;\n}\n\n@media only screen and (min-width: 900px) {\n  /* td {\n    min-width: 140px !important;\n    width: max-content !important;\n  } */\n}\n@media only screen and (max-width: 900px) {\n  /* td {\n    min-width: 100px !important;\n  } */\n  /* .table-container {\n    width: max-content !important;\n  } */\n}\n/*sm*/\n@media (min-width: 640px) {\n}\n\n/*md*/\n@media (min-width: 768px) {\n}\n\n.tasks-view {\n  display: flex;\n  flex-direction: column;\n}\n/*lg*/\n@media (min-width: 1024px) {\n  .tasks-view {\n    flex-direction: row;\n  }\n}\n\n/*xl*/\n@media (min-width: 1280px) {\n}\n\n/*2xl*/\n@media (min-width: 1536px) {\n}\n","import { CleanTaskEvent, IPendingActions } from '@/models/housekeeping';\nimport Token from '@/models/Token';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport housekeeping_store from '@/stores/housekeeping.store';\n// import { isRequestPending } from '@/stores/ir-interceptor.store';\nimport locales from '@/stores/locales.store';\nimport { Component, Host, Prop, State, h, Element, Watch, Event, EventEmitter, Listen } from '@stencil/core';\nimport moment from 'moment';\nimport { v4 } from 'uuid';\nimport { TaskFilters } from './types';\nimport { downloadFile } from '@/utils/utils';\nimport { updateTasks as updateTasksStore, updateSelectedTasks, clearSelectedTasks, hkTasksStore, setLoading } from '@/stores/hk-tasks.store';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-hk-tasks',\n  styleUrl: 'ir-hk-tasks.css',\n  scoped: true,\n})\nexport class IrHkTasks {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n\n  @State() isLoading = false;\n  @State() isCleaningLoading = false;\n  @State() selectedDuration = '';\n  @State() selectedHouseKeeper = '0';\n  @State() selectedRoom: IPendingActions | null = null;\n  @State() archiveOpened = false;\n  @State() property_id: number;\n  @State() isSidebarOpen: boolean;\n  @State() isApplyFiltersLoading: boolean;\n  @State() filters: TaskFilters;\n  @State() modalCauses: CleanTaskEvent & { cause: 'skip' | 'clean' };\n\n  @Event({ bubbles: true, composed: true }) clearSelectedHkTasks: EventEmitter<void>;\n\n  private hkNameCache: Record<number, string> = {};\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n  private token = new Token();\n  private table_sorting: Map<string, 'ASC' | 'DESC'> = new Map();\n  private modal: HTMLIrModalElement;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket !== '') {\n      this.token.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.init();\n  }\n\n  @Listen('closeSideBar')\n  handleCloseSidebar(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.isSidebarOpen = false;\n  }\n  @Listen('sortingChanged')\n  handleSortingChanged(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { field, direction } = e.detail;\n    console.log(e.detail);\n    if (field === 'date') {\n      return;\n    }\n    this.table_sorting.set(field, direction);\n  }\n  @Listen('skipSelectedTask')\n  handleSkipSelectedTask(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalCauses = { task: e.detail, cause: 'skip' };\n    this.modal?.openModal();\n  }\n\n  private async init() {\n    try {\n      this.isLoading = true;\n      setLoading(true);\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.houseKeepingService.getExposedHKSetup(this.property_id), this.roomService.fetchLanguage(this.language)];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      const tasksResult = await this.houseKeepingService.getHkTasks({\n        property_id: this.property_id,\n        from_date: moment().format('YYYY-MM-DD'),\n        to_date: moment().format('YYYY-MM-DD'),\n        housekeepers: [],\n        cleaning_frequency: (calendar_data.cleaning_frequency ?? housekeeping_store?.hk_criteria?.cleaning_frequencies[0])?.code,\n        dusty_window: housekeeping_store?.hk_criteria?.dusty_periods[0]?.code,\n        highlight_window: housekeeping_store?.hk_criteria?.highlight_checkin_options[0]?.code,\n      });\n\n      // updateTaskList();\n      if (tasksResult?.tasks) {\n        this.updateTasks(tasksResult.tasks);\n      }\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n      setLoading(false);\n    }\n  }\n\n  private buildHousekeeperNameCache() {\n    this.hkNameCache = {};\n    housekeeping_store.hk_criteria?.housekeepers?.forEach(hk => {\n      if (hk.id != null && hk.name != null) {\n        this.hkNameCache[hk.id] = hk.name;\n      }\n    });\n  }\n\n  private updateTasks(tasks: any[]) {\n    this.buildHousekeeperNameCache();\n    updateTasksStore(\n      tasks.map(t => ({\n        ...t,\n        id: v4(),\n        housekeeper: (() => {\n          const name = this.hkNameCache[t.hkm_id];\n          if (name) {\n            return name;\n          }\n          const hkName = housekeeping_store.hk_criteria?.housekeepers?.find(hk => hk.id === t.hkm_id)?.name;\n          this.hkNameCache[t.hkm_id] = hkName;\n          return hkName;\n        })(),\n      })),\n    );\n  }\n  @Listen('headerButtonPress')\n  async handleHeaderButtonPress(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { name } = e.detail;\n    switch (name) {\n      case 'cleaned':\n      case 'clean-inspect':\n        this.modal?.openModal();\n        this.modalCauses = {\n          task: null,\n          cause: 'clean',\n          status: name === 'clean-inspect' ? '004' : '001',\n        };\n        break;\n      case 'export':\n        const sortingArray: { key: string; value: string }[] = Array.from(this.table_sorting.entries()).map(([key, value]) => ({\n          key,\n          value,\n        }));\n        console.log(sortingArray);\n        const { url } = await this.fetchTasksWithFilters(true);\n        downloadFile(url);\n        break;\n      case 'archive':\n        this.isSidebarOpen = true;\n        break;\n    }\n  }\n  @Listen('cleanSelectedTask')\n  handleSelectedTaskCleaningEvent(e: CustomEvent<CleanTaskEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalCauses = { ...e.detail, cause: 'clean' };\n    this.modal?.openModal();\n  }\n\n  private async handleModalConfirmation(e: CustomEvent) {\n    try {\n      e.stopImmediatePropagation();\n      e.stopPropagation();\n      if (hkTasksStore.selectedTasks.length === 0) {\n        return;\n      }\n      this.isCleaningLoading = true;\n      if (this.modalCauses?.cause === 'skip') {\n        const { booking_nbr, date, unit } = this.modalCauses.task;\n        await this.houseKeepingService.editHkSkip({\n          BOOK_NBR: booking_nbr,\n          DATE: date,\n          COMMENT: '',\n          HK_SKIP_ID: -1,\n          HK_SKIP_REASON_CODE: '001',\n          PR_ID: unit.id,\n        });\n      } else {\n        await this.houseKeepingService.executeHKAction({\n          actions: hkTasksStore.selectedTasks.map(t => ({\n            description: 'Cleaned',\n            hkm_id: t.hkm_id === 0 ? null : t.hkm_id,\n            unit_id: t.unit.id,\n            booking_nbr: t.booking_nbr,\n            status: this.modalCauses?.status ?? '001',\n          })),\n        });\n      }\n      await this.fetchTasksWithFilters();\n    } finally {\n      clearSelectedTasks();\n      if (this.modalCauses) {\n        this.modalCauses = null;\n      }\n      this.isCleaningLoading = false;\n      // this.clearSelectedTasks.emit();\n      this.modal.closeModal();\n    }\n  }\n\n  private async applyFilters(e: CustomEvent) {\n    try {\n      this.isApplyFiltersLoading = true;\n      e.stopImmediatePropagation();\n      e.stopPropagation();\n      this.filters = { ...e.detail };\n      await this.fetchTasksWithFilters();\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isApplyFiltersLoading = false;\n    }\n  }\n\n  private async fetchTasksWithFilters(export_to_excel: boolean = false) {\n    const { cleaning_periods, housekeepers, cleaning_frequencies, dusty_units, highlight_check_ins } = this.filters ?? {};\n\n    const { tasks, url } = await this.houseKeepingService.getHkTasks({\n      housekeepers,\n      cleaning_frequency: cleaning_frequencies?.code,\n      dusty_window: dusty_units?.code,\n      highlight_window: highlight_check_ins?.code,\n      property_id: this.property_id,\n      from_date: moment().format('YYYY-MM-DD'),\n      to_date: cleaning_periods?.code || moment().format('YYYY-MM-DD'),\n      is_export_to_excel: export_to_excel,\n    });\n    console.log(tasks);\n    if (tasks) {\n      this.updateTasks(tasks);\n    }\n    return { tasks, url };\n  }\n\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host data-testid=\"hk_tasks_base\">\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-1 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <h3>Housekeeping Tasks</h3>\n          <div class=\"tasks-view \" style={{ gap: '1rem' }}>\n            <ir-tasks-filters\n              isLoading={this.isApplyFiltersLoading}\n              onApplyFilters={e => {\n                this.applyFilters(e);\n              }}\n            ></ir-tasks-filters>\n            <div class=\"d-flex w-100 flex-column\" style={{ gap: '1rem' }}>\n              <ir-tasks-table\n                onRowSelectChange={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  updateSelectedTasks(e.detail);\n                }}\n                class=\"flex-grow-1 w-100\"\n              ></ir-tasks-table>\n              {/* <ir-tasks-table-pagination></ir-tasks-table-pagination> */}\n            </div>\n          </div>\n        </section>\n        <ir-modal\n          autoClose={false}\n          ref={el => (this.modal = el)}\n          isLoading={this.isCleaningLoading}\n          onConfirmModal={this.handleModalConfirmation.bind(this)}\n          onCancelModal={() => {\n            if (this.modalCauses) {\n              clearSelectedTasks();\n              this.modalCauses = null;\n            }\n          }}\n          iconAvailable={true}\n          icon=\"ft-alert-triangle danger h1\"\n          leftBtnText={locales.entries.Lcz_Cancel}\n          rightBtnText={locales.entries.Lcz_Confirm}\n          leftBtnColor=\"secondary\"\n          rightBtnColor={'primary'}\n          modalTitle={locales.entries.Lcz_Confirmation}\n          modalBody={\n            this.modalCauses\n              ? this.modalCauses?.cause === 'clean'\n                ? this.modalCauses.task\n                  ? `Update ${this.modalCauses?.task?.unit?.name} to Clean`\n                  : 'Update selected unit(s) to Clean'\n                : 'Skip cleaning and reschedule for tomorrow.'\n              : 'Update selected unit(s) to Clean'\n          }\n        ></ir-modal>\n        <ir-sidebar\n          open={this.isSidebarOpen}\n          id=\"editGuestInfo\"\n          onIrSidebarToggle={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.isSidebarOpen = false;\n          }}\n          // sidebarStyles={{\n          //   width: '80vw',\n          // }}\n          showCloseButton={false}\n        >\n          {this.isSidebarOpen && <ir-hk-archive ticket={this.token.getToken()} propertyId={this.property_id} slot=\"sidebar-body\"></ir-hk-archive>}\n        </ir-sidebar>\n        {/* <ir-title class=\"d-none d-md-flex\" label={locales.entries.Lcz_HousekeepingTasks} justifyContent=\"space-between\">\n            <ir-button slot=\"title-body\" text={locales.entries.Lcz_Archive} size=\"sm\"></ir-button>\n          </ir-title> */}\n      </Host>\n    );\n  }\n}\n",":host {\r\n  display: block;\r\n}\r\n","import Token from '@/models/Token';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport calendar_data from '@/stores/calendar-data';\nimport housekeeping_store, { updateHKStore } from '@/stores/housekeeping.store';\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport locales from '@/stores/locales.store';\nimport { PropertyService } from '@/services/property.service';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n@Component({\n  tag: 'ir-housekeeping',\n  styleUrl: 'ir-housekeeping.css',\n  scoped: true,\n})\nexport class IrHousekeeping {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n\n  @State() isLoading = false;\n\n  @Event() toast: EventEmitter<IToast>;\n\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n  private propertyService = new PropertyService();\n  private token = new Token();\n  modal: HTMLIrModalElement;\n  selectedCleaningFrequency: any;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket !== '') {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.houseKeepingService.getExposedHKSetup(this.propertyid);\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  async initializeApp() {\n    try {\n      this.isLoading = true;\n      let propertyId = this.propertyid;\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_sales_rate_plans: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n      updateHKStore('default_properties', { token: this.ticket, property_id: propertyId, language: this.language });\n      const requests: Array<Promise<any>> = [];\n      if (calendar_data.housekeeping_enabled) {\n        requests.push(this.houseKeepingService.getExposedHKSetup(propertyId));\n      }\n      requests.push(this.roomService.fetchLanguage(this.language, ['_HK_FRONT', '_PMS_FRONT']));\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_sales_rate_plans: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      this.selectedCleaningFrequency = calendar_data.cleaning_frequency?.code;\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  private async saveAutomaticCheckInCheckout(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.roomService.SetAutomaticCheckInOut({\n        property_id: housekeeping_store.default_properties.property_id,\n        flag: e.detail === 'auto',\n      });\n      this.toast.emit({\n        position: 'top-right',\n        title: 'Saved Successfully',\n        description: '',\n        type: 'success',\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  private async saveCleaningFrequency(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.propertyService.setExposedCleaningFrequency({\n        property_id: housekeeping_store.default_properties.property_id,\n        code: this.selectedCleaningFrequency,\n      });\n      calendar_data.cleaning_frequency = { code: this.selectedCleaningFrequency, description: '' };\n      this.toast.emit({\n        position: 'top-right',\n        title: 'Saved Successfully',\n        description: '',\n        type: 'success',\n      });\n      this.modal.closeModal();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    console.log(calendar_data.cleaning_frequency);\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <section class=\"p-1\">\n          <h3 class=\"mb-2\">{locales.entries.Lcz_HouseKeepingAndCheckInSetup}</h3>\n          <div class=\"card p-1\">\n            <ir-title borderShown label=\"Operations Settings\"></ir-title>\n            <div class={'d-flex align-items-center mb-1'}>\n              <p class=\"my-0 py-0 mr-1\">{locales.entries.Lcz_CheckInOutGuestsAutomatically}</p>\n              <ir-select\n                showFirstOption={false}\n                selectedValue={calendar_data.is_automatic_check_in_out ? 'auto' : 'manual'}\n                onSelectChange={e => this.saveAutomaticCheckInCheckout(e)}\n                data={[\n                  { text: locales.entries.Lcz_YesAsPerPropertyPolicy, value: 'auto' },\n                  { text: locales.entries.Lcz_NoIWillDoItManually, value: 'manual' },\n                ]}\n              ></ir-select>\n            </div>\n            <div class={'d-flex align-items-center'}>\n              <p class=\"my-0 py-0 mr-1\">{locales.entries.Lcz_CleaningFrequency}:</p>\n              <ir-select\n                showFirstOption={false}\n                selectedValue={this.selectedCleaningFrequency}\n                onSelectChange={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  this.selectedCleaningFrequency = e.detail;\n                  this.modal.openModal();\n                }}\n                data={housekeeping_store?.hk_criteria?.cleaning_frequencies.map(v => ({\n                  text: v.description,\n                  value: v.code,\n                }))}\n              ></ir-select>\n            </div>\n          </div>\n          {/*<ir-unit-status class=\"mb-1\"></ir-unit-status>*/}\n          {calendar_data.housekeeping_enabled && <ir-hk-team class=\"mb-1\"></ir-hk-team>}\n          <ir-modal\n            autoClose={false}\n            ref={el => (this.modal = el)}\n            isLoading={isRequestPending('/Set_Exposed_Cleaning_Frequency')}\n            onConfirmModal={this.saveCleaningFrequency.bind(this)}\n            iconAvailable={true}\n            onCancelModal={() => {\n              this.selectedCleaningFrequency = calendar_data.cleaning_frequency?.code;\n            }}\n            icon=\"ft-alert-triangle danger h1\"\n            leftBtnText={locales.entries.Lcz_Cancel}\n            rightBtnText={locales.entries.Lcz_Confirm}\n            leftBtnColor=\"secondary\"\n            rightBtnColor={'primary'}\n            modalTitle={locales.entries.Lcz_Confirmation}\n            modalBody={'This action will reschedule all cleaning tasks. Do you want to continue?'}\n          ></ir-modal>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { DailyReport, DailyReportFilter } from './types';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { RoomService } from '@/services/room.service';\nimport { DailyStat, MonthlyStatsResults, PropertyService } from '@/services/property.service';\n\n@Component({\n  tag: 'ir-monthly-bookings-report',\n  styleUrl: 'ir-monthly-bookings-report.css',\n  scoped: true,\n})\nexport class IrMonthlyBookingsReport {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isPageLoading = true;\n  @State() isLoading: 'export' | 'filter' | null = null;\n\n  @State() reports: DailyReport[] = [];\n  @State() filters: DailyReportFilter;\n  @State() property_id: number;\n  @State() stats: Omit<MonthlyStatsResults, 'DailyStats'>;\n\n  private baseFilters: DailyReportFilter;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n\n  componentWillLoad() {\n    this.baseFilters = {\n      date: {\n        description: moment().format('MMMM YYYY'),\n        firstOfMonth: moment().startOf('month').format('YYYY-MM-DD'),\n        lastOfMonth: moment().endOf('month').format('YYYY-MM-DD'),\n      },\n      include_previous_year: false,\n    };\n    this.filters = this.baseFilters;\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Listen('applyFilters')\n  handleApplyFiltersChange(e: CustomEvent<DailyReportFilter>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.filters = e.detail;\n    this.getReports();\n  }\n\n  private async init() {\n    try {\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.roomService.fetchLanguage(this.language), this.getReports()];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getReports(isExportToExcel = false) {\n    try {\n      const getReportObj = (report: DailyStat): DailyReport => {\n        return {\n          day: report.Date,\n          units_booked: report.Units_booked,\n          occupancy_percent: report.Occupancy,\n          adr: report.ADR,\n          rooms_revenue: report.Rooms_Revenue,\n          total_guests: report?.Total_Guests,\n        };\n      };\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n      const { date, include_previous_year } = this.filters;\n\n      const requests = [\n        this.propertyService.getMonthlyStats({\n          from_date: date.firstOfMonth,\n          to_date: date.lastOfMonth,\n          property_id: this.property_id,\n          is_export_to_excel: isExportToExcel,\n        }),\n      ];\n\n      if (include_previous_year) {\n        requests.push(\n          this.propertyService.getMonthlyStats({\n            from_date: moment(date.firstOfMonth, 'YYYY-MM-DD').add(-1, 'year').format('YYYY-MM-DD'),\n            to_date: moment(date.lastOfMonth, 'YYYY-MM-DD').add(-1, 'years').format('YYYY-MM-DD'),\n            property_id: this.property_id,\n          }),\n        );\n      }\n\n      const results = await Promise.all(requests);\n      const currentReports = results[0];\n      let enrichedReports: DailyReport[] = [];\n      const { DailyStats, ...rest } = currentReports;\n\n      this.stats = { ...rest };\n\n      if (include_previous_year && results[isExportToExcel ? 0 : 1]) {\n        const previousYearReports = results[isExportToExcel ? 0 : 1];\n        let formattedReports = previousYearReports.DailyStats.map(getReportObj);\n        enrichedReports = DailyStats.map(getReportObj).map(current => {\n          const previous = formattedReports.find(prev => prev.day === moment(current.day, 'YYYY-MM-DD').add(-1, 'years').format('YYYY-MM-DD'));\n          return {\n            ...current,\n            last_year: previous ?? null,\n          };\n        });\n      } else {\n        enrichedReports = DailyStats.map(getReportObj);\n      }\n      this.reports = [...enrichedReports];\n    } catch (e) {\n      console.log(e);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Daily Occupancy</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getReports(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <section>\n            <div class=\"d-flex flex-column flex-md-row w-100\" style={{ gap: '1rem', alignItems: 'stretch' }}>\n              <ir-stats-card\n                icon={this.stats?.Occupancy_Difference_From_Previous_Month < 0 ? 'arrow-trend-down' : 'arrow-trend-up'}\n                cardTitle=\"Average Occupancy\"\n                value={this.stats.AverageOccupancy ? this.stats?.AverageOccupancy.toFixed(2) + '%' : null}\n                subtitle={`${this.stats?.Occupancy_Difference_From_Previous_Month < 0 ? '' : '+'}${this.stats?.Occupancy_Difference_From_Previous_Month.toFixed(\n                  2,\n                )}% from last month`}\n              ></ir-stats-card>\n\n              <ir-stats-card\n                icon=\"hotel\"\n                cardTitle=\"Total Units\"\n                value={this.stats?.TotalUnitsBooked ? this.stats?.TotalUnitsBooked.toString() : null}\n                subtitle=\"Booked\"\n              ></ir-stats-card>\n\n              <ir-stats-card icon=\"user_group\" cardTitle=\"Total Guests\" value={this.stats?.Total_Guests?.toString()} subtitle=\"Stayed\"></ir-stats-card>\n\n              <ir-stats-card\n                icon=\"calendar\"\n                cardTitle=\"Peak Days\"\n                value={this.stats?.PeakDays.length === 0 ? null : this.stats?.PeakDays?.map(pd => moment(pd.Date, 'YYYY-MM-DD').format('D').concat('th')).join(' - ')}\n                subtitle={`${Math.max(...(this.stats.PeakDays?.map(pd => pd.OccupancyPercent) || []))}% occupancy`}\n              ></ir-stats-card>\n            </div>\n            <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n              <ir-monthly-bookings-report-filter isLoading={this.isLoading === 'filter'} class=\"filters-card\" baseFilters={this.baseFilters}></ir-monthly-bookings-report-filter>\n              <ir-monthly-bookings-report-table reports={this.reports}></ir-monthly-bookings-report-table>\n            </div>\n          </section>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport Token from '@/models/Token';\nimport { AllowedProperties, PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport moment from 'moment';\nimport { ChannelReport, ChannelReportResult, ChannelSaleFilter, SalesByChannelMode } from './types';\n@Component({\n  tag: 'ir-sales-by-channel',\n  styleUrl: 'ir-sales-by-channel.css',\n  scoped: true,\n})\nexport class IrSalesByChannel {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: string;\n  @Prop() p: string;\n  @Prop() mode!: SalesByChannelMode;\n\n  @State() isLoading: 'filter' | 'export' | null = null;\n  @State() isPageLoading = true;\n\n  @State() salesData: ChannelReportResult;\n  @State() channelSalesFilters: ChannelSaleFilter;\n  @State() allowedProperties: AllowedProperties = [];\n  @State() propertyID: number;\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n\n  private baseFilters: ChannelSaleFilter = {\n    FROM_DATE: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    TO_DATE: moment().format('YYYY-MM-DD'),\n    BOOK_CASE: '001',\n    WINDOW: 7,\n    include_previous_year: false,\n    is_export_to_excel: false,\n  };\n\n  componentWillLoad() {\n    this.channelSalesFilters = this.baseFilters;\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  private async initializeApp() {\n    try {\n      if (!this.mode) {\n        throw new Error(\"Missing required 'mode'. Please set it to either 'property' or 'mpo'.\");\n      }\n      if (!this.propertyid && this.mode === 'property' && !this.p) {\n        throw new Error('Missing Property ID or aname');\n      }\n      if (this.mode === 'property') {\n        const property = await this.propertyService.getExposedProperty({\n          id: Number(this.propertyid ?? 0),\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n        this.propertyID = property.My_Result.id;\n      }\n      const requests: Promise<unknown>[] = [, this.roomService.fetchLanguage(this.language)];\n      if (this.mode === 'mpo') {\n        requests.unshift(this.propertyService.getExposedAllowedProperties());\n        const [properties] = await Promise.all(requests);\n        this.allowedProperties = [...(properties as any)];\n      }\n\n      this.baseFilters = { ...this.baseFilters, LIST_AC_ID: this.allowedProperties?.map(p => p.id) };\n      this.channelSalesFilters = { ...this.baseFilters };\n\n      await this.getChannelSales();\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getChannelSales(isExportToExcel = false) {\n    try {\n      const { include_previous_year, LIST_AC_ID, ...filterParams } = this.channelSalesFilters;\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n      const currentSales = await this.propertyService.getChannelSales({\n        is_export_to_excel: isExportToExcel,\n        ...filterParams,\n        AC_ID: this.propertyID ? this.propertyID.toString() : undefined,\n        ...filterParams,\n        LIST_AC_ID: this.propertyID ? null : LIST_AC_ID,\n      });\n      const shouldFetchPreviousYear = !isExportToExcel && include_previous_year;\n      let enrichedSales: ChannelReportResult = [];\n      if (shouldFetchPreviousYear) {\n        const previousYearSales = await this.propertyService.getChannelSales({\n          AC_ID: this.propertyID ? this.propertyID.toString() : undefined,\n          ...filterParams,\n          LIST_AC_ID: this.propertyID ? null : LIST_AC_ID,\n          FROM_DATE: moment(filterParams.FROM_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n          TO_DATE: moment(filterParams.TO_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n        });\n\n        enrichedSales = currentSales.map(current => {\n          const previous = previousYearSales.find(prev => prev.SOURCE.toLowerCase() === current.SOURCE.toLowerCase());\n          return {\n            ...current,\n            last_year: previous ? previous : null,\n          };\n        });\n      } else {\n        enrichedSales = currentSales.map(record => ({\n          ...record,\n          last_year: null,\n        }));\n      }\n      /**\n       * Groups sales records by SOURCE and currency.id, summing numeric fields\n       * and recalculating PCT based on the total REVENUE.\n       */\n      const groupSalesRecordsBySource = (records: ChannelReportResult): ChannelReportResult => {\n        if (!records || records.length === 0) return records;\n\n        // Helper to extract currency ID from various possible formats\n        const getCurrencyId = (r: ChannelReport): string | null => {\n          return r?.currency ?? null;\n        };\n\n        // Create unique key for grouping\n        const createKey = (r: ChannelReport): string => {\n          const source = r.SOURCE.toString().toLowerCase().trim();\n          const currencyId = getCurrencyId(r);\n          return `${source}__${currencyId ?? 'null'}`;\n        };\n\n        // Sum two values safely\n        const sumValues = (a: number | undefined, b: number | undefined): number => {\n          return (a ?? 0) + (b ?? 0);\n        };\n\n        // Merge numeric fields from last_year objects\n        const mergeLastYear = (base: ChannelReport['last_year'], incoming: ChannelReport['last_year']): ChannelReport['last_year'] => {\n          if (!incoming) return base;\n          if (!base) return { ...incoming };\n\n          return {\n            NIGHTS: sumValues(base.NIGHTS, incoming.NIGHTS),\n            PCT: sumValues(base.PCT, incoming.PCT), // Will recalculate later\n            REVENUE: sumValues(base.REVENUE, incoming.REVENUE),\n            SOURCE: base.SOURCE,\n            PROPERTY_ID: base.PROPERTY_ID,\n            PROPERTY_NAME: base.PROPERTY_NAME,\n            currency: base.currency,\n          };\n        };\n\n        // Group records by key\n        const grouped = new Map<string, ChannelReport>();\n\n        for (const record of records) {\n          const key = createKey(record);\n          const existing = grouped.get(key);\n\n          if (!existing) {\n            // First record for this key - clone it\n            grouped.set(key, { ...record });\n          } else {\n            // Merge with existing record\n            const merged: ChannelReport = {\n              ...existing,\n              NIGHTS: sumValues(existing.NIGHTS, record.NIGHTS),\n              PCT: 0, // Will recalculate after summing all REVENUE\n              REVENUE: sumValues(existing.REVENUE, record.REVENUE),\n              last_year: mergeLastYear(existing.last_year, record.last_year),\n            };\n            grouped.set(key, merged);\n          }\n        }\n\n        // Convert to array\n        const result = Array.from(grouped.values());\n\n        // Recalculate PCT based on total REVENUE\n        const totalRevenue = result.reduce((sum, r) => sum + (r.REVENUE ?? 0), 0);\n\n        if (totalRevenue > 0) {\n          for (const record of result) {\n            record.PCT = (record.REVENUE / totalRevenue) * 100;\n\n            // Also recalculate last_year PCT if it exists\n            if (record.last_year) {\n              const lastYearTotal = result.reduce((sum, r) => sum + (r.last_year?.REVENUE ?? 0), 0);\n              if (lastYearTotal > 0) {\n                record.last_year.PCT = (record.last_year.REVENUE / lastYearTotal) * 100;\n              }\n            }\n          }\n        }\n\n        return result;\n      };\n\n      this.salesData = [...groupSalesRecordsBySource(enrichedSales)];\n    } catch (error) {\n      console.error('Failed to fetch sales data:', error);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Sales by Channel</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getChannelSales(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          {/* <ir-sales-by-country-summary salesReports={this.salesData}></ir-sales-by-country-summary> */}\n          <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n            <ir-sales-by-channel-filters\n              isLoading={this.isLoading === 'filter'}\n              onApplyFilters={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.channelSalesFilters = { ...e.detail };\n                this.getChannelSales();\n              }}\n              allowedProperties={this.allowedProperties}\n              baseFilters={this.baseFilters}\n            ></ir-sales-by-channel-filters>\n            <ir-sales-by-channel-table mode={this.mode} allowedProperties={this.allowedProperties} class=\"card mb-0\" records={this.salesData}></ir-sales-by-channel-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { BaseSalesRecord, CountrySalesFilter, MappedCountries, SalesRecord } from './types';\nimport moment from 'moment';\nimport { v4 } from 'uuid';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { ICountry } from '@/models/IBooking';\n\n@Component({\n  tag: 'ir-sales-by-country',\n  styleUrl: 'ir-sales-by-country.css',\n  scoped: true,\n})\nexport class IrSalesByCountry {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isLoading: 'filter' | 'export' | null = null;\n  @State() isPageLoading = true;\n  @State() property_id: number;\n  @State() salesData: SalesRecord[];\n  @State() salesFilters: CountrySalesFilter;\n  @State() countries: MappedCountries = new Map();\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private bookingService = new BookingService();\n\n  private baseFilters = {\n    FROM_DATE: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    TO_DATE: moment().format('YYYY-MM-DD'),\n    BOOK_CASE: '001',\n    WINDOW: 7,\n    include_previous_year: false,\n  };\n\n  componentWillLoad() {\n    this.salesFilters = this.baseFilters;\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n  private async initializeApp() {\n    try {\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.bookingService.getCountries(this.language), this.roomService.fetchLanguage(this.language), this.getCountrySales()];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [countries] = await Promise.all(requests);\n      const mappedCountries = new Map();\n      (countries as ICountry[]).map(country => {\n        mappedCountries.set(country.id, {\n          flag: country.flag,\n          name: country.name,\n        });\n      });\n      this.countries = mappedCountries;\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getCountrySales(isExportToExcel = false) {\n    const formatSalesData = (data): Omit<BaseSalesRecord, 'id'> => {\n      return {\n        country: data.COUNTRY,\n        country_id: data.COUNTRY_ID,\n        nights: data.NIGHTS,\n        percentage: data.PCT,\n        revenue: data.REVENUE,\n        number_of_guests: data.Total_Guests,\n      };\n    };\n    try {\n      const { include_previous_year, ...filterParams } = this.salesFilters;\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n\n      const currentSales = await this.propertyService.getCountrySales({\n        AC_ID: this.property_id,\n        is_export_to_excel: isExportToExcel,\n        ...filterParams,\n      });\n\n      const shouldFetchPreviousYear = !isExportToExcel && include_previous_year;\n\n      let enrichedSales: SalesRecord[] = [];\n\n      if (shouldFetchPreviousYear) {\n        const previousYearSales = await this.propertyService.getCountrySales({\n          AC_ID: this.property_id,\n          is_export_to_excel: false,\n          ...filterParams,\n          FROM_DATE: moment(filterParams.FROM_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n          TO_DATE: moment(filterParams.TO_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n        });\n\n        enrichedSales = currentSales.map(current => {\n          const previous = previousYearSales.find(prev => prev.COUNTRY.toLowerCase() === current.COUNTRY.toLowerCase());\n          return {\n            id: v4(),\n            ...formatSalesData(current),\n            last_year: previous ? formatSalesData(previous) : null,\n          };\n        });\n      } else {\n        enrichedSales = currentSales.map(record => ({\n          id: v4(),\n          ...formatSalesData(record),\n          last_year: null,\n        }));\n      }\n\n      // this.salesData = enrichedSales.sort((a, b) => {\n      //   if (a.country_id === 0) return -1;\n      //   if (b.country_id === 0) return 1;\n      //   return 0;\n      // });\n      this.salesData = [...enrichedSales];\n    } catch (error) {\n      console.error('Failed to fetch sales data:', error);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Sales by Country</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getCountrySales(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <ir-sales-by-country-summary salesReports={this.salesData}></ir-sales-by-country-summary>\n          <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n            <ir-sales-filters\n              isLoading={this.isLoading === 'filter'}\n              onApplyFilters={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.salesFilters = e.detail;\n                this.getCountrySales();\n              }}\n              class=\"filters-card\"\n              baseFilters={this.baseFilters}\n            ></ir-sales-filters>\n            <ir-sales-table mappedCountries={this.countries} class=\"card mb-0\" records={this.salesData}></ir-sales-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  height: 100%;\n}\n","import Token from '@/models/Token';\nimport { User } from '@/models/Users';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { RoomService } from '@/services/room.service';\nimport { UserService } from '@/services/user.service';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { AllowedUser } from './types';\nimport { bookingReasons } from '@/models/IBooking';\nimport { io, Socket } from 'socket.io-client';\nimport locales from '@/stores/locales.store';\n\n@Component({\n  tag: 'ir-user-management',\n  styleUrl: 'ir-user-management.css',\n  scoped: true,\n})\nexport class IrUserManagement {\n  @Prop() language: string = '';\n  @Prop() baseUrl: string;\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() isSuperAdmin: boolean = true;\n  @Prop() userTypeCode: string | number;\n  @Prop() baseUserTypeCode: string | number;\n  @Prop() userId: string | number;\n\n  @State() isLoading = true;\n  @State() users: User[] = [];\n  @State() property_id: number;\n  @State() allowedUsersTypes: AllowedUser[] = [];\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private userService = new UserService();\n  private bookingService = new BookingService();\n\n  private userTypes: Map<number | string, string> = new Map();\n  private socket: Socket;\n\n  private superAdminId = '5';\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchUsers();\n  }\n\n  private async initializeApp() {\n    try {\n      if (this.baseUrl) {\n        this.token.setBaseUrl(this.baseUrl);\n      }\n      this.isLoading = true;\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.fetchUserTypes(), this.fetchUsers(), this.roomService.fetchLanguage(this.language, ['_USER_MGT'])];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      this.socket = io('https://realtime.igloorooms.com/');\n      this.socket.on('MSG', async msg => {\n        await this.handleSocketMessage(msg);\n      });\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private async handleSocketMessage(msg: string) {\n    const msgAsObject = JSON.parse(msg);\n    if (!msgAsObject) {\n      return;\n    }\n\n    const { REASON, KEY, PAYLOAD }: { REASON: bookingReasons; KEY: any; PAYLOAD: any } = msgAsObject;\n\n    if (KEY.toString() !== this.property_id.toString()) {\n      return;\n    }\n\n    let result = JSON.parse(PAYLOAD);\n    console.log(KEY, result);\n    // const reasonHandlers: Partial<Record<bookingReasons, Function>> = {\n    //   DORESERVATION: this.updateUserVerificationStatus,\n    // };\n    const reasonHandlers: Partial<Record<bookingReasons, Function>> = {\n      EMAIL_VERIFIED: this.updateUserVerificationStatus,\n    };\n    const handler = reasonHandlers[REASON];\n    if (handler) {\n      await handler.call(this, result);\n    } else {\n      console.warn(`Unhandled REASON: ${REASON}`);\n    }\n  }\n\n  public updateUserVerificationStatus(result: { id: string | number }) {\n    const users = [...this.users];\n    const idx = users.findIndex(u => u.id === result.id);\n    if (idx === -1) {\n      console.warn(`User ${result.id} not found`);\n      return;\n    }\n    users[idx] = {\n      ...users[idx],\n      is_email_verified: true,\n    };\n    this.users = users;\n  }\n\n  private async fetchUsers() {\n    const users = await this.userService.getExposedPropertyUsers({ property_id: this.propertyid });\n    this.users = [...users].sort((u1: User, u2: User) => {\n      const priority = (u: User) => {\n        const t = u.type.toString();\n        if (t === this.superAdminId) return 0;\n        if (t === '17') return 1;\n        return 2;\n      };\n      //sort by priority\n      const p1 = priority(u1),\n        p2 = priority(u2);\n      if (p1 !== p2) {\n        return p1 - p2;\n      }\n      // //sort by user id\n      // if (p1 === 1) {\n      //   const id1 = u1.id.toString(),\n      //     id2 = u2.id.toString(),\n      //     me = this.userId.toString();\n      //   if (id1 === me) return -1; // u1 is me → goes before u2\n      //   if (id2 === me) return 1; // u2 is me → u1 goes after\n      // }\n\n      // 3) sort by username\n      return u1.username.localeCompare(u2.username);\n    });\n  }\n  private async fetchUserTypes() {\n    const res = await Promise.all([this.bookingService.getSetupEntriesByTableName('_USER_TYPE'), this.bookingService.getLov()]);\n    const allowedUsers = res[1]?.My_Result?.allowed_user_types;\n    for (const e of res[0]) {\n      const value = e[`CODE_VALUE_${this.language?.toUpperCase() ?? 'EN'}`];\n      if (allowedUsers.find(f => f.code === e.CODE_NAME)) {\n        this.allowedUsersTypes.push({ code: e.CODE_NAME, value });\n      }\n      this.userTypes.set(e.CODE_NAME.toString(), value);\n    }\n  }\n  disconnectedCallback() {\n    this.socket.disconnect();\n  }\n  render() {\n    if (this.isLoading) {\n      return (\n        <Host>\n          <ir-toast></ir-toast>\n          <ir-interceptor></ir-interceptor>\n          <ir-loading-screen></ir-loading-screen>\n        </Host>\n      );\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor suppressToastEndpoints={['/Change_User_Pwd', '/Handle_Exposed_User']}></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex  pb-2 align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">{locales.entries.Lcz_ExtranetUsers}</h3>\n          </div>\n\n          <div class=\"\" style={{ gap: '1rem' }}>\n            <ir-user-management-table\n              property_id={this.property_id}\n              baseUserTypeCode={this.baseUserTypeCode}\n              allowedUsersTypes={this.allowedUsersTypes}\n              userTypeCode={this.userTypeCode}\n              haveAdminPrivileges={[this.superAdminId, '17'].includes(this.userTypeCode?.toString())}\n              userTypes={this.userTypes}\n              class=\"card\"\n              isSuperAdmin={this.userTypeCode?.toString() === this.superAdminId}\n              users={this.users}\n            ></ir-user-management-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}