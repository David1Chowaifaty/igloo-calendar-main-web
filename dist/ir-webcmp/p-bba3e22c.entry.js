import{r as t,c as e,h as i,F as s,H as o,g as a}from"./p-53d64953.js";import{B as n}from"./p-4854ca51.js";import{t as l,q as r,k as d,a as c,A as h,B as g,i as b,C as f,D as u,E as p}from"./p-19e5af8e.js";import{h as m}from"./p-6c4ba7c0.js";import{E as v}from"./p-62d62dbd.js";import{l as k}from"./p-71768c2d.js";import{c as y}from"./p-00df8713.js";import{z as w,Z as D}from"./p-b859bcd5.js";import{H as x}from"./p-b6c1681e.js";import{T as Y}from"./p-2d047d8f.js";import{h as _,g as M}from"./p-25bd4703.js";import{c as E}from"./p-6b5b5b8a.js";import"./p-bf44a732.js";import"./p-a973aec7.js";const C=".sc-igl-booking-event-h{display:block;position:absolute;--ota-bar-width:2px}.bookingEventBase.sc-igl-booking-event{position:absolute;background-color:rgb(49, 190, 241);width:100%;height:100%;border-radius:4px;transform:skewX(-22deg)}.bookingEventBase.skewedLeft.sc-igl-booking-event::before{content:'';position:absolute;top:0px;bottom:0;left:-4px;width:50%;height:100%;background-color:var(--ir-event-bg);transform-origin:right;transform:skewX(22deg);border-radius:4px;border-top-left-radius:0;border-bottom-left-radius:0}.bookingEventBase.skewedRight.sc-igl-booking-event::before{content:'';position:absolute;top:0;bottom:0;right:-4px;width:50%;height:100%;background-color:var(--ir-event-bg);transform-origin:left;transform:skewX(22deg);border-radius:4px;border-top-right-radius:0;border-bottom-right-radius:0}.bookingEventBase.border.skewedLeft.sc-igl-booking-event::before{border:var(--ota-bar-width) solid #424242;border-right:0;border-left:0;border-top-right-radius:0;border-bottom-right-radius:0;top:calc(var(--ota-bar-width) * -1);height:20px;left:-4px}.ota-booking-event.sc-igl-booking-event{border-width:var(--ota-bar-width) !important}.bookingEventBase.border.skewedRight.sc-igl-booking-event::before{border:var(--ota-bar-width) solid #424242;border-left:0;border-right:0;border-top-left-radius:0;border-bottom-left-radius:0;top:calc(var(--ota-bar-width) * -1);height:20px;right:-4px}.bookingEvent.sc-igl-booking-event{cursor:pointer}.bookingEventBase.sc-igl-booking-event{cursor:pointer}.bookingEventHiddenBase.sc-igl-booking-event{position:absolute;top:0;left:-4px;width:calc(100% + 8)}.bookingEventDragHandle.sc-igl-booking-event{position:absolute;top:0;width:15px;height:100%;opacity:0.1;background-color:rgba(0, 0, 0, 0.15);transform:skewX(-22deg);border-radius:4px;cursor:pointer}.splitBooking.sc-igl-booking-event{border-right:2px solid #000000}.sc-igl-booking-event-h:hover .bookingEventDragHandle.sc-igl-booking-event{display:block;opacity:1}.newEvent.sc-igl-booking-event-h:hover .bookingEventDragHandle.sc-igl-booking-event{display:none;opacity:1}.leftSide.sc-igl-booking-event{left:0}.leftSide.skewedLeft.sc-igl-booking-event{transform:skewX(0)}.rightSide.skewedRight.sc-igl-booking-event{transform:skewX(0)}.rightSide.sc-igl-booking-event{right:0}.bookingEventTitle.sc-igl-booking-event{color:#fff;font-size:0.8em;position:relative;max-width:calc(100% - 10px);overflow:hidden;text-overflow:ellipsis;top:2px;left:5px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none;cursor:pointer}.legend_circle.sc-igl-booking-event{border-radius:100%;width:10px;height:10px;margin:3px 3px 3px 2px;border:1px solid #fff}.noteIcon.sc-igl-booking-event{position:absolute;bottom:-8px;left:2px}.balanceIcon.sc-igl-booking-event{position:absolute;top:-8px;right:2px}";const O=C;var T=undefined&&undefined.__rest||function(t,e){var i={};for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0)i[s]=t[s];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,s=Object.getOwnPropertySymbols(t);o<s.length;o++){if(e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o]))i[s[o]]=t[s[o]]}return i};const R=class{constructor(i){t(this,i);this.hideBubbleInfo=e(this,"hideBubbleInfo",7);this.updateEventData=e(this,"updateEventData",7);this.dragOverEventData=e(this,"dragOverEventData",7);this.showRoomNightsDialog=e(this,"showRoomNightsDialog",7);this.showDialog=e(this,"showDialog",7);this.resetStretchedBooking=e(this,"resetStretchedBooking",7);this.toast=e(this,"toast",7);this.updateBookingEvent=e(this,"updateBookingEvent",7);this.is_vacation_rental=false;this.allBookingEvents=[];this.renderElement=false;this.isShrinking=null;this.dayWidth=0;this.eventSpace=8;this.vertSpace=10;this.showInfoPopup=false;this.bubbleInfoTopSide=false;this.isStretch=false;this.eventsService=new v;this.bookingService=new n;this.resizeSide="";this.isDragging=false;this.animationFrameId=null;this.handleMouseMoveBind=this.handleMouseMove.bind(this);this.handleMouseUpBind=this.handleMouseUp.bind(this);this.handleClickOutsideBind=this.handleClickOutside.bind(this);this.findRoomType=t=>{let e=this.bookingEvent.roomsInfo.filter((e=>e.physicalrooms.some((e=>e.id===+t))));if(e.length){return e[0].id}return null}}componentWillLoad(){window.addEventListener("click",this.handleClickOutsideBind)}async fetchAndAssignBookingData(){try{console.log("clicked on book#",this.bookingEvent.BOOKING_NUMBER);const t=["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"];if(!t.includes(this.bookingEvent.STATUS)){return}const e=await this.bookingService.getExposedBooking(this.bookingEvent.BOOKING_NUMBER,"en");const i=e.rooms.filter((t=>t["assigned_units_pool"]===this.bookingEvent.ID));if(i.length===0){throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty array`)}if(i.some((t=>t["assigned_units_pool"]===null))){throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty pool`)}e.rooms=i;const s=l(e)[0];const{ID:o,TO_DATE:a,FROM_DATE:n,NO_OF_DAYS:r,STATUS:d,NAME:c,IDENTIFIER:h,PR_ID:g,POOL:b,BOOKING_NUMBER:f,NOTES:u,is_direct:p,BALANCE:m,channel_booking_nbr:v}=s,k=T(s,["ID","TO_DATE","FROM_DATE","NO_OF_DAYS","STATUS","NAME","IDENTIFIER","PR_ID","POOL","BOOKING_NUMBER","NOTES","is_direct","BALANCE","channel_booking_nbr"]);this.bookingEvent=Object.assign(Object.assign(Object.assign({},k),this.bookingEvent),{channel_booking_nbr:v,booking:e,DEPARTURE_TIME:k.DEPARTURE_TIME,PHONE:k.PHONE,PHONE_PREFIX:k.PHONE_PREFIX,PRIVATE_NOTE:k.PRIVATE_NOTE});this.updateBookingEvent.emit(this.bookingEvent);this.showEventInfo(true)}catch(t){console.error(t.message)}}componentDidLoad(){if(this.isNewEvent()){if(!this.bookingEvent.hideBubble){setTimeout((async()=>{if(["003","002","004"].includes(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}else{this.showEventInfo(true)}this.renderAgain()}),1)}}}disconnectedCallback(){window.removeEventListener("click",this.handleClickOutsideBind);if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}}handleClickOutside(t){const e=t.target;if(!this.element.contains(e)){this.showEventInfo(false)}}hideBubbleInfoPopup(t){if(t.detail.currentInfoBubbleId!=this.getBookingId()||t.detail.key==="hidebubble"&&t.detail.currentInfoBubbleId===this.getBookingId()){this.showInfoPopup=false;this.renderAgain()}}async moveBookingToHandler(t){var e,i,s;try{if(t.detail.bookingId!==this.getBookingId()){this.showEventInfo(false);return}if(t.detail.moveToDay==="revert"||t.detail.toRoomId==="revert"){t.detail.moveToDay=this.bookingEvent.FROM_DATE;t.detail.toRoomId=t.detail.fromRoomId;if(this.isTouchStart&&this.moveDifferenceX<=5&&this.moveDifferenceY<=5&&!this.isStretch){if(r(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}}else{this.animationFrameId=requestAnimationFrame((()=>{this.resetBookingToInitialPosition()}));return}}else{if(this.isTouchStart&&this.moveDifferenceX<=5&&this.moveDifferenceY<=5&&!this.isStretch){if(r(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}}else{const{pool:o,to_date:a,from_date:n,toRoomId:l}=t.detail;const h=m(a,"YYYY-MM-DD").add(-1,"days").format("YYYY-MM-DD");console.log(this.findRoomType(Number(this.bookingEvent.PR_ID)),this.findRoomType(Number(l)));if((!m(this.bookingEvent.TO_DATE,"YYYY-MM-DD").isSame(m(a,"YYYY-MM-DD"),"dates")||this.findRoomType(Number(this.bookingEvent.PR_ID))!==this.findRoomType(Number(l)))&&(((e=d.disabled_cells.get(`${l}_${n}`))===null||e===void 0?void 0:e.disabled)||((i=d.disabled_cells.get(`${l}_${a}`))===null||i===void 0?void 0:i.disabled)&&((s=d.disabled_cells.get(`${l}_${h}`))===null||s===void 0?void 0:s.disabled))&&!this.isStretch){this.reset("This room isnâ€™t available for the entire selected period. Please choose different dates or a different room.")}if(this.checkIfSlotOccupied(l,n,a)){this.reset("Overlapping Dates")}if(o){if(r(this.bookingEvent.STATUS_CODE)){await this.eventsService.reallocateEvent(o,l,n,a).catch((()=>{this.resetBookingToInitialPosition()}))}else{if(this.isShrinking||!this.isStretch){const{description:e,status:i}=this.getModalDescription(l,n,a);let s=false;if(i==="400"){s=true}const o=this.bookingEvent.defaultDates.from_date;const r=this.bookingEvent.defaultDates.to_date;const d=c(o,r);let h=null;let g=o;let b=r;if(this.isShrinking){if(m(n,"YYYY-MM-DD").isAfter(m(o,"YYYY-MM-DD"))&&m(a,"YYYY-MM-DD").isBefore(m(r,"YYYY-MM-DD"))){g=o;b=a}else{h=m(n,"YYYY-MM-DD").isAfter(m(o,"YYYY-MM-DD"))?"left":m(a,"YYYY-MM-DD").isBefore(m(r,"YYYY-MM-DD"))?"right":null;if(h==="left"){g=n}if(h==="right"){b=a}}}else{console.log("stretching");if(m(n,"YYYY-MM-DD").isBefore(m(o,"YYYY-MM-DD"))){g=n;const t=m(n,"YYYY-MM-DD").add(d,"days");b=t.isBefore(m(a,"YYYY-MM-DD"),"days")?a:t.format("YYYY-MM-DD")}else if(m(a,"YYYY-MM-DD").isAfter(m(r,"YYYY-MM-DD"))){b=a;g=m(a,"YYYY-MM-DD").subtract(d,"days").format("YYYY-MM-DD")}}console.warn({fromDate:g,toDate:b});this.showDialog.emit(Object.assign(Object.assign({reason:"reallocate"},t.detail),{description:e,title:"",hideConfirmButton:s,from_date:g,to_date:b}))}else{const t=this.bookingEvent.defaultDates.from_date;const e=this.bookingEvent.defaultDates.to_date;const i=(t,e)=>{var i;let s=t;let o=0;while(s!==e){if((i=d.disabled_cells.get(`${l}_${s}`))===null||i===void 0?void 0:i.disabled){o++}s=m(s,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD")}if(o>=1){this.reset(k.entries.Lcz_ThisUnitIsNotAvailable)}};if(m(e,"YYYY-MM-DD").isBefore(m(a),"dates")){i(e,a)}else if(m(t,"YYYY-MM-DD").isAfter(m(n,"YYYY-MM-DD"),"dates")){i(n,t)}const s={booking:this.bookingEvent,bookingNumber:this.bookingEvent.BOOKING_NUMBER,identifier:this.bookingEvent.IDENTIFIER,to_date:a,pool:o,from_date:n,defaultDates:this.bookingEvent.defaultDates};if(!this.bookingEvent.is_direct){this.showDialog.emit(Object.assign({reason:"stretch"},s))}else{this.showRoomNightsDialog.emit(s)}}}this.isShrinking=null}}}}catch(t){this.toast.emit({position:"top-right",title:t.message,description:"",type:"error"});console.log("something went wrong")}}reset(t){this.animationFrameId=requestAnimationFrame((()=>{this.resetBookingToInitialPosition()}));throw new Error(t)}getModalDescription(t,e,i){if(!this.bookingEvent.is_direct){if(this.isShrinking){return{description:k.entries.Lcz_OTA_Modification_Alter,status:"200"}}else{if(m(e,"YYYY-MM-DD").isSame(m(this.bookingEvent.FROM_DATE,"YYYY-MM-DD"))&&m(i,"YYYY-MM-DD").isSame(m(this.bookingEvent.TO_DATE,"YYYY-MM-DD"))){const e=this.findRoomType(this.bookingEvent.PR_ID);const i=this.findRoomType(t);if(e===i){return{description:`${k.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`,status:"200"}}else{return{description:k.entries.Lcz_OTA_Modification_Alter,status:"200"}}}return{description:k.entries.Lcz_CannotChangeCHBookings+".",status:"400"}}}else{if(!this.isShrinking){const e=this.findRoomType(Number(this.bookingEvent.PR_ID));const i=this.findRoomType(Number(t));if(e===i){console.log("same rt");if(this.bookingEvent.PR_ID.toString()===t.toString()){return{description:k.entries.Lcz_ConfrmModiication+".",status:"200"}}return{description:`${k.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`,status:"200"}}else{return{description:k.entries.Lcz_SameRatesWillBeKept+".",status:"200"}}}return{description:k.entries.Lcz_ConfrmModiication+".",status:"200"}}}resetBookingToInitialPosition(){if(this.isStretch){this.element.style.left=`${this.initialLeft}px`;this.element.style.width=`${this.initialWidth}px`;this.isStretch=false;this.finalWidth=this.initialWidth;this.isShrinking=null}else{this.element.style.top=`${this.dragInitPos.top}px`;this.element.style.left=`${this.dragInitPos.left}px`}}handleRevertBooking(t){if(this.bookingEvent.POOL===t.detail){this.resetBookingToInitialPosition()}}checkIfSlotOccupied(t,e,i){const s=m(e,"YYYY-MM-DD");const o=m(i,"YYYY-MM-DD");const a=this.allBookingEvents.some((e=>{if(e.POOL===this.bookingEvent.POOL){return false}const i=m(e.FROM_DATE,"YYYY-MM-DD").add(1,"days");const a=m(e.TO_DATE,"YYYY-MM-DD");return e.PR_ID===+t&&o.isSameOrAfter(i)&&s.isBefore(a)}));return a}renderAgain(){this.renderElement=!this.renderElement}getUniqueId(){return(new Date).getTime()}isSplitBooking(){return!!this.bookingEvent.SPLIT_BOOKING}isNewEvent(){return this.getBookingId()==="NEW_TEMP_EVENT"}isHighlightEventType(){return this.getEventType()==="HIGH_LIGHT"}getBookingId(){return this.bookingEvent.ID}getBookingStatus(){return this.bookingEvent.STATUS}getBookedBy(){return this.bookingEvent.NAME}getBookedRoomId(){return this.bookingEvent.PR_ID}getEventStartingDate(){return new Date(this.bookingEvent.FROM_DATE)}getEventEndingDate(){return new Date(this.bookingEvent.TO_DATE)}getEventType(){return this.bookingEvent.event_type}getEventLegend(){var t,e;let i=(t=this.bookingEvent)===null||t===void 0?void 0:t.legendData.statusId[this.getBookingStatus()];let s=this.isNewEvent()?{color:"#f9f9c9"}:{};return Object.assign(Object.assign(Object.assign({},(e=this.bookingEvent)===null||e===void 0?void 0:e.legendData[i.id]),i),s)}getLegendOfStatus(t){var e;let i=(e=this.bookingEvent)===null||e===void 0?void 0:e.legendData.statusId[t];return Object.assign(Object.assign({},this.bookingEvent.legendData[i.id]),i)}getNoteNode(){if(this.bookingEvent.NOTES||this.bookingEvent.INTERNAL_NOTE||this.bookingEvent.PRIVATE_NOTE){return this.getLegendOfStatus("NOTES")}return null}getBalanceNode(){if(this.bookingEvent.BALANCE!==null&&this.bookingEvent.BALANCE>=1){return this.getLegendOfStatus("OUTSTANDING-BALANCE")}return null}setStayDays(t){this.bookingEvent.NO_OF_DAYS=t;this.renderAgain()}getStayDays(){return this.bookingEvent.NO_OF_DAYS}getPosition(){let t=this.getEventStartingDate();let e=".room_"+this.getBookedRoomId()+"_"+t.getDate()+"_"+(t.getMonth()+1)+"_"+t.getFullYear();let i=document.querySelector(".bodyContainer");let s=document.querySelector(e);let o={top:"0",left:"0",width:"0",height:"20px"};if(s&&i&&s.getBoundingClientRect()&&i.getBoundingClientRect()){let t=i.getBoundingClientRect();let e=s.getBoundingClientRect();this.dayWidth=this.dayWidth||e.width;o.top=e.top+e.height/2-this.vertSpace-t.top+"px";o.left=e.left+(!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?0:this.dayWidth/2)+this.eventSpace/2-t.left+"px";o.width=(this.getStayDays()+(!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?.5:0))*this.dayWidth-this.eventSpace+"px"}else{console.log(this.bookingEvent);console.log("Locating event cell failed ",e)}return o}getNumber(t){return t?parseFloat(t):0}startDragging(t,e){t.preventDefault();t.stopPropagation();t.stopImmediatePropagation();if(this.isNewEvent()||this.isHighlightEventType()){return null}this.resizeSide=e;this.isDragging=true;this.showEventInfo(false);this.isStretch=e!=="move";if(e==="move"){this.initialX=t.clientX||t.touches[0].clientX;this.initialY=t.clientY||t.touches[0].clientY;this.elementRect=this.element.getBoundingClientRect();const e=0;const i=0;this.dragInitPos={id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.getNumber(this.element.style.top)+i,left:this.getNumber(this.element.style.left)+e};this.dragInitPos.x=this.dragInitPos.left;this.dragInitPos.y=this.dragInitPos.top;this.dragEndPos=Object.assign({},this.dragInitPos);this.element.style.top=`${this.dragInitPos.top}px`;this.element.style.left=`${this.dragInitPos.left}px`;this.isTouchStart=true;this.dragOverEventData.emit({id:"CALCULATE_DRAG_OVER_BOUNDS",data:this.dragInitPos})}else{this.initialWidth=this.element.offsetWidth;this.initialLeft=this.element.offsetLeft;this.initialX=t.clientX||t.touches[0].clientX;this.dragOverEventData.emit({id:"CALCULATE_DRAG_OVER_BOUNDS",data:{id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.getNumber(this.element.style.top),left:this.initialLeft,x:this.initialX,y:t.clientY||t.touches[0].clientY}})}document.addEventListener("mousemove",this.handleMouseMoveBind);document.addEventListener("touchmove",this.handleMouseMoveBind);document.addEventListener("pointermove",this.handleMouseMoveBind);document.addEventListener("mouseup",this.handleMouseUpBind);document.addEventListener("touchup",this.handleMouseUpBind);document.addEventListener("pointerup",this.handleMouseUpBind)}handleMouseMove(t){if(this.isDragging){this.currentX=t.clientX||t.touches[0].clientX;let e=this.currentX-this.initialX;if(this.resizeSide==="move"){this.currentY=t.clientY||t.touches[0].clientY;let i=this.currentY-this.initialY;this.element.style.top=`${this.dragInitPos.top+i}px`;this.element.style.left=`${this.dragInitPos.left+e}px`;this.dragEndPos={id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.dragInitPos.top+i,left:this.dragInitPos.left+e};this.dragEndPos.x=this.dragEndPos.left;this.dragEndPos.y=this.dragEndPos.top;this.dragOverEventData.emit({id:"DRAG_OVER",data:this.dragEndPos})}else{const t=!this.bookingEvent.is_direct&&!r(this.bookingEvent.STATUS_CODE);let i=this.initialWidth;if(this.resizeSide=="rightSide"){i=this.initialWidth+e;i=Math.min(i,this.initialX+this.element.offsetWidth);i=Math.max(this.dayWidth-this.eventSpace,i);this.isShrinking=e<0;if(!this.isShrinking&&t){return}this.element.style.width=`${i}px`}else if(this.resizeSide=="leftSide"){this.isShrinking=e>0;if(!this.isShrinking&&t){return}i=Math.max(this.dayWidth-this.eventSpace,this.initialWidth-e);let s=this.initialLeft+(this.initialWidth-i);this.element.style.left=`${s}px`;this.element.style.width=`${i}px`}this.finalWidth=i}}else{console.log("still mouse move listening...")}}handleMouseUp(){if(this.isDragging){if(this.resizeSide==="move"){if(this.isTouchStart){this.moveDifferenceX=Math.abs(this.dragEndPos.x-this.dragInitPos.x);this.moveDifferenceY=Math.abs(this.dragEndPos.y-this.dragInitPos.y)}this.dragOverEventData.emit({id:"DRAG_OVER_END",data:Object.assign(Object.assign({},this.dragEndPos),{pool:this.bookingEvent.POOL,nbOfDays:this.bookingEvent.NO_OF_DAYS})})}else{const t=this.finalWidth-(!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?this.dayWidth/2:0);const e=Math.round(t/this.dayWidth);console.log(t,this.dayWidth,e);let i=this.getStayDays();if(i!=e&&!isNaN(e)){if(this.resizeSide=="leftSide"){this.element.style.left=`${this.initialLeft+(i-e)*this.dayWidth}px`}else{if(e<i){this.isShrinking=true}}this.dragOverEventData.emit({id:"STRETCH_OVER_END",data:{id:this.getBookingId(),fromRoomId:+this.getBookedRoomId(),x:+this.element.style.left.replace("px",""),y:+this.element.style.top.replace("px",""),pool:this.bookingEvent.POOL,nbOfDays:e}});const t=!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?+this.dayWidth/2:0;this.element.style.width=`${e*this.dayWidth-this.eventSpace+t}px`}else{this.element.style.left=`${this.initialLeft}px`;this.element.style.width=`${e*this.dayWidth-this.eventSpace}px`}}}else{console.log("still mouse up listening...")}this.isDragging=false;document.removeEventListener("mousemove",this.handleMouseMoveBind);document.removeEventListener("touchmove",this.handleMouseMoveBind);document.removeEventListener("pointermove",this.handleMouseMoveBind);document.removeEventListener("mouseup",this.handleMouseUpBind);document.removeEventListener("touchup",this.handleMouseUpBind);document.removeEventListener("pointerup",this.handleMouseUpBind)}updateData(t){this.updateEventData.emit(t)}calculateHoverPosition(){const t=this.element.getBoundingClientRect();const e=t.width;const i=t.left;const s=window.innerWidth;let o;if(e<=s){o=e/2}else{o=s/2-i}return{position:"absolute",left:`${o}px`,transform:"translateX(-50%)"}}renderEventBookingNumber(){if(this.bookingEvent.STATUS==="TEMP-EVENT"||this.bookingEvent.ID==="NEW_TEMP_EVENT"){return""}if(r(this.bookingEvent.STATUS_CODE)){return""}if(!this.bookingEvent.is_direct){return` - ${this.bookingEvent.channel_booking_nbr}`}return` - ${this.bookingEvent.BOOKING_NUMBER}`}showEventInfo(t){if(this.isHighlightEventType()||this.bookingEvent.hideBubble){return null}if(t){let t=document.querySelector(".calendarScrollContainer");let e=t.getBoundingClientRect();let i=this.element.getBoundingClientRect();let s=e.height/2+e.top+50;if(i.top<s){this.bubbleInfoTopSide=false}else{this.bubbleInfoTopSide=true}}if(t){this.hideBubbleInfo.emit({key:"hidePopup",currentInfoBubbleId:this.getBookingId()})}this.showInfoPopup=t;this.renderAgain()}render(){let t=this.getEventLegend();let e=this.getNoteNode();let a=this.getBalanceNode();return i(o,{key:"311c9df43de54853d806c54ae114b1c49cad004d",class:`bookingEvent  ${this.isNewEvent()||this.isHighlightEventType()?"newEvent":""} ${t.clsName} `,style:this.getPosition(),id:"event_"+this.getBookingId()},i("div",{key:"b19d4b4e16d1d274e6adbc23aa439c7573f58904",class:`bookingEventBase  ${!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?"skewedLeft":""}\n          ${!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE))?"skewedRight":""}\n          ${!this.bookingEvent.is_direct&&!r(this.bookingEvent.STATUS_CODE)&&this.bookingEvent.STATUS!=="TEMP-EVENT"&&this.bookingEvent.ID!=="NEW_TEMP_EVENT"&&"border border-dark ota-booking-event"}  ${this.isSplitBooking()?"splitBooking":""}`,style:{backgroundColor:t.color,"--ir-event-bg":t.color},onTouchStart:t=>this.startDragging(t,"move"),onMouseDown:t=>this.startDragging(t,"move")}),e?i("div",{class:"legend_circle noteIcon",style:{backgroundColor:e.color}}):null,a?i("div",{class:"legend_circle balanceIcon",style:{backgroundColor:a.color}}):null,i("div",{key:"3c588522ec7c4823aff6c484120ab18598eea086",class:"bookingEventTitle",onTouchStart:t=>this.startDragging(t,"move"),onMouseDown:t=>this.startDragging(t,"move")},this.getBookedBy(),this.renderEventBookingNumber()),i(s,{key:"2c1dc349a2147ff6608f57d22f741712a4293e57"},i("div",{key:"8eca6865af55ab689cf51cc43f695494bb76a0e9",class:`bookingEventDragHandle leftSide ${!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?"skewedLeft":""}\n            ${!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE))?"skewedRight":""}`,onTouchStart:t=>this.startDragging(t,"leftSide"),onMouseDown:t=>this.startDragging(t,"leftSide")}),i("div",{key:"f4b93daf32afd280629352c0593f51126ea9b420",class:`bookingEventDragHandle rightSide ${!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?"skewedLeft":""}\n              ${!this.isNewEvent()&&m(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE))?"skewedRight":""}`,onTouchStart:t=>this.startDragging(t,"rightSide"),onMouseDown:t=>this.startDragging(t,"rightSide")})),this.showInfoPopup?i("igl-booking-event-hover",{is_vacation_rental:this.is_vacation_rental,countries:this.countries,currency:this.currency,class:"top",bookingEvent:this.bookingEvent,bubbleInfoTop:this.bubbleInfoTopSide,style:this.calculateHoverPosition()}):null)}get element(){return a(this)}};R.style=O;class N{constructor(t){var e;this.isActive=false;this.handleBeforeUnload=t=>{this.onIntercept();t.preventDefault();t.returnValue=""};this.onIntercept=(e=t.onIntercept)!==null&&e!==void 0?e:()=>{};if(t.autoActivate){this.activate()}}activate(){if(this.isActive)return;window.addEventListener("beforeunload",this.handleBeforeUnload,{capture:true});this.isActive=true}deactivate(){if(!this.isActive)return;window.removeEventListener("beforeunload",this.handleBeforeUnload,{capture:true});this.isActive=false}}const B=".sc-igl-bulk-block-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-bulk-block{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-bulk-block{transition:all 0.5s ease}.physical-room.sc-igl-bulk-block{margin-left:1rem !important;padding-top:0.5rem}.physical-room.sc-igl-bulk-block>td.sc-igl-bulk-block:last-child{padding-left:1rem}.room-type-list.sc-igl-bulk-block{padding:0;margin:0}.room-type-list.sc-igl-bulk-block>li.sc-igl-bulk-block,.physical-room.sc-igl-bulk-block,.room-type-row.sc-igl-bulk-block{list-style:none}";const I=B;const A=".sc-igl-bulk-block-h{height:100%}.sheet-container.sc-igl-bulk-block{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-block{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-block{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-block{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-block{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-block{flex-direction:row;align-items:center}}";const S=A;const j=class{constructor(i){t(this,i);this.closeModal=e(this,"closeModal",7);this.toast=e(this,"toast",7);this.maxDatesLength=8;this.selectedRoomTypes=new Map;this.selectedUnit=null;this.blockState="block";this.dates=[{from:null,to:null}];this.dateRefs=[];this.minDate=m().format("YYYY-MM-DD");this.bookingService=new n;this.datesSchema=w.array(w.object({from:w.any().refine((t=>m.isMoment(t)),{message:"Invalid 'from' date; expected a Moment object."}).transform((t=>t.format("YYYY-MM-DD"))),to:w.any().refine((t=>m.isMoment(t)),{message:"Invalid 'to' date; expected a Moment object."}).transform((t=>t.format("YYYY-MM-DD")))}))}componentDidLoad(){this.reloadInterceptor=new N({autoActivate:false});this.sidebar=document.querySelector("ir-sidebar")}disconnectedCallback(){this.reloadInterceptor.deactivate()}async addBlockDates(){var t,e;try{this.errors=null;this.isLoading=true;const i=this.datesSchema.parse(this.dates);if(!this.selectedUnit){this.unitSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="rooms";return}if(this.blockState==="block"){await this.bookingService.blockAvailabilityForBrackets({unit_id:(t=this.selectedUnit)===null||t===void 0?void 0:t.unit_id,description:"",block_status_code:"002",brackets:i.map((t=>({from_date:t.from,to_date:t.to})))})}else{await this.bookingService.unBlockUnitByPeriod({unit_id:(e=this.selectedUnit)===null||e===void 0?void 0:e.unit_id,from_date:i[0].from,to_date:i[0].to})}this.activate();this.deactivate();this.toast.emit({type:"success",title:k.entries.Lcz_RequestSubmittedSuccessfully,description:""});this.isLoading=false;this.closeModal.emit()}catch(t){console.log(t);if(t instanceof D){this.datesSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="dates"}}finally{this.isLoading=false}}activate(){this.reloadInterceptor.activate();if(this.sidebar)this.sidebar.preventClose=true}deactivate(){this.reloadInterceptor.deactivate();if(this.sidebar)this.sidebar.preventClose=false}handleDateChange({index:t,date:e,key:i}){var s,o;const a=[...this.dates];a[t]=Object.assign(Object.assign({},a[t]),{[i]:e});if(i==="from"&&((s=a[t].to)===null||s===void 0?void 0:s.isBefore(e,"dates"))){a[t].to=null}for(let i=t+1;i<a.length;i++){const t=(o=a[i])===null||o===void 0?void 0:o.from;if(t&&t.isSameOrBefore(e,"day")){a[i]={from:null,to:null}}}this.dates=a;setTimeout((()=>{var e,s;if(i==="from"){(e=this.dateRefs[t])===null||e===void 0?void 0:e.to.openDatePicker()}else{const t=a.findIndex((t=>t.from===null));if(t>-1){(s=this.dateRefs[t])===null||s===void 0?void 0:s.from.openDatePicker()}}}),100)}addDateRow(){const t=this.dates[this.dates.length-1];if(!t.from||!t.to){this.errors="dates";return}this.errors=null;this.dates=[...this.dates,{from:null,to:null}];setTimeout((()=>{var t;(t=this.dateRefs[this.dates.length-1].to)===null||t===void 0?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})}),100)}render(){return i("form",{key:"a6e196601f51a8108d1778ab6de9cd00109c3830",class:"bulk-sheet-container",onSubmit:t=>{t.preventDefault();this.addBlockDates()}},i("div",{key:"999f57d92f80462c02e10bb9951c069eeacd5e2e",class:"sheet-body px-1"},i("div",{key:"bbb67fcbe03a8be9e6835ff660b0f83fdb0e3753",class:"text-muted text-left pt-0 my-0 d-flex align-items-center pb-1",style:{gap:"0.5rem"}},i("p",{key:"5b042e8977c500793a24d960890be568627082bd",class:"m-0 p-0"},"Select the unit to"),i("ir-select",{key:"78e73a9dab1379a6959441541e2981666b0cd018",LabelAvailable:false,showFirstOption:false,selectedValue:this.blockState,data:[{text:"Block",value:"block"},{text:"Unblock",value:"unblock"}],onSelectChange:t=>{this.blockState=t.detail}})),i("div",{key:"5959c4a21ac2f764c5fc6c748f786e7b09c4b16f"},this.errors==="rooms"&&i("p",{key:"f0c9330ab45a7d9e34cb26859b343416e0e0fc44",class:"text-danger text-left smaller p-0 ",style:{"margin-bottom":"0.5rem"}},y.is_vacation_rental?k.entries.Lcz_PlzSelectOneListing:k.entries.Lcz_PlzSelectOneUnit),i("ul",{key:"e3782e820dec1013e46bf18db7ad3f8099d9545b",class:"room-type-list",ref:t=>this.unitSections=t},y.roomsInfo.map((t=>i(s,null,i("li",{key:`roomTypeRow-${t.id}`,class:`room-type-row`},i("div",{class:"d-flex choice-row"},i("span",{class:"pl-1 text-left room-type-name"},t.name))),t.physicalrooms.map(((e,s)=>{var o;const a=s===t.physicalrooms.length-1?"pb-1":"";return i("li",{key:`physicalRoom-${e.id}-${s}`,class:`physical-room ${a}`},i("div",{class:"d-flex choice-row"},i("ir-radio",{class:"pl-1 ",name:"unit",checked:((o=this.selectedUnit)===null||o===void 0?void 0:o.unit_id)===e.id,onCheckChange:()=>this.selectedUnit={roomtype_id:t.id,unit_id:e.id},label:e.name})))}))))))),i("table",{key:"c5dfdfb3125075af08cddf074ed8e73268ecd803",class:"mt-1",ref:t=>this.datesSections=t},i("thead",{key:"ce204ce1076b7fe78f0cbf459359f1e70c9e69a5"},i("tr",{key:"e15cdbf62f004694165e87bfb37e5c16dcceb328"},i("th",{key:"5dcace0284e43ba00c779987a3f338d6ba2e4ee8",class:"text-left"},k.entries.Lcz_From),i("th",{key:"7acf97f94e707d2ee053de1ad9eff451fe55fca7",class:"text-left"},k.entries.Lcz_ToExclusive),i("td",{key:"7ea5673b6ec092d2f313dbcb4a662e6cce6ed966"},this.dates.length!==this.maxDatesLength&&this.blockState==="block"&&i("ir-button",{key:"7b129f0cf951ea9015bc541a4167fee9ea9fe501",variant:"icon",icon_name:"plus",onClickHandler:()=>{this.addDateRow()}})))),i("tbody",{key:"fd82c7ff62ae377a0e8b14fd48e1c919b196052f"},this.dates.map(((t,e)=>{var s,o,a,n,l,r,d;if(!this.dateRefs[e]){this.dateRefs[e]={}}const c=e>0?(a=(o=(s=this.dates[e-1])===null||s===void 0?void 0:s.to.clone().add(1,"days"))===null||o===void 0?void 0:o.format("YYYY-MM-DD"))!==null&&a!==void 0?a:this.minDate:this.minDate;const h=this.dates[e].from?(l=(n=this.dates[e])===null||n===void 0?void 0:n.from.clone().add(1,"days"))===null||l===void 0?void 0:l.format("YYYY-MM-DD"):this.minDate;return i("tr",{key:`date_${e}`},i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{ref:t=>{this.dateRefs[e].from=t},forceDestroyOnUpdate:true,minDate:c,"data-testid":"pickup_arrival_date",date:(r=t.from)===null||r===void 0?void 0:r.format("YYYY-MM-DD"),emitEmptyDate:true,"aria-invalid":String(this.errors==="dates"&&!t.from),onDateChanged:t=>{t.stopImmediatePropagation();t.stopPropagation();this.handleDateChange({index:e,date:t.detail.start,key:"from"})},onDatePickerFocus:t=>{var i,s,o;t.stopImmediatePropagation();t.stopPropagation();if(e===0){return}const a=this.dates.findIndex((t=>!t.from||!t.to));if(!((i=this.dates[a])===null||i===void 0?void 0:i.from)){(s=this.dateRefs[a])===null||s===void 0?void 0:s.from.openDatePicker();return}if(!((o=this.dates[a])===null||o===void 0?void 0:o.to)){this.dateRefs[a].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:t.from?t.from.format("MMM DD, YYYY"):null,class:`form-control input-sm ${this.errors==="dates"&&!t.to?"border-danger":""} text-center`,style:{width:"100%"}}))),i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{forceDestroyOnUpdate:true,ref:t=>{this.dateRefs[e].to=t},"data-testid":"pickup_arrival_date",date:(d=t.to)===null||d===void 0?void 0:d.format("YYYY-MM-DD"),emitEmptyDate:true,minDate:h,"aria-invalid":String(this.errors==="dates"&&!t.to),onDateChanged:t=>{t.stopImmediatePropagation();t.stopPropagation();this.handleDateChange({index:e,date:t.detail.start,key:"to"})},maxDate:t.from?m(t.from).add(3,"months").format("YYYY-MM-DD"):undefined,onDatePickerFocus:t=>{var e,i,s,o;t.stopImmediatePropagation();t.stopPropagation();const a=this.dates.findIndex((t=>!t.from||!t.to));if(!((e=this.dates[a])===null||e===void 0?void 0:e.from)){(s=(i=this.dateRefs[a])===null||i===void 0?void 0:i.from)===null||s===void 0?void 0:s.openDatePicker();return}if(!((o=this.dates[a])===null||o===void 0?void 0:o.to)){this.dateRefs[a].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:t.to?t.to.format("MMM DD, YYYY"):null,class:`form-control input-sm \n                          ${this.errors==="dates"&&!t.to?"border-danger":""}\n                          text-center`,style:{width:"100%"}}))),e>0&&i("td",{class:"pb-1"},i("ir-button",{variant:"icon",icon_name:"minus",onClickHandler:()=>{this.dates=this.dates.filter(((t,i)=>i!==e))}})))}))))),i("div",{key:"548e2c2c6707430093dca71cdba8b5d3c30dcb10",class:"sheet-footer"},i("ir-button",{key:"776fd40777dc7ded925f74948217df3a6af0c53d",text:k.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"337025222e26c43809b7d1ec69c2eddde8c6f911",isLoading:this.isLoading,text:k.entries.Lcz_Confirm,btn_type:"submit",class:"flex-fill"})))}};j.style=I+S;const L=".bulk-operations-sheet-container.sc-igl-bulk-operations{display:flex;flex-direction:column;height:auto !important;min-height:100vh;background:white !important}.animated-container.sc-igl-bulk-operations{transition:all 0.5s ease}.tabs.sc-igl-bulk-operations{position:sticky;top:var(--ir-tabs-top, 54px);background-color:white;z-index:9999999;padding-top:1rem;margin-bottom:1rem}";const z=L;const H=".sc-igl-bulk-operations-h{height:100%}.sheet-container.sc-igl-bulk-operations{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-operations{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-operations{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-operations{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-operations{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-operations{flex-direction:row;align-items:center}}";const P=H;const F=class{constructor(i){t(this,i);this.closeModal=e(this,"closeModal",7);this.toast=e(this,"toast",7);this.maxDatesLength=8;this.tabs=[{id:"stop-sale",label:"Stop/Open Sale"},{id:"block",label:"Block Unit"}]}componentDidLoad(){var t,e,i;this.tabsEl.style.setProperty("--ir-tabs-top",((i=(e=(t=this.titleEl)===null||t===void 0?void 0:t.getBoundingClientRect())===null||e===void 0?void 0:e.height)===null||i===void 0?void 0:i.toString())+"px")}render(){var t;return i("div",{key:"a042ae63bfd96d3d42bd1bfc89f898ce3c4a8e06",class:"bulk-operations-sheet-container"},i("div",{key:"a8f4395270efcef1a10f6f72d609782f374a93d8",class:"sheet-header d-flex align-items-center"},i("ir-title",{key:"26a94dd90feb5e1df0a64630152d3bd68d8042f4",ref:t=>this.titleEl=t,onCloseSideBar:t=>{t.stopImmediatePropagation();t.stopPropagation();this.closeModal.emit(null)},class:"px-1 mb-0",label:"Bulk Operations",displayContext:"sidebar"})),i("ir-tabs",{key:"59ff9d12ea4eb70bbe2d12b2c94c612ab7b5ab23",ref:t=>this.tabsEl=t,class:"tabs",tabs:this.tabs,onTabChanged:t=>this.selectedTab=t.detail}),((t=this.selectedTab)===null||t===void 0?void 0:t.id)==="stop-sale"?i("igl-bulk-stop-sale",{maxDatesLength:this.maxDatesLength,property_id:this.property_id}):i("igl-bulk-block",{maxDatesLength:this.maxDatesLength,property_id:this.property_id}))}};F.style=z+P;const U=".sc-igl-bulk-stop-sale-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-bulk-stop-sale{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-bulk-stop-sale{transition:all 0.5s ease}.days-checkbox.sc-igl-bulk-stop-sale{gap:0.5rem}";const V=U;const G=".sc-igl-bulk-stop-sale-h{height:100%}.sheet-container.sc-igl-bulk-stop-sale{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-stop-sale{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-stop-sale{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-stop-sale{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-stop-sale{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-stop-sale{flex-direction:row;align-items:center}}";const W=G;const K=class{constructor(i){t(this,i);this.closeModal=e(this,"closeModal",7);this.toast=e(this,"toast",7);this.maxDatesLength=8;this.selectedRoomTypes=[];this.dates=[{from:null,to:null}];this.selectedWeekdays=new Set(Array(7).fill(null).map(((t,e)=>e)));this.dateRefs=[];this.minDate=m().format("YYYY-MM-DD");this.bookingService=new n;this.datesSchema=w.array(w.object({from:w.any().refine((t=>m.isMoment(t)),{message:"Invalid 'from' date; expected a Moment object."}).transform((t=>t.format("YYYY-MM-DD"))),to:w.any().refine((t=>m.isMoment(t)),{message:"Invalid 'to' date; expected a Moment object."}).transform((t=>t.format("YYYY-MM-DD")))}))}getDayIndex(t){return m(t,"YYYY-MM-DD").day()}componentDidLoad(){this.reloadInterceptor=new N({autoActivate:false});this.sidebar=document.querySelector("ir-sidebar")}disconnectedCallback(){this.reloadInterceptor.deactivate()}async addBlockDates(){const t=t=>{const e=[];for(const i of t){let t=i.from;const s=m(i.to,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD");while(t!==s){const i=m(t,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD");if(!this.selectedWeekdays.has(this.getDayIndex(t))){t=i;continue}for(const i of this.selectedRoomTypes){e.push({room_type_id:i.id,night:t})}t=i}}return e};const e=t=>{const e=new Map(d.disabled_cells);const i=new Map(y.roomsInfo.map(((t,e)=>[t.id,{roomType:t,index:e}])));const s=new Map(d.days.map(((t,e)=>[t.value,e])));const o=new Map;for(const a of t){for(const t of a.restrictions){const{night:n,room_type_id:l}=t;const{roomType:r}=i.get(l);if(!r)continue;const c=s.get(n);if(c===undefined){console.warn(`Couldn't find date ${n}`);continue}const h=d.days[c];const g=`${l}_${n}`;let b=o.get(g);if(!b){b=h.rate.find((t=>t.id===l));if(!b){console.warn(`Couldn't find room type ${l}`);continue}o.set(g,b)}const f=b.exposed_inventory.rts===0;for(const t of r.physicalrooms){const i=`${t.id}_${n}`;e.set(i,{disabled:a.is_closed?true:f,reason:a.is_closed?"stop_sale":f?"inventory":"stop_sale"})}}}d["disabled_cells"]=new Map(e)};try{this.errors=null;this.isLoading=true;const i=this.datesSchema.parse(this.dates);if(this.selectedRoomTypes.length===0){this.unitSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="rooms";return}if(this.selectedWeekdays.size===0){this.weekdaysSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="weekdays";return}this.activate();const s=t(i);const o=this.selectedRoomTypes.every((t=>t.result==="open"));const a=this.selectedRoomTypes.every((t=>t.result==="closed"));if(a||o){const t={is_closed:a,restrictions:s,property_id:this.property_id};await this.bookingService.setExposedRestrictionPerRoomType(t);e([t])}else{const t=[];for(const e of this.selectedRoomTypes){const i=s.filter((t=>t.room_type_id===e.id));t.push({is_closed:e.result==="closed",restrictions:i,property_id:this.property_id})}await Promise.all(t.map((t=>this.bookingService.setExposedRestrictionPerRoomType(t))));e(t)}this.deactivate();this.toast.emit({type:"success",title:k.entries.Lcz_RequestSubmittedSuccessfully,description:""});this.isLoading=false;this.closeModal.emit()}catch(t){console.log(t);if(t instanceof D){this.datesSections.scrollIntoView({behavior:"smooth",block:"end"});this.errors="dates"}}finally{this.isLoading=false}}activate(){this.reloadInterceptor.activate();if(this.sidebar)this.sidebar.preventClose=true}deactivate(){this.reloadInterceptor.deactivate();if(this.sidebar)this.sidebar.preventClose=false}handleDateChange({index:t,date:e,key:i}){var s,o;const a=[...this.dates];a[t]=Object.assign(Object.assign({},a[t]),{[i]:e});if(i==="from"&&((s=a[t].to)===null||s===void 0?void 0:s.isBefore(e,"dates"))){a[t].to=null}for(let i=t+1;i<a.length;i++){const t=(o=a[i])===null||o===void 0?void 0:o.from;if(t&&t.isSameOrBefore(e,"day")){a[i]={from:null,to:null}}}this.dates=a;setTimeout((()=>{var e,s;if(i==="from"){(e=this.dateRefs[t])===null||e===void 0?void 0:e.to.openDatePicker()}else{const t=a.findIndex((t=>t.from===null));if(t>-1){(s=this.dateRefs[t])===null||s===void 0?void 0:s.from.openDatePicker()}}}),100)}addDateRow(){const t=this.dates[this.dates.length-1];if(!t.from||!t.to){this.errors="dates";return}this.errors=null;this.dates=[...this.dates,{from:null,to:null}];setTimeout((()=>{var t;(t=this.dateRefs[this.dates.length-1].to)===null||t===void 0?void 0:t.scrollIntoView({behavior:"smooth",block:"center"})}),100)}render(){return i("form",{key:"bddfc1a59a3513ef456afaeb73328edefa180e76",class:"bulk-sheet-container",onSubmit:t=>{t.preventDefault();this.addBlockDates()}},i("div",{key:"767763380b7c044efac4405242321e1a55c214f7",class:"sheet-body px-1"},i("div",{key:"f18002773cfe4739efabc2eb69f95baba5cd6cd4",class:"text-muted text-left py-0 my-0"},i("p",{key:"df00320c697c947b042120c41b5ceaa16f4389c6"},"Select the types to stop or open sales for all related rate plans")),i("div",{key:"45b5ba68f3cc5fe9d657dd3a0d203340d16f0a73"},this.errors==="rooms"&&i("p",{key:"12dc7c0957e9505cfdcaf0e9b80e23ca1db1b31e",class:"text-danger text-left smaller p-0 ",style:{"margin-bottom":"0.5rem"}},y.is_vacation_rental?k.entries.Lcz_PlzSelectOneListing:k.entries.Lcz_PlzSelectOneUnit),i("table",{key:"9ad2edc9cd7cbd59c4301738ecbbf367adc2949d",ref:t=>this.unitSections=t},i("thead",{key:"c41234f0f678ea7866caa9dd93de25dfb38b84c7"},i("tr",{key:"9f3e1031a32a650b217970d8625bebdc8768984e"},i("th",{key:"94cfb18516a4d09ac21f27877bfc27a981b1c827",class:"sr-only"},"choice"),i("th",{key:"9ab2093d3827ed745dcdf2214a49cbb80d148765",class:"sr-only"},"room type"))),i("tbody",{key:"11d0783c211243d979ab50faed4b4b63f02582dc"},y.roomsInfo.map(((t,e)=>{const s=e===y.roomsInfo.length-1?"":"pb-1";return i("tr",{key:t.id},i("td",{class:`choice-row ${s}`},i("div",{class:"d-flex justify-content-end"},i("ir-select",{LabelAvailable:false,firstOption:`${k.entries.Lcz_Select}...`,data:[{value:"open",text:k.entries.Lcz_Open},{value:"closed",text:k.entries.Lcz_StopSale}],onSelectChange:e=>{const i=e.detail;const s=this.selectedRoomTypes.filter((e=>e.id!==t.id));if(i){s.push({id:t.id,result:i})}this.selectedRoomTypes=s}}))),i("td",{class:`pl-1 text-left ${s}`},t.name))}))))),i("p",{key:"aeeb872af25e94a85e92b7e6ca0a369824b0d1e5",class:"text-left mt-2 text-muted"},"Included days"),this.errors==="weekdays"&&i("p",{key:"b2b27f05150c6feabb5ecfd17a715ab0c927b24a",class:"text-danger text-left smaller m-0 p-0"},"Please select at least one day"),i("ir-weekday-selector",{key:"cf7b882ed8194c06b394a21018a7afe7ed1286af",ref:t=>this.weekdaysSections=t,weekdays:Array.from(this.selectedWeekdays),onWeekdayChange:t=>{t.stopPropagation();t.stopImmediatePropagation();this.selectedWeekdays=new Set(t.detail)}}),i("table",{key:"18baad3ef670b5b637fade8f3a0c234322498cd1",class:"mt-1",ref:t=>this.datesSections=t},i("thead",{key:"98d43bda066db007b65e435d7d3659becc4bbc7c"},i("tr",{key:"40d2c821264e95f102714eb1257e36a8f7cff42b"},i("th",{key:"2683f2c7137dbce45e389fcfaee8375dc6af06b4",class:"text-left"},k.entries.Lcz_From),i("th",{key:"d475be77cf8697d2cf3e74a83c2c2c130685f0d2",class:"text-left"},k.entries.Lcz_ToExclusive),i("td",{key:"6136ab272d22602a114a5b450e5dc24028862691"},this.dates.length!==this.maxDatesLength&&i("ir-button",{key:"cad5025336388e5ded1663d8d2fdefd51dce8c21",variant:"icon",icon_name:"plus",onClickHandler:()=>{this.addDateRow()}})))),i("tbody",{key:"005f3c655393b35f41b6bd9dbdecd3d1f49c8cfd"},this.dates.map(((t,e)=>{var s,o,a,n,l,r,d;if(!this.dateRefs[e]){this.dateRefs[e]={}}const c=e>0?(a=(o=(s=this.dates[e-1])===null||s===void 0?void 0:s.to.clone().add(1,"days"))===null||o===void 0?void 0:o.format("YYYY-MM-DD"))!==null&&a!==void 0?a:this.minDate:this.minDate;const h=this.dates[e].from?(l=(n=this.dates[e])===null||n===void 0?void 0:n.from.clone().add(1,"days"))===null||l===void 0?void 0:l.format("YYYY-MM-DD"):this.minDate;return i("tr",{key:`date_${e}`},i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{ref:t=>{this.dateRefs[e].from=t},forceDestroyOnUpdate:true,minDate:c,"data-testid":"pickup_arrival_date",date:(r=t.from)===null||r===void 0?void 0:r.format("YYYY-MM-DD"),emitEmptyDate:true,"aria-invalid":String(this.errors==="dates"&&!t.from),onDateChanged:t=>{t.stopImmediatePropagation();t.stopPropagation();this.handleDateChange({index:e,date:t.detail.start,key:"from"})},onDatePickerFocus:t=>{var i,s,o;t.stopImmediatePropagation();t.stopPropagation();if(e===0){return}const a=this.dates.findIndex((t=>!t.from||!t.to));if(!((i=this.dates[a])===null||i===void 0?void 0:i.from)){(s=this.dateRefs[a])===null||s===void 0?void 0:s.from.openDatePicker();return}if(!((o=this.dates[a])===null||o===void 0?void 0:o.to)){this.dateRefs[a].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:t.from?t.from.format("MMM DD, YYYY"):null,class:`form-control input-sm ${this.errors==="dates"&&!t.to?"border-danger":""} text-center`,style:{width:"100%"}}))),i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{forceDestroyOnUpdate:true,ref:t=>{this.dateRefs[e].to=t},"data-testid":"pickup_arrival_date",date:(d=t.to)===null||d===void 0?void 0:d.format("YYYY-MM-DD"),emitEmptyDate:true,minDate:h,"aria-invalid":String(this.errors==="dates"&&!t.to),onDateChanged:t=>{t.stopImmediatePropagation();t.stopPropagation();this.handleDateChange({index:e,date:t.detail.start,key:"to"})},onDatePickerFocus:t=>{var e,i,s,o;t.stopImmediatePropagation();t.stopPropagation();const a=this.dates.findIndex((t=>!t.from||!t.to));if(!((e=this.dates[a])===null||e===void 0?void 0:e.from)){(s=(i=this.dateRefs[a])===null||i===void 0?void 0:i.from)===null||s===void 0?void 0:s.openDatePicker();return}if(!((o=this.dates[a])===null||o===void 0?void 0:o.to)){this.dateRefs[a].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:t.to?t.to.format("MMM DD, YYYY"):null,class:`form-control input-sm \n                          ${this.errors==="dates"&&!t.to?"border-danger":""}\n                          text-center`,style:{width:"100%"}}))),e>0&&i("td",{class:"pb-1"},i("ir-button",{variant:"icon",icon_name:"minus",onClickHandler:()=>{this.dates=this.dates.filter(((t,i)=>i!==e))}})))}))))),i("div",{key:"6883a121997a234cbf3c91e958adf58a80844417",class:"sheet-footer"},i("ir-button",{key:"9eca0933d4f9f26cb41bd73fe91f7d2e172a6642",text:k.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"412aec1d9e8da1ad9a7ff7f44cc492b6e2e5e435",isLoading:this.isLoading,text:k.entries.Lcz_Save,btn_type:"submit",class:"flex-fill"})))}};K.style=V+W;const X=".sc-igl-cal-body-h{display:block}.bodyContainer.sc-igl-cal-body{position:relative}.roomRow.sc-igl-cal-body{width:max-content}.roomRow.sc-igl-cal-body:first-child{margin-top:80px}.categoryName.sc-igl-cal-body{font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.cellData[data-dirty-room='true'].sc-igl-cal-body{background-color:rgba(153, 153, 153, 60%) !important}.cellData.disabled[data-dirty-room='true'].sc-igl-cal-body{border-bottom:2px solid rgb(80, 80, 80) !important}.cellData.disabled.sc-igl-cal-body{background:rgba(153, 153, 153, 15%);cursor:var(--cell-cursor, not-allowed);transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body{cursor:pointer;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body:hover{background:#e0e0e0}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body:hover[data-hk-enabled='false']{background:white;cursor:default}.cellData.sc-igl-cal-body{width:58px;height:30px;display:inline-grid;border-top:1px solid #e0e0e0;border-left:1px solid #e0e0e0;vertical-align:top}.triangle-button.sc-igl-cal-body{--size:10px;position:absolute;right:-6px;top:-1px;width:0;height:0;padding:0;border:none;background:transparent;cursor:pointer;width:0;height:0;border-left:var(--size) solid transparent;border-right:var(--size) solid transparent;border-bottom:var(--size) solid var(--in-toggle-color);transform:rotate(45deg)}.cellData.sc-igl-cal-body:nth-child(2){border-left:0px}.cellData.sc-igl-cal-body:last-child{border-right:1px solid rgba(186, 191, 199, 0.5)}.roomHeaderCell.sc-igl-cal-body{position:-webkit-sticky;position:sticky;left:0;background:#fff;border-right:1px solid #ccc;width:170px;z-index:1}.currentDay.sc-igl-cal-body{background-color:#e3f3fa}.dragOverHighlight.sc-igl-cal-body{background-color:#f5f5dc !important}.selectedDay.sc-igl-cal-body{background-color:#f9f9c9 !important}.categoryTitle.sc-igl-cal-body{grid-template-columns:1fr 20px;padding-left:10px;cursor:pointer;height:40px;font-size:0.9em}.categoryTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.sc-igl-cal-body{padding-left:20px;font-size:0.9em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.roomTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.pl10.sc-igl-cal-body{padding-left:10px}.categoryPriceColumn.sc-igl-cal-body{align-items:center;height:40px;-webkit-user-select:none;user-select:none;position:relative}.bookingEventsContainer.sc-igl-cal-body{position:absolute;top:0;left:0}";const q=X;const Z=class{constructor(i){t(this,i);this.addBookingDatasEvent=e(this,"addBookingDatasEvent",7);this.showBookingPopup=e(this,"showBookingPopup",7);this.scrollPageToRoom=e(this,"scrollPageToRoom",7);this.dragOverElement="";this.renderAgain=false;this.selectedRooms={};this.fromRoomId=-1;this.currentDate=new Date;this.housekeepingService=new x;this.bookingMap=new Map;this.interactiveTitle=[];this.dayRateMap=new Map}componentWillLoad(){this.currentDate.setHours(0,0,0,0);this.bookingMap=this.getBookingMap(this.getBookingData());d.days.forEach((t=>{this.dayRateMap.set(t.day,t.rate)}));this.updateDisabledCellsCache()}handleCalendarDataChange(){this.bookingMap=this.getBookingMap(this.getBookingData());this.updateDisabledCellsCache()}dragOverHighlightElementHandler(t){this.dragOverElement=t.detail.dragOverElement}gotoRoom(t){let e=t.detail.roomId;let i=this.getRoomCategoryByRoomId(e);if(!i.expanded){this.toggleCategory(i);setTimeout((()=>{this.scrollToRoom(e)}),10)}else{this.scrollToRoom(e)}}addToBeAssignedEvents(t){this.addBookingDatas(t.detail.data);this.renderElement()}closeWindow(){let t=this.getBookingData().findIndex((t=>t.ID==="NEW_TEMP_EVENT"));if(t!==-1){this.getBookingData().splice(t,1);console.log("removed item..");this.renderElement()}}scrollToRoom(t){this.scrollPageToRoom.emit({key:"scrollPageToRoom",id:t,refClass:"room_"+t})}getRoomCategoryByRoomId(t){return this.calendarData.roomsInfo.find((e=>this.getCategoryRooms(e).find((e=>this.getRoomId(e)===t))))}getCategoryName(t){return t.name}getCategoryId(t){return t.id}getTotalPhysicalRooms(t){return this.getCategoryRooms(t).length}getCategoryRooms(t){return t&&t.physicalrooms||[]}getRoomName(t){return t.name}getRoomId(t){return t.id}getRoomById(t,e){return t.find((t=>this.getRoomId(t)===e))}getBookingData(){return this.calendarData.bookingEvents}addBookingDatas(t){this.addBookingDatasEvent.emit(t)}getSelectedCellRefName(t,e){return"room_"+t+"_"+e.currentDate}getSplitBookingEvents(t){console.log(t.FROM_DATE);return this.getBookingData().some((e=>{if(!["003","002","004"].includes(e.STATUS_CODE)){if(new Date(t.FROM_DATE).getTime()>=new Date(e.FROM_DATE).getTime()&&new Date(t.FROM_DATE).getTime()<=new Date(e.TO_DATE).getTime()){return e}}}))}addNewEvent(t){let e=Object.keys(this.selectedRooms);let s,o;if(this.selectedRooms[e[0]].currentDate<this.selectedRooms[e[1]].currentDate){s=new Date(this.selectedRooms[e[0]].currentDate);o=new Date(this.selectedRooms[e[1]].currentDate)}else{s=new Date(this.selectedRooms[e[1]].currentDate);o=new Date(this.selectedRooms[e[0]].currentDate)}const a=Math.round(Math.abs((o.getTime()-s.getTime())/864e5));this.newEvent={ID:"NEW_TEMP_EVENT",NAME:i("span",null,"Â "),EMAIL:"",PHONE:"",convertBooking:false,REFERENCE_TYPE:"PHONE",FROM_DATE:s.getFullYear()+"-"+this.getTwoDigitNumStr(s.getMonth()+1)+"-"+this.getTwoDigitNumStr(s.getDate()),TO_DATE:o.getFullYear()+"-"+this.getTwoDigitNumStr(o.getMonth()+1)+"-"+this.getTwoDigitNumStr(o.getDate()),BALANCE:"",NOTES:"",RELEASE_AFTER_HOURS:0,PR_ID:this.selectedRooms[e[0]].roomId,ENTRY_DATE:"",NO_OF_DAYS:a,ADULTS_COUNT:1,COUNTRY:"",INTERNAL_NOTE:"",RATE:"",TOTAL_PRICE:"",RATE_PLAN:"",ARRIVAL_TIME:"",TITLE:k.entries.Lcz_NewBookingFor,roomsInfo:[t],CATEGORY:t.name,event_type:"BAR_BOOKING",STATUS:"TEMP-EVENT",defaultDateRange:{fromDate:null,fromDateStr:"",toDate:null,toDateStr:"",dateDifference:a,editable:false,message:"Including 5.00% City Tax - Excluding 11.00% VAT"}};let n=t.name+" "+this.getRoomName(this.getRoomById(this.getCategoryRooms(t),this.selectedRooms[e[0]].roomId));this.newEvent.BLOCK_DATES_TITLE=`${k.entries.Lcz_BlockDatesFor} ${n}`;this.newEvent.TITLE+=n;this.newEvent.defaultDateRange.toDate=new Date(this.newEvent.TO_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDate=new Date(this.newEvent.FROM_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDateStr=this.getDateStr(this.newEvent.defaultDateRange.fromDate);this.newEvent.defaultDateRange.toDateStr=this.getDateStr(this.newEvent.defaultDateRange.toDate);this.newEvent.ENTRY_DATE=(new Date).toISOString();this.newEvent.legendData=this.calendarData.formattedLegendData;let l=this.getSplitBookingEvents(this.newEvent);if(l){this.newEvent.splitBookingEvents=l}this.getBookingData().push(this.newEvent);return this.newEvent}getTwoDigitNumStr(t){return t<=9?"0"+t:t}getDateStr(t,e="default"){return t.getDate()+" "+t.toLocaleString(e,{month:"short"})+" "+t.getFullYear()}removeNewEvent(){this.calendarData.bookingEvents=this.calendarData.bookingEvents.filter((t=>t.ID!=="NEW_TEMP_EVENT"));this.newEvent=null}clickCell(t,e,i){if(!this.isScrollViewDragging&&e.currentDate>=this.currentDate.getTime()){let s=this.getSelectedCellRefName(t,e);if(this.selectedRooms.hasOwnProperty(s)){this.removeNewEvent();delete this.selectedRooms[s];this.renderElement();return}else if(Object.keys(this.selectedRooms).length!=1||this.fromRoomId!=t){this.removeNewEvent();this.selectedRooms={};this.selectedRooms[s]=Object.assign(Object.assign({},e),{roomId:t});this.fromRoomId=t;this.renderElement()}else{const o=Object.keys(this.selectedRooms);const a=m(this.selectedRooms[o[0]].value,"YYYY-MM-DD");const n=m(e.value,"YYYY-MM-DD");let l=a.clone().add(1,"days");let r=0;while(l.isBefore(n,"day")){const e=l.format("YYYY-MM-DD");if(this.isCellDisabled(t,e)){r++}l.add(1,"days")}if(r>=1){this.selectedRooms={};this.fromRoomId=t;this.renderElement();return}this.selectedRooms[s]=Object.assign(Object.assign({},e),{roomId:t});this.addNewEvent(i);this.selectedRooms={};this.renderElement();this.showNewBookingPopup(this.newEvent)}}}showNewBookingPopup(t){console.log(t)}renderElement(){this.renderAgain=!this.renderAgain}getBookingMap(t){var e,i;const s=new Map;const o=m().startOf("day");for(const a of t){const t=m(a.FROM_DATE,"YYYY-MM-DD").startOf("day");const n=m(a.TO_DATE,"YYYY-MM-DD").startOf("day");if(o.isSameOrAfter(t)&&o.isSameOrBefore(n)){if(!s.has(a.PR_ID)){s.set(a.PR_ID,a.BOOKING_NUMBER)}else{if(h(m().toDate(),g((e=y.checkin_checkout_hours)===null||e===void 0?void 0:e.offset,(i=y.checkin_checkout_hours)===null||i===void 0?void 0:i.hour))){s.set(a.PR_ID,a.BOOKING_NUMBER)}}}}return s}getGeneralCategoryDayColumns(t,e=false,o){return d.days.map((a=>i("div",{class:`cellData  font-weight-bold categoryPriceColumn ${t+"_"+a.day} ${a.day===this.today||a.day===this.highlightedDate?"currentDay":""}`},e?i(s,null,i("span",{class:"categoryName"},a.rate[o].exposed_inventory.rts)):"")))}getGeneralRoomDayColumns(t,e,s){return this.calendarData.days.map((o=>{const a=this.isCellDisabled(Number(t),o.value);const n=m(o.value,"YYYY-MM-DD").add(-1,"days").format("YYYY-MM-DD");const l=a&&Object.keys(this.selectedRooms).length===0||a&&this.isCellDisabled(Number(t),n);const r=this.selectedRooms.hasOwnProperty(this.getSelectedCellRefName(t,o));const d=o.day===this.today||o.day===this.highlightedDate;return i("div",{class:`cellData position-relative roomCell ${a?"disabled":""} ${"room_"+t+"_"+o.day} ${d?"currentDay":""} ${this.dragOverElement===t+"_"+o.day?"dragOverHighlight":""} ${r?"selectedDay":""}`,style:!l&&{"--cell-cursor":"default"},onClick:()=>{if(l){return}this.clickCell(Number(t),o,e)},"aria-label":s,role:"gridcell","data-room-id":t,"data-date":o.value,"aria-current":d?"date":undefined,"data-room-name":s,"aria-disabled":String(l),"aria-selected":Boolean(r)})}))}toggleCategory(t){t.expanded=!t.expanded;this.renderElement()}getRoomCategoryRow(t,e){if(this.getTotalPhysicalRooms(t)<=1||!t.is_active){return null}return i("div",{class:"roomRow"},i("div",{class:`cellData text-left align-items-center roomHeaderCell categoryTitle ${"category_"+this.getCategoryId(t)}`,onClick:()=>this.toggleCategory(t)},i("div",{class:"categoryName"},i("ir-interactive-title",{popoverTitle:this.getCategoryName(t)})),t.expanded?i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"})):i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"}))),this.getGeneralCategoryDayColumns("category_"+this.getCategoryId(t),true,e))}getRoomsByCategory(t){var e;if(!t.expanded){return null}return(e=this.getCategoryRooms(t))===null||e===void 0?void 0:e.map((e=>{if(!e.is_active){return null}const s=this.getTotalPhysicalRooms(t)<=1;const o=s?this.getCategoryName(t):this.getRoomName(e);return i("div",{class:"roomRow"},i("div",{class:`cellData room text-left align-items-center roomHeaderCell  roomTitle ${this.getTotalPhysicalRooms(t)<=1?"pl10":""} ${"room_"+this.getRoomId(e)}`,"data-room-name":o,"data-hk-enabled":String(y.housekeeping_enabled),"data-room":this.getRoomId(e),onClick:()=>{if(!y.housekeeping_enabled){return}this.selectedRoom=e;this.hkModal.openModal()},onMouseEnter:()=>{var t,i;(i=(t=this.interactiveTitle[e.id])===null||t===void 0?void 0:t.style)===null||i===void 0?void 0:i.setProperty("--ir-interactive-hk-bg","#e0e0e0")},onMouseLeave:()=>{var t,i;(i=(t=this.interactiveTitle[e.id])===null||t===void 0?void 0:t.style)===null||i===void 0?void 0:i.removeProperty("--ir-interactive-hk-bg")}},i("ir-interactive-title",{ref:t=>{if(t)this.interactiveTitle[e.id]=t},style:e.hk_status==="003"&&{"--dot-color":"#ededed"},hkStatus:y.housekeeping_enabled&&e.hk_status!=="001",broomTooltip:e.hk_status==="002"?"This unit is dirty":undefined,popoverTitle:o})),this.getGeneralRoomDayColumns(this.getRoomId(e),t,o))}))}getRoomRows(){var t;return(t=this.calendarData.roomsInfo)===null||t===void 0?void 0:t.map(((t,e)=>{if(t.is_active){return i(s,null,this.getRoomCategoryRow(t,e),t.expanded&&this.getRoomsByCategory(t))}else{return null}}))}async confirmHousekeepingUpdate(t){var e,i,s,o,a,n;t.stopImmediatePropagation();t.stopPropagation();try{this.isLoading=true;const t=((e=this.selectedRoom)===null||e===void 0?void 0:e.hk_status)==="002"?"001":"002";await this.housekeepingService.setExposedUnitHKStatus({property_id:this.propertyId,status:{code:t},unit:{id:(i=this.selectedRoom)===null||i===void 0?void 0:i.id}});if(t==="001"){await this.housekeepingService.executeHKAction({actions:[{description:"Cleaned",hkm_id:((s=this.selectedRoom)===null||s===void 0?void 0:s.housekeeper.id)||null,unit_id:(o=this.selectedRoom)===null||o===void 0?void 0:o.id,booking_nbr:(n=this.bookingMap.get((a=this.selectedRoom)===null||a===void 0?void 0:a.id))!==null&&n!==void 0?n:null}]})}}finally{this.isLoading=false;this.selectedRoom=null;this.hkModal.closeModal()}}render(){var t,e,s;return i(o,{key:"2693bb03e5be9add86d41cb72252ca1fcf6b5a5a"},i("div",{key:"30fca4feeee33c9a7454cc3474d6d9957ad8401c",class:"bodyContainer"},this.getRoomRows(),i("div",{key:"a21bd401c5de0d0249dbbf460fdc9b3e4a3b22ec",class:"bookingEventsContainer preventPageScroll"},(t=this.getBookingData())===null||t===void 0?void 0:t.map((t=>{var e,s,o;return i("igl-booking-event",{"data-testid":`booking_${t.BOOKING_NUMBER}`,"data-room-name":(o=(s=(e=t.roomsInfo)===null||e===void 0?void 0:e.find((e=>e.id===t.RATE_TYPE)))===null||s===void 0?void 0:s.physicalrooms.find((e=>e.id===t.PR_ID)))===null||o===void 0?void 0:o.name,language:this.language,is_vacation_rental:this.calendarData.is_vacation_rental,countries:this.countries,currency:this.currency,"data-component-id":t.ID,bookingEvent:t,allBookingEvents:this.getBookingData()})})))),i("ir-modal",{key:"dbe3870e318da0c0243b6c71ec09c761c55fd579",ref:t=>this.hkModal=t,leftBtnText:(e=k===null||k===void 0?void 0:k.entries)===null||e===void 0?void 0:e.Lcz_Cancel,rightBtnText:(s=k===null||k===void 0?void 0:k.entries)===null||s===void 0?void 0:s.Lcz_Update,modalBody:this.renderModalBody(),onConfirmModal:this.confirmHousekeepingUpdate.bind(this),autoClose:false,isLoading:this.isLoading,onCancelModal:t=>{t.stopImmediatePropagation();t.stopPropagation();this.selectedRoom=null;this.hkModal.closeModal()}}))}renderModalBody(){var t,e;if(!this.selectedRoom){return null}return i("p",null,"Update unit ",(t=this.selectedRoom)===null||t===void 0?void 0:t.name," to ",i("b",null,((e=this.selectedRoom)===null||e===void 0?void 0:e.hk_status)==="002"?"Clean":"Dirty","?"))}updateDisabledCellsCache(){var t;d.disabled_cells.clear();(t=this.calendarData.roomsInfo)===null||t===void 0?void 0:t.forEach(((t,e)=>{var i;if(t.is_active){(i=this.getCategoryRooms(t))===null||i===void 0?void 0:i.forEach((t=>{if(t.is_active){this.calendarData.days.forEach((i=>{const s=this.getCellKey(t.id,i.value);d.disabled_cells.set(s,{disabled:!i.rate[e].is_available_to_book,reason:"stop_sale"})}))}}))}}))}getCellKey(t,e){return`${t}_${e}`}isCellDisabled(t,e){const i=this.getCellKey(t,e);if(!d.disabled_cells.has(i)){return false}const{disabled:s}=d.disabled_cells.get(i);return s}static get watchers(){return{calendarData:["handleCalendarDataChange"]}}};Z.style=q;const J=".sc-igl-cal-footer-h{display:block;position:sticky;bottom:0;width:max-content;z-index:3}.footerCell.sc-igl-cal-footer{display:-moz-inline-grid;display:-ms-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;bottom:0;width:58px;height:40px;background:#fff;vertical-align:top;border-top:1px solid #e0e0e0}.bottomLeftCell.sc-igl-cal-footer{left:-1px;z-index:2;width:170px;text-align:left;padding-left:15px;color:#000000}.footerCell.sc-igl-cal-footer i.sc-igl-cal-footer{margin-right:5px}.legendBtn.sc-igl-cal-footer{color:#41bff3;cursor:pointer}.isOnline.sc-igl-cal-footer i.sc-igl-cal-footer{color:#2f9c3f;font-weight:bold}.isOffline.sc-igl-cal-footer i.sc-igl-cal-footer{font-weight:bold}.isOffline.sc-igl-cal-footer{color:#a40000}.dayTitle.sc-igl-cal-footer{font-size:0.8em;font-weight:600;display:grid;user-select:none}.currentDay.sc-igl-cal-footer .dayTitle.sc-igl-cal-footer{font-weight:bold}.currentDay.sc-igl-cal-footer{background-color:#e3f3fa}.dayCapacityPercent.sc-igl-cal-footer{font-size:0.75em}.badge-pill.sc-igl-cal-footer{padding-left:1em;padding-right:1em;font-size:0.7em;margin-bottom:2px}";const Q=J;const tt=class{constructor(i){t(this,i);this.optionEvent=e(this,"optionEvent",7)}handleOptionEvent(t,e=""){this.optionEvent.emit({key:t,data:e})}render(){return i(o,{key:"f34f33edecc7417ca79eb772ee3a9359167c7962",class:"footerContainer"},i("div",{key:"9c466094129caf11c8f112c7ac9df42ad2372ace",class:"footerCell bottomLeftCell align-items-center preventPageScroll"},i("div",{key:"127623d51ce6fac5a1ed1bf5eb0466b4b70ff86f",class:"legendBtn",onClick:()=>this.handleOptionEvent("showLegend")},i("i",{key:"9e0d00a1cf363bad0ed792d977716725599a6bd7",class:"la la-square"}),i("u",{key:"d76d97e55a41b4a8c478cfb8f33f4d4e036b63f5"},k.entries.Lcz_Legend),i("span",{key:"23552d70607fb27fe800ae2e3294c4142cbd1490"}," - v1.0128"))),this.calendarData.days.map((t=>i("div",{class:"footerCell align-items-center"},i("div",{class:`dayTitle full-height align-items-center ${t.day===this.today||this.highlightedDate===t.day?"currentDay":""}`},t.dayDisplayName)))))}};tt.style=Q;const et=".sc-igl-cal-header-h{display:block;position:absolute;top:0;height:100%}.svg-icon.sc-igl-cal-header{height:20px;width:20px}.darkGrey.sc-igl-cal-header{background:#ececec}.btn.sc-igl-cal-header{pointer-events:auto}.stickyCell.sc-igl-cal-header{display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;top:0px;height:82px;display:inline-block;vertical-align:top;z-index:2}.headersContainer.sc-igl-cal-header{background-color:#ffffff}.headerCell.sc-igl-cal-header{display:inline-grid;width:58px;height:58px;vertical-align:top;background-color:#ffffff;border-bottom:1px solid #e0e0e0}.monthsContainer.sc-igl-cal-header{height:20px;background-color:#ffffff;margin-bottom:0.2em}.monthCell.sc-igl-cal-header{display:inline-grid;height:20px;background-color:#ececec;border-right:1px solid #c7c7c7;vertical-align:top}.monthCell.sc-igl-cal-header:nth-child(odd){background-color:#dddddd}.monthTitle.sc-igl-cal-header{overflow:hidden;text-overflow:ellipsis;font-size:0.9em;text-transform:uppercase;font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.topLeftCell.sc-igl-cal-header{left:0px;z-index:3;width:170px;background-color:#ffffff;display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid}.datePickerHidden.sc-igl-cal-header{position:absolute;height:100%;width:100%;opacity:0;cursor:pointer;z-index:1}.date_btn.sc-igl-cal-header{cursor:pointer;display:flex;align-items:center;justify-content:center;position:relative}.date_btn.sc-igl-cal-header:hover{background:#f6f6f6;border-radius:0.3rem}.caledarBtns.sc-igl-cal-header{position:relative;cursor:pointer;padding:0.4rem}.caledarBtns.sc-igl-cal-header:hover{background-color:#f6f6f6}.dayTitle.sc-igl-cal-header{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.currentDay.sc-igl-cal-header .dayTitle.sc-igl-cal-header{font-weight:bold}.currentDay.sc-igl-cal-header{background-color:#e3f3fa}.dayCapacityPercent.sc-igl-cal-header{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.badge-pill.sc-igl-cal-header{padding:3px 1em;font-size:0.8em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.pointer.sc-igl-cal-header{cursor:pointer}.searchContiner.sc-igl-cal-header{padding-left:10px;padding-right:10px}.searchListContainer.sc-igl-cal-header{background:#fff;border:1px solid #ccc;border-bottom:none}.searchListItem.sc-igl-cal-header{background:white;border-bottom:1px solid #ccc;padding-left:8px}.badge-light.sc-igl-cal-header{background-color:#999999;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.min-width-full.sc-igl-cal-header{min-width:100%}";const it=et;const st=class{constructor(i){t(this,i);this.optionEvent=e(this,"optionEvent",7);this.gotoRoomEvent=e(this,"gotoRoomEvent",7);this.gotoToBeAssignedDate=e(this,"gotoToBeAssignedDate",7);this.renderAgain=false;this.unassignedRoomsNumber={};this.roomsList=[];this.toBeAssignedService=new Y}componentWillLoad(){try{this.initializeRoomsList();if(!this.calendarData.is_vacation_rental){_("unassigned_dates",(t=>{if(Object.keys(t).length>0){this.fetchAndAssignUnassignedRooms()}}))}}catch(t){console.error("Error in componentWillLoad:",t)}}handleCalendarDataChanged(){this.fetchAndAssignUnassignedRooms()}initializeRoomsList(){this.roomsList=[];this.calendarData.roomsInfo.forEach((t=>{this.roomsList=this.roomsList.concat(...t.physicalrooms)}))}async fetchAndAssignUnassignedRooms(){await this.assignRoomsToDate()}async assignRoomsToDate(){try{const{fromDate:t,toDate:e,data:i}=this.unassignedDates;let s=new Date(t);s.setHours(0,0,0,0);let o=s.getTime();while(o<=new Date(e).getTime()){const t=m(o).format("D_M_YYYY");if(i[o]){const e=await this.toBeAssignedService.getUnassignedRooms({from_date:this.calendarData.from_date,to_date:this.calendarData.to_date},this.propertyid,b(new Date(o)),this.calendarData.roomsInfo,this.calendarData.formattedLegendData);this.unassignedRoomsNumber[t]=e.length}else if(this.unassignedRoomsNumber[t]){const e=this.unassignedRoomsNumber[t]-1;this.unassignedRoomsNumber[t]=e<0?0:e}const e=m(o).add(1,"days").toDate();e.setHours(0,0,0,0);o=e.getTime();this.renderView()}}catch(t){console.error(t)}}handleReduceAvailableUnitEvent(t){t.stopImmediatePropagation();t.stopPropagation();const{fromDate:e,toDate:i}=t.detail;let s=new Date(e).getTime();while(s<new Date(i).getTime()){const t=m(s).format("D_M_YYYY");this.unassignedRoomsNumber[t]=this.unassignedRoomsNumber[t]-1;s=m(s).add(1,"days").toDate().getTime()}this.renderView()}showToBeAssigned(t){if(this.unassignedRoomsNumber[t.day]||0){this.handleOptionEvent("showAssigned");setTimeout((()=>{this.gotoToBeAssignedDate.emit({key:"gotoToBeAssignedDate",data:t.currentDate})}),100)}}handleOptionEvent(t,e=""){this.optionEvent.emit({key:t,data:e})}handleDateSelect(t){if(Object.keys(t.detail).length>0){this.handleOptionEvent("calendar",t.detail)}}handleClearSearch(){this.renderView()}handleFilterRooms(t){const e=t.target;let i=e.value.trim();i=i.toLowerCase();if(i===""){this.handleClearSearch()}this.renderView()}handleScrollToRoom(t){this.handleClearSearch();this.gotoRoomEvent.emit({key:"gotoRoom",roomId:t})}getStringDateFormat(t){return t.getFullYear()+"-"+(t.getMonth()<9?"0":"")+(t.getMonth()+1)+"-"+(t.getDate()<=9?"0":"")+t.getDate()}getNewBookingModel(){let t=new Date;t.setHours(0,0,0,0);let e=this.getStringDateFormat(t);t.setDate(t.getDate()+1);t.setHours(0,0,0,0);let i=this.getStringDateFormat(t);return{ID:"",NAME:"",EMAIL:"",PHONE:"",REFERENCE_TYPE:"PHONE",FROM_DATE:e,TO_DATE:i,roomsInfo:this.calendarData.roomsInfo,TITLE:k.entries.Lcz_NewBooking,event_type:"PLUS_BOOKING",legendData:this.calendarData.formattedLegendData,defaultDateRange:{fromDate:new Date(e),fromDateStr:"",toDate:new Date(i),toDateStr:"",dateDifference:0,editabled:true,message:""}}}renderView(){this.renderAgain=!this.renderAgain}render(){return i(o,{key:"3facce618e0e81c87f653f78bb636bcd2846703c"},i("div",{key:"1d5771f05042a433418b31c1bc3f96fae2c1079e",class:"stickyCell align-items-center topLeftCell preventPageScroll"},i("div",{key:"6d50a0c1f8735641b1810f800de0d282338a2bd6",class:"row justify-content-around no-gutters"},!this.calendarData.is_vacation_rental&&i("ir-button",{key:"2f05ab40dff467faf52e5166abd82c1f3f2d2582",variant:"icon",icon_name:"server",style:Object.assign(Object.assign({},E.secondary),{"--icon-size":"1.5rem"}),"data-toggle":"tooltip","data-placement":"bottom",title:k.entries.Lcz_UnassignedUnitsTooltip,onClickHandler:()=>this.handleOptionEvent("showAssigned"),btn_styles:"caledarBtns",visibleBackgroundOnHover:true}),i("ir-date-picker",{key:"927a4af5da3bb756e07d6cd52dee47de253fad4c",minDate:m().add(-2,"months").startOf("month").format("YYYY-MM-DD"),onDateChanged:t=>{console.log("evt",t);this.handleDateSelect(t)},class:"date_btn",title:k.entries.Lcz_Navigate,"data-toggle":"tooltip","data-placement":"bottom"},i("ir-button",{key:"804d0fcf599848889a32709a1560ab798de64288",slot:"trigger",btn_styles:"caledarBtns",variant:"icon",icon_name:"calendar",style:Object.assign(Object.assign({},E.secondary),{"--icon-size":"1.5rem"}),onClickHandler:()=>this.handleOptionEvent("calendar"),visibleBackgroundOnHover:true,ref:t=>this.dateRef=t})),i("ir-button",{key:"2262cab25df8deb9a8f95490aeb5e99f987bfd4e",variant:"icon",btn_styles:"caledarBtns",class:"pointer",icon_name:"clock",visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},E.secondary),{"--icon-size":"1.5rem"}),"data-toggle":"tooltip","data-placement":"bottom",title:k.entries.Lcz_Today,onClickHandler:()=>this.handleOptionEvent("gotoToday")}),i("ir-button",{key:"b7b6ba6ba4eb74ebb128d7f667a6ae0c1410d925",variant:"icon",btn_styles:"caledarBtns",icon_name:"plus","data-toggle":"tooltip","data-placement":"bottom","data-testid":"new_booking_btn",title:k.entries.Lcz_CreateNewBooking,visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},E.secondary),{"--icon-size":"1.5rem"}),onClickHandler:()=>this.handleOptionEvent("add",this.getNewBookingModel())}),i("ir-button",{key:"e0e41c980ffe2baafdd80c3b840ff196c83d8217",variant:"icon",btn_styles:"caledarBtns",icon_name:"calendar-xmark","data-toggle":"tooltip","data-placement":"bottom","data-testid":"new_bulk_btn",title:k.entries.Lcz_StopOpenSale,visibleBackgroundOnHover:true,style:Object.assign(Object.assign({},E.secondary),{"--icon-size":"1.5rem"}),onClickHandler:()=>this.handleOptionEvent("bulk",this.getNewBookingModel())})),i("div",{key:"8e6ae0d54b1b6d620d8caa98cf96811d249ed0b5",class:"row justify-content-around no-gutters searchContiner"},i("ir-m-combobox",{key:"385961b437d4ef87ce95cc6497abd4e18db5d4c5",placeholder:k.entries.Lcz_FindUnit,options:this.roomsList.map((t=>({label:t.name,value:t.id}))),onOptionChange:t=>{this.handleScrollToRoom(t.detail.value)}}))),i("div",{key:"39178a3641bd84a805a8951e09b60ab5ee36a34b",class:"stickyCell headersContainer"},i("div",{key:"c97142a28c20b8dc8b8a1024010e96dc6a276f71",class:"monthsContainer"},this.calendarData.monthsInfo.map((t=>i("div",{class:"monthCell",style:{width:t.daysCount*58+"px"}},i("div",{class:"monthTitle"},t.monthName))))),this.calendarData.days.map((t=>i("div",{class:`headerCell align-items-center ${"day-"+t.day} ${t.day===this.today||t.day===this.highlightedDate?"currentDay":""}`,"data-day":t.day},!this.calendarData.is_vacation_rental&&i("div",{class:"preventPageScroll"},i("span",{class:`badge badge-${this.unassignedRoomsNumber[t.day]||t.unassigned_units_nbr!==0?"info pointer":"light"} badge-pill`,onClick:()=>this.showToBeAssigned(t)},this.unassignedRoomsNumber[t.day]||t.unassigned_units_nbr)),i("div",{class:"dayTitle"},t.dayDisplayName),i("div",{class:"dayCapacityPercent"},t.occupancy,"%"))))))}static get watchers(){return{unassignedDates:["handleCalendarDataChanged"]}}};st.style=it;const ot=".sc-igl-legends-h{display:block}.legendHeader.sc-igl-legends{font-weight:500;letter-spacing:0.05rem;font-size:1.12rem;padding-top:5px;margin-bottom:1rem}.legendCloseBtn.sc-igl-legends{position:absolute;top:50%;right:0;cursor:pointer;font-size:1.75em;line-height:1em;padding:0.4rem;display:flex;align-items:center;justify-content:center;border-radius:3px;transform:translateY(-50%)}.legendCloseBtn.sc-igl-legends:hover{background-color:#f6f6f6}.stickyHeader.sc-igl-legends{position:-webkit-sticky;position:sticky;top:0;background-color:#ffffff;z-index:1}.legendRow.sc-igl-legends{position:relative;vertical-align:middle;margin-bottom:0.3rem}.legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle}.legend_skew.sc-igl-legends,.legend_skew-bordered.sc-igl-legends,.legend_skewsplit.sc-igl-legends{transform:skew(-30deg);width:15px;height:16px}.legend_skew-bordered.sc-igl-legends{border:1px solid black}.legend_circle.sc-igl-legends{border-radius:100%;width:10px;height:10px;margin:3px 3px 3px 2px}.legend_skewsplit.sc-igl-legends{border-right:2px solid #000000}.headerCell.sc-igl-legends .blueColor.sc-igl-legends{background-color:#31bef1}.greenColor.sc-igl-legends{background-color:#45b16d}.yellowColor.sc-igl-legends{background-color:#f4d552}.greyColor.sc-igl-legends{background-color:#a0a0a0}.redColor.sc-igl-legends{background-color:#f34752}.pinkColor.sc-igl-legends{background-color:#f9b4b7}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends{margin-bottom:0}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends:first-child .legendCal.sc-igl-legends{background-color:#ececec}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.total-availability.sc-igl-legends{font-size:1em !important}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends{width:80px;height:25px;text-align:center;display:inline-grid !important;align-content:center;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends .badge.sc-igl-legends{margin-top:0.2rem;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.legendCal-h2.sc-igl-legends{height:40px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.br-t.sc-igl-legends{border-top:1px solid #a0a0a0}.br-s.sc-igl-legends{border-left:1px solid #a0a0a0;border-right:1px solid #a0a0a0}.br-bt.sc-igl-legends{border-bottom:1px solid #a0a0a0}.highphenLegend.sc-igl-legends{font-size:0.9em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.highphenLegend.sc-igl-legends::before{width:12px;height:0.5px;content:' ';background-color:#000000;vertical-align:middle;display:inline-block;margin-left:5px;margin-right:5px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.badge-pill.sc-igl-legends{padding:3px 1em;font-size:0.8em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.headerCell.sc-igl-legends{width:70px;display:flex;align-items:center;justify-content:center}.dayTitle.sc-igl-legends{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.dayCapacityPercent.sc-igl-legends{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legend_rectangle.sc-igl-legends{height:12px;width:20px;margin-right:1rem}";const at=ot;const nt=class{constructor(i){t(this,i);this.optionEvent=e(this,"optionEvent",7)}handleOptionEvent(t,e=""){this.optionEvent.emit({key:t,data:e})}render(){return i(o,{key:"f87ac5a5846a2937b740e7161545f6df2aa4ba82",class:"legendContainer pr-1 text-left"},i("div",{key:"80a10120a60a81979866fca59946d03c4151975f",class:"w-full"},i("div",{key:"f285217b7ca45cdd1d30c433e5582099a4281999",class:"w-full"},i("div",{key:"5105c2d091e919c090da6f2cfe9e873f50b68971",class:"stickyHeader pt-1 "},i("p",{key:"25dc9dd523b68ee62b5971fb6b7e94e96cf67aaa",class:"legendHeader"},k.entries.Lcz_Legend),i("div",{key:"8638690eaa4dd6cba210766a2c8029cb46987991",class:"legendCloseBtn",onClick:()=>this.handleOptionEvent("closeSideMenu")},i("svg",{key:"b854d96eddfd334d5ccaa051000ea90d0a3a287c",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},i("path",{key:"506a45064bd7c7ac24b16ad365dde461e69b4a33",fill:"#6b6f82",d:"M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160zm352-160l-160 160c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L301.3 256 438.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0z"}))),i("hr",{key:"a0b1627779aa98080777b817a3930d750904afc9"})),i("div",{key:"3e03d969d788293f3cc599fa4e4a6e171c791ec0",class:"mt-2 pl-1"},i("table",{key:"22877924bcfe117ac0767be1a00e679b215d1bd3"},this.legendData.map((t=>{console.log(t);return i("tr",{key:`legend_${t.id}`,class:"legendRow "},i("td",null,i("div",{class:`legend_${t.design}`,style:{backgroundColor:t.color}})),i("td",null,i("span",{class:"font-small-3"},t.name)))})))),i("hr",{key:"12f73da038ae46c6d1efa2d4c15225f69a0a0b86"}),i("div",{key:"b99bbb42239818531096bbadb6a74938f5186c75",class:"mt-2"},i("div",{key:"ddc3ddac7428d18933fb90d1f267287a5d561353",class:"legendCalendar"},i("div",{key:"9900a0978716d4701842b8fbcf879ebc84779104",class:"legendRow align-items-center"},i("div",{key:"13c66d533a72421d68168280b84ef288e57ec7fd",class:"legendCal br-t br-s br-bt"},i("strong",{key:"7359fac430b6a3daa9b5bee08ff8ae84d182cf91"},"MAR 2022")),i("div",{key:"f0e1f902d209cb736659e6be2a4fb567942bf109",class:"highphenLegend"},k.entries.Lcz_MonthAndYear)),i("div",{key:"ed378c95978f6f209fb929a7a556d2e7a29208b6",class:"legendRow"},i("div",{key:"eb33ef53270da68ae11500351aef05a3465c211a",class:"legendCal headerCell align-items-center br-s"},i("span",{key:"a20f9635da1182dbbcefe934f4919c5af72a8df0",class:"badge badge-info  badge-pill"},"3")),i("div",{key:"a754c981ab7383398a8315021f198f62afcbe669",class:"highphenLegend"},i("div",{key:"04882cde450a7108086da8eea9e550c5be034c67"},k.entries.Lcz_UnassignedUnits))),i("div",{key:"b7278c2bd7c60556fc7c89e9fdf4c85c4c9eeff3",class:"legendRow"},i("div",{key:"2c5f5b3c5a39fd77567da0f8d22c5abe7744f87a",class:"legendCal dayTitle br-s"},"Fri 18"),i("div",{key:"6ae127678fb575ecc06a654c7f7750283f2749af",class:"highphenLegend"},k.entries.Lcz_Date)),i("div",{key:"e1422da9d866cd1df53040528ec35949adb96a9f",class:"legendRow"},i("div",{key:"3e305db164cb187bb056dad8cf13f437fde0b7cf",class:"legendCal br-s br-bt dayCapacityPercent"},"15%"),i("div",{key:"457fd0c89f6a73d5b01a2ce660e560f308cead63",class:"highphenLegend"},k.entries.Lcz_Occupancy)),i("div",{key:"94a2814d61c64558b1851ed15ac53fa12d8f62c5",class:"legendRow"},i("div",{key:"7a6e598ce9a55641be88fa68f3893bbdc9545b13",class:"legendCal br-s br-bt  font-weight-bold total-availability"},"20"),i("div",{key:"8f7b7e2f649aedd1f2c8f56d8b43841a4c48da1e",class:"highphenLegend"},k.entries.Lcz_TotalAvailability)))))))}};nt.style=at;const lt=".sc-igl-tba-category-view-h{display:block}";const rt=lt;const dt=class{constructor(i){t(this,i);this.assignUnitEvent=e(this,"assignUnitEvent",7);this.categoriesData={};this.renderAgain=false}handleAssignRoomEvent(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.eventDatas=this.eventDatas.filter((t=>t.ID!=e.data.ID));this.calendarData.bookingEvents.push(e.data);this.assignUnitEvent.emit({key:"assignUnit",data:{RT_ID:this.categoryId,selectedDate:this.selectedDate,assignEvent:e.data,calendarData:this.calendarData}});this.renderView()}getEventView(t,e){return e.map(((e,s)=>i("igl-tba-booking-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,eventData:e,categoriesData:this.categoriesData,categoryId:t,categoryIndex:this.categoryIndex,eventIndex:s,onAssignRoomEvent:t=>this.handleAssignRoomEvent(t)})))}renderView(){this.renderAgain=!this.renderAgain}render(){var t;return i(o,{key:"e768ee38924b1aaf636d515cf168e2c9777f49d1"},i("div",{key:"4a94a5a50f1af5065575c744d9b033650ed35bfa",class:"sectionContainer"},i("div",{key:"b6adcfca780a155e3ba81b1eeb32e45973817955",class:"font-weight-bold mt-1 font-small-3"},(t=this.categoriesData[this.categoryId])===null||t===void 0?void 0:t.name),this.getEventView(this.categoryId,this.eventDatas)))}};dt.style=rt;const ct=".sc-igl-to-be-assigned-h{display:block}.custom-dropdown.sc-igl-to-be-assigned{cursor:pointer;padding:5px 10px;width:min-content;margin-left:auto;margin-right:auto}.dropdown-toggle.sc-igl-to-be-assigned{all:unset;display:flex;width:max-content;align-items:center;gap:10px}.close_btn_style.sc-igl-to-be-assigned{padding:0.4rem}.close_btn_style.sc-igl-to-be-assigned:hover{background-color:#f6f6f6}.dropdown-menu.sc-igl-to-be-assigned{max-height:250px;overflow-y:auto}.tobeAssignedHeader.sc-igl-to-be-assigned{font-weight:500;letter-spacing:0.05rem;font-size:1.12rem;padding:0;margin:0}.assignment_header.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:space-between;padding-top:5px;margin-bottom:1rem}.dropdown-toggle.sc-igl-to-be-assigned::after{content:none;display:none}.dropdown-toggle.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transition:transform 0.2s ease}.show.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transform:rotate(-180deg)}.stickyHeader.sc-igl-to-be-assigned{position:-webkit-sticky;position:sticky;top:0;background-color:#ffffff;z-index:1}.pointer.sc-igl-to-be-assigned{cursor:pointer}.dots.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:center;margin:0 3px;padding:0}.dot.sc-igl-to-be-assigned{width:5px;height:5px;margin:5px 4px 0;background-color:#6b6f82;border-radius:50%;animation:dotFlashing 1s infinite linear alternate}.dot.sc-igl-to-be-assigned:nth-child(2){animation-delay:0.2s}.dot.sc-igl-to-be-assigned:nth-child(3){animation-delay:0.4s}@keyframes dotFlashing{0%{opacity:0}50%,100%{opacity:1}}";const ht=ct;const gt=class{constructor(i){t(this,i);this.optionEvent=e(this,"optionEvent",7);this.reduceAvailableUnitEvent=e(this,"reduceAvailableUnitEvent",7);this.showBookingPopup=e(this,"showBookingPopup",7);this.addToBeAssignedEvent=e(this,"addToBeAssignedEvent",7);this.highlightToBeAssignedBookingEvent=e(this,"highlightToBeAssignedBookingEvent",7);this.showDatesList=false;this.renderAgain=false;this.orderedDatesList=[];this.noScroll=false;this.isGotoToBeAssignedDate=false;this.isLoading=true;this.selectedDate=null;this.data={};this.today=new Date;this.categoriesData={};this.toBeAssignedService=new Y}componentWillLoad(){this.reArrangeData();this.loadingMessage=k.entries.Lcz_FetchingUnAssignedUnits}handleUnassignedDatesToBeAssignedChange(t){const{fromDate:e,toDate:i,data:s}=t;let o=new Date(e);o.setHours(0);o.setMinutes(0);o.setSeconds(0);let a=o.getTime();while(a<=new Date(i).getTime()){if(s&&!s[a]&&this.unassignedDates.hasOwnProperty(a)){delete this.unassignedDates[a]}else if(s&&s[a]){this.unassignedDates[a]=s[a]}a=m(a).add(1,"days").toDate().getTime()}this.data=Object.assign({},this.unassignedDates);this.orderedDatesList=Object.keys(this.data).sort(((t,e)=>parseInt(t)-parseInt(e)));if(this.orderedDatesList.length){if(!this.data.hasOwnProperty(this.selectedDate)){this.selectedDate=this.orderedDatesList.length?this.orderedDatesList[0]:null}this.showForDate(this.selectedDate,false);this.renderView()}else{this.selectedDate=null}}handleAssignUnit(t){var e,i,s,o,a;const n=t.detail;const l=n.data;t.stopImmediatePropagation();t.stopPropagation();if((n===null||n===void 0?void 0:n.key)==="assignUnit"&&this.data){if((l===null||l===void 0?void 0:l.selectedDate)&&this.data[l.selectedDate]){if(((e=this.data[l.selectedDate])===null||e===void 0?void 0:e.categories)&&((s=Object.keys(((i=this.data[l.selectedDate])===null||i===void 0?void 0:i.categories)||{}))===null||s===void 0?void 0:s.length)===1){this.isLoading=true;this.noScroll=true}if((l===null||l===void 0?void 0:l.RT_ID)&&((o=this.data[l.selectedDate])===null||o===void 0?void 0:o.categories)&&this.data[l.selectedDate].categories[l.RT_ID]&&Array.isArray(this.data[l.selectedDate].categories[l.RT_ID])&&((a=l===null||l===void 0?void 0:l.assignEvent)===null||a===void 0?void 0:a.ID)){this.data[l.selectedDate].categories[l.RT_ID]=this.data[l.selectedDate].categories[l.RT_ID].filter((t=>t&&t.ID!==l.assignEvent.ID))}if(l===null||l===void 0?void 0:l.calendarData){this.calendarData=l.calendarData}this.renderView()}}}async updateCategories(t,e){try{let i={};const s=await this.toBeAssignedService.getUnassignedRooms({from_date:e.from_date,to_date:e.to_date},this.propertyid,b(new Date(+t)),e.roomsInfo,e.formattedLegendData);s.forEach((t=>{if(!i.hasOwnProperty(t.RT_ID)){i[t.RT_ID]=[t]}else{i[t.RT_ID].push(t)}}));this.unassignedDates[t].categories=i}catch(t){}}async reArrangeData(){try{this.today.setHours(0,0,0,0);this.calendarData.roomsInfo.forEach((t=>{this.categoriesData[t.id]={name:t.name,roomsList:t.physicalrooms,roomIds:t.physicalrooms.map((t=>t.id))}}));this.selectedDate=null;this.unassignedDates=M();console.log(this.unassignedDates);this.data=this.unassignedDates;this.orderedDatesList=Object.keys(this.data).sort(((t,e)=>parseInt(t)-parseInt(e)));if(!this.selectedDate&&this.orderedDatesList.length){this.selectedDate=this.orderedDatesList[0]}}catch(t){console.error("Error fetching unassigned dates:",t)}}async componentDidLoad(){setTimeout((()=>{if(!this.isGotoToBeAssignedDate&&Object.keys(this.unassignedDates).length>0){const t=Object.keys(this.unassignedDates)[0];this.showForDate(t)}}),100)}async gotoDate(t){this.isGotoToBeAssignedDate=true;this.showForDate(t.detail.data);this.showDatesList=false;this.renderView()}handleToBeAssignedDate(t){this.showBookingPopup.emit({key:"calendar",data:new Date(t.detail.data.fromDate).getTime()-864e5,noScroll:false})}async showForDate(t,e=true){try{if(e){this.isLoading=true}if(this.showDatesList){this.showUnassignedDate()}await this.updateCategories(t,this.calendarData);this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.showBookingPopup.emit({key:"calendar",data:parseInt(t)-864e5,noScroll:this.noScroll});if(this.isGotoToBeAssignedDate){this.isGotoToBeAssignedDate=false}this.isLoading=false;this.selectedDate=t;this.renderView()}catch(t){}}getDay(t){const e=new Date(t);const i="default";const s=this.getLocalizedDayOfWeek(e,i);return s+" "+e.getDate()+", "+e.getFullYear()}getLocalizedDayOfWeek(t,e){const i={weekday:"short"};return t.toLocaleDateString(e,i)}handleOptionEvent(t,e=""){this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:"----"}});this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.optionEvent.emit({key:t,data:e})}showUnassignedDate(){this.showDatesList=!this.showDatesList}getToBeAssignedEntities(){}getCategoryView(){if(this.orderedDatesList.length&&this.selectedDate&&this.data[this.selectedDate]){return Object.entries(this.data[this.selectedDate].categories).map((([t,e],s)=>i("igl-tba-category-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,categoryId:t,categoryIndex:s,categoriesData:this.categoriesData,eventDatas:e,onAssignUnitEvent:t=>this.handleAssignUnit(t)})))}else{return null}}renderView(){this.renderAgain=!this.renderAgain}render(){var t;return i(o,{key:"e3016a316e112caea15d8a46d0e82f3538aa4da9",class:"tobeAssignedContainer pr-1 text-left"},i("div",{key:"6baff623360acd2bcf99ff2399ac93b63aa65545"},i("div",{key:"2ac1acd0c00c0f7c6861697fb9c75d6833579251"},i("div",{key:"aaebd2ea02753574b314b978d63636267c61de28",class:"stickyHeader pt-1"},i("div",{key:"7c2e1a005e4ca76d29d76655067259058e3d3b23",class:"assignment_header"},i("p",{key:"4835644893f72e2cdf96fe25dbfff7b3fadacda6",class:"tobeAssignedHeader "},k.entries.Lcz_Assignments),i("ir-button",{key:"2060657da384787f2412d74fc3c5c78c2cadb369",class:"close_btn",variant:"icon",btn_styles:"close_btn_style",icon_name:"double_caret_left",style:E.secondary,onClickHandler:()=>this.handleOptionEvent("closeSideMenu"),visibleBackgroundOnHover:true})),i("hr",{key:"9631a7f3fce2b3c959286387a3dc7bb48289c92d"}),Object.keys(this.data).length===0?i("p",null,k.entries.Lcz_AllBookingsAreAssigned):this.isLoading?i("p",{class:"d-flex align-items-center"},i("span",{class:"p-0"},this.loadingMessage),i("div",{class:"dots"},i("div",{class:"dot"}),i("div",{class:"dot"}),i("div",{class:"dot"}))):i(s,null,this.orderedDatesList.length?i("div",{class:`custom-dropdown border border-light rounded text-center `+(this.showDatesList?"show":""),id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i("div",{class:"dropdown-toggle"},i("span",{class:"font-weight-bold"},this.data[this.selectedDate].dateStr),i("svg",{class:"caret-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"}))),i("div",{class:"dropdown-menu dropdown-menu-right full-width","aria-labelledby":"dropdownMenuButton"},(t=this.orderedDatesList)===null||t===void 0?void 0:t.map((t=>i("div",{class:"dropdown-item pointer",onClick:()=>this.showForDate(t)},this.data[t].dateStr))))):k.entries.Lcz_AllBookingsAreAssigned)),!this.isLoading&&i("div",{key:"fa4d209610a83efa59a7823c8d78a0e9da946c11",class:"scrollabledArea"},this.orderedDatesList.length?Object.keys(this.data[this.selectedDate].categories).length?this.getCategoryView():i("div",{class:"mt-1"},k.entries.Lcz_AllAssignForThisDay):null))))}static get watchers(){return{unassignedDatesProp:["handleUnassignedDatesToBeAssignedChange"]}}};gt.style=ht;const bt=".sc-ir-interactive-title-h{display:block;width:100%;--hk-green:green}*.sc-ir-interactive-title{box-sizing:border-box}.popover-title.sc-ir-interactive-title{position:relative;width:100%;height:100%;margin:0;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;z-index:10;left:0;display:flex;align-items:center}.popover-container.sc-ir-interactive-title{position:absolute;bottom:0px;left:var(--ir-popover-left, 10px);background:rgb(0, 0, 0);color:white;min-width:100%;box-shadow:rgba(0, 0, 0, 0.2) 0px 2px 10px;z-index:9999;padding:3.5px 7px;border-radius:5px;pointer-events:none;opacity:0;transition:all 100ms ease;font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-style:normal;font-weight:400;line-height:1.45;text-decoration:none;text-shadow:none;font-size:0.875rem}.popover-container[data-state='show'].sc-ir-interactive-title{opacity:1}.hk-dot.sc-ir-interactive-title{inset:0;position:absolute;display:flex;align-items:center;justify-content:center;width:fit-content;padding:4px;left:auto;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;padding-inline:var(--ir-popover-left);background:var(--ir-interactive-hk-bg, white);color:var(--dot-color, black)}";const ft=bt;const ut=class{constructor(e){t(this,e);this.popoverTitle="";this.irPopoverLeft="10px";this.hkStatus=false;this.cropSize=20;this.lastRenderedTitle=""}initializePopoverIfNeeded(t,e){if(this.lastRenderedTitle===e&&this.popoverInstance){return}this.disposePopover();const i=document.createElement("span");i.style.visibility="hidden";i.style.position="absolute";i.style.whiteSpace="nowrap";i.textContent=e;document.body.appendChild(i);const s=i.offsetWidth;document.body.removeChild(i);const o=t.clientWidth;const a=this.hkStatus?20:0;const n=s+a>o;if(n&&typeof $!=="undefined"){try{this.popoverInstance=$(t).popover({trigger:"hover",content:e,placement:"top",html:false,sanitize:true,delay:{show:300,hide:100}})}catch(t){console.error("Failed to initialize popover:",t)}}this.lastRenderedTitle=e}disposePopover(){if(this.popoverInstance&&typeof $!=="undefined"){try{$(this.titleContainerRef).popover("dispose");this.popoverInstance=null}catch(t){console.error("Failed to dispose popover:",t)}}}disconnectedCallback(){this.disposePopover()}render(){const t=this.popoverTitle||"";const e=t.length>this.cropSize;const s=e?t.slice(0,this.cropSize)+"...":t;return i(o,{key:"c743319030db1918260de4468b0b4acac78d8485",style:{"--ir-popover-left":this.irPopoverLeft}},i("p",{key:"ed44aad386cb30c3eb338bee3eefb4ab9f3f535c",ref:e=>{this.titleContainerRef=e;if(e&&t){setTimeout((()=>this.initializePopoverIfNeeded(e,t)),0)}},class:"popover-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center",gap:"4px"}},i("span",{key:"2a5c5bedcf395ea41fcffaca270fbdfa8cd96829",class:"cropped-title",style:{flexShrink:"1",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis"}},s),this.hkStatus&&i("div",{key:"ccec953a611fdecd4039daf658291018119c1858",title:this.broomTooltip,class:"hk-dot",style:{flexShrink:"0"}},i("svg",{key:"dec96d24bd2717d30fd28002ceeacbb4cc511a01",xmlns:"http://www.w3.org/2000/svg",height:"12",width:"13.5",viewBox:"0 0 576 512",style:{display:"block"}},i("path",{key:"100835373b0b5f7a0f97ed1a1a5b8b737de374b6",fill:"currentColor",d:"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z"})))))}get el(){return a(this)}};ut.style=ft;const pt=".sc-ir-room-nights-h{display:block;box-sizing:border-box;margin:0;position:relative}.loading-container.sc-ir-room-nights{position:relative;height:100%;width:100%;display:flex;align-items:center;justify-content:center}.close-icon.sc-ir-room-nights{position:absolute;top:18px;right:33px;outline:none}.close.sc-ir-room-nights{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.card.sc-ir-room-nights{top:0;z-index:1000}.card-title.sc-ir-room-nights{border-bottom:1px solid #e4e5ec;width:100%}.irfontgreen.sc-ir-room-nights{color:#0e930e}.currency.sc-ir-room-nights{display:block;position:absolute;margin:0;padding:0;height:auto;left:10px}.rate-input.sc-ir-room-nights{font-size:14px;line-height:0;padding:0;height:0;border-left:0;border-radius:0.25rem !important}.rate-input-container.sc-ir-room-nights{display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;flex:1}.new-currency.sc-ir-room-nights{color:#3b4781;border:1px solid #cacfe7;font-size:0.975rem;height:2rem;background:rgb(255, 255, 255);padding-right:0 !important;border-right:0;border-top-right-radius:0;border-bottom-right-radius:0;transition:border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.input-group-prepend.sc-ir-room-nights span[data-state='focus'].sc-ir-room-nights{border-color:var(--blue)}.input-group-prepend.sc-ir-room-nights span[data-disabled].sc-ir-room-nights{background-color:#eceff1;border-color:rgba(118, 118, 118, 0.3)}.rateInputBorder.sc-ir-room-nights{padding-left:5px !important;padding-right:5px !important;border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}";const mt=pt;const vt=".sc-ir-room-nights-h{height:100%}.sheet-container.sc-ir-room-nights{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-room-nights{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-room-nights{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-room-nights{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-room-nights{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-room-nights{flex-direction:row;align-items:center}}";const kt=vt;const yt=class{constructor(i){t(this,i);this.closeRoomNightsDialog=e(this,"closeRoomNightsDialog",7);this.rates=[];this.isLoading=false;this.initialLoading=false;this.inventory=null;this.isEndDateBeforeFromDate=false;this.defaultTotalNights=0;this.isInputFocused=-1;this.dates={from_date:new Date,to_date:new Date};this.bookingService=new n}componentWillLoad(){this.dates={from_date:new Date(this.fromDate),to_date:new Date(this.toDate)};this.init()}isButtonDisabled(){return this.isLoading||this.rates.some((t=>t.amount===-1))||this.inventory===0||this.inventory===null}async init(){var t;try{const{from_date:e}=this.defaultDates;if(m(e,"YYYY-MM-DD").isBefore(m(this.fromDate,"YYYY-MM-DD"))){this.dates.from_date=new Date(e)}else{this.dates.from_date=new Date(this.fromDate)}this.dates.to_date=new Date(this.toDate);this.bookingEvent=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);if(this.bookingEvent){const e=this.bookingEvent.rooms.filter((t=>t.identifier===this.identifier));this.selectedRoom=e[0];const i=(t=this.selectedRoom)===null||t===void 0?void 0:t.days[this.selectedRoom.days.length-1];if(m(this.toDate).add(-1,"days").isSame(m(i.date))){console.log("here1");const t=await this.fetchBookingAvailability(this.fromDate,this.selectedRoom.days[0].date,this.selectedRoom.rateplan.id);const e=f(this.selectedRoom.days[0].date,this.fromDate);this.isEndDateBeforeFromDate=true;this.rates=[...e.map((i=>({amount:t/e.length,date:i,cost:null}))),...this.selectedRoom.days];this.defaultTotalNights=this.rates.length-this.selectedRoom.days.length}else{console.log("here2");console.log(i);const t=await this.fetchBookingAvailability(this.bookingEvent.to_date,m(this.toDate,"YYYY-MM-DD").format("YYYY-MM-DD"),this.selectedRoom.rateplan.id);const e=f(i.date,this.toDate);this.rates=[...this.selectedRoom.days,...e.map((i=>({amount:t/e.length,date:i,cost:null})))]}}}catch(t){console.log(t)}}handleInput(t,e){let i=t;let s=[...this.rates];i=i.replace(/[^0-9.]/g,"");if(i===""){s[e].amount=-1}else{if(!isNaN(Number(i))){s[e].amount=Number(i)}}this.rates=s}async fetchBookingAvailability(t,e,i){var s;try{this.initialLoading=true;const o=await this.bookingService.getBookingAvailability({from_date:t,to_date:e,propertyid:this.propertyId,adultChildCount:{adult:this.selectedRoom.rateplan.selected_variation.adult_nbr,child:this.selectedRoom.rateplan.selected_variation.child_nbr},language:this.language,currency:this.bookingEvent.currency,room_type_ids:[this.selectedRoom.roomtype.id],rate_plan_ids:[i]});console.log(o[0],i);this.inventory=o[0].inventory;const a=o[0].rateplans.find((t=>t.id===i));if(!a||!a.variations){this.inventory=null;return null}const n=(s=a.variations)===null||s===void 0?void 0:s.find((t=>t.adult_nbr===this.selectedRoom.rateplan.selected_variation.adult_nbr&&t.child_nbr===this.selectedRoom.rateplan.selected_variation.child_nbr));if(!n){return null}return n.discounted_gross_amount}catch(t){console.error(t)}finally{this.initialLoading=false}}renderInputField(t,e,s){return i("div",{class:"col-3 ml-1 position-relative  m-0 p-0 rate-input-container"},i("ir-price-input",{value:s.amount>0?s.amount.toString():"",disabled:this.inventory===0||this.inventory===null,currency:e,"aria-label":"rate","aria-describedby":"rate cost",onTextChange:e=>this.handleInput(e.detail,t)}))}renderReadOnlyField(t,e){return i("p",{class:"col-9 ml-1 m-0 p-0"},`${t}${Number(e.amount).toFixed(2)}`)}renderRateFields(t,e,i){if(this.isEndDateBeforeFromDate){if(t<this.defaultTotalNights){return this.renderInputField(t,e,i)}else{return this.renderReadOnlyField(e,i)}}else{return t<this.selectedRoom.days.length?this.renderReadOnlyField(e,i):this.renderInputField(t,e,i)}}renderDates(){var t;const e=this.bookingEvent.currency.symbol;return i("div",{class:"mt-2 m-0"},(t=this.rates)===null||t===void 0?void 0:t.map(((t,s)=>i("div",{class:"row m-0 mt-1 align-items-center"},i("p",{class:"col-2 m-0 p-0"},u(t.date)),this.renderRateFields(s,e,t)))))}async handleRoomConfirmation(){try{this.isLoading=true;let t=[...this.bookingEvent.rooms];let e=t.findIndex((t=>t.identifier===this.identifier));if(e===-1){throw new Error("Invalid Pool")}t[e]=Object.assign(Object.assign({},t[e]),{days:this.rates,to_date:m(this.dates.to_date).format("YYYY-MM-DD"),from_date:m(this.dates.from_date).format("YYYY-MM-DD")});const i={assign_units:true,check_in:true,is_pms:true,is_direct:true,pickup_info:this.bookingEvent.pickup_info,extra_services:this.bookingEvent.extra_services,booking:{booking_nbr:this.bookingNumber,from_date:m(this.dates.from_date).format("YYYY-MM-DD"),to_date:m(this.dates.to_date).format("YYYY-MM-DD"),remark:this.bookingEvent.remark,property:this.bookingEvent.property,source:this.bookingEvent.source,currency:this.bookingEvent.currency,arrival:this.bookingEvent.arrival,guest:this.bookingEvent.guest,rooms:t}};await this.bookingService.doReservation(i);this.closeRoomNightsDialog.emit({type:"confirm",pool:this.pool})}catch(t){}finally{this.isLoading=false}}render(){var t,e,o;if(!this.bookingEvent){return i("div",{class:"loading-container"},i("ir-loading-screen",null))}return i("div",{class:"sheet-container"},i("ir-title",{class:"p-1 sheet-header",onCloseSideBar:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool}),label:`${k.entries.Lcz_AddingRoomNightsTo} ${(e=(t=this.selectedRoom)===null||t===void 0?void 0:t.roomtype)===null||e===void 0?void 0:e.name} ${((o=this.selectedRoom)===null||o===void 0?void 0:o.unit).name}`,displayContext:"sidebar"}),i("section",{class:"text-left px-1 pt-0 sheet-body"},i("p",{class:"font-medium-1"},`${k.entries.Lcz_Booking}#`," ",this.bookingNumber),this.initialLoading?i("p",{class:"mt-2 text-secondary"},k.entries["Lcz_CheckingRoomAvailability "]):i(s,null,i("p",{class:"font-weight-bold font-medium-1"},`${p(m(this.dates.from_date).format("YYYY-MM-DD"),"YYYY-MM-DD")} - ${p(m(this.dates.to_date).format("YYYY-MM-DD"),"YYYY-MM-DD")}`),i("p",{class:"font-medium-1 mb-0"},`${this.selectedRoom.rateplan.name}`," ",this.selectedRoom.rateplan.is_non_refundable&&i("span",{class:"irfontgreen"},k.entries.Lcz_NonRefundable)),(this.inventory===0||this.inventory===null)&&i("p",{class:"font-medium-1 text danger"},k.entries.Lcz_NoAvailabilityForAdditionalNights),this.selectedRoom.rateplan.custom_text&&i("p",{class:"text-secondary mt-0"},this.selectedRoom.rateplan.custom_text),this.renderDates())),i("section",{class:"sheet-footer"},i("ir-button",{btn_color:"secondary",btn_disabled:this.isLoading,text:k===null||k===void 0?void 0:k.entries.Lcz_Cancel,class:"full-width",btn_styles:"justify-content-center",onClickHandler:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool})}),this.inventory>0&&this.inventory!==null&&i("ir-button",{isLoading:this.isLoading,text:k===null||k===void 0?void 0:k.entries.Lcz_Confirm,btn_disabled:this.isButtonDisabled(),class:"full-width",btn_styles:"justify-content-center",onClickHandler:this.handleRoomConfirmation.bind(this)})))}};yt.style=mt+kt;const wt=".sc-ir-tabs-h{display:flex;align-items:center;position:relative;overflow-x:auto;gap:1rem;padding:0 1rem}.tab.sc-ir-tabs{font-size:0.95rem;font-weight:400;cursor:pointer;position:relative;margin:0;padding:0rem;padding-bottom:1rem;transition:color 0.3s ease;user-select:none;background-color:transparent;border:none;outline:none;flex:1 1 0%;text-align:center;white-space:nowrap}.tab[data-disabled].sc-ir-tabs{cursor:auto}.tab.sc-ir-tabs:hover{opacity:80%}.tab[data-state='selected'].sc-ir-tabs,.tab[data-state='selected'].sc-ir-tabs:hover{color:var(--blue, #1e9ff2);opacity:100%}.active-indicator.sc-ir-tabs{padding:0;bottom:0px;position:absolute;height:3px;border-radius:4px;transition:transform 0.3s ease, width 0.3s ease;background:var(--blue, #1e9ff2)}";const Dt=wt;const xt=class{constructor(i){t(this,i);this.tabChanged=e(this,"tabChanged",7);this.tabs=[];this.disabled=false;this.ariaLabel="Tabs";this.remSize=(()=>{const t=getComputedStyle(document.documentElement).fontSize;return parseFloat(t)})()}componentWillLoad(){var t,e;const i=(t=this.tabs)===null||t===void 0?void 0:t.find((t=>t.id===this.initialTab));if(i){this.selectTab(i)}else if(((e=this.tabs)===null||e===void 0?void 0:e.length)>0){this.selectTab(this.tabs[0])}}disconnectedCallback(){if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}}updateActiveIndicator(){if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}requestAnimationFrame((()=>{const t=this.el.querySelector(`.tab[data-state="selected"]`);if(t){const{left:e,width:i}=t.getBoundingClientRect();const s=this.el.getBoundingClientRect().left;const o=e-s-this.remSize;this.activeIndicator.style.width=`${i-this.remSize}px`;this.activeIndicator.style.transform=`translateX(${o}px)`}}))}selectTab(t){if(this.disabled)return;this._selectedTab=t;this.updateActiveIndicator();this.tabChanged.emit(t)}handleKeyDown(t,e){if(this.disabled)return;const i=this.tabs.findIndex((t=>t.id===e.id));let s=i;switch(t.key){case"ArrowRight":t.preventDefault();s=(i+1)%this.tabs.length;break;case"ArrowLeft":t.preventDefault();s=i===0?this.tabs.length-1:i-1;break;case"Home":t.preventDefault();s=0;break;case"End":t.preventDefault();s=this.tabs.length-1;break;case"Enter":case" ":t.preventDefault();this.selectTab(e);return;default:return}const o=this.tabs[s];if(o){this.selectTab(o);requestAnimationFrame((()=>{const t=this.el.querySelector(`button.tab[data-tab-id="${o.id}"]`);if(t){t.focus()}}))}}render(){return i(o,{key:"55878aae70d318b44526da6b192a252a3ea94a81",role:"tablist","aria-label":this.ariaLabel,"aria-orientation":"horizontal"},this.tabs.map((t=>{var e,s,o;return i("button",{class:"tab",key:t.id,type:"button","data-tab-id":t.id,role:"tab",tabindex:((e=this._selectedTab)===null||e===void 0?void 0:e.id)===t.id?0:-1,"aria-selected":((s=this._selectedTab)===null||s===void 0?void 0:s.id)===t.id?"true":"false","aria-controls":`tabpanel-${t.id}`,id:`tab-${t.id}`,disabled:this.disabled,"data-state":((o=this._selectedTab)===null||o===void 0?void 0:o.id)===t.id?"selected":undefined,onClick:()=>this.selectTab(t),onKeyDown:e=>this.handleKeyDown(e,t)},t.label)})),i("span",{key:"0107bde305b385610dc935d0d817a0504fc69a1f",class:"active-indicator",ref:t=>this.activeIndicator=t}))}get el(){return a(this)}};xt.style=Dt;export{R as igl_booking_event,j as igl_bulk_block,F as igl_bulk_operations,K as igl_bulk_stop_sale,Z as igl_cal_body,tt as igl_cal_footer,st as igl_cal_header,nt as igl_legends,dt as igl_tba_category_view,gt as igl_to_be_assigned,ut as ir_interactive_title,yt as ir_room_nights,xt as ir_tabs};
//# sourceMappingURL=p-bba3e22c.entry.js.map