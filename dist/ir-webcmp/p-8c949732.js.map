{"version":3,"names":["defaultTasksList","getPaginationInitialParams","tasks","getTaskList","tasksList","currentPage","mobileCurrentPage","pageSize","mobilePageSize","totalPages","totalItems","initialState","searchField","filteredTasks","selectedTasks","pagination","filters","isLoading","isFiltersLoading","isExportLoading","archiveOpen","archiveData","archiveFilters","from_date","to_date","filtered_by_hkm","filtered_by_unit","archiveLoading","sorting","field","direction","modalOpen","sidebarOpen","state","hkTasksStore","onChange","createStore","updateSearchField","filterTasks","updateTasks","updatePaginationFields","params","Object","assign","updatePageSize","updatePagination","updateCurrentPage","page","calendar_data","roomsInfo","totalRooms","length","calculatedList","Array","map","_","i","t","searchText","_b","_a","toLowerCase","filter","task","_c","_d","_e","unit","name","includes","status","description","housekeeper","Math","max","ceil","min","getPaginatedTasks","start","end","slice","getMobileTasks","shouldLoadMore","loadMoreTasks","updateSelectedTasks","clearSelectedTasks","toggleTaskSelection","index","findIndex","id","selectAllTasks","setLoading","loading","updateSorting","getSortedTasks","tasksToSort","sort","a","b","aValue","bValue","date","_f","_g","_h","getCheckableTasks","taskDate","Date","today","setHours","isAllTasksSelected","checkableTasks"],"sources":["src/stores/hk-tasks.store.ts"],"sourcesContent":["import { Task, ArchivedTask } from '@/models/housekeeping';\nimport { createStore } from '@stencil/store';\nimport calendar_data from './calendar-data';\n\nconst defaultTasksList = [10, 20, 50, 100];\n\nexport type TaskFilters = {\n  cleaning_periods: { code: string };\n  housekeepers: { id: number }[];\n  cleaning_frequencies: { code: string };\n  dusty_units: { code: string };\n  highlight_check_ins: { code: string };\n};\n\nexport type ArchiveFilters = {\n  from_date: string;\n  to_date: string;\n  filtered_by_hkm?: number[];\n  filtered_by_unit?: number[];\n};\n\nexport type SortingState = {\n  field: string;\n  direction: 'ASC' | 'DESC';\n};\nexport type TasksPagination = {\n  currentPage: number;\n  pageSize: number;\n  totalPages: number;\n  totalItems: number;\n  tasksList: number[];\n  mobileCurrentPage: number;\n  mobilePageSize: number;\n};\nexport interface IHkTasksStore {\n  searchField: string;\n  tasks: Task[];\n  filteredTasks: Task[];\n  selectedTasks: Task[];\n  pagination: TasksPagination;\n  filters: TaskFilters | null;\n  isLoading: boolean;\n  isFiltersLoading: boolean;\n  isExportLoading: boolean;\n  archiveOpen: boolean;\n  archiveData: ArchivedTask[];\n  archiveFilters: ArchiveFilters;\n  archiveLoading: 'search' | 'excel' | null;\n  sorting: SortingState;\n  modalOpen: boolean;\n  sidebarOpen: boolean;\n}\nfunction getPaginationInitialParams() {\n  const tasks = getTaskList();\n  return {\n    tasksList: tasks,\n    currentPage: 1,\n    mobileCurrentPage: 1,\n    // pageSize: tasks[0],\n    // mobilePageSize: tasks[0],\n    pageSize: 20,\n    mobilePageSize: 20,\n    totalPages: 0,\n    totalItems: 0,\n  };\n}\nconst initialState: IHkTasksStore = {\n  searchField: '',\n  tasks: [],\n  filteredTasks: [],\n  selectedTasks: [],\n  pagination: getPaginationInitialParams(),\n  filters: null,\n  isLoading: false,\n  isFiltersLoading: false,\n  isExportLoading: false,\n  archiveOpen: false,\n  archiveData: [],\n  archiveFilters: {\n    from_date: null,\n    to_date: null,\n    filtered_by_hkm: [],\n    filtered_by_unit: [],\n  },\n  archiveLoading: null,\n  sorting: {\n    field: 'date',\n    direction: 'ASC',\n  },\n  modalOpen: false,\n  sidebarOpen: false,\n};\n\nexport const { state: hkTasksStore, onChange } = createStore<IHkTasksStore>(initialState);\n\nexport function updateSearchField(searchField: string) {\n  hkTasksStore.searchField = searchField;\n  hkTasksStore.pagination.currentPage = 1;\n  filterTasks();\n}\n\nexport function updateTasks(tasks: Task[]) {\n  // const wasEmpty = hkTasksStore.tasks.length === 0;\n  hkTasksStore.tasks = tasks;\n\n  // Update task list if significantly changed or was empty\n  // if (wasEmpty || shouldUpdateTaskList(tasks.length)) {\n  //   updateTaskList();\n  // }\n\n  filterTasks();\n}\nfunction updatePaginationFields(params: Partial<TasksPagination>) {\n  hkTasksStore.pagination = {\n    ...hkTasksStore.pagination,\n    ...params,\n  };\n}\nexport function updatePageSize(pageSize: number) {\n  updatePaginationFields({\n    pageSize,\n    currentPage: 1,\n  });\n  updatePagination();\n}\n\nexport function updateCurrentPage(page: number) {\n  if (page >= 1 && page <= hkTasksStore.pagination.totalPages) {\n    updatePaginationFields({ currentPage: page });\n  }\n}\nexport function updateTaskList() {\n  const list = getTaskList();\n  updatePaginationFields({\n    tasksList: list,\n    pageSize: list[0],\n    mobilePageSize: list[0],\n  });\n  updatePagination();\n}\n\nfunction getTaskList(): number[] {\n  if (!calendar_data.roomsInfo) {\n    return defaultTasksList;\n  }\n  const totalRooms = calendar_data.roomsInfo.length;\n  if (totalRooms <= 10) {\n    return defaultTasksList;\n  }\n  const calculatedList = [...Array(4)].map((_, i) => {\n    const t = totalRooms * (i + 1);\n    return i === 3 ? (t < 100 ? 100 : t) : t;\n  });\n  return calculatedList;\n}\n\n// function shouldUpdateTaskList(newTaskCount: number): boolean {\n//   const currentMax = Math.max(...hkTasksStore.pagination.tasksList);\n//   return newTaskCount > currentMax * 1.5 || newTaskCount < currentMax * 0.5;\n// }\n\nfunction filterTasks() {\n  const searchText = hkTasksStore?.searchField?.toLowerCase() ?? '';\n\n  if (!searchText) {\n    hkTasksStore.filteredTasks = [...hkTasksStore.tasks];\n  } else {\n    hkTasksStore.filteredTasks = hkTasksStore.tasks.filter(\n      task =>\n        task.unit?.name?.toLowerCase().includes(searchText) || task.status?.description?.toLowerCase().includes(searchText) || task.housekeeper?.toLowerCase().includes(searchText),\n    );\n  }\n\n  updatePagination();\n}\n\nfunction updatePagination() {\n  const totalItems = hkTasksStore.filteredTasks.length;\n  const totalPages = Math.max(1, Math.ceil(totalItems / hkTasksStore.pagination.pageSize));\n  updatePaginationFields({\n    totalItems,\n    totalPages,\n    currentPage: Math.min(hkTasksStore.pagination.currentPage, totalPages),\n  });\n}\n\nexport function getPaginatedTasks(): Task[] {\n  const start = (hkTasksStore.pagination.currentPage - 1) * hkTasksStore.pagination.pageSize;\n  const end = start + hkTasksStore.pagination.pageSize;\n  return hkTasksStore.filteredTasks.slice(start, end);\n}\n\nexport function getMobileTasks(): Task[] {\n  const { mobileCurrentPage, mobilePageSize } = hkTasksStore.pagination;\n  const start = (mobileCurrentPage - 1) * mobilePageSize;\n  const end = start + mobilePageSize;\n  return hkTasksStore.filteredTasks.slice(0, end);\n}\n\nexport function shouldLoadMore(): boolean {\n  const { mobileCurrentPage, mobilePageSize } = hkTasksStore.pagination;\n  return !(mobilePageSize * (mobileCurrentPage - 1) + mobilePageSize >= hkTasksStore.filteredTasks.length);\n}\n\nexport function loadMoreTasks(page: number) {\n  if (!shouldLoadMore()) {\n    return;\n  }\n  updatePaginationFields({\n    mobileCurrentPage: page,\n  });\n}\n\nexport function resetHkTasksStore() {\n  hkTasksStore.searchField = '';\n  hkTasksStore.tasks = [];\n  hkTasksStore.filteredTasks = [];\n  hkTasksStore.selectedTasks = [];\n  (hkTasksStore.pagination = getPaginationInitialParams()), (hkTasksStore.filters = null);\n  hkTasksStore.isLoading = false;\n  hkTasksStore.isFiltersLoading = false;\n  hkTasksStore.isExportLoading = false;\n  hkTasksStore.archiveOpen = false;\n  hkTasksStore.archiveData = [];\n  hkTasksStore.archiveFilters = {\n    from_date: null,\n    to_date: null,\n    filtered_by_hkm: [],\n    filtered_by_unit: [],\n  };\n  hkTasksStore.archiveLoading = null;\n  hkTasksStore.sorting = {\n    field: 'date',\n    direction: 'ASC',\n  };\n  hkTasksStore.modalOpen = false;\n  hkTasksStore.sidebarOpen = false;\n}\n\n// Task selection helpers\nexport function updateSelectedTasks(tasks: Task[]) {\n  hkTasksStore.selectedTasks = tasks;\n}\n\nexport function clearSelectedTasks() {\n  hkTasksStore.selectedTasks = [];\n}\n\nexport function toggleTaskSelection(task: Task) {\n  const index = hkTasksStore.selectedTasks.findIndex(t => t.id === task.id);\n  if (index > -1) {\n    hkTasksStore.selectedTasks = hkTasksStore.selectedTasks.filter(t => t.id !== task.id);\n  } else {\n    hkTasksStore.selectedTasks = [...hkTasksStore.selectedTasks, task];\n  }\n}\n\nexport function selectAllTasks(tasks: Task[]) {\n  hkTasksStore.selectedTasks = [...tasks];\n}\n\n// Filter helpers\nexport function updateFilters(filters: TaskFilters) {\n  hkTasksStore.filters = filters;\n}\n\nexport function clearFilters() {\n  hkTasksStore.filters = null;\n}\n\n// Loading state helpers\nexport function setLoading(loading: boolean) {\n  hkTasksStore.isLoading = loading;\n}\n\nexport function setFiltersLoading(loading: boolean) {\n  hkTasksStore.isFiltersLoading = loading;\n}\n\nexport function setExportLoading(loading: boolean) {\n  hkTasksStore.isExportLoading = loading;\n}\n\n// Sorting helpers\nexport function updateSorting(field: string, direction: 'ASC' | 'DESC') {\n  hkTasksStore.sorting = { field, direction };\n  // Apply sorting to original tasks, then re-filter\n  hkTasksStore.tasks = getSortedTasks(hkTasksStore.tasks);\n  filterTasks();\n}\n\nexport function getSortedTasks(tasksToSort: Task[] = hkTasksStore.filteredTasks): Task[] {\n  const { field, direction } = hkTasksStore.sorting;\n  return [...tasksToSort].sort((a, b) => {\n    let aValue = a[field];\n    let bValue = b[field];\n\n    if (field === 'status') {\n      aValue = a.status?.description;\n      bValue = b.status?.description;\n    } else if (field === 'unit') {\n      aValue = a.unit?.name;\n      bValue = b.unit?.name;\n    }\n\n    if (aValue < bValue) return direction === 'ASC' ? -1 : 1;\n    if (aValue > bValue) return direction === 'ASC' ? 1 : -1;\n\n    // Fallback sorting by date then unit name\n    if (a.date < b.date) return -1;\n    if (a.date > b.date) return 1;\n    if (a.unit?.name < b.unit?.name) return -1;\n    if (a.unit?.name > b.unit?.name) return 1;\n\n    return 0;\n  });\n}\n\n// Archive helpers\nexport function setArchiveOpen(open: boolean) {\n  hkTasksStore.archiveOpen = open;\n}\n\nexport function updateArchiveData(data: ArchivedTask[]) {\n  hkTasksStore.archiveData = data;\n}\n\nexport function updateArchiveFilters(filters: Partial<ArchiveFilters>) {\n  hkTasksStore.archiveFilters = { ...hkTasksStore.archiveFilters, ...filters };\n}\n\nexport function setArchiveLoading(loading: 'search' | 'excel' | null) {\n  hkTasksStore.archiveLoading = loading;\n}\n\n// Modal and sidebar helpers\nexport function setModalOpen(open: boolean) {\n  hkTasksStore.modalOpen = open;\n}\n\nexport function setSidebarOpen(open: boolean) {\n  hkTasksStore.sidebarOpen = open;\n}\n\n// Computed getters\nexport function getCheckableTasks(): Task[] {\n  return hkTasksStore.tasks.filter(task => {\n    const taskDate = new Date(task.date);\n    const today = new Date();\n    today.setHours(23, 59, 59, 999);\n    return taskDate <= today;\n  });\n}\n\nexport function getSelectedTasksCount(): number {\n  return hkTasksStore.selectedTasks.length;\n}\n\nexport function isAllTasksSelected(): boolean {\n  const checkableTasks = getCheckableTasks();\n  return checkableTasks.length > 0 && hkTasksStore.selectedTasks.length === checkableTasks.length;\n}\n\nexport function getTasksByStatus(status: string): Task[] {\n  return hkTasksStore.tasks.filter(task => task.status?.description === status);\n}\n\nexport function getTasksByHousekeeper(housekeeperId: number): Task[] {\n  return hkTasksStore.tasks.filter(task => task.hkm_id === housekeeperId);\n}\n\nexport function getTasksByUnit(unitId: number): Task[] {\n  return hkTasksStore.tasks.filter(task => task.unit?.id === unitId);\n}\n\n// Utility helpers\nexport function updateStoreProperty<K extends keyof IHkTasksStore>(key: K, value: IHkTasksStore[K]) {\n  hkTasksStore[key] = value;\n}\n\nexport function getStoreSnapshot(): IHkTasksStore {\n  return { ...hkTasksStore };\n}\n\nexport default hkTasksStore;\n"],"mappings":"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","ignoreList":[]}