{"version":3,"names":["iglBlockedDateDrawerCss","IglBlockedDateDrawerStyle0","IglBlockedDateDrawer","open","label","fromDate","toDate","unitId","isLoading","blockDatesData","from_date","to_date","NOTES","pr_id","STAY_STATUS_CODE","DESCRIPTION","BLOCKED_TILL_DATE","BLOCKED_TILL_HOUR","BLOCKED_TILL_MINUTE","blockedDateDrawerClosed","bookingService","BookingService","handleBlockDate","this","props","releaseData","getReleaseHoursString","RELEASE_AFTER_HOURS","Number","OPTIONAL_REASON","toString","OUT_OF_SERVICE","blockUnit","closeDrawer","error","emit","render","h","key","onDrawerHide","e","stopImmediatePropagation","stopPropagation","onDataUpdateEvent","detail","data","slot","class","size","appearance","variant","loading","onClickHandler","iglBookingEventCss","IglBookingEventStyle0","IglBookingEvent","currency","is_vacation_rental","language","bookingEvent","allBookingEvents","countries","hideBubbleInfo","updateEventData","dragOverEventData","showRoomNightsDialog","showDialog","resetStretchedBooking","toast","updateBookingEvent","renderElement","position","isShrinking","dayWidth","eventSpace","vertSpace","showInfoPopup","bubbleInfoTopSide","isStretch","eventsService","EventsService","resizeSide","isDragging","initialX","initialY","currentX","currentY","initialWidth","initialLeft","finalWidth","dragInitPos","dragEndPos","elementRect","isTouchStart","moveDifferenceX","moveDifferenceY","animationFrameId","handleMouseMoveBind","handleMouseMove","bind","handleMouseUpBind","handleMouseUp","handleClickOutsideBind","handleClickOutside","role","componentWillLoad","window","addEventListener","SPLIT_INDEX","buildSplitIndex","ROOMS","getSplitRole","IDENTIFIER","componentDidLoad","isNewEvent","hideBubble","setTimeout","async","includes","STATUS_CODE","showEventInfo","STATUS","fetchAndAssignBookingData","renderAgain","disconnectedCallback","removeEventListener","cancelAnimationFrame","event","clickedElement","target","element","contains","hideBubbleInfoPopup","currentInfoBubbleId","getBookingId","moveBookingToHandler","bookingId","moveToDay","toRoomId","FROM_DATE","fromRoomId","isBlockUnit","requestAnimationFrame","resetBookingToInitialPosition","pool","previousToDate","moment","add","format","console","log","findRoomType","PR_ID","TO_DATE","isSame","calendar_dates","disabled_cells","get","disabled","reset","checkIfSlotOccupied","reallocateEvent","catch","description","status","newRatePlans","matchedRatePlan","getModalDescription","hideConfirmButton","oldFromDate","defaultDates","oldToDate","diffDays","calculateDaysBetweenDates","shrinkingDirection","isAfter","isBefore","newToDate","subtract","warn","reason","title","rateplans","validateDates","base_date","cursor","counter","locales","entries","Lcz_ThisUnitIsNotAvailable","payload","booking","bookingNumber","BOOKING_NUMBER","identifier","is_direct","message","type","buildBarIds","bar","lateCheckout","balance","validStatuses","getExposedBooking","base_booking","filteredRooms","rooms","filter","room","ID","length","Error","some","transformedBooking","transformNewBooking","NO_OF_DAYS","NAME","origin","TOTAL_PRICE","POOL","BALANCE","channel_booking_nbr","otherBookingData","DEPARTURE_TIME","PHONE","PHONE_PREFIX","PRIVATE_NOTE","ROOM_INFO","sharing_persons","roomId","roomType","roomsInfo","physicalrooms","r","id","Lcz_OTA_Modification_Alter","initialRT","targetRT","Lcz_AreYouSureWantToMoveAnotherUnit","mealPlans","checkMealPlan","rateplan_id","RATE_PLAN_ID","roomTypeId","roomTypes","calendar_data","property","roomtypes","Array","isArray","undefined","Lcz_CannotChangeCHBookings","Lcz_ConfrmModiication","Lcz_SameRatesWillBeKept","style","left","width","top","handleRevertBooking","fromTime","toTime","isOccupied","eventFromTime","eventToTime","isSameOrAfter","getUniqueId","Date","getTime","isSplitBooking","SPLIT_BOOKING","isHighlightEventType","getEventType","getBookingStatus","getBookedBy","getBookedRoomId","getEventStartingDate","getEventEndingDate","event_type","getEventLegend","legendData","statusId","orderRide","color","getLegendOfStatus","aStatusId","getNoteNode","INTERNAL_NOTE","getBalanceNode","setStayDays","aStayDays","getStayDays","getPosition","startingDate","startingCellClass","getDate","getMonth","getFullYear","bodyContainer","document","querySelector","startingCell","pos","height","getBoundingClientRect","bodyContainerRect","boundingRect","getNumber","aData","parseFloat","startDragging","side","preventDefault","clientX","touches","clientY","offsetX","offsetY","x","y","offsetWidth","offsetLeft","distanceX","distanceY","baseCondition","newWidth","Math","min","max","newLeft","abs","nbOfDays","numberOfDays","round","initialStayDays","isNaN","replace","offset","updateData","calculateHoverPosition","barRect","barWidth","barLeft","screenWidth","innerWidth","hoverLeft","transform","renderEventBookingNumber","showInfo","midPoint","isDepartureAfterHotelCheckout","is_automatic_check_in_out","departureTime","code","t1","time_constraints","check_out_till","t2","computeSplitRole","splitRole","legend","noteNode","balanceNode","backgroundColor","calendar_extra","booking_color","foreground","stripe","colorsForegrounds","checkout","Host","clsName","bookingEventBase","skewedLeft","skewedRight","onTouchStart","onMouseDown","for","formatAmount","symbol","Fragment","bubbleInfoTop","ReloadInterceptor","isActive","onIntercept","constructor","options","autoActivate","activate","handleBeforeUnload","capture","deactivate","returnValue","iglBulkBlockCss","IglBulkBlockStyle0","sheetCss","IglBulkBlockStyle1","IglBulkBlock","maxDatesLength","property_id","selectedRoomTypes","Map","selectedUnit","errors","blockState","dates","from","to","closeModal","sidebar","dateRefs","reloadInterceptor","minDate","datesSchema","z","array","object","any","refine","val","isMoment","unitSections","datesSections","addBlockDates","periods","parse","scrollIntoView","behavior","block","blockAvailabilityForBrackets","unit_id","block_status_code","brackets","map","p","unBlockUnitByPeriod","Lcz_RequestSubmittedSuccessfully","ZodError","preventClose","handleDateChange","index","date","i","rowFrom","isSameOrBefore","openDatePicker","nextFrom","findIndex","d","addDateRow","last_dates","onSubmit","gap","showFirstOption","selectedValue","text","value","onSelectChange","Lcz_PlzSelectOneListing","Lcz_PlzSelectOneUnit","ref","el","name","j","row_style","checked","onCheckChange","roomtype_id","Lcz_From","Lcz_ToExclusive","icon_name","fromDateMinDate","clone","toDateMinDate","forceDestroyOnUpdate","emitEmptyDate","String","onDateChanged","evt","start","onDatePickerFocus","maxDate","_","Lcz_Cancel","btn_color","Lcz_Confirm","btn_type","iglBulkOperationsCss","IglBulkOperationsStyle0","IglBulkOperationsStyle1","IglBulkOperations","selectedTab","tabs","tabsEl","titleEl","setProperty","onCloseSideBar","displayContext","onTabChanged","iglBulkStopSaleCss","IglBulkStopSaleStyle0","IglBulkStopSaleStyle1","IglBulkStopSale","selectedWeekdays","Set","fill","getDayIndex","dateStr","day","weekdaysSections","generatePeriodsToModify","period","current","lastDay","nextDay","has","selectedRoom","push","room_type_id","night","updateCalendarCells","payloads","prevDisabledCells","roomsInfoById","rt","dayIndexByValue","days","rateByRoomTypeAndDate","restriction","restrictions","dayIndex","rateKey","rp","rate","find","set","haveAvailability","exposed_inventory","rts","is_closed","periods_to_modify","isAllOpen","every","result","isAllClosed","setExposedRestrictionPerRoomType","f","Promise","all","firstOption","Lcz_Select","Lcz_Open","Lcz_StopSale","choice","rest","entry","weekdays","onWeekdayChange","Lcz_Save","iglCalBodyCss","IglCalBodyStyle0","IglCalBody","isScrollViewDragging","propertyId","calendarData","today","highlightedDate","dragOverElement","addBookingDatasEvent","showBookingPopup","scrollPageToRoom","selectedRooms","newEvent","currentDate","hkModal","housekeepingService","HouseKeepingService","bookingMap","interactiveTitle","dayRateMap","roomsWithTodayCheckinStatus","categoriesWithTodayCheckinStatus","setHours","getBookingMap","getBookingData","updateTodayCheckinStatus","forEach","updateDisabledCellsCache","handleCalendarDataChange","handleTodayChange","dragOverHighlightElementHandler","gotoRoom","category","getRoomCategoryByRoomId","expanded","toggleCategory","scrollToRoom","addToBeAssignedEvents","addBookingDatas","closeWindow","ind","ev","splice","refClass","roomCategory","getCategoryRooms","getRoomId","getCategoryName","getCategoryId","getTotalPhysicalRooms","getRoomName","roomInfo","getRoomById","physicalRooms","physical_room","bookingEvents","getSelectedCellRefName","selectedDay","getSplitBookingEvents","addNewEvent","keys","Object","startDate","endDate","dateDifference","EMAIL","convertBooking","REFERENCE_TYPE","getTwoDigitNumStr","ENTRY_DATE","ADULTS_COUNT","COUNTRY","RATE","RATE_PLAN","ARRIVAL_TIME","TITLE","Lcz_NewBookingFor","CATEGORY","defaultDateRange","fromDateStr","toDateStr","editable","popupTitle","BLOCK_DATES_TITLE","Lcz_BlockDatesFor","getDateStr","toISOString","formattedLegendData","splitBookingEvents","num","locale","toLocaleString","month","removeNewEvent","events","clickCell","refKey","hasOwnProperty","disabledCount","dateKey","isCellDisabled","showNewBookingPopup","bookings","startOf","compareTime","createDateWithOffsetAndHour","checkin_checkout_hours","hour","getGeneralCategoryDayColumns","addClass","isCategory","dayInfo","getGeneralRoomDayColumns","roomName","prevDate","isDisabled","isSelected","isCurrentDate","cleaningDates","cleaningTasks","shouldBeCleaned","cleaning_frequency","onClick","Boolean","getRoomCategoryRow","is_active","hasRoomWithTodayCheckin","categoryHasRoomWithTodayCheckin","popoverTitle","xmlns","viewBox","getRoomsByCategory","haveSingleRooms","roomHasTodayCheckin","housekeeping_enabled","openModal","onMouseEnter","onMouseLeave","removeProperty","hk_status","hkStatus","display","getRoomRows","confirmHousekeepingUpdate","setExposedUnitHKStatus","unit","executeHKAction","actions","hkm_id","housekeeper","booking_nbr","RATE_TYPE","leftBtnText","middleBtnText","renderModalMiddleButtonText","middleBtnActive","rightBtnText","renderModalRightButtonText","modalBody","renderModalBody","onConfirmModal","onMiddleModal","autoClose","isMiddleButtonLoading","onCancelModal","todayISO","getTodayISODate","categories","in_out","categoryId","todayValue","parsed","isValid","clear","categoryIndex","cellKey","getCellKey","is_available_to_book","iglCalFooterCss","IglCalFooterStyle0","IglCalFooter","optionEvent","isLegendOpen","_today","handleOptionEvent","paddingLeft","Lcz_Legend","marginLeft","weekend","isWeekend","currentDay","dayDisplayName","iglCalHeaderCss","IglCalHeaderStyle0","IglCalHeader","gotoRoomEvent","gotoToBeAssignedDate","propertyid","unassignedDates","unassignedRoomsNumber","roomsList","toBeAssignedService","ToBeAssignedService","dateRef","dateSelectRef","initializeRoomsList","handleUnAssignedDatesChange","newValue","fetchAndAssignUnassignedRooms","handleCalendarDataChanged","concat","assignRoomsToDate","dt","selectedDate","getUnassignedRooms","dateToFormattedString","res","newEndDate","renderView","handleReduceAvailableUnitEvent","showToBeAssigned","handleDateSelect","handleClearSearch","handleFilterRooms","inputElement","trim","toLowerCase","handleScrollToRoom","getStringDateFormat","getNewBookingModel","setDate","Lcz_NewBooking","editabled","Lcz_UnassignedUnitsTooltip","fontSize","Lcz_Navigate","closeDatePicker","Lcz_CreateNewBooking","Lcz_StopOpenSale","item","monthsInfo","monthInfo","daysCount","monthName","unassigned_units_nbr","pill","dayTitle","occupancy","iglLegendsCss","IglLegendsStyle0","IglLegends","propertyService","PropertyService","bookingColors","saveState","saveError","loadingIndex","saveTimeout","clearTimeout","handleSaveStateChange","syncCalendarExtra","colors","calendarExtra","booking_colors","updateBookingColor","patch","idx","persistBookingColors","setPropertyCalendarExtra","JSON","stringify","handleNameInput","handleBlur","handleLoaderComplete","currentIndex","legendInfo","l","design","stripeColor","colSpan","marginTop","marginBottom","paddingBottom","previewClass","inputContainerStyle","margin","placeholder","onTextChange","onInputBlur","onLoaderComplete","Lcz_MonthAndYear","Lcz_UnassignedUnits","Lcz_Date","Lcz_Occupancy","Lcz_TotalAvailability","iglReallocationDialogCss","IglReallocationDialogStyle0","IglReallocationDialog","selectedRateplan","showRateplanError","dialogClose","revertBooking","resetModalState","dialogEl","rateplanSelectEl","handleDataChange","newData","resetState","reallocateUnit","validateRateplanSelection","rateplanOptions","option","formatRateplanLabel","suffix","custom_text","hasRateplanRequirement","focusRateplanSelect","selectEl","shadowRoot","focus","handleDialogVisibilityChange","handleRateplanChange","handleCancelClick","hasRateplans","onIrDialogHide","defaultValue","onchange","isRequestPending","SelectedUnitSchema","coerce","number","iglSplitBookingCss","IglSplitBookingStyle0","IglSplitBookingStyle1","IglSplitBooking","selectedDates","mealPlanOptions","getRoom","generateDates","MFromDate","MToDate","checkBookingAvailability","resetBookingStore","is_in_agent_mode","agent","getBookingAvailability","adultChildCount","adult","child","room_type_ids","agent_id","room_type_ids_to_update","doReservation","oldRooms","canCheckIn","departure_time","check_in","assigned_units_pool","parent_room_identifier","is_split","roomtype","rateplan","assign_units","is_pms","is_backend","is_in_loyalty_mode","promo_key","extras","remark","booked_on","source","arrival","guest","pickup_info","err","issues","path","updateSelectedUnit","params","merged","roomTypesSource","mealPlanResult","hasExplicitRateplanUpdate","prototype","call","showDateDifference","short_name","is_non_refundable","Lcz_NonRefundable","units","unitMap","assignable_units","Is_Fully_Available","showMealPlanSelect","iglTbaCategoryViewCss","IglTbaCategoryViewStyle0","IglTbaCategoryView","categoriesData","eventDatas","assignUnitEvent","handleAssignRoomEvent","opt","eventData","RT_ID","assignEvent","getEventView","eventIndex","onAssignRoomEvent","iglToBeAssignedCss","IglToBeAssignedStyle0","IglToBeAssigned","unassignedDatesProp","loadingMessage","showDatesList","orderedDatesList","noScroll","selectedDateDisplay","reduceAvailableUnitEvent","addToBeAssignedEvent","highlightToBeAssignedBookingEvent","isGotoToBeAssignedDate","reArrangeData","Lcz_FetchingUnAssignedUnits","handleUnassignedDatesToBeAssignedChange","setMinutes","setSeconds","sort","a","b","parseInt","showForDate","handleAssignUnit","updateCategories","categorisedRooms","roomIds","getUnassignedDates","firstKey","gotoDate","handleToBeAssignedDate","dateStamp","withLoading","showUnassignedDate","getDay","dayOfWeek","getLocalizedDayOfWeek","weekday","toLocaleDateString","getToBeAssignedEntities","getCategoryView","onAssignUnitEvent","selectedDateData","Lcz_Assignments","btn_styles","colorVariants","secondary","visibleBackgroundOnHover","Lcz_AllBookingsAreAssigned","ordDate","Lcz_AllAssignForThisDay","irInteractiveTitleCss","IrInteractiveTitleStyle0","IrInteractiveTitle","irPopoverLeft","cropSize","broomTooltip","lastRenderedTitle","titleContainerRef","popoverInstance","initializePopoverIfNeeded","titleContainer","disposePopover","tempSpan","createElement","visibility","whiteSpace","textContent","body","appendChild","textWidth","removeChild","containerWidth","clientWidth","iconWidth","willOverflow","$","popover","trigger","content","placement","html","sanitize","delay","show","hide","shouldCrop","displayTitle","slice","overflow","textOverflow","alignItems","flexShrink","minWidth","irPriceInputCss","IrPriceInputStyle0","IrPriceInput","readOnly","inputStyle","labelStyle","autoValidate","wrapKey","zod","required","minValue","maxValue","testId","containerClassname","labelContainerClassname","textChange","inputBlur","inputFocus","opts","mask","scale","radix","mapToRadix","normalizeZeros","padFractionalZeros","thousandsSeparator","inputRef","v4","initializeMask","maskOpts","IMask","on","isEmpty","unmaskedValue","hasSpecialClass","className","classList","validateInput","handleInputChange","numValue","toFixed","handleFocus","htmlFor","onInput","onBlur","onFocus","ariaLabel","ariaDescription","irReallocationDrawerCss","IrReallocationDrawerStyle0","IrReallocationDrawer","roomIdentifier","_id","formId","form","irReallocationFormCss","IrReallocationFormStyle0","IrReallocationForm","getDates","split","padding","isLastUnit","schema","shape","irRoomNightsCss","IrRoomNightsStyle0","IrRoomNightsStyle1","IrRoomNights","ticket","rates","initialLoading","inventory","isEndDateBeforeFromDate","defaultTotalNights","isInputFocused","closeRoomNightsDialog","init","isButtonDisabled","amount","fetchBookingAvailability","newDatesArr","getDaysArray","cost","handleInput","inputValue","rate_plan_id","bookingAvailability","selected_variation","adult_nbr","child_nbr","rate_plan_ids","rate_plan","variations","variation","discounted_gross_amount","renderInputField","currency_symbol","renderReadOnlyField","renderRateFields","renderDates","convertDatePrice","handleRoomConfirmation","selectedRoomIndex","extra_services","Lcz_AddingRoomNightsTo","Lcz_Booking","formatDate","Lcz_NoAvailabilityForAdditionalNights","btn_disabled","irSuccessLoaderCss","IrSuccessLoaderStyle0","IrSuccessLoader","spinnerDuration","successDuration","autoStart","active","loaderComplete","phase","spinnerTimer","successTimer","startCycle","clearTimers","onActiveChange","resetCycle","onDurationChange","spinnerDelay","showSuccess","successDelay","handleCompletion","part","irTabsCss","IrTabsStyle0","IrTabs","initialTab","_selectedTab","tabChanged","activeIndicator","tab","t","selectTab","updateActiveIndicator","parentLeft","remSize","getComputedStyle","documentElement","handleKeyDown","currentTab","nextIndex","nextTab","tabButton","tabindex","onKeyDown"],"sources":["src/components/igloo-calendar/igl-blocked-date-drawer/igl-blocked-date-drawer.css?tag=igl-blocked-date-drawer&encapsulation=scoped","src/components/igloo-calendar/igl-blocked-date-drawer/igl-blocked-date-drawer.tsx","src/components/igloo-calendar/igl-booking-event/igl-booking-event.css?tag=igl-booking-event&encapsulation=scoped","src/components/igloo-calendar/igl-booking-event/igl-booking-event.tsx","src/utils/ReloadInterceptor.ts","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-block/igl-bulk-block.css?tag=igl-bulk-block&encapsulation=scoped","src/common/sheet.css?tag=igl-bulk-block&encapsulation=scoped","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-block/igl-bulk-block.tsx","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-operations.css?tag=igl-bulk-operations&encapsulation=scoped","src/common/sheet.css?tag=igl-bulk-operations&encapsulation=scoped","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-operations.tsx","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-stop-sale/igl-bulk-stop-sale.css?tag=igl-bulk-stop-sale&encapsulation=scoped","src/common/sheet.css?tag=igl-bulk-stop-sale&encapsulation=scoped","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-stop-sale/igl-bulk-stop-sale.tsx","src/components/igloo-calendar/igl-cal-body/igl-cal-body.css?tag=igl-cal-body&encapsulation=scoped","src/components/igloo-calendar/igl-cal-body/igl-cal-body.tsx","src/components/igloo-calendar/igl-cal-footer/igl-cal-footer.css?tag=igl-cal-footer&encapsulation=scoped","src/components/igloo-calendar/igl-cal-footer/igl-cal-footer.tsx","src/components/igloo-calendar/igl-cal-header/igl-cal-header.css?tag=igl-cal-header&encapsulation=scoped","src/components/igloo-calendar/igl-cal-header/igl-cal-header.tsx","src/components/igloo-calendar/igl-legends/igl-legends.css?tag=igl-legends&encapsulation=scoped","src/components/igloo-calendar/igl-legends/igl-legends.tsx","src/components/igloo-calendar/igl-reallocation-dialog/igl-reallocation-dialog.css?tag=igl-reallocation-dialog&encapsulation=scoped","src/components/igloo-calendar/igl-reallocation-dialog/igl-reallocation-dialog.tsx","src/components/igloo-calendar/igl-split-booking/types.ts","src/components/igloo-calendar/igl-split-booking/igl-split-booking.css?tag=igl-split-booking&encapsulation=scoped","src/common/sheet.css?tag=igl-split-booking&encapsulation=scoped","src/components/igloo-calendar/igl-split-booking/igl-split-booking.tsx","src/components/igloo-calendar/igl-to-be-assigned/igl-tba-category-view/igl-tba-category-view.css?tag=igl-tba-category-view&encapsulation=scoped","src/components/igloo-calendar/igl-to-be-assigned/igl-tba-category-view/igl-tba-category-view.tsx","src/components/igloo-calendar/igl-to-be-assigned/igl-to-be-assigned.css?tag=igl-to-be-assigned&encapsulation=scoped","src/components/igloo-calendar/igl-to-be-assigned/igl-to-be-assigned.tsx","src/components/ui/ir-interactive-title/ir-interactive-title.css?tag=ir-interactive-title&encapsulation=scoped","src/components/ui/ir-interactive-title/ir-interactive-title.tsx","src/components/ui/ir-price-input/ir-price-input.css?tag=ir-price-input&encapsulation=scoped","src/components/ui/ir-price-input/ir-price-input.tsx","src/components/ir-reallocation-drawer/ir-reallocation-drawer.css?tag=ir-reallocation-drawer&encapsulation=scoped","src/components/ir-reallocation-drawer/ir-reallocation-drawer.tsx","src/components/ir-reallocation-drawer/ir-reallocation-form/ir-reallocation-form.css?tag=ir-reallocation-form&encapsulation=scoped","src/components/ir-reallocation-drawer/ir-reallocation-form/ir-reallocation-form.tsx","src/components/igloo-calendar/ir-room-nights/ir-room-nights.css?tag=ir-room-nights&encapsulation=scoped","src/common/sheet.css?tag=ir-room-nights&encapsulation=scoped","src/components/igloo-calendar/ir-room-nights/ir-room-nights.tsx","src/components/ui/ir-success-loader/ir-success-loader.css?tag=ir-success-loader&encapsulation=shadow","src/components/ui/ir-success-loader/ir-success-loader.tsx","src/components/ui/ir-tabs/ir-tabs.css?tag=ir-tabs&encapsulation=scoped","src/components/ui/ir-tabs/ir-tabs.tsx"],"sourcesContent":[":host {\n  display: block;\n  text-align: start;\n}\n","import { BookingService } from '@/services/booking-service/booking.service';\nimport { getReleaseHoursString } from '@/utils/utils';\nimport { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\n\n@Component({\n  tag: 'igl-blocked-date-drawer',\n  styleUrl: 'igl-blocked-date-drawer.css',\n  scoped: true,\n})\nexport class IglBlockedDateDrawer {\n  /**\n   * Controls whether the blocked date drawer is open or closed.\n   * Reflected to the DOM so it can be styled or toggled externally.\n   */\n  @Prop({ reflect: true }) open: boolean;\n\n  /**\n   * Label text displayed at the top of the drawer.\n   * Typically used as the drawer title.\n   */\n  @Prop() label: string;\n\n  /**\n   * Start date of the blocked date range.\n   * Expected to be an ISO date string (YYYY-MM-DD).\n   */\n  @Prop() fromDate: string;\n\n  /**\n   * End date of the blocked date range.\n   * Expected to be an ISO date string (YYYY-MM-DD).\n   */\n  @Prop() toDate: string;\n\n  /**\n   * Identifier of the unit being blocked.\n   * Used when sending block requests to the booking service.\n   */\n  @Prop() unitId: number;\n\n  @State() isLoading = false;\n  @State() blockDatesData: any = {\n    from_date: '',\n    to_date: '',\n    NOTES: '',\n    pr_id: null,\n    STAY_STATUS_CODE: null,\n    DESCRIPTION: null,\n    BLOCKED_TILL_DATE: null,\n    BLOCKED_TILL_HOUR: null,\n    BLOCKED_TILL_MINUTE: null,\n  };\n\n  @Event() blockedDateDrawerClosed: EventEmitter<void>;\n\n  private bookingService = new BookingService();\n\n  private async handleBlockDate() {\n    try {\n      this.isLoading = true;\n      const props: any = (() => {\n        const releaseData = getReleaseHoursString(this.blockDatesData.RELEASE_AFTER_HOURS !== null ? Number(this.blockDatesData.RELEASE_AFTER_HOURS) : null);\n        return {\n          from_date: this.fromDate,\n          to_date: this.toDate,\n          NOTES: this.blockDatesData.OPTIONAL_REASON || '',\n          pr_id: this.unitId.toString(),\n          STAY_STATUS_CODE: this.blockDatesData.OUT_OF_SERVICE ? '004' : this.blockDatesData.RELEASE_AFTER_HOURS === 0 ? '002' : '003',\n          DESCRIPTION: this.blockDatesData.RELEASE_AFTER_HOURS || '',\n          ...releaseData,\n        };\n      })();\n      await this.bookingService.blockUnit(props);\n      this.closeDrawer();\n    } catch (error) {\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private closeDrawer() {\n    this.blockedDateDrawerClosed.emit();\n    this.blockDatesData = {\n      from_date: '',\n      to_date: '',\n      NOTES: '',\n      pr_id: null,\n      STAY_STATUS_CODE: null,\n      DESCRIPTION: null,\n      BLOCKED_TILL_DATE: null,\n      BLOCKED_TILL_HOUR: null,\n      BLOCKED_TILL_MINUTE: null,\n    };\n  }\n\n  render() {\n    return (\n      <ir-drawer\n        label={this.label}\n        onDrawerHide={e => {\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n          this.closeDrawer();\n        }}\n        open={this.open}\n      >\n        {this.open && (\n          <igl-block-dates-view onDataUpdateEvent={e => (this.blockDatesData = { ...e.detail.data })} fromDate={this.fromDate} toDate={this.toDate}></igl-block-dates-view>\n        )}\n        <div slot=\"footer\" class=\"ir__drawer-footer\">\n          <ir-custom-button data-drawer=\"close\" size=\"medium\" appearance=\"filled\" variant=\"neutral\">\n            Cancel\n          </ir-custom-button>\n          <ir-custom-button\n            loading={this.isLoading}\n            onClickHandler={() => {\n              this.handleBlockDate();\n            }}\n            size=\"medium\"\n            appearance=\"accent\"\n            variant=\"brand\"\n          >\n            Save\n          </ir-custom-button>\n        </div>\n      </ir-drawer>\n    );\n  }\n}\n",":host {\n  display: block;\n  position: absolute;\n  --ota-bar-width: 2px;\n  --stripe-period: 20px;\n  --split-border-width: 5px;\n  --split-border-color: var(--wa-color-text-normal);\n}\n\n.bookingEventBase {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  border-radius: 4px;\n  background-color: rgb(49, 190, 241);\n  transform: skewX(-22deg);\n  cursor: pointer;\n}\n.bookingEventBase.leftSplit {\n  border-left: var(--split-border-width) solid var(--split-border-color);\n}\n.bookingEventBase.rightSplit {\n  border-right: var(--split-border-width) solid var(--split-border-color);\n}\n.bookingEventBase.fullSplit {\n  border-right: var(--split-border-width) solid var(--split-border-color);\n  border-left: var(--split-border-width) solid var(--split-border-color);\n}\n\n.bookingEventBase.fullSplit.skewedLeft,\n.bookingEventBase.leftSplit.skewedLeft {\n  border-left: 0;\n}\n.bookingEventBase.fullSplit.skewedRight,\n.bookingEventBase.leftSplit.skewedRight {\n  border-right: 0;\n}\n\n.bookingEvent {\n  cursor: pointer;\n}\n\n/* OTA bar width helper */\n.ota-booking-event {\n  border-width: var(--ota-bar-width) !important;\n}\n\n/* Hidden sizing surface (note: fixed missing px) */\n.bookingEventHiddenBase {\n  position: absolute;\n  top: 0;\n  left: -4px;\n  width: calc(100% + 8px);\n}\n\n/* Shared half-tile base for skewed sides */\n.bookingEventBase.skewedLeft::before,\n.bookingEventBase.skewedRight::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 50%;\n  height: 100%;\n  left: -4px;\n  background-color: var(--ir-event-bg);\n  border-radius: 4px;\n}\n\n/* Individual adjustments */\n.bookingEventBase.skewedLeft::before {\n  transform-origin: right;\n  transform: skewX(22deg);\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n.bookingEventBase.fullSplit.skewedLeft::before,\n.bookingEventBase.leftSplit.skewedLeft::before {\n  border-left: var(--split-border-width) solid var(--split-border-color) !important;\n  z-index: 2;\n  background-color: transparent;\n}\n.bookingEventBase.fullSplit.skewedRight::before,\n.bookingEventBase.leftRight.skewedRight::before {\n  border-right: var(--split-border-width) solid var(--split-border-color) !important;\n  z-index: 2;\n  background-color: transparent;\n}\n\n/* .bookingEventBase::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: inherit;\n  background-color: var(--ir-event-bg);\n  transform-origin: left;\n  left: 10px;\n  right: -4px;\n  transform: skewX(22deg);\n  border-radius: inherit;\n} */\n\n.bookingEventBase.skewedRight::before {\n  transform-origin: left;\n  transform: skewX(22deg 0deg);\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n/* Border variant on skewed halves */\n.bookingEventBase.border.skewedLeft::before {\n  border: var(--ota-bar-width) solid #424242;\n  border-right: 0;\n  border-left: 0;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n  top: calc(var(--ota-bar-width) * -1);\n  height: 20px;\n  left: -4px;\n}\n\n.bookingEventBase.border.skewedRight::before {\n  border: var(--ota-bar-width) solid #424242;\n  border-left: 0;\n  border-right: 0;\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n  top: calc(var(--ota-bar-width) * -1);\n  height: 20px;\n  right: -4px;\n}\n\n.bookingEventBase.striped-bar.fullSplit.skewedLeft.vertical::after,\n.bookingEventBase.striped-bar.leftSplit.skewedLeft.vertical::after {\n  z-index: 1;\n  border-left: var(--split-border-width) solid var(--split-border-color);\n}\n.bookingEventBase.striped-bar.fullSplit.skewedRight.vertical::after,\n.bookingEventBase.striped-bar.rightSplit.skewedRight.vertical::after {\n  z-index: 1;\n  border-right: var(--split-border-width) solid var(--split-border-color);\n}\n\n.bookingEventBase.striped-bar.vertical::after {\n  --stripe-angle: 360deg;\n}\n/* Striped overlay */\n.bookingEventBase.striped-bar::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  border-radius: 4px;\n\n  /* clean, seamless repeating tile */\n  background: repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-event-bg) 0,\n    var(--ir-event-bg) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  );\n  backface-visibility: hidden;\n}\n.bookingEventBase.skewedRight.striped-bar::after,\n.bookingEventBase.border.skewedRight::after {\n  right: -8px;\n}\n.bookingEventBase.skewedLeft.striped-bar::after,\n.bookingEventBase.border.skewedLeft::after {\n  left: -8px;\n}\n.bookingEventBase.striped-bar.animated::after {\n  background-size: 28.28px 28.28px;\n  backface-visibility: hidden;\n  animation: stripes 0.8s linear infinite;\n  will-change: background-position;\n}\n\n@keyframes stripes {\n  0% {\n    background-position: 0 0;\n  }\n  100% {\n    background-position: 28.28px 0;\n  }\n}\n.bookingEventDragHandle {\n  position: absolute;\n  top: 0;\n  width: 15px;\n  height: 100%;\n  opacity: 0.1;\n  background-color: rgba(0, 0, 0, 0.15);\n  transform: skewX(-22deg);\n  border-radius: 4px;\n  /* display: none; */\n  cursor: pointer;\n}\n\n:host:hover .bookingEventDragHandle {\n  display: block;\n  opacity: 1;\n}\n\n:host.newEvent:hover .bookingEventDragHandle {\n  display: none;\n  opacity: 1;\n}\n\n.leftSide {\n  left: 0;\n}\n.rightSide {\n  right: 0;\n}\n\n/* cancel skew on side wrappers when needed */\n.leftSide.skewedLeft {\n  transform: skewX(0);\n}\n.rightSide.skewedRight {\n  transform: skewX(0);\n}\n\n.bookingEventTitle {\n  position: relative;\n  top: 2px;\n  left: 5px;\n  max-width: calc(100% - 10px);\n  color: #fff;\n  font-size: 0.8em;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n  cursor: pointer;\n}\n\n.legend_circle {\n  width: 10px;\n  height: 10px;\n  margin: 3px 3px 3px 2px;\n  border: 1px solid #fff;\n  border-radius: 100%;\n}\n\n.noteIcon {\n  position: absolute;\n  bottom: -8px;\n  left: 2px;\n}\n\n.balanceIcon {\n  position: absolute;\n  top: -8px;\n  right: 2px;\n}\n.splitBooking {\n  border-right: 2px solid #000000;\n}\n","import { Component, Element, Event, EventEmitter, Fragment, Host, Listen, Prop, State, h } from '@stencil/core';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { buildSplitIndex, calculateDaysBetweenDates, getSplitRole, transformNewBooking } from '@/utils/booking';\nimport { checkMealPlan, formatAmount, isBlockUnit, SelectOption } from '@/utils/utils';\nimport { IRoomNightsData, CalendarModalEvent } from '@/models/property-types';\nimport moment from 'moment';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport { EventsService } from '@/services/events.service';\nimport locales from '@/stores/locales.store';\nimport { ICountry } from '@/models/IBooking';\nimport calendar_dates from '@/stores/calendar-dates.store';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'igl-booking-event',\n  styleUrl: 'igl-booking-event.css',\n  scoped: true,\n})\nexport class IglBookingEvent {\n  @Element() private element: HTMLElement;\n\n  @Prop() currency;\n  @Prop() is_vacation_rental: boolean = false;\n  @Prop() language: string;\n  @Prop({ mutable: true }) bookingEvent: { [key: string]: any };\n  @Prop() allBookingEvents: { [key: string]: any } = [];\n  @Prop() countries: ICountry[];\n\n  @Event({ bubbles: true, composed: true }) hideBubbleInfo: EventEmitter;\n  @Event() updateEventData: EventEmitter;\n  @Event() dragOverEventData: EventEmitter;\n  @Event() showRoomNightsDialog: EventEmitter<IRoomNightsData>;\n  @Event() showDialog: EventEmitter<CalendarModalEvent>;\n  @Event() resetStretchedBooking: EventEmitter<string>;\n  @Event() toast: EventEmitter<IToast>;\n  @Event() updateBookingEvent: EventEmitter<{ [key: string]: any }>;\n\n  @State() renderElement: boolean = false;\n  @State() position: { [key: string]: any };\n  @State() isShrinking: boolean | null = null;\n\n  private dayWidth: number = 0;\n  private eventSpace: number = 8;\n\n  private vertSpace: number = 10;\n\n  /* show bubble */\n  private showInfoPopup: boolean = false;\n  private bubbleInfoTopSide: boolean = false;\n  private isStretch = false;\n  /*Services */\n  private eventsService = new EventsService();\n  private bookingService = new BookingService();\n  /* Resize props */\n  private resizeSide: string = '';\n  private isDragging: boolean = false;\n  private initialX: number;\n  private initialY: number;\n  private currentX: number;\n  private currentY: number;\n  private initialWidth: number;\n  private initialLeft: number;\n  private finalWidth: number;\n  private dragInitPos: { [key: string]: any };\n  private dragEndPos: { [key: string]: any };\n  elementRect: { [key: string]: any };\n  private isTouchStart: boolean;\n  private moveDifferenceX: number;\n  private moveDifferenceY: number;\n  private animationFrameId: number | null = null;\n\n  private handleMouseMoveBind = this.handleMouseMove.bind(this);\n  private handleMouseUpBind = this.handleMouseUp.bind(this);\n  private handleClickOutsideBind = this.handleClickOutside.bind(this);\n\n  private role: string = '';\n\n  componentWillLoad() {\n    window.addEventListener('click', this.handleClickOutsideBind);\n\n    this.bookingEvent.SPLIT_INDEX = buildSplitIndex(this.bookingEvent.ROOMS);\n    if (this.bookingEvent.SPLIT_INDEX) {\n      this.role = getSplitRole(this.bookingEvent.SPLIT_INDEX, this.bookingEvent.IDENTIFIER) ?? '';\n    }\n  }\n\n  componentDidLoad() {\n    if (this.isNewEvent()) {\n      if (!this.bookingEvent.hideBubble) {\n        /* auto matically open the popup, calling the method shows bubble either top or bottom based on available space. */\n        setTimeout(async () => {\n          if (['003', '002', '004'].includes(this.bookingEvent.STATUS_CODE)) {\n            this.showEventInfo(true);\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\n            await this.fetchAndAssignBookingData();\n          } else {\n            this.showEventInfo(true);\n          }\n          this.renderAgain();\n        }, 1);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener('click', this.handleClickOutsideBind);\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n  }\n\n  @Listen('click', { target: 'window' })\n  handleClickOutside(event: Event) {\n    const clickedElement = event.target as HTMLElement;\n    // Check if the clicked element is not within the target div\n    if (!this.element.contains(clickedElement)) {\n      // The click occurred outside the target div\n      this.showEventInfo(false);\n    }\n  }\n\n  @Listen('hideBubbleInfo', { target: 'window' })\n  hideBubbleInfoPopup(event: CustomEvent) {\n    if (event.detail.currentInfoBubbleId != this.getBookingId() || (event.detail.key === 'hidebubble' && event.detail.currentInfoBubbleId === this.getBookingId())) {\n      this.showInfoPopup = false;\n      this.renderAgain();\n    }\n  }\n\n  @Listen('moveBookingTo', { target: 'window' })\n  async moveBookingToHandler(event: CustomEvent) {\n    try {\n      if (event.detail.bookingId !== this.getBookingId()) {\n        this.showEventInfo(false);\n        return;\n      }\n\n      if (event.detail.moveToDay === 'revert' || event.detail.toRoomId === 'revert') {\n        event.detail.moveToDay = this.bookingEvent.FROM_DATE;\n        event.detail.toRoomId = event.detail.fromRoomId;\n        if (this.isTouchStart && this.moveDifferenceX <= 5 && this.moveDifferenceY <= 5 && !this.isStretch) {\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n            this.showEventInfo(true);\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\n            await this.fetchAndAssignBookingData();\n          }\n        } else {\n          this.animationFrameId = requestAnimationFrame(() => {\n            this.resetBookingToInitialPosition();\n          });\n          return;\n        }\n      } else {\n        if (this.isTouchStart && this.moveDifferenceX <= 5 && this.moveDifferenceY <= 5 && !this.isStretch) {\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n            this.showEventInfo(true);\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\n            await this.fetchAndAssignBookingData();\n          }\n        } else {\n          const { pool, to_date, from_date, toRoomId } = event.detail as any;\n          const previousToDate = moment(to_date, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD');\n          console.log(this.findRoomType(Number(this.bookingEvent.PR_ID)), this.findRoomType(Number(toRoomId)));\n          if (\n            (!moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD').isSame(moment(to_date, 'YYYY-MM-DD'), 'dates') ||\n              this.findRoomType(Number(this.bookingEvent.PR_ID)) !== this.findRoomType(Number(toRoomId))) &&\n            (calendar_dates.disabled_cells.get(`${toRoomId}_${from_date}`)?.disabled ||\n              (calendar_dates.disabled_cells.get(`${toRoomId}_${to_date}`)?.disabled && calendar_dates.disabled_cells.get(`${toRoomId}_${previousToDate}`)?.disabled)) &&\n            !this.isStretch\n          ) {\n            this.reset('This room isnâ€™t available for the entire selected period. Please choose different dates or a different room.');\n          }\n          if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\n            this.reset('Overlapping Dates');\n          }\n          if (pool) {\n            if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n              // let fromDate = moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(moment(new Date(from_date)))\n              //   ? this.bookingEvent.defaultDates.from_date\n              //   : from_date;\n              // console.log('room', fromDate, this.bookingEvent.defaultDates.from_date, from_date);\n              await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date).catch(() => {\n                this.resetBookingToInitialPosition();\n              });\n            } else {\n              if (this.isShrinking || !this.isStretch) {\n                // try {\n                //   if (this.bookingEvent.PR_ID.toString() === toRoomId.toString()) {\n                //     await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date);\n                //     return;\n                //   }\n                // } catch (error) {\n                //   this.resetBookingToInitialPosition();\n                //   return;\n                // }\n                const { description, status, newRatePlans, matchedRatePlan } = this.getModalDescription(toRoomId, from_date, to_date);\n                let hideConfirmButton = false;\n                if (status === '400') {\n                  hideConfirmButton = true;\n                }\n                const oldFromDate = this.bookingEvent.defaultDates.from_date;\n                const oldToDate = this.bookingEvent.defaultDates.to_date;\n                const diffDays = calculateDaysBetweenDates(oldFromDate, oldToDate);\n\n                let shrinkingDirection = null;\n                let fromDate = oldFromDate;\n                let toDate = oldToDate;\n                if (this.isShrinking) {\n                  if (moment(from_date, 'YYYY-MM-DD').isAfter(moment(oldFromDate, 'YYYY-MM-DD')) && moment(to_date, 'YYYY-MM-DD').isBefore(moment(oldToDate, 'YYYY-MM-DD'))) {\n                    fromDate = oldFromDate;\n                    toDate = to_date;\n                  } else {\n                    shrinkingDirection = moment(from_date, 'YYYY-MM-DD').isAfter(moment(oldFromDate, 'YYYY-MM-DD'))\n                      ? 'left'\n                      : moment(to_date, 'YYYY-MM-DD').isBefore(moment(oldToDate, 'YYYY-MM-DD'))\n                      ? 'right'\n                      : null;\n                    if (shrinkingDirection === 'left') {\n                      fromDate = from_date;\n                    }\n\n                    if (shrinkingDirection === 'right') {\n                      toDate = to_date;\n                    }\n                  }\n                } else {\n                  console.log('stretching');\n                  if (moment(from_date, 'YYYY-MM-DD').isBefore(moment(oldFromDate, 'YYYY-MM-DD'))) {\n                    fromDate = from_date;\n                    const newToDate = moment(from_date, 'YYYY-MM-DD').add(diffDays, 'days');\n                    toDate = newToDate.isBefore(moment(to_date, 'YYYY-MM-DD'), 'days') ? to_date : newToDate.format('YYYY-MM-DD');\n                  } else if (moment(to_date, 'YYYY-MM-DD').isAfter(moment(oldToDate, 'YYYY-MM-DD'))) {\n                    toDate = to_date;\n                    fromDate = moment(to_date, 'YYYY-MM-DD').subtract(diffDays, 'days').format('YYYY-MM-DD');\n                  }\n                }\n                console.warn({ fromDate, toDate });\n                this.showDialog.emit({\n                  reason: 'reallocate',\n                  ...event.detail,\n                  description,\n                  title: '',\n                  rateplans: newRatePlans,\n                  matchedRatePlan,\n                  hideConfirmButton,\n                  from_date: fromDate,\n                  to_date: toDate,\n                });\n              } else {\n                // if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\n                //   this.animationFrameId = requestAnimationFrame(() => {\n                //     this.resetBookingToInitialPosition();\n                //   });\n                //   throw new Error('Overlapping Dates');\n                // } else {\n\n                // let stretchDirection: \"left\" | \"right\"\n                const oldFromDate = this.bookingEvent.defaultDates.from_date;\n                const oldToDate = this.bookingEvent.defaultDates.to_date;\n                // const diffDays = calculateDaysBetweenDates(oldFromDate, oldToDate);\n\n                // let fromDate = oldFromDate;\n\n                // if (moment(from_date, 'YYYY-MM-DD').isBefore(moment(oldFromDate, 'YYYY-MM-DD'))) {\n                //   fromDate = from_date;\n                //   const newToDate = moment(from_date, 'YYYY-MM-DD').add(diffDays, 'days');\n                //   toDate = newToDate.isBefore(moment(to_date, 'YYYY-MM-DD'), 'days') ? to_date : newToDate.format('YYYY-MM-DD');\n                // } else if (moment(to_date, 'YYYY-MM-DD').isAfter(moment(oldToDate, 'YYYY-MM-DD'))) {\n                //   toDate = to_date;\n                //   fromDate = moment(to_date, 'YYYY-MM-DD').subtract(diffDays, 'days').format('YYYY-MM-DD');\n                // }\n                const validateDates = (base_date: string, to_date: string) => {\n                  let cursor = base_date;\n                  let counter = 0;\n                  while (cursor !== to_date) {\n                    if (calendar_dates.disabled_cells.get(`${toRoomId}_${cursor}`)?.disabled) {\n                      counter++;\n                    }\n                    cursor = moment(cursor, 'YYYY-MM-DD').add(1, 'days').format('YYYY-MM-DD');\n                  }\n                  if (counter >= 1) {\n                    this.reset(locales.entries.Lcz_ThisUnitIsNotAvailable);\n                  }\n                };\n\n                if (moment(oldToDate, 'YYYY-MM-DD').isBefore(moment(to_date), 'dates')) {\n                  validateDates(oldToDate, to_date);\n                } else if (moment(oldFromDate, 'YYYY-MM-DD').isAfter(moment(from_date, 'YYYY-MM-DD'), 'dates')) {\n                  validateDates(from_date, oldFromDate);\n                }\n                const payload: IRoomNightsData = {\n                  booking: this.bookingEvent,\n                  bookingNumber: this.bookingEvent.BOOKING_NUMBER,\n                  identifier: this.bookingEvent.IDENTIFIER,\n                  to_date,\n                  pool,\n                  from_date,\n                  defaultDates: this.bookingEvent.defaultDates,\n                };\n                if (!this.bookingEvent.is_direct) {\n                  this.showDialog.emit({ reason: 'stretch', ...payload });\n                } else {\n                  this.showRoomNightsDialog.emit(payload);\n                }\n                // }\n              }\n            }\n            this.isShrinking = null;\n          }\n        }\n      }\n    } catch (error) {\n      this.toast.emit({\n        position: 'top-right',\n        title: error.message,\n        description: '',\n        type: 'error',\n      });\n      console.log('something went wrong');\n    }\n  }\n  private buildBarIds() {\n    const bookingId = this.getBookingId();\n    return {\n      bar: `event_${bookingId}`,\n      lateCheckout: `event_late_checkout_${bookingId}`,\n      balance: `event_balance_${bookingId}`,\n    };\n  }\n  private async fetchAndAssignBookingData() {\n    try {\n      console.log('clicked on book#', this.bookingEvent.BOOKING_NUMBER);\n\n      const validStatuses = ['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'];\n      if (!validStatuses.includes(this.bookingEvent.STATUS)) {\n        return;\n      }\n\n      const data = await this.bookingService.getExposedBooking(this.bookingEvent.BOOKING_NUMBER, 'en');\n      const base_booking = { ...data };\n      const filteredRooms = data.rooms.filter(room => room['assigned_units_pool'] === this.bookingEvent.ID);\n\n      if (filteredRooms.length === 0) {\n        throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty array`);\n      }\n\n      if (filteredRooms.some(room => room['assigned_units_pool'] === null)) {\n        throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty pool`);\n      }\n\n      data.rooms = filteredRooms;\n\n      const transformedBooking = transformNewBooking(data)[0];\n      const {\n        ID,\n        TO_DATE,\n        FROM_DATE,\n        NO_OF_DAYS,\n        STATUS,\n        NAME,\n        IDENTIFIER,\n        origin,\n        TOTAL_PRICE,\n        PR_ID,\n        POOL,\n        BOOKING_NUMBER,\n        NOTES,\n        is_direct,\n        BALANCE,\n        channel_booking_nbr,\n        ...otherBookingData\n      } = transformedBooking;\n      this.bookingEvent = {\n        ...otherBookingData,\n        ...this.bookingEvent,\n        channel_booking_nbr,\n        booking: data,\n        base_booking,\n        DEPARTURE_TIME: otherBookingData.DEPARTURE_TIME,\n        PHONE: otherBookingData.PHONE,\n        PHONE_PREFIX: otherBookingData.PHONE_PREFIX,\n        PRIVATE_NOTE: otherBookingData.PRIVATE_NOTE,\n        origin,\n        BALANCE,\n        TOTAL_PRICE,\n        ROOM_INFO: { ...this.bookingEvent.ROOM_INFO, sharing_persons: otherBookingData.ROOM_INFO.sharing_persons },\n      };\n      this.updateBookingEvent.emit(this.bookingEvent);\n      this.showEventInfo(true);\n    } catch (error) {\n      console.error(error.message);\n    }\n  }\n\n  private reset(message: string) {\n    this.animationFrameId = requestAnimationFrame(() => {\n      this.resetBookingToInitialPosition();\n    });\n    throw new Error(message);\n  }\n\n  private findRoomType = (roomId: number) => {\n    let roomType = this.bookingEvent.roomsInfo.filter(room => room.physicalrooms.some(r => r.id === +roomId));\n    if (roomType.length) {\n      return roomType[0].id;\n    }\n    return null;\n  };\n\n  private getModalDescription(\n    toRoomId: number,\n    from_date: string,\n    to_date: string,\n  ): { status: '200' | '400'; description: string; newRatePlans?: SelectOption[]; matchedRatePlan?: SelectOption | null } {\n    if (!this.bookingEvent.is_direct) {\n      if (this.isShrinking) {\n        return {\n          description: locales.entries.Lcz_OTA_Modification_Alter,\n          status: '200',\n        };\n        // return {\n        //   description: `${locales.entries.Lcz_YouWillLoseFutureUpdates}.`,\n        //   status: '200',\n        // };\n      } else {\n        if (\n          moment(from_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.FROM_DATE, 'YYYY-MM-DD')) &&\n          moment(to_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD'))\n        ) {\n          const initialRT = this.findRoomType(this.bookingEvent.PR_ID);\n          const targetRT = this.findRoomType(toRoomId);\n          if (initialRT === targetRT) {\n            return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\n          } else {\n            const mealPlans = checkMealPlan({\n              rateplan_id: this.bookingEvent.RATE_PLAN_ID,\n              roomTypeId: targetRT,\n              roomTypes: calendar_data?.property?.roomtypes,\n            });\n            return {\n              description: locales.entries.Lcz_OTA_Modification_Alter,\n              status: '200',\n              newRatePlans: Array.isArray(mealPlans) ? mealPlans : undefined,\n              matchedRatePlan: Array.isArray(mealPlans) ? null : mealPlans,\n            };\n            // return {\n            //   description: `${locales.entries.Lcz_YouWillLoseFutureUpdates} ${this.bookingEvent.origin ? this.bookingEvent.origin.Label : ''}. ${\n            //     locales.entries.Lcz_SameRatesWillBeKept + '.'\n            //   }`,\n            //   status: '200',\n            // };\n          }\n        }\n        return { description: locales.entries.Lcz_CannotChangeCHBookings + '.', status: '400' };\n      }\n    } else {\n      if (!this.isShrinking) {\n        const initialRT = this.findRoomType(Number(this.bookingEvent.PR_ID));\n        const targetRT = this.findRoomType(Number(toRoomId));\n        if (initialRT === targetRT) {\n          console.log('same rt');\n          if (this.bookingEvent.PR_ID.toString() === toRoomId.toString()) {\n            //TODO add the description\n            return { description: locales.entries.Lcz_ConfrmModiication + '.', status: '200' };\n          }\n          return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\n        } else {\n          const mealPlans = checkMealPlan({\n            rateplan_id: this.bookingEvent.RATE_PLAN_ID,\n            roomTypeId: targetRT,\n            roomTypes: calendar_data?.property?.roomtypes,\n          });\n\n          return {\n            description: locales.entries.Lcz_SameRatesWillBeKept,\n            status: '200',\n            newRatePlans: Array.isArray(mealPlans) ? mealPlans : undefined,\n            matchedRatePlan: Array.isArray(mealPlans) ? null : mealPlans,\n          };\n        }\n      }\n      return { description: locales.entries.Lcz_ConfrmModiication + '.', status: '200' };\n    }\n  }\n\n  private resetBookingToInitialPosition() {\n    if (this.isStretch) {\n      this.element.style.left = `${this.initialLeft}px`;\n      this.element.style.width = `${this.initialWidth}px`;\n      this.isStretch = false;\n      this.finalWidth = this.initialWidth;\n      this.isShrinking = null;\n    } else {\n      this.element.style.top = `${this.dragInitPos.top}px`;\n      this.element.style.left = `${this.dragInitPos.left}px`;\n    }\n  }\n\n  @Listen('revertBooking', { target: 'window' })\n  handleRevertBooking(event: CustomEvent<string>) {\n    if (this.bookingEvent.POOL === event.detail) {\n      this.resetBookingToInitialPosition();\n    }\n  }\n\n  checkIfSlotOccupied(toRoomId, from_date, to_date) {\n    const fromTime = moment(from_date, 'YYYY-MM-DD');\n    const toTime = moment(to_date, 'YYYY-MM-DD');\n    const isOccupied = this.allBookingEvents.some(event => {\n      if (event.POOL === this.bookingEvent.POOL) {\n        return false;\n      }\n      const eventFromTime = moment(event.FROM_DATE, 'YYYY-MM-DD').add(1, 'days');\n      const eventToTime = moment(event.TO_DATE, 'YYYY-MM-DD');\n      return event.PR_ID === +toRoomId && toTime.isSameOrAfter(eventFromTime) && fromTime.isBefore(eventToTime);\n    });\n    return isOccupied;\n  }\n\n  renderAgain() {\n    this.renderElement = !this.renderElement;\n  }\n\n  getUniqueId() {\n    return new Date().getTime();\n  }\n\n  isSplitBooking() {\n    return !!this.bookingEvent.SPLIT_BOOKING;\n  }\n\n  isNewEvent() {\n    return this.getBookingId() === 'NEW_TEMP_EVENT';\n  }\n\n  isHighlightEventType() {\n    return this.getEventType() === 'HIGH_LIGHT';\n  }\n\n  getBookingId() {\n    return this.bookingEvent.ID;\n  }\n\n  getBookingStatus() {\n    return this.bookingEvent.STATUS;\n  }\n\n  getBookedBy() {\n    return this.bookingEvent.NAME;\n  }\n\n  getBookedRoomId() {\n    return this.bookingEvent.PR_ID;\n  }\n\n  getEventStartingDate() {\n    return new Date(this.bookingEvent.FROM_DATE);\n  }\n\n  getEventEndingDate() {\n    return new Date(this.bookingEvent.TO_DATE);\n  }\n\n  getEventType() {\n    return this.bookingEvent.event_type;\n  }\n\n  getEventLegend() {\n    // console.log(this.getBookingStatus());\n    let status = this.bookingEvent?.legendData.statusId[this.getBookingStatus()];\n    let orderRide = this.isNewEvent() ? { color: '#f9f9c9' } : {};\n    return {\n      ...this.bookingEvent?.legendData[status.id],\n      ...status,\n      ...orderRide,\n    };\n  }\n\n  getLegendOfStatus(aStatusId) {\n    // console.log(aStatusId);\n    let status = this.bookingEvent?.legendData.statusId[aStatusId];\n    return { ...this.bookingEvent.legendData[status.id], ...status };\n  }\n\n  getNoteNode() {\n    if (this.bookingEvent.NOTES || this.bookingEvent.INTERNAL_NOTE || this.bookingEvent.PRIVATE_NOTE) {\n      return this.getLegendOfStatus('NOTES');\n    }\n    return null;\n  }\n\n  getBalanceNode() {\n    if (this.bookingEvent.BALANCE !== null && this.bookingEvent.BALANCE >= 1) {\n      return this.getLegendOfStatus('OUTSTANDING-BALANCE');\n    }\n    return null;\n  }\n\n  setStayDays(aStayDays: number) {\n    this.bookingEvent.NO_OF_DAYS = aStayDays;\n    this.renderAgain();\n    // this.updateData({id: this.getBookedRoomId(), data: { NO_OF_DAYS: aStayDays }});\n  }\n\n  getStayDays() {\n    return this.bookingEvent.NO_OF_DAYS;\n  }\n\n  getPosition() {\n    let startingDate = this.getEventStartingDate();\n    let startingCellClass = '.room_' + this.getBookedRoomId() + '_' + startingDate.getDate() + '_' + (startingDate.getMonth() + 1) + '_' + startingDate.getFullYear();\n    let bodyContainer = document.querySelector('.bodyContainer');\n    let startingCell = document.querySelector(startingCellClass);\n    let pos = { top: '0', left: '0', width: '0', height: '20px' };\n    if (startingCell && bodyContainer && startingCell.getBoundingClientRect() && bodyContainer.getBoundingClientRect()) {\n      let bodyContainerRect = bodyContainer.getBoundingClientRect();\n      let boundingRect = startingCell.getBoundingClientRect();\n      this.dayWidth = this.dayWidth || boundingRect.width;\n      pos.top = boundingRect.top + boundingRect.height / 2 - this.vertSpace - bodyContainerRect.top + 'px';\n      // pos.left = boundingRect.left + this.dayWidth / 2 + this.eventSpace / 2 - bodyContainerRect.left + 'px';\n      // pos.width = this.getStayDays() * this.dayWidth - this.eventSpace + 'px';\n      pos.left =\n        boundingRect.left +\n        (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 0 : this.dayWidth / 2) +\n        this.eventSpace / 2 -\n        bodyContainerRect.left +\n        'px';\n      pos.width =\n        (this.getStayDays() + (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 0.5 : 0)) *\n          this.dayWidth -\n        this.eventSpace +\n        'px';\n    } else {\n      console.log(this.bookingEvent);\n      console.log('Locating event cell failed ', startingCellClass);\n    }\n    //console.log(pos);\n    return pos;\n  }\n\n  getNumber(aData) {\n    return aData ? parseFloat(aData) : 0;\n  }\n\n  startDragging(event: any, side: string) {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (this.isNewEvent() || this.isHighlightEventType()) {\n      return null;\n    }\n\n    this.resizeSide = side;\n    this.isDragging = true;\n\n    this.showEventInfo(false);\n    this.isStretch = side !== 'move';\n    if (side === 'move') {\n      this.initialX = event.clientX || event.touches[0].clientX;\n      this.initialY = event.clientY || event.touches[0].clientY;\n      this.elementRect = this.element.getBoundingClientRect();\n      const offsetX = 0;\n      const offsetY = 0;\n      this.dragInitPos = {\n        id: this.getBookingId(),\n        fromRoomId: this.getBookedRoomId(),\n        top: this.getNumber(this.element.style.top) + offsetY,\n        left: this.getNumber(this.element.style.left) + offsetX,\n      };\n      this.dragInitPos.x = this.dragInitPos.left;\n      this.dragInitPos.y = this.dragInitPos.top;\n      this.dragEndPos = { ...this.dragInitPos };\n      this.element.style.top = `${this.dragInitPos.top}px`;\n      this.element.style.left = `${this.dragInitPos.left}px`;\n      this.isTouchStart = true; // !!(event.touches && event.touches.length);\n      this.dragOverEventData.emit({\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\n        data: this.dragInitPos,\n      });\n    } else {\n      this.initialWidth = this.element.offsetWidth;\n      this.initialLeft = this.element.offsetLeft;\n      this.initialX = event.clientX || event.touches[0].clientX;\n      this.dragOverEventData.emit({\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\n        data: {\n          id: this.getBookingId(),\n          fromRoomId: this.getBookedRoomId(),\n          top: this.getNumber(this.element.style.top),\n          left: this.initialLeft,\n          x: this.initialX,\n          y: event.clientY || event.touches[0].clientY,\n        },\n      });\n    }\n\n    document.addEventListener('mousemove', this.handleMouseMoveBind);\n    document.addEventListener('touchmove', this.handleMouseMoveBind);\n    document.addEventListener('pointermove', this.handleMouseMoveBind);\n\n    document.addEventListener('mouseup', this.handleMouseUpBind);\n    document.addEventListener('touchup', this.handleMouseUpBind);\n    document.addEventListener('pointerup', this.handleMouseUpBind);\n  }\n\n  handleMouseMove(event: any) {\n    if (this.isDragging) {\n      this.currentX = event.clientX || event.touches[0].clientX;\n      let distanceX = this.currentX - this.initialX;\n      if (this.resizeSide === 'move') {\n        this.currentY = event.clientY || event.touches[0].clientY;\n        let distanceY = this.currentY - this.initialY;\n        this.element.style.top = `${this.dragInitPos.top + distanceY}px`;\n        this.element.style.left = `${this.dragInitPos.left + distanceX}px`;\n        this.dragEndPos = {\n          id: this.getBookingId(),\n          fromRoomId: this.getBookedRoomId(),\n          top: this.dragInitPos.top + distanceY,\n          left: this.dragInitPos.left + distanceX,\n        };\n        this.dragEndPos.x = this.dragEndPos.left; // + 18;\n        this.dragEndPos.y = this.dragEndPos.top; // + (this.elementRect.height/2);\n        this.dragOverEventData.emit({ id: 'DRAG_OVER', data: this.dragEndPos });\n      } else {\n        // if (this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n        //   return;\n        // }\n        if (this.role === 'fullSplit') {\n          return;\n        }\n        const baseCondition = !this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE);\n        let newWidth = this.initialWidth;\n        if (this.resizeSide == 'rightSide') {\n          newWidth = this.initialWidth + distanceX;\n          newWidth = Math.min(newWidth, this.initialX + this.element.offsetWidth);\n          newWidth = Math.max(this.dayWidth - this.eventSpace, newWidth);\n          this.isShrinking = distanceX < 0;\n          if (!this.isShrinking && baseCondition) {\n            return;\n          }\n          if (this.role === 'rightSplit') {\n            return;\n          }\n          this.element.style.width = `${newWidth}px`;\n        } else if (this.resizeSide == 'leftSide') {\n          this.isShrinking = distanceX > 0;\n          if (!this.isShrinking && baseCondition) {\n            return;\n          }\n          if (this.role === 'leftSplit') {\n            return;\n          }\n          newWidth = Math.max(this.dayWidth - this.eventSpace, this.initialWidth - distanceX);\n          let newLeft = this.initialLeft + (this.initialWidth - newWidth);\n          this.element.style.left = `${newLeft}px`;\n          this.element.style.width = `${newWidth}px`;\n        }\n        this.finalWidth = newWidth;\n      }\n    } else {\n      console.log('still mouse move listening...');\n    }\n  }\n\n  handleMouseUp() {\n    if (this.isDragging) {\n      if (this.resizeSide === 'move') {\n        // console.log(\"Initial X::\"+this.dragInitPos.x);\n        // console.log(\"Initial Y::\"+this.dragInitPos.y);\n        // console.log(\"End X::\"+this.dragEndPos.x);\n        // console.log(\"End Y::\"+this.dragEndPos.y);\n        if (this.isTouchStart) {\n          this.moveDifferenceX = Math.abs(this.dragEndPos.x - this.dragInitPos.x);\n          this.moveDifferenceY = Math.abs(this.dragEndPos.y - this.dragInitPos.y);\n        }\n        this.dragOverEventData.emit({\n          id: 'DRAG_OVER_END',\n          data: {\n            ...this.dragEndPos,\n            pool: this.bookingEvent.POOL,\n            nbOfDays: this.bookingEvent.NO_OF_DAYS,\n          },\n        });\n      } else {\n        const finalWidth =\n          this.finalWidth -\n          (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? this.dayWidth / 2 : 0);\n        const numberOfDays = Math.round(finalWidth / this.dayWidth);\n        console.log(finalWidth, this.dayWidth, numberOfDays);\n        let initialStayDays = this.getStayDays();\n        if (initialStayDays != numberOfDays && !isNaN(numberOfDays)) {\n          //this.setStayDays(numberOfDays);\n          if (this.resizeSide == 'leftSide') {\n            this.element.style.left = `${this.initialLeft + (initialStayDays - numberOfDays) * this.dayWidth}px`;\n            // set FROM_DATE = TO_DATE - numberOfDays\n          } else {\n            if (numberOfDays < initialStayDays) {\n              this.isShrinking = true;\n            }\n            // set TO_DATE = FROM_DATE + numberOfDays\n          }\n          // const nbrOfDays =\n          // !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? numberOfDays - 1 : numberOfDays;\n          this.dragOverEventData.emit({\n            id: 'STRETCH_OVER_END',\n            data: {\n              id: this.getBookingId(),\n              fromRoomId: +this.getBookedRoomId(),\n              x: +this.element.style.left.replace('px', ''),\n              y: +this.element.style.top.replace('px', ''),\n              pool: this.bookingEvent.POOL,\n              nbOfDays: numberOfDays,\n            },\n          });\n          const offset = !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? +this.dayWidth / 2 : 0;\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace + offset}px`;\n        } else {\n          this.element.style.left = `${this.initialLeft}px`;\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace}px`;\n        }\n      }\n    } else {\n      console.log('still mouse up listening...');\n    }\n    this.isDragging = false;\n\n    document.removeEventListener('mousemove', this.handleMouseMoveBind);\n    document.removeEventListener('touchmove', this.handleMouseMoveBind);\n    document.removeEventListener('pointermove', this.handleMouseMoveBind);\n\n    document.removeEventListener('mouseup', this.handleMouseUpBind);\n    document.removeEventListener('touchup', this.handleMouseUpBind);\n    document.removeEventListener('pointerup', this.handleMouseUpBind);\n  }\n\n  updateData(data: any) {\n    this.updateEventData.emit(data);\n  }\n  private calculateHoverPosition() {\n    const barRect = this.element.getBoundingClientRect();\n    const barWidth = barRect.width;\n    const barLeft = barRect.left;\n    const screenWidth = window.innerWidth;\n\n    let hoverLeft;\n\n    if (barWidth <= screenWidth) {\n      hoverLeft = barWidth / 2;\n    } else {\n      hoverLeft = screenWidth / 2 - barLeft;\n    }\n    return {\n      position: 'absolute',\n      left: `${hoverLeft}px`,\n      transform: 'translateX(-50%)',\n    };\n  }\n  renderEventBookingNumber() {\n    if (this.bookingEvent.STATUS === 'TEMP-EVENT' || this.bookingEvent.ID === 'NEW_TEMP_EVENT') {\n      return '';\n    }\n    if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n      return '';\n    }\n    if (!this.bookingEvent.is_direct) {\n      return ` - ${this.bookingEvent.channel_booking_nbr}`;\n    }\n    return ` - ${this.bookingEvent.BOOKING_NUMBER}`;\n  }\n  showEventInfo(showInfo) {\n    // if (this.isHighlightEventType() || this.bookingEvent.hideBubble) {\n    //   return null;\n    // }\n\n    // if (showInfo) {\n    //   // Calculate which side we need to show the bubble, top side or bottom.\n    //   let bodyContainer = document.querySelector('.calendarScrollContainer');\n    //   let bodyContainerRect: { [key: string]: any } = bodyContainer.getBoundingClientRect();\n    //   let elementRect: { [key: string]: any } = this.element.getBoundingClientRect();\n    //   let midPoint = bodyContainerRect.height / 2 + bodyContainerRect.top + 50;\n    //   // let topDifference = elementRect.top - bodyContainerRect.top;\n    //   // let bottomDifference = bodyContainerRect.bottom - elementRect.bottom;\n\n    //   if (elementRect.top < midPoint) {\n    //     this.bubbleInfoTopSide = false;\n    //   } else {\n    //     this.bubbleInfoTopSide = true;\n    //   }\n    // }\n\n    // // showInfo = true;\n    // if (showInfo) {\n    //   this.hideBubbleInfo.emit({\n    //     key: 'hidePopup',\n    //     currentInfoBubbleId: this.getBookingId(),\n    //   });\n    // }\n    // this.showInfoPopup = showInfo;\n    // this.renderAgain();\n    if (this.isHighlightEventType() || this.bookingEvent.hideBubble) {\n      return null;\n    }\n\n    if (showInfo) {\n      // Calculate which side we need to show the bubble, top side or bottom.\n      let bodyContainer = document.querySelector('.calendarScrollContainer');\n      let bodyContainerRect: { [key: string]: any } = bodyContainer.getBoundingClientRect();\n      let elementRect: { [key: string]: any } = this.element.getBoundingClientRect();\n      let midPoint = bodyContainerRect.height / 2 + bodyContainerRect.top + 50;\n\n      if (elementRect.top < midPoint) {\n        this.bubbleInfoTopSide = false;\n      } else {\n        this.bubbleInfoTopSide = true;\n      }\n    }\n\n    if (showInfo) {\n      this.hideBubbleInfo.emit({\n        key: 'hidePopup',\n        currentInfoBubbleId: this.getBookingId(),\n      });\n    }\n    this.showInfoPopup = showInfo;\n    this.renderAgain();\n  }\n  //   /**\n  //    * Checks if the booking's departure time is later than the hotel's configured check-out time.\n  //    *\n  //    * @returns {boolean} `true` if departure is after `check_out_till`, otherwise `false`.\n  //    */\n  private isDepartureAfterHotelCheckout(): boolean {\n    if (calendar_data.property.is_automatic_check_in_out) {\n      return;\n    }\n    const departureTime = this.bookingEvent.DEPARTURE_TIME;\n    if (!departureTime?.code) {\n      return false;\n    }\n    const t1 = moment(calendar_data.property.time_constraints.check_out_till, 'HH:mm');\n    const t2 = moment(departureTime.description, 'HH:mm');\n    return t1.isBefore(t2);\n  }\n  private computeSplitRole() {\n    const SPLIT_INDEX = buildSplitIndex(this.bookingEvent.ROOMS);\n    let splitRole = null;\n    if (SPLIT_INDEX) {\n      splitRole = getSplitRole(SPLIT_INDEX, this.bookingEvent.IDENTIFIER) ?? '';\n    }\n    return splitRole;\n  }\n  render() {\n    // onMouseLeave={()=>this.showEventInfo(false)}\n    let legend = this.getEventLegend();\n\n    let noteNode = this.getNoteNode();\n    let balanceNode = this.getBalanceNode();\n    const { balance, bar, lateCheckout } = this.buildBarIds();\n    let backgroundColor = this.bookingEvent.ROOM_INFO?.calendar_extra ? this.bookingEvent.ROOM_INFO.calendar_extra?.booking_color?.color ?? legend.color : legend.color;\n\n    const { foreground, stripe } = calendar_data.colorsForegrounds?.[backgroundColor] ?? {\n      foreground: '',\n      checkout: '',\n    };\n    const isDepartureAfterHotelCheckout = this.isDepartureAfterHotelCheckout();\n    backgroundColor = this.bookingEvent.STATUS === 'CHECKED-OUT' ? legend.color : backgroundColor;\n    const splitRole = this.computeSplitRole();\n    return (\n      <Host class={`bookingEvent  ${this.isNewEvent() || this.isHighlightEventType() ? 'newEvent' : ''} ${legend.clsName} `} style={this.getPosition()} id={bar}>\n        <div\n          class={{\n            'bookingEventBase': true,\n            'skewedLeft': !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)),\n            'skewedRight': !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)),\n            'striped-bar vertical': this.bookingEvent.STATUS === 'IN-HOUSE',\n            'striped-bar animated': isBlockUnit(this.bookingEvent.STATUS_CODE) && this.bookingEvent.STATUS_CODE === '003',\n            'border border-dark ota-booking-event':\n              !this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE) && this.bookingEvent.STATUS !== 'TEMP-EVENT' && this.bookingEvent.ID !== 'NEW_TEMP_EVENT',\n            [splitRole]: true,\n          }}\n          style={{\n            'backgroundColor': backgroundColor,\n            '--ir-event-bg': backgroundColor,\n            '--ir-event-bg-stripe-color': stripe,\n          }}\n          onTouchStart={event => this.startDragging(event, 'move')}\n          onMouseDown={event => this.startDragging(event, 'move')}\n        ></div>\n        {isDepartureAfterHotelCheckout && <wa-tooltip for={lateCheckout}>Departure time: {this.bookingEvent.DEPARTURE_TIME?.description}</wa-tooltip>}\n        {balanceNode && <wa-tooltip for={balance}>Balance: {formatAmount(calendar_data.property.currency.symbol, this.bookingEvent.BALANCE)}</wa-tooltip>}\n        {noteNode ? <div class=\"legend_circle noteIcon\" style={{ backgroundColor: noteNode.color }}></div> : null}\n        {(balanceNode || isDepartureAfterHotelCheckout) && (\n          <div class=\"balanceIcon d-flex\">\n            {isDepartureAfterHotelCheckout && <div id={lateCheckout} class=\"legend_circle\" style={{ backgroundColor: '#999999' }}></div>}\n            {balanceNode ? <div id={balance} class=\"legend_circle\" style={{ backgroundColor: '#f34752' }}></div> : null}\n          </div>\n        )}\n        {/* onMouseOver={() => this.showEventInfo(true)}  */}\n        <div\n          class=\"bookingEventTitle\"\n          style={{ color: foreground }}\n          onTouchStart={event => this.startDragging(event, 'move')}\n          onMouseDown={event => this.startDragging(event, 'move')}\n        >\n          {this.getBookedBy()}\n          {this.renderEventBookingNumber()}\n        </div>\n\n        {/* {(this.bookingEvent.is_direct || isBlockUnit(this.bookingEvent.STATUS_CODE)) && ( */}\n        <Fragment>\n          <div\n            class={`bookingEventDragHandle leftSide ${\n              !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\n            }\n            ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}`}\n            onTouchStart={event => this.startDragging(event, 'leftSide')}\n            onMouseDown={event => this.startDragging(event, 'leftSide')}\n          ></div>\n          <div\n            class={`bookingEventDragHandle rightSide ${\n              !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\n            }\n              ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}`}\n            onTouchStart={event => this.startDragging(event, 'rightSide')}\n            onMouseDown={event => this.startDragging(event, 'rightSide')}\n          ></div>\n        </Fragment>\n        {/* )} */}\n\n        {this.showInfoPopup ? (\n          <igl-booking-event-hover\n            is_vacation_rental={this.is_vacation_rental}\n            countries={this.countries}\n            currency={this.currency}\n            class=\"top\"\n            bookingEvent={this.bookingEvent}\n            bubbleInfoTop={this.bubbleInfoTopSide}\n            style={this.calculateHoverPosition()}\n          ></igl-booking-event-hover>\n        ) : null}\n      </Host>\n    );\n  }\n}\n","export class ReloadInterceptor {\n  private isActive = false;\n  private readonly onIntercept: () => void;\n\n  /**\n   * @param onIntercept\n   *   Called whenever a reload is intercepted (F5/Ctrl+R or beforeunload).\n   * @param autoActivate\n   *   If true, will immediately attach listeners.\n   */\n  constructor(options: { onIntercept?: () => void; autoActivate: boolean }) {\n    this.onIntercept = options.onIntercept ?? (() => {});\n    if (options.autoActivate) {\n      this.activate();\n    }\n  }\n\n  /** Begin intercepting reloads & navigations */\n  public activate(): void {\n    if (this.isActive) return;\n    window.addEventListener('beforeunload', this.handleBeforeUnload, { capture: true });\n    this.isActive = true;\n  }\n\n  /** Stop intercepting reloads & navigations */\n  public deactivate(): void {\n    if (!this.isActive) return;\n    window.removeEventListener('beforeunload', this.handleBeforeUnload, { capture: true });\n    this.isActive = false;\n  }\n\n  /** Native â€œAre you sure you want to leave?â€ dialog */\n  private handleBeforeUnload = (e: BeforeUnloadEvent): void => {\n    this.onIntercept();\n    e.preventDefault();\n    e.returnValue = '';\n  };\n}\n",":host {\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 0%;\n  height: 100%;\n}\n.bulk-sheet-container {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  gap: 1rem;\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.physical-room {\n  margin-left: 1rem !important;\n  padding-top: 0.5rem;\n}\n/* target only the last <td> in each .physical-room row */\n.physical-room > td:last-child {\n  padding-left: 1rem; /* or whatever indent you like */\n}\n.room-type-list {\n  padding: 0;\n  margin: 0;\n}\n\n.room-type-list > li,\n.physical-room,\n.room-type-row {\n  list-style: none;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { BookingService } from '@/services/booking-service/booking.service';\nimport calendar_data from '@/stores/calendar-data';\nimport { ReloadInterceptor } from '@/utils/ReloadInterceptor';\nimport { Component, Event, EventEmitter, Fragment, h, Prop, State } from '@stencil/core';\nimport moment, { Moment } from 'moment';\nimport { z, ZodError } from 'zod';\nimport { IToast } from '@components/ui/ir-toast/toast';\n// import calendar_dates from '@/stores/calendar-dates.store';\nimport locales from '@/stores/locales.store';\nexport type RoomStatus = 'open' | 'closed';\nexport type SelectedRooms = {\n  id: string | number;\n  result: RoomStatus;\n};\n\n@Component({\n  tag: 'igl-bulk-block',\n  styleUrls: ['igl-bulk-block.css', '../../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglBulkBlock {\n  @Prop() maxDatesLength = 8;\n  @Prop() property_id: number;\n\n  @State() selectedRoomTypes: Map<string | number, SelectedRooms[]> = new Map();\n  @State() selectedUnit: {\n    roomtype_id: number;\n    unit_id: number;\n  } | null = null;\n  @State() errors: 'dates' | 'rooms';\n  @State() isLoading: boolean;\n  @State() blockState: 'block' | 'unblock' = 'block';\n  @State() dates: {\n    from: Moment | null;\n    to: Moment | null;\n  }[] = [{ from: null, to: null }];\n\n  @Event() closeModal: EventEmitter<null>;\n  @Event() toast: EventEmitter<IToast>;\n\n  private sidebar: HTMLIrSidebarElement;\n  private dateRefs: { from?: HTMLIrDatePickerElement; to?: HTMLIrDatePickerElement }[] = [];\n  private reloadInterceptor: ReloadInterceptor;\n  private minDate = moment().format('YYYY-MM-DD');\n  private bookingService = new BookingService();\n\n  private datesSchema = z.array(\n    z.object({\n      from: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'from' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n      to: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'to' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n    }),\n  );\n\n  private unitSections: HTMLUListElement;\n  private datesSections: HTMLTableElement;\n\n  componentDidLoad() {\n    this.reloadInterceptor = new ReloadInterceptor({ autoActivate: false });\n    this.sidebar = document.querySelector('ir-sidebar') as HTMLIrSidebarElement;\n  }\n\n  disconnectedCallback() {\n    this.reloadInterceptor.deactivate();\n  }\n\n  private async addBlockDates() {\n    try {\n      this.errors = null;\n      this.isLoading = true;\n      const periods = this.datesSchema.parse(this.dates);\n      if (!this.selectedUnit) {\n        this.unitSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'rooms';\n        return;\n      }\n      if (this.blockState === 'block') {\n        await this.bookingService.blockAvailabilityForBrackets({\n          unit_id: this.selectedUnit?.unit_id,\n          description: '',\n          property_id: calendar_data.property.id,\n          block_status_code: '002',\n          brackets: periods.map(p => ({\n            from_date: p.from,\n            to_date: p.to,\n          })),\n        });\n      } else {\n        await this.bookingService.unBlockUnitByPeriod({\n          unit_id: this.selectedUnit?.unit_id,\n          from_date: periods[0].from,\n          to_date: periods[0].to,\n        });\n      }\n      this.activate();\n      this.deactivate();\n      this.toast.emit({\n        type: 'success',\n        title: locales.entries.Lcz_RequestSubmittedSuccessfully,\n        description: '',\n      });\n      this.isLoading = false;\n      this.closeModal.emit();\n    } catch (error) {\n      console.log(error);\n      if (error instanceof ZodError) {\n        this.datesSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'dates';\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private activate() {\n    this.reloadInterceptor.activate();\n    if (this.sidebar) this.sidebar.preventClose = true;\n  }\n\n  private deactivate() {\n    this.reloadInterceptor.deactivate();\n    if (this.sidebar) this.sidebar.preventClose = false;\n  }\n\n  private handleDateChange({ index, date, key }: { index: number; date: Moment; key: 'from' | 'to' }) {\n    // 1) clone and set the new date\n    const dates = [...this.dates];\n    dates[index] = { ...dates[index], [key]: date };\n\n    // 1a) if they just changed the \"from\", always clear that row's \"to\"\n    if (key === 'from' && dates[index].to?.isBefore(date, 'dates')) {\n      dates[index].to = null;\n    }\n\n    // 2) clear any subsequent rows whose \"from\" is on or before the changed date\n    for (let i = index + 1; i < dates.length; i++) {\n      const rowFrom = dates[i]?.from;\n      if (rowFrom && rowFrom.isSameOrBefore(date, 'day')) {\n        dates[i] = { from: null, to: null };\n      }\n    }\n\n    // 3) commit\n    this.dates = dates;\n\n    // 4) open the appropriate picker\n    setTimeout(() => {\n      if (key === 'from') {\n        this.dateRefs[index]?.to.openDatePicker();\n      } else {\n        const nextFrom = dates.findIndex(d => d.from === null);\n        if (nextFrom > -1) {\n          this.dateRefs[nextFrom]?.from.openDatePicker();\n        }\n      }\n    }, 100);\n  }\n\n  private addDateRow() {\n    const last_dates = this.dates[this.dates.length - 1];\n    if (!last_dates.from || !last_dates.to) {\n      this.errors = 'dates';\n      return;\n    }\n    this.errors = null;\n    this.dates = [...this.dates, { from: null, to: null }];\n    setTimeout(() => {\n      this.dateRefs[this.dates.length - 1].to?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 100);\n  }\n\n  render() {\n    return (\n      <form\n        class={'bulk-sheet-container'}\n        onSubmit={e => {\n          e.preventDefault();\n          this.addBlockDates();\n        }}\n      >\n        <div class=\"sheet-body px-1\">\n          <div class=\"text-muted text-left pt-0 my-0 d-flex align-items-center pb-1\" style={{ gap: '0.5rem' }}>\n            <p class=\"m-0 p-0\">Select the unit to</p>\n            <ir-select\n              showFirstOption={false}\n              selectedValue={this.blockState}\n              data={[\n                { text: 'Block', value: 'block' },\n                { text: 'Unblock', value: 'unblock' },\n              ]}\n              onSelectChange={e => {\n                this.blockState = e.detail;\n              }}\n            ></ir-select>\n          </div>\n          <div>\n            {this.errors === 'rooms' && (\n              <p class={'text-danger text-left smaller p-0 '} style={{ 'margin-bottom': '0.5rem' }}>\n                {calendar_data.is_vacation_rental ? locales.entries.Lcz_PlzSelectOneListing : locales.entries.Lcz_PlzSelectOneUnit}\n              </p>\n            )}\n            <ul class=\"room-type-list\" ref={el => (this.unitSections = el)}>\n              {calendar_data.roomsInfo.map(roomType => {\n                return (\n                  <Fragment>\n                    <li key={`roomTypeRow-${roomType.id}`} class={`room-type-row`}>\n                      <div class={'d-flex choice-row'}>\n                        <span class=\"pl-1 text-left room-type-name\">{roomType.name}</span>\n                      </div>\n                    </li>\n                    {roomType.physicalrooms.map((room, j) => {\n                      const row_style = j === roomType.physicalrooms.length - 1 ? 'pb-1' : '';\n                      return (\n                        <li key={`physicalRoom-${room.id}-${j}`} class={`physical-room ${row_style}`}>\n                          <div class={'d-flex choice-row'}>\n                            <ir-radio\n                              class=\"pl-1 \"\n                              name=\"unit\"\n                              checked={this.selectedUnit?.unit_id === room.id}\n                              onCheckChange={() =>\n                                (this.selectedUnit = {\n                                  roomtype_id: roomType.id,\n                                  unit_id: room.id,\n                                })\n                              }\n                              label={room.name}\n                            ></ir-radio>\n                          </div>\n                        </li>\n                      );\n                    })}\n                  </Fragment>\n                );\n              })}\n            </ul>\n          </div>\n          {/* Dates */}\n          <table class=\"mt-1\" ref={el => (this.datesSections = el)}>\n            <thead>\n              <tr>\n                <th class=\"text-left\">{locales.entries.Lcz_From}</th>\n                <th class=\"text-left\">{locales.entries.Lcz_ToExclusive}</th>\n                <td>\n                  {this.dates.length !== this.maxDatesLength && this.blockState === 'block' && (\n                    <ir-button\n                      variant=\"icon\"\n                      icon_name=\"plus\"\n                      onClickHandler={() => {\n                        this.addDateRow();\n                      }}\n                    ></ir-button>\n                  )}\n                </td>\n              </tr>\n            </thead>\n            <tbody>\n              {this.dates.map((d, i) => {\n                if (!this.dateRefs[i]) {\n                  this.dateRefs[i] = {};\n                }\n                const fromDateMinDate = i > 0 ? this.dates[i - 1]?.to.clone().add(1, 'days')?.format('YYYY-MM-DD') ?? this.minDate : this.minDate;\n                const toDateMinDate = this.dates[i].from ? this.dates[i]?.from.clone().add(1, 'days')?.format('YYYY-MM-DD') : this.minDate;\n                return (\n                  <tr key={`date_${i}`}>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        ref={el => {\n                          this.dateRefs[i].from = el;\n                        }}\n                        forceDestroyOnUpdate\n                        minDate={fromDateMinDate}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.from?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        aria-invalid={String(this.errors === 'dates' && !d.from)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'from' });\n                        }}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          if (i === 0) {\n                            return;\n                          }\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.from ? d.from.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm ${this.errors === 'dates' && !d.to ? 'border-danger' : ''} text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        forceDestroyOnUpdate\n                        ref={el => {\n                          this.dateRefs[i].to = el;\n                        }}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.to?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        minDate={toDateMinDate}\n                        aria-invalid={String(this.errors === 'dates' && !d.to)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'to' });\n                        }}\n                        maxDate={d.from ? moment(d.from).add(3, 'months').format('YYYY-MM-DD') : undefined}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from?.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.to ? d.to.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm \n                          ${this.errors === 'dates' && !d.to ? 'border-danger' : ''}\n                          text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    {i > 0 && (\n                      <td class=\"pb-1\">\n                        <ir-button\n                          variant=\"icon\"\n                          icon_name=\"minus\"\n                          onClickHandler={() => {\n                            this.dates = this.dates.filter((_, j) => j !== i);\n                          }}\n                        ></ir-button>\n                      </td>\n                    )}\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n        <div class={'sheet-footer'}>\n          <ir-button text={locales.entries.Lcz_Cancel} btn_color=\"secondary\" class={'flex-fill'} onClickHandler={() => this.closeModal.emit(null)}></ir-button>\n          <ir-button isLoading={this.isLoading} text={locales.entries.Lcz_Confirm} btn_type=\"submit\" class=\"flex-fill\"></ir-button>\n        </div>\n      </form>\n    );\n  }\n}\n",".bulk-operations-sheet-container {\n  display: flex;\n  flex-direction: column;\n  height: auto !important;\n  min-height: 100vh;\n  background: white !important;\n  /* gap: 1rem; */\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.tabs {\n  position: sticky;\n  top: var(--ir-tabs-top, 54px);\n  background-color: white;\n  z-index: 9999999;\n  padding-top: 1rem;\n  margin-bottom: 1rem;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { Tab } from '@/components/ui/ir-tabs/ir-tabs';\nimport { IrToast } from '@/components/ui/ir-toast/ir-toast';\nimport { Component, Event, EventEmitter, Prop, State, h } from '@stencil/core';\n\n@Component({\n  tag: 'igl-bulk-operations',\n  styleUrls: ['igl-bulk-operations.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglBulkOperations {\n  @Prop() maxDatesLength = 8;\n  @Prop() property_id: number;\n\n  @Event() closeModal: EventEmitter<null>;\n  @Event() toast: EventEmitter<IrToast>;\n\n  @State() selectedTab: Tab;\n\n  private tabs = [\n    {\n      id: 'stop-sale',\n      label: 'Stop/Open Sale',\n    },\n    {\n      id: 'block',\n      label: 'Block Unit',\n    },\n  ];\n\n  private tabsEl: HTMLIrTabsElement;\n  private titleEl: HTMLIrTitleElement;\n\n  componentDidLoad() {\n    this.tabsEl.style.setProperty('--ir-tabs-top', this.titleEl?.getBoundingClientRect()?.height?.toString() + 'px');\n  }\n\n  render() {\n    return (\n      <div class={'bulk-operations-sheet-container'}>\n        <div class=\"sheet-header d-flex align-items-center\">\n          <ir-title\n            ref={el => (this.titleEl = el)}\n            onCloseSideBar={e => {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              // if (this.isLoading) {\n              //   return;\n              // }\n              this.closeModal.emit(null);\n            }}\n            class=\"px-1 mb-0\"\n            // label={locales.entries.Lcz_BulkStopOpenSale}\n            label={'Bulk Operations'}\n            displayContext=\"sidebar\"\n          ></ir-title>\n        </div>\n        <ir-tabs ref={el => (this.tabsEl = el)} class=\"tabs\" tabs={this.tabs} onTabChanged={e => (this.selectedTab = e.detail)}></ir-tabs>\n        {this.selectedTab?.id === 'stop-sale' ? (\n          <igl-bulk-stop-sale maxDatesLength={this.maxDatesLength} property_id={this.property_id}></igl-bulk-stop-sale>\n        ) : (\n          <igl-bulk-block maxDatesLength={this.maxDatesLength} property_id={this.property_id}></igl-bulk-block>\n        )}\n      </div>\n    );\n  }\n}\n",":host {\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 0%;\n  height: 100%;\n}\n.bulk-sheet-container {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  gap: 1rem;\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.days-checkbox {\n  gap: 0.5rem;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { BookingService } from '@/services/booking-service/booking.service';\nimport calendar_data from '@/stores/calendar-data';\nimport { ReloadInterceptor } from '@/utils/ReloadInterceptor';\nimport { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\nimport moment, { Moment } from 'moment';\nimport { z, ZodError } from 'zod';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport calendar_dates from '@/stores/calendar-dates.store';\nimport locales from '@/stores/locales.store';\nexport type SelectedRooms = { id: string | number; result: 'open' | 'closed' };\n\n@Component({\n  tag: 'igl-bulk-stop-sale',\n  styleUrls: ['igl-bulk-stop-sale.css', '../../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglBulkStopSale {\n  @Prop() maxDatesLength = 8;\n  @Prop() property_id: number;\n\n  @State() selectedRoomTypes: SelectedRooms[] = [];\n  @State() errors: 'dates' | 'rooms' | 'weekdays';\n  @State() isLoading: boolean;\n  @State() dates: {\n    from: Moment | null;\n    to: Moment | null;\n  }[] = [{ from: null, to: null }];\n\n  @State() selectedWeekdays: Set<number> = new Set(\n    Array(7)\n      .fill(null)\n      .map((_, i) => i),\n  );\n\n  @Event() closeModal: EventEmitter<null>;\n  @Event() toast: EventEmitter<IToast>;\n\n  private sidebar: HTMLIrSidebarElement;\n  private dateRefs: { from?: HTMLIrDatePickerElement; to?: HTMLIrDatePickerElement }[] = [];\n  // private allRoomTypes: SelectedRooms[] = [];\n  private reloadInterceptor: ReloadInterceptor;\n  private minDate = moment().format('YYYY-MM-DD');\n  private bookingService = new BookingService();\n  private getDayIndex(dateStr: string): number {\n    return moment(dateStr, 'YYYY-MM-DD').day();\n  }\n  private datesSchema = z.array(\n    z.object({\n      from: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'from' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n      to: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'to' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n    }),\n  );\n\n  //sections\n  private unitSections: HTMLTableElement;\n  private weekdaysSections: HTMLIrWeekdaySelectorElement;\n  private datesSections: HTMLTableElement;\n\n  componentDidLoad() {\n    this.reloadInterceptor = new ReloadInterceptor({ autoActivate: false });\n    this.sidebar = document.querySelector('ir-sidebar') as HTMLIrSidebarElement;\n  }\n\n  disconnectedCallback() {\n    this.reloadInterceptor.deactivate();\n  }\n\n  // @Listen('beforeSidebarClose', { target: 'body' })\n  // handleBeforeSidebarClose(e: CustomEvent) {\n  //   e.stopImmediatePropagation();\n  //   e.stopPropagation();\n  //   if (window.confirm('Do you really want to proceed?')) {\n  //     this.deactivate();\n  //     this.sidebar.toggleSidebar();\n  //   }\n  // }\n\n  private async addBlockDates() {\n    const generatePeriodsToModify = periods => {\n      const p = [];\n      for (const period of periods) {\n        let current = period.from;\n        const lastDay = moment(period.to, 'YYYY-MM-DD').add(1, 'days').format('YYYY-MM-DD');\n        while (current !== lastDay) {\n          const nextDay = moment(current, 'YYYY-MM-DD').add(1, 'days').format('YYYY-MM-DD');\n          if (!this.selectedWeekdays.has(this.getDayIndex(current))) {\n            current = nextDay;\n            continue;\n          }\n          for (const selectedRoom of this.selectedRoomTypes) {\n            p.push({\n              room_type_id: selectedRoom.id,\n              night: current,\n            });\n          }\n          current = nextDay;\n        }\n      }\n      return p;\n    };\n    const updateCalendarCells = (\n      payloads: {\n        is_closed: boolean;\n        restrictions: {\n          night: string;\n          room_type_id: number;\n        }[];\n      }[],\n    ) => {\n      const prevDisabledCells = new Map(calendar_dates.disabled_cells);\n\n      // Caches\n      const roomsInfoById = new Map(calendar_data.roomsInfo.map((rt, i) => [rt.id, { roomType: rt, index: i }]));\n      const dayIndexByValue = new Map(calendar_dates.days.map((day, i) => [day.value, i]));\n      const rateByRoomTypeAndDate = new Map<string, any>();\n\n      for (const payload of payloads) {\n        for (const restriction of payload.restrictions) {\n          const { night, room_type_id } = restriction;\n          const { roomType } = roomsInfoById.get(room_type_id);\n\n          if (!roomType) continue;\n\n          const dayIndex = dayIndexByValue.get(night);\n          if (dayIndex === undefined) {\n            console.warn(`Couldn't find date ${night}`);\n            continue;\n          }\n\n          const day = calendar_dates.days[dayIndex];\n          const rateKey = `${room_type_id}_${night}`;\n          let rp = rateByRoomTypeAndDate.get(rateKey);\n          if (!rp) {\n            rp = day.rate.find(r => r.id === room_type_id);\n            if (!rp) {\n              console.warn(`Couldn't find room type ${room_type_id}`);\n              continue;\n            }\n            rateByRoomTypeAndDate.set(rateKey, rp);\n          }\n\n          const haveAvailability = (rp.exposed_inventory as any).rts === 0;\n          for (const room of roomType.physicalrooms) {\n            const key = `${room.id}_${night}`;\n            prevDisabledCells.set(key, {\n              disabled: payload.is_closed ? true : haveAvailability,\n              reason: payload.is_closed ? 'stop_sale' : haveAvailability ? 'inventory' : 'stop_sale',\n            });\n          }\n        }\n      }\n      calendar_dates['disabled_cells'] = new Map(prevDisabledCells);\n    };\n    try {\n      this.errors = null;\n      this.isLoading = true;\n      const periods = this.datesSchema.parse(this.dates);\n      if (this.selectedRoomTypes.length === 0) {\n        this.unitSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'rooms';\n        return;\n      }\n      if (this.selectedWeekdays.size === 0) {\n        this.weekdaysSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'weekdays';\n        return;\n      }\n      this.activate();\n      const periods_to_modify = generatePeriodsToModify(periods);\n      const isAllOpen = this.selectedRoomTypes.every(e => e.result === 'open');\n      const isAllClosed = this.selectedRoomTypes.every(e => e.result === 'closed');\n      if (isAllClosed || isAllOpen) {\n        const payload = {\n          is_closed: isAllClosed,\n          restrictions: periods_to_modify,\n          property_id: this.property_id,\n        };\n        await this.bookingService.setExposedRestrictionPerRoomType(payload);\n        updateCalendarCells([payload]);\n      } else {\n        const payloads = [];\n        for (const room of this.selectedRoomTypes) {\n          const periods = periods_to_modify.filter(f => f.room_type_id === room.id);\n          payloads.push({\n            is_closed: room.result === 'closed',\n            restrictions: periods,\n            property_id: this.property_id,\n          });\n        }\n        await Promise.all(payloads.map(p => this.bookingService.setExposedRestrictionPerRoomType(p)));\n        updateCalendarCells(payloads);\n      }\n      this.deactivate();\n      this.toast.emit({\n        type: 'success',\n        title: locales.entries.Lcz_RequestSubmittedSuccessfully,\n        description: '',\n      });\n      this.isLoading = false;\n      this.closeModal.emit();\n    } catch (error) {\n      console.log(error);\n      if (error instanceof ZodError) {\n        this.datesSections.scrollIntoView({ behavior: 'smooth', block: 'end' });\n        this.errors = 'dates';\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private activate() {\n    this.reloadInterceptor.activate();\n    if (this.sidebar) this.sidebar.preventClose = true;\n  }\n\n  private deactivate() {\n    this.reloadInterceptor.deactivate();\n    if (this.sidebar) this.sidebar.preventClose = false;\n  }\n\n  private handleDateChange({ index, date, key }: { index: number; date: Moment; key: 'from' | 'to' }) {\n    // 1) clone and set the new date\n    const dates = [...this.dates];\n    dates[index] = { ...dates[index], [key]: date };\n\n    // 1a) if they just changed the â€œfromâ€, always clear that rowâ€™s â€œtoâ€\n    if (key === 'from' && dates[index].to?.isBefore(date, 'dates')) {\n      dates[index].to = null;\n    }\n\n    // 2) clear any subsequent rows whose â€œfromâ€ is on or before the changed date\n    for (let i = index + 1; i < dates.length; i++) {\n      const rowFrom = dates[i]?.from;\n      if (rowFrom && rowFrom.isSameOrBefore(date, 'day')) {\n        dates[i] = { from: null, to: null };\n      }\n    }\n\n    // 3) commit\n    this.dates = dates;\n\n    // 4) open the appropriate picker\n    setTimeout(() => {\n      if (key === 'from') {\n        this.dateRefs[index]?.to.openDatePicker();\n      } else {\n        const nextFrom = dates.findIndex(d => d.from === null);\n        if (nextFrom > -1) {\n          this.dateRefs[nextFrom]?.from.openDatePicker();\n        }\n      }\n    }, 100);\n  }\n\n  private addDateRow() {\n    const last_dates = this.dates[this.dates.length - 1];\n    if (!last_dates.from || !last_dates.to) {\n      this.errors = 'dates';\n      return;\n    }\n    this.errors = null;\n    this.dates = [...this.dates, { from: null, to: null }];\n    setTimeout(() => {\n      this.dateRefs[this.dates.length - 1].to?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 100);\n  }\n\n  render() {\n    return (\n      <form\n        class={'bulk-sheet-container'}\n        onSubmit={e => {\n          e.preventDefault();\n          this.addBlockDates();\n        }}\n      >\n        {/* <div class=\"sheet-header d-flex align-items-center\">\n          <ir-title\n            onCloseSideBar={e => {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              if (this.isLoading) {\n                return;\n              }\n              this.closeModal.emit(null);\n            }}\n            class=\"px-1 mb-0\"\n            label={locales.entries.Lcz_BulkStopOpenSale}\n            displayContext=\"sidebar\"\n          ></ir-title>\n        </div> */}\n        <div class=\"sheet-body px-1\">\n          <div class=\"text-muted text-left py-0 my-0\">\n            <p>\n              {/* {locales.entries.Lcz_SelectAffectedUnits} */}\n              Select the types to stop or open sales for all related rate plans\n              {/* <span class=\"text-warning\">{locales.entries.Lcz_OperationRequiresSeveralMinutes}</span> */}\n            </p>\n          </div>\n          <div>\n            {this.errors === 'rooms' && (\n              <p class={'text-danger text-left smaller p-0 '} style={{ 'margin-bottom': '0.5rem' }}>\n                {calendar_data.is_vacation_rental ? locales.entries.Lcz_PlzSelectOneListing : locales.entries.Lcz_PlzSelectOneUnit}\n              </p>\n            )}\n            <table ref={el => (this.unitSections = el)}>\n              <thead>\n                <tr>\n                  <th class=\"sr-only\">choice</th>\n                  <th class=\"sr-only\">room type</th>\n                </tr>\n              </thead>\n              <tbody>\n                {calendar_data.roomsInfo.map((roomType, i) => {\n                  const row_style = i === calendar_data.roomsInfo.length - 1 ? '' : 'pb-1';\n                  return (\n                    <tr key={roomType.id}>\n                      <td class={`choice-row ${row_style}`}>\n                        <div class={'d-flex justify-content-end'}>\n                          <ir-select\n                            firstOption={`${locales.entries.Lcz_Select}...`}\n                            data={[\n                              { value: 'open', text: locales.entries.Lcz_Open },\n                              { value: 'closed', text: locales.entries.Lcz_StopSale },\n                            ]}\n                            onSelectChange={e => {\n                              const choice = e.detail as 'open' | 'closed' | undefined;\n                              // drop any existing entry for this roomType\n                              const rest = this.selectedRoomTypes.filter(entry => entry.id !== roomType.id);\n                              // if they actually picked something, append it\n                              if (choice) {\n                                rest.push({ id: roomType.id, result: choice });\n                              }\n                              this.selectedRoomTypes = rest;\n                            }}\n                          ></ir-select>\n                        </div>\n                      </td>\n                      <td class={`pl-1 text-left ${row_style}`}>{roomType.name}</td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n          <p class=\"text-left mt-2 text-muted\">Included days</p>\n          {this.errors === 'weekdays' && <p class={'text-danger text-left smaller m-0 p-0'}>Please select at least one day</p>}\n          <ir-weekday-selector\n            ref={el => (this.weekdaysSections = el)}\n            weekdays={Array.from(this.selectedWeekdays)}\n            onWeekdayChange={e => {\n              e.stopPropagation();\n              e.stopImmediatePropagation();\n              this.selectedWeekdays = new Set(e.detail);\n            }}\n          ></ir-weekday-selector>\n          {/* Dates */}\n          <table class=\"mt-1\" ref={el => (this.datesSections = el)}>\n            <thead>\n              <tr>\n                <th class=\"text-left\">{locales.entries.Lcz_From}</th>\n                <th class=\"text-left\">{locales.entries.Lcz_ToExclusive}</th>\n                <td>\n                  {this.dates.length !== this.maxDatesLength && (\n                    <ir-button\n                      variant=\"icon\"\n                      icon_name=\"plus\"\n                      onClickHandler={() => {\n                        this.addDateRow();\n                      }}\n                    ></ir-button>\n                  )}\n                </td>\n              </tr>\n            </thead>\n            <tbody>\n              {this.dates.map((d, i) => {\n                if (!this.dateRefs[i]) {\n                  this.dateRefs[i] = {};\n                }\n\n                const fromDateMinDate = i > 0 ? this.dates[i - 1]?.to.clone().add(1, 'days')?.format('YYYY-MM-DD') ?? this.minDate : this.minDate;\n                const toDateMinDate = this.dates[i].from ? this.dates[i]?.from.clone()?.format('YYYY-MM-DD') : this.minDate;\n                return (\n                  <tr key={`date_${i}`}>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        ref={el => {\n                          this.dateRefs[i].from = el;\n                        }}\n                        forceDestroyOnUpdate\n                        minDate={fromDateMinDate}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.from?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        aria-invalid={String(this.errors === 'dates' && !d.from)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'from' });\n                        }}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          if (i === 0) {\n                            return;\n                          }\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.from ? d.from.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm ${this.errors === 'dates' && !d.to ? 'border-danger' : ''} text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        forceDestroyOnUpdate\n                        ref={el => {\n                          this.dateRefs[i].to = el;\n                        }}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.to?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        minDate={toDateMinDate}\n                        aria-invalid={String(this.errors === 'dates' && !d.to)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'to' });\n                        }}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from?.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.to ? d.to.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm \n                          ${this.errors === 'dates' && !d.to ? 'border-danger' : ''}\n                          text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    {i > 0 && (\n                      <td class=\"pb-1\">\n                        <ir-button\n                          variant=\"icon\"\n                          icon_name=\"minus\"\n                          onClickHandler={() => {\n                            this.dates = this.dates.filter((_, j) => j !== i);\n                          }}\n                        ></ir-button>\n                      </td>\n                    )}\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n        <div class={'sheet-footer'}>\n          <ir-button text={locales.entries.Lcz_Cancel} btn_color=\"secondary\" class={'flex-fill'} onClickHandler={() => this.closeModal.emit(null)}></ir-button>\n          <ir-button isLoading={this.isLoading} text={locales.entries.Lcz_Save} btn_type=\"submit\" class=\"flex-fill\"></ir-button>\n        </div>\n      </form>\n    );\n  }\n}\n",":host {\n  display: block;\n  color: var(--wa-color-text-normal);\n}\n\n.bodyContainer {\n  position: relative;\n}\n\n.roomRow {\n  width: max-content;\n}\n\n.roomRow:first-child {\n  margin-top: 80px;\n}\n.categoryName {\n  font-weight: bold;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n/* .cellData[data-dirty-room='true'] { \n  border-bottom: 5px solid rgb(80, 80, 80) !important;\n} */\n.cellData {\n  background-color: var(--wa-color-surface-default);\n}\n.cellData[data-dirty-room='true']::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  height: 100%;\n  left: 30%;\n  right: 30%;\n  background-color: #d4d0be !important;\n}\n\n/* .cellData.disabled[data-dirty-room='true'] {\n  border-bottom: 2px solid rgb(80, 80, 80) !important;\n} */\n.cellData.disabled {\n  background: var(--wa-color-neutral-fill-quiet);\n  cursor: var(--cell-cursor, not-allowed);\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n.roomRow .room {\n  cursor: pointer;\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n.roomRow .room:hover {\n  background: var(--wa-color-neutral-fill-quiet);\n}\n.roomRow .room:hover[data-hk-enabled='false'] {\n  background: var(--wa-color-surface-default);\n  cursor: default;\n}\n.cellData {\n  width: 58px;\n  height: 30px;\n  display: inline-grid;\n  border-top: 1px solid var(--wa-color-surface-border);\n  border-left: 1px solid var(--wa-color-surface-border);\n  vertical-align: top;\n}\n.triangle-button {\n  --size: 10px;\n  position: absolute;\n  right: -6px;\n  top: -1px;\n\n  width: 0;\n  height: 0;\n  padding: 0;\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  width: 0;\n  height: 0;\n  border-left: var(--size) solid transparent;\n  border-right: var(--size) solid transparent;\n  border-bottom: var(--size) solid var(--wa-color-surface-border);\n\n  transform: rotate(45deg);\n}\n.cellData:nth-child(2) {\n  border-left: 0px;\n}\n\n.cellData:last-child {\n  border-right: 1px solid var(--wa-color-surface-border);\n}\n\n.roomHeaderCell {\n  position: -webkit-sticky;\n  position: sticky;\n  left: 0;\n  background: var(--wa-color-surface-default);\n  border-right: 1px solid var(--wa-color-surface-border);\n  width: 170px;\n  z-index: 1;\n}\n\n.currentDay {\n  background-color: var(--wa-color-brand-fill-quiet);\n}\n\n.dragOverHighlight {\n  background-color: #f5f5dc !important;\n}\n\n.selectedDay {\n  background-color: #f9f9c9 !important;\n}\n\n.categoryTitle {\n  grid-template-columns: 1fr 20px;\n  padding-left: 10px;\n  cursor: pointer;\n  height: 40px;\n  font-size: 0.9em;\n}\n.categoryTitle > :nth-child(1) {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.roomTitle {\n  padding-left: 20px;\n  font-size: 0.9em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.roomTitle > :nth-child(1) {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.roomTitle.pl10 {\n  padding-left: 10px;\n}\n\n.categoryPriceColumn {\n  align-items: center;\n  height: 40px;\n  -webkit-user-select: none;\n  user-select: none;\n  position: relative;\n}\n\n/* BOOKING EVENT */\n.bookingEventsContainer {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n/* .roomTitle[data-room-has-today-checkin='true'] {\n  background-color: var(--wa-color-brand-fill-quiet) !important;\n} */\n","import { Component, Host, Listen, Prop, State, h, Event, EventEmitter, Watch, Fragment } from '@stencil/core';\n\nimport moment from 'moment';\n\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { compareTime, createDateWithOffsetAndHour } from '@/utils/booking';\n\nimport calendar_dates from '@/stores/calendar-dates.store';\nimport locales from '@/stores/locales.store';\nimport calendar_data from '@/stores/calendar-data';\n\nimport { PhysicalRoom, RoomHkStatus, RoomType } from '@/models/booking.dto';\nimport { ICountry } from '@/models/IBooking';\n\nexport type RoomCategory = RoomType & { expanded: boolean };\n\n@Component({\n  tag: 'igl-cal-body',\n  styleUrl: 'igl-cal-body.css',\n  scoped: true,\n})\nexport class IglCalBody {\n  @Prop() isScrollViewDragging: boolean;\n  @Prop() propertyId: number;\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() today: String;\n  @Prop() currency;\n  @Prop() language: string;\n  @Prop() countries: ICountry[];\n  @Prop() highlightedDate: string;\n\n  @State() dragOverElement: string = '';\n  @State() renderAgain: boolean = false;\n  @State() selectedRoom: PhysicalRoom;\n  @State() isLoading: 'middle' | 'right' | null = null;\n\n  @Event() addBookingDatasEvent: EventEmitter<any[]>;\n  @Event() showBookingPopup: EventEmitter;\n  @Event({ bubbles: true, composed: true }) scrollPageToRoom: EventEmitter;\n\n  @State() selectedRooms: { [key: string]: any } = {};\n  private fromRoomId: number = -1;\n  private newEvent: { [key: string]: any };\n  private currentDate = new Date();\n  private hkModal: HTMLIrModalElement;\n  private housekeepingService = new HouseKeepingService();\n  private bookingMap = new Map<string | number, string | number>();\n  private interactiveTitle: HTMLIrInteractiveTitleElement[] = [];\n  private dayRateMap = new Map<string, (typeof calendar_dates.days)[0]['rate']>();\n  private roomsWithTodayCheckinStatus = new Set<number>();\n  private categoriesWithTodayCheckinStatus = new Set<number>();\n  // private disabledCellsCache = new Map<string, boolean>();\n\n  componentWillLoad() {\n    this.currentDate.setHours(0, 0, 0, 0);\n    this.bookingMap = this.getBookingMap(this.getBookingData());\n    this.updateTodayCheckinStatus();\n    calendar_dates.days.forEach(day => {\n      this.dayRateMap.set(day.day, day.rate);\n    });\n    this.updateDisabledCellsCache();\n  }\n\n  @Watch('calendarData')\n  handleCalendarDataChange() {\n    this.bookingMap = this.getBookingMap(this.getBookingData());\n    this.updateTodayCheckinStatus();\n    this.updateDisabledCellsCache();\n  }\n\n  @Watch('today')\n  handleTodayChange() {\n    this.updateTodayCheckinStatus();\n  }\n\n  @Listen('dragOverHighlightElement', { target: 'window' })\n  dragOverHighlightElementHandler(event: CustomEvent) {\n    this.dragOverElement = event.detail.dragOverElement;\n  }\n\n  @Listen('gotoRoomEvent', { target: 'window' })\n  gotoRoom(event: CustomEvent) {\n    let roomId = event.detail.roomId;\n    let category = this.getRoomCategoryByRoomId(roomId);\n    if (!category.expanded) {\n      this.toggleCategory(category);\n      setTimeout(() => {\n        this.scrollToRoom(roomId);\n      }, 10);\n    } else {\n      this.scrollToRoom(roomId);\n    }\n  }\n\n  @Listen('addToBeAssignedEvent', { target: 'window' })\n  addToBeAssignedEvents(event: CustomEvent) {\n    // let roomId = event.detail.roomId;\n    this.addBookingDatas(event.detail.data);\n    this.renderElement();\n  }\n\n  @Listen('closeBookingWindow', { target: 'window' })\n  closeWindow() {\n    let ind = this.getBookingData().findIndex(ev => ev.ID === 'NEW_TEMP_EVENT');\n    if (ind !== -1) {\n      this.getBookingData().splice(ind, 1);\n      console.log('removed item..');\n      this.renderElement();\n    }\n  }\n\n  private scrollToRoom(roomId: number) {\n    this.scrollPageToRoom.emit({\n      key: 'scrollPageToRoom',\n      id: roomId,\n      refClass: 'room_' + roomId,\n    });\n  }\n\n  private getRoomCategoryByRoomId(roomId) {\n    return this.calendarData.roomsInfo.find(roomCategory => {\n      return this.getCategoryRooms(roomCategory).find(room => this.getRoomId(room) === roomId);\n    });\n  }\n\n  private getCategoryName(roomCategory) {\n    return roomCategory.name;\n  }\n\n  private getCategoryId(roomCategory) {\n    return roomCategory.id;\n  }\n\n  private getTotalPhysicalRooms(roomCategory) {\n    return this.getCategoryRooms(roomCategory).length;\n  }\n\n  private getCategoryRooms(roomCategory: RoomCategory) {\n    return (roomCategory && roomCategory.physicalrooms) || [];\n  }\n\n  private getRoomName(roomInfo) {\n    return roomInfo.name;\n  }\n\n  private getRoomId(roomInfo) {\n    return roomInfo.id;\n  }\n\n  private getRoomById(physicalRooms, roomId) {\n    return physicalRooms.find(physical_room => this.getRoomId(physical_room) === roomId);\n  }\n\n  private getBookingData() {\n    return this.calendarData.bookingEvents;\n  }\n\n  private addBookingDatas(aData) {\n    this.addBookingDatasEvent.emit(aData);\n  }\n\n  private getSelectedCellRefName(roomId, selectedDay) {\n    return 'room_' + roomId + '_' + selectedDay.currentDate;\n  }\n\n  // getSplitBookingEvents(newEvent) {\n  //   return this.getBookingData().some(bookingEvent => !['003', '002', '004'].includes(bookingEvent.STATUS_CODE) && newEvent.FROM_DATE === bookingEvent.FROM_DATE);\n  // }\n  private getSplitBookingEvents(newEvent) {\n    console.log(newEvent.FROM_DATE);\n    return this.getBookingData().some(bookingEvent => {\n      if (!['003', '002', '004'].includes(bookingEvent.STATUS_CODE)) {\n        if (\n          new Date(newEvent.FROM_DATE).getTime() >= new Date(bookingEvent.FROM_DATE).getTime() &&\n          new Date(newEvent.FROM_DATE).getTime() <= new Date(bookingEvent.TO_DATE).getTime()\n        ) {\n          return bookingEvent;\n        }\n      }\n    });\n  }\n\n  private addNewEvent(roomCategory) {\n    let keys = Object.keys(this.selectedRooms);\n    let startDate: Date, endDate: Date;\n\n    if (this.selectedRooms[keys[0]].currentDate < this.selectedRooms[keys[1]].currentDate) {\n      startDate = new Date(this.selectedRooms[keys[0]].currentDate);\n      endDate = new Date(this.selectedRooms[keys[1]].currentDate);\n    } else {\n      startDate = new Date(this.selectedRooms[keys[1]].currentDate);\n      endDate = new Date(this.selectedRooms[keys[0]].currentDate);\n    }\n\n    const dateDifference = Math.round(Math.abs((endDate.getTime() - startDate.getTime()) / 86_400_000));\n    this.newEvent = {\n      ID: 'NEW_TEMP_EVENT',\n      NAME: <span>&nbsp;</span>,\n      EMAIL: '',\n      PHONE: '',\n      convertBooking: false,\n      REFERENCE_TYPE: 'PHONE',\n      FROM_DATE: startDate.getFullYear() + '-' + this.getTwoDigitNumStr(startDate.getMonth() + 1) + '-' + this.getTwoDigitNumStr(startDate.getDate()),\n      TO_DATE: endDate.getFullYear() + '-' + this.getTwoDigitNumStr(endDate.getMonth() + 1) + '-' + this.getTwoDigitNumStr(endDate.getDate()),\n      BALANCE: '',\n      NOTES: '',\n      RELEASE_AFTER_HOURS: 0,\n      PR_ID: this.selectedRooms[keys[0]].roomId,\n      ENTRY_DATE: '',\n      NO_OF_DAYS: dateDifference,\n      ADULTS_COUNT: 1,\n      COUNTRY: '',\n      INTERNAL_NOTE: '',\n      RATE: '',\n      TOTAL_PRICE: '',\n      RATE_PLAN: '',\n      ARRIVAL_TIME: '',\n      TITLE: locales.entries.Lcz_NewBookingFor,\n      roomsInfo: [roomCategory],\n      CATEGORY: roomCategory.name,\n      event_type: 'BAR_BOOKING',\n      STATUS: 'TEMP-EVENT',\n      defaultDateRange: {\n        fromDate: null,\n        fromDateStr: '',\n        toDate: null,\n        toDateStr: '',\n        dateDifference,\n        editable: false,\n        message: 'Including 5.00% City Tax - Excluding 11.00% VAT',\n      },\n    };\n\n    let popupTitle = roomCategory.name + ' ' + this.getRoomName(this.getRoomById(this.getCategoryRooms(roomCategory), this.selectedRooms[keys[0]].roomId));\n    this.newEvent.BLOCK_DATES_TITLE = `${locales.entries.Lcz_BlockDatesFor} ${popupTitle}`;\n    this.newEvent.TITLE += popupTitle;\n    this.newEvent.defaultDateRange.toDate = new Date(this.newEvent.TO_DATE + 'T00:00:00');\n    this.newEvent.defaultDateRange.fromDate = new Date(this.newEvent.FROM_DATE + 'T00:00:00');\n    this.newEvent.defaultDateRange.fromDateStr = this.getDateStr(this.newEvent.defaultDateRange.fromDate);\n    this.newEvent.defaultDateRange.toDateStr = this.getDateStr(this.newEvent.defaultDateRange.toDate);\n    this.newEvent.ENTRY_DATE = new Date().toISOString();\n    this.newEvent.legendData = this.calendarData.formattedLegendData;\n\n    let splitBookingEvents = this.getSplitBookingEvents(this.newEvent);\n    if (splitBookingEvents) {\n      this.newEvent.splitBookingEvents = splitBookingEvents;\n    }\n\n    this.getBookingData().push(this.newEvent);\n    return this.newEvent;\n  }\n\n  private getTwoDigitNumStr(num) {\n    return num <= 9 ? '0' + num : num;\n  }\n\n  private getDateStr(date, locale = 'default') {\n    return date.getDate() + ' ' + date.toLocaleString(locale, { month: 'short' }) + ' ' + date.getFullYear();\n  }\n\n  private removeNewEvent() {\n    this.calendarData.bookingEvents = this.calendarData.bookingEvents.filter(events => events.ID !== 'NEW_TEMP_EVENT');\n    this.newEvent = null;\n  }\n\n  // private clickCell(roomId, selectedDay, roomCategory) {\n  //   if (!this.isScrollViewDragging && selectedDay.currentDate >= this.currentDate.getTime()) {\n  //     let refKey = this.getSelectedCellRefName(roomId, selectedDay);\n  //     if (this.selectedRooms.hasOwnProperty(refKey)) {\n  //       this.removeNewEvent();\n  //       delete this.selectedRooms[refKey];\n  //       this.renderElement();\n  //       return;\n  //     } else if (Object.keys(this.selectedRooms).length != 1 || this.fromRoomId != roomId) {\n  //       this.removeNewEvent();\n  //       this.selectedRooms = {};\n  //       this.selectedRooms[refKey] = { ...selectedDay, roomId };\n  //       this.fromRoomId = roomId;\n  //       this.renderElement();\n  //     } else {\n  //       // create bar;\n  //       this.selectedRooms[refKey] = { ...selectedDay, roomId };\n  //       this.addNewEvent(roomCategory);\n  //       this.selectedRooms = {};\n  //       this.renderElement();\n  //       this.showNewBookingPopup(this.newEvent);\n  //     }\n  //   }\n  // }\n  private clickCell(roomId: number, selectedDay: any, roomCategory: RoomCategory) {\n    if (!this.isScrollViewDragging && selectedDay.currentDate >= this.currentDate.getTime()) {\n      let refKey = this.getSelectedCellRefName(roomId, selectedDay);\n      if (this.selectedRooms.hasOwnProperty(refKey)) {\n        this.removeNewEvent();\n        delete this.selectedRooms[refKey];\n        this.renderElement();\n        return;\n      } else if (Object.keys(this.selectedRooms).length != 1 || this.fromRoomId != roomId) {\n        this.removeNewEvent();\n        this.selectedRooms = {};\n        this.selectedRooms[refKey] = { ...selectedDay, roomId };\n        this.fromRoomId = roomId;\n        this.renderElement();\n      } else {\n        const keys = Object.keys(this.selectedRooms);\n        const startDate = moment(this.selectedRooms[keys[0]].value, 'YYYY-MM-DD');\n        const endDate = moment(selectedDay.value, 'YYYY-MM-DD');\n        let cursor = startDate.clone().add(1, 'days');\n        let disabledCount = 0;\n        while (cursor.isBefore(endDate, 'day')) {\n          const dateKey = cursor.format('YYYY-MM-DD');\n          if (this.isCellDisabled(roomId, dateKey)) {\n            disabledCount++;\n          }\n          cursor.add(1, 'days');\n        }\n        if (disabledCount >= 1) {\n          this.selectedRooms = {};\n          this.fromRoomId = roomId;\n          this.renderElement();\n          return;\n        }\n\n        this.selectedRooms[refKey] = { ...selectedDay, roomId };\n        this.addNewEvent(roomCategory);\n        this.selectedRooms = {};\n        this.renderElement();\n        this.showNewBookingPopup(this.newEvent);\n      }\n    }\n  }\n  private showNewBookingPopup(data) {\n    console.log(data);\n    // this.showBookingPopup.emit({key: \"add\", data});\n  }\n\n  private renderElement() {\n    this.renderAgain = !this.renderAgain;\n  }\n  private getBookingMap(bookings: any[]): Map<string | number, string | number> {\n    const bookingMap = new Map<string | number, string | number>();\n    const today = moment().startOf('day');\n\n    for (const booking of bookings) {\n      const fromDate = moment(booking.FROM_DATE, 'YYYY-MM-DD').startOf('day');\n      const toDate = moment(booking.TO_DATE, 'YYYY-MM-DD').startOf('day');\n\n      // Check if today is between fromDate and toDate, inclusive.\n      if (today.isSameOrAfter(fromDate) && today.isSameOrBefore(toDate)) {\n        if (!bookingMap.has(booking.PR_ID)) {\n          bookingMap.set(booking.PR_ID, booking.BOOKING_NUMBER);\n        } else {\n          if (compareTime(moment().toDate(), createDateWithOffsetAndHour(calendar_data.checkin_checkout_hours?.offset, calendar_data.checkin_checkout_hours?.hour))) {\n            bookingMap.set(booking.PR_ID, booking.BOOKING_NUMBER);\n          }\n        }\n      }\n    }\n\n    return bookingMap;\n  }\n  private getGeneralCategoryDayColumns(addClass: string, isCategory: boolean = false, index: number) {\n    return calendar_dates.days.map(dayInfo => {\n      // const isActive = true;\n      return (\n        <div\n          class={`cellData  font-weight-bold categoryPriceColumn ${addClass + '_' + dayInfo.day} ${\n            dayInfo.day === this.today || dayInfo.day === this.highlightedDate ? 'currentDay' : ''\n          }`}\n        >\n          {isCategory ? (\n            <Fragment>\n              <span class={'categoryName'}>\n                {dayInfo.rate[index].exposed_inventory.rts}\n                {/* <button class={'triangle-button'} style={{ '--in-toggle-color': isActive ? 'green' : '#ff4961' }}></button> */}\n                {/* <br />\n              {dayInfo.rate[index].exposed_inventory.offline} */}\n              </span>\n            </Fragment>\n          ) : (\n            ''\n          )}\n        </div>\n      );\n    });\n  }\n\n  private getGeneralRoomDayColumns(roomId: string, roomCategory: RoomCategory, roomName: string) {\n    return this.calendarData.days.map(dayInfo => {\n      const isCellDisabled = this.isCellDisabled(Number(roomId), dayInfo.value);\n      const prevDate = moment(dayInfo.value, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD');\n      const isDisabled = (isCellDisabled && Object.keys(this.selectedRooms).length === 0) || (isCellDisabled && this.isCellDisabled(Number(roomId), prevDate));\n      const isSelected = this.selectedRooms.hasOwnProperty(this.getSelectedCellRefName(roomId, dayInfo));\n      const isCurrentDate = dayInfo.day === this.today || dayInfo.day === this.highlightedDate;\n      const cleaningDates = calendar_dates.cleaningTasks.has(+roomId) ? calendar_dates.cleaningTasks.get(+roomId) : null;\n      const shouldBeCleaned = ['001', '003'].includes(calendar_data.cleaning_frequency?.code) ? false : cleaningDates?.has(dayInfo.value);\n      return (\n        <div\n          class={`cellData position-relative roomCell ${isCellDisabled ? 'disabled' : ''} ${'room_' + roomId + '_' + dayInfo.day} ${isCurrentDate ? 'currentDay' : ''} ${\n            this.dragOverElement === roomId + '_' + dayInfo.day ? 'dragOverHighlight' : ''\n          } ${isSelected ? 'selectedDay' : ''}`}\n          style={!isDisabled && { '--cell-cursor': 'default' }}\n          onClick={() => {\n            if (isDisabled) {\n              return;\n            }\n            this.clickCell(Number(roomId), dayInfo, roomCategory);\n          }}\n          aria-label={roomName}\n          role=\"gridcell\"\n          data-room-id={roomId}\n          data-date={dayInfo.value}\n          aria-current={isCurrentDate ? 'date' : undefined}\n          data-room-name={roomName}\n          data-dirty-room={String(shouldBeCleaned)}\n          aria-disabled={String(isDisabled)}\n          aria-selected={Boolean(isSelected)}\n          // tabIndex={-1}\n        >\n          {/* <button class={'triangle-button'} style={{ '--in-toggle-color': isDisabled ? 'green' : '#ff4961' }}></button> */}\n        </div>\n      );\n    });\n  }\n\n  private toggleCategory(roomCategory: RoomCategory) {\n    roomCategory.expanded = !roomCategory.expanded;\n    this.renderElement();\n  }\n\n  private getRoomCategoryRow(roomCategory: RoomCategory, index: number) {\n    if (this.getTotalPhysicalRooms(roomCategory) <= 1 || !roomCategory.is_active) {\n      return null;\n    }\n    const hasRoomWithTodayCheckin = this.categoryHasRoomWithTodayCheckin(roomCategory);\n    return (\n      <div class=\"roomRow\" data-has-today-checkin={String(hasRoomWithTodayCheckin)}>\n        <div\n          class={`cellData text-left align-items-center roomHeaderCell categoryTitle ${'category_' + this.getCategoryId(roomCategory)}`}\n          onClick={() => this.toggleCategory(roomCategory)}\n          data-has-today-checkin={String(hasRoomWithTodayCheckin)}\n        >\n          <div class={'categoryName'}>\n            <ir-interactive-title popoverTitle={this.getCategoryName(roomCategory)}></ir-interactive-title>\n            {/* <ir-popover popoverTitle={this.getCategoryName(roomCategory)}></ir-popover> */}\n          </div>\n          {roomCategory.expanded ? (\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" height={14} width={14}>\n              <path\n                fill=\"#6b6f82\"\n                d=\"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z\"\n              />\n            </svg>\n          ) : (\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\" height={14} width={14}>\n              <path\n                fill=\"#6b6f82\"\n                d=\"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z\"\n              />\n            </svg>\n          )}\n          {/* <i class={`la la-angle-${roomCategory.expanded ? 'down' : 'right'}`}></i> */}\n        </div>\n        {this.getGeneralCategoryDayColumns('category_' + this.getCategoryId(roomCategory), true, index)}\n      </div>\n    );\n  }\n\n  /**\n   * Renders a list of active rooms for an expanded room category. Returns an array of JSX elements, including headers and day columns, or an empty array if the category is collapsed or contains no active rooms.\n   *\n   * @param {RoomCategory} roomCategory - The category containing room details.\n   */\n  private getRoomsByCategory(roomCategory: RoomCategory) {\n    const hasRoomWithTodayCheckin = this.categoryHasRoomWithTodayCheckin(roomCategory);\n    // Check accordion is expanded.\n    if (!roomCategory.expanded) {\n      return null;\n    }\n    return this.getCategoryRooms(roomCategory)?.map(room => {\n      if (!room.is_active) {\n        return null;\n      }\n      const haveSingleRooms = this.getTotalPhysicalRooms(roomCategory) <= 1;\n      const name = haveSingleRooms ? this.getCategoryName(roomCategory) : this.getRoomName(room);\n      const roomId = this.getRoomId(room);\n      const roomHasTodayCheckin = this.roomHasTodayCheckin(roomId);\n      return (\n        <div class=\"roomRow\" data-room-has-today-checkin={String(roomHasTodayCheckin)}>\n          <div\n            class={`cellData room text-left align-items-center roomHeaderCell  roomTitle ${this.getTotalPhysicalRooms(roomCategory) <= 1 ? 'pl10' : ''} ${\n              'room_' + roomId\n            }`}\n            data-room-name={name}\n            data-hk-enabled={String(calendar_data.housekeeping_enabled)}\n            data-room={roomId}\n            data-room-has-today-checkin={String(roomHasTodayCheckin)}\n            data-category-has-today-checkin={String(hasRoomWithTodayCheckin)}\n            onClick={() => {\n              if (!calendar_data.housekeeping_enabled) {\n                return;\n              }\n              this.selectedRoom = room;\n              this.hkModal.openModal();\n            }}\n            onMouseEnter={() => {\n              this.interactiveTitle[room.id]?.style?.setProperty('--ir-interactive-hk-bg', 'var(--wa-color-neutral-fill-quiet)');\n            }}\n            onMouseLeave={() => {\n              this.interactiveTitle[room.id]?.style?.removeProperty('--ir-interactive-hk-bg');\n            }}\n          >\n            <ir-interactive-title\n              ref={el => {\n                if (el) this.interactiveTitle[room.id] = el;\n              }}\n              style={room.hk_status === '003' && { '--dot-color': 'var(--wa-color-neutral-fill-quiet)' }}\n              hkStatus={calendar_data.housekeeping_enabled && room.hk_status !== '001'}\n              popoverTitle={name}\n            >\n              {room.hk_status !== '001' && (\n                <div slot=\"end\" class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                  {room.hk_status === '004' ? (\n                    <svg height={14} width={14} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\">\n                      <title>Inspected</title>\n                      <path\n                        fill=\"green\"\n                        d=\"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z\"\n                      />\n                    </svg>\n                  ) : (\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"13.5\" viewBox=\"0 0 576 512\" style={{ display: 'block' }}>\n                      {room.hk_status === '002' && <title>This unit is dirty</title>}\n                      <path\n                        fill=\"currentColor\"\n                        d=\"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z\"\n                      />\n                    </svg>\n                  )}\n                </div>\n              )}\n            </ir-interactive-title>\n          </div>\n          {this.getGeneralRoomDayColumns(this.getRoomId(room), roomCategory, name)}\n        </div>\n      );\n    });\n  }\n\n  private getRoomRows() {\n    return this.calendarData.roomsInfo?.map((roomCategory, index) => {\n      if (roomCategory.is_active) {\n        return (\n          <Fragment>\n            {this.getRoomCategoryRow(roomCategory, index)}\n            {roomCategory.expanded && this.getRoomsByCategory(roomCategory)}\n          </Fragment>\n        );\n      } else {\n        return null;\n      }\n    });\n  }\n  private async confirmHousekeepingUpdate(e: CustomEvent, status: RoomHkStatus) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      this.isLoading = status === '004' ? 'right' : 'middle';\n      await this.housekeepingService.setExposedUnitHKStatus({\n        property_id: this.propertyId,\n        // housekeeper: this.selectedRoom?.housekeeper ? { id: this.selectedRoom?.housekeeper?.id } : null,\n        status: {\n          code: status,\n        },\n        unit: {\n          id: this.selectedRoom?.id,\n        },\n      });\n      if (['001', '004'].includes(status)) {\n        await this.housekeepingService.executeHKAction({\n          actions: [\n            {\n              description: 'Cleaned',\n              hkm_id: this.selectedRoom?.housekeeper?.id || null,\n              unit_id: this.selectedRoom?.id,\n              booking_nbr: this.bookingMap.get(this.selectedRoom?.id) ?? null,\n              status: status as any,\n            },\n          ],\n        });\n      }\n    } finally {\n      this.isLoading = null;\n      this.selectedRoom = null;\n      this.hkModal.closeModal();\n    }\n  }\n  render() {\n    return (\n      <Host>\n        <div class=\"bodyContainer\">\n          {this.getRoomRows()}\n          <div class=\"bookingEventsContainer preventPageScroll\">\n            {this.getBookingData()?.map(bookingEvent => {\n              return (\n                <igl-booking-event\n                  data-testid={`booking_${bookingEvent.BOOKING_NUMBER}`}\n                  data-room-name={bookingEvent.roomsInfo?.find(r => r.id === bookingEvent.RATE_TYPE)?.physicalrooms.find(r => r.id === bookingEvent.PR_ID)?.name}\n                  language={this.language}\n                  is_vacation_rental={this.calendarData.is_vacation_rental}\n                  countries={this.countries}\n                  currency={this.currency}\n                  data-component-id={bookingEvent.ID}\n                  bookingEvent={bookingEvent}\n                  allBookingEvents={this.getBookingData()}\n                ></igl-booking-event>\n              );\n            })}\n          </div>\n        </div>\n        <ir-modal\n          ref={el => (this.hkModal = el)}\n          leftBtnText={locales?.entries?.Lcz_Cancel}\n          middleBtnText={this.renderModalMiddleButtonText()}\n          middleBtnActive\n          rightBtnText={this.renderModalRightButtonText()}\n          modalBody={this.renderModalBody()}\n          onConfirmModal={e => this.confirmHousekeepingUpdate(e, '004')}\n          onMiddleModal={e => this.confirmHousekeepingUpdate(e, this.selectedRoom?.hk_status === '002' ? '001' : '002')}\n          autoClose={false}\n          isMiddleButtonLoading={this.isLoading === 'middle'}\n          isLoading={this.isLoading === 'right'}\n          onCancelModal={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.selectedRoom = null;\n            this.hkModal.closeModal();\n          }}\n        ></ir-modal>\n      </Host>\n    );\n  }\n\n  private renderModalBody() {\n    if (!this.selectedRoom) {\n      return null;\n    }\n    return (\n      <p>Update unit {this.selectedRoom?.name} to ...</p>\n      // <ir-select\n      //   showFirstOption={false}\n      //   selectedValue={this.selectedRoom?.hk_status === '001' ? '001' : '002'}\n      //   data={[\n      //     { text: 'Clean', value: '001' },\n      //     { text: 'Dirty', value: '002' },\n      //   ]}\n      //   onSelectChange={e => (this.selectedHKStatus = e.detail)}\n      // ></ir-select>\n    );\n  }\n  private renderModalMiddleButtonText() {\n    if (!this.selectedRoom) {\n      return null;\n    }\n    return this.selectedRoom.hk_status === '002' ? 'Clean' : 'Dirty';\n  }\n  private renderModalRightButtonText() {\n    if (!this.selectedRoom) {\n      return null;\n    }\n    return this.selectedRoom.hk_status !== '004' ? 'Clean & Inspected' : 'Clean';\n  }\n\n  private updateTodayCheckinStatus() {\n    const todayISO = this.getTodayISODate();\n    const rooms = new Set<number>();\n    const categories = new Set<number>();\n    (this.getBookingData() ?? []).forEach(booking => {\n      const roomInfo = booking?.ROOM_INFO;\n      if (roomInfo?.in_out?.code !== '001') {\n        return;\n      }\n      if (booking.FROM_DATE !== todayISO && booking.TO_DATE !== todayISO) {\n        return;\n      }\n      const roomId = Number(booking.PR_ID);\n      if (!Number.isNaN(roomId)) {\n        rooms.add(roomId);\n      }\n      const categoryId = Number(booking.RATE_TYPE);\n      if (!Number.isNaN(categoryId)) {\n        categories.add(categoryId);\n      }\n    });\n    this.roomsWithTodayCheckinStatus = rooms;\n    this.categoriesWithTodayCheckinStatus = categories;\n  }\n\n  private getTodayISODate() {\n    const todayValue = typeof this.today === 'string' ? this.today : this.today ? this.today.toString() : '';\n    if (todayValue) {\n      const parsed = moment(todayValue, 'D_M_YYYY', true);\n      if (parsed.isValid()) {\n        return parsed.format('YYYY-MM-DD');\n      }\n    }\n    return moment().format('YYYY-MM-DD');\n  }\n\n  private roomHasTodayCheckin(roomId: number) {\n    return this.roomsWithTodayCheckinStatus.has(roomId);\n  }\n\n  private categoryHasRoomWithTodayCheckin(roomCategory: RoomCategory) {\n    return this.categoriesWithTodayCheckinStatus.has(this.getCategoryId(roomCategory));\n  }\n\n  private updateDisabledCellsCache() {\n    calendar_dates.disabled_cells.clear();\n    this.calendarData.roomsInfo?.forEach((roomCategory, categoryIndex) => {\n      if (roomCategory.is_active) {\n        this.getCategoryRooms(roomCategory)?.forEach(room => {\n          if (room.is_active) {\n            this.calendarData.days.forEach(dayInfo => {\n              const cellKey = this.getCellKey(room.id, dayInfo.value);\n              calendar_dates.disabled_cells.set(cellKey, {\n                disabled: !dayInfo.rate[categoryIndex].is_available_to_book,\n                reason: 'stop_sale',\n              });\n            });\n          }\n        });\n      }\n    });\n  }\n\n  private getCellKey(roomId: number, day: string): string {\n    return `${roomId}_${day}`;\n  }\n\n  private isCellDisabled(roomId: number, day: string): boolean {\n    const key = this.getCellKey(roomId, day);\n    if (!calendar_dates.disabled_cells.has(key)) {\n      return false;\n    }\n    const { disabled } = calendar_dates.disabled_cells.get(key);\n    return disabled;\n  }\n}\n",":host {\n  display: block;\n  position: sticky;\n  bottom: 0;\n  width: max-content;\n  z-index: 3;\n  color: var(--wa-color-text-quiet);\n}\n\n.footerCell {\n  display: -moz-inline-grid;\n  display: -ms-inline-grid;\n  display: inline-grid;\n  position: -webkit-sticky;\n  position: sticky;\n  bottom: 0;\n  width: 58px;\n  height: 40px;\n  background: var(--wa-color-surface-default);\n  vertical-align: top;\n  border-top: 1px solid var(--wa-color-surface-border);\n}\n\n.bottomLeftCell {\n  left: -1px;\n  z-index: 2;\n  width: 170px;\n  text-align: left;\n  padding-left: 15px;\n}\n\n.footerCell i {\n  margin-right: 5px;\n}\n\n.legendBtn {\n  color: #41bff3;\n  color: var(--wa-color-text-link);\n  cursor: pointer;\n}\n.legendBtn:hover {\n  color: color-mix(in oklab, var(--wa-color-text-link), var(--wa-color-mix-hover));\n}\n\n.isOnline i {\n  color: #2f9c3f;\n  font-weight: bold;\n}\n\n.isOffline i {\n  font-weight: bold;\n}\n\n.isOffline {\n  color: #a40000;\n}\n\n.dayTitle {\n  font-size: 0.8em;\n  font-weight: 600;\n  display: grid;\n  user-select: none;\n  /* height: 100%;\n  \n  align-items: center;\n  text-align: center;\n  width: 100%; */\n}\n\n.currentDay .dayTitle {\n  font-weight: bold;\n  /* color: #262b31; */\n}\n\n.currentDay {\n  background-color: var(--wa-color-brand-fill-quiet);\n}\n\n.dayCapacityPercent {\n  font-size: 0.75em;\n}\n\n.badge-pill {\n  padding-left: 1em;\n  padding-right: 1em;\n  font-size: 0.7em;\n  margin-bottom: 2px;\n}\n\n.weekend {\n  font-weight: bold;\n  color: var(--wa-color-text-normal);\n}\n","import locales from '@/stores/locales.store';\nimport { isWeekend } from '@/utils/utils';\nimport { Component, Event, EventEmitter, Host, Prop, h } from '@stencil/core';\nimport moment from 'moment';\n\n@Component({\n  tag: 'igl-cal-footer',\n  styleUrl: 'igl-cal-footer.css',\n  scoped: true,\n})\nexport class IglCalFooter {\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() isLegendOpen: boolean = false;\n  @Prop() today: String;\n  @Prop() highlightedDate: string;\n\n  private _today = moment().format('YYYY-MM-DD');\n\n  // private isOnline:boolean = false;\n\n  handleOptionEvent(key, data = '') {\n    this.optionEvent.emit({ key, data });\n  }\n\n  render() {\n    return (\n      <Host class=\"footerContainer\">\n        <div class=\"footerCell bottomLeftCell align-items-center preventPageScroll\" style={{ paddingLeft: '10px' }}>\n          <button class=\"m-0 p-0 btn btn-sm  legendBtn d-flex align-items-center\" style={{ gap: '0.25rem' }} onClick={() => this.handleOptionEvent('showLegend')}>\n            {this.isLegendOpen ? (\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\" height={16} width={16}>\n                <path\n                  fill=\"currentColor\"\n                  d=\"M105.4 297.4C92.9 309.9 92.9 330.2 105.4 342.7L265.4 502.7C277.9 515.2 298.2 515.2 310.7 502.7C323.2 490.2 323.2 469.9 310.7 457.4L173.3 320L310.6 182.6C323.1 170.1 323.1 149.8 310.6 137.3C298.1 124.8 277.8 124.8 265.3 137.3L105.3 297.3zM457.4 137.4L297.4 297.4C284.9 309.9 284.9 330.2 297.4 342.7L457.4 502.7C469.9 515.2 490.2 515.2 502.7 502.7C515.2 490.2 515.2 469.9 502.7 457.4L365.3 320L502.6 182.6C515.1 170.1 515.1 149.8 502.6 137.3C490.1 124.8 469.8 124.8 457.3 137.3z\"\n                />\n              </svg>\n            ) : (\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\" height={16} width={16}>\n                <path\n                  fill=\"currentColor\"\n                  d=\"M535.1 342.6C547.6 330.1 547.6 309.8 535.1 297.3L375.1 137.3C362.6 124.8 342.3 124.8 329.8 137.3C317.3 149.8 317.3 170.1 329.8 182.6L467.2 320L329.9 457.4C317.4 469.9 317.4 490.2 329.9 502.7C342.4 515.2 362.7 515.2 375.2 502.7L535.2 342.7zM183.1 502.6L343.1 342.6C355.6 330.1 355.6 309.8 343.1 297.3L183.1 137.3C170.6 124.8 150.3 124.8 137.8 137.3C125.3 149.8 125.3 170.1 137.8 182.6L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7z\"\n                />\n              </svg>\n            )}\n            <span>{locales.entries.Lcz_Legend}</span>\n            <span>v1.09</span>\n            <ir-new-badge style={{ marginLeft: '0.25rem' }}></ir-new-badge>\n          </button>\n          {/* <div class={`${this.isOnline ? 'isOnline' : 'isOffline'}`}>\n            <i class=\"la la-share-alt isOffline\"></i><span>{this.isOnline ? \"Connected\": \"Offline\"}</span>\n          </div> */}\n        </div>\n\n        {this.calendarData.days.map(dayInfo => (\n          <div class=\"footerCell align-items-center\">\n            <div\n              class={{\n                'dayTitle full-height align-items-center': true,\n                'weekend': isWeekend(dayInfo.value),\n                'currentDay': dayInfo.value === this._today || this.highlightedDate === dayInfo.day,\n              }}\n            >\n              {dayInfo.dayDisplayName}\n            </div>\n\n            {/* <div class=\"dayTitle\">{dayInfo.dayDisplayName}</div>\n              <div class=\"dayCapacityPercent\">28.57%</div>\n              <div class=\"preventPageScroll\">\n                <span class=\"badge badge-primary badge-pill\">\n                  {index}\n                </span>\n              </div> */}\n          </div>\n        ))}\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  position: absolute;\n  top: 0;\n  height: 100%;\n  color: var(--wa-color-text-quiet);\n}\n.svg-icon {\n  height: 20px;\n  width: 20px;\n}\n.darkGrey {\n  background: #ececec;\n}\n.btn {\n  pointer-events: auto;\n}\n.dayTitle.weekend {\n  font-weight: bold;\n  color: var(--wa-color-text-normal);\n}\n.cellData {\n  background-color: var(--wa-color-surface-default);\n}\n.stickyCell {\n  display: -ms-inline-grid;\n  display: -moz-inline-grid;\n  display: inline-grid;\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0px;\n  height: 82px;\n  display: inline-block;\n  vertical-align: top;\n  z-index: 2;\n}\n\n.headersContainer {\n  background-color: var(--wa-color-surface-default);\n}\n\n.headerCell {\n  display: inline-grid;\n  width: 58px;\n  height: 58px;\n  vertical-align: top;\n  background-color: var(--wa-color-surface-default);\n  border-bottom: 1px solid var(--wa-color-surface-border);\n}\n\n.monthsContainer {\n  height: 20px;\n  background-color: var(--wa-color-surface-default);\n  margin-bottom: 0.2em;\n}\n\n.monthCell {\n  display: inline-grid;\n  height: 20px;\n  background-color: var(--wa-color-overlay-inline);\n  border-right: 1px solid var(--wa-color-surface-border);\n  color: var(--wa-color-neutral-on-quiet);\n  vertical-align: top;\n}\n\n.monthCell:nth-child(odd) {\n  background: var(--wa-color-neutral-fill-normal);\n  color: var(--wa-color-neutral-on-normal);\n}\n\n.monthTitle {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 0.9em;\n  text-transform: uppercase;\n  font-weight: bold;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.topLeftCell {\n  left: 0px;\n  z-index: 3;\n  width: 170px;\n  background-color: var(--wa-color-surface-default);\n  display: -ms-inline-grid;\n  display: -moz-inline-grid;\n  display: inline-grid;\n}\n.datePickerHidden {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  opacity: 0;\n  cursor: pointer;\n  /* z-index: 1; */\n  z-index: 1;\n}\n\n.date_btn {\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n}\n\n.date_btn:hover {\n  background: #f6f6f6;\n  border-radius: 0.3rem;\n}\n.caledarBtns {\n  position: relative;\n  cursor: pointer;\n  padding: 0.4rem;\n}\n\n.caledarBtns:hover {\n  background-color: #f6f6f6;\n}\n\n.dayTitle {\n  font-size: 0.8em;\n  font-weight: 600;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.currentDay .dayTitle {\n  font-weight: bold;\n}\n\n.currentDay {\n  background-color: var(--wa-color-brand-fill-quiet);\n}\n\n.dayCapacityPercent {\n  font-size: 0.75em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.badge-pill {\n  padding: 3px 1em;\n  font-size: 0.8em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.pointer {\n  cursor: pointer;\n}\n\n.searchContiner {\n  padding-left: 10px;\n  padding-right: 10px;\n}\n\n.searchListContainer {\n  background: var(--wa-color-surface-default);\n  border: 1px solid var(--wa-color-surface-border);\n  border-bottom: none;\n}\n.fd-header__badge-btn {\n  all: unset;\n  cursor: pointer;\n}\n.fd-header__badge-btn:hover .fd-header__badge {\n  background-color: color-mix(in oklab, var(--wa-color-fill-loud, var(--wa-color-neutral-fill-loud)), var(--wa-color-mix-hover));\n}\n.searchListItem {\n  background: var(--wa-color-surface-default);\n  border-bottom: 1px solid var(--wa-color-surface-border);\n  padding-left: 8px;\n}\n.header__fd-actions {\n  color: var(--wa-color-text-normal);\n  border-inline-end: 1px solid var(--wa-color-surface-border);\n}\n.badge-light {\n  background-color: #999999;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.min-width-full {\n  min-width: 100%;\n}\n.header__fd-actions {\n  display: flex;\n  width: 170px;\n  box-sizing: border-box;\n  /* padding: 10px; */\n  gap: 0.875rem;\n  color: var(--wa-color-text-normal);\n  flex-direction: column;\n}\n","import { Component, Event, EventEmitter, Host, Prop, h, State, Listen, Watch, Fragment } from '@stencil/core';\nimport { ToBeAssignedService } from '@/services/toBeAssigned.service';\nimport { dateToFormattedString, isWeekend } from '@/utils/utils';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { handleUnAssignedDatesChange } from '@/stores/unassigned_dates.store';\n\n@Component({\n  tag: 'igl-cal-header',\n  styleUrl: 'igl-cal-header.css',\n  scoped: true,\n})\nexport class IglCalHeader {\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Event({ bubbles: true, composed: true }) gotoRoomEvent: EventEmitter<{\n    [key: string]: any;\n  }>;\n  @Event({ bubbles: true, composed: true }) gotoToBeAssignedDate: EventEmitter<{\n    [key: string]: any;\n  }>;\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() today: String;\n  @Prop() propertyid: number;\n  @Prop() unassignedDates;\n  @Prop() to_date: string;\n  @Prop() highlightedDate: string;\n  @State() renderAgain: boolean = false;\n  @State() unassignedRoomsNumber: any = {};\n  // private searchValue: string = '';\n  // private searchList: { [key: string]: any }[] = [];\n  private roomsList: { [key: string]: any }[] = [];\n  private toBeAssignedService = new ToBeAssignedService();\n  dateRef: HTMLIrButtonElement;\n  dateSelectRef: HTMLIrDateSelectElement;\n  componentWillLoad() {\n    try {\n      this.initializeRoomsList();\n\n      if (!this.calendarData.is_vacation_rental) {\n        handleUnAssignedDatesChange('unassigned_dates', newValue => {\n          if (Object.keys(newValue).length > 0) {\n            this.fetchAndAssignUnassignedRooms();\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Error in componentWillLoad:', error);\n    }\n  }\n  @Watch('unassignedDates')\n  handleCalendarDataChanged() {\n    this.fetchAndAssignUnassignedRooms();\n  }\n  private initializeRoomsList() {\n    this.roomsList = [];\n    this.calendarData.roomsInfo.forEach(category => {\n      this.roomsList = this.roomsList.concat(...category.physicalrooms);\n    });\n  }\n\n  private async fetchAndAssignUnassignedRooms() {\n    await this.assignRoomsToDate();\n  }\n\n  private async assignRoomsToDate() {\n    try {\n      const { fromDate, toDate, data } = this.unassignedDates;\n      let dt = new Date(fromDate);\n      dt.setHours(0, 0, 0, 0);\n      let endDate = dt.getTime();\n      while (endDate <= new Date(toDate).getTime()) {\n        const selectedDate = moment(endDate).format('D_M_YYYY');\n        if (data[endDate]) {\n          const result = await this.toBeAssignedService.getUnassignedRooms(\n            { from_date: this.calendarData.from_date, to_date: this.calendarData.to_date },\n            this.propertyid,\n            dateToFormattedString(new Date(endDate)),\n            this.calendarData.roomsInfo,\n            this.calendarData.formattedLegendData,\n          );\n          this.unassignedRoomsNumber[selectedDate] = result.length;\n        } else if (this.unassignedRoomsNumber[selectedDate]) {\n          const res = this.unassignedRoomsNumber[selectedDate] - 1;\n          this.unassignedRoomsNumber[selectedDate] = res < 0 ? 0 : res;\n        }\n        const newEndDate = moment(endDate).add(1, 'days').toDate();\n        newEndDate.setHours(0, 0, 0, 0);\n        endDate = newEndDate.getTime();\n        this.renderView();\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  @Listen('reduceAvailableUnitEvent', { target: 'window' })\n  handleReduceAvailableUnitEvent(event: CustomEvent<{ fromDate: string; toDate: string }>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const { fromDate, toDate } = event.detail;\n    let endDate = new Date(fromDate).getTime();\n    while (endDate < new Date(toDate).getTime()) {\n      const selectedDate = moment(endDate).format('D_M_YYYY');\n      this.unassignedRoomsNumber[selectedDate] = this.unassignedRoomsNumber[selectedDate] - 1;\n      endDate = moment(endDate).add(1, 'days').toDate().getTime();\n    }\n    this.renderView();\n  }\n\n  showToBeAssigned(dayInfo) {\n    if (this.unassignedRoomsNumber[dayInfo.day] || 0) {\n      this.handleOptionEvent('showAssigned');\n      setTimeout(() => {\n        this.gotoToBeAssignedDate.emit({\n          key: 'gotoToBeAssignedDate',\n          data: dayInfo.currentDate,\n        });\n      }, 100);\n    } else {\n      // do nothing as the value is 0;\n    }\n  }\n\n  handleOptionEvent(key, data: any = '') {\n    this.optionEvent.emit({ key, data });\n  }\n\n  handleDateSelect(event: CustomEvent) {\n    if (Object.keys(event.detail).length > 0) {\n      this.handleOptionEvent('calendar', event.detail);\n    }\n  }\n\n  handleClearSearch() {\n    // this.searchValue = '';\n    // this.searchList = [];\n    this.renderView();\n  }\n\n  handleFilterRooms(event: Event) {\n    const inputElement = event.target as HTMLInputElement;\n    let value = inputElement.value.trim();\n    // this.searchValue = value;\n    value = value.toLowerCase();\n    if (value === '') {\n      this.handleClearSearch();\n    } else {\n      // this.searchList = this.roomsList.filter(room => room.name.toLocaleLowerCase().indexOf(value) != -1);\n    }\n    this.renderView();\n  }\n\n  handleScrollToRoom(roomId) {\n    this.handleClearSearch();\n    this.gotoRoomEvent.emit({ key: 'gotoRoom', roomId });\n  }\n\n  getStringDateFormat(dt) {\n    return dt.getFullYear() + '-' + (dt.getMonth() < 9 ? '0' : '') + (dt.getMonth() + 1) + '-' + (dt.getDate() <= 9 ? '0' : '') + dt.getDate();\n  }\n\n  getNewBookingModel() {\n    let today = new Date();\n    today.setHours(0, 0, 0, 0);\n    let from_date = this.getStringDateFormat(today);\n    today.setDate(today.getDate() + 1);\n    today.setHours(0, 0, 0, 0);\n    let to_date = this.getStringDateFormat(today);\n    return {\n      ID: '',\n      NAME: '',\n      EMAIL: '',\n      PHONE: '',\n      REFERENCE_TYPE: 'PHONE',\n      FROM_DATE: from_date, // \"2023-07-09\",\n      TO_DATE: to_date, // \"2023-07-11\",\n      roomsInfo: this.calendarData.roomsInfo,\n      TITLE: locales.entries.Lcz_NewBooking,\n      event_type: 'PLUS_BOOKING',\n      legendData: this.calendarData.formattedLegendData,\n      defaultDateRange: {\n        fromDate: new Date(from_date), //new Date(\"2023-09-10\"),\n        fromDateStr: '', //\"10 Sep 2023\",\n        toDate: new Date(to_date), //new Date(\"2023-09-15\"),\n        toDateStr: '', // \"15 Sep 2023\",\n        dateDifference: 0,\n        editabled: true,\n        message: '',\n      },\n    };\n  }\n\n  renderView() {\n    this.renderAgain = !this.renderAgain;\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"stickyCell align-items-center topLeftCell preventPageScroll\">\n          <div class=\"header__fd-actions\">\n            <div class=\"row justify-content-around no-gutters\" style={{ gap: '0' }}>\n              {!this.calendarData.is_vacation_rental && (\n                <Fragment>\n                  <wa-tooltip for=\"fd-unassigned-dates_btn\">{locales.entries.Lcz_UnassignedUnitsTooltip}</wa-tooltip>\n                  <ir-custom-button id=\"fd-unassigned-dates_btn\" variant=\"neutral\" appearance=\"plain\" onClickHandler={() => this.handleOptionEvent('showAssigned')}>\n                    <wa-icon\n                      style={{ fontSize: '1.5rem' }}\n                      name=\"server\"\n                      label={locales.entries.Lcz_UnassignedUnitsTooltip}\n                      aria-label={locales.entries.Lcz_UnassignedUnitsTooltip}\n                    ></wa-icon>\n                  </ir-custom-button>\n                </Fragment>\n              )}\n              {/* <ir-date-picker\n                minDate={moment().add(-2, 'months').startOf('month').format('YYYY-MM-DD')}\n                // autoApply\n                // singleDatePicker\n                onDateChanged={evt => {\n                  console.log('evt', evt);\n                  this.handleDateSelect(evt);\n                }}\n                // class=\"datePickerHidden\"\n                class={'date_btn'}\n                title={locales.entries.Lcz_Navigate}\n                data-toggle=\"tooltip\"\n                data-placement=\"bottom\"\n              >\n                <ir-custom-button slot=\"trigger\" id=\"fd-dates-navigation_btn\" variant=\"neutral\" appearance=\"plain\" onClickHandler={() => this.handleOptionEvent('calendar')}>\n                  <wa-icon\n                    style={{ fontSize: '1.5rem' }}\n                    name=\"calendar\"\n                    variant=\"regular\"\n                    label={locales.entries.Lcz_Navigate}\n                    aria-label={locales.entries.Lcz_Navigate}\n                  ></wa-icon>\n                </ir-custom-button>\n              </ir-date-picker> */}\n              <wa-tooltip for=\"fd-dates-navigation_btn\">{locales.entries.Lcz_Navigate}</wa-tooltip>\n              <ir-date-select\n                minDate={moment().add(-2, 'months').startOf('month').format('YYYY-MM-DD')}\n                onDateChanged={evt => {\n                  console.log('evt', evt);\n                  this.handleDateSelect(evt);\n                }}\n                ref={el => (this.dateSelectRef = el)}\n              >\n                <ir-custom-button slot=\"trigger\" id=\"fd-dates-navigation_btn\" variant=\"neutral\" appearance=\"plain\" onClickHandler={() => this.handleOptionEvent('calendar')}>\n                  <wa-icon\n                    style={{ fontSize: '1.5rem' }}\n                    name=\"calendar\"\n                    variant=\"regular\"\n                    label={locales.entries.Lcz_Navigate}\n                    aria-label={locales.entries.Lcz_Navigate}\n                  ></wa-icon>\n                </ir-custom-button>\n                <div class=\"fd-dates__actions\">\n                  <wa-divider></wa-divider>\n                  <ir-custom-button\n                    variant=\"neutral\"\n                    appearance=\"outlined\"\n                    onClickHandler={() => {\n                      this.handleOptionEvent('gotoToday');\n                      this.dateSelectRef.closeDatePicker();\n                    }}\n                  >\n                    Today\n                  </ir-custom-button>\n                </div>\n              </ir-date-select>\n              {/* <Fragment>\n                <wa-tooltip for=\"fd-today-navigation_btn\">{locales.entries.Lcz_Today}</wa-tooltip>\n                <ir-custom-button slot=\"trigger\" id=\"fd-today-navigation_btn\" variant=\"neutral\" appearance=\"plain\" onClickHandler={() => this.handleOptionEvent('gotoToday')}>\n                  <wa-icon style={{ fontSize: '1.5rem' }} name=\"clock\" variant=\"regular\" label={locales.entries.Lcz_Today} aria-label={locales.entries.Lcz_Today}></wa-icon>\n                </ir-custom-button>\n              </Fragment> */}\n              <Fragment>\n                <wa-tooltip for=\"fd-new-booking_btn\">{locales.entries.Lcz_CreateNewBooking}</wa-tooltip>\n                <ir-custom-button\n                  slot=\"trigger\"\n                  id=\"fd-new-booking_btn\"\n                  variant=\"neutral\"\n                  appearance=\"plain\"\n                  onClickHandler={() => this.handleOptionEvent('add', this.getNewBookingModel())}\n                >\n                  <wa-icon style={{ fontSize: '1.5rem' }} name=\"plus\" label={locales.entries.Lcz_CreateNewBooking} aria-label={locales.entries.Lcz_CreateNewBooking}></wa-icon>\n                </ir-custom-button>\n              </Fragment>\n              <Fragment>\n                <wa-tooltip for=\"fd-stop-open-sale_btn\">{locales.entries.Lcz_StopOpenSale}</wa-tooltip>\n                <ir-custom-button\n                  slot=\"trigger\"\n                  id=\"fd-stop-open-sale_btn\"\n                  variant=\"neutral\"\n                  appearance=\"plain\"\n                  onClickHandler={() => this.handleOptionEvent('bulk', this.getNewBookingModel())}\n                >\n                  <wa-icon\n                    variant=\"regular\"\n                    style={{ fontSize: '1.5rem' }}\n                    name=\"calendar-xmark\"\n                    label={locales.entries.Lcz_StopOpenSale}\n                    aria-label={locales.entries.Lcz_StopOpenSale}\n                  ></wa-icon>\n                </ir-custom-button>\n              </Fragment>\n\n              {/* <div\n              class=\"caledarBtns\"\n              onClick={() => this.handleOptionEvent('add', this.getNewBookingModel())}\n              data-toggle=\"tooltip\"\n              data-placement=\"bottom\"\n              title={locales.entries.Lcz_CreateNewBooking}\n            >\n\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" class=\"svg-icon\">\n                <path\n                  fill=\"#6b6f82\"\n                  d=\"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z\"\n                />\n              </svg>\n            </div> */}\n            </div>\n            {/* <div class=\"row justify-content-around no-gutters searchContiner\">\n            <ir-m-combobox\n              placeholder={locales.entries.Lcz_FindUnit}\n              options={this.roomsList.map(r => ({\n                label: r.name,\n                value: r.id,\n              }))}\n              onOptionChange={e => {\n                console.log(e.detail.value);\n                this.handleScrollToRoom(e.detail.value);\n              }}\n            ></ir-m-combobox>\n          </div> */}\n            <div class=\"searchContiner\">\n              <ir-picker\n                size=\"small\"\n                onCombobox-select={e => {\n                  this.handleScrollToRoom(Number(e.detail.item.value));\n                }}\n              >\n                {this.roomsList.map(room => (\n                  <ir-picker-item label={room.name} value={room.id}>\n                    {room.name}\n                  </ir-picker-item>\n                ))}\n              </ir-picker>\n            </div>\n          </div>\n        </div>\n        <div class=\"stickyCell headersContainer\">\n          <div class=\"monthsContainer\">\n            {this.calendarData.monthsInfo.map(monthInfo => (\n              <div class=\"monthCell\" style={{ width: monthInfo.daysCount * 58 + 'px' }}>\n                <div class=\"monthTitle\">{monthInfo.monthName}</div>\n              </div>\n            ))}\n          </div>\n          {this.calendarData.days.map(dayInfo => {\n            return (\n              <div\n                class={`headerCell align-items-center ${'day-' + dayInfo.day} ${dayInfo.day === this.today || dayInfo.day === this.highlightedDate ? 'currentDay' : ''}`}\n                data-day={dayInfo.day}\n              >\n                {!this.calendarData.is_vacation_rental && (\n                  <div class=\"preventPageScroll\" onClick={() => this.showToBeAssigned(dayInfo)}>\n                    {this.unassignedRoomsNumber[dayInfo.day] || dayInfo.unassigned_units_nbr !== 0 ? (\n                      <button class={'fd-header__badge-btn'}>\n                        <wa-badge class=\"fd-header__badge\" variant={'brand'} appearance={'accent'} pill>\n                          {this.unassignedRoomsNumber[dayInfo.day] || dayInfo.unassigned_units_nbr}\n                        </wa-badge>\n                      </button>\n                    ) : (\n                      <wa-badge variant={'neutral'} appearance={'filled'} pill>\n                        {' '}\n                        {this.unassignedRoomsNumber[dayInfo.day] || dayInfo.unassigned_units_nbr}\n                      </wa-badge>\n                    )}\n                    {/* <span\n                      class={`badge badge-${this.unassignedRoomsNumber[dayInfo.day] || dayInfo.unassigned_units_nbr !== 0 ? 'info pointer' : 'light'} badge-pill`}\n                      \n                    >\n                      {this.unassignedRoomsNumber[dayInfo.day] || dayInfo.unassigned_units_nbr}\n                    </span> */}\n                  </div>\n                )}\n\n                <div class={{ dayTitle: true, weekend: isWeekend(dayInfo.value) }}>{dayInfo.dayDisplayName}</div>\n                <div class=\"dayCapacityPercent\">{dayInfo.occupancy}%</div>\n              </div>\n            );\n          })}\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n\n/* Legend */\n\n.legendHeader {\n  font-weight: 500;\n  letter-spacing: 0.05rem;\n  font-size: 1.12rem;\n  padding-top: 5px;\n  margin-bottom: 1rem;\n}\n\n.legendCloseBtn {\n  position: absolute;\n  top: 50%;\n  right: 0;\n  cursor: pointer;\n  font-size: 1.75em;\n  line-height: 1em;\n  padding: 0.4rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 3px;\n  transform: translateY(-50%);\n}\n\n.legendCloseBtn:hover {\n  background-color: #f6f6f6;\n}\n\n.stickyHeader {\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0;\n  background-color: #ffffff;\n  z-index: 1;\n}\n\n.legendRow {\n  position: relative;\n  vertical-align: middle;\n  margin-bottom: 0.3rem;\n}\n\n.legendRow div {\n  display: inline-block;\n  vertical-align: middle;\n}\n\n.legend_skew,\n.legend_skew-bordered,\n.legend_skewsplit {\n  transform: skew(-22deg);\n  width: 15px;\n  height: 16px;\n  border-radius: 4px;\n  background-color: var(--ir-skew-background);\n}\n.legend_skew.striped.vertical {\n  --stripe-period: 17px;\n  --stripe-angle: 360deg;\n}\n.legend_skew.striped {\n  --stripe-period: 6px;\n  background: repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-skew-background) 0,\n    var(--ir-skew-background) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  );\n}\n.legend_skew.split {\n  border-right: 4px solid black;\n}\n.legend_skew-bordered {\n  border: 1px solid black;\n}\n.legend_dirty-unit {\n  background-color: white !important;\n  border: 1px solid #e0e0e0;\n  height: 12px;\n  width: 20px;\n  margin-right: 1rem;\n  position: relative;\n}\n.legend_dirty-unit::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  height: 100%;\n  left: 30%;\n  right: 30%;\n  background-color: #d4d0be !important;\n}\n\n.legend_circle {\n  border-radius: 100%;\n  width: 10px;\n  height: 10px;\n  margin: 3px 3px 3px 2px;\n}\n\n.legend_skewsplit {\n  border-right: 2px solid #000000;\n}\n.headerCell .blueColor {\n  background-color: #31bef1;\n}\n.greenColor {\n  background-color: #45b16d;\n}\n.yellowColor {\n  background-color: #f4d552;\n}\n.greyColor {\n  background-color: var(--wa-color-surface-border);\n}\n.redColor {\n  background-color: #f34752;\n}\n.pinkColor {\n  background-color: #f9b4b7;\n}\n\n/* Legend Calendar */\n\n.legendCalendar .legendRow {\n  margin-bottom: 0;\n}\n\n.legendCalendar .legendRow:first-child .legendCal {\n  background-color: var(--wa-color-neutral-fill-normal);\n  color: var(--wa-color-neutral-on-normal);\n}\n\n.legendCalendar .legendRow div {\n  display: inline-block;\n  vertical-align: middle;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.total-availability {\n  font-size: 1em !important;\n}\n.legendCalendar .legendCal {\n  width: 80px;\n  height: 25px;\n  text-align: center;\n  display: inline-grid !important;\n  align-content: center;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.legendCalendar .legendCal .badge {\n  margin-top: 0.2rem;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.legendCalendar .legendCal.legendCal-h2 {\n  height: 40px;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.br-t {\n  border-top: 1px solid var(--wa-color-surface-border);\n}\n.br-s {\n  border-left: 1px solid var(--wa-color-surface-border);\n  border-right: 1px solid var(--wa-color-surface-border);\n}\n.br-bt {\n  border-bottom: 1px solid var(--wa-color-surface-border);\n}\n\n.highphenLegend {\n  font-size: 0.9em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.highphenLegend::before {\n  width: 12px;\n  height: 0.5px;\n  content: ' ';\n  background-color: #000000;\n  vertical-align: middle;\n  display: inline-block;\n  margin-left: 5px;\n  margin-right: 5px;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n/* .badge-pill {\n  padding: 4px 1.1em;\n  font-size: 0.9em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n} */\n.badge-pill {\n  padding: 3px 1em;\n  font-size: 0.8em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.legendRow-editor {\n  vertical-align: top;\n}\n\n.legendColorCell {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding-right: 0.5rem;\n}\n\n.legendColorPicker {\n  appearance: none;\n  border: none;\n  background: none;\n  cursor: pointer;\n  width: 30px;\n  height: 30px;\n  padding: 0;\n}\n\n.legendColorPicker::-webkit-color-swatch {\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n}\n\n.legendColorPicker::-moz-color-swatch {\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n}\n\n.legendDetailsCell {\n  min-width: 220px;\n}\n\n.legendInput,\n.legendTextarea {\n  width: 100%;\n  border: 1px solid #d8d8d8;\n  border-radius: 4px;\n  padding: 0.4rem 0.6rem;\n  font-size: 0.85rem;\n  display: block;\n}\n\n.legendInput {\n  margin-bottom: 0.4rem;\n}\n\n.legendTextarea {\n  resize: vertical;\n}\n\n.legendActionsCell {\n  width: 32px;\n  text-align: right;\n}\n\n.legendRemoveBtn {\n  border: none;\n  background: none;\n  cursor: pointer;\n  font-size: 1.2rem;\n  line-height: 1;\n  color: var(--wa-color-surface-border);\n  padding: 0;\n}\n\n.legendRemoveBtn:hover,\n.legendRemoveBtn:focus {\n  color: #5c5c5c;\n}\n\n.legendEditorFooter {\n  margin-top: 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.legendAddBtn {\n  border: 1px solid #d8d8d8;\n  border-radius: 4px;\n  background-color: #ffffff;\n  padding: 0.35rem 0.75rem;\n  font-size: 0.85rem;\n  cursor: pointer;\n}\n\n.legendAddBtn:hover,\n.legendAddBtn:focus {\n  border-color: #b3b3b3;\n}\n\n.legendStatus {\n  font-size: 0.75rem;\n}\n\n.legendStatus.saving {\n  color: #6b6f82;\n}\n\n.legendStatus.success {\n  color: #2e7d32;\n}\n\n.legendStatus.error {\n  color: #d32f2f;\n}\n\n.headerCell {\n  width: 70px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.dayTitle {\n  font-size: 0.8em;\n  font-weight: 600;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.dayCapacityPercent {\n  font-size: 0.75em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.legend_rectangle {\n  height: 12px;\n  width: 20px;\n  margin-right: 1rem;\n}\n","import { BookingColor } from '@/models/booking.dto';\nimport { PropertyService } from '@/services/property.service';\nimport calendar_data from '@/stores/calendar-data';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\ntype SaveState = 'idle' | 'saving' | 'saved' | 'error';\n\n@Component({\n  tag: 'igl-legends',\n  styleUrl: 'igl-legends.css',\n  scoped: true,\n})\nexport class IglLegends {\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Prop() legendData: { [key: string]: any };\n  private propertyService = new PropertyService();\n\n  @State() bookingColors: BookingColor[] = [];\n  @State() saveState: SaveState = 'idle';\n  @State() saveError?: string;\n  @State() loadingIndex: number[] = [];\n\n  private saveTimeout?: number;\n\n  disconnectedCallback() {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout);\n    }\n  }\n\n  @Watch('saveState')\n  handleSaveStateChange(newValue: SaveState) {\n    if (newValue === 'error' || newValue === 'idle') {\n      this.loadingIndex = [];\n    }\n  }\n\n  handleOptionEvent(key, data = '') {\n    this.optionEvent.emit({ key, data });\n  }\n\n  private syncCalendarExtra(colors: BookingColor[]) {\n    const calendarExtra = calendar_data.property.calendar_extra ?? {};\n    calendar_data.property.calendar_extra = {\n      ...calendarExtra,\n      booking_colors: colors.map(color => ({ ...color })),\n    };\n  }\n\n  private get propertyId(): number | null {\n    return calendar_data.property?.id ?? calendar_data.property.id ?? null;\n  }\n\n  private updateBookingColor(index: number, patch: Partial<BookingColor>) {\n    const bookingColors = calendar_data.property.calendar_extra?.booking_colors.map((color, idx) => (idx === index ? { ...color, ...patch } : color));\n    this.syncCalendarExtra(bookingColors);\n    if (this.saveState === 'saved') {\n      this.saveState = 'idle';\n    }\n  }\n\n  private async persistBookingColors() {\n    const propertyId = this.propertyId;\n    if (!propertyId) {\n      return;\n    }\n\n    if (this.saveState === 'saving') {\n      return;\n    }\n    this.saveState = 'saving';\n    this.saveError = undefined;\n\n    try {\n      await this.propertyService.setPropertyCalendarExtra({\n        property_id: propertyId,\n        value: JSON.stringify(calendar_data.property.calendar_extra),\n      });\n      this.saveState = 'saved';\n      if (this.saveTimeout) {\n        clearTimeout(this.saveTimeout);\n      }\n      this.saveTimeout = window.setTimeout(() => {\n        this.saveState = 'idle';\n        this.saveTimeout = undefined;\n      }, 2000);\n    } catch (error) {\n      this.saveState = 'error';\n      this.saveError = error instanceof Error ? error.message : String(error);\n    }\n  }\n\n  private handleNameInput(index: number, value: string) {\n    this.updateBookingColor(index, { name: value });\n  }\n\n  private handleBlur(index: number) {\n    this.persistBookingColors();\n    if (!this.loadingIndex.includes(index)) {\n      this.loadingIndex = [...this.loadingIndex, index];\n    }\n  }\n\n  private handleLoaderComplete(index: number) {\n    this.loadingIndex = this.loadingIndex.filter(currentIndex => currentIndex !== index);\n  }\n\n  render() {\n    return (\n      <Host class=\"legendContainer pr-1 text-left pb-4\">\n        <div class={'w-full'}>\n          <div class={'w-full'}>\n            <div class=\"stickyHeader pt-1 \">\n              <p class=\"legendHeader\">{locales.entries.Lcz_Legend}</p>\n              <div class=\"legendCloseBtn\" onClick={() => this.handleOptionEvent('closeSideMenu')}>\n                {/* <i class=\"ft-chevrons-left\"></i> */}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" height={18} width={18}>\n                  <path\n                    fill=\"#6b6f82\"\n                    d=\"M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160zm352-160l-160 160c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L301.3 256 438.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0z\"\n                  />\n                </svg>\n              </div>\n              <hr />\n            </div>\n            <div class=\"mt-2 pl-1\">\n              <table>\n                {(() => {\n                  const legendInfo = this.legendData.find(l => l.id === '14');\n                  return (\n                    <tr>\n                      <td>\n                        <div class={`legend_${legendInfo.design}`} style={{ '--ir-skew-background': legendInfo.color }}></div>\n                      </td>\n                      <td>\n                        <div class={'d-flex align-items-center'} style={{ gap: '0.5rem' }}>\n                          <span class=\"font-small-3\">{legendInfo.name}</span>\n                          <ir-new-badge></ir-new-badge>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })()}\n\n                {this.legendData.map(legendInfo => {\n                  if (['1', '2', '3', '14'].includes(legendInfo.id)) {\n                    return null;\n                  }\n                  const stripeColor = calendar_data.colorsForegrounds[legendInfo?.color];\n                  return (\n                    <tr key={`legend_${legendInfo.id}`} class=\"legendRow \">\n                      <td>\n                        {legendInfo.design === 'broom' ? (\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"13.5\" viewBox=\"0 0 576 512\" style={{ display: 'block' }}>\n                            <path\n                              fill=\"black\"\n                              d=\"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z\"\n                            />\n                          </svg>\n                        ) : legendInfo.design === 'check' ? (\n                          <svg height={14} width={14} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\">\n                            <path\n                              fill=\"green\"\n                              d=\"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z\"\n                            />\n                          </svg>\n                        ) : (\n                          <div\n                            class={`legend_${legendInfo.design} ${\n                              ['1', '7'].includes(legendInfo.id.toString()) ? `striped ${legendInfo.id.toString() === '1' ? 'vertical' : ''}` : ''\n                            }`}\n                            style={{ '--ir-skew-background': legendInfo.color, '--ir-event-bg-stripe-color': stripeColor?.stripe, 'backgroundColor': legendInfo.color }}\n                          ></div>\n                        )}\n                      </td>\n                      <td>\n                        <div class={'d-flex align-items-center'} style={{ gap: '0.5rem' }}>\n                          <span class=\"font-small-3\">{legendInfo.name}</span>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n                <tr>\n                  <td colSpan={2}>\n                    <hr style={{ marginTop: '0.5rem', marginBottom: '0.5rem' }} />\n                  </td>\n                </tr>\n                <tr>\n                  <th colSpan={2} class=\"\" style={{ paddingBottom: '0.5rem' }}>\n                    <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                      <span>Default colors</span>\n                    </div>\n                  </th>\n                </tr>\n                {this.legendData.map(legendInfo => {\n                  if (!['1', '2', '3'].includes(legendInfo.id)) {\n                    return null;\n                  }\n                  const stripeColor = calendar_data.colorsForegrounds[legendInfo?.color];\n                  return (\n                    <tr key={`legend_${legendInfo.id}`} class=\"legendRow \">\n                      <td>\n                        {legendInfo.design === 'broom' ? (\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"13.5\" viewBox=\"0 0 576 512\" style={{ display: 'block' }}>\n                            <path\n                              fill=\"black\"\n                              d=\"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z\"\n                            />\n                          </svg>\n                        ) : legendInfo.design === 'check' ? (\n                          <svg height={14} width={14} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\">\n                            <path\n                              fill=\"green\"\n                              d=\"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z\"\n                            />\n                          </svg>\n                        ) : (\n                          <div\n                            class={`legend_${legendInfo.design} ${\n                              ['1', '7'].includes(legendInfo.id.toString()) ? `striped ${legendInfo.id.toString() === '1' ? 'vertical' : ''}` : ''\n                            }`}\n                            style={{ '--ir-skew-background': legendInfo.color, '--ir-event-bg-stripe-color': stripeColor?.stripe, 'backgroundColor': legendInfo.color }}\n                          ></div>\n                        )}\n                      </td>\n                      <td>\n                        <div class={'d-flex align-items-center'} style={{ gap: '0.5rem' }}>\n                          <span class=\"font-small-3\">{legendInfo.name}</span>\n                          {legendInfo.id === '14' && <ir-new-badge></ir-new-badge>}\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n                <tr>\n                  <td colSpan={2}>\n                    <hr style={{ marginTop: '0.5rem', marginBottom: '0.5rem' }} />\n                  </td>\n                </tr>\n                <tr>\n                  <th colSpan={2} style={{ paddingBottom: '0.5rem' }}>\n                    <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                      <span>Use your own colors</span>\n                      <ir-new-badge></ir-new-badge>\n                    </div>\n                  </th>\n                </tr>\n                {calendar_data.property.calendar_extra?.booking_colors.map((legendInfo, index) => {\n                  const previewClass = `legend_${legendInfo.design}`;\n                  return (\n                    <tr key={`legend_${index}`} class=\"legendRow \">\n                      <td>\n                        <div class={previewClass} style={{ backgroundColor: legendInfo.color }}></div>\n                      </td>\n                      <td class=\"legendDetailsCell\">\n                        <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                          <ir-input-text\n                            class=\"legendTextarea border-0 m-0 p-0\"\n                            value={legendInfo.name}\n                            inputContainerStyle={{ margin: '0' }}\n                            placeholder=\"Reason for this color\"\n                            onTextChange={event => this.handleNameInput(index, event.detail)}\n                            onInputBlur={() => this.handleBlur(index)}\n                          ></ir-input-text>\n                          {this.loadingIndex.includes(index) && (this.saveState === 'saving' || this.saveState === 'saved') ? (\n                            <ir-success-loader onLoaderComplete={() => this.handleLoaderComplete(index)}></ir-success-loader>\n                          ) : null}\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </table>\n            </div>\n            <hr style={{ marginTop: '1rem', marginBottom: '0.5rem' }} />\n            <div class=\"mt-1\">\n              <div class=\"legendCalendar\">\n                <div class=\"legendRow align-items-center\">\n                  <div class=\"legendCal br-t br-s br-bt\">\n                    <strong>MAR 2022</strong>\n                  </div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_MonthAndYear}</div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal headerCell align-items-center br-s\">\n                    {/* <span class=\"badge badge-info  badge-pill\">3</span> */}\n                    <wa-badge pill>3</wa-badge>\n                  </div>\n                  <div class=\"highphenLegend\">\n                    <div>{locales.entries.Lcz_UnassignedUnits}</div>\n                  </div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal dayTitle br-s\">Fri 18</div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_Date}</div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal br-s br-bt dayCapacityPercent\">15%</div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_Occupancy}</div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal br-s br-bt  font-weight-bold total-availability\">20</div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_TotalAvailability}</div>\n                </div>\n\n                {/* <div class=\"legendRow align-items-center\">\n                  <div class=\"legendCal br-s br-bt font-small-2\">15</div>\n                  <div class=\"highphenLegend\">\n                    <div>{locales.entries.Lcz_OfflineAvailability}</div>\n                  </div>\n                </div> */}\n              </div>\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  text-align: start;\n}\n\n.dialog-body {\n  display: grid;\n  gap: 1.5rem;\n}\n\n.dialog-body__description {\n  margin: 0;\n}\n\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n}\n","import { EventsService } from '@/services/events.service';\nimport { Component, Element, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\nimport type { IReallocationPayload } from '@/models/property-types';\nimport type { SelectOption } from '@/utils/utils';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n\n@Component({\n  tag: 'igl-reallocation-dialog',\n  styleUrl: 'igl-reallocation-dialog.css',\n  scoped: true,\n})\nexport class IglReallocationDialog {\n  @Element() hostEl!: HTMLElement;\n\n  @Prop() data?: IReallocationPayload;\n\n  @State() selectedRateplan?: string;\n  @State() showRateplanError = false;\n\n  @Event() dialogClose: EventEmitter<boolean>;\n  @Event() revertBooking: EventEmitter<string>;\n  @Event() resetModalState: EventEmitter<void>;\n\n  private dialogEl?: HTMLIrDialogElement;\n  private rateplanSelectEl?: HTMLIrSelectElement;\n  private eventsService = new EventsService();\n\n  @Watch('data')\n  handleDataChange(newData: IReallocationPayload | undefined) {\n    this.resetState(newData);\n    if (newData) {\n      this.dialogEl?.openModal();\n    } else {\n      this.dialogEl?.closeModal();\n    }\n  }\n\n  private async reallocateUnit() {\n    if (!this.data) {\n      return;\n    }\n\n    if (!this.validateRateplanSelection()) {\n      return;\n    }\n\n    const { pool, toRoomId, from_date, to_date, matchedRatePlan } = this.data;\n    try {\n      await this.eventsService.reallocateEvent(\n        pool,\n        toRoomId,\n        from_date,\n        to_date,\n        this.data.rateplans ? Number(this.selectedRateplan) : matchedRatePlan ? Number(matchedRatePlan?.value) : undefined,\n      );\n    } catch (error) {\n      console.log(error);\n      this.revertBooking.emit(pool);\n    } finally {\n      this.dialogEl?.closeModal();\n      this.resetModalState.emit();\n    }\n  }\n\n  private get rateplanOptions(): SelectOption[] {\n    if (!Array.isArray(this.data?.rateplans)) {\n      return [];\n    }\n\n    return this.data.rateplans.map(option => ({\n      ...option,\n      text: this.formatRateplanLabel(option),\n    }));\n  }\n\n  private formatRateplanLabel(option: SelectOption): string {\n    if (!option) {\n      return '';\n    }\n\n    const suffix = option.custom_text ? ` | ${option.custom_text}` : '';\n    return `${option.text}${suffix}`.trim();\n  }\n\n  private hasRateplanRequirement(): boolean {\n    return this.rateplanOptions.length > 0;\n  }\n\n  private validateRateplanSelection(): boolean {\n    if (!this.hasRateplanRequirement()) {\n      return true;\n    }\n\n    if (!this.selectedRateplan) {\n      this.showRateplanError = true;\n      this.focusRateplanSelect();\n      return false;\n    }\n\n    return true;\n  }\n\n  private focusRateplanSelect() {\n    const selectEl = this.rateplanSelectEl?.shadowRoot?.querySelector('select') ?? this.rateplanSelectEl?.querySelector('select');\n    if (selectEl) {\n      selectEl.focus();\n    }\n  }\n\n  private resetState(data?: IReallocationPayload) {\n    if (!data) {\n      this.selectedRateplan = undefined;\n      this.showRateplanError = false;\n      return;\n    }\n\n    this.selectedRateplan = undefined;\n    this.showRateplanError = false;\n  }\n\n  private handleDialogVisibilityChange = (_: CustomEvent) => {\n    this.dialogClose.emit(false);\n  };\n\n  private handleRateplanChange = (value: string) => {\n    this.selectedRateplan = value;\n    this.showRateplanError = false;\n  };\n\n  private handleCancelClick = () => {\n    this.dialogEl?.closeModal();\n    this.dialogClose.emit(false);\n  };\n\n  render() {\n    const hasRateplans = this.hasRateplanRequirement();\n\n    return (\n      <ir-dialog label={'Alert'} ref={el => (this.dialogEl = el)} onIrDialogHide={this.handleDialogVisibilityChange}>\n        {this.data && (\n          <Fragment>\n            <div class=\"dialog-body\">\n              <p class=\"text-left dialog-body__description m-0 p-0\">{this.data.description}</p>\n              {hasRateplans && (\n                // <ir-select\n                //   ref={el => (this.rateplanSelectEl = el)}\n                //   required\n                //   firstOption=\"Select rate plan...\"\n                //   data={this.rateplanOptions.map(option => ({ text: option.text, value: option.value }))}\n                //   error={this.showRateplanError}\n                //   onSelectChange={this.handleRateplanChange}\n                // ></ir-select>\n                <wa-select\n                  onwa-hide={e => {\n                    e.stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  defaultValue={''}\n                  onwa-show={e => {\n                    e.stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  size=\"small\"\n                  aria-invalid={String(this.showRateplanError)}\n                  onchange={e => this.handleRateplanChange((e.target as any).value)}\n                >\n                  <wa-option value=\"\">Select rate plan...</wa-option>\n                  {this.rateplanOptions.map(option => (\n                    <wa-option key={option.value} value={option.value}>\n                      {option.text}\n                    </wa-option>\n                  ))}\n                </wa-select>\n              )}\n            </div>\n            <div class=\"dialog-footer\" slot=\"footer\">\n              <ir-custom-button appearance=\"filled\" variant=\"neutral\" onClickHandler={this.handleCancelClick} size=\"medium\">\n                Cancel\n              </ir-custom-button>\n              <ir-custom-button variant=\"brand\" onClickHandler={() => this.reallocateUnit()} size=\"medium\" loading={isRequestPending('/ReAllocate_Exposed_Room')}>\n                Confirm\n              </ir-custom-button>\n            </div>\n          </Fragment>\n        )}\n      </ir-dialog>\n    );\n  }\n}\n","import { Moment } from 'moment';\nimport { z } from 'zod';\n\nexport type RoomDates = { from_date: Moment; to_date: Moment };\n\nexport const SelectedUnitSchema = z.object({\n  roomtype_id: z.coerce.number(),\n  unit_id: z.coerce.number(),\n  rateplan_id: z.coerce.number(),\n});\n\nexport type SelectedUnit = z.infer<typeof SelectedUnitSchema>;\n",":host {\n  display: block;\n}\n:host {\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 0%;\n  height: 100%;\n}\n.bulk-sheet-container {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  gap: 1rem;\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.physical-room {\n  margin-left: 1rem !important;\n  /* padding-top: 0.5rem; */\n}\n/* target only the last <td> in each .physical-room row */\n.physical-room > td:last-child {\n  padding-left: 1rem; /* or whatever indent you like */\n}\n.room-type-list {\n  padding: 0;\n  margin: 0;\n}\n\n.room-type-list > li,\n.physical-room,\n.room-type-row {\n  list-style: none;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { Booking, Room } from '@/models/booking.dto';\nimport { PropertyRoomType } from '@/models/IBooking';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { resetBookingStore } from '@/stores/booking.store';\nimport calendar_data from '@/stores/calendar-data';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport locales from '@/stores/locales.store';\nimport { checkMealPlan, SelectOption } from '@/utils/utils';\nimport { Component, Event, EventEmitter, Fragment, Prop, State, h } from '@stencil/core';\nimport moment from 'moment';\nimport { ZodError } from 'zod';\nimport { RoomDates, SelectedUnit, SelectedUnitSchema } from './types';\n\n@Component({\n  tag: 'igl-split-booking',\n  styleUrls: ['igl-split-booking.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglSplitBooking {\n  @Prop() booking: Booking;\n  @Prop() identifier: Room['identifier'];\n\n  @State() selectedDates: RoomDates;\n  @State() room: Room;\n  @State() roomTypes: PropertyRoomType[] = [];\n  @State() selectedUnit: Partial<SelectedUnit> = {};\n  @State() isLoading: boolean;\n  @State() errors: Record<string, boolean> | null;\n  @State() mealPlanOptions: SelectOption[] | null = null;\n\n  @Event() closeModal: EventEmitter<null>;\n\n  private defaultDates: RoomDates;\n  private bookingService = new BookingService();\n\n  componentWillLoad() {\n    this.room = this.getRoom();\n    this.defaultDates = { ...this.generateDates(this.room) };\n    this.selectedDates = { ...this.defaultDates };\n    console.log(this.booking);\n  }\n\n  private getRoom() {\n    if (!this.booking) {\n      throw new Error('Missing booking');\n    }\n    if (!this.identifier) {\n      throw new Error('Missing Identifier');\n    }\n    const room = this.booking.rooms.find(r => r.identifier === this.identifier);\n    if (!room) {\n      throw new Error(`Couldn't find room with identifier ${this.identifier}`);\n    }\n    return room;\n  }\n\n  private generateDates(room: Room): RoomDates {\n    let MFromDate = moment(room.from_date, 'YYYY-MM-DD');\n    const MToDate = moment(room.to_date, 'YYYY-MM-DD').add(-1, 'days');\n    const today = moment();\n    if (MFromDate.isBefore(today)) {\n      MFromDate = today.clone();\n    }\n    if (MFromDate.isSame(today)) {\n      return { from_date: MFromDate, to_date: MToDate };\n    }\n    if (MFromDate.isSameOrAfter(today)) {\n      return { from_date: MFromDate.clone().add(1, 'days'), to_date: MToDate };\n    }\n    return { from_date: today.clone().add(1, 'days'), to_date: MToDate };\n  }\n\n  private async checkBookingAvailability() {\n    resetBookingStore(false);\n    const from_date = this.selectedDates.from_date.format('YYYY-MM-DD');\n    const to_date = this.selectedDates.to_date.format('YYYY-MM-DD');\n\n    const is_in_agent_mode = this.booking.agent !== null;\n    try {\n      const data = await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: this.booking.property.id,\n        adultChildCount: {\n          adult: 1,\n          child: 0,\n        },\n        language: 'en',\n        room_type_ids: [],\n        currency: this.booking.currency,\n        agent_id: is_in_agent_mode ? this.booking.agent.id : null,\n        is_in_agent_mode,\n        room_type_ids_to_update: [],\n      });\n      this.roomTypes = data as any as PropertyRoomType[];\n    } catch (error) {\n      console.error('Error initializing booking availability:', error);\n    }\n  }\n\n  private async doReservation() {\n    try {\n      this.isLoading = true;\n      this.errors = null;\n      const selectedUnit = SelectedUnitSchema.parse(this.selectedUnit);\n      const oldRooms = this.booking.rooms.filter(r => r.identifier !== this.identifier);\n      const canCheckIn = this.room.in_out?.code === '001' ? (moment().isBefore(this.selectedDates.from_date) ? false : true) : false;\n      let rooms = [\n        ...oldRooms,\n        {\n          ...this.room,\n          from_date: this.room.from_date,\n          to_date: this.selectedDates.from_date.format('YYYY-MM-DD'),\n          days: this.room.days.filter(r => moment(r.date, 'YYYY-MM-DD').isBefore(this.selectedDates.from_date, 'dates')),\n          departure_time: null,\n        },\n        {\n          ...this.room,\n          identifier: null,\n          in_out: canCheckIn\n            ? this.room.in_out\n            : {\n                code: '000',\n              },\n          check_in: canCheckIn,\n          assigned_units_pool: null,\n          parent_room_identifier: this.room.identifier,\n          is_split: true,\n          roomtype: {\n            id: selectedUnit.roomtype_id,\n          },\n          rateplan: {\n            id: selectedUnit.rateplan_id || this.room.rateplan.id,\n          },\n          departure_time: this.room.departure_time,\n          unit: { id: selectedUnit.unit_id },\n          from_date: this.selectedDates.from_date.format('YYYY-MM-DD'),\n          // to_date: this.selectedDates.to_date.format('YYYY-MM-DD'),\n          days: this.room.days.filter(r => moment(r.date, 'YYYY-MM-DD').isSameOrAfter(this.selectedDates.from_date, 'dates')),\n        },\n      ];\n      const booking = {\n        assign_units: true,\n        is_pms: true,\n        is_direct: this.booking.is_direct,\n        is_backend: true,\n        is_in_loyalty_mode: this.booking.is_in_loyalty_mode,\n        promo_key: this.booking.promo_key,\n        extras: this.booking.extras,\n        agent: this.booking.agent,\n        booking: {\n          from_date: this.booking.from_date,\n          to_date: this.booking.to_date,\n          remark: this.booking.remark,\n          booking_nbr: this.booking.booking_nbr,\n          property: this.booking.property,\n          booked_on: this.booking.booked_on,\n          source: this.booking.source,\n          rooms,\n          currency: this.booking.currency,\n          arrival: this.booking.arrival,\n          guest: this.booking.guest,\n        },\n        pickup_info: this.booking.pickup_info,\n      };\n      console.log(booking);\n      await this.bookingService.doReservation(booking);\n      this.closeModal.emit(null);\n    } catch (error) {\n      const err: Record<string, boolean> = {};\n      if (error instanceof ZodError) {\n        console.error(error);\n        error.issues.forEach(i => {\n          err[i.path[0]] = true;\n        });\n        this.errors = { ...err };\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private updateSelectedUnit(params: Partial<SelectedUnit>) {\n    const merged: Partial<SelectedUnit> = { ...this.selectedUnit, ...params };\n    const roomTypesSource = calendar_data?.property?.roomtypes;\n    const mealPlanResult = checkMealPlan({\n      rateplan_id: this.room.rateplan.id.toString(),\n      roomTypeId: merged?.roomtype_id,\n      roomTypes: roomTypesSource,\n    });\n\n    const hasExplicitRateplanUpdate = Object.prototype.hasOwnProperty.call(params, 'rateplan_id');\n\n    if (Array.isArray(mealPlanResult)) {\n      this.mealPlanOptions = mealPlanResult;\n      if (!hasExplicitRateplanUpdate) {\n        delete merged.rateplan_id;\n      }\n    } else {\n      this.mealPlanOptions = null;\n      if (!hasExplicitRateplanUpdate) {\n        if (mealPlanResult) {\n          merged.rateplan_id = Number(mealPlanResult.value);\n        } else {\n          delete merged.rateplan_id;\n        }\n      }\n    }\n\n    this.selectedUnit = merged;\n  }\n\n  render() {\n    return (\n      <form\n        onSubmit={e => {\n          e.preventDefault();\n          this.doReservation();\n        }}\n        class=\"sheet-container\"\n      >\n        <ir-title class=\"px-1 sheet-header mb-0\" displayContext=\"sidebar\" onCloseSideBar={() => this.closeModal.emit()} label={`Split unit ${this.room?.unit['name']}`}></ir-title>\n        <section class=\"px-1 sheet-body\">\n          <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n            <div>\n              <ir-date-view from_date={this.room.from_date} to_date={this.room.to_date} showDateDifference={false}></ir-date-view>\n            </div>\n            <p class=\"m-0 p-0\">\n              {this.room.rateplan.short_name} {this.room.rateplan.is_non_refundable ? locales.entries.Lcz_NonRefundable : ''}\n            </p>\n          </div>\n          <div class={'d-flex align-items-center mt-1'} style={{ gap: '0.5rem' }}>\n            <span>From:</span>\n            <ir-date-picker\n              data-testid=\"pickup_arrival_date\"\n              date={this.selectedDates?.from_date?.format('YYYY-MM-DD')}\n              maxDate={this.defaultDates?.to_date.format('YYYY-MM-DD')}\n              minDate={this.defaultDates?.from_date.format('YYYY-MM-DD')}\n              emitEmptyDate={true}\n              // aria-invalid={this.errors?.arrival_date && !this.pickupData.arrival_date ? 'true' : 'false'}\n              onDateChanged={evt => {\n                this.selectedDates = {\n                  ...this.selectedDates,\n                  from_date: evt.detail.start,\n                };\n              }}\n            >\n              <input\n                type=\"text\"\n                slot=\"trigger\"\n                value={this.selectedDates.from_date ? this.selectedDates.from_date.format('MMM DD, YYYY') : null}\n                class={`form-control input-sm  text-center`}\n                style={{ width: '120px' }}\n              ></input>\n            </ir-date-picker>\n            <ir-button isLoading={isRequestPending('/Check_Availability')} text=\"Check available units\" size=\"sm\" onClick={() => this.checkBookingAvailability()}></ir-button>\n          </div>\n          {this.errors?.roomtype_id && <p class=\"text-danger text-left mt-2\">Please select a room</p>}\n          <ul class=\"room-type-list mt-2\">\n            {this.roomTypes?.map(roomType => {\n              if (!roomType.is_available_to_book) {\n                return null;\n              }\n              const units = (() => {\n                const unitMap = new Map<number, string>();\n                for (const rateplan of roomType.rateplans ?? []) {\n                  for (const unit of rateplan.assignable_units ?? []) {\n                    if (unit.Is_Fully_Available) {\n                      unitMap.set(unit.pr_id, unit.name);\n                    }\n                  }\n                }\n\n                return Array.from(unitMap, ([id, name]) => ({ id, name }));\n              })();\n              return (\n                <Fragment>\n                  <li key={`roomTypeRow-${roomType.id}`} class={`room-type-row`}>\n                    <div class={'d-flex choice-row'}>\n                      <span class=\"text-left room-type-name\">{roomType.name}</span>\n                    </div>\n                  </li>\n                  {units.map((room, j) => {\n                    const row_style = j === roomType.physicalrooms.length - 1 ? 'pb-1' : '';\n                    const showMealPlanSelect = this.selectedUnit?.unit_id === room.id && Array.isArray(this.mealPlanOptions) && this.mealPlanOptions.length > 0;\n                    return (\n                      <li key={`physicalRoom-${room.id}-${j}`} class={`physical-room ${row_style}`}>\n                        <div class={'d-flex choice-row align-items-center'} style={{ gap: '0.5rem' }}>\n                          <ir-radio\n                            class=\"pl-1\"\n                            name=\"unit\"\n                            checked={this.selectedUnit?.unit_id === room.id}\n                            onCheckChange={() =>\n                              this.updateSelectedUnit({\n                                roomtype_id: roomType.id,\n                                unit_id: room.id,\n                              })\n                            }\n                            label={room.name}\n                          ></ir-radio>\n                          {showMealPlanSelect && (\n                            <ir-select\n                              firstOption=\"Select a new rateplan...\"\n                              error={this.errors?.rateplan_id && !this.selectedUnit?.rateplan_id}\n                              onSelectChange={e => {\n                                const value = e.detail === null || e.detail === undefined || e.detail === '' ? undefined : Number(e.detail);\n                                this.updateSelectedUnit({\n                                  rateplan_id: value,\n                                });\n                              }}\n                              data={this.mealPlanOptions.map(e => ({ ...e, text: e.text + `${e.custom_text ? ' | ' : ''}${e.custom_text}` }))}\n                            ></ir-select>\n                            // <ir-dropdown\n                            //   onOptionChange={e => {\n                            //     this.updateSelectedUnit({\n                            //       rateplan_id: Number(e.detail.toString()),\n                            //     });\n                            //   }}\n                            //   style={{ '--ir-dropdown-menu-min-width': 'max-content' }}\n                            // >\n                            //   <button type=\"button\" class=\"btn btn-sm form-control pr-2 d-flex align-items-center\" style={{ minWidth: '200px' }} slot=\"trigger\">\n                            //     {this.selectedUnit?.rateplan_id ? this.mealPlanOptions.find(r => r.value === this.selectedUnit.rateplan_id.toString()).text : 'Choose a meal plan'}\n                            //   </button>\n                            //   {this.mealPlanOptions.map(o => (\n                            //     <ir-dropdown-item value={o.value}>\n                            //       <p class=\"m-0 p-0\">\n                            //         {o.text} {o.custom_text && <span class=\"m-0 p-0\">| {o.custom_text}</span>}\n                            //       </p>\n                            //     </ir-dropdown-item>\n                            //   ))}\n                            // </ir-dropdown>\n                          )}\n                        </div>\n                      </li>\n                    );\n                  })}\n                </Fragment>\n              );\n            })}\n          </ul>\n        </section>\n        <div class={'sheet-footer'}>\n          <ir-button text={locales.entries.Lcz_Cancel} btn_color=\"secondary\" class={'flex-fill'} onClickHandler={() => this.closeModal.emit(null)}></ir-button>\n          <ir-button isLoading={this.isLoading} text={locales.entries.Lcz_Confirm} btn_type=\"submit\" class=\"flex-fill\"></ir-button>\n        </div>\n      </form>\n    );\n  }\n}\n",":host {\r\n  display: block;\r\n}\r\n","import { Component, Host, Prop, State, h, Event, EventEmitter } from '@stencil/core';\n\n@Component({\n  tag: 'igl-tba-category-view',\n  styleUrl: 'igl-tba-category-view.css',\n  scoped: true,\n})\nexport class IglTbaCategoryView {\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() selectedDate;\n  @Prop() categoriesData: { [key: string]: any } = {};\n  @Prop() categoryId;\n  @Prop({ mutable: true }) eventDatas;\n  @Prop() categoryIndex;\n\n  @State() renderAgain: boolean = false;\n\n  @Event() assignUnitEvent: EventEmitter<{ [key: string]: any }>;\n\n  handleAssignRoomEvent(event: CustomEvent<{ [key: string]: any }>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    const opt: { [key: string]: any } = event.detail;\n    this.eventDatas = this.eventDatas.filter(eventData => eventData.ID != opt.data.ID);\n    this.calendarData.bookingEvents.push(opt.data);\n    this.assignUnitEvent.emit({\n      key: 'assignUnit',\n      data: {\n        RT_ID: this.categoryId,\n        selectedDate: this.selectedDate,\n        assignEvent: opt.data,\n        calendarData: this.calendarData,\n      },\n    });\n    // if(this.localEventDatas.length){\n    this.renderView();\n    // }\n  }\n\n  getEventView(categoryId, eventDatas) {\n    return eventDatas.map((eventData, ind) => (\n      <igl-tba-booking-view\n        calendarData={this.calendarData}\n        selectedDate={this.selectedDate}\n        eventData={eventData}\n        categoriesData={this.categoriesData}\n        categoryId={categoryId}\n        categoryIndex={this.categoryIndex}\n        eventIndex={ind}\n        onAssignRoomEvent={evt => this.handleAssignRoomEvent(evt)}\n      ></igl-tba-booking-view>\n    ));\n  }\n\n  renderView() {\n    this.renderAgain = !this.renderAgain;\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"sectionContainer\">\n          <div class=\"font-weight-bold mt-1 font-small-3\">{this.categoriesData[this.categoryId]?.name}</div>\n          {this.getEventView(this.categoryId, this.eventDatas)}\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n.custom-dropdown {\n  cursor: pointer;\n  padding: 5px 10px;\n  width: min-content;\n  margin-left: auto;\n  margin-right: auto;\n}\n.dropdown-toggle {\n  all: unset;\n  display: flex;\n  width: max-content;\n  align-items: center;\n  gap: 10px;\n}\n.close_btn_style {\n  padding: 0.4rem;\n}\n.close_btn_style:hover {\n  background-color: #f6f6f6;\n}\n.dropdown-menu {\n  max-height: 250px;\n  overflow-y: auto;\n}\n.tobeAssignedHeader {\n  font-weight: 500;\n  letter-spacing: 0.05rem;\n  font-size: 1.12rem;\n  padding: 0;\n  margin: 0;\n}\n.assignment_header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding-top: 5px;\n  margin-bottom: 1rem;\n}\n.dropdown-toggle::after {\n  content: none;\n  display: none;\n}\n.dropdown-toggle .caret-icon {\n  transition: transform 0.2s ease;\n}\n.show .caret-icon {\n  transform: rotate(-180deg);\n}\n.stickyHeader {\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0;\n  background-color: #ffffff;\n  z-index: 1;\n}\n.pointer {\n  cursor: pointer;\n}\n\n.dots {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 3px;\n  padding: 0;\n}\n.dot {\n  width: 5px;\n  height: 5px;\n  margin: 5px 4px 0;\n  background-color: #6b6f82;\n  border-radius: 50%;\n  animation: dotFlashing 1s infinite linear alternate;\n}\n.dot:nth-child(2) {\n  animation-delay: 0.2s;\n}\n.dot:nth-child(3) {\n  animation-delay: 0.4s;\n}\n\n@keyframes dotFlashing {\n  0% {\n    opacity: 0;\n  }\n  50%,\n  100% {\n    opacity: 1;\n  }\n}\n","import { Component, Host, h, Prop, Event, EventEmitter, State, Listen, Fragment, Watch } from '@stencil/core';\nimport { ToBeAssignedService } from '@/services/toBeAssigned.service';\nimport { dateToFormattedString } from '@/utils/utils';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { getUnassignedDates } from '@/stores/unassigned_dates.store';\nimport { colorVariants } from '@/components/ui/ir-icons/icons';\n//import { updateCategories } from '@/utils/events.utils';\n\n@Component({\n  tag: 'igl-to-be-assigned',\n  styleUrl: 'igl-to-be-assigned.css',\n  scoped: true,\n})\nexport class IglToBeAssigned {\n  @Prop() unassignedDatesProp: any;\n  @Prop() propertyid: number;\n  @Prop() from_date: string;\n  @Prop() to_date: string;\n  @Prop({ mutable: true }) calendarData: { [key: string]: any };\n\n  @State() loadingMessage: string;\n  @State() showDatesList: boolean = false;\n  @State() renderAgain: boolean = false;\n  @State() orderedDatesList: any[] = [];\n  @State() noScroll = false;\n  @State() selectedDateDisplay: string = '';\n\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Event({ bubbles: true, composed: true })\n  reduceAvailableUnitEvent: EventEmitter<{ [key: string]: any }>;\n  @Event() showBookingPopup: EventEmitter;\n  @Event({ bubbles: true, composed: true }) addToBeAssignedEvent: EventEmitter;\n  @Event({ bubbles: true, composed: true })\n  highlightToBeAssignedBookingEvent: EventEmitter;\n\n  private isGotoToBeAssignedDate: boolean = false;\n  private isLoading: boolean = true;\n  private selectedDate = null;\n  private data: { [key: string]: any } = {};\n  private today = new Date();\n  private categoriesData: { [key: string]: any } = {};\n  private toBeAssignedService: ToBeAssignedService = new ToBeAssignedService();\n  private unassignedDates: any;\n\n  componentWillLoad() {\n    this.reArrangeData();\n    this.loadingMessage = locales.entries.Lcz_FetchingUnAssignedUnits;\n  }\n\n  @Watch('unassignedDatesProp')\n  handleUnassignedDatesToBeAssignedChange(newValue: any) {\n    const { fromDate, toDate, data } = newValue;\n    let dt = new Date(fromDate);\n    dt.setHours(0);\n    dt.setMinutes(0);\n    dt.setSeconds(0);\n    let endDate = dt.getTime();\n    while (endDate <= new Date(toDate).getTime()) {\n      if (data && !data[endDate] && this.unassignedDates.hasOwnProperty(endDate)) {\n        delete this.unassignedDates[endDate];\n      } else if (data && data[endDate]) {\n        this.unassignedDates[endDate] = data[endDate];\n      }\n      endDate = moment(endDate).add(1, 'days').toDate().getTime();\n    }\n    this.data = { ...this.unassignedDates };\n    this.orderedDatesList = Object.keys(this.data).sort((a, b) => parseInt(a) - parseInt(b));\n\n    if (this.orderedDatesList.length) {\n      if (this.selectedDate === null) {\n        this.selectedDate = this.orderedDatesList[0];\n      }\n      if (this.selectedDate && this.data[this.selectedDate]) {\n        this.selectedDateDisplay = this.data[this.selectedDate]?.dateStr || this.selectedDateDisplay;\n        this.showForDate(this.selectedDate, false);\n      } else {\n        this.isLoading = false;\n        this.renderView();\n      }\n    } else {\n      this.selectedDate = null;\n      this.selectedDateDisplay = '';\n      this.isLoading = false;\n      this.renderView();\n    }\n  }\n  handleAssignUnit(event: CustomEvent<{ [key: string]: any }>) {\n    const opt: { [key: string]: any } = event.detail;\n    const data = opt.data;\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    if (opt?.key === 'assignUnit' && this.data) {\n      // Verify data.selectedDate exists in this.data\n      if (data?.selectedDate && this.data[data.selectedDate]) {\n        // Check if categories exist and there's only one category\n        if (this.data[data.selectedDate]?.categories && Object.keys(this.data[data.selectedDate]?.categories || {})?.length === 1) {\n          this.isLoading = true;\n          this.noScroll = true;\n        }\n\n        // Make sure all required properties exist before filtering\n        if (\n          data?.RT_ID &&\n          this.data[data.selectedDate]?.categories &&\n          this.data[data.selectedDate].categories[data.RT_ID] &&\n          Array.isArray(this.data[data.selectedDate].categories[data.RT_ID]) &&\n          data?.assignEvent?.ID\n        ) {\n          this.data[data.selectedDate].categories[data.RT_ID] = this.data[data.selectedDate].categories[data.RT_ID].filter(\n            eventData => eventData && eventData.ID !== data.assignEvent.ID,\n          );\n        }\n\n        // Only update calendarData if it exists in the data\n        if (data?.calendarData) {\n          this.calendarData = data.calendarData;\n        }\n\n        this.renderView();\n      }\n    }\n  }\n\n  async updateCategories(key, calendarData) {\n    try {\n      //console.log(\"called\")\n      let categorisedRooms = {};\n      const result = await this.toBeAssignedService.getUnassignedRooms(\n        { from_date: calendarData.from_date, to_date: calendarData.to_date },\n        this.propertyid,\n        dateToFormattedString(new Date(+key)),\n        calendarData.roomsInfo,\n        calendarData.formattedLegendData,\n      );\n      result.forEach(room => {\n        if (!categorisedRooms.hasOwnProperty(room.RT_ID)) {\n          categorisedRooms[room.RT_ID] = [room];\n        } else {\n          categorisedRooms[room.RT_ID].push(room);\n        }\n      });\n      this.unassignedDates[key].categories = categorisedRooms;\n    } catch (error) {\n      //  toastr.error(error);\n    }\n  }\n\n  async reArrangeData() {\n    try {\n      this.today.setHours(0, 0, 0, 0);\n      this.calendarData.roomsInfo.forEach(category => {\n        this.categoriesData[category.id] = {\n          name: category.name,\n          roomsList: category.physicalrooms,\n          roomIds: category.physicalrooms.map(room => {\n            return room.id;\n          }),\n        };\n      });\n\n      this.selectedDate = null;\n      //this.unassignedDates = await this.toBeAssignedService.getUnassignedDates(this.propertyid, dateToFormattedString(new Date()), this.to_date);\n      this.unassignedDates = getUnassignedDates();\n      console.log(this.unassignedDates);\n\n      this.data = this.unassignedDates;\n      this.orderedDatesList = Object.keys(this.data).sort((a, b) => parseInt(a) - parseInt(b));\n\n      if (!this.selectedDate && this.orderedDatesList.length) {\n        this.selectedDate = this.orderedDatesList[0];\n        this.selectedDateDisplay = this.data[this.selectedDate]?.dateStr || '';\n      } else if (!this.orderedDatesList.length) {\n        this.selectedDateDisplay = '';\n      }\n    } catch (error) {\n      console.error('Error fetching unassigned dates:', error);\n      //  toastr.error(error);\n    }\n  }\n  async componentDidLoad() {\n    setTimeout(() => {\n      if (!this.isGotoToBeAssignedDate && Object.keys(this.unassignedDates).length > 0) {\n        //console.log(this.isGotoToBeAssignedDate);\n        const firstKey = Object.keys(this.unassignedDates)[0];\n\n        this.showForDate(firstKey);\n      }\n    }, 100);\n  }\n  @Listen('gotoToBeAssignedDate', { target: 'window' })\n  async gotoDate(event: CustomEvent) {\n    this.isGotoToBeAssignedDate = true;\n    this.showForDate(event.detail.data);\n    this.showDatesList = false;\n    this.renderView();\n  }\n  @Listen('highlightToBeAssignedBookingEvent')\n  handleToBeAssignedDate(e: CustomEvent) {\n    this.showBookingPopup.emit({\n      key: 'calendar',\n      data: new Date(e.detail.data.fromDate).getTime() - 86400000,\n      noScroll: false,\n    });\n  }\n  async showForDate(dateStamp, withLoading = true) {\n    try {\n      if (withLoading) {\n        this.isLoading = true;\n      }\n      if (this.showDatesList) {\n        this.showUnassignedDate();\n      }\n      await this.updateCategories(dateStamp, this.calendarData);\n      this.addToBeAssignedEvent.emit({ key: 'tobeAssignedEvents', data: [] });\n      this.showBookingPopup.emit({\n        key: 'calendar',\n        data: parseInt(dateStamp) - 86400000,\n        noScroll: this.noScroll,\n      });\n      if (this.isGotoToBeAssignedDate) {\n        this.isGotoToBeAssignedDate = false;\n      }\n      this.isLoading = false;\n      this.selectedDate = dateStamp;\n      this.selectedDateDisplay = this.data[dateStamp]?.dateStr || this.selectedDateDisplay;\n      this.renderView();\n    } catch (error) {\n      // toastr.error(error);\n    }\n  }\n\n  getDay(dt) {\n    const currentDate = new Date(dt);\n    const locale = 'default'; //'en-US';\n    const dayOfWeek = this.getLocalizedDayOfWeek(currentDate, locale);\n    // const monthName = currentDate.toLocaleString(\"default\", { month: 'short' })\n    return dayOfWeek + ' ' + currentDate.getDate() + ', ' + currentDate.getFullYear();\n  }\n\n  getLocalizedDayOfWeek(date, locale) {\n    const options = { weekday: 'short' };\n    return date.toLocaleDateString(locale, options);\n  }\n\n  handleOptionEvent(key, data = '') {\n    this.highlightToBeAssignedBookingEvent.emit({\n      key: 'highlightBookingId',\n      data: { bookingId: '----' },\n    });\n    this.addToBeAssignedEvent.emit({ key: 'tobeAssignedEvents', data: [] });\n    this.optionEvent.emit({ key, data });\n  }\n\n  showUnassignedDate() {\n    this.showDatesList = !this.showDatesList;\n  }\n\n  getToBeAssignedEntities() {\n    // toBeAssignedEvents\n  }\n\n  getCategoryView() {\n    if (this.orderedDatesList.length && this.selectedDate && this.data[this.selectedDate]) {\n      return Object.entries(this.data[this.selectedDate].categories).map(([id, eventDatas], ind) => (\n        <igl-tba-category-view\n          calendarData={this.calendarData}\n          selectedDate={this.selectedDate}\n          categoryId={id}\n          categoryIndex={ind}\n          categoriesData={this.categoriesData}\n          eventDatas={eventDatas}\n          onAssignUnitEvent={evt => this.handleAssignUnit(evt)}\n        ></igl-tba-category-view>\n      ));\n    } else {\n      return null;\n    }\n  }\n\n  renderView() {\n    this.renderAgain = !this.renderAgain;\n  }\n\n  render() {\n    const selectedDateData = this.selectedDate ? this.data[this.selectedDate] : null;\n    return (\n      <Host class=\"tobeAssignedContainer pr-1 text-left\">\n        <div>\n          <div>\n            <div class=\"stickyHeader pt-1\">\n              <div class={'assignment_header'}>\n                <p class=\"tobeAssignedHeader \">{locales.entries.Lcz_Assignments}</p>\n                <ir-button\n                  class=\"close_btn\"\n                  variant=\"icon\"\n                  btn_styles=\"close_btn_style\"\n                  icon_name=\"double_caret_left\"\n                  style={colorVariants.secondary}\n                  onClickHandler={() => this.handleOptionEvent('closeSideMenu')}\n                  visibleBackgroundOnHover\n                ></ir-button>\n              </div>\n              <hr />\n              {Object.keys(this.data).length === 0 ? (\n                <p>{locales.entries.Lcz_AllBookingsAreAssigned}</p>\n              ) : this.isLoading ? (\n                <p class=\"d-flex align-items-center\">\n                  <span class=\"p-0\">{this.loadingMessage}</span>\n                  <div class=\"dots\">\n                    <div class=\"dot\"></div>\n                    <div class=\"dot\"></div>\n                    <div class=\"dot\"></div>\n                  </div>\n                </p>\n              ) : (\n                <Fragment>\n                  {this.orderedDatesList.length ? (\n                    <div\n                      class={`custom-dropdown border border-light rounded text-center ` + (this.showDatesList ? 'show' : '')}\n                      id=\"dropdownMenuButton\"\n                      data-toggle=\"dropdown\"\n                      aria-haspopup=\"true\"\n                      aria-expanded=\"false\"\n                    >\n                      <div\n                        class={'dropdown-toggle'}\n                        //onClick={() => this.showUnassignedDate()}\n                      >\n                        <span class=\"font-weight-bold\">{selectedDateData?.dateStr || this.selectedDateDisplay}</span>\n                        <svg class={'caret-icon'} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" height={14} width={14}>\n                          <path\n                            fill=\"#6b6f82\"\n                            d=\"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z\"\n                          />\n                        </svg>\n                      </div>\n                      <div class=\"dropdown-menu dropdown-menu-right full-width\" aria-labelledby=\"dropdownMenuButton\">\n                        {this.orderedDatesList?.map(ordDate => (\n                          <div class=\"dropdown-item pointer\" onClick={() => this.showForDate(ordDate)}>\n                            {this.data[ordDate].dateStr}\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ) : (\n                    locales.entries.Lcz_AllBookingsAreAssigned\n                  )}\n                </Fragment>\n              )}\n            </div>\n            {!this.isLoading && (\n              <div class=\"scrollabledArea\">\n                {this.selectedDate ? (\n                  selectedDateData && Object.keys(selectedDateData.categories).length ? (\n                    this.getCategoryView()\n                  ) : (\n                    <div class=\"mt-1\">{locales.entries.Lcz_AllAssignForThisDay}</div>\n                  )\n                ) : null}\n              </div>\n            )}\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  width: 100%;\n  --hk-green: green;\n}\n* {\n  box-sizing: border-box;\n}\n.popover-title {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  margin: 0;\n  padding: 0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  z-index: 10;\n  left: 0;\n  display: flex;\n  align-items: center;\n}\n.popover-container {\n  position: absolute;\n  bottom: 0px;\n  left: var(--ir-popover-left, 10px);\n  background: rgb(0, 0, 0);\n  color: white;\n  min-width: 100%;\n  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 10px;\n  z-index: 9999;\n  padding: 3.5px 7px;\n  border-radius: 5px;\n  pointer-events: none;\n  opacity: 0;\n  transition: all 100ms ease;\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1.45;\n  text-decoration: none;\n  text-shadow: none;\n  font-size: 0.875rem;\n}\n.popover-container[data-state='show'] {\n  opacity: 1;\n}\n.hk-dot {\n  inset: 0;\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: fit-content;\n  padding: 4px;\n  left: auto;\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n  padding-inline: var(--ir-popover-left);\n  background: var(--ir-interactive-hk-bg, var(--wa-color-surface-default));\n  color: var(--dot-color, var(--wa-color-text-normal));\n}\n.hk-dot::slotted(*)[name='end'] {\n  height: 12px;\n}\n\n/* .hk-dot::after {\n  content: '';\n  height: 8px;\n  aspect-ratio: 1;\n  border-radius: 9999999px;\n  background: var(--dot-color, #ffffff);\n} */\n","import { Component, Host, Prop, h, Element } from '@stencil/core';\n\n@Component({\n  tag: 'ir-interactive-title',\n  styleUrl: 'ir-interactive-title.css',\n  scoped: true,\n})\nexport class IrInteractiveTitle {\n  @Element() el: HTMLElement;\n\n  /**\n   * The full title string that may be cropped in the UI.\n   */\n  @Prop() popoverTitle: string = '';\n\n  /**\n   * CSS offset for the left position of the popover.\n   * Used as a CSS variable `--ir-popover-left`.\n   */\n  @Prop() irPopoverLeft: string = '10px';\n\n  /**\n   * Whether to show the housekeeping (HK) status dot.\n   */\n  @Prop() hkStatus: boolean = false;\n\n  /**\n   * The number of characters to display before cropping the title with ellipsis.\n   */\n  @Prop() cropSize: number = 20;\n  /**\n   * The message shown when hovering over the broom svg if provided.\n   * @requires hkStatus to be true\n   */\n  @Prop() broomTooltip: string;\n\n  /**\n   * Reference to track if we've initialized popover for current render\n   */\n  private lastRenderedTitle: string = '';\n  private titleContainerRef: HTMLElement;\n  private popoverInstance: any;\n\n  /**\n   * Initialize popover with overflow detection\n   */\n  private initializePopoverIfNeeded(titleContainer: HTMLElement, title: string) {\n    // Only initialize if title changed or first time\n    if (this.lastRenderedTitle === title && this.popoverInstance) {\n      return;\n    }\n    this.disposePopover();\n\n    const tempSpan = document.createElement('span');\n    tempSpan.style.visibility = 'hidden';\n    tempSpan.style.position = 'absolute';\n    tempSpan.style.whiteSpace = 'nowrap';\n    tempSpan.textContent = title;\n    document.body.appendChild(tempSpan);\n\n    const textWidth = tempSpan.offsetWidth;\n    document.body.removeChild(tempSpan);\n\n    const containerWidth = titleContainer.clientWidth;\n    const iconWidth = this.hkStatus ? 20 : 0;\n\n    const willOverflow = textWidth + iconWidth > containerWidth;\n\n    if (willOverflow && typeof $ !== 'undefined') {\n      try {\n        this.popoverInstance = $(titleContainer).popover({\n          trigger: 'hover',\n          content: title,\n          placement: 'top',\n          html: false,\n          sanitize: true,\n          delay: { show: 300, hide: 100 },\n        });\n      } catch (error) {\n        console.error('Failed to initialize popover:', error);\n      }\n    }\n\n    this.lastRenderedTitle = title;\n  }\n\n  private disposePopover() {\n    if (this.popoverInstance && typeof $ !== 'undefined') {\n      try {\n        $(this.titleContainerRef).popover('dispose');\n        this.popoverInstance = null;\n      } catch (error) {\n        console.error('Failed to dispose popover:', error);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    this.disposePopover();\n  }\n\n  render() {\n    const title = this.popoverTitle || '';\n\n    const shouldCrop = title.length > this.cropSize;\n    const displayTitle = shouldCrop ? title.slice(0, this.cropSize) + '...' : title;\n\n    return (\n      <Host style={{ '--ir-popover-left': this.irPopoverLeft }}>\n        <p\n          ref={el => {\n            this.titleContainerRef = el;\n            if (el && title) {\n              setTimeout(() => this.initializePopoverIfNeeded(el, title), 0);\n            }\n          }}\n          class=\"popover-title\"\n          style={{\n            whiteSpace: 'nowrap',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '4px',\n          }}\n        >\n          <span\n            class=\"cropped-title\"\n            style={{\n              flexShrink: '1',\n              minWidth: '0',\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n            }}\n          >\n            {displayTitle}\n          </span>\n          {this.hkStatus && (\n            <div title={this.broomTooltip} class=\"hk-dot\" style={{ flexShrink: '0' }}>\n              <slot name=\"end\"></slot>\n            </div>\n          )}\n        </p>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  --ir-input-border-color: #cacfe7;\n  flex: 1 1 0%;\n}\n\n:host .input-group-text {\n  border-color: var(--ir-input-border-color);\n}\n:host .form-control,\n.currency-label {\n  font-size: 14px !important;\n}\n\n.ir-bl-lbl-none,\n.ir-bl-input-none {\n  border-top-left-radius: 0 !important;\n  border-bottom-left-radius: 0 !important;\n}\n.rate-input:read-only {\n  background: white !important;\n}\n.ir-br-lbl-none,\n.ir-br-input-none {\n  border-top-right-radius: 0 !important;\n  border-bottom-right-radius: 0 !important;\n}\n.ir-br-none {\n  border-right: none;\n}\n.ir-bl-none {\n  border-left: none;\n}\n\n.rate-input-container {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  box-sizing: border-box;\n  flex: 1;\n  padding: 0 !important;\n}\n:host([class='special-style']) .rate-input {\n  background: black !important;\n}\n.rate-input {\n  font-size: 0.875rem;\n  line-height: 0;\n  padding: 0;\n  height: 0;\n  box-sizing: border-box;\n  border-left: 0;\n  padding-left: 0px !important;\n  border-top-left-radius: 0 !important;\n  border-bottom-left-radius: 0 !important;\n}\n\n.currency-label.with-label {\n  border-radius: 0;\n}\n\n.currency-label {\n  box-sizing: border-box;\n  color: #3b4781;\n  border: 1px solid #cacfe7;\n  font-size: 0.875rem;\n  height: 2rem;\n  background: white;\n  border-right: 0;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n  pointer-events: none;\n  transition: border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out;\n}\n.currency-label.disabled,\n.rate-input:disabled {\n  background-color: #eceff1;\n  border-color: rgba(118, 118, 118, 0.3);\n}\n\n.price-input-group:focus-within .currency-label {\n  border-top: 1px solid #1e9ff2;\n  border-bottom: 1px solid #1e9ff2;\n  border-left: 1px solid #1e9ff2;\n}\n:host([data-state='error']) .currency-label,\n:host([data-state='error']) .rate-input,\n.error {\n  border-color: var(--red, #ff4961) !important;\n}\n.price-input:focus {\n  border-right-width: 1px !important;\n}\n\n.is-invalid {\n  background-image: none !important;\n}\n","import { Component, Element, Event, EventEmitter, Prop, h } from '@stencil/core';\nimport { v4 } from 'uuid';\nimport { ZodType } from 'zod';\nimport IMask, { InputMask } from 'imask';\n@Component({\n  tag: 'ir-price-input',\n  styleUrl: 'ir-price-input.css',\n  scoped: true,\n})\nexport class IrPriceInput {\n  @Element() el: HTMLIrPriceInputElement;\n\n  /** The label for the input, optional */\n  @Prop() label?: string;\n  /** The readonly for the input, optional */\n  @Prop() readOnly?: boolean;\n\n  /** Extra classnames for the input, optional */\n  @Prop() inputStyle?: string;\n\n  /** Extra classnames for the label, optional */\n  @Prop() labelStyle?: string;\n\n  /** The disabled for the input, optional */\n  @Prop() disabled?: boolean;\n\n  /** The Currency for the input, optional */\n  @Prop() currency?: string;\n\n  /** The AutoValidate for the input, optional */\n  @Prop() autoValidate?: boolean = true;\n\n  /** Indicates the key to wrap the value (e.g., 'price' or 'cost') */\n  @Prop() wrapKey?: string;\n\n  /**\n   * A Zod schema for validating the input\n   * Example: z.coerce.number()\n   */\n  @Prop() zod?: ZodType<any, any>;\n\n  /** Placeholder text for the input */\n  @Prop() placeholder: string = '';\n\n  /** Initial value for the input */\n  @Prop({ mutable: true }) value: string = '';\n\n  /** Whether the input is required */\n  @Prop() required: boolean = false;\n\n  /** Minimum value for the price */\n  @Prop() minValue?: number;\n\n  /** Maximum value for the price */\n  @Prop() maxValue?: number;\n\n  /** Unique id for testing */\n  @Prop() testId?: string;\n\n  /** Error*/\n  @Prop({ mutable: true }) error: boolean;\n  /**\n   * Extra class names applied to the outer <fieldset> wrapper.\n   * Useful for spacing (e.g., margins/padding), width/layout utilities,\n   * or theming the whole input group from the outside.\n   * Example: \"w-100 mb-2 d-flex align-items-center\"\n   */\n  @Prop() containerClassname: string;\n\n  /**\n   * Extra class names applied to the label container (<div class=\"input-group-prepend\">)\n   * that wraps the <label>. Use this to control label width, alignment,\n   * spacing, or visibility at different breakpoints.\n   * Example: \"min-w-120 text-nowrap pe-2\"\n   */\n  @Prop() labelContainerClassname: string;\n\n  /** Emits the current value on change */\n  @Event() textChange: EventEmitter<string>;\n\n  /** Emits the current value on blur */\n  @Event() inputBlur: EventEmitter<string>;\n\n  /** Emits the current value on focus */\n  @Event() inputFocus: EventEmitter<void>;\n\n  private id: string;\n\n  private opts = {\n    mask: Number,\n    scale: 2,\n    radix: '.',\n    mapToRadix: [','],\n    normalizeZeros: true,\n    padFractionalZeros: true,\n    thousandsSeparator: ',',\n  };\n  private mask: InputMask<any>;\n  private inputRef: HTMLInputElement;\n\n  componentWillLoad() {\n    if (this.el.id) {\n      this.id = this.el.id;\n    } else {\n      this.id = v4();\n    }\n  }\n\n  componentDidLoad() {\n    if (!this.mask) {\n      this.initializeMask();\n    }\n  }\n\n  private initializeMask() {\n    // Create options object with min/max if provided\n    const maskOpts = {\n      ...this.opts,\n    };\n\n    if (this.minValue !== undefined) {\n      maskOpts['min'] = this.minValue;\n    }\n\n    if (this.maxValue !== undefined) {\n      maskOpts['max'] = this.maxValue;\n    }\n\n    this.mask = IMask(this.inputRef, maskOpts);\n\n    // Set initial value if provided\n    if (this.value) {\n      this.mask.value = this.value;\n    }\n\n    this.mask.on('accept', () => {\n      const isEmpty = this.inputRef.value.trim() === '' || this.mask.unmaskedValue === '';\n      if (isEmpty) {\n        this.value = '';\n        this.textChange.emit(null);\n      } else {\n        this.value = this.mask.unmaskedValue;\n        this.textChange.emit(this.value);\n      }\n    });\n  }\n\n  private hasSpecialClass(className: string): boolean {\n    return this.el.classList.contains(className);\n  }\n\n  private validateInput(value: string): void {\n    if (!this.autoValidate) {\n      return;\n    }\n    if (this.zod) {\n      try {\n        this.zod.parse(this.wrapKey ? { [this.wrapKey]: value } : value); // Validate the value using the Zod schema\n        this.error = false; // Clear the error if valid\n      } catch (error) {\n        console.log(error);\n        this.error = true; // Set the error message\n      }\n    }\n  }\n\n  private handleInputChange = (): void => {\n    // The value is already being updated by the mask's 'accept' event\n    // Just validate here if needed\n    this.validateInput(this.value);\n  };\n\n  private handleBlur = (): void => {\n    this.validateInput(this.value);\n\n    // Format to 2 decimal places on blur\n    if (this.value) {\n      const numValue = parseFloat(this.value);\n      this.value = numValue.toFixed(2);\n\n      // Update the mask value to show the formatted value\n      if (this.mask) {\n        this.mask.value = this.value;\n      }\n    }\n\n    // Emit the blur event\n    this.inputBlur.emit(this.value);\n  };\n\n  private handleFocus = (): void => {\n    // Emit the focus event\n    this.inputFocus.emit();\n  };\n\n  render() {\n    return (\n      <fieldset class={`${this.containerClassname} input-group price-input-group m-0 p-0 `}>\n        {this.label && (\n          <div class={`input-group-prepend ${this.labelContainerClassname}`}>\n            <span\n              class={`input-group-text \n                ${this.labelStyle}\n              ${this.hasSpecialClass('ir-bl-lbl-none') ? 'ir-bl-lbl-none' : ''}\n              ${this.hasSpecialClass('ir-br-lbl-none') ? 'ir-br-lbl-none' : ''}\n              ${this.hasSpecialClass('ir-br-none') ? 'ir-br-none' : ''} \n              ${this.hasSpecialClass('ir-bl-none') ? 'ir-bl-none' : ''} \n              `}\n            >\n              <label class={'p-0 m-0 '} htmlFor={this.id}>\n                {this.label}\n              </label>\n            </span>\n          </div>\n        )}\n        <div class=\"position-relative has-icon-left rate-input-container\">\n          {this.currency && (\n            <div>\n              <span class={`input-group-text ${this.disabled ? 'disabled' : ''} currency-label ${this.error ? 'error' : ''} ${this.label ? 'with-label' : ''}`}>\n                {this.currency}\n              </span>\n            </div>\n          )}\n          <input\n            ref={el => (this.inputRef = el)}\n            data-testid={this.testId}\n            disabled={this.disabled}\n            id={this.id}\n            class={`form-control input-sm rate-input \n              ${this.inputStyle}\n              ${this.hasSpecialClass('ir-br-input-none') ? 'ir-br-input-none' : ''} \n              ${this.hasSpecialClass('ir-bl-input-none') ? 'ir-bl-input-none' : ''} \n              ${this.error ? 'error' : ''} py-0 m-0 ${this.currency ? 'ir-bl-none' : ''}`}\n            onInput={this.handleInputChange}\n            onBlur={this.handleBlur}\n            onFocus={this.handleFocus}\n            type=\"text\"\n            placeholder={this.placeholder}\n            readOnly={this.readOnly}\n            aria-label={this.el.ariaLabel ?? 'price-input'}\n            aria-describedby={this.el.ariaDescription ?? 'price-input'}\n          />\n        </div>\n      </fieldset>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import { Booking } from '@/models/booking.dto';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport { Component, Event, EventEmitter, Prop, h } from '@stencil/core';\nimport { v4 } from 'uuid';\n\n@Component({\n  tag: 'ir-reallocation-drawer',\n  styleUrl: 'ir-reallocation-drawer.css',\n  scoped: true,\n})\nexport class IrReallocationDrawer {\n  @Prop({ reflect: true }) open: boolean;\n  @Prop() booking: Booking;\n  @Prop() roomIdentifier: string;\n  @Prop() pool: string;\n\n  @Event() closeModal: EventEmitter<void>;\n  private _id = `reallocation-form_${v4()}`;\n  render() {\n    return (\n      <ir-drawer\n        label=\"Reassign Unit\"\n        open={this.open}\n        onDrawerHide={e => {\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n          this.closeModal.emit();\n        }}\n      >\n        {this.open && <ir-reallocation-form pool={this.pool} formId={this._id} booking={this.booking} identifier={this.roomIdentifier}></ir-reallocation-form>}\n        <div slot=\"footer\" class=\"ir__drawer-footer\">\n          <ir-custom-button size=\"medium\" data-drawer=\"close\" variant=\"neutral\" appearance=\"filled\">\n            Cancel\n          </ir-custom-button>\n          <ir-custom-button form={this._id} size=\"medium\" loading={isRequestPending('/ReAllocate_Exposed_Room')} type=\"submit\" variant=\"brand\">\n            Confirm\n          </ir-custom-button>\n        </div>\n      </ir-drawer>\n    );\n  }\n}\n",":host {\n  display: block;\n  height: 100%;\n  color: var(--ir-text-color, #1f2a37);\n  font-family: var(--ir-font-family, 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif);\n}\n\n.reallocation-form {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.booking-summary {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.rateplan-details {\n  margin: 0;\n  font-weight: 500;\n  color: var(--ir-muted-text-color, #4b5563);\n}\n\n.date-picker-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  align-items: flex-end;\n}\n\n.date-picker-row .ir-custom-date-picker {\n  flex: 1 1 220px;\n}\n\n.error-message {\n  margin: 0;\n  margin-top: 0.75rem;\n  color: var(--ir-error-color, #c0392b);\n  font-size: 0.95rem;\n}\n\n.room-type-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-top: 0.75rem;\n}\n\n.choice-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n\n.room-type-name {\n  font-weight: 600;\n  color: var(--ir-heading-color, #111827);\n}\n\n.physical-room {\n  display: flex;\n  align-items: center;\n  font-size: 0.95rem;\n  padding-inline-start: 1rem;\n}\n.physical-room::part(label) {\n  display: flex;\n  align-items: center;\n}\n.physical-room + .physical-room {\n  margin-top: 0.5rem;\n}\n\n.physical-room--last {\n  margin-bottom: 0.25rem;\n}\n\n.physical-room wa-select {\n  margin-left: 1rem;\n  min-width: 220px;\n}\n.custom-date-picker {\n  max-width: 200px;\n}\n.room-type-row {\n  margin-bottom: 0.5rem;\n}\n","import { SelectedUnit, SelectedUnitSchema } from '@/components/igloo-calendar/igl-split-booking/types';\nimport { Booking, IUnit, Room } from '@/models/booking.dto';\nimport { PropertyRoomType } from '@/models/IBooking';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { EventsService } from '@/services/events.service';\nimport { resetBookingStore } from '@/stores/booking.store';\nimport calendar_data from '@/stores/calendar-data';\nimport locales from '@/stores/locales.store';\nimport { calculateDaysBetweenDates } from '@/utils/booking';\nimport { checkMealPlan, SelectOption } from '@/utils/utils';\nimport { Component, Event, EventEmitter, Fragment, Prop, State, h } from '@stencil/core';\nimport moment, { Moment } from 'moment';\nimport { ZodError } from 'zod';\n\n@Component({\n  tag: 'ir-reallocation-form',\n  styleUrl: 'ir-reallocation-form.css',\n  scoped: true,\n})\nexport class IrReallocationForm {\n  @Prop() booking: Booking;\n  @Prop() identifier: string;\n  @Prop() pool: string;\n  @Prop() formId: string;\n\n  @State() date: Moment;\n  @State() isLoading: boolean;\n  @State() room: Room;\n  @State() roomTypes: PropertyRoomType[] = [];\n  @State() selectedUnit: Partial<SelectedUnit> = {};\n  @State() errors: Record<string, boolean> | null;\n  @State() mealPlanOptions: SelectOption[] | null = null;\n\n  @Event({ bubbles: true, composed: true }) closeModal: EventEmitter<null>;\n\n  private bookingService = new BookingService();\n  private eventsService = new EventsService();\n\n  componentWillLoad() {\n    this.room = this.getRoom();\n    this.date = moment(this.room.from_date, 'YYYY-MM-DD');\n    this.checkBookingAvailability();\n  }\n\n  private getRoom() {\n    if (!this.booking) {\n      throw new Error('Missing booking');\n    }\n    if (!this.identifier) {\n      throw new Error('Missing Identifier');\n    }\n    const room = this.booking.rooms.find(r => r.identifier === this.identifier);\n    if (!room) {\n      throw new Error(`Couldn't find room with identifier ${this.identifier}`);\n    }\n    return room;\n  }\n\n  private async checkBookingAvailability() {\n    this.isLoading = true;\n    resetBookingStore(false);\n    const is_in_agent_mode = this.booking.agent !== null;\n    const { from_date, to_date } = this.getDates();\n    try {\n      const data = await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: this.booking.property.id,\n        adultChildCount: {\n          adult: 1,\n          child: 0,\n        },\n        language: 'en',\n        room_type_ids: [],\n        currency: this.booking.currency,\n        agent_id: is_in_agent_mode ? this.booking.agent.id : null,\n        is_in_agent_mode,\n        room_type_ids_to_update: [],\n      });\n      this.roomTypes = (data as any as PropertyRoomType[]).filter(r => r.is_available_to_book);\n      this.isLoading = false;\n    } catch (error) {\n      console.error('Error initializing booking availability:', error);\n    }\n  }\n\n  private getDates(): { from_date: string; to_date: string } {\n    return {\n      from_date: this.date.clone().format('YYYY-MM-DD'),\n      to_date: this.date.clone().add(calculateDaysBetweenDates(this.room.from_date, this.room.to_date), 'days').format('YYYY-MM-DD'),\n    };\n  }\n\n  private async reallocateUnit() {\n    try {\n      this.errors = null;\n      const selectedUnit = SelectedUnitSchema.parse(this.selectedUnit);\n      const { from_date, to_date } = this.getDates();\n      await this.eventsService.reallocateEvent(this.pool, selectedUnit.unit_id, from_date, to_date, selectedUnit.rateplan_id);\n      this.closeModal.emit(null);\n    } catch (error) {\n      const err: Record<string, boolean> = {};\n      if (error instanceof ZodError) {\n        console.error(error);\n        error.issues.forEach(i => {\n          err[i.path[0]] = true;\n        });\n        this.errors = { ...err };\n      }\n    }\n  }\n\n  private updateSelectedUnit(params: Partial<SelectedUnit>) {\n    const merged: Partial<SelectedUnit> = { ...this.selectedUnit, ...params };\n    const roomTypesSource = calendar_data?.property?.roomtypes;\n    const mealPlanResult = checkMealPlan({\n      rateplan_id: this.room.rateplan.id.toString(),\n      roomTypeId: merged?.roomtype_id,\n      roomTypes: roomTypesSource,\n    });\n\n    const hasExplicitRateplanUpdate = Object.prototype.hasOwnProperty.call(params, 'rateplan_id');\n\n    if (Array.isArray(mealPlanResult)) {\n      this.mealPlanOptions = mealPlanResult;\n      if (!hasExplicitRateplanUpdate) {\n        delete merged.rateplan_id;\n      }\n    } else {\n      this.mealPlanOptions = null;\n      if (!hasExplicitRateplanUpdate) {\n        if (mealPlanResult) {\n          merged.rateplan_id = Number(mealPlanResult.value);\n        } else {\n          delete merged.rateplan_id;\n        }\n      }\n    }\n\n    this.selectedUnit = merged;\n  }\n  // private get minDate() {\n  //   if (!this.booking.is_direct) {\n  //     return this.booking.from_date;\n  //   }\n  //   const MFromDate = moment(this.room.from_date, 'YYYY-MM-DD');\n  //   const today = moment();\n  //   if (MFromDate.isBefore(today)) {\n  //     return MFromDate.format('YYYY-MM-DD');\n  //   }\n  //   return today.format('YYYY-MM-DD');\n  // }\n  // private get maxDate() {\n  //   if (this.booking.is_direct) {\n  //     return;\n  //   }\n  //   return this.booking.from_date;\n  // }\n  render() {\n    if (this.isLoading) {\n      return (\n        <div class=\"drawer__loader-container\">\n          <ir-spinner></ir-spinner>\n        </div>\n      );\n    }\n    return (\n      <form\n        id={this.formId}\n        class=\"reallocation-form\"\n        onSubmit={e => {\n          e.preventDefault();\n          this.reallocateUnit();\n        }}\n      >\n        <div class=\"booking-summary\">\n          <ir-date-view from_date={this.room.from_date} to_date={this.room.to_date} showDateDifference={false}></ir-date-view>\n          <span>\n            <span>From:</span>\n            <p class=\"rateplan-details\">\n              {this.room.roomtype.name} {this.room.rateplan.short_name} {this.room.rateplan.is_non_refundable ? locales.entries.Lcz_NonRefundable : ''}{' '}\n              {(this.room.unit as IUnit).name}\n            </p>\n          </span>\n        </div>\n        {/* <div class=\"date-picker-row\">\n          <ir-custom-date-picker\n            data-testid=\"pickup_arrival_date\"\n            date={this.date?.format('YYYY-MM-DD')}\n            // maxDate={this.defaultDates?.to_date.format('YYYY-MM-DD')}\n            minDate={this.minDate}\n            maxDate={this.maxDate}\n            emitEmptyDate={true}\n            label=\"From:\"\n            onDateChanged={evt => {\n              this.date = evt.detail.start;\n            }}\n          ></ir-custom-date-picker>\n          <ir-custom-button variant=\"brand\" loading={isRequestPending('/Check_Availability')} onClickHandler={() => this.checkBookingAvailability()}>\n            Check available units\n          </ir-custom-button>\n        </div> */}\n        {this.errors?.roomtype_id && <p class=\"error-message\">Please select a room</p>}\n        {this.roomTypes.length === 0 ? (\n          <ir-empty-state style={{ marginTop: '20vh' }}></ir-empty-state>\n        ) : (\n          <wa-radio-group\n            onchange={e => {\n              const [roomtype_id, unit_id] = (e.target as any).value.split('_');\n              this.updateSelectedUnit({\n                roomtype_id: Number(roomtype_id),\n                unit_id: Number(unit_id),\n              });\n            }}\n            name=\"available-units\"\n            class=\"room-type-list\"\n          >\n            <p style={{ margin: '0', padding: '0', marginBottom: '0.5rem' }}>To:</p>\n            {this.roomTypes?.map(roomType => {\n              const units = (() => {\n                const unitMap = new Map<number, string>();\n                for (const rateplan of roomType.rateplans ?? []) {\n                  for (const unit of rateplan.assignable_units ?? []) {\n                    if (unit.Is_Fully_Available) {\n                      unitMap.set(unit.pr_id, unit.name);\n                    }\n                  }\n                }\n\n                return Array.from(unitMap, ([id, name]) => ({ id, name }));\n              })();\n              return (\n                <Fragment>\n                  <div key={`roomTypeRow-${roomType.id}`} class={`room-type-row`}>\n                    <div class={'choice-row'}>\n                      <span class=\"room-type-name\">{roomType.name}</span>\n                    </div>\n                  </div>\n                  {units.map((room, j) => {\n                    const isLastUnit = j === units.length - 1;\n                    const showMealPlanSelect = this.selectedUnit?.unit_id === room.id && Array.isArray(this.mealPlanOptions) && this.mealPlanOptions.length > 0;\n                    return (\n                      <wa-radio\n                        value={`${roomType.id}_${room.id}`}\n                        checked={this.selectedUnit?.unit_id === room.id}\n                        key={`physicalRoom-${room.id}-${j}`}\n                        class={`physical-room${isLastUnit ? ' physical-room--last' : ''}`}\n                      >\n                        <span>{room.name}</span>\n                        {showMealPlanSelect && (\n                          <ir-validator value={this.selectedUnit?.rateplan_id} schema={SelectedUnitSchema.shape.rateplan_id}>\n                            <wa-select\n                              size=\"small\"\n                              placeholder=\"Select a new rateplan...\"\n                              value={this.selectedUnit?.rateplan_id?.toString()}\n                              onchange={e => {\n                                e.stopImmediatePropagation();\n                                e.stopPropagation();\n                                this.updateSelectedUnit({\n                                  rateplan_id: Number((e.target as HTMLSelectElement).value),\n                                });\n                              }}\n                            >\n                              {this.mealPlanOptions.map(option => {\n                                return <wa-option value={option.value?.toString()}>{option.text + `${option.custom_text ? ' | ' : ''}${option.custom_text}`}</wa-option>;\n                              })}\n                            </wa-select>\n                          </ir-validator>\n                        )}\n                      </wa-radio>\n                    );\n                  })}\n                </Fragment>\n              );\n            })}\n          </wa-radio-group>\n        )}\n      </form>\n    );\n  }\n}\n",":host {\r\n  display: block;\r\n  box-sizing: border-box;\r\n  margin: 0;\r\n  position: relative;\r\n}\r\n.loading-container {\r\n  position: relative;\r\n  height: 100%;\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n.close-icon {\r\n  position: absolute;\r\n  top: 18px;\r\n  right: 33px;\r\n  outline: none;\r\n}\r\n.close {\r\n  float: right;\r\n  font-size: 1.5rem;\r\n  font-weight: 700;\r\n  line-height: 1;\r\n  color: #000;\r\n  text-shadow: 0 1px 0 #fff;\r\n  opacity: 0.5;\r\n\r\n  padding: 0;\r\n  background-color: transparent;\r\n  border: 0;\r\n  appearance: none;\r\n}\r\n.card {\r\n  top: 0;\r\n  z-index: 1000;\r\n}\r\n.card-title {\r\n  border-bottom: 1px solid #e4e5ec;\r\n  width: 100%;\r\n}\r\n.irfontgreen {\r\n  color: #0e930e;\r\n}\r\n.currency {\r\n  display: block;\r\n  position: absolute;\r\n  margin: 0;\r\n  padding: 0;\r\n  height: auto;\r\n  left: 10px;\r\n}\r\n.rate-input {\r\n  font-size: 14px;\r\n  line-height: 0;\r\n  padding: 0;\r\n  height: 0;\r\n  border-left: 0;\r\n  border-radius: 0.25rem !important;\r\n}\r\n.rate-input-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-start;\r\n  box-sizing: border-box;\r\n  flex: 1;\r\n}\r\n.new-currency {\r\n  color: #3b4781;\r\n  border: 1px solid #cacfe7;\r\n  font-size: 0.975rem;\r\n  height: 2rem;\r\n  background: rgb(255, 255, 255);\r\n  padding-right: 0 !important;\r\n  border-right: 0;\r\n  border-top-right-radius: 0;\r\n  border-bottom-right-radius: 0;\r\n  transition: border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out;\r\n}\r\n.input-group-prepend span[data-state='focus'] {\r\n  border-color: var(--blue);\r\n}\r\n.input-group-prepend span[data-disabled] {\r\n  background-color: #eceff1;\r\n  border-color: rgba(118, 118, 118, 0.3);\r\n}\r\n.rateInputBorder {\r\n  padding-left: 5px !important;\r\n  padding-right: 5px !important;\r\n  border-top-left-radius: 0 !important;\r\n  border-bottom-left-radius: 0 !important;\r\n}\r\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { Component, Prop, State, h, Event, EventEmitter, Fragment } from '@stencil/core';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { convertDatePrice, formatDate, getDaysArray } from '@/utils/utils';\nimport { Booking, Day, IUnit, Room } from '@/models/booking.dto';\nimport { IRoomNightsDataEventPayload } from '@/models/property-types';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { Variation } from '@/models/property';\n\n@Component({\n  tag: 'ir-room-nights',\n  styleUrls: ['ir-room-nights.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IrRoomNights {\n  @Prop() bookingNumber: string;\n  @Prop() propertyId: number;\n  @Prop() language: string;\n  @Prop() identifier: string;\n  @Prop() toDate: string;\n  @Prop() fromDate: string;\n  @Prop() pool: string;\n  @Prop() ticket: string;\n  @Prop() defaultDates: { from_date: string; to_date: string };\n\n  @State() bookingEvent: Booking;\n  @State() selectedRoom: Room;\n  @State() rates: Day[] = [];\n  @State() isLoading = false;\n  @State() initialLoading = false;\n  @State() inventory: number | null = null;\n  @State() isEndDateBeforeFromDate: boolean = false;\n  @State() defaultTotalNights = 0;\n  @State() isInputFocused = -1;\n  @State() dates: { from_date: Date; to_date: Date } = { from_date: new Date(), to_date: new Date() };\n\n  @Event() closeRoomNightsDialog: EventEmitter<IRoomNightsDataEventPayload>;\n\n  private bookingService = new BookingService();\n\n  componentWillLoad() {\n    this.dates = { from_date: new Date(this.fromDate), to_date: new Date(this.toDate) };\n    this.init();\n  }\n\n  isButtonDisabled() {\n    return this.isLoading || this.rates.some(rate => rate.amount === -1) || this.inventory === 0 || this.inventory === null;\n  }\n  async init() {\n    try {\n      const { from_date } = this.defaultDates;\n      if (moment(from_date, 'YYYY-MM-DD').isBefore(moment(this.fromDate, 'YYYY-MM-DD'))) {\n        this.dates.from_date = new Date(from_date);\n      } else {\n        this.dates.from_date = new Date(this.fromDate);\n      }\n      this.dates.to_date = new Date(this.toDate);\n      this.bookingEvent = await this.bookingService.getExposedBooking(this.bookingNumber, this.language);\n      if (this.bookingEvent) {\n        const filteredRooms = this.bookingEvent.rooms.filter(room => room.identifier === this.identifier);\n        this.selectedRoom = filteredRooms[0];\n        const lastDay = this.selectedRoom?.days[this.selectedRoom.days.length - 1];\n        //let first_rate = this.selectedRoom.days[0].amount;\n        if (moment(this.toDate).add(-1, 'days').isSame(moment(lastDay.date))) {\n          console.log('here1');\n          const amount = await this.fetchBookingAvailability(this.fromDate, this.selectedRoom.days[0].date, this.selectedRoom.rateplan.id);\n          const newDatesArr = getDaysArray(this.selectedRoom.days[0].date, this.fromDate);\n          this.isEndDateBeforeFromDate = true;\n          this.rates;\n          this.rates = [\n            ...newDatesArr.map(day => ({\n              amount: amount / newDatesArr.length,\n              date: day,\n              cost: null,\n            })),\n            ...this.selectedRoom.days,\n          ];\n          this.defaultTotalNights = this.rates.length - this.selectedRoom.days.length;\n        } else {\n          console.log('here2');\n          console.log(lastDay);\n          const amount = await this.fetchBookingAvailability(this.bookingEvent.to_date, moment(this.toDate, 'YYYY-MM-DD').format('YYYY-MM-DD'), this.selectedRoom.rateplan.id);\n          const newDatesArr = getDaysArray(lastDay.date, this.toDate);\n          this.rates = [\n            ...this.selectedRoom.days,\n            ...newDatesArr.map(day => ({\n              amount: amount / newDatesArr.length,\n              date: day,\n              cost: null,\n            })),\n          ];\n        }\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  private handleInput(event: string, index: number) {\n    let inputValue = event;\n    let days = [...this.rates];\n    inputValue = inputValue.replace(/[^0-9.]/g, '');\n    if (inputValue === '') {\n      days[index].amount = -1;\n    } else {\n      if (!isNaN(Number(inputValue))) {\n        days[index].amount = Number(inputValue);\n      }\n    }\n    this.rates = days;\n  }\n  async fetchBookingAvailability(from_date: string, to_date: string, rate_plan_id: number) {\n    try {\n      this.initialLoading = true;\n      const bookingAvailability = await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: this.propertyId,\n        adultChildCount: {\n          adult: this.selectedRoom.rateplan.selected_variation.adult_nbr,\n          child: this.selectedRoom.rateplan.selected_variation.child_nbr,\n        },\n        language: this.language,\n        currency: this.bookingEvent.currency,\n        room_type_ids: [this.selectedRoom.roomtype.id],\n        rate_plan_ids: [rate_plan_id],\n      });\n      console.log(bookingAvailability[0], rate_plan_id);\n      this.inventory = bookingAvailability[0].inventory;\n      const rate_plan = bookingAvailability[0].rateplans.find(rate => rate.id === rate_plan_id);\n      if (!rate_plan || !rate_plan.variations) {\n        this.inventory = null;\n        return null;\n      }\n      const selected_variation: Variation = rate_plan.variations?.find(\n        variation =>\n          variation.adult_nbr === this.selectedRoom.rateplan.selected_variation.adult_nbr && variation.child_nbr === this.selectedRoom.rateplan.selected_variation.child_nbr,\n      );\n      if (!selected_variation) {\n        return null;\n      }\n      return selected_variation.discounted_gross_amount;\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.initialLoading = false;\n    }\n  }\n\n  private renderInputField(index: number, currency_symbol: string, day: Day) {\n    return (\n      <div class=\"col-3 ml-1 position-relative  m-0 p-0 rate-input-container\">\n        <ir-price-input\n          value={day.amount > 0 ? day.amount.toString() : ''}\n          disabled={this.inventory === 0 || this.inventory === null}\n          currency={currency_symbol}\n          aria-label=\"rate\"\n          aria-describedby=\"rate cost\"\n          onTextChange={e => this.handleInput(e.detail, index)}\n        ></ir-price-input>\n      </div>\n    );\n  }\n\n  private renderReadOnlyField(currency_symbol: string, day: Day) {\n    return <p class=\"col-9 ml-1 m-0 p-0\">{`${currency_symbol}${Number(day.amount).toFixed(2)}`}</p>;\n  }\n  private renderRateFields(index: number, currency_symbol: string, day: Day) {\n    if (this.isEndDateBeforeFromDate) {\n      if (index < this.defaultTotalNights) {\n        return this.renderInputField(index, currency_symbol, day);\n      } else {\n        return this.renderReadOnlyField(currency_symbol, day);\n      }\n    } else {\n      return index < this.selectedRoom.days.length ? this.renderReadOnlyField(currency_symbol, day) : this.renderInputField(index, currency_symbol, day);\n    }\n  }\n  renderDates() {\n    const currency_symbol = this.bookingEvent.currency.symbol;\n    // const currency_symbol = getCurrencySymbol(this.bookingEvent.currency.code);\n    return (\n      <div class={'mt-2 m-0'}>\n        {this.rates?.map((day, index) => (\n          <div class={'row m-0 mt-1 align-items-center'}>\n            <p class={'col-2 m-0 p-0'}>{convertDatePrice(day.date)}</p>\n            {this.renderRateFields(index, currency_symbol, day)}\n          </div>\n        ))}\n      </div>\n    );\n  }\n  async handleRoomConfirmation() {\n    try {\n      this.isLoading = true;\n      let oldRooms = [...this.bookingEvent.rooms];\n      let selectedRoomIndex = oldRooms.findIndex(room => room.identifier === this.identifier);\n      if (selectedRoomIndex === -1) {\n        throw new Error('Invalid Pool');\n      }\n      oldRooms[selectedRoomIndex] = {\n        ...oldRooms[selectedRoomIndex],\n        days: this.rates,\n        to_date: moment(this.dates.to_date).format('YYYY-MM-DD'),\n        from_date: moment(this.dates.from_date).format('YYYY-MM-DD'),\n      };\n      const body = {\n        assign_units: true,\n        check_in: true,\n        is_pms: true,\n        is_direct: true,\n        pickup_info: this.bookingEvent.pickup_info,\n        extra_services: this.bookingEvent.extra_services,\n        booking: {\n          booking_nbr: this.bookingNumber,\n          from_date: moment(this.dates.from_date).format('YYYY-MM-DD'),\n          to_date: moment(this.dates.to_date).format('YYYY-MM-DD'),\n          remark: this.bookingEvent.remark,\n          property: this.bookingEvent.property,\n          source: this.bookingEvent.source,\n          currency: this.bookingEvent.currency,\n          arrival: this.bookingEvent.arrival,\n          guest: this.bookingEvent.guest,\n          rooms: oldRooms,\n        },\n      };\n      await this.bookingService.doReservation(body);\n      this.closeRoomNightsDialog.emit({ type: 'confirm', pool: this.pool });\n    } catch (error) {\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  render() {\n    if (!this.bookingEvent) {\n      return (\n        <div class=\"loading-container\">\n          <ir-loading-screen></ir-loading-screen>\n        </div>\n      );\n    }\n    return (\n      <div class=\"sheet-container\">\n        <ir-title\n          class=\"p-1 sheet-header\"\n          onCloseSideBar={() => this.closeRoomNightsDialog.emit({ type: 'cancel', pool: this.pool })}\n          label={`${locales.entries.Lcz_AddingRoomNightsTo} ${this.selectedRoom?.roomtype?.name} ${(this.selectedRoom?.unit as IUnit).name}`}\n          displayContext=\"sidebar\"\n        ></ir-title>\n        <section class={'text-left px-1 pt-0 sheet-body'}>\n          <p class={'font-medium-1'}>\n            {`${locales.entries.Lcz_Booking}#`} {this.bookingNumber}\n          </p>\n          {this.initialLoading ? (\n            <p class={'mt-2 text-secondary'}>{locales.entries['Lcz_CheckingRoomAvailability ']}</p>\n          ) : (\n            <Fragment>\n              <p class={'font-weight-bold font-medium-1'}>{`${formatDate(moment(this.dates.from_date).format('YYYY-MM-DD'), 'YYYY-MM-DD')} - ${formatDate(\n                moment(this.dates.to_date).format('YYYY-MM-DD'),\n                'YYYY-MM-DD',\n              )}`}</p>\n              <p class={'font-medium-1 mb-0'}>\n                {`${this.selectedRoom.rateplan.name}`} {this.selectedRoom.rateplan.is_non_refundable && <span class={'irfontgreen'}>{locales.entries.Lcz_NonRefundable}</span>}\n              </p>\n              {(this.inventory === 0 || this.inventory === null) && <p class=\"font-medium-1 text danger\">{locales.entries.Lcz_NoAvailabilityForAdditionalNights}</p>}\n\n              {this.selectedRoom.rateplan.custom_text && <p class={'text-secondary mt-0'}>{this.selectedRoom.rateplan.custom_text}</p>}\n              {this.renderDates()}\n            </Fragment>\n          )}\n        </section>\n        <section class={'sheet-footer'}>\n          <ir-button\n            btn_color=\"secondary\"\n            btn_disabled={this.isLoading}\n            text={locales?.entries.Lcz_Cancel}\n            class=\"full-width\"\n            btn_styles=\"justify-content-center\"\n            onClickHandler={() => this.closeRoomNightsDialog.emit({ type: 'cancel', pool: this.pool })}\n          ></ir-button>\n\n          {this.inventory > 0 && this.inventory !== null && (\n            <ir-button\n              isLoading={this.isLoading}\n              text={locales?.entries.Lcz_Confirm}\n              btn_disabled={this.isButtonDisabled()}\n              class=\"full-width\"\n              btn_styles=\"justify-content-center\"\n              onClickHandler={this.handleRoomConfirmation.bind(this)}\n            ></ir-button>\n          )}\n        </section>\n      </div>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n.spinner {\n  transform-origin: center;\n  animation: spinner_svv2 0.75s infinite linear;\n}\n@keyframes spinner_svv2 {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n","import { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\ntype LoaderPhase = 'spinner' | 'success';\n\n@Component({\n  tag: 'ir-success-loader',\n  styleUrl: 'ir-success-loader.css',\n  shadow: true,\n})\nexport class IrSuccessLoader {\n  /**\n   * How long the spinner should be shown before transitioning to the success icon.\n   * Value is expressed in milliseconds.\n   */\n  @Prop() spinnerDuration = 1500;\n\n  /**\n   * How long the success icon should be shown before the loader dispatches the completion event.\n   * Value is expressed in milliseconds.\n   */\n  @Prop() successDuration = 1000;\n\n  /**\n   * Whether the loader should automatically start its cycle when it becomes active.\n   */\n  @Prop() autoStart = true;\n\n  /**\n   * Controls the visibility of the loader. Setting this to `true` starts the spinner/success cycle.\n   */\n  @Prop({ mutable: true, reflect: true }) active = true;\n\n  /**\n   * Emit when the loader finishes the success state and should be hidden by the parent.\n   */\n  @Event({ bubbles: true, composed: true }) loaderComplete: EventEmitter<void>;\n\n  @State() private phase: LoaderPhase = 'spinner';\n\n  private spinnerTimer?: number;\n  private successTimer?: number;\n\n  componentWillLoad() {\n    if (this.autoStart && this.active) {\n      this.startCycle();\n    }\n  }\n\n  disconnectedCallback() {\n    this.clearTimers();\n  }\n\n  @Watch('active')\n  protected onActiveChange(isActive: boolean) {\n    if (isActive) {\n      if (this.autoStart) {\n        this.startCycle();\n      }\n    } else {\n      this.resetCycle();\n    }\n  }\n\n  @Watch('spinnerDuration')\n  @Watch('successDuration')\n  protected onDurationChange() {\n    if (this.active && this.autoStart) {\n      this.startCycle();\n    }\n  }\n\n  private startCycle() {\n    this.clearTimers();\n    this.phase = 'spinner';\n    const spinnerDelay = Math.max(0, Number(this.spinnerDuration) || 0);\n    if (spinnerDelay === 0) {\n      this.showSuccess();\n      return;\n    }\n    this.spinnerTimer = window.setTimeout(() => this.showSuccess(), spinnerDelay);\n  }\n\n  private showSuccess() {\n    this.phase = 'success';\n    const successDelay = Math.max(0, Number(this.successDuration) || 0);\n    if (successDelay === 0) {\n      this.handleCompletion();\n      return;\n    }\n    this.successTimer = window.setTimeout(() => this.handleCompletion(), successDelay);\n  }\n\n  private handleCompletion() {\n    this.loaderComplete.emit();\n    this.active = false;\n  }\n\n  private resetCycle() {\n    this.clearTimers();\n    this.phase = 'spinner';\n  }\n\n  private clearTimers() {\n    if (this.spinnerTimer) {\n      clearTimeout(this.spinnerTimer);\n      this.spinnerTimer = undefined;\n    }\n    if (this.successTimer) {\n      clearTimeout(this.successTimer);\n      this.successTimer = undefined;\n    }\n  }\n\n  render() {\n    return (\n      <Host>\n        {this.phase === 'spinner' ? (\n          <svg part=\"spinner\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path\n              d=\"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z\"\n              class=\"spinner\"\n            />\n          </svg>\n        ) : (\n          <ir-icons part=\"check\" name=\"check\" style={{ color: '#45b16d' }}></ir-icons>\n        )}\n      </Host>\n    );\n  }\n}\n",":host {\n  display: flex;\n  align-items: center;\n  position: relative;\n  overflow-x: auto;\n  gap: 1rem;\n  padding: 0 1rem;\n}\n.tab {\n  font-size: 0.95rem;\n  font-weight: 400;\n  cursor: pointer;\n  position: relative;\n  margin: 0;\n  padding: 0rem;\n  padding-bottom: 1rem;\n  transition: color 0.3s ease;\n  user-select: none;\n  background-color: transparent;\n  border: none;\n  outline: none;\n  flex: 1 1 0%;\n  text-align: center;\n  white-space: nowrap;\n}\n.tab[data-disabled] {\n  cursor: auto;\n}\n.tab:hover {\n  opacity: 80%;\n}\n\n.tab[data-state='selected'],\n.tab[data-state='selected']:hover {\n  color: var(--blue, #1e9ff2);\n  opacity: 100%;\n}\n.active-indicator {\n  padding: 0;\n  bottom: 0px;\n  position: absolute;\n  height: 3px;\n  border-radius: 4px;\n  transition: transform 0.3s ease, width 0.3s ease;\n  background: var(--blue, #1e9ff2);\n}\n","import { Component, Element, Event, EventEmitter, Host, Prop, State, h } from '@stencil/core';\n\nexport type Tab = { id: string; label: string };\n\n@Component({\n  tag: 'ir-tabs',\n  styleUrl: 'ir-tabs.css',\n  scoped: true,\n})\nexport class IrTabs {\n  @Element() el: HTMLElement;\n\n  /**\n   * Array of tab objects containing id and label\n   * @type {Tab[]}\n   * @default []\n   */\n  @Prop() tabs: Tab[] = [];\n\n  /**\n   * ID of the tab that should be selected initially\n   * @type {string}\n   * @default undefined\n   */\n  @Prop() initialTab: string;\n\n  /**\n   * Whether the tabs are disabled\n   * @type {boolean}\n   * @default false\n   */\n  @Prop() disabled: boolean = false;\n\n  /**\n   * Aria label for the tab list\n   * @type {string}\n   * @default 'Tabs'\n   */\n  @Prop() ariaLabel: string = 'Tabs';\n\n  @State() _selectedTab: Tab;\n\n  /**\n   * Emitted when a tab is selected\n   * @event tabChanged\n   * @type {CustomEvent<Tab>}\n   */\n  @Event() tabChanged: EventEmitter<Tab>;\n\n  private activeIndicator: HTMLSpanElement;\n  private animationFrameId: number;\n\n  componentWillLoad() {\n    const tab = this.tabs?.find(t => t.id === this.initialTab);\n    if (tab) {\n      this.selectTab(tab);\n    } else if (this.tabs?.length > 0) {\n      // Select first tab if no initial tab is specified\n      this.selectTab(this.tabs[0]);\n    }\n  }\n\n  // componentDidLoad() {\n  //   this.updateActiveIndicator();\n  // }\n\n  disconnectedCallback() {\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n  }\n\n  private updateActiveIndicator() {\n    // if (this.animationFrameId) {\n    //   cancelAnimationFrame(this.animationFrameId);\n    // }\n    // this.animationFrameId = requestAnimationFrame(() => {\n    //   const selectedTab = this.el.querySelector(`button.tab[data-state=\"selected\"]`);\n    //   if (selectedTab && this.activeIndicator) {\n    //     const { left, width } = selectedTab.getBoundingClientRect();\n    //     const parentLeft = this.el.getBoundingClientRect().left;\n    //     const position = left - parentLeft;\n    //     this.activeIndicator.style.width = `${width}px`;\n    //     this.activeIndicator.style.transform = `translateX(${position}px)`;\n    //   }\n    // });\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n    requestAnimationFrame(() => {\n      const selectedTab = this.el.querySelector(`.tab[data-state=\"selected\"]`);\n      if (selectedTab) {\n        const { left, width } = selectedTab.getBoundingClientRect();\n        const parentLeft = this.el.getBoundingClientRect().left;\n        const position = left - parentLeft - this.remSize;\n        this.activeIndicator.style.width = `${width - this.remSize}px`;\n        this.activeIndicator.style.transform = `translateX(${position}px)`;\n      }\n    });\n  }\n  private remSize = (() => {\n    const fontSize = getComputedStyle(document.documentElement).fontSize;\n    return parseFloat(fontSize);\n  })();\n  private selectTab(tab: Tab) {\n    if (this.disabled) return;\n\n    this._selectedTab = tab;\n    this.updateActiveIndicator();\n    this.tabChanged.emit(tab);\n  }\n\n  private handleKeyDown(event: KeyboardEvent, currentTab: Tab) {\n    if (this.disabled) return;\n\n    const currentIndex = this.tabs.findIndex(t => t.id === currentTab.id);\n    let nextIndex = currentIndex;\n\n    switch (event.key) {\n      case 'ArrowRight':\n        event.preventDefault();\n        nextIndex = (currentIndex + 1) % this.tabs.length;\n        break;\n      case 'ArrowLeft':\n        event.preventDefault();\n        nextIndex = currentIndex === 0 ? this.tabs.length - 1 : currentIndex - 1;\n        break;\n      case 'Home':\n        event.preventDefault();\n        nextIndex = 0;\n        break;\n      case 'End':\n        event.preventDefault();\n        nextIndex = this.tabs.length - 1;\n        break;\n      case 'Enter':\n      case ' ':\n        event.preventDefault();\n        this.selectTab(currentTab);\n        return;\n      default:\n        return;\n    }\n\n    const nextTab = this.tabs[nextIndex];\n    if (nextTab) {\n      this.selectTab(nextTab);\n      requestAnimationFrame(() => {\n        const tabButton = this.el.querySelector(`button.tab[data-tab-id=\"${nextTab.id}\"]`) as HTMLButtonElement;\n        if (tabButton) {\n          tabButton.focus();\n        }\n      });\n    }\n  }\n\n  render() {\n    return (\n      <Host role=\"tablist\" aria-label={this.ariaLabel} aria-orientation=\"horizontal\">\n        {this.tabs.map(tab => (\n          <button\n            class=\"tab\"\n            key={tab.id}\n            type=\"button\"\n            data-tab-id={tab.id}\n            role=\"tab\"\n            tabindex={this._selectedTab?.id === tab.id ? 0 : -1}\n            aria-selected={this._selectedTab?.id === tab.id ? 'true' : 'false'}\n            aria-controls={`tabpanel-${tab.id}`}\n            id={`tab-${tab.id}`}\n            disabled={this.disabled}\n            data-state={this._selectedTab?.id === tab.id ? 'selected' : undefined}\n            onClick={() => this.selectTab(tab)}\n            onKeyDown={event => this.handleKeyDown(event, tab)}\n          >\n            {tab.label}\n          </button>\n        ))}\n        <span class=\"active-indicator\" ref={el => (this.activeIndicator = el)}></span>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}