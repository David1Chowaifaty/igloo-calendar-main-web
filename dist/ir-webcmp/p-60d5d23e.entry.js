import{r as e,c as t,h as i,F as s,g as a,H as n}from"./p-61950c14.js";import{a as o}from"./p-bf44a732.js";import{B as r}from"./p-dc103a4b.js";import{R as l}from"./p-d1997bc9.js";import{l as c}from"./p-e19fbf2a.js";import{P as d}from"./p-9592e7ee.js";import{T as h}from"./p-59b1956e.js";import{g as b,f}from"./p-70dd5dc1.js";import{c as u}from"./p-cb14c0da.js";import{c as p,i as m}from"./p-7b1e39e2.js";import{a as g}from"./p-053e21aa.js";import{o as v,z as y,Z as k,t as x}from"./p-21e4b336.js";import{h as _}from"./p-6c4ba7c0.js";import{a as w,_ as C,b as D}from"./p-b2679b77.js";import"./p-0db2e55e.js";const T=".sc-ir-booking-details-h{overflow-x:hidden;--ir-dialog-max-width:20rem}.sc-ir-booking-details-h *.sc-ir-booking-details{font-family:inherit !important}.font-medium.sc-ir-booking-details{font-weight:600}.sc-ir-booking-details-h th.sc-ir-booking-details{font-weight:600}.h-28.sc-ir-booking-details{height:2rem}.mx-01.sc-ir-booking-details{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}.date-margin.sc-ir-booking-details{margin-right:5px}.pickup-margin.sc-ir-booking-details{margin-bottom:7px !important}.header-date.sc-ir-booking-details{padding-left:5px !important}.pointer.sc-ir-booking-details{cursor:pointer}.sc-ir-booking-details:root{--sidebar-width:50rem}.loading-container.sc-ir-booking-details{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.sm-padding-right.sc-ir-booking-details{padding-right:0.2rem}.sm-padding-left.sc-ir-booking-details{padding-left:0.2rem}.sm-padding-top.sc-ir-booking-details{padding-top:0.2rem}.sm-padding-bottom.sc-ir-booking-details{padding-bottom:0.2rem}.info-notes.sc-ir-booking-details{list-style:none;padding-left:0}.light-blue-bg.sc-ir-booking-details{background-color:#acecff;padding:0.2rem 0.3rem}.iframeHeight.sc-ir-booking-details{height:17.5rem}.dialog-title.sc-ir-booking-details{width:fit-content}";const O=T;const E=class{constructor(i){e(this,i);this.toast=t(this,"toast",7);this.bookingChanged=t(this,"bookingChanged",7);this.closeSidebar=t(this,"closeSidebar",7);this.language="";this.ticket="";this.bookingNumber="";this.is_from_front_desk=false;this.hasPrint=false;this.hasReceipt=false;this.hasDelete=false;this.hasMenu=false;this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.hasCloseButton=false;this.bookingItem=null;this.statusData=[];this.calendarData={};this.guestData=null;this.rerenderFlag=false;this.sidebarState=null;this.isUpdateClicked=false;this.isPMSLogLoading=false;this.bookingService=new r;this.roomService=new l;this.paymentService=new d;this.token=new h;this.printingBaseUrl="https://gateway.igloorooms.com/PrintBooking/%1/printing?id=%2"}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}ticketChanged(e,t){if(e===t){return}this.token.setToken(this.ticket);this.initializeApp()}handleSideBarEvents(e){this.sidebarState=e.detail.type}handleIconClick(e){const t=e.target;switch(t.id){case"pickup":this.sidebarState="pickup";return;case"close":this.closeSidebar.emit(null);return;case"print":this.openPrintingScreen();return;case"receipt":this.openPrintingScreen("invoice");return;case"book-delete":return;case"menu":window.location.href="https://x.igloorooms.com/manage/acbookinglist.aspx";return;case"room-add":this.bookingItem={ID:"",NAME:this.booking.guest.last_name,EMAIL:this.booking.guest.email,PHONE:this.booking.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.booking.from_date,ARRIVAL:this.booking.arrival,TO_DATE:this.booking.to_date,TITLE:`${c.entries.Lcz_AddingUnitToBooking}# ${this.booking.booking_nbr}`,defaultDateRange:{fromDate:new Date(this.booking.from_date),fromDateStr:"",toDate:new Date(this.booking.to_date),toDateStr:"",dateDifference:0,message:""},event_type:"ADD_ROOM",booking:this.booking,BOOKING_NUMBER:this.booking.booking_nbr,ADD_ROOM_TO_BOOKING:this.booking.booking_nbr,GUEST:this.booking.guest,message:this.booking.remark,SOURCE:this.booking.source,ROOMS:this.booking.rooms};return;case"extra_service_btn":this.sidebarState="extra_service";return;case"add-payment":return}}async handleResetExposedCancellationDueAmount(e){e.stopImmediatePropagation();e.stopPropagation();const t=await this.paymentService.GetExposedCancellationDueAmount({booking_nbr:this.booking.booking_nbr,currency_id:this.booking.currency.id});this.paymentActions=[...t]}handleEditInitiated(e){this.bookingItem=e.detail}async handleResetBooking(e){e.stopPropagation();e.stopImmediatePropagation();if(e.detail){return this.booking=e.detail}await this.resetBooking()}handleEditExtraService(e){this.selectedService=e.detail;this.sidebarState="extra_service"}setRoomsData(e){var t,i;let s=new Array;if((i=(t=e.My_Result)===null||t===void 0?void 0:t.roomtypes)===null||i===void 0?void 0:i.length){s=e.My_Result.roomtypes;e.My_Result.roomtypes.forEach((e=>{e.expanded=true}))}this.calendarData.roomsInfo=s}async initializeApp(){var e,t;try{const[i,s,a,n,o]=await Promise.all([this.roomService.getExposedProperty({id:this.propertyid||0,language:this.language,aname:this.p}),this.roomService.fetchLanguage(this.language),this.bookingService.getCountries(this.language),this.bookingService.getExposedBooking(this.bookingNumber,this.language),this.bookingService.getBedPreferences()]);this.property_id=(e=i===null||i===void 0?void 0:i.My_Result)===null||e===void 0?void 0:e.id;this.bedPreference=o;if((n===null||n===void 0?void 0:n.booking_nbr)&&((t=n===null||n===void 0?void 0:n.currency)===null||t===void 0?void 0:t.id)&&n.is_direct){this.paymentService.GetExposedCancellationDueAmount({booking_nbr:n.booking_nbr,currency_id:n.currency.id}).then((e=>{this.paymentActions=e}))}if(!(c===null||c===void 0?void 0:c.entries)){c.entries=s.entries;c.direction=s.direction}this.countryNodeList=a;const r=i===null||i===void 0?void 0:i.My_Result;if(r){const{allowed_payment_methods:e,currency:t,allowed_booking_sources:s,adult_child_constraints:a,calendar_legends:n,aname:o}=r;this.printingBaseUrl=this.printingBaseUrl.replace("%1",o).replace("%2",this.bookingNumber);this.calendarData={currency:t,allowed_booking_sources:s,adult_child_constraints:a,legendData:n};this.setRoomsData(i);const l=["001","004"];this.showPaymentDetails=e===null||e===void 0?void 0:e.some((e=>l.includes(e.code)))}else{console.warn("Room response is missing 'My_Result'.")}this.guestData=n.guest;this.booking=n}catch(e){console.error("Error initializing app:",e)}}async openPrintingScreen(e="print",t="new"){if(t==="old"){if(e==="invoice"){return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.booking.system_id}&&PM=I&TK=${this.ticket}`)}return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.booking.system_id}&&PM=B&TK=${this.ticket}`)}let i=this.printingBaseUrl;if(e==="invoice"){i=i+"&mode=invoice"}const{data:s}=await o.post(`Get_ShortLiving_Token`);if(!s.ExceptionMsg){i=i+`&token=${s.My_Result}`}window.open(i)}handleCloseBookingWindow(){this.bookingItem=null}handleDeleteFinish(e){this.booking=Object.assign(Object.assign({},this.booking),{rooms:this.booking.rooms.filter((t=>t.identifier!==e.detail))})}async resetBooking(){try{const e=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);this.booking=Object.assign({},e);this.bookingChanged.emit(this.booking)}catch(e){console.log(e)}}renderSidebarContent(){var e;const t=()=>{this.sidebarState=null};switch(this.sidebarState){case"guest":return i("ir-guest-info",{headerShown:true,slot:"sidebar-body",booking_nbr:this.bookingNumber,email:(e=this.booking)===null||e===void 0?void 0:e.guest.email,language:this.language,onCloseSideBar:t});case"pickup":return i("ir-pickup",{bookingDates:{from:this.booking.from_date,to:this.booking.to_date},slot:"sidebar-body",defaultPickupData:this.booking.pickup_info,bookingNumber:this.booking.booking_nbr,numberOfPersons:this.booking.occupancy.adult_nbr+this.booking.occupancy.children_nbr,onCloseModal:t});case"extra_note":return i("ir-booking-extra-note",{slot:"sidebar-body",booking:this.booking,onCloseModal:()=>this.sidebarState=null});case"extra_service":return i("ir-extra-service-config",{service:this.selectedService,booking:{from_date:this.booking.from_date,to_date:this.booking.to_date,booking_nbr:this.booking.booking_nbr,currency:this.booking.currency},slot:"sidebar-body",onCloseModal:()=>{t();if(this.selectedService){this.selectedService=null}}});default:return null}}render(){if(!this.booking){return i("div",{class:"loading-container"},i("ir-spinner",null))}return[i(s,null,!this.is_from_front_desk&&i(s,null,i("ir-toast",null),i("ir-interceptor",null))),i("ir-booking-header",{booking:this.booking,hasCloseButton:this.hasCloseButton,hasDelete:this.hasDelete,hasMenu:this.hasMenu,hasPrint:this.hasPrint,hasReceipt:this.hasReceipt}),i("div",{class:"fluid-container p-1 text-left mx-0"},i("div",{class:"row m-0"},i("div",{class:"col-12 p-0 mx-0 pr-lg-1 col-lg-6"},i("ir-reservation-information",{countries:this.countryNodeList,booking:this.booking}),i("div",{class:"font-size-large d-flex justify-content-between align-items-center mb-1"},i("ir-date-view",{from_date:this.booking.from_date,to_date:this.booking.to_date}),this.hasRoomAdd&&this.booking.is_direct&&this.booking.is_editable&&i("ir-button",{id:"room-add",icon_name:"square_plus",variant:"icon",style:{"--icon-size":"1.5rem"}})),i("div",{class:"card p-0 mx-0"},this.booking.rooms.map(((e,t)=>[i("ir-room",{language:this.language,bedPreferences:this.bedPreference,isEditable:this.booking.is_editable,legendData:this.calendarData.legendData,roomsInfo:this.calendarData.roomsInfo,myRoomTypeFoodCat:e.roomtype.name,mealCodeName:e.rateplan.short_name,currency:this.booking.currency.symbol,hasRoomEdit:this.hasRoomEdit&&this.booking.status.code!=="003"&&this.booking.is_direct,hasRoomDelete:this.hasRoomDelete&&this.booking.status.code!=="003"&&this.booking.is_direct,hasCheckIn:this.hasCheckIn,hasCheckOut:this.hasCheckOut,bookingEvent:this.booking,bookingIndex:t,onDeleteFinished:this.handleDeleteFinish.bind(this)}),t!==this.booking.rooms.length-1&&i("hr",{class:"mr-2 ml-2 my-0 p-0"})]))),i("ir-pickup-view",{booking:this.booking}),i("section",null,i("div",{class:"font-size-large d-flex justify-content-between align-items-center mb-1"},i("p",{class:"font-size-large p-0 m-0 "},c.entries.Lcz_ExtraServices),i("ir-button",{id:"extra_service_btn",icon_name:"square_plus",variant:"icon",style:{"--icon-size":"1.5rem"}})),i("ir-extra-services",{booking:{booking_nbr:this.booking.booking_nbr,currency:this.booking.currency,extra_services:this.booking.extra_services}}))),i("div",{class:"col-12 p-0 m-0 pl-lg-1 col-lg-6"},i("ir-payment-details",{paymentActions:this.paymentActions,bookingDetails:this.booking})))),i("ir-sidebar",{open:this.sidebarState!==null,side:"right",id:"editGuestInfo",onIrSidebarToggle:e=>{e.stopImmediatePropagation();e.stopPropagation();this.sidebarState=null},showCloseButton:false},this.renderSidebarContent()),i(s,null,this.bookingItem&&i("igl-book-property",{allowedBookingSources:this.calendarData.allowed_booking_sources,adultChildConstraints:this.calendarData.adult_child_constraints,showPaymentDetails:this.showPaymentDetails,countryNodeList:this.countryNodeList,currency:this.calendarData.currency,language:this.language,propertyid:this.property_id,bookingData:this.bookingItem,onCloseBookingWindow:()=>this.handleCloseBookingWindow()}))]}get element(){return a(this)}static get watchers(){return{ticket:["ticketChanged"]}}};E.style=O;const j=".sc-ir-booking-extra-note-h{display:block}";const S=j;const M=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.isLoading=false;this.note="";this.bookingService=new r}componentWillLoad(){if(this.booking.extras){this.setNote(b(this.booking.extras))}}setNote(e){this.note=e}async savePrivateNote(){try{this.isLoading=true;let e=this.booking.extras||[];const t={key:"private_note",value:this.note};if(e.length===0){e.push(t)}else{const i=e.findIndex((e=>e.key==="private_note"));if(i===-1){e.push(t)}else{e[i]=t}}const i=await this.bookingService.doReservation({assign_units:true,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,booking:this.booking,Is_Non_Technical_Change:true,extras:e});this.resetBookingEvt.emit(i);this.closeModal.emit(null)}catch(e){console.error(e)}finally{this.isLoading=false}}render(){return i(n,{key:"d40a028d240044a60fea38694ae8e7ad27bfbc76",class:"px-0"},i("ir-title",{key:"953f5461267a9a66e2a8cd56d77cfa0f5a89bb5b",class:"px-1",onCloseSideBar:()=>this.closeModal.emit(null),label:c.entries.Lcz_PrivateNote,displayContext:"sidebar"}),i("form",{key:"1bf0ccd328e5f9186283b733541090919beef28a",class:"px-1",onSubmit:e=>{e.preventDefault();this.savePrivateNote()}},i("ir-textarea",{key:"c5e9c4e6473713cb6e8b04b2f744a28b11ac225e",placeholder:c.entries.Lcz_PrivateNote_MaxChar,label:"",value:this.note,maxLength:150,onTextChange:e=>this.setNote(e.detail)}),i("div",{key:"3df2b921a0e2471a941059af1703ca000e4fc52f",class:"d-flex flex-column flex-sm-row mt-3"},i("ir-button",{key:"66574c98e52b2454ab07496d68f3a524d2e015e6",onClickHandler:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-sm-0 flex-fill  mr-sm-1'}`,icon:"",text:c.entries.Lcz_Cancel,btn_color:"secondary"}),i("ir-button",{key:"b2c19e249d3ddbcef599b59de32cd18b5a622c29",btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center ml-sm-1",icon:"",isLoading:this.isLoading,text:c.entries.Lcz_Save,btn_color:"primary",btn_type:"submit"}))))}};M.style=S;const $=".sc-ir-booking-header-h{display:block}.confirmed.sc-ir-booking-header{color:#fff;display:flex;align-items:center}.bg-ir-green.sc-ir-booking-header{background:#629a4c;padding:0.2rem 0.3rem}.bg-ir-red.sc-ir-booking-header{background:#ff4961;padding:0.2rem 0.3rem}.bg-ir-orange.sc-ir-booking-header{background:#ff9149;padding:0.2rem 0.3rem}";const B=$;const L=class{constructor(i){e(this,i);this.toast=t(this,"toast",7);this.closeSidebar=t(this,"closeSidebar",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.openSidebar=t(this,"openSidebar",7);this.bookingStatus=null;this.confirmationBG={"001":"bg-ir-orange","002":"bg-ir-green","003":"bg-ir-red","004":"bg-ir-red"};this.bookingService=new r}handleSelectChange(e){e.stopPropagation();e.stopImmediatePropagation();const t=e.target;this.bookingStatus=t.selectedValue}async updateStatus(){if(!this.bookingStatus||this.bookingStatus==="-1"){this.toast.emit({type:"error",description:"",title:c.entries.Lcz_SelectStatus,position:"top-right"});return}try{await this.bookingService.changeExposedBookingStatus({book_nbr:this.booking.booking_nbr,status:this.bookingStatus});this.toast.emit({type:"success",description:"",title:c.entries.Lcz_StatusUpdatedSuccessfully,position:"top-right"});this.bookingStatus=null;this.resetBookingEvt.emit(null)}catch(e){console.log(e)}}openDialog(e){const{type:t}=e;this.currentDialogStatus=t;this.dialogRef.openModal()}renderDialogBody(){switch(this.currentDialogStatus){case"pms":return i("ir-pms-logs",{slot:"modal-body",bookingNumber:this.booking.booking_nbr});case"events-log":return i("ir-events-log",{slot:"modal-body",bookingNumber:this.booking.booking_nbr})}}render(){return i("div",{key:"8462eefb8638b790fd78a987c7d9828e37de2431",class:"fluid-container px-1"},i("div",{key:"83f5321344136bd2a342eedd0565d963ce1c72ce",class:"d-flex flex-column p-0 mx-0 flex-lg-row align-items-md-center justify-content-between mt-1"},i("div",{key:"213b9461d736031ae95e4fcd237a538f1b225d7a",class:"m-0 p-0 mb-1 mb-lg-0 mt-md-0"},i("p",{key:"d8a0812398d45ff7f3eba1a9c5df2cb4b52da146",class:"font-size-large m-0 p-0"},`${c.entries.Lcz_Booking}#${this.booking.booking_nbr}`),i("p",{key:"6b7028ac4a655df63d6eab4828b0cb68d36df13e",class:"m-0 p-0"},!this.booking.is_direct&&i("span",{key:"2b5564ad7226032dea616be7282ee407c41f7859",class:"mr-1 m-0"},this.booking.channel_booking_nbr))),i("div",{key:"d2d506aae386458dcc062b12f52ad8599e65201a",class:"d-flex justify-content-end align-items-center",style:{gap:"1rem",flexWrap:"wrap"}},i("span",{key:"bd2a714f6269ec1881406255e764b5d9d98fd4c4",class:`confirmed btn-sm m-0  ${this.confirmationBG[this.booking.status.code]}`},this.booking.status.description),this.booking.allowed_actions.length>0&&this.booking.is_editable&&i("div",{key:"29f5d98a7e7037476eb477c31ae16ea05f6aeb6c",class:"m-0 p-0 d-flex align-items-center",style:{gap:"0.25rem"}},i("ir-select",{key:"e58112ae395e506d6591f3895a73f45916175cee",selectContainerStyle:"h-28",selectStyles:"d-flex status-select align-items-center h-28",firstOption:c.entries.Lcz_Select,id:"update-status",size:"sm","label-available":"false",data:this.booking.allowed_actions.map((e=>({text:e.description,value:e.code}))),textSize:"sm",class:"sm-padding-right m-0 ",selectedValue:this.bookingStatus}),i("ir-button",{key:"a2325c1d69c0a7a9655ad9d64987e169683e4f7c",onClickHandler:this.updateStatus.bind(this),btn_styles:"h-28",isLoading:g("/Change_Exposed_Booking_Status"),btn_disabled:g("/Change_Exposed_Booking_Status"),id:"update-status-btn",size:"sm",text:"Update"})),i("ir-button",{key:"7a946044b171f7ceedc132500b954bffa2fc1294",size:"sm",btn_color:"outline",text:c.entries.Lcz_EventsLog,onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.openDialog({type:"events-log"})}}),p.is_pms_enabled&&i("ir-button",{key:"2413095c947624932fb0eb18e5dd78bc6105776e",size:"sm",btn_color:"outline",text:c.entries.Lcz_pms,onClick:e=>{e.stopImmediatePropagation();e.stopPropagation();this.openDialog({type:"pms"})}}),this.hasReceipt&&i("ir-button",{key:"2086c95d985e592f516eb77c4bcc907a57dc1e30",variant:"icon",id:"receipt",icon_name:"reciept",class:"",style:{"--icon-size":"1.65rem"}}),this.hasPrint&&i("ir-button",{key:"f6c701f4380f14dff983950311403ecf263b95e4",variant:"icon",id:"print",icon_name:"print",class:"",style:{"--icon-size":"1.65rem"}}),this.hasDelete&&i("ir-button",{key:"3a476411b289e927a531d1cd85b3a22ca4dba60a",variant:"icon",id:"book-delete",icon_name:"trash",class:"",style:Object.assign(Object.assign({},u.danger),{"--icon-size":"1.65rem"})}),this.hasMenu&&i("ir-button",{key:"55eb167b725769ea2d3cc43abf8d06caa6ef990e",variant:"icon",class:"mr-1",id:"menu",icon_name:"menu_list",style:{"--icon-size":"1.65rem"}}),this.hasCloseButton&&i("ir-button",{key:"02c82fe82cb9d5db75cbd4988479e2da338d09f4",id:"close",variant:"icon",style:{"--icon-size":"1.65rem"},icon_name:"xmark",class:"ml-2",onClickHandler:e=>{e.stopPropagation();e.stopImmediatePropagation();this.closeSidebar.emit(null)}}))),i("ir-dialog",{key:"2fcfcabe975529a40e1e8cdfc2e533dfeac30363",onOpenChange:e=>{if(!e.detail){this.currentDialogStatus=null}},style:this.currentDialogStatus==="events-log"&&{"--ir-dialog-max-width":"400px"},ref:e=>this.dialogRef=e},this.renderDialogBody()))}};L.style=B;const z=":host{display:block;margin:0;padding:0;box-sizing:border-box}.backdrop{opacity:0;background:rgba(0, 0, 0, 0.2);position:fixed;inset:0;z-index:99999998}.backdrop[data-state='opened']{animation:overlayShow 150ms cubic-bezier(0.16, 1, 0.3, 1) forwards}.backdrop[data-state='closed']{opacity:0;pointer-events:none}.modal-container{box-sizing:border-box;margin:0;box-shadow:hsl(206 22% 7% / 35%) 0px 10px 38px -10px, hsl(206 22% 7% / 20%) 0px 10px 20px -15px;position:fixed;z-index:99999999;overflow-y:auto;top:50%;left:50%;background:white;transform:translate(-50%, -50%);width:90%;min-height:fit-content;height:fit-content;max-width:var(--ir-dialog-max-width, 40rem);max-height:85vh;border-radius:8px;padding:0;animation:contentShow 300ms cubic-bezier(0.16, 1, 0.3, 1)}.modal-footer ::slotted(*){flex-direction:row;align-items:center;justify-content:end;gap:8px;--ir-btn-width:inherit}.modal-footer{--ir-btn-width:100%}.modal-title ::slotted(*){font-size:18px;font-weight:600;color:#101828;margin-bottom:8px}.modal-body ::slotted(*){font-size:14px;font-weight:400;color:#475467;padding:0;margin:0}@keyframes overlayShow{from{opacity:0}to{opacity:1}}@keyframes contentShow{from{opacity:0;transform:translate(-50%, -48%) scale(0.96)}to{opacity:1;transform:translate(-50%, -50%) scale(1)}}.dialog-close-button{position:absolute;top:15px;right:15px}";const I=z;const A=class{constructor(i){e(this,i);this.openChange=t(this,"openChange",7);this.open=false;this.isOpen=false}componentWillLoad(){if(this.open){this.openModal()}}componentDidLoad(){this.prepareFocusTrap()}async openModal(){this.isOpen=true;document.body.style.overflow="hidden";setTimeout((()=>{this.prepareFocusTrap()}),10);this.openChange.emit(this.isOpen)}async closeModal(){console.log("close");if(!this.isOpen){return}document.body.style.overflow="visible";this.isOpen=false;this.openChange.emit(this.isOpen)}handleOpenChange(){if(this.open){this.openModal()}else{this.closeModal()}}prepareFocusTrap(){const e='button,ir-dropdown ,[href], input, select, textarea, [tabindex]:not([tabindex="-1"])';const t=this.el.shadowRoot.querySelectorAll(e);if(t.length===0)return;this.firstFocusableElement=t[0];this.lastFocusableElement=t[t.length-1];this.firstFocusableElement.focus()}handleKeyDown(e){if(!this.isOpen){return}let t=e.key==="Tab";if(e.key==="Escape"&&this.isOpen){this.closeModal()}if(!t){return}if(!e.shiftKey&&document.activeElement===this.lastFocusableElement){this.firstFocusableElement.focus();e.preventDefault()}if(e.shiftKey&&document.activeElement===this.firstFocusableElement){this.lastFocusableElement.focus();e.preventDefault()}}disconnectedCallback(){document.body.style.overflow="visible"}render(){return i(n,{key:"4e1bb56b72f733e5ea3c3a44280a7ae367e2feb2"},i("div",{key:"aaf9f8e0c08f7c605b158a5273e1abb8b997667c",class:"backdrop","data-state":this.isOpen?"opened":"closed",onClick:()=>this.closeModal()}),this.isOpen&&i("div",{key:"042ea6f09eac6c4d273fb81b280264a6f4e68df6",class:"modal-container",tabIndex:-1,role:"dialog","aria-labelledby":"dialog1Title","aria-describedby":"dialog1Desc"},i("ir-icon",{key:"709ee6d560af905d165175d9db05924b2c3e45eb",id:"close",class:"dialog-close-button",onIconClickHandler:()=>this.closeModal()},i("svg",{key:"a10df4b803842790e1544dd278602a4973a7850e",slot:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:18,width:18},i("path",{key:"224e7b3626512d9337a9d23e3aac25d621c546fb",fill:"#104064",class:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))),i("div",{key:"f8afd10ba89b6b78f938c666463ebf297fc3a0b1",class:"modal-title",id:"dialog1Title"},i("slot",{key:"48cdf56e3a56c96150de066ab5a3d26444c4768a",name:"modal-title"})),i("div",{key:"6a2866ec44f3bc14511d24149e169a05ec22f395",class:"modal-body",id:"dialog1Desc"},i("slot",{key:"fcc0afa1d8ae3498b3620679060ba07b0f6f49e8",name:"modal-body"})),i("div",{key:"b2d543a838e8eedea1888e7c55832399b43d298e",class:"modal-footer"},i("slot",{key:"bbcc7c53ec623442ca87febb7266f6744961c099",name:"modal-footer"}))))}get el(){return a(this)}static get watchers(){return{open:["handleOpenChange"]}}};A.style=I;const P=".sc-ir-events-log-h{display:block}.beta.sc-ir-events-log{background:var(--red);color:white;padding:0.2rem 0.3rem;font-size:12px;border-radius:4px;margin:0}.event-row.sc-ir-events-log{padding-bottom:0.5rem}.list-title.sc-ir-events-log{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-events-log{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-events-log{color:#629a4c;font-weight:600}.list-item.red.sc-ir-events-log{color:#ff4961;font-weight:600}.dates-row.sc-ir-events-log{display:flex;align-items:center;gap:0.875rem}";const R=P;const Y=class{constructor(t){e(this,t);this.bookingService=new r}componentWillLoad(){this.init()}async init(){try{this.bookingEvents=await this.bookingService.getExposedBookingEvents(this.bookingNumber)}catch(e){console.error(e)}}render(){var e;return i("div",{key:"165d4aa4908f671cb3279162969394473e40b362",class:"p-1"},i("div",{key:"cbef33594c0350d7ae600290c0e1d45b809274de",class:"d-flex  align-items-center",style:{gap:"0.5rem"}},i("h3",{key:"ef117bfb1ffddb3c6adc15db4fee30b808e62012",class:" text-left p-0 m-0  dialog-title "},c.entries.Lcz_EventsLog)),g("/Get_Exposed_Booking_Events")?i("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},i("ir-spinner",null)):i(s,null,i("table",{class:" dialog-container-height"},i("thead",{style:{opacity:"0"}},i("tr",null,i("th",null,"date"),i("th",null,"user"),i("th",null,"status"))),i("tbody",null,(e=this.bookingEvents)===null||e===void 0?void 0:e.map((e=>i("tr",{key:e.id,class:"pb-1"},i("td",{class:"event-row dates-row"},i("span",null,e.date),i("span",null,String(e.hour).padStart(2,"0"),":",String(e.minute).padStart(2,"0"),":",String(e.second).padStart(2,"0"))),i("td",{class:"pl-3 event-row "},e.type),i("td",{class:"pl-1 event-row "},e.user))))))))}};Y.style=R;const N=".sc-ir-extra-service-h{display:block}.extra-service-container.sc-ir-extra-service{display:flex;align-items:center;justify-content:space-between;gap:0.5rem}.extra-service-container.sc-ir-extra-service *.sc-ir-extra-service{padding:0;margin:0;box-sizing:border-box}.extra-service-actions.sc-ir-extra-service{display:flex;align-items:center;gap:0.5rem}.extra-service-conditional-date.sc-ir-extra-service{margin-top:0.5rem}";const H=N;const F=class{constructor(i){e(this,i);this.editExtraService=t(this,"editExtraService",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.bookingService=new r}async deleteService(){try{await this.bookingService.doBookingExtraService({service:this.service,is_remove:true,booking_nbr:this.bookingNumber});this.resetBookingEvt.emit(null)}catch(e){console.log(e)}}render(){return i(n,{key:"e004be15f6d7f151b52cbd59f3d5e0b34cab3092"},i("div",{key:"78ba31dc7fbd777e7905ef2e608243212440102e",class:"p-1"},i("div",{key:"f51a7a59ef29b27566f1e63b8d278ca991fc1769",class:"extra-service-container"},i("p",{key:"97beb7f82318bb625c0f9c777d9f16160873e825",class:"extra-service-description"},this.service.description),i("div",{key:"d8eced249938fdc2b554068fe232d9cf0717eadc",class:"extra-service-actions"},this.service.price&&i("p",{key:"806c51d7234956a001e8f73206793a14e7cb8b87",class:"extra-service-price p-0 m-0 font-weight-bold"},v(this.currencySymbol,this.service.price)),i("ir-button",{key:"3b19f0ed1bcf985272d7c47414b04ed75d6f9a17",id:`serviceEdit-${this.service.booking_system_id}`,class:"extra-service-edit-btn m-0 p-0",variant:"icon",icon_name:"edit",style:u.secondary,onClickHandler:()=>this.editExtraService.emit(this.service)}),i("ir-button",{key:"e9eb41a36a5e6c64e0c8efe037ab6c4b0c2a7770",class:"extra-service-delete-btn m-0 p-0",variant:"icon",onClickHandler:()=>this.irModalRef.openModal(),id:`roomDelete-${this.service.booking_system_id}`,icon_name:"trash",style:u.danger}))),i("div",{key:"48ef7864d948f529389d4eee8dd2c5409e94b2a2",class:"extra-service-conditional-date"},this.service.start_date&&this.service.end_date?i("ir-date-view",{class:"extra-service-date-view mr-1",from_date:this.service.start_date,to_date:this.service.end_date,showDateDifference:false}):this.service.start_date&&i("p",{class:"extra-service-date-view"},_(new Date(this.service.start_date)).format("MMM DD, YYYY")))),i("ir-modal",{key:"9850fadeb54e2735055f6986214d084fcd8d9d47",autoClose:false,ref:e=>this.irModalRef=e,isLoading:g("/Do_Booking_Extra_Service"),onConfirmModal:this.deleteService.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:c.entries.Lcz_Cancel,rightBtnText:c.entries.Lcz_Delete,leftBtnColor:"secondary",rightBtnColor:"danger",modalTitle:c.entries.Lcz_Confirmation,modalBody:`${c.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${c.entries.Lcz_ThisService} ${c.entries.Lcz_FromThisBooking}`}))}};F.style=H;const W=y.object({booking_system_id:y.number().optional(),cost:y.coerce.number().nullable(),currency_id:y.number().min(1),description:y.string().min(1),end_date:y.string().nullable(),price:y.coerce.number(),start_date:y.string().nullable(),system_id:y.number().optional()});const U=".sc-ir-extra-service-config-h{display:block;--ir-input-border-color:#cacfe7}.sc-ir-extra-service-config-h .input-group-text.sc-ir-extra-service-config{border-color:var(--ir-input-border-color)}.currency-ph.sc-ir-extra-service-config{padding:0;margin:0;color:#3b4781;display:flex;align-items:center;justify-content:center;padding:0 0 0 0.25rem;border-top:1px solid var(--ir-input-border-color);border-bottom:1px solid var(--ir-input-border-color);border-left:1px solid transparent;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.service-description-input.sc-ir-extra-service-config{height:70px !important}.service-description.sc-ir-extra-service-config .input-group-prepend.sc-ir-extra-service-config{background-color:#f4f5fa;border:1px solid var(--ir-input-border-color);border-top-left-radius:0.25rem;border-bottom-left-radius:0.25rem}.service-date-container.sc-ir-extra-service-config{padding:0;margin:0;display:flex;align-items:center;position:relative;width:100%;justify-content:center}.service-date-container.sc-ir-extra-service-config .btn-container.sc-ir-extra-service-config{position:absolute;right:5px;margin:0;display:flex;align-items:center;justify-content:center;padding:0}.service-description.sc-ir-extra-service-config .input-group-text.sc-ir-extra-service-config{height:fit-content;border:0;padding-top:0.75rem !important}.price-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config,.cost-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config{border-top:1px solid #1e9ff2;border-bottom:1px solid #1e9ff2;border-left:1px solid #1e9ff2}.currency-ph[data-state='error'].sc-ir-extra-service-config{border-color:var(--red, #ff4961)}.price-input.sc-ir-extra-service-config:focus{border-right-width:1px !important}.is-invalid.sc-ir-extra-service-config{background-image:none !important}.price-input.sc-ir-extra-service-config,.cost-input.sc-ir-extra-service-config{border-left:0}.row-group.sc-ir-extra-service-config{display:flex;flex-direction:column;gap:0.5rem}@media (min-width: 640px){.row-group.sc-ir-extra-service-config{flex-direction:row;align-items:center;gap:0}.cost-label.sc-ir-extra-service-config{border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.until-prepend.sc-ir-extra-service-config,.cost-input-placeholder.sc-ir-extra-service-config{border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}.date-from.sc-ir-extra-service-config,.price-input.sc-ir-extra-service-config{border-right-width:0 !important;border-top-right-radius:0 !important;border-bottom-right-radius:0 !important}}";const V=U;const G=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.bookingService=new r}componentWillLoad(){if(this.service){this.s_service=Object.assign({},this.service)}}async saveAmenity(){try{W.parse(this.s_service);await this.bookingService.doBookingExtraService({service:this.s_service,booking_nbr:this.booking.booking_nbr,is_remove:false});this.resetBookingEvt.emit(null);this.closeModal.emit(null)}catch(e){if(e instanceof k){this.error=true}console.error(e)}}updateService(e){let t=this.s_service;if(!t){t={cost:null,description:null,end_date:null,start_date:null,price:null,currency_id:this.booking.currency.id}}this.s_service=Object.assign(Object.assign({},t),e)}validatePrice(){var e,t,i,s;if(((e=this.s_service)===null||e===void 0?void 0:e.price)===undefined||((i=(t=this.s_service)===null||t===void 0?void 0:t.price)===null||i===void 0?void 0:i.toString())===""){return false}const a=W.pick({price:true});const n=a.safeParse({price:(s=this.s_service)===null||s===void 0?void 0:s.price});return n.success}render(){var e,t,s,a,o,r,l,d,h,b,f,u,p,m;return i(n,{key:"238347379ae76ea4ce5502e45a24e9801f088009",class:"p-0"},i("ir-title",{key:"ccbe6ebaa6118157ca4b1eef8cfd361b7ea3ad2a",class:"px-1",onCloseSideBar:()=>this.closeModal.emit(null),label:c.entries.Lcz_ExtraServices,displayContext:"sidebar"}),i("section",{key:"cfd508deaaa04ddb8182bcd891c0bf7b58709dd1",class:"px-1"},i("fieldset",{key:"0913a1cf084a22abd33a6579965158867d3263cf",class:"input-group mb-1 mt-3 service-description"},i("div",{key:"1683c89cc8e3a485900c05ca0fca4d277d32339e",class:"input-group-prepend"},i("span",{key:"7419624e74748a59a45cf60bd4f4a17d9d2d2835",class:"input-group-text"},c.entries.Lcz_Description)),i("textarea",{key:"85d77455358f6ff309ceb7074416d936ed5c832a",value:(e=this.s_service)===null||e===void 0?void 0:e.description,class:`form-control service-description-input ${this.error&&!((t=this.s_service)===null||t===void 0?void 0:t.description)?"is-invalid":""}`,style:{height:"7rem"},maxLength:250,onChange:e=>this.updateService({description:e.target.value}),"aria-label":"Amenity description"})),i("div",{key:"622da7a32032d481b41ff39dae09c6a27fd89a4e",class:"row-group mb-1"},i("div",{key:"2b55541beeef20907f0d040093516d46c2d9a363",class:"input-group"},i("div",{key:"5fc1086c689d673220ddcba1f91c20746de799a0",class:"input-group-prepend"},i("span",{key:"a2f766393e99823b4e845935a46e9caaea726f1b",class:"input-group-text",id:"basic-addon1"},c.entries.Lcz_DatesOn)),i("div",{key:"8e9e3c3ef98aa2a9b86a3ce7189800cd2abae8de",class:"form-control p-0 m-0 d-flex align-items-center justify-content-center date-from"},i("div",{key:"5534dbfe2d18886e42ad5e516c66c720effeb05e",class:"service-date-container"},i("ir-date-picker",{key:"c6310149b4b44809361f573fb1a3d1d61b3f52c7",emitEmptyDate:true,date:(s=this.s_service)===null||s===void 0?void 0:s.start_date,minDate:this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:e=>{var t;return this.updateService({start_date:(t=e.detail.start)===null||t===void 0?void 0:t.format("YYYY-MM-DD")})}},i("input",{key:"844c79003eb27b259feb604aaf77081fa5f83307",slot:"trigger",value:((a=this.s_service)===null||a===void 0?void 0:a.start_date)?w(this.s_service.start_date):null,style:{borderLeftWidth:"0",borderRightWidth:"0",width:"100%"},class:"text-center form-control input-sm"})),((o=this.s_service)===null||o===void 0?void 0:o.start_date)&&i("div",{key:"9a0744c5fa1e72f77dc3f5e6a3cdd0171907e493",class:"btn-container"},i("ir-button",{key:"4f146e7e04a85f56cf2735970e237a1daf0f82d5",title:"clear",id:"close",variant:"icon",style:{"--icon-size":"0.875rem"},icon_name:"xmark-fill",class:"ml-2",onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.updateService({start_date:null})}}))))),i("div",{key:"bd3000f22c1fe37b1b022ccef0efb74c38d2408c",class:"input-group"},i("div",{key:"928c40206a3484904f822d728dd1492a15ed7aa0",class:"input-group-prepend "},i("span",{key:"7bc38542dfe583b3cbb5041902c1b9875e066ce9",class:"input-group-text until-prepend",id:"basic-addon1"},c.entries.Lcz_TillAndIncluding)),i("div",{key:"babdaf308324a4c39e6d1322a81c01a82f99c319",class:"form-control p-0 m-0 d-flex align-items-center justify-content-center"},i("div",{key:"a000544f5cfe87e93004eda85a0d87b757109d1b",class:"service-date-container"},i("ir-date-picker",{key:"90a9e0575a2f6a894357f96956dfa1cd6c0c07d7",emitEmptyDate:true,date:(r=this.s_service)===null||r===void 0?void 0:r.end_date,minDate:(d=(l=this.s_service)===null||l===void 0?void 0:l.start_date)!==null&&d!==void 0?d:this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:e=>{var t;e.stopImmediatePropagation();e.stopPropagation();this.updateService({end_date:(t=e.detail.start)===null||t===void 0?void 0:t.format("YYYY-MM-DD")})}},i("input",{key:"e3985b8435378c44e9b51d7a4e8853e25eda6103",slot:"trigger",value:((h=this.s_service)===null||h===void 0?void 0:h.end_date)?w(this.s_service.end_date):null,style:{borderLeftWidth:"0",borderRightWidth:"0",width:"100%"},class:"text-center form-control input-sm"})),((b=this.s_service)===null||b===void 0?void 0:b.end_date)&&i("div",{key:"a9508ab68593439049d9c14c59ca46dbfd4cfff6",class:"btn-container"},i("ir-button",{key:"ba51e3700ebd50b61eb43989d6e5fd2c1dcd436b",title:"clear",id:"close",variant:"icon",style:{"--icon-size":"0.875rem"},icon_name:"xmark-fill",class:"ml-2",onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.updateService({end_date:null})}})))))),i("div",{key:"8bf716b6924c34c1c8da011a4ef0660e6342eab0",class:"row-group"},i("ir-price-input",{key:"497d1e54cdce73cb15b4fd448241de468c6586d8",label:"Price",currency:this.booking.currency.symbol,class:"ir-br-input-none",value:(u=(f=this.s_service)===null||f===void 0?void 0:f.price)===null||u===void 0?void 0:u.toString(),zod:W.pick({price:true}),"aria-label":c.entries.Lcz_Price,wrapKey:"price","aria-describedby":"service price",autoValidate:false,"data-state":this.error&&!this.validatePrice()?"error":"",onTextChange:e=>this.updateService({price:parseFloat(e.detail)})}),i("ir-price-input",{key:"2838cf9739eb74609a66d4ca1a6a06cff9d36b36",autoValidate:false,label:c.entries.Lcz_Cost,labelStyle:"cost-label",currency:this.booking.currency.symbol,value:(m=(p=this.s_service)===null||p===void 0?void 0:p.cost)===null||m===void 0?void 0:m.toString(),zod:W.pick({cost:true}),onTextChange:e=>this.updateService({cost:parseFloat(e.detail)}),wrapKey:"cost","aria-label":"Cost","aria-describedby":"service cost"})),i("div",{key:"80cd8f1a381de635900a4ad7c15833da765c885d",class:"d-flex flex-column flex-sm-row mt-3"},i("ir-button",{key:"631f4abfdb99ed6fc9b7a74f21a819c318fd901c",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-sm-0 flex-fill mr-sm-1`,icon:"",text:c.entries.Lcz_Cancel,btn_color:"secondary"}),i("ir-button",{key:"d6633d9eb4161e383364af0ae43dc1c8f7d9fd96",btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center",icon:"",isLoading:g("/Do_Booking_Extra_Service"),text:c.entries.Lcz_Save,btn_color:"primary",onClick:this.saveAmenity.bind(this)}))))}};G.style=V;const K=".sc-ir-extra-services-h{display:block}";const q=K;const Q=class{constructor(t){e(this,t)}render(){var e;return i(n,{key:"987a62c9a43284566841257739eb4293d75d6083",class:"card p-0 "},(e=this.booking.extra_services)===null||e===void 0?void 0:e.map(((e,t)=>i(s,null,i("ir-extra-service",{bookingNumber:this.booking.booking_nbr,currencySymbol:this.booking.currency.symbol,key:e.booking_system_id,service:e}),t!==this.booking.extra_services.length-1&&i("hr",{class:"mr-2 ml-2 my-0 p-0"})))))}};Q.style=q;const Z=".input-group-text.sc-ir-guest-info{min-width:10rem;text-align:left}.mobilePrefixSelect.sc-ir-guest-info{border-right-width:0;border-top-right-radius:0;border-bottom-right-radius:0}.mobilePrefixInput.sc-ir-guest-info{border-top-left-radius:0;border-bottom-left-radius:0}.check-container.sc-ir-guest-info{position:relative;cursor:pointer;font-size:14px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;align-items:center}.check-container.sc-ir-guest-info input.sc-ir-guest-info{position:relative;opacity:0;cursor:pointer;height:0;width:0}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info{position:relative;top:0;left:0;height:20px;width:20px;border:1px solid #cacfe7;border-radius:4px;transition:all 0.3s ease}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info{background-color:#1e9ff2;border-color:#1e9ff2}.checkmark.sc-ir-guest-info:after{content:'';position:absolute;display:none}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info:after{display:block}.check-label.sc-ir-guest-info{margin-left:10px !important}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info:after{left:6px;top:3px;width:6px;height:10px;border:solid white;border-width:0 2px 2px 0;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.ir-card-header.sc-ir-guest-info{width:100%;border-bottom:1px solid #e4e5ec}.close-icon.sc-ir-guest-info{margin:0}.border-theme.sc-ir-guest-info{border:1px solid #cacfe7}";const J=Z;const X=class{constructor(i){e(this,i);this.closeSideBar=t(this,"closeSideBar",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.submit=false;this.guest=null;this.isLoading=false;this.bookingService=new r;this.roomService=new l;this.token=new h}async componentWillLoad(){if(this.ticket){this.token.setToken(this.ticket)}if(!!this.token.getToken())await this.init()}ticketChanged(e,t){if(e===t){return}this.token.setToken(this.ticket);this.init()}async init(){try{const[e,t,i]=await Promise.all([this.bookingService.fetchGuest(this.email),this.bookingService.getCountries(this.language),!c||!c.entries||Object.keys(c.entries).length===0?this.roomService.fetchLanguage(this.language):Promise.resolve(null)]);if(i){c.entries=i.entries;c.direction=i.direction}this.countries=t;this.guest=Object.assign(Object.assign({},e),{mobile:e.mobile_without_prefix})}catch(e){console.log(e)}}handleInputChange(e){this.guest=Object.assign(Object.assign({},this.guest),e)}async editGuest(){var e;try{this.isLoading=true;await this.bookingService.editExposedGuest(this.guest,(e=this.booking_nbr)!==null&&e!==void 0?e:null);this.closeSideBar.emit(null);this.resetBookingEvt.emit(null)}catch(e){console.log(e)}finally{this.isLoading=false;console.log("done")}}render(){var e,t,s,a,n,o,r;if(!this.guest){return null}return[i("div",{class:"p-0"},this.headerShown&&i("div",{class:"position-sticky mb-1 shadow-none p-0"},i("div",{class:"d-flex align-items-center justify-content-between ir-card-header py-1 p-0"},i("h3",{class:"card-title text-left font-medium-2 px-1 my-0"},c.entries.Lcz_GuestDetails),i("ir-icon",{class:"close close-icon px-1",onIconClickHandler:()=>{this.closeSideBar.emit(null)}},i("svg",{slot:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:20,width:20},i("path",{d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))))),i("div",{class:"card-content collapse show"},i("div",{class:this.headerShown?"card-body px-1":"pt-0"},i("ir-input-text",{placeholder:"",label:c.entries.Lcz_FirstName,name:"firstName",submited:this.submit,value:(e=this.guest)===null||e===void 0?void 0:e.first_name,required:true,onTextChange:e=>this.handleInputChange({first_name:e.detail})}),i("ir-input-text",{placeholder:"",label:c.entries.Lcz_LastName,name:"lastName",submited:this.submit,value:(t=this.guest)===null||t===void 0?void 0:t.last_name,required:true,onTextChange:e=>this.handleInputChange({last_name:e.detail})}),i("ir-input-text",{placeholder:"",label:c.entries.Lcz_Email,name:"email",submited:this.submit,value:(s=this.guest)===null||s===void 0?void 0:s.email,required:true,onTextChange:e=>this.handleInputChange({email:e.detail})}),i("ir-input-text",{placeholder:"",label:c.entries.Lcz_AlternativeEmail,name:"altEmail",value:(a=this.guest)===null||a===void 0?void 0:a.alternative_email,onTextChange:e=>this.handleInputChange({alternative_email:e.detail})}),i("ir-select",{selectContainerStyle:"mb-1",required:true,name:"country",submited:this.submit,label:c.entries.Lcz_Country,selectedValue:(o=(n=this.guest.country_id)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:"",data:this.countries.map((e=>({value:e.id.toString(),text:e.name}))),firstOption:"...",onSelectChange:e=>this.handleInputChange({country_id:e.detail})}),i("ir-phone-input",{onTextChange:e=>{e.stopImmediatePropagation();e.stopPropagation();const{mobile:t,phone_prefix:i}=e.detail;if(t!==this.guest.mobile){this.handleInputChange({mobile:t})}if(i!==this.guest.country_phone_prefix)this.handleInputChange({country_phone_prefix:i})},phone_prefix:this.guest.country_phone_prefix,value:this.guest.mobile,language:this.language,label:c.entries.Lcz_MobilePhone,countries:this.countries}),i("div",{class:"mb-2"},i("ir-textarea",{variant:"prepend",onTextChange:e=>this.handleInputChange({notes:e.detail}),value:(r=this.guest)===null||r===void 0?void 0:r.notes,label:c.entries.Lcz_PrivateNote})),i("div",{class:"p-0 m-0"},i("label",{class:`check-container m-0 p-0`},i("input",{class:"m-0 p-0",type:"checkbox",name:"newsletter",checked:this.guest.subscribe_to_news_letter,onInput:e=>this.handleInputChange({subscribe_to_news_letter:e.target.checked})}),i("span",{class:"checkmark m-0 p-0"}),i("span",{class:"m-0 p-0  check-label"},c.entries.Lcz_Newsletter))),i("hr",null),i("ir-button",{isLoading:this.isLoading,btn_disabled:this.isLoading,btn_styles:"d-flex align-items-center justify-content-center",text:c.entries.Lcz_Save,onClickHandler:this.editGuest.bind(this),color:"btn-primary"}))))]}static get watchers(){return{ticket:["ticketChanged"]}}};X.style=J;const ee=".sc-ir-payment-actions-h{display:block}.sc-ir-payment-actions-h p.sc-ir-payment-actions,.sc-ir-payment-actions-h div.sc-ir-payment-actions,.sc-ir-payment-actions-h span.sc-ir-payment-actions,.sc-ir-payment-actions-h ir-icons.sc-ir-payment-actions{box-sizing:border-box;padding:0;margin:0}.action-container.sc-ir-payment-actions td.sc-ir-payment-actions{padding:0px 0.5rem;padding-bottom:0.5rem}.action-container.sc-ir-payment-actions .amount_action.sc-ir-payment-actions{padding-inline-start:0}.overdue_action.sc-ir-payment-actions{color:#ff4961;border-radius:0.25rem;display:flex;align-items:center;gap:0.5rem}.future_action.sc-ir-payment-actions{border-radius:0.25rem;color:#1e9ff2;display:flex;align-items:center;justify-content:start;gap:0.5rem}.date_action.sc-ir-payment-actions{font-weight:500}.amount_action.sc-ir-payment-actions{font-weight:600}";const te=ee;const ie=class{constructor(i){e(this,i);this.generatePayment=t(this,"generatePayment",7)}render(){var e,t;if(((e=this.paymentAction)===null||e===void 0?void 0:e.filter((e=>e.amount!==0)).length)==0){return null}return i(n,null,i("div",{class:"my-1"},i("span",{class:"font-medium"},"Payment actions")),i("table",null,i("thead",null,i("th",null,i("p",{class:"sr-only"},"Amount")),i("th",null,i("p",{class:"sr-only"},"Due date")),i("th",null,i("p",{class:"sr-only"},"Pay")),i("th",null,i("p",{class:"sr-only"},"Status"))),i("tbody",null,(t=this.paymentAction)===null||t===void 0?void 0:t.map((e=>{if(!e.due_on){return null}return i("tr",{class:"action-container"},i("td",{class:"amount_action"},v(e.currency.symbol,e.amount)),i("td",{class:"date_action"},_(new Date(e.due_on)).format("ddd, DD MMM YYYY")),e.amount>0&&i("td",null,i("ir-button",{btn_color:"outline",text:"Pay",size:"sm",onClickHandler:()=>this.generatePayment.emit(e)})),e.type==="overdue"&&e.amount>0&&i("td",null,i("div",{class:"overdue_action"},i("svg",{height:16,width:16,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},i("path",{fill:"currentColor",d:"M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480L40 480c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24l0 112c0 13.3 10.7 24 24 24s24-10.7 24-24l0-112c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"})),i("span",null,"Overdue"))),e.type==="future"&&e.amount>0&&i("td",null,i("div",{class:"future_action "},i("svg",{xmlns:"http://www.w3.org/2000/svg",height:16,width:16,viewBox:"0 0 512 512"},i("path",{fill:"currentColor",d:"M256 0a256 256 0 1 1 0 512A256 256 0 1 1 256 0zM232 120l0 136c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2 280 120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"})),i("span",null,_(new Date(e.due_on)).isSame(new Date)?"Today":"Future"))))})))))}};ie.style=te;const se=".sm-margin-right.sc-ir-payment-details{margin-right:5px !important;background:#000}.action_icons.sc-ir-payment-details{width:60px}.w-60.sc-ir-payment-details{width:100px;padding:0 5px}.payments-height.sc-ir-payment-details{height:30px}.payment_date.sc-ir-payment-details{width:100px}.iframeHeight.sc-ir-payment-details{height:max-content;height:22.5rem}.designation.sc-ir-payment-details{width:120px}.total-cost-container.sc-ir-payment-details{background:#7cbebe;color:white;padding:0.5rem;border-radius:5px}.payment-actions.sc-ir-payment-details{display:flex;align-items:center;justify-content:center;height:100%;gap:0.5rem}.payment_action_beta_container.sc-ir-payment-details{border:1px solid var(--red);position:relative;padding:4px;box-sizing:border-box;border-radius:4px}.beta.sc-ir-payment-details{position:absolute;top:4px;background:var(--red);color:white;padding:0.2rem 0.3rem;font-size:12px;border-radius:4px;right:4px;margin:0}";const ae=se;const ne=class{constructor(i){e(this,i);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.resetExposedCancelationDueAmount=t(this,"resetExposedCancelationDueAmount",7);this.toast=t(this,"toast",7);this.newTableRow=false;this.collapsedPayment=false;this.collapsedGuarantee=false;this.flag=false;this.confirmModal=false;this.paymentDetailsUrl="";this.paymentExceptionMessage="";this.modal_mode=null;this.paymentService=new d;this.bookingService=new r;this.paymentBackground="white"}handlePaymentGeneration(e){const t=e.detail;this.newTableRow=true;this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{amount:t.amount,date:t.due_on});this.paymentBackground="rgba(250, 253, 174)"}async componentWillLoad(){try{this.initializeItemToBeAdded()}catch(e){if(this.bookingDetails.guest.cci){return}if(!this.bookingDetails.is_direct&&this.bookingDetails.channel_booking_nbr){this.paymentExceptionMessage=e}}}initializeItemToBeAdded(){this.itemToBeAdded={id:-1,date:_().format("YYYY-MM-DD"),amount:null,currency:this.bookingDetails.currency,designation:"",reference:""};this.paymentBackground="white"}async _processPaymentSave(){if(this.itemToBeAdded.amount===null){this.toast.emit({type:"error",title:c.entries.Lcz_EnterAmount,description:"",position:"top-right"});return}if(Number(this.itemToBeAdded.amount)>Number(this.bookingDetails.financial.due_amount)){this.modal_mode="save";this.openModal();return}this._handleSave()}async _handleSave(){this.paymentBackground="white";try{await this.paymentService.AddPayment(this.itemToBeAdded,this.bookingDetails.booking_nbr);this.initializeItemToBeAdded();this.resetBookingEvt.emit(null);this.resetExposedCancelationDueAmount.emit(null)}catch(e){console.log(e)}}handlePaymentInputChange(e,t,i){this.paymentBackground="white";if(e==="amount"){if(!isNaN(t)||t===""){if(t===""){this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[e]:null})}else{this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[e]:parseFloat(t)})}}else if(i&&i.target){let e=i.target;let t=e.value;t=t.replace(/[^\d-]|(?<!^)-/g,"");e.value=t}}else{this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[e]:t})}}async cancelPayment(){try{await this.paymentService.CancelPayment(this.toBeDeletedItem.id);const e=this.bookingDetails.financial.payments.filter((e=>e.id!==this.toBeDeletedItem.id));this.bookingDetails=Object.assign(Object.assign({},this.bookingDetails),{financial:Object.assign(Object.assign({},this.bookingDetails.financial),{payments:e})});this.confirmModal=!this.confirmModal;this.resetBookingEvt.emit(null);this.resetExposedCancelationDueAmount.emit(null);this.toBeDeletedItem=null;this.modal_mode=null}catch(e){console.log(e)}}async handleConfirmModal(e){this.paymentBackground="white";e.stopImmediatePropagation();e.stopPropagation();if(this.modal_mode==="delete"){await this.cancelPayment()}else{await this._handleSave()}}openModal(){const e=document.querySelector(".delete-record-modal");e.openModal()}async handleCancelModal(e){e.stopImmediatePropagation();e.stopPropagation();try{this.paymentBackground="white";if(this.modal_mode==="save"){this.initializeItemToBeAdded()}}catch(e){console.log(e)}}handleBookingDetails(){if(this.newTableRow){this.newTableRow=false}}handleDateChange(e){this.handlePaymentInputChange("date",e.detail.end.format("YYYY-MM-DD"))}_renderTableRow(e,t="normal"){var a,n,o;return i(s,null,i("tr",null,i("td",{class:"border payments-height border-light border-bottom-0 text-center"},t==="normal"?i("span",{class:"sm-padding-left"},w(e.date)):i("ir-date-picker",{date:((a=this.itemToBeAdded)===null||a===void 0?void 0:a.date)?new Date(this.itemToBeAdded.date):new Date,minDate:_().add(-2,"months").startOf("month").format("YYYY-MM-DD"),class:"d-flex justify-content-center",onDateChanged:this.handleDateChange.bind(this)},i("input",{type:"text",slot:"trigger",value:w((n=this.itemToBeAdded)===null||n===void 0?void 0:n.date),class:"text-center  form-control flex-grow-1 w-100",style:{border:"0",marginLeft:"auto",marginRight:"auto",width:"100%"}}))),i("td",{class:"border payments-height border-light border-bottom-0 text-center "},t==="normal"?i("span",{class:"sm-padding-right"},v(this.bookingDetails.currency.symbol,e.amount)):i("input",{type:"text",class:"border-0 text-center form-control py-0 m-0 w-100",value:this.itemToBeAdded.amount,onBlur:e=>{e.target.value=Number(this.itemToBeAdded.amount).toFixed(2)},onInput:e=>this.handlePaymentInputChange("amount",+e.target.value,e)})),i("td",{class:"border payments-height border-light border-bottom-0 text-center"},t==="normal"?i("span",{class:"sm-padding-left"},e.designation):i("input",{class:"border-0 w-100 form-control py-0 m-0",onInput:e=>this.handlePaymentInputChange("designation",e.target.value),type:"text"})),i("td",{rowSpan:2,class:"border payments-height border-light border-bottom-0 text-center"},i("div",{class:"payment-actions"},t==="add"&&i("ir-button",{variant:"icon",icon_name:"save",style:u.secondary,isLoading:t==="add"&&g("/Do_Payment"),class:"m-0",onClickHandler:()=>{this._processPaymentSave()}}),i("ir-button",{variant:"icon",icon_name:"trash",style:u.danger,isLoading:((o=this.toBeDeletedItem)===null||o===void 0?void 0:o.id)===(e===null||e===void 0?void 0:e.id)&&g("/Cancel_Payment"),onClickHandler:t==="add"?()=>{this.newTableRow=false;this.initializeItemToBeAdded()}:()=>{this.modal_mode="delete";this.toBeDeletedItem=e;this.openModal()}})))),i("tr",null,i("td",{colSpan:3,class:"border border-light payments-height border-bottom-0 text-center"},t==="normal"?i("span",{class:"sm-padding-left "},e.reference):i("input",{class:"border-0 w-100  form-control py-0 m-0",onKeyPress:e=>{if(e.key==="Enter"){this.newTableRow=false;this._handleSave()}},onInput:e=>this.handlePaymentInputChange("reference",e.target.value),type:"text"}))))}formatCurrency(e,t,i="en-US"){if(!t){return}if(e>=0){return new Intl.NumberFormat(i,{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}return}bookingGuarantee(){var e,t,s,a,n,o,r,l,d,h,b,f,u,p,m,g,v,y,k,x,_,w,C,D,T,O,E,j,S,M,$,B,L,z,I,A;const P=this.bookingDetails.is_direct?this.getPaymentMethod():null;if(this.bookingDetails.is_direct&&!P&&!this.bookingDetails.guest.cci){return null}return i("div",{class:"mb-1"},i("div",{class:"d-flex align-items-center"},i("span",{class:"mr-1 font-medium"},c.entries.Lcz_BookingGuarantee,!!P&&i("span",null,": ",P)),(!this.bookingDetails.is_direct||this.bookingDetails.is_direct&&this.bookingDetails.guest.cci)&&i("ir-button",{id:"drawer-icon","data-toggle":"collapse","data-target":`.guarrantee`,"aria-expanded":this.collapsedGuarantee?"true":"false","aria-controls":"myCollapse",class:"sm-padding-right pointer",variant:"icon",icon_name:"credit_card",onClickHandler:async()=>{if(!this.bookingDetails.is_direct&&this.bookingDetails.channel_booking_nbr&&!this.bookingDetails.guest.cci){this.paymentDetailsUrl=await this.bookingService.getPCICardInfoURL(this.bookingDetails.booking_nbr)}this.collapsedGuarantee=!this.collapsedGuarantee}})),i("div",{class:"collapse guarrantee "},this.bookingDetails.guest.cci?[i("div",null,((t=(e=this.bookingDetails)===null||e===void 0?void 0:e.guest)===null||t===void 0?void 0:t.cci)&&"Card:"," ",i("span",null,((n=(a=(s=this.bookingDetails)===null||s===void 0?void 0:s.guest)===null||a===void 0?void 0:a.cci)===null||n===void 0?void 0:n.nbr)||"")," ",((l=(r=(o=this.bookingDetails)===null||o===void 0?void 0:o.guest)===null||r===void 0?void 0:r.cci)===null||l===void 0?void 0:l.expiry_month)&&"Expiry: ",i("span",null," ",((b=(h=(d=this.bookingDetails)===null||d===void 0?void 0:d.guest)===null||h===void 0?void 0:h.cci)===null||b===void 0?void 0:b.expiry_month)||""," ",((p=(u=(f=this.bookingDetails)===null||f===void 0?void 0:f.guest)===null||u===void 0?void 0:u.cci)===null||p===void 0?void 0:p.expiry_year)&&"/"+((v=(g=(m=this.bookingDetails)===null||m===void 0?void 0:m.guest)===null||g===void 0?void 0:g.cci)===null||v===void 0?void 0:v.expiry_year))),i("div",null,((k=(y=this.bookingDetails)===null||y===void 0?void 0:y.guest)===null||k===void 0?void 0:k.cci.holder_name)&&"Name:"," ",i("span",null,((w=(_=(x=this.bookingDetails)===null||x===void 0?void 0:x.guest)===null||_===void 0?void 0:_.cci)===null||w===void 0?void 0:w.holder_name)||"")," ",((T=(D=(C=this.bookingDetails)===null||C===void 0?void 0:C.guest)===null||D===void 0?void 0:D.cci)===null||T===void 0?void 0:T.cvc)&&"- CVC:"," ",i("span",null," ",((j=(E=(O=this.bookingDetails)===null||O===void 0?void 0:O.guest)===null||E===void 0?void 0:E.cci)===null||j===void 0?void 0:j.cvc)||""))]:this.paymentDetailsUrl?i("iframe",{src:this.paymentDetailsUrl,width:"100%",class:"iframeHeight",frameborder:"0",name:"payment"}):i("div",{class:"text-center"},this.paymentExceptionMessage)),!this.bookingDetails.is_direct&&this.bookingDetails.ota_guarante&&i("div",null,i("ir-label",{content:((S=this.bookingDetails.ota_guarante)===null||S===void 0?void 0:S.card_type)+`${((M=this.bookingDetails.ota_guarante)===null||M===void 0?void 0:M.is_virtual)?" (virtual)":""}`,labelText:`${c.entries.Lcz_CardType}:`}),i("ir-label",{content:($=this.bookingDetails.ota_guarante)===null||$===void 0?void 0:$.cardholder_name,labelText:`${c.entries.Lcz_CardHolderName}:`}),i("ir-label",{content:(B=this.bookingDetails.ota_guarante)===null||B===void 0?void 0:B.card_number,labelText:`${c.entries.Lcz_CardNumber}:`}),i("ir-label",{content:this.formatCurrency(Number((z=(L=this.bookingDetails.ota_guarante)===null||L===void 0?void 0:L.meta)===null||z===void 0?void 0:z.virtual_card_current_balance),(A=(I=this.bookingDetails.ota_guarante)===null||I===void 0?void 0:I.meta)===null||A===void 0?void 0:A.virtual_card_currency_code),labelText:`${c.entries.Lcz_CardBalance}:`})))}checkPaymentCode(e){var t,i,s;console.log(p.allowed_payment_methods);return(s=(i=(t=p.allowed_payment_methods)===null||t===void 0?void 0:t.find((t=>t.code===e)))===null||i===void 0?void 0:i.description)!==null&&s!==void 0?s:null}getPaymentMethod(){var e,t,i,s;let a=null;const n=(t=(e=this.bookingDetails)===null||e===void 0?void 0:e.extras)===null||t===void 0?void 0:t.find((e=>e.key==="payment_code"));if(this.bookingDetails.agent){const e=(s=(i=this.bookingDetails)===null||i===void 0?void 0:i.extras)===null||s===void 0?void 0:s.find((e=>e.key==="agent_payment_mode"));if(e){a=e.value==="001"?c.entries.Lcz_OnCredit:n?this.checkPaymentCode(n.value):null}}else{if(n){a=this.checkPaymentCode(n.value)}}return a}_renderDueDate(e){return i("tr",null,i("td",{class:"pr-1"},w(e.date)),i("td",{class:"pr-1"},v(this.bookingDetails.currency.symbol,e.amount)),i("td",{class:"pr-1"},e.description),i("td",{class:"collapse font-size-small roomName"},e.room))}render(){var e,t;if(!this.bookingDetails.financial){return null}return[i("div",{class:"card m-0"},i("div",{class:"p-1"},this.bookingDetails.financial.gross_cost>0&&this.bookingDetails.financial.gross_cost!==null&&i("div",{class:"mb-2 h4 total-cost-container"},c.entries.Lcz_TotalCost,": ",i("span",null,v(this.bookingDetails.currency.symbol,this.bookingDetails.financial.gross_cost))),i("div",{class:" h4"},c.entries.Lcz_Balance,":"," ",i("span",{class:"danger font-weight-bold"},v(this.bookingDetails.currency.symbol,this.bookingDetails.financial.due_amount))),i("div",{class:"mb-2 h4"},c.entries.Lcz_Collected,":"," ",i("span",{class:""},v(this.bookingDetails.currency.symbol,this.bookingDetails.financial.payments?this.bookingDetails.financial.payments.reduce(((e,t)=>e+t.amount),0):0))),this.bookingGuarantee(),((e=this.paymentActions)===null||e===void 0?void 0:e.filter((e=>e.amount!==0)).length)>0&&this.bookingDetails.is_direct&&i("div",{class:"payment_action_beta_container"},i("p",{class:"beta"},"Beta"),i("ir-payment-actions",{paymentAction:this.paymentActions,booking:this.bookingDetails})),i("div",{class:"mt-2 d-flex  flex-column rounded payment-container"},i("div",{class:"d-flex align-items-center justify-content-between"},i("span",{class:"font-medium"},c.entries.Lcz_Payments," history"),i("ir-button",{id:"add-payment",variant:"icon",icon_name:"square_plus",style:{"--icon-size":"1.5rem"},onClickHandler:()=>{this.newTableRow=true}})),i("table",{class:"mt-1",style:{backgroundColor:this.paymentBackground}},i("thead",null,i("tr",null,i("th",{class:"border border-light border-bottom-0 text-center payment_date"},c.entries.Lcz_Dates),i("th",{class:"border border-light border-bottom-0 text-center w-60"},c.entries.Lcz_Amount),i("th",{class:"border border-light border-bottom-0 text-center designation"},c.entries.Lcz_Designation),i("th",{class:"border border-light border-bottom-0 text-center action_icons"},i("span",{class:"sr-only"},"payment actions")))),i("tbody",null,(t=this.bookingDetails.financial.payments)===null||t===void 0?void 0:t.map((e=>this._renderTableRow(e))),this.newTableRow?this._renderTableRow(null,"add"):null))))),i("ir-modal",{item:this.toBeDeletedItem,class:"delete-record-modal",modalTitle:c.entries.Lcz_Confirmation,modalBody:this.modal_mode==="delete"?c.entries.Lcz_IfDeletedPermantlyLost:c.entries.Lcz_EnteringAmountGreaterThanDue,iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:c.entries.Lcz_Cancel,rightBtnText:this.modal_mode==="delete"?c.entries.Lcz_Delete:c.entries.Lcz_Confirm,leftBtnColor:"secondary",rightBtnColor:this.modal_mode==="delete"?"danger":"primary",onConfirmModal:this.handleConfirmModal.bind(this),onCancelModal:this.handleCancelModal.bind(this)})]}static get watchers(){return{bookingDetails:["handleBookingDetails"]}}};ne.style=ae;class oe{async savePickup(e,t,i){try{const s=e.arrival_time.split(":");await o.post(`/Do_Pickup`,{booking_nbr:t,is_remove:i,currency:e.currency,date:e.arrival_date,details:e.flight_details,hour:s[0],minute:s[1],nbr_of_units:e.number_of_vehicles,selected_option:e.selected_option,total:+e.due_upon_booking})}catch(e){console.log(e)}}transformDefaultPickupData(e){const t=e.hour&&e.minute?x(e.hour)+":"+x(e.minute):"";return{arrival_date:e.date,arrival_time:t,currency:e.currency,due_upon_booking:e.total.toFixed(2),flight_details:e.details,location:e.selected_option.location.id,number_of_vehicles:e.nbr_of_units,selected_option:e.selected_option,vehicle_type_code:e.selected_option.vehicle.code}}getAvailableLocations(e){let t=[];p.pickup_service.allowed_options.forEach((i=>{if(t.filter((e=>e.value===i.location.id)).length===0){t.push({text:e+" "+i.location.description,value:i.location.id})}}));return t}validateForm(e){if(e.arrival_time.split(":").length!==2){return{error:true,cause:"arrival_time"}}if(e.flight_details===""){return{error:true,cause:"flight_details"}}if(e.vehicle_type_code===""){return{error:true,cause:"vehicle_type_code"}}if(e.number_of_vehicles===0){return{error:true,cause:"number_of_vehicles"}}return{error:false}}getNumberOfVehicles(e,t){let i=Math.ceil(t/e);let s=i>1?i:1;let a=i>1?2:3;return Array.from({length:i+a},((e,t)=>s+t))}getPickUpPersonStatus(e){const t=p.pickup_service.allowed_pricing_models.find((t=>t.code===e));if(!t){return null}return t.description}updateDue(e){const t=this.getPickUpPersonStatus(e.code);if(!t){return}if(t==="Person"){return e.amount*e.numberOfPersons}else{return e.amount*e.number_of_vehicles}}}const re=".sc-ir-pickup-h{display:block}.custom-card-container.sc-ir-pickup{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e4e5ec}.card-title.sc-ir-pickup{flex:1}.border-theme.sc-ir-pickup{border:1px solid #cacfe7}";const le=re;const ce=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.numberOfPersons=0;this.isLoading=false;this.allowedOptionsByLocation=[];this.pickupData={location:-1,flight_details:"",due_upon_booking:"",number_of_vehicles:1,vehicle_type_code:"",currency:undefined,arrival_time:"",arrival_date:_().format("YYYY-MM-DD"),selected_option:undefined};this.vehicleCapacity=[];this.cause=null;this.pickupService=new oe}componentWillLoad(){if(this.defaultPickupData){const e=this.pickupService.transformDefaultPickupData(this.defaultPickupData);this.vehicleCapacity=this.pickupService.getNumberOfVehicles(e.selected_option.vehicle.capacity,this.numberOfPersons);this.allowedOptionsByLocation=p.pickup_service.allowed_options.filter((t=>t.location.id===e.location));this.pickupData=Object.assign({},e)}}handleLocationChange(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;if(t===""){this.updatePickupData("location",-1)}if(t!==""){this.allowedOptionsByLocation=p.pickup_service.allowed_options.filter((e=>e.location.id.toString()===t));let e=this.allowedOptionsByLocation[0];if(!e){return}this.vehicleCapacity=this.pickupService.getNumberOfVehicles(e.vehicle.capacity,this.numberOfPersons);this.pickupData=Object.assign(Object.assign({},this.pickupData),{location:t,selected_option:e,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:e.amount,code:e.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:e.vehicle.code,currency:e.currency});const i=this.el.querySelector("#pickup-time");if(!i){setTimeout((()=>{this.initializeInputMask()}),100)}}}initializeInputMask(){const e=this.el.querySelector("#pickup-time");if(e){Inputmask("Hh:Mm",{placeholder:"HH:mm",definitions:{H:{validator:"[0-2]"},h:{validator:function(e,t,i){var s=t.buffer[i-1];if(s==="2"){return/[0-3]/.test(e)}else{return/[0-9]/.test(e)}}},M:{validator:"[0-5]"},m:{validator:"[0-9]"}},insertMode:true,showMaskOnHover:false,inputmode:"numeric",alias:"datetime",oncomplete:()=>{this.updatePickupData("arrival_time",e.value)},oncleared:()=>{this.updatePickupData("arrival_time","")},onincomplete:()=>{this.updatePickupData("arrival_time",e.value)}}).mask(e)}}handleVehicleQuantityChange(e){if(e.detail===""){return}const t=+e.detail;this.pickupData=Object.assign(Object.assign({},this.pickupData),{number_of_vehicles:t,due_upon_booking:this.pickupService.updateDue({amount:this.pickupData.selected_option.amount,code:this.pickupData.selected_option.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:t}).toFixed(2)})}componentDidLoad(){if(this.defaultPickupData){this.initializeInputMask()}}handleVehicleTypeChange(e){if(e.detail===""){this.pickupData=Object.assign(Object.assign({},this.pickupData),{due_upon_booking:"",vehicle_type_code:""});return}let t=p.pickup_service.allowed_options.find((t=>t.location.id===+this.pickupData.location&&t.vehicle.code===e.detail));if(!t){return}this.vehicleCapacity=[...this.pickupService.getNumberOfVehicles(t.vehicle.capacity,this.numberOfPersons)];this.pickupData=Object.assign(Object.assign({},this.pickupData),{selected_option:t,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:t.amount,code:t.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:t.vehicle.code})}updatePickupData(e,t){this.pickupData=Object.assign(Object.assign({},this.pickupData),{[e]:t})}async savePickup(){try{this.isLoading=true;const e=this.pickupService.validateForm(this.pickupData);if(e.error){this.cause=e.cause;return}if(this.cause){this.cause=null}await this.pickupService.savePickup(this.pickupData,this.bookingNumber,this.defaultPickupData!==null&&this.pickupData.location===-1);this.resetBookingEvt.emit(null);this.closeModal.emit(null)}catch(e){console.error(e)}finally{this.isLoading=false}}render(){var e;return i(n,{key:"9e3e6da12c06e1966e010dc4a633f1cdf322592e",class:"p-0"},i("ir-title",{key:"2700326406259f021d7782245cbed1053ac38700",class:"px-1",onCloseSideBar:()=>this.closeModal.emit(null),label:c.entries.Lcz_Pickup,displayContext:"sidebar"}),i("section",{key:"94124c9411bb01ecac51d0201b5b8823962b86b2",class:"px-1"},i("ir-select",{key:"240bf69889cbf2e00f72fec12e3b0883edb7a24d",selectedValue:this.pickupData.location,selectContainerStyle:"mb-1",onSelectChange:this.handleLocationChange.bind(this),firstOption:c.entries.Lcz_Pickup_NoThankYou,class:"m-0 mb-1",LabelAvailable:false,data:this.pickupService.getAvailableLocations(c.entries.Lcz_Pickup_YesFrom)}),this.pickupData.location>0&&i(s,{key:"f168179beed40fbfd9cef09f0ef7ca92247aa431"},i("div",{key:"dde20c5e5e35c3ac2056ab2d67a6b5ec20f1fa7f",class:"d-flex"},i("div",{key:"93dd3f3c1122c8b7f59dcdf7f3d73f57bc977b94",class:"form-group  mr-1"},i("div",{key:"31f3b423def932e07ac2faea065671ab82dcb39e",class:"input-group row m-0"},i("div",{key:"74324aae40ee244654322bb4ce29e2ef13a70931",class:`input-group-prepend col-5 p-0 text-dark border-0`},i("label",{key:"18f918c7717bd7e3d0537b4b70ee8c42dc8fcffe",class:`input-group-text  flex-grow-1 text-dark border-theme `},c.entries.Lcz_ArrivalDate)),i("div",{key:"d89befaadc73824fafff887f793373326030121a",class:"form-control form-control-md col-7 d-flex align-items-center pl-0"},i("ir-date-picker",{key:"d741dcef1d3072974d1baff8619bd00ff434a8e0",date:this.pickupData.arrival_date,maxDate:(e=this.bookingDates)===null||e===void 0?void 0:e.to,minDate:this.bookingDates.from,onDateChanged:e=>{var t;this.updatePickupData("arrival_date",(t=e.detail.start)===null||t===void 0?void 0:t.format("YYYY-MM-DD"))}},i("input",{key:"88a022ac0241d2a0d160a3cb236a95e92031814c",type:"text",slot:"trigger",value:_(this.pickupData.arrival_date).format("MMM DD, YYYY"),class:"form-control input-sm text-center",style:{borderLeftWidth:"0",borderRightWidth:"0",width:"100%"}}))))),i("div",{key:"683e13c7b369a84cac1badb29a5e8bac6082b048",class:"form-group"},i("div",{key:"50a2c5468912abed7888e7a4875f05b48e343275",class:"input-group  row m-0"},i("div",{key:"8a94c203634f5861387a525beb0e55c9d18b3ffc",class:`input-group-prepend col-4 col-sm-3 p-0 text-dark border-0`},i("label",{key:"f2cc0e59a5425001832d2e4bd62adb2fffb9436d",htmlFor:"pickup",class:`input-group-text flex-grow-1 text-dark border-theme`},c.entries.Lcz_Time)),i("input",{key:"cf81d3de37630f63c3a05ca6a90ea75967db513c",type:"text",value:this.pickupData.arrival_time,id:"pickup-time",class:`form-control col-8 col-sm-4 ${this.cause==="arrival_time"&&"border-danger"}`})))),i("ir-input-text",{key:"67f18e61341e3a3c76620cffda7cb55985c213a5",value:this.pickupData.flight_details,label:c.entries.Lcz_FlightDetails,onTextChange:e=>this.updatePickupData("flight_details",e.detail),placeholder:"",inputStyles:this.cause==="flight_details"?"border-danger":""}),i("ir-select",{key:"cc2a4efa8ae0e9b95e467226faaf2690b53c3fb2",selectContainerStyle:"mb-1",selectStyles:this.cause==="vehicle_type_code"?"border-danger":"",onSelectChange:this.handleVehicleTypeChange.bind(this),firstOption:c.entries.Lcz_Select,selectedValue:this.pickupData.vehicle_type_code,class:"m-0",LabelAvailable:false,data:this.allowedOptionsByLocation.map((e=>({text:e.vehicle.description,value:e.vehicle.code})))}),i("div",{key:"8168bfa5aacf57e43ba132b563bf9bd661be3713",class:"d-flex flex-column flex-md-row"},i("ir-select",{key:"a9ae5215a6891f007474c403260476e4d7b12246",labelBorder:"theme",selectContainerStyle:"mb-1",onSelectChange:this.handleVehicleQuantityChange.bind(this),selectStyles:this.cause==="number_of_vehicles"?"border-danger":"",selectedValue:this.pickupData.number_of_vehicles,labelWidth:7,class:"m-0  mb-md-0 mr-md-1 flex-fill",label:c.entries.Lcz_NbrOfVehicles,data:this.vehicleCapacity.map((e=>({text:e,value:e})))}),i("ir-input-text",{key:"8512c53fc5298b0d878605d5f35f37bdae64cd30",labelBorder:"theme",readonly:true,value:this.pickupData.due_upon_booking,labelWidth:7,label:`${c.entries.Lcz_DueUponBooking}  ${this.pickupData.currency.symbol}`,placeholder:"",class:""}))),i("div",{key:"916603ad607b1210e0696a6bf024a481aae85ab6",class:"d-flex flex-column flex-sm-row mt-3"},i("ir-button",{key:"e7560c2b778d3b41ce87465bf5ecc18a940c6972",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-sm-0 flex-fill  ${this.defaultPickupData||this.pickupData.location!==-1?"mr-sm-1":""}`,icon:"",text:c.entries.Lcz_Cancel,btn_color:"secondary"}),(this.defaultPickupData||this.pickupData.location!==-1)&&i("ir-button",{key:"b40c9480f3b215363bfe978247a5a799316dfdf8",btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center",icon:"",isLoading:this.isLoading,text:c.entries.Lcz_Save,btn_color:"primary",onClick:this.savePickup.bind(this)}))))}get el(){return a(this)}};ce.style=le;const de=".sc-ir-pickup-view-h{display:block}";const he=de;const be=class{constructor(t){e(this,t)}render(){if(!p.pickup_service.is_enabled||!this.booking.is_editable){return null}return i(n,null,i("div",{class:"mb-1"},i("div",{class:"d-flex w-100 mb-1 align-items-center justify-content-between"},i("p",{class:"font-size-large p-0 m-0 "},c.entries.Lcz_Pickup),i("ir-button",{id:"pickup",variant:"icon",icon_name:"edit",style:Object.assign(Object.assign({},u.secondary),{"--icon-size":"1.5rem"})})),this.booking.pickup_info&&i("div",{class:"card"},i("div",{class:"p-1"},i("div",{class:"d-flex align-items-center py-0 my-0 pickup-margin"},i("p",{class:"font-weight-bold mr-1 py-0 my-0"},c.entries.Lcz_Date,": ",i("span",{class:"font-weight-normal"},_(this.booking.pickup_info.date,"YYYY-MM-DD").format("MMM DD, YYYY"))),this.booking.pickup_info.hour&&this.booking.pickup_info.minute&&i("p",{class:"font-weight-bold flex-fill py-0 my-0"},c.entries.Lcz_Time,":",i("span",{class:"font-weight-normal"}," ",C(this.booking.pickup_info.hour.toString(),this.booking.pickup_info.minute.toString()))),i("p",{class:"font-weight-bold py-0 my-0"},c.entries.Lcz_DueUponBooking,":"," ",i("span",{class:"font-weight-normal"},this.booking.pickup_info.currency.symbol,this.booking.pickup_info.total))),i("p",{class:"font-weight-bold py-0 my-0"},c.entries.Lcz_FlightDetails,":",i("span",{class:"font-weight-normal"}," ",`${this.booking.pickup_info.details}`)),i("p",{class:"py-0 my-0 pickup-margin"},`${this.booking.pickup_info.selected_option.vehicle.description}`),i("p",{class:"font-weight-bold py-0 my-0 pickup-margin"},c.entries.Lcz_NbrOfVehicles,":",i("span",{class:"font-weight-normal"}," ",`${this.booking.pickup_info.nbr_of_units}`)),i("p",{class:"small py-0 my-0 pickup-margin"},p.pickup_service.pickup_instruction.description,p.pickup_service.pickup_cancelation_prepayment.description)))))}};be.style=he;const fe=".sc-ir-pms-logs-h{display:block}.dialog-container-height.sc-ir-pms-logs{height:4rem}.list-title.sc-ir-pms-logs{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-pms-logs{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-pms-logs{color:#629a4c;font-weight:600}.list-item.red.sc-ir-pms-logs{color:#ff4961;font-weight:600}";const ue=fe;const pe=class{constructor(t){e(this,t);this.bookingService=new r}componentWillLoad(){this.init()}async init(){try{this.pmsLogs=await this.bookingService.fetchPMSLogs(this.bookingNumber)}catch(e){console.error(e)}}render(){var e,t,s,a,n,o,r,l;return i("div",{key:"4a65e966a326572187c60ad727a230447bb09496",class:"p-1"},i("h3",{key:"32d9bb6a4bf585fa69df08ac6f20df2f127a0e73",class:" text-left mb-1 dialog-title "},c.entries.Lcz_PMS_Logs),g("/Get_Exposed_PMS_Logs")?i("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},i("ir-spinner",null)):i("div",{class:"dialog-container-height"},i("div",{class:"d-flex align-items-center ",style:{paddingBottom:"0.5rem"}},i("p",{class:"list-title p-0 m-0"},c.entries.Lcz_SentAt),((e=this.pmsLogs)===null||e===void 0?void 0:e.sent_date)?i("p",{class:"list-item"},(t=this.pmsLogs)===null||t===void 0?void 0:t.sent_date," ",C((s=this.pmsLogs)===null||s===void 0?void 0:s.sent_hour.toString(),(a=this.pmsLogs)===null||a===void 0?void 0:a.sent_minute.toString())):i("p",{class:`list-item ${((n=this.pmsLogs)===null||n===void 0?void 0:n.sent_date)?"green":"red"}`},((o=this.pmsLogs)===null||o===void 0?void 0:o.is_acknowledged)?c.entries.Lcz_YES:c.entries.Lcz_NO)),i("div",{class:"d-flex align-items-center p-0 m-0"},i("h4",{class:"list-title p-0 m-0"},c.entries.Lcz_Acknowledged),i("p",{class:`list-item  ${((r=this.pmsLogs)===null||r===void 0?void 0:r.is_acknowledged)?"green":"red"}`},((l=this.pmsLogs)===null||l===void 0?void 0:l.is_acknowledged)?c.entries.Lcz_YES:c.entries.Lcz_NO))))}};pe.style=ue;const me=".sc-ir-reservation-information-h{display:block}";const ge=me;const ve=class{constructor(i){e(this,i);this.openSidebar=t(this,"openSidebar",7);this.userCountry=null}componentWillLoad(){var e,t,i;const s=(t=(e=this.booking)===null||e===void 0?void 0:e.guest)===null||t===void 0?void 0:t.country_id;this.userCountry=s?((i=this.countries)===null||i===void 0?void 0:i.find((e=>e.id===s)))||null:null}handleEditClick(e,t){e.stopImmediatePropagation();e.stopPropagation();this.openSidebar.emit({type:t})}renderPhoneNumber(){const{mobile_without_prefix:e,country_phone_prefix:t,country_id:i}=this.booking.guest;if(!e){return null}if(t){return t+" "+e}if(i){const t=this.countries.find((e=>e.id===i));if(!t){throw new Error("Invalid country id")}return t.phone_prefix+" "+e}return e}render(){var e,t,s,a,n,o;const r=b(this.booking.extras);return i("div",{key:"2f6bf02f5475cb466aecc4a9d5750796e59e6088",class:"card"},i("div",{key:"995a29822bda2785558be2ae407a781250000d6c",class:"p-1"},i("p",{key:"0342a367523733d7d38418b27938edb20506205c"},this.booking.property.name||""),i("ir-label",{key:"5fc68e55e785ebfdf062cdd6d850b88544070a9e",labelText:`${c.entries.Lcz_Source}:`,content:this.booking.origin.Label,image:{src:this.booking.origin.Icon,alt:this.booking.origin.Label}}),i("ir-label",{key:"33662fe38e6079d50b2db0ec223840acdc67c75f",renderContentAsHtml:true,labelText:`${c.entries.Lcz_BookedOn}:`,content:`${w(this.booking.booked_on.date)}&nbsp&nbsp&nbsp&nbsp${C(this.booking.booked_on.hour.toString(),this.booking.booked_on.minute.toString())}`}),i("ir-label",{key:"fb13c251047d55709721255e517d92f492f2e8ef",labelText:`${c.entries.Lcz_BookedBy}:`,content:`${this.booking.guest.first_name} ${this.booking.guest.last_name}`},((e=this.booking.guest)===null||e===void 0?void 0:e.nbr_confirmed_bookings)>1&&!this.booking.agent&&i("div",{key:"6a302c0ba0ec5e526581fd8f94565b182ec7e062",class:"m-0 p-0",slot:"prefix"},i("ir-tooltip",{key:"33b5eb97e43fd94ae2c267b11617a7fbec007f5f",message:`${c.entries.Lcz_BookingsNbr}`.replace("%1",this.booking.guest.nbr_confirmed_bookings.toString()),customSlot:true},i("div",{key:"35def4f2da082ebce1f50a8b49ca95a80effb753",class:"d-flex align-items-center m-0 p-0",slot:"tooltip-trigger",style:{gap:"0.25rem"}},i("p",{key:"2ff2744ba290d1b812baa4197fa362b58a59df64",class:"p-0 m-0",style:{color:"#FB0AAD"}},this.booking.guest.nbr_confirmed_bookings),i("ir-icons",{key:"07d6731fc4fad5625880e5d348d632e20e3ad36d",style:{"--icon-size":"1rem"},color:"#FB0AAD",name:"heart-fill"})))),i("ir-button",{key:"040c1b6aec23908317cea90842cfb00bb4e653c1",slot:"suffix",variant:"icon",icon_name:"edit",style:Object.assign(Object.assign({},u.secondary),{"--icon-size":"1.1rem"}),onClickHandler:e=>this.handleEditClick(e,"guest")})),this.booking.guest.mobile&&i("ir-label",{key:"65e5222d00f1e6d0f3d6bf3db6c06f36bdb542f1",labelText:`${c.entries.Lcz_Phone}:`,content:this.renderPhoneNumber()}),!this.booking.agent&&i("ir-label",{key:"5189f4f8ddac0679d71a42e723307cfa2cf487fe",labelText:`${c.entries.Lcz_Email}:`,content:this.booking.guest.email}),this.booking.guest.alternative_email&&i("ir-label",{key:"0fed3d1494a9ff601747689e034ca0b591b12bde",labelText:`${c.entries.Lcz_AlternativeEmail}:`,content:this.booking.guest.alternative_email}),((s=(t=this.booking)===null||t===void 0?void 0:t.guest)===null||s===void 0?void 0:s.address)&&i("ir-label",{key:"38f3dec165ab096e1f380b9d09cdf959b6c64e47",labelText:`${c.entries.Lcz_Address}:`,content:this.booking.guest.address}),this.userCountry&&i("ir-label",{key:"4bd7b0a3763f3731e9bc30dd13dc2663882bb50e",labelText:`${c.entries.Lcz_Country}:`,isCountryImage:true,content:this.userCountry.name,image:{src:this.userCountry.flag,alt:this.userCountry.name}}),((a=this.booking.guest)===null||a===void 0?void 0:a.notes)&&i("ir-label",{key:"fa28e0903feea030e4a471f5e6cda5ce0a680d09",display:"inline",labelText:`${c.entries.Lcz_GuestPrivateNote}:`,content:(n=this.booking.guest)===null||n===void 0?void 0:n.notes}),this.booking.is_direct&&i("ir-label",{key:"d1645fd019c32d16b43c41a792085240905d2735",labelText:`${c.entries.Lcz_ArrivalTime}:`,content:this.booking.arrival.description}),this.booking.promo_key&&i("ir-label",{key:"d02b9e2170cc76500ff7dacc1c934531ae969350",labelText:`${c.entries.Lcz_Coupon}:`,content:this.booking.promo_key}),this.booking.is_in_loyalty_mode&&!this.booking.promo_key&&i("div",{key:"e50c00dfdc114cd2f1503fe8563dad12c930b938",class:"d-flex align-items-center"},i("svg",{key:"31f2b4d11a8a4ba95e0243089b117127639a99f8",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},i("path",{key:"369f6246fc33bf1e687d6920e9cec171fbdcd13d",fill:"#fc6c85",d:"M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"})),i("p",{key:"58ab95bb613302a06ff9377456feb04974150037",class:"m-0 p-0 ml-1"},c.entries.Lcz_LoyaltyDiscountApplied)),this.booking.is_direct?i("ir-label",{labelText:`${c.entries.Lcz_GuestRemark}:`,display:"inline",content:this.booking.remark}):i("ota-label",{class:"m-0 p-0",label:`${c.entries.Lcz_ChannelNotes||"Channel notes"}:`,remarks:this.booking.ota_notes,maxVisibleItems:(o=this.booking.ota_notes)===null||o===void 0?void 0:o.length}),i("div",{key:"144b99dcbdd145aa7cef5259cf7af90ecbf7d843",class:"d-flex align-items-center justify-content-between"},i("ir-label",{key:"6cb1598395ef19ec9604ba6a76865205a93be722",labelText:`${c.entries.Lcz_BookingPrivateNote}:`,placeholder:c.entries.Lcz_VisibleToHotelOnly,content:r,display:r?"inline":"flex"}),i("ir-button",{key:"f73a0819c256f4dcae3a92531d6049147fd97f25",variant:"icon",icon_name:"edit",style:u.secondary,onClickHandler:e=>this.handleEditClick(e,"extra_note")}))))}};ve.style=ge;const ye=".light-blue-bg.sc-ir-room{background:#acecff;padding:0.1rem 0.3rem;border-radius:5px}.room_statements.sc-ir-room{display:block;width:100%}.room_statements.sc-ir-room span.sc-ir-room{display:inline;white-space:normal;line-height:1.5;word-break:break-word}.room_statements.sc-ir-room b.sc-ir-room{display:inline;margin-right:5px}.payment-container.sc-ir-room{position:absolute;right:1rem;height:fit-content}.sc-ir-room-h{position:relative}.sm-mr.sc-ir-room{margin-right:3px}.subtotal_row.sc-ir-room{padding-top:8px;font-weight:600}.room_actions_btns.sc-ir-room{gap:0.5rem}.night-cost.sc-ir-room{color:#7cbebe}.mx-0-5.sc-ir-room{margin-left:2px !important;margin-right:2px !important}.tax-width.sc-ir-room{font-size:10px}.sm-mb-1.sc-ir-room{margin-bottom:5px !important}.sm-mt-1.sc-ir-room{margin-top:5px !important}.mx-01.sc-ir-room{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}";const ke=ye;const xe=class{constructor(i){e(this,i);this.deleteFinished=t(this,"deleteFinished",7);this.pressCheckIn=t(this,"pressCheckIn",7);this.pressCheckOut=t(this,"pressCheckOut",7);this.editInitiated=t(this,"editInitiated",7);this.currency="USD";this.language="en";this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.collapsed=false;this.isLoading=false;this.isModelOpen=false}componentWillLoad(){if(this.bookingEvent){this.item=this.bookingEvent.rooms[this.bookingIndex]}}handleBookingEventChange(){this.item=this.bookingEvent.rooms[this.bookingIndex]}handleClick(e){let t=e.target;if(t.id=="checkin"){this.pressCheckIn.emit(this.item)}else if(t.id=="checkout"){this.pressCheckOut.emit(this.item)}}getDateStr(e,t="default"){return e.getDate()+" "+e.toLocaleString(t,{month:"short"})+" "+e.getFullYear()}handleEditClick(){var e,t,i,s,a,n;this.editInitiated.emit({event_type:"EDIT_BOOKING",ID:this.item["assigned_units_pool"],NAME:f(this.item.guest.first_name,this.item.guest.last_name),EMAIL:this.bookingEvent.guest.email,PHONE:this.bookingEvent.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.bookingEvent.from_date,TO_DATE:this.bookingEvent.to_date,TITLE:`${c.entries.Lcz_EditBookingFor} ${(t=(e=this.item)===null||e===void 0?void 0:e.roomtype)===null||t===void 0?void 0:t.name} ${((s=(i=this.item)===null||i===void 0?void 0:i.unit)===null||s===void 0?void 0:s.name)||""}`,defaultDateRange:{dateDifference:this.item.days.length,fromDate:new Date(this.item.from_date+"T00:00:00"),fromDateStr:this.getDateStr(new Date(this.item.from_date+"T00:00:00")),toDate:new Date(this.item.to_date+"T00:00:00"),toDateStr:this.getDateStr(new Date(this.item.to_date+"T00:00:00")),message:""},bed_preference:this.item.bed_preference,adult_child_offering:this.item.rateplan.selected_variation.adult_child_offering,ADULTS_COUNT:this.item.rateplan.selected_variation.adult_nbr,ARRIVAL:this.bookingEvent.arrival,ARRIVAL_TIME:this.bookingEvent.arrival.description,BOOKING_NUMBER:this.bookingEvent.booking_nbr,cancelation:this.item.rateplan.cancelation,channel_booking_nbr:this.bookingEvent.channel_booking_nbr,CHILDREN_COUNT:this.item.rateplan.selected_variation.child_nbr,COUNTRY:this.bookingEvent.guest.country_id,ENTRY_DATE:this.bookingEvent.from_date,FROM_DATE_STR:this.bookingEvent.format.from_date,guarantee:this.item.rateplan.guarantee,GUEST:this.bookingEvent.guest,IDENTIFIER:this.item.identifier,is_direct:this.bookingEvent.is_direct,IS_EDITABLE:this.bookingEvent.is_editable,NO_OF_DAYS:this.item.days.length,NOTES:this.bookingEvent.remark,origin:this.bookingEvent.origin,POOL:this.item["assigned_units_pool"],PR_ID:(a=this.item.unit)===null||a===void 0?void 0:a.id,RATE:this.item.total,RATE_PLAN:this.item.rateplan.name,RATE_PLAN_ID:this.item.rateplan.id,RATE_TYPE:this.item.roomtype.id,ROOMS:this.bookingEvent.rooms,SOURCE:this.bookingEvent.source,SPLIT_BOOKING:false,STATUS:"IN-HOUSE",TO_DATE_STR:this.bookingEvent.format.to_date,TOTAL_PRICE:this.bookingEvent.total,legendData:this.legendData,roomsInfo:this.roomsInfo,roomName:((n=this.item.unit)===null||n===void 0?void 0:n.name)||"",PICKUP_INFO:this.bookingEvent.pickup_info,booking:this.bookingEvent,currentRoomType:this.item})}handleDeleteClick(){this.modal.openModal()}async deleteRoom(){try{this.isLoading=true;let e=[...this.bookingEvent.rooms];e=e.filter((e=>e.identifier!==this.item.identifier));const t={assign_units:true,check_in:true,is_pms:true,is_direct:true,booking:{booking_nbr:this.bookingEvent.booking_nbr,from_date:this.bookingEvent.from_date,to_date:this.bookingEvent.to_date,remark:this.bookingEvent.remark,property:this.bookingEvent.property,source:this.bookingEvent.source,currency:this.bookingEvent.currency,arrival:this.bookingEvent.arrival,guest:this.bookingEvent.guest,rooms:e}};console.log("body:",t);const{data:i}=await o.post(`/DoReservation`,t);if(i.ExceptionMsg!==""){throw new Error(i.ExceptionMsg)}this.modal.closeModal();this.deleteFinished.emit(this.item.identifier)}catch(e){}finally{this.isLoading=false}}formatVariation({adult_nbr:e,child_nbr:t},{infant_nbr:i}){const s=t;const a=e>1?c.entries.Lcz_Adults.toLowerCase():c.entries.Lcz_Adult.toLowerCase();const n=s>1?c.entries.Lcz_Children.toLowerCase():c.entries.Lcz_Child.toLowerCase();const o=i>1?c.entries.Lcz_Infants.toLowerCase():c.entries.Lcz_Infant.toLowerCase();const r=[`${e} ${a}`,s?`${s} ${n}`:"",i?`${i} ${o}`:""];return r.filter(Boolean).join("&nbsp&nbsp&nbsp&nbsp")}getSmokingLabel(){var e,t,i;if(this.bookingEvent.is_direct){if(!this.item.smoking_option){return null}const i=p.roomsInfo.find((e=>e.id===this.item.roomtype.id));if(i){const s=(e=i["smoking_option"])===null||e===void 0?void 0:e.allowed_smoking_options;if(s){return(t=s.find((e=>e.code===this.item.smoking_option)))===null||t===void 0?void 0:t.description}return null}return null}return(i=this.item.ota_meta)===null||i===void 0?void 0:i.smoking_preferences}getBedName(){var e,t;if(this.bookingEvent.is_direct){const t=this.bedPreferences.find((e=>{var t,i;return e.CODE_NAME===((i=(t=this.item)===null||t===void 0?void 0:t.bed_preference)===null||i===void 0?void 0:i.toString())}));if(!t){return}return(e=t[`CODE_VALUE_${this.language}`])!==null&&e!==void 0?e:t.CODE_VALUE_EN}return(t=this.item.ota_meta)===null||t===void 0?void 0:t.bed_preferences}render(){var e,t;const a=this.getBedName();return i(n,{key:"9e1c03b6f21a2a8dd06b14860b6450b7d1206cd6",class:"p-1 d-flex m-0"},i("ir-button",{key:"7699abbb40e9b07b0e5c03564ed447122501460a",variant:"icon",id:"drawer-icon","data-toggle":"collapse","data-target":`#roomCollapse-${(e=this.item.identifier)===null||e===void 0?void 0:e.split(" ").join("")}`,"aria-expanded":this.collapsed?"true":"false","aria-controls":"myCollapse",class:"mr-1",icon_name:this.collapsed?"closed_eye":"open_eye",onClickHandler:()=>{this.collapsed=!this.collapsed},style:{"--icon-size":"1.6rem"}}),i("div",{key:"e40c4e44f37f73b4a7ea504ece2cc3dafecc58af",class:"flex-fill m-0 "},i("div",{key:"8582a98fcba5925bd55b0f4332e5017114016668",class:"d-flex align-items-start justify-content-between sm-mb-1"},i("p",{key:"75a8953c1ee6db11457c53e8b7db41a8d9b994d3",class:"m-0 p-0"},i("span",{key:"e388b8c1f73e338dd73b3a5ec372660d8f51068a",class:"m-0 p-0",style:{fontWeight:"600"}},this.myRoomTypeFoodCat||""," ")," ",this.mealCodeName," ",this.item.rateplan.is_non_refundable&&` - ${c.entries.Lcz_NonRefundable}`," "),i("div",{key:"b0c42f769e018839eadcb8f818ba83ac34b435bd",class:"d-flex m-0 p-0 align-items-center room_actions_btns"},i("span",{key:"09f033d5e4ffbb2c70ca9aee89dfbbb1c4f88886",class:"p-0 m-0 font-weight-bold"},v(this.currency,this.item["gross_total"])),this.hasRoomEdit&&this.isEditable&&i("ir-button",{key:"959770da0d89ddba4fc7b08e2262071c20b71ab8",id:`roomEdit-${this.item.identifier}`,variant:"icon",icon_name:"edit",style:u.secondary,onClickHandler:this.handleEditClick.bind(this)}),this.hasRoomDelete&&this.isEditable&&i("ir-button",{key:"f1b12b9f04fd9f2816869b8dde479a8fabf9a197",variant:"icon",onClickHandler:this.handleDeleteClick.bind(this),id:`roomDelete-${this.item.identifier}`,icon_name:"trash",style:u.danger}))),i("div",{key:"40718312e87368a4bc99f6577d6a9280b3097eb7",class:"d-flex align-items-center sm-mb-1"},i("ir-date-view",{key:"739435bd95ca5591e20b6c744c9b0f4891a523b7",class:"mr-1",from_date:this.item.from_date,to_date:this.item.to_date,showDateDifference:false}),this.hasCheckIn&&i("ir-button",{key:"a534afbbeedac11eb519f5f7f9fdc626d3aff627",id:"checkin",icon:"",class:"mr-1",btn_color:"info",size:"sm",text:"Check in"}),this.hasCheckOut&&i("ir-button",{key:"70efc3c0f4890031532c2cd477ef475fc4089ea7",id:"checkout",icon:"",btn_color:"info",size:"sm",text:"Check out"})),!m(this.item.roomtype.id)&&p.is_frontdesk_enabled&&this.item.unit&&i("div",{key:"0c72c0d3184438bdc5211ad53779d5cedf08d144",class:"d-flex justify-content-end"},i("span",{key:"2dcf8e30ce3492e484b5d6b5dfffcb62e9f7e597",class:`light-blue-bg ${this.hasCheckIn||this.hasCheckOut?"mr-2":""} `},this.item.unit.name)),i("div",{key:"4e3bc82ff5026dc63377512fc391e35d603b617a"},i("span",{key:"32e309f37f85add3a336425f82c6f3fe1f0c28a3",class:"mr-1"},`${this.item.guest.first_name||""} ${this.item.guest.last_name||""}`),this.item.rateplan.selected_variation.adult_nbr>0&&i("span",{key:"8a9ef1236139bb10d13aef92e23e7954732cff23",class:"mr-1",innerHTML:this.formatVariation(this.item.rateplan.selected_variation,this.item.occupancy)}," "),a&&i("span",{key:"a7a8dd040b6e6215ff15493b8d7d9d8681dec83a"},"(Preference: ",a,")")),i("div",{key:"fdb2a115a19beae080b177af800542b22b11a0f9",class:"collapse",id:`roomCollapse-${(t=this.item.identifier)===null||t===void 0?void 0:t.split(" ").join("")}`},i("div",{key:"515d16d6a6f28f0f73daed4a97a8a9f0a0d3ee79",class:"d-flex sm-mb-1 sm-mt-1"},i("div",{key:"6d1f5c40bb10d38ad62c15d933b5d8ebb0710d79",class:" sm-padding-top"},i("p",{key:"45cd2a1a800b4441835e9ea40a6c8b2030b29fd8",class:"sm-padding-right",style:{fontWeight:"600"}},`${c.entries.Lcz_Breakdown}:`)),i("div",{key:"e51540a7c6b05a8011cb7d99a3fb793f3715ca4e",class:"flex-fill"},i("table",{key:"431e1b3f7b9c534e74cbf41713e0a7e9c59fab3e"},this.item.days.length>0&&this.item.days.map((e=>i("tr",null,i("td",{class:"pr-2 text-right"},D(e.date)),i("td",{class:"text-right"},v(this.currency,e.amount)),e.cost>0&&e.cost!==null&&i("td",{class:"pl-2 text-left night-cost"},v(this.currency,e.cost))))),i("tr",{key:"9b4a7d64dc0049f3fe9f981bec0d1b575a3135c3",class:""},i("th",{key:"a2bcbc7384ed16ba2305d4c335d9d45bdffa60b9",class:"text-right pr-2 subtotal_row"},c.entries.Lcz_SubTotal),i("th",{key:"6ade9e2d1bc67a9910fbc8d1b335925c6b56db5e",class:"text-right subtotal_row"},v(this.currency,this.item.total)),this.item.gross_cost>0&&this.item.gross_cost!==null&&i("th",{key:"1736eeed0d3e4ec52ec4cac1d607159bf47e5ceb",class:"pl-2 text-right night-cost"},v(this.currency,this.item.cost))),this.bookingEvent.is_direct?i(s,null,(()=>{const e=p.taxes.filter((e=>e.pct>0));return e.map((e=>i("tr",null,i("td",{class:"text-right pr-2"},e.is_exlusive?c.entries.Lcz_Excluding:c.entries.Lcz_Including," ",e.name," (",e.pct,"%)"),i("td",{class:"text-right"},v(this.currency,this.item.total*e.pct/100)),this.item.gross_cost>0&&this.item.gross_cost!==null&&i("td",{class:"pl-2 text-right night-cost"},v(this.currency,this.item.cost*e.pct/100)))))})()):i(s,null,(()=>{const e=this.item.ota_taxes.filter((e=>e.amount>0));return e.map((e=>i("tr",null,i("td",{class:"text-right pr-2"},e.is_exlusive?c.entries.Lcz_Excluding:c.entries.Lcz_Including," ",e.name),i("td",{class:"text-right"},e.currency.symbol,e.amount))))})())))),i("ir-label",{key:"9e705dbb0a7c1e229e5210e8cbfdbecbd50b3237",labelText:`${c.entries.Lcz_SmokingOptions}:`,display:"inline",content:this.getSmokingLabel()}),this.bookingEvent.is_direct&&i(s,{key:"501e225c69ab92206a56e68a6f9349a005131d7a"},this.item.rateplan.cancelation&&i("ir-label",{key:"cfd203d3448eda9fc3adbc9b56ab226709a11ada",labelText:`${c.entries.Lcz_Cancellation}:`,display:"inline",content:this.item.rateplan.cancelation||"",renderContentAsHtml:true}),this.item.rateplan.guarantee&&i("ir-label",{key:"14a39ce79e5825c858b6f59544069b1e8bc699ab",labelText:`${c.entries.Lcz_Guarantee}:`,display:"inline",content:this.item.rateplan.guarantee||"",renderContentAsHtml:true})),this.item.ota_meta&&i("div",{key:"1c5a0f12a3d9a797d9e9850e14063b9936874995"},i("ir-label",{key:"1d7398dc18f9c5199726239a0bfed221980ec091",labelText:`${c.entries.Lcz_MealPlan}:`,display:"inline",content:this.item.ota_meta.meal_plan}),i("ir-label",{key:"7f8f978f901b268a00fe8d46b2ce83967946d59d",labelText:`${c.entries.Lcz_Policies}:`,display:"inline",content:this.item.ota_meta.policies})))),i("ir-modal",{key:"17224fbd80ce9d20dd8e19d19126e7027fa8815c",autoClose:false,ref:e=>this.modal=e,isLoading:this.isLoading,onConfirmModal:this.deleteRoom.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:c.entries.Lcz_Cancel,rightBtnText:c.entries.Lcz_Delete,leftBtnColor:"secondary",rightBtnColor:"danger",modalTitle:c.entries.Lcz_Confirmation,modalBody:`${c.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${this.item.roomtype.name} ${this.item.unit?this.item.unit.name:""} ${c.entries.Lcz_FromThisBooking}`}))}get element(){return a(this)}static get watchers(){return{bookingEvent:["handleBookingEventChange"]}}};xe.style=ke;export{E as ir_booking_details,M as ir_booking_extra_note,L as ir_booking_header,A as ir_dialog,Y as ir_events_log,F as ir_extra_service,G as ir_extra_service_config,Q as ir_extra_services,X as ir_guest_info,ie as ir_payment_actions,ne as ir_payment_details,ce as ir_pickup,be as ir_pickup_view,pe as ir_pms_logs,ve as ir_reservation_information,xe as ir_room};
//# sourceMappingURL=p-60d5d23e.entry.js.map