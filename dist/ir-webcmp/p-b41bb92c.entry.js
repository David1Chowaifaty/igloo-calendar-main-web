import{h as e,r as t,g as i,F as s,H as n}from"./p-d239357b.js";import{R as a}from"./p-34b319c3.js";import{s as r,u as c,a as o,t as l,r as h,c as d}from"./p-92be13d3.js";import{l as p}from"./p-4e493fea.js";import{C as m}from"./p-9ab04aa7.js";import{T as g}from"./p-f8b7c0cd.js";import"./p-99cb260a.js";import"./p-c5894a47.js";import"./p-bf44a732.js";const u=t=>[{id:"edit",name:t.Lcz_Edit,icon:()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"14",viewBox:"0 0 512 512"},e("path",{d:"M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160V416c0 53 43 96 96 96H352c53 0 96-43 96-96V320c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H96z"})),action:e=>{const t=e.map.find((e=>e.type==="property"));r(e.id,e.is_active);c("hotel_id",t.channel_id);c("hotel_title",e.title);o(e.channel.id.toString());l()}},{id:"remove",name:t?.Lcz_Delete,icon:()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",height:"14",width:"12.25",viewBox:"0 0 448 512"},e("path",{d:"M135.2 17.7C140.6 6.8 151.7 0 163.8 0H284.2c12.1 0 23.2 6.8 28.6 17.7L320 32h96c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 96 0 81.7 0 64S14.3 32 32 32h96l7.2-14.3zM32 128H416V448c0 35.3-28.7 64-64 64H96c-35.3 0-64-28.7-64-64V128zm96 64c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16V432c0 8.8 7.2 16 16 16s16-7.2 16-16V208c0-8.8-7.2-16-16-16z"})),action:e=>({cause:"remove",action:async()=>{const t=new m;await t.saveConnectedChannel(e.id,true)},title:"",message:t?.Lcz_ThisActionWillDelete,main_color:"danger"})}];const f=".sc-ir-channel-h{display:block;--ir-sidebar-padding-block:0;--ir-sidebar-padding-inline:0}.dropdown-toggle.sc-ir-channel{color:var(--blue)}.dropdown-toggle.sc-ir-channel::after{content:none;display:none}.dropdown-toggle.sc-ir-channel .caret-icon.sc-ir-channel{transition:transform 0.15s ease-in-out, color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out,\n    -webkit-box-shadow 0.15s ease-in-out}.btn.sc-ir-channel:hover .caret-icon.sc-ir-channel path.sc-ir-channel{fill:#6b6f82}.show.sc-ir-channel .caret-icon.sc-ir-channel{transform:rotate(-180deg)}.dropdown-divider.sc-ir-channel{border-color:#e4e5ec}.dropdown-item.sc-ir-channel{padding:10px;display:flex;align-items:center;gap:10px;color:#6b6f82}.dropdown-item.sc-ir-channel svg.sc-ir-channel path.sc-ir-channel{fill:#6b6f82}.danger.sc-ir-channel{color:var(--red)}.danger.sc-ir-channel svg.sc-ir-channel path.sc-ir-channel{fill:var(--red)}.table.sc-ir-channel thead.sc-ir-channel tr.sc-ir-channel{height:50px !important}.table-container.sc-ir-channel{border-radius:30px}.table.sc-ir-channel thead.sc-ir-channel{background:#fafafa;border-top-width:0}.actions-theader.sc-ir-channel{width:35% !important;text-align:end}.dots.sc-ir-channel{display:flex;align-items:center;justify-content:center;margin:0 3px;padding:0}.dot.sc-ir-channel{width:8px;height:8px;margin:0px 4px;background-color:#6b6f82;border-radius:50%;animation:dotFlashing 1s infinite linear alternate}.dot.sc-ir-channel:nth-child(2){animation-delay:0.2s}.h-screen.sc-ir-channel{height:100vh !important}.dot.sc-ir-channel:nth-child(3){animation-delay:0.4s}@keyframes dotFlashing{0%{opacity:0}50%,100%{opacity:1}}@media (min-width: 1024px){.sc-ir-channel-h{--sidebar-width:820px}}";const w=f;const b=class{constructor(e){t(this,e)}get el(){return i(this)}ticket="";propertyid;language;baseurl;p;channel_status=null;modal_cause=null;isLoading=false;roomService=new a;channelService=new m;token=new g;irModalRef;componentWillLoad(){this.isLoading=true;if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}async handleConfirmClicked(e){e.stopImmediatePropagation();e.stopPropagation();if(!this.modal_cause){return}await this.modal_cause.action();if(this.modal_cause.cause==="remove"){h();await this.refreshChannels()}this.modal_cause=null}openModal(){this.irModalRef.openModal()}async refreshChannels(){await Promise.all([this.channelService.getExposedChannels(),this.channelService.getExposedConnectedChannels(this.propertyid)])}async initializeApp(){if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}try{let e=this.propertyid;if(!e){const t=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true});e=t.My_Result.id}const t=[this.channelService.getExposedChannels(),this.channelService.getExposedConnectedChannels(e),this.roomService.fetchLanguage(this.language,["_CHANNEL_FRONT"])];if(this.propertyid){t.unshift(this.roomService.getExposedProperty({id:this.propertyid,language:this.language,is_backend:true}))}const i=await Promise.all(t);const s=i[i.length-1];d.property_id=this.propertyid;if(!p.entries){p.entries=s.entries;p.direction=s.direction}}catch(e){console.error(e)}finally{this.isLoading=false}}ticketChanged(e,t){if(e===t){return}this.token.setToken(this.ticket);this.initializeApp()}handleCancelModal(e){e.stopImmediatePropagation();e.stopPropagation();this.modal_cause=null}handleSidebarClose(e){e.stopImmediatePropagation();e.stopPropagation();if(d.selectedChannel){this.modal_cause={action:()=>new Promise((e=>{this.resetSideBar();e("")})),cause:"channel",main_color:"primary",message:p.entries?.Lcz_UnSavedChangesWillBeLost,title:""};this.openModal()}else{this.resetSideBar()}}resetSideBar(){this.channel_status=null;h()}async handleSaveChange(e){e.stopImmediatePropagation();e.stopPropagation();await this.refreshChannels();this.resetSideBar()}async handleCheckChange(e,t){const i=t.map.find((e=>e.type==="property"));r(t.id,e);c("hotel_id",i.channel_id);c("hotel_title",t.title);o(t.channel.id.toString());l();await this.channelService.saveConnectedChannel(null,false);h();this.refreshChannels()}render(){if(this.isLoading){return e("div",{class:"h-screen bg-white d-flex flex-column align-items-center justify-content-center"},e("ir-loading-screen",null))}return e(n,{class:"h-100 "},e("ir-toast",null),e("section",{class:"p-2 px-lg-5 py-0 h-100 d-flex flex-column"},e("div",{class:"d-flex w-100 justify-content-between mb-2 align-items-center"},e("h3",{class:"font-weight-bold m-0 p-0"},p.entries?.Lcz_iSWITCH),e("ir-button",{iconPosition:"left",icon_name:"circle_plus",text:p.entries?.Lcz_CreateChannel,size:"sm",onClickHandler:()=>this.channel_status="create"})),e("div",{class:"card p-1 flex-fill m-0"},e("table",{class:"table table-striped table-bordered no-footer dataTable"},e("thead",null,e("tr",null,e("th",{scope:"col",class:"text-left"},p.entries?.Lcz_Channel),e("th",{scope:"col"},p.entries?.Lcz_Status),e("th",{scope:"col",class:"actions-theader"},p.entries?.Lcz_Actions))),e("tbody",{class:""},d.connected_channels?.map((t=>e("tr",{key:t.channel.id},e("td",{class:"text-left"},t.channel.name," ",t.title?`(${t.title})`:""),e("td",null,e("ir-switch",{checked:t.is_active,onCheckChange:e=>this.handleCheckChange(e.detail,t)})),e("th",null,e("div",{class:"d-flex justify-content-end"},e("div",{class:"btn-group"},e("button",{type:"button",class:"btn  dropdown-toggle px-0","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},e("span",{class:"mr-1"}," ",p.entries?.Lcz_Actions),e("svg",{class:"caret-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},e("path",{fill:"var(--blue)",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"}))),e("div",{class:"dropdown-menu dropdown-menu-right"},u(p.entries).map(((i,n)=>e(s,null,e("button",{onClick:()=>{if(i.id==="pull_future_reservation"||i.id==="view_logs"){return}i.action(t);if(i.id==="edit"){setTimeout((()=>{this.channel_status="edit"}),300)}else{this.modal_cause=i.action(t);this.openModal()}},key:i.id+"_item",class:`dropdown-item my-0 ${i.id==="remove"?"danger":""}`,type:"button"},i.icon(),i.name),n<u(p.entries).length-1&&e("div",{key:i.id+"_divider",class:"dropdown-divider my-0"}))))))))))))),d.connected_channels.length===0&&e("p",{class:"text-center"},p.entries?.Lcz_NoChannelsAreConnected))),e("ir-sidebar",{sidebarStyles:{padding:"0"},showCloseButton:false,onIrSidebarToggle:this.handleSidebarClose.bind(this),open:this.channel_status!==null},this.channel_status&&e("ir-channel-editor",{slot:"sidebar-body",ticket:this.ticket,channel_status:this.channel_status,onCloseSideBar:this.handleSidebarClose.bind(this)})),e("ir-modal",{modalTitle:this.modal_cause?.title,modalBody:this.modal_cause?.message,ref:e=>this.irModalRef=e,rightBtnText:p.entries?.Lcz_Confirm,leftBtnText:p.entries?.Lcz_Cancel,onCancelModal:this.handleCancelModal.bind(this),rightBtnColor:this.modal_cause?.main_color??"primary",onConfirmModal:this.handleConfirmClicked.bind(this)}))}static get watchers(){return{ticket:["ticketChanged"]}}};b.style=w;export{b as ir_channel};
//# sourceMappingURL=p-b41bb92c.entry.js.map