import{r as e,c as t,h as s}from"./p-b4b99085.js";import{l as i}from"./p-2fcb9a1f.js";import{z as a,Z as r}from"./p-7fc0c3ea.js";import{H as o}from"./p-a436c507.js";import{C as l}from"./p-28b4b2bd.js";import{U as n}from"./p-653967d3.js";import{c as d}from"./p-88b6b84d.js";import"./p-41fabaeb.js";import"./p-bf44a732.js";const h="";const c=h;const f=".sc-ir-user-form-panel-h{height:100%}.sheet-container.sc-ir-user-form-panel{display:flex !important;flex-direction:column !important;background:white;height:100% !important;gap:1rem}.sheet-footer.sc-ir-user-form-panel{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-user-form-panel{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-user-form-panel{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-user-form-panel{flex-direction:row;align-items:center}}";const u=f;const b=class{constructor(s){e(this,s);this.resetData=t(this,"resetData",7);this.closeSideBar=t(this,"closeSideBar",7);this.isEdit=false;this.language="en";this.isLoading=false;this.autoValidate=false;this.userInfo={id:-1,is_active:false,last_signed_in:"",created_at:"",mobile:"",name:"",note:"",password:"",email:"",property_id:null,username:null,phone_prefix:null};this.errors=null;this.showPasswordValidation=false;this.housekeepingService=new o;this.disableFields=false;this.mobileMask={};this.userSchema=a.object({name:a.string().min(2),mobile:a.string().min(1).max(14),email:a.string().email(),password:a.string().nullable().refine((e=>{var t;if(this.user&&!((t=this.userInfo)===null||t===void 0?void 0:t.password)){return true}return l.PASSWORD.test(e)}),{message:"Password must be at least 8 characters long."}),username:a.string().min(3).refine((async e=>{if(this.user&&this.user.username===e){return true}if(e.length>=3){return!await(new n).checkUserExistence({UserName:e})}return true}),{message:"Username already exists."})})}async componentWillLoad(){if(!this.user){this.userInfo["property_id"]=this.property_id}if(this.user){this.autoValidate=true;this.userInfo=Object.assign(Object.assign({},this.user),{password:""});this.disableFields=this.isSuperAdmin}this.mobileMask={mask:`{${d.country.phone_prefix}} 000000000000`,lazy:false,autofix:true,placeholderChar:"â€‹"}}updateUserField(e,t){this.userInfo=Object.assign(Object.assign({},this.userInfo),{[e]:t})}async addUser(){try{this.isLoading=true;if(!this.autoValidate){this.autoValidate=true}const e=Object.assign(Object.assign({},this.userInfo),{password:this.user&&this.userInfo.password===""?this.user.password:this.userInfo.password});console.log("toValidateUserInfo",e);await this.userSchema.parseAsync(e);if(this.errors){this.errors=null}await this.housekeepingService.editExposedHKM(e);this.resetData.emit(null);this.closeSideBar.emit(null)}catch(e){const t={};if(e instanceof r){e.issues.map((e=>{t[e.path[0]]=true}));this.errors=t}console.error(e)}finally{this.isLoading=false}}async handleBlur(e){e.stopImmediatePropagation();e.stopPropagation();if(this.user||!this.userInfo.name){return}const t=await this.housekeepingService.generateUserName(this.userInfo.name);this.updateUserField("username",t)}render(){var e,t,a,r,o,l;return s("form",{key:"9035d1488d4076345054c683358667c4c3150fec",class:"sheet-container",onSubmit:async e=>{e.preventDefault();await this.addUser()}},s("ir-title",{key:"f97f030c0d1d2439808e8aa44a465fff928497e3",class:"px-1 sheet-header",displayContext:"sidebar",label:this.isEdit?"Edit User":"Create New User"}),s("section",{key:"8d3e1ddb132f1fb9ab120b295f6bf1ccaa04588b",class:"px-1 sheet-body"},s("ir-input-text",{key:"86f0e394dad875e57a101b1513f16c8992fbad65",testId:"email",zod:this.userSchema.pick({email:true}),wrapKey:"email",autoValidate:this.autoValidate,error:(e=this.errors)===null||e===void 0?void 0:e.email,label:i.entries.Lcz_Email,placeholder:"",onTextChange:e=>this.updateUserField("email",e.detail),value:this.userInfo.email,onInputBlur:this.handleBlur.bind(this),maxLength:40}),s("ir-input-text",{key:"38e0384542f929d475637ba82cdbd2581d4aaba8",testId:"mobile",disabled:this.disableFields,zod:this.userSchema.pick({mobile:true}),wrapKey:"mobile",error:(t=this.errors)===null||t===void 0?void 0:t.mobile,asyncParse:true,autoValidate:this.user?((a=this.userInfo)===null||a===void 0?void 0:a.mobile)!==this.user.mobile?true:false:this.autoValidate,label:"Mobile",mask:this.mobileMask,placeholder:"",value:this.userInfo.mobile,onTextChange:e=>this.updateUserField("mobile",e.detail)}),s("div",{key:"26a146c88f773b2ad1451c487951fe82b4da37f3",class:"mb-1"},s("ir-select",{key:"caec2c5989b703c4e98a23ec90f9c15f70ac6bfa",disabled:this.disableFields,label:"Role",data:[{text:"Admin",value:"1"},{text:"Frontdesk",value:"2"}],selectedValue:this.userInfo.role,onSelectChange:e=>this.updateUserField("role",e.detail)})),s("ir-input-text",{key:"b2e3b2eec7f72d3c9180f04d9a2b8a534e334edb",testId:"name",zod:this.userSchema.pick({name:true}),wrapKey:"name",autoValidate:this.autoValidate,error:(r=this.errors)===null||r===void 0?void 0:r.name,label:"Username",disabled:this.disableFields,placeholder:"",onTextChange:e=>this.updateUserField("name",e.detail),value:this.userInfo.name,onInputBlur:this.handleBlur.bind(this),maxLength:40}),s("ir-input-text",{key:"71054de9462e4a3a8cd8c21d951bfea4efeb4fe6",testId:"password",autoValidate:this.user?!((o=this.userInfo)===null||o===void 0?void 0:o.password)?false:true:this.autoValidate,label:"Password",value:this.userInfo.password,type:"password",maxLength:16,zod:this.userSchema.pick({password:true}),wrapKey:"password",error:(l=this.errors)===null||l===void 0?void 0:l.password,onInputFocus:()=>this.showPasswordValidation=true,onInputBlur:()=>{},onTextChange:e=>this.updateUserField("password",e.detail)}),this.showPasswordValidation&&s("ir-password-validator",{key:"74a34e7a27dd99a641e58990bf1726e069a668c5",class:"mb-1",password:this.userInfo.password})),s("div",{key:"24689664b7e92565b6de6ef0478e4b7aaae3bf69",class:"sheet-footer"},s("ir-button",{key:"76a5595789a2edda90f0ef6558ff9720c5024bcd","data-testid":"cancel",onClickHandler:()=>this.closeSideBar.emit(null),class:"flex-fill",btn_styles:"w-100 justify-content-center align-items-center",btn_color:"secondary",text:i.entries.Lcz_Cancel}),s("ir-button",{key:"767e1d96c25fcfa5ecac4c5aeee4609226ab72f6","data-testid":"save",isLoading:this.isLoading,class:"flex-fill",btn_type:"submit",btn_styles:"w-100 justify-content-center align-items-center",text:i.entries.Lcz_Save})))}};b.style=c+u;export{b as ir_user_form_panel};
//# sourceMappingURL=p-c2eae516.entry.js.map