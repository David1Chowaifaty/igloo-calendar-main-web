import{T as e,a as t}from"./p-1296c4bd.js";import{d as a,b as o}from"./p-5ef8b20a.js";import{h as r}from"./p-6c4ba7c0.js";class n extends e{async getUnassignedDates(e,a,o){try{const r=this.getToken();if(r){const{data:n}=await t.post(`/Get_UnAssigned_Dates?Ticket=${r}`,{propertyid:e,from_date:a,to_date:o});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return this.convertUnassignedDates(n.My_Result)}else{throw new Error("Invalid Token")}}catch(e){console.error(e);throw new Error(e)}}async getUnassignedRooms(e,a,o,r,n){try{const s=this.getToken();if(s){const{data:i}=await t.post(`/Get_Aggregated_UnAssigned_Rooms?Ticket=${s}`,{propertyid:a,specific_date:o});if(i.ExceptionMsg!==""){throw new Error(i.ExceptionMsg)}return this.transformToAssignable(e,i,r,n)}else{throw new Error("Invalid Token")}}catch(e){console.error(e);throw new Error(e)}}async assignUnit(e,a,o){try{const r=this.getToken();if(r){const{data:n}=await t.post(`/Assign_Exposed_Room?Ticket=${r}`,{booking_nbr:e,identifier:a,pr_id:o});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}console.log(n);return n["My_Result"]}else{throw new Error("Invalid token")}}catch(e){console.error(e);throw new Error(e)}}cleanSpacesAndSpecialChars(e){const t=/[^a-zA-Z0-9]+/g;return e.replace(t,"")}transformToAssignable(e,t,a,o){const r=[];t.My_Result.forEach((t=>{t.unassigned_rooms.forEach((t=>{let n={roomTypeName:t.room_type_name,ID:t.identifier,NAME:t.guest_name,identifier:t.identifier,FROM_DATE:t.unassigned_date,TO_DATE:t.unassigned_date,BOOKING_NUMBER:t.book_nbr,STATUS:"IN-HOUSE",defaultDateRange:{fromDate:undefined,toDate:undefined,fromDateTimeStamp:0,toDateTimeStamp:0,fromDateStr:"",toDateStr:"",dateDifference:0},NO_OF_DAYS:1,roomsInfo:a,legendData:o,availableRooms:[],RT_ID:this.getRoomTypeId(t.room_type_name,a)};this.updateAvailableRooms(e,t,n,o,a);this.addDefaultDateRange(n);r.push(n)}))}));return r}addDefaultDateRange(e){e.defaultDateRange.fromDate=new Date(e.FROM_DATE+"T00:00:00");e.defaultDateRange.fromDateStr=a(e.defaultDateRange.fromDate);e.defaultDateRange.fromDateTimeStamp=e.defaultDateRange.fromDate.getTime();e.defaultDateRange.toDate=new Date(e.TO_DATE+"T00:00:00");e.defaultDateRange.toDateStr=a(e.defaultDateRange.toDate);e.defaultDateRange.toDateTimeStamp=e.defaultDateRange.toDate.getTime();e.defaultDateRange.dateDifference=e.NO_OF_DAYS}getRoomTypeId(e,t){return t.find((t=>this.cleanSpacesAndSpecialChars(t.name)===this.cleanSpacesAndSpecialChars(e))).id||null}updateAvailableRooms(e,t,a,n,s){const i=[];t.assignable_units.forEach((t=>{if(t.Is_Fully_Available&&!t.Is_Not_Available){const c=o(t.from_date,t.to_date);const d=r(new Date(e.from_date)).isAfter(r(new Date(t.from_date)))?e.from_date:t.from_date;const D=r(new Date(e.to_date)).isBefore(r(new Date(t.to_date)))&&r(new Date(e.to_date)).isAfter(r(new Date(t.from_date)))?e.to_date:t.to_date;i.push({RT_ID:a.RT_ID,STATUS:"PENDING-CONFIRMATION",FROM_DATE:d,roomName:t.name,PR_ID:t.pr_id,TO_DATE:D,NO_OF_DAYS:c,ID:"NEW_TEMP_EVENT",NAME:"",NOTES:"",BALANCE:"",INTERNAL_NOTE:"",hideBubble:true,legendData:n,roomsInfo:s});a.TO_DATE=t.to_date;a.NO_OF_DAYS=c}}));a.availableRooms=i}convertUnassignedDates(e){let t={};e.forEach((e=>{let a=new Date(e.date);a.setHours(0,0,0,0);t[a.getTime()]={categories:{},dateStr:e.description}}));return t}}export{n as T};
//# sourceMappingURL=p-292e91c3.js.map