{"version":3,"names":["irPaymentOptionCss","IrPaymentOptionStyle0","IrPaymentOption","this","paymentOptionService","PaymentOptionService","roomService","RoomService","componentWillLoad","axios","defaults","baseURL","baseurl","ticket","init","handleTokenChange","newValue","oldValue","initServices","fetchData","handleCloseModal","e","stopPropagation","stopImmediatePropagation","console","log","detail","closeModal","newOption","modifyPaymentList","is_payment_gateway","propertyOptionsById","set","id","propertyOptionsByCode","code","has","_a","payment_option_store","selectedOption","_b","Object","assign","is_active","mode","isLoading","paymentOptions","propertyOptions","languageTexts","Promise","all","GetExposedPaymentMethods","GetPropertyPaymentMethods","propertyid","fetchLanguage","language","locales","entries","direction","Map","map","o","option","get","error","token","setToken","paymentOption","p","handleCheckChange","po","property_id","HandlePaymentMethod","showEditButton","data","some","d","value","length","render","h","class","Host","name","Lcz_PaymentOptions","scope","Lcz_PaymentMethod","Lcz_Status","Lcz_Action","key","description","checked","onCheckChange","title","Lcz_Edit","variant","icon_name","onClickHanlder","onIrSidebarToggle","label","Lcz_Information","replace","open","propertyId","slot"],"sources":["src/components/ir-payment-option/ir-payment-option.css?tag=ir-payment-option&encapsulation=scoped","src/components/ir-payment-option/ir-payment-option.tsx"],"sourcesContent":["/* @import url('../../assets/reset.css'); */\r\n:host {\r\n  display: block;\r\n}\r\n.payment-table-container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.po-view {\r\n  padding: 0;\r\n  margin: 0;\r\n}\r\n.payment-img {\r\n  height: 18px;\r\n  display: none;\r\n}\r\n\r\n@media (min-width: 768px) {\r\n  .po-view {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    gap: 0.5rem;\r\n  }\r\n  .dataTable {\r\n    width: 70%;\r\n  }\r\n  .payment-img {\r\n    display: block;\r\n  }\r\n  .actions-header {\r\n    width: max-content !important;\r\n  }\r\n  .payment-table-container {\r\n    justify-content: flex-start;\r\n  }\r\n}\r\n@media (min-width: 1280px) {\r\n  .dataTable {\r\n    width: 50%;\r\n  }\r\n}\r\n","import { PaymentOption } from '@/models/payment-options';\r\nimport { PaymentOptionService } from '@/services/payment_option.service';\r\nimport { RoomService } from '@/services/room.service';\r\nimport locales from '@/stores/locales.store';\r\nimport payment_option_store from '@/stores/payment-option.store';\r\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\r\nimport axios from 'axios';\r\n\r\n@Component({\r\n  tag: 'ir-payment-option',\r\n  styleUrl: 'ir-payment-option.css',\r\n  scoped: true,\r\n})\r\nexport class IrPaymentOption {\r\n  @Prop() baseurl: string;\r\n  @Prop() propertyid: string;\r\n  @Prop() ticket: string;\r\n  @Prop() language: string = 'en';\r\n\r\n  @State() paymentOptions: PaymentOption[] = [];\r\n  @State() isLoading: boolean = false;\r\n  @State() selectedOption: PaymentOption | null = null;\r\n\r\n  private paymentOptionService = new PaymentOptionService();\r\n  private roomService = new RoomService();\r\n\r\n  private propertyOptionsById: Map<string | number, PaymentOption>;\r\n  private propertyOptionsByCode: Map<string | number, PaymentOption>;\r\n\r\n  componentWillLoad() {\r\n    axios.defaults.baseURL = this.baseurl;\r\n    if (this.ticket) {\r\n      this.init();\r\n    }\r\n  }\r\n  @Watch('ticket')\r\n  handleTokenChange(newValue: string, oldValue: string) {\r\n    if (newValue !== oldValue) {\r\n      this.init();\r\n    }\r\n  }\r\n  init() {\r\n    this.initServices();\r\n    this.fetchData();\r\n  }\r\n  @Listen('closeModal')\r\n  handleCloseModal(e: CustomEvent) {\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n    console.log(e.detail);\r\n    this.closeModal(e.detail);\r\n  }\r\n  private closeModal(newOption: PaymentOption | null) {\r\n    if (newOption) {\r\n      this.modifyPaymentList(newOption);\r\n      if (newOption.is_payment_gateway) {\r\n        this.propertyOptionsById.set(newOption.id, newOption);\r\n      } else {\r\n        this.propertyOptionsByCode.set(newOption.code, newOption);\r\n      }\r\n    } else {\r\n      if (!this.propertyOptionsByCode.has(payment_option_store.selectedOption?.code) && !this.propertyOptionsById.has(payment_option_store.selectedOption?.id)) {\r\n        this.modifyPaymentList({ ...payment_option_store.selectedOption, is_active: false });\r\n      }\r\n    }\r\n    payment_option_store.selectedOption = null;\r\n    payment_option_store.mode = null;\r\n  }\r\n  private async fetchData() {\r\n    try {\r\n      this.isLoading = true;\r\n      const [paymentOptions, propertyOptions, languageTexts] = await Promise.all([\r\n        this.paymentOptionService.GetExposedPaymentMethods(),\r\n        this.paymentOptionService.GetPropertyPaymentMethods(this.propertyid),\r\n        this.roomService.fetchLanguage(this.language, ['_PAYMENT_BACK']),\r\n      ]);\r\n      locales.entries = languageTexts.entries;\r\n      locales.direction = languageTexts.direction;\r\n      this.propertyOptionsById = new Map(propertyOptions.map(o => [o.id, o]));\r\n      this.propertyOptionsByCode = new Map(propertyOptions.map(o => [o.code, o]));\r\n      this.paymentOptions = paymentOptions?.map(option => {\r\n        if (option.is_payment_gateway) {\r\n          return this.propertyOptionsById.get(option.id) || option;\r\n        }\r\n        return this.propertyOptionsByCode.get(option.code) || option;\r\n      });\r\n    } catch (error) {\r\n      console.log(error);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  private initServices() {\r\n    payment_option_store.token = this.ticket;\r\n    this.paymentOptionService.setToken(this.ticket);\r\n    this.roomService.setToken(this.ticket);\r\n  }\r\n  private modifyPaymentList(paymentOption: PaymentOption) {\r\n    this.paymentOptions = [\r\n      ...this.paymentOptions.map(p => {\r\n        if ((paymentOption.is_payment_gateway && p.id === paymentOption.id) || (paymentOption.code === '005' && p.code === '005')) {\r\n          return paymentOption;\r\n        }\r\n        return p;\r\n      }),\r\n    ];\r\n  }\r\n  private async handleCheckChange(e: CustomEvent, po: PaymentOption) {\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n\r\n    const is_active = e.detail;\r\n    const newOption = { ...po, is_active, property_id: this.propertyid };\r\n\r\n    if (po.code !== '005' && !po.is_payment_gateway) {\r\n      await this.paymentOptionService.HandlePaymentMethod(newOption);\r\n      this.modifyPaymentList(newOption);\r\n      return;\r\n    }\r\n\r\n    if (!this.showEditButton(po)) {\r\n      this.modifyPaymentList(newOption);\r\n      return;\r\n    }\r\n    if (is_active && po.data?.some(d => d.value === null)) {\r\n      payment_option_store.mode = 'create';\r\n      payment_option_store.selectedOption = newOption;\r\n    } else {\r\n      await this.paymentOptionService.HandlePaymentMethod(newOption);\r\n    }\r\n    this.modifyPaymentList(newOption);\r\n  }\r\n  private showEditButton(po: PaymentOption) {\r\n    if (!po.is_payment_gateway && po.code !== '005') {\r\n      return false;\r\n    }\r\n\r\n    return po.code === '005' || (po.is_payment_gateway && po.data?.length > 0);\r\n  }\r\n  render() {\r\n    if (this.isLoading || this.paymentOptions.length == 0) {\r\n      return (\r\n        <div class=\"h-screen bg-white d-flex flex-column align-items-center justify-content-center\">\r\n          <ir-loading-screen></ir-loading-screen>\r\n        </div>\r\n      );\r\n    }\r\n    return (\r\n      <Host class=\"p-2\">\r\n        <ir-toast></ir-toast>\r\n        <ir-interceptor></ir-interceptor>\r\n        <div class=\"card p-1 flex-fill m-0\">\r\n          <div class=\"d-flex align-items-center mb-2\">\r\n            <div class=\"p-0 m-0 mr-1\">\r\n              <ir-icons name=\"credit_card\"></ir-icons>\r\n            </div>\r\n            <h3 class={'m-0 p-0'}>{locales.entries.Lcz_PaymentOptions}</h3>\r\n          </div>\r\n          <div class=\"payment-table-container\">\r\n            <table class=\"table table-striped table-bordered no-footer dataTable\">\r\n              <thead>\r\n                <tr>\r\n                  <th scope=\"col\" class=\"text-left\">\r\n                    {locales.entries.Lcz_PaymentMethod}\r\n                  </th>\r\n                  <th scope=\"col\">{locales.entries.Lcz_Status}</th>\r\n                  <th scope=\"col\" class=\"actions-header\">\r\n                    {locales.entries.Lcz_Action}\r\n                  </th>\r\n                </tr>\r\n              </thead>\r\n              <tbody class=\"\">\r\n                {this.paymentOptions?.map(po => {\r\n                  if (po.code === '004') {\r\n                    return null;\r\n                  }\r\n                  return (\r\n                    <tr key={po.id}>\r\n                      <td class={'text-left po-description'}>\r\n                        <div class=\"po-view\">\r\n                          <span class={'p-0 m-0'}>{po.description}</span>\r\n                          {/* <img src=\"https://www.jccsmart.com/assets/images/app-logo.svg\" alt=\"\" class=\"payment-img\" /> */}\r\n                        </div>\r\n                      </td>\r\n\r\n                      <td>\r\n                        <ir-switch checked={po.is_active} onCheckChange={e => this.handleCheckChange(e, po)}></ir-switch>\r\n                      </td>\r\n                      <td class=\"payment-action\">\r\n                        {this.showEditButton(po) && (\r\n                          <ir-button\r\n                            title={locales.entries.Lcz_Edit}\r\n                            variant=\"icon\"\r\n                            icon_name=\"edit\"\r\n                            onClickHanlder={() => {\r\n                              payment_option_store.selectedOption = po;\r\n                              payment_option_store.mode = 'edit';\r\n                            }}\r\n                          ></ir-button>\r\n                        )}\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n        <ir-sidebar\r\n          onIrSidebarToggle={() => {\r\n            this.closeModal(null);\r\n          }}\r\n          label={locales.entries.Lcz_Information.replace('%1', payment_option_store.selectedOption?.description)}\r\n          open={payment_option_store.selectedOption !== null}\r\n        >\r\n          {payment_option_store.selectedOption && <ir-option-details propertyId={this.propertyid} slot=\"sidebar-body\"></ir-option-details>}\r\n        </ir-sidebar>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}