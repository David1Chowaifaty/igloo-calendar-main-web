import{a as t}from"./p-bf44a732.js";import{z as e}from"./p-b859bcd5.js";import{e as r,g as n,b as o,h as a,i}from"./p-85bcaa72.js";import{c as s}from"./p-a973aec7.js";import{c}from"./p-00df8713.js";const l=e.object({CODE_NAME:e.string(),CODE_VALUE_AR:e.string().nullable(),CODE_VALUE_DE:e.string().nullable(),CODE_VALUE_EL:e.string().nullable(),CODE_VALUE_EN:e.string().nullable(),CODE_VALUE_FR:e.string().nullable(),CODE_VALUE_HE:e.string().nullable(),CODE_VALUE_PL:e.string().nullable(),CODE_VALUE_RU:e.string().nullable(),CODE_VALUE_UA:e.string().nullable(),DISPLAY_ORDER:e.number().nullable(),ENTRY_DATE:e.string().nullable(),ENTRY_USER_ID:e.number().nullable(),INVARIANT_VALUE:e.string().nullable(),ISDELETEABLE:e.boolean(),ISDELETED:e.boolean(),ISSYSTEM:e.boolean(),ISUPDATEABLE:e.boolean(),ISVISIBLE:e.boolean(),NOTES:e.string().nullable(),OWNER_ID:e.number().nullable(),TBL_NAME:e.string()});const u={checkout_guest:null,guest:null,tax_statement:null,roomTypes:[],enableBooking:false,resetBooking:false,ratePlanSelections:{},isInFreeCancelationZone:false,bookingAvailabilityParams:{from_date:null,to_date:null,adult_nbr:0,child_nbr:0,infant_nbr:0},booking:null,fictus_booking_nbr:null,event_type:{type:"PLUS_BOOKING"}};let{state:_,onChange:d,reset:b}=s(u);function E(){b()}function y(t,e){var r;if(!t){return null}if(!e||_.resetBooking){return t[0]}return(r=t===null||t===void 0?void 0:t.find((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr)))!==null&&r!==void 0?r:null}d("roomTypes",(t=>{const e=_.ratePlanSelections;const r={};t.forEach((t=>{if(!t.is_active)return;r[t.id]=r[t.id]||{};t.rateplans.forEach((n=>{var o,a,i,s;if(!n.is_active||!((o=n===null||n===void 0?void 0:n.variations)===null||o===void 0?void 0:o.length))return;const c=(a=e[t.id])===null||a===void 0?void 0:a[n.id];r[t.id][n.id]=c&&Object.keys(c).length>0?Object.assign(Object.assign({},c),{ratePlan:n,selected_variation:(i=y(n.variations,c.selected_variation))!==null&&i!==void 0?i:null,visibleInventory:t.inventory,reserved:t.inventory===0?0:_.resetBooking?0:c.reserved,checkoutVariations:t.inventory===0?[]:c.checkoutVariations,checkoutBedSelection:t.inventory===0?[]:c.checkoutBedSelection,checkoutSmokingSelection:t.inventory===0?[]:c.checkoutSmokingSelection,guestName:t.inventory===0?[]:c.guestName,roomtype:Object.assign({},c.roomtype)}):{reserved:0,rp_amount:0,view_mode:"001",guest:null,visibleInventory:t.inventory,selected_variation:(s=n===null||n===void 0?void 0:n.variations[0])!==null&&s!==void 0?s:null,ratePlan:n,guestName:[],is_bed_configuration_enabled:t.is_bed_configuration_enabled,roomtype:Object.assign(Object.assign({},t),{physicalrooms:null,rateplans:null,availabilities:null}),checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[]}}))}));_.ratePlanSelections=r;_.resetBooking=false}));function f(t){const e=_.ratePlanSelections[t];const r=t=>Object.entries(e).reduce(((e,[r,n])=>Number(r)!==t?e+n.reserved:e),0);const n=Object.fromEntries(Object.entries(e).map((([e,n])=>{const o=r(Number(e));const a=_.roomTypes.find((e=>e.id===t));const i=a?a.inventory-o:0;return[e,Object.assign(Object.assign({},n),{visibleInventory:i>0?i:0})]})));if(JSON.stringify(e)!==JSON.stringify(n)){_.ratePlanSelections=Object.assign(Object.assign({},_.ratePlanSelections),{[t]:n})}}function w({ratePlanId:t,roomTypeId:e,params:r}){_.ratePlanSelections=Object.assign(Object.assign({},_.ratePlanSelections),{[Number(e)]:Object.assign(Object.assign({},_.ratePlanSelections[Number(e)]),{[t]:Object.assign(Object.assign({},_.ratePlanSelections[e][t]),r)})})}function v({ratePlanId:t,roomTypeId:e,rooms:r,guest:n}){var o;if(!_.ratePlanSelections[e]){_.ratePlanSelections[e]={}}const a=(o=_.roomTypes)===null||o===void 0?void 0:o.find((t=>t.id===e));if(!a){throw new Error("Invalid room type id")}const i=a.rateplans.find((e=>e.id===t));if(!i){throw new Error("Invalid rate plan")}let s=Array.from({length:r},(()=>({first_name:"",last_name:"",unit:null,bed_preference:null,infant_nbr:null})));if(n){s=n}if(!_.ratePlanSelections[e][t]){_.ratePlanSelections[e][t]={guestName:null,reserved:0,view_mode:"001",rp_amount:0,guest:s,is_bed_configuration_enabled:a.is_bed_configuration_enabled,visibleInventory:0,selected_variation:null,ratePlan:i,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],roomtype:{id:a.id,name:a.name,physicalrooms:null,rateplans:null,availabilities:null,inventory:a.inventory,rate:a.rate,bedding_setup:a.bedding_setup,smoking_option:a.smoking_option,is_bed_configuration_enabled:a.is_bed_configuration_enabled}}}_.ratePlanSelections=Object.assign(Object.assign({},_.ratePlanSelections),{[Number(e)]:Object.assign(Object.assign({},_.ratePlanSelections[Number(e)]),{[t]:Object.assign(Object.assign({},_.ratePlanSelections[e][t]),{reserved:r,checkoutVariations:[],guest:s})})});f(e)}function h(t,e){if(!_.ratePlanSelections||!_.ratePlanSelections[t]){return{reserved:0,guest:null,visibleInventory:0,selected_variation:null,ratePlan:null,guestName:[],is_bed_configuration_enabled:false,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],rp_amount:0,view_mode:"001",roomtype:null}}return _.ratePlanSelections[t][e]}function p(t,e){_[t]=e}function m(){return Object.values(_.ratePlanSelections).reduce(((t,e)=>t+Object.values(e).reduce(((t,e)=>{if(e.reserved===0){return t}return t+e.reserved}),0)),0)}function g(){const t=Object.entries(_.ratePlanSelections).reduce(((t,[e,r])=>{const n=_.roomTypes.find((t=>t.id.toString()===e.toString()));t[e]=Object.entries(r).reduce(((t,[e,r])=>{var o;t[e]=Object.assign(Object.assign({},r),{reserved:0,visibleInventory:(o=n===null||n===void 0?void 0:n.inventory)!==null&&o!==void 0?o:r.visibleInventory});return t}),{});return t}),{});_.ratePlanSelections=Object.assign({},t)}var O=undefined&&undefined.__rest||function(t,e){var r={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0)r[n]=t[n];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++){if(e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o]))r[n[o]]=t[n[o]]}return r};function k(t){try{const{groups:r,types:n}=e.object({types:l.array().min(1),groups:l.array().min(1),methods:l.array().min(1)}).parse(t);const o=[...n];const a=t=>t.map((t=>o.find((e=>e.CODE_NAME===t)))).filter((t=>Boolean(t)));const i=t=>{const e=r.find((e=>e.CODE_NAME===t));return e?e.CODE_VALUE_EN.split(","):[]};let s={};r.forEach((t=>{s[t.CODE_NAME]=a(i(t.CODE_NAME))}));return s}catch(t){console.log(t);return{}}}class j{async unBlockUnitByPeriod(e){const{data:r}=await t.post(`/Unblock_Unit_By_Period`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async getExposedApplicablePolicies(e){var r;const{data:n}=await t.post(`/Get_Exposed_Applicable_Policies`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return(r=n.My_Result)!==null&&r!==void 0?r:[]}async handleExposedRoomInOut(e){const{data:r}=await t.post(`/Handle_Exposed_Room_InOut`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async GetPenaltyStatement(e){const{data:r}=await t.post("/Get_Penalty_Statement",e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}async setExposedRestrictionPerRoomType(e){var r;const{data:n}=await t.post(`https://gateway.igloorooms.com/IRBE/Set_Exposed_Restriction_Per_Room_Type`,Object.assign({operation_type:(r=e.operation_type)!==null&&r!==void 0?r:"close_open"},e));if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}async getLov(){const{data:e}=await t.post(`/Get_LOV`,{});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e}async sendBookingConfirmationEmail(e,r){const{data:n}=await t.post(`/Send_Booking_Confirmation_Email`,{booking_nbr:e,language:r});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}async getCalendarData(e,i,s){try{const{data:c}=await t.post(`/Get_Exposed_Calendar`,{propertyid:e,from_date:i,to_date:s,extras:r,include_sales_rate_plans:true});if(c.ExceptionMsg!==""){throw new Error(c.ExceptionMsg)}const l=c.My_Result.months;const u=[];const _=await n(l);const d=l.map((t=>{u.push({daysCount:t.days.length,monthName:t.description});return t.days.map((e=>{if(e["value"]==="2025-05-30"){console.log(e)}return{day:o(e.description,t.description),value:e.value,currentDate:a(e.description,t.description),dayDisplayName:e.description,rate:e.room_types,unassigned_units_nbr:e.unassigned_units_nbr,occupancy:e.occupancy}}))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:e,FROM:c.My_Params_Get_Exposed_Calendar.from_date,TO:c.My_Params_Get_Exposed_Calendar.to_date},days:d,months:u,myBookings:_,defaultMonths:l})}catch(t){console.error(t)}}async handleExposedRoomGuests(e){const{data:r}=await t.post("/Handle_Exposed_Room_Guests",e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async fetchGuest(e){try{const{data:r}=await t.post(`/Get_Exposed_Guest`,{email:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.log(t);throw new Error(t)}}async changeExposedBookingStatus(e){try{const{data:r}=await t.post(`/Change_Exposed_Booking_Status`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){throw new Error(t)}}async fetchPMSLogs(e){try{const{data:r}=await t.post(`/Get_Exposed_PMS_Logs`,{booking_nbr:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.log(t);throw new Error(t)}}async getExposedBookingEvents(e){try{const{data:r}=await t.post(`/Get_Exposed_Booking_Events`,{booking_nbr:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.log(t);throw new Error(t)}}async editExposedGuest(e,r){try{const{data:n}=await t.post(`/Edit_Exposed_Guest`,Object.assign(Object.assign({},e),{book_nbr:r}));if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async getBookingAvailability(e){try{const{adultChildCount:r,currency:n}=e,o=O(e,["adultChildCount","currency"]);const{data:a}=await t.post(`/Check_Availability`,Object.assign(Object.assign({},o),{adult_nbr:r.adult,child_nbr:r.child,currency_ref:n.code,skip_getting_assignable_units:!c.is_frontdesk_enabled,is_backend:true}));if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}const i=this.modifyRateplans(this.sortRoomTypes(a["My_Result"],{adult_nbr:Number(r.adult),child_nbr:Number(r.child)}));_.roomTypes=[...i];_.tax_statement={message:a.My_Result.tax_statement};return i}catch(t){console.error(t);throw new Error(t)}}sortRoomTypes(t,e){return t.sort(((t,r)=>{var n,o,a,i;if(t.is_available_to_book&&!r.is_available_to_book)return-1;if(!t.is_available_to_book&&r.is_available_to_book)return 1;const s=(n=t.rateplans)===null||n===void 0?void 0:n.some((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.some((t=>t.discounted_amount===0||t.discounted_amount===null))}));const c=(o=r.rateplans)===null||o===void 0?void 0:o.some((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.some((t=>t.discounted_amount===0||t.discounted_amount===null))}));if(s&&!c)return 1;if(!s&&c)return-1;const l=(a=t.rateplans)===null||a===void 0?void 0:a.some((t=>{var r;return(r=t.variations)===null||r===void 0?void 0:r.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))}));const u=(i=r.rateplans)===null||i===void 0?void 0:i.some((t=>{var r;return(r=t.variations)===null||r===void 0?void 0:r.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))}));if(l&&!u)return-1;if(!l&&u)return 1;const _=Math.max(...t.rateplans.flatMap((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.map((t=>{var e;return(e=t.discounted_amount)!==null&&e!==void 0?e:0}))})));const d=Math.max(...r.rateplans.flatMap((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.map((t=>{var e;return(e=t.discounted_amount)!==null&&e!==void 0?e:0}))})));if(_<d)return-1;if(_>d)return 1;return 0}))}modifyRateplans(t){return t===null||t===void 0?void 0:t.map((t=>{var e;return Object.assign(Object.assign({},t),{rateplans:(e=t.rateplans)===null||e===void 0?void 0:e.map((t=>{var e;return Object.assign(Object.assign({},t),{variations:this.sortVariations((e=t===null||t===void 0?void 0:t.variations)!==null&&e!==void 0?e:[])})}))})}))}sortVariations(t){return t.sort(((t,e)=>{if(t.adult_nbr!==e.adult_nbr){return e.adult_nbr-t.adult_nbr}return e.child_nbr-t.child_nbr}))}async getCountries(e){try{const{data:r}=await t.post(`/Get_Exposed_Countries`,{language:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.error(t);throw new Error(t)}}async getSetupEntriesByTableName(e){var r;const{data:n}=await t.post(`/Get_Setup_Entries_By_TBL_NAME`,{TBL_NAME:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}const o=(r=n.My_Result)!==null&&r!==void 0?r:[];return o}async fetchSetupEntries(){try{const t=await this.getSetupEntriesByTableNameMulti(["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]);const{arrival_time:e,rate_pricing_mode:r,bed_preference_type:n}=this.groupEntryTablesResult(t);return{arrivalTime:e,ratePricingMode:r,bedPreferenceType:n}}catch(t){console.error(t);throw new Error(t)}}async doBookingExtraService({booking_nbr:e,service:r,is_remove:n}){const{data:o}=await t.post(`/Do_Booking_Extra_Service`,Object.assign(Object.assign({},r),{booking_nbr:e,is_remove:n}));if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}groupEntryTablesResult(t){let e={};for(const r of t){const t=r.TBL_NAME.substring(1,r.TBL_NAME.length).toLowerCase();if(!e[t]){e[t]=[]}e[t]=[...e[t],r]}return e}async getSetupEntriesByTableNameMulti(e){const{data:r}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}async getBlockedInfo(){return await this.getSetupEntriesByTableNameMulti(["_CALENDAR_BLOCKED_TILL"])}async getUserDefaultCountry(){try{const{data:e}=await t.post(`/Get_Country_By_IP`,{IP:""});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async blockUnit(e){try{const{data:r}=await t.post(`/Block_Exposed_Unit`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}console.log(r);return r["My_Params_Block_Exposed_Unit"]}catch(t){console.error(t);throw new Error(t)}}async blockAvailabilityForBrackets(e){try{const{data:r}=await t.post(`/Block_Availability_For_Brackets`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}catch(t){console.error(t);throw new Error(t)}}async setDepartureTime(e){const{data:r}=await t.post("/Set_Departure_Time",e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async getUserInfo(e){try{const{data:r}=await t.post(`/GET_EXPOSED_GUEST`,{email:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.error(t);throw new Error(t)}}async getExposedBooking(e,n,o=true){try{const{data:a}=await t.post(`/Get_Exposed_Booking`,{booking_nbr:e,language:n,extras:o?r:null});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a.My_Result}catch(t){console.error(t)}}generateDays(t,e,r){const n=new Date(t);const o=new Date(e);const a=[];while(n<o){a.push({date:n.toISOString().split("T")[0],amount:r,cost:null});n.setDate(n.getDate()+1)}return a}calculateTotalRate(t,e,r,n){if(r&&n===2){return+t}return+t/+e}async fetchExposedGuest(e,r){try{const{data:n}=await t.post(`/Fetch_Exposed_Guests`,{email:e,property_id:r});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async fetchExposedBookings(e,r,n,o){try{const{data:a}=await t.post(`/Fetch_Exposed_Bookings`,{booking_nbr:e,property_id:r,from_date:n,to_date:o});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async getPCICardInfoURL(e){try{const{data:r}=await t.post(`/Get_PCI_Card_Info_URL`,{BOOK_NBR:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async doReservation(e){const{data:n}=await t.post(`/DoReservation`,Object.assign(Object.assign({},e),{extras:e.extras?e.extras:r}));if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}console.log(n["My_Result"]);return n["My_Result"]}async bookUser({bookedByInfoData:t,check_in:e,currency:r,extras:n=null,fromDate:o,guestData:a,pickup_info:s,propertyid:c,rooms:l,source:u,toDate:_,totalNights:d,arrivalTime:b,bookingNumber:E,defaultGuest:y,identifier:f,pr_id:w}){try{const v=i(o);const h=i(_);let p={email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.contactNumber===null?"":t.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:t.emailGuest||false,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null};if(y){p=Object.assign(Object.assign({},y),{email:y.email===""?null:y.email})}if(t.id){p=Object.assign(Object.assign({},p),{id:t.id})}const m={assign_units:true,check_in:e,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:n,booking:{booking_nbr:E||"",from_date:v,to_date:h,remark:t.message||null,property:{id:c},source:u,currency:r,arrival:{code:b?b:t.selectedArrivalTime},guest:p,rooms:[...a.map((t=>({identifier:f||null,roomtype:{id:t.roomCategoryId,name:t.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:t.inventory,rate:t.rate/d},rateplan:{id:t.ratePlanId,name:t.ratePlanName,rate_restrictions:null,variations:null,cancelation:t.cancelation,guarantee:t.guarantee},unit:typeof w==="undefined"&&t.roomId===""?null:{id:+w||+t.roomId},occupancy:{adult_nbr:t.adultCount,children_nbr:t.childrenCount,infant_nbr:null},bed_preference:t.preference,from_date:v,to_date:h,notes:null,days:this.generateDays(v,h,this.calculateTotalRate(t.rate,d,t.isRateModified,t.rateType)),guest:{email:null,first_name:t.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),...l]},pickup_info:s};console.log("book user payload",m)}catch(t){console.error(t);throw new Error(t)}}}export{j as B,E as a,_ as b,m as c,v as d,k as e,h as g,p as m,g as r,w as u};
//# sourceMappingURL=p-28df1c49.js.map