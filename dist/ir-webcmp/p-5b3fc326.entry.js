import{r as e,h as t,H as o}from"./p-d239357b.js";import{T as i}from"./p-f8b7c0cd.js";import{P as s}from"./p-c6c41b50.js";import"./p-bf44a732.js";import"./p-cc7e2ae6.js";import"./p-6c4ba7c0.js";import"./p-99cb260a.js";import"./p-c5894a47.js";import"./p-4e493fea.js";const r=".sc-ir-unbookable-rooms-h{height:100% !important;overflow-y:auto !important}.ir-page__container.sc-ir-unbookable-rooms{height:100%;overflow-y:auto}.unbookable-rooms__content.sc-ir-unbookable-rooms{display:flex;flex-direction:column;gap:1rem}.summary.sc-ir-unbookable-rooms{display:grid;grid-template-columns:repeat(auto-fit, minmax(150px, 1fr));gap:12px}.summary__value.sc-ir-unbookable-rooms{display:block;font-size:1.3rem;font-weight:600}.summary__label.sc-ir-unbookable-rooms{font-size:0.82rem;color:#6a6256}@media (min-width: 768px){.unbookable-rooms__content.sc-ir-unbookable-rooms{flex-direction:row;align-items:flex-start}}";const a=r;const n=class{constructor(t){e(this,t)}ticket="";propertyid;mode="default";period_to_check=2;consecutive_period=14;isLoading=false;errorMessage="";unbookableRooms=[];allowedProperties=null;filters={period_to_check:2,consecutive_period:14,country:"all"};progressFilters={period_to_check:2,consecutive_period:14};lastUpdatedLabel="";isPageLoading=true;tokenService=new i;propertyService=new s;componentWillLoad(){this.filters={country:"all",period_to_check:this.normalizePositiveNumber(this.period_to_check,2),consecutive_period:this.normalizePositiveNumber(this.consecutive_period,14)};if(this.ticket){this.tokenService.setToken(this.ticket);this.initializeApp()}}ticketChanged(e,t){if(e===t){return}this.tokenService.setToken(this.ticket);this.initializeApp()}modeChanged(e,t){if(e===t){return}this.initializeApp()}propertyIdChanged(e,t){if(e===t){return}if(this.resolveMode()==="default"){this.initializeApp()}}periodToCheckChanged(e){this.filters={...this.filters,period_to_check:this.normalizePositiveNumber(e,this.filters.period_to_check)}}consecutivePeriodChanged(e){this.filters={...this.filters,consecutive_period:this.normalizePositiveNumber(e,this.filters.consecutive_period)}}normalizePositiveNumber(e,t){const o=Number(e);if(Number.isFinite(o)&&o>0){return Math.floor(o)}return t}resolveMode(){return this.mode==="mpo"?"mpo":"default"}async initializeApp(){if(!this.ticket){return}try{this.errorMessage="";this.isLoading=true;this.unbookableRooms=[];if(this.resolveMode()==="mpo"){this.allowedProperties=await this.propertyService.getExposedAllowedProperties()}else{this.allowedProperties=null}await this.fetchUnbookableRooms()}catch(e){console.error("Failed to load unbookable rooms",e);this.errorMessage="Unable to load unbookable rooms right now. Please try again."}finally{this.isLoading=false;if(this.isPageLoading){this.isPageLoading=false}}}async fetchUnbookableRooms(){const e=this.getPropertyIds();if(!e.length){this.unbookableRooms=[];this.errorMessage=this.resolveMode()==="mpo"?"No properties available to check.":"Property ID is required to load unbookable rooms.";return}const t=await this.propertyService.fetchUnBookableRooms({property_ids:e,period_to_check:this.filters.period_to_check*30,consecutive_period:this.filters.consecutive_period});this.unbookableRooms=t??[];this.lastUpdatedLabel=(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}getPropertyIds(){if(this.resolveMode()==="mpo"){return this.allowedProperties?.map((e=>e.id))??[]}const e=Number(this.propertyid);return Number.isFinite(e)&&e>0?[e]:[]}handleFiltersChange=e=>{this.filters={...this.filters,...e.detail}};handleRefresh=async()=>{this.isLoading=true;this.errorMessage="";try{if(this.resolveMode()==="mpo"&&!this.allowedProperties){this.allowedProperties=await this.propertyService.getExposedAllowedProperties()}await this.fetchUnbookableRooms();this.progressFilters={period_to_check:this.filters.period_to_check,consecutive_period:this.filters.consecutive_period}}catch(e){console.error("Failed to refresh unbookable rooms",e);this.errorMessage="Unable to refresh unbookable rooms right now."}finally{this.isLoading=false}};handleFiltersReset=()=>{this.filters={country:"all",consecutive_period:14,period_to_check:2};this.handleRefresh()};render(){if(this.isPageLoading){return t("ir-loading-screen",null)}const e=this.unbookableRooms?.length??0;const i=new Set(this.unbookableRooms?.map((e=>e.property_id))).size;return t(o,null,t("ir-toast",null),t("ir-interceptor",null),t("section",{class:"ir-page__container"},t("h3",{class:"page-title"},"Availability Alert"),this.mode==="mpo"&&t("section",{class:"summary","aria-live":"polite"},t("wa-card",null,t("span",{class:"summary__value"},e),t("span",{class:"summary__label"},"room types affected")),t("wa-card",null,t("span",{class:"summary__value"},i),t("span",{class:"summary__label"},"properties impacted"))),t("section",{class:"unbookable-rooms__content"},t("ir-unbookable-rooms-filters",{mode:this.mode,filters:this.filters,unbookableRooms:this.unbookableRooms,isLoading:this.isLoading,onFiltersChange:this.handleFiltersChange,onFiltersReset:this.handleFiltersReset,onFiltersSave:this.handleRefresh}),t("ir-unbookable-rooms-data",{mode:this.mode,isLoading:this.isLoading,errorMessage:this.errorMessage,unbookableRooms:this.unbookableRooms,allowedProperties:this.allowedProperties,filters:this.filters,progressFilters:this.progressFilters}))))}static get watchers(){return{ticket:["ticketChanged"],mode:["modeChanged"],property_id:["propertyIdChanged"],period_to_check:["periodToCheckChanged"],consecutive_period:["consecutivePeriodChanged"]}}};n.style=a;export{n as ir_unbookable_rooms};
//# sourceMappingURL=p-5b3fc326.entry.js.map