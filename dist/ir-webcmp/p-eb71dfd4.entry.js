import{r as e,c as t,h as s}from"./p-b4b99085.js";import{l as i}from"./p-2fcb9a1f.js";import{z as a,Z as r}from"./p-7fc0c3ea.js";import{H as o}from"./p-a436c507.js";import{C as l}from"./p-28b4b2bd.js";import{U as n}from"./p-653967d3.js";import{c as d}from"./p-88b6b84d.js";import"./p-41fabaeb.js";import"./p-bf44a732.js";const h="";const c=h;const f=".sc-ir-user-form-panel-h{height:100%}.sheet-container.sc-ir-user-form-panel{display:flex !important;flex-direction:column !important;background:white;height:100% !important;gap:1rem}.sheet-footer.sc-ir-user-form-panel{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-user-form-panel{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-user-form-panel{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-user-form-panel{flex-direction:row;align-items:center}}";const u=f;const b=class{constructor(s){e(this,s);this.resetData=t(this,"resetData",7);this.closeSideBar=t(this,"closeSideBar",7);this.isEdit=false;this.language="en";this.isLoading=false;this.autoValidate=false;this.userInfo={id:-1,is_active:false,last_signed_in:"",created_at:"",mobile:"",name:"",note:"",password:"",email:"",property_id:null,username:null,phone_prefix:null};this.errors=null;this.showPasswordValidation=false;this.housekeepingService=new o;this.disableFields=false;this.mobileMask={};this.userSchema=a.object({name:a.string().min(2),mobile:a.string().min(1).max(14),email:a.string().email(),password:a.string().nullable().refine((e=>{var t;if(this.user&&!((t=this.userInfo)===null||t===void 0?void 0:t.password)){return true}return l.PASSWORD.test(e)}),{message:"Password must be at least 8 characters long."}),username:a.string().min(3).refine((async e=>{if(this.user&&this.user.username===e){return true}if(e.length>=3){return!await(new n).checkUserExistence({UserName:e})}return true}),{message:"Username already exists."})})}async componentWillLoad(){if(!this.user){this.userInfo["property_id"]=this.property_id}if(this.user){this.autoValidate=true;this.userInfo=Object.assign(Object.assign({},this.user),{password:""});this.disableFields=this.isSuperAdmin}this.mobileMask={mask:`{${d.country.phone_prefix}} 000000000000`,lazy:false,autofix:true,placeholderChar:"â€‹"}}updateUserField(e,t){this.userInfo=Object.assign(Object.assign({},this.userInfo),{[e]:t})}async addUser(){try{this.isLoading=true;if(!this.autoValidate){this.autoValidate=true}const e=Object.assign(Object.assign({},this.userInfo),{password:this.user&&this.userInfo.password===""?this.user.password:this.userInfo.password});console.log("toValidateUserInfo",e);await this.userSchema.parseAsync(e);if(this.errors){this.errors=null}await this.housekeepingService.editExposedHKM(e);this.resetData.emit(null);this.closeSideBar.emit(null)}catch(e){const t={};if(e instanceof r){e.issues.map((e=>{t[e.path[0]]=true}));this.errors=t}console.error(e)}finally{this.isLoading=false}}async handleBlur(e){e.stopImmediatePropagation();e.stopPropagation();if(this.user||!this.userInfo.name){return}const t=await this.housekeepingService.generateUserName(this.userInfo.name);this.updateUserField("username",t)}render(){var e,t,a,r,o,l;return s("form",{key:"bed2d89c26ac3fa6b61c111536550b4bd0c165ef",class:"sheet-container",onSubmit:async e=>{e.preventDefault();await this.addUser()}},s("ir-title",{key:"bf3e0e59c6c176f28545f6469d69ee7b4f4ee792",class:"px-1 sheet-header",displayContext:"sidebar",label:this.isEdit?"Edit User":"Create New User"}),s("section",{key:"93f677fac524a4bb7acfe0c522c0290e8235ecd1",class:"px-1 sheet-body"},s("ir-input-text",{key:"ff871c8e6434e50d874ff9b6033ef0ff2f6578fd",testId:"email",zod:this.userSchema.pick({email:true}),wrapKey:"email",autoValidate:this.autoValidate,error:(e=this.errors)===null||e===void 0?void 0:e.email,label:i.entries.Lcz_Email,placeholder:"",onTextChange:e=>this.updateUserField("email",e.detail),value:this.userInfo.email,onInputBlur:this.handleBlur.bind(this),maxLength:40}),s("ir-input-text",{key:"de99b169eab8ddc38b16bc9922a9acbd36e0069f",testId:"mobile",disabled:this.disableFields,zod:this.userSchema.pick({mobile:true}),wrapKey:"mobile",error:(t=this.errors)===null||t===void 0?void 0:t.mobile,asyncParse:true,autoValidate:this.user?((a=this.userInfo)===null||a===void 0?void 0:a.mobile)!==this.user.mobile?true:false:this.autoValidate,label:"Mobile",mask:this.mobileMask,placeholder:"",value:this.userInfo.mobile,onTextChange:e=>this.updateUserField("mobile",e.detail)}),s("div",{key:"20886defe048ece15473a64454ee2fc967c0fc35",class:"mb-1"},s("ir-select",{key:"fb4bce94a481f350085b4f0126debcaf5eef4145",disabled:this.disableFields,label:"Role",data:[{text:"Admin",value:"1"},{text:"Frontdesk",value:"2"}],selectedValue:this.userInfo.role,onSelectChange:e=>this.updateUserField("role",e.detail)})),s("ir-input-text",{key:"f45daa9cc137a7806d1c1cc3df53ae0c9053bdfa",testId:"name",zod:this.userSchema.pick({name:true}),wrapKey:"name",autoValidate:this.autoValidate,error:(r=this.errors)===null||r===void 0?void 0:r.name,label:"Username",disabled:this.disableFields,placeholder:"",onTextChange:e=>this.updateUserField("name",e.detail),value:this.userInfo.name,onInputBlur:this.handleBlur.bind(this),maxLength:40}),s("ir-input-text",{key:"2117beab8544591f970806bc1f219cc930543dc7",testId:"password",autoValidate:this.user?!((o=this.userInfo)===null||o===void 0?void 0:o.password)?false:true:this.autoValidate,label:"Password",value:this.userInfo.password,type:"password",maxLength:16,zod:this.userSchema.pick({password:true}),wrapKey:"password",error:(l=this.errors)===null||l===void 0?void 0:l.password,onInputFocus:()=>this.showPasswordValidation=true,onInputBlur:()=>{},onTextChange:e=>this.updateUserField("password",e.detail)}),this.showPasswordValidation&&s("ir-password-validator",{key:"bd6e3905836e643edd8645f159a9cc3fbd73e5df",class:"mb-1",password:this.userInfo.password})),s("div",{key:"d2db6632edac9c24da4bbd56eb82221d552a700e",class:"sheet-footer"},s("ir-button",{key:"a9cf387ac5f0db3142d9a7b8bc40d0d3404664f1","data-testid":"cancel",onClickHandler:()=>this.closeSideBar.emit(null),class:"flex-fill",btn_styles:"w-100 justify-content-center align-items-center",btn_color:"secondary",text:i.entries.Lcz_Cancel}),s("ir-button",{key:"d94e01aaa7c47e76f5016a22d3b745c08fa35650","data-testid":"save",isLoading:this.isLoading,class:"flex-fill",btn_type:"submit",btn_styles:"w-100 justify-content-center align-items-center",text:i.entries.Lcz_Save})))}};b.style=c+u;export{b as ir_user_form_panel};
//# sourceMappingURL=p-eb71dfd4.entry.js.map