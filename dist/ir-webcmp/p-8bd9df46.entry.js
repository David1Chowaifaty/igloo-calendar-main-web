import{r as e,c as i,h as r,H as o}from"./p-acddcbeb.js";import{b as c,f as t}from"./p-ced9b97a.js";import{h as a}from"./p-6c4ba7c0.js";import"./p-b859bcd5.js";import"./p-d6d6fb27.js";import"./p-2925ded6.js";import"./p-e58470d9.js";import"./p-bf44a732.js";const s=".sc-ir-invoice-h{display:block}.ir-invoice__container.sc-ir-invoice{display:grid;gap:var(--wa-space-l);box-sizing:border-box}.ir-invoice__service.sc-ir-invoice:last-child{border-bottom-left-radius:var(--wa-border-radius-m);border-bottom-right-radius:var(--wa-border-radius-m)}.ir-invoice__service.sc-ir-invoice:first-child{border-top-left-radius:var(--wa-border-radius-m);border-top-right-radius:var(--wa-border-radius-m);border-top:var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color)}.ir-invoice__service.sc-ir-invoice{border-bottom:var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);border-left:var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);border-right:var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);background-color:var(--wa-color-surface-default);display:flex;align-items:center;box-sizing:border-box;width:100%}.ir-invoice__service.sc-ir-invoice:hover{background-color:color-mix(in srgb, var(--wa-color-surface-default) 95%, var(--wa-color-mix-hover))}.ir-invoice__checkbox.sc-ir-invoice,.ir-invoice__checkbox.sc-ir-invoice::part(base){height:100%;width:100%;display:flex;box-sizing:border-box}.ir-invoice__checkbox.sc-ir-invoice::part(base){min-height:var(--wa-form-control-height);padding:0 var(--wa-form-control-padding-inline);display:flex;align-items:center;box-sizing:border-box;width:100%}.ir-invoice__checkbox.group.sc-ir-invoice::part(base){padding-block:1rem;align-items:flex-start}.ir-invoice__room-checkbox-container.sc-ir-invoice{display:flex;align-items:center;gap:0.5rem}.ir-invoice__room-checkbox-container.group.sc-ir-invoice{flex-direction:column}.ir-invoice__checkbox-price.sc-ir-invoice{font-weight:700;color:var(--wa-color-neutral-900);white-space:nowrap;text-align:right;flex:1 1 0%}.ir-invoice__form-control-label.sc-ir-invoice{display:inline-flex;color:var(--wa-form-control-label-color);font-weight:var(--wa-form-control-label-font-weight);line-height:var(--wa-form-control-label-line-height);margin-block-end:0.5em}";const n=s;const l=class{constructor(r){e(this,r);this.invoiceOpen=i(this,"invoiceOpen",7);this.invoiceClose=i(this,"invoiceClose",7);this.invoiceCreated=i(this,"invoiceCreated",7)}open;booking;mode="create";for="booking";roomIdentifier;autoPrint=false;selectedRecipient;invoiceOpen;invoiceClose;invoiceCreated;invoiceFormRef;room;componentWillLoad(){if(this.booking){this.selectedRecipient=this.booking.guest.id.toString();if(this.for==="room"&&this.roomIdentifier){this.room=this.booking.rooms.find((e=>e.identifier===this.roomIdentifier))}}}handleBookingChange(){if(this.booking){this.selectedRecipient=this.booking.guest.id.toString();if(this.for==="room"&&this.roomIdentifier){this.room=this.booking.rooms.find((e=>e.identifier===this.roomIdentifier))}}}async openDrawer(){this.open=true;this.invoiceOpen.emit()}async closeDrawer(){this.open=false;this.invoiceFormRef.reset();this.selectedRecipient=this.booking?.guest?.id?.toString();this.invoiceClose.emit()}handleConfirmInvoice(e=false){if(!e)this.invoiceCreated.emit({booking:this.booking,recipientId:this.selectedRecipient,for:this.for,roomIdentifier:this.roomIdentifier,mode:this.mode})}getMinDate(){if(this.for==="room"){return this.room.to_date}const e=()=>{let e=a();for(const i of this.booking.rooms){const r=a(i.to_date,"YYYY-MM-DD");if(r.isBefore(e)){e=r.clone()}}return e};return e().format("YYYY-MM-DD")}getMaxDate(){return a().format("YYYY-MM-DD")}computeRoomGroups(e){const i=new Map;e.forEach(((e,r)=>i.set(e.identifier,r)));if(!e.length){return{groups:[],indexById:i,hasSplitGroups:false}}const r=e=>{let i=Number.MAX_SAFE_INTEGER;for(const r of e){const e=Date.parse(r?.from_date??"");if(!Number.isNaN(e)){i=Math.min(i,e)}}return i};const o=c(e);if(!o){const o=[...e].sort(((e,r)=>{const o=Date.parse(e?.from_date??"")-Date.parse(r?.from_date??"");if(!Number.isNaN(o)&&o!==0){return o}return(i.get(e.identifier)??0)-(i.get(r.identifier)??0)}));return{groups:[{rooms:o,order:0,isSplit:false,sortKey:r(o)}],indexById:i,hasSplitGroups:false}}const t=new Map(e.map((e=>[e.identifier,e])));const a=[];const s=new Set;for(const e of o.heads){const c=o.chainOf.get(e)??[e];const n=c.map((e=>t.get(e))).filter((e=>Boolean(e)));if(!n.length)continue;const l=c.some((e=>{const i=o.parentOf.get(e);const r=o.childrenOf.get(e)??[];return Boolean(i)||r.length>0}))||n.some((e=>Boolean(e?.is_split)));if(l){n.forEach((e=>s.add(e.identifier)));const e=Math.min(...n.map((e=>i.get(e.identifier)??Number.MAX_SAFE_INTEGER)));a.push({rooms:n,order:e,sortKey:r(n),isSplit:true})}}for(const o of e){if(!s.has(o.identifier)){const e=i.get(o.identifier)??Number.MAX_SAFE_INTEGER;const c=[o];a.push({rooms:c,order:e,sortKey:r(c),isSplit:false})}}a.sort(((e,i)=>{if(e.sortKey!==i.sortKey){return e.sortKey-i.sortKey}return e.order-i.order}));const n=a.some((e=>e.isSplit));if(!n){const e=a.map((e=>e.rooms)).reduce(((e,i)=>e.concat(i)),[]).sort(((e,r)=>{const o=Date.parse(e?.from_date??"")-Date.parse(r?.from_date??"");if(!Number.isNaN(o)&&o!==0){return o}return(i.get(e.identifier)??0)-(i.get(r.identifier)??0)}));return{groups:[{rooms:e,order:0,sortKey:r(e),isSplit:false}],indexById:i,hasSplitGroups:false}}return{groups:a,indexById:i,hasSplitGroups:true}}renderRooms(){const e=this.booking?.rooms??[];if(!e.length){return null}const{groups:i,hasSplitGroups:o}=this.computeRoomGroups(e);if(!o){const e=i[0].rooms;return e.map((e=>r("div",{class:"ir-invoice__service",key:e.identifier},r("wa-checkbox",{class:"ir-invoice__checkbox",checked:true},r("div",{class:"ir-invoice__room-checkbox-container"},r("b",null,e.roomtype.name),r("span",null,e.rateplan.short_name),r("span",{class:"ir-invoice__checkbox-price"},t("$US",e.gross_total)))))))}return i.map((e=>r("div",{class:"ir-invoice__service",key:e.order},r("wa-checkbox",{class:"ir-invoice__checkbox group",checked:true},r("div",{class:"ir-invoice__room-checkbox-container group"},e.rooms.map((e=>r("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},r("b",null,e.roomtype.name),r("span",null,e.rateplan.short_name),r("span",{class:"ir-invoice__checkbox-price"},t("$US",e.gross_total))))))))))}render(){return r(o,{key:"678e009501fec6747c01ee0a4a7f6d6c9d7ceed7"},r("ir-drawer",{key:"45c42ff8a45326486783321b53bb848ac5d43026",label:"Invoice",open:this.open,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeDrawer()}},r("form",{key:"5c9b94860c8121a23db8aaadadaa098f454331b2",ref:e=>this.invoiceFormRef=e,class:"ir-invoice__container"},r("ir-custom-date-picker",{key:"2ed42905cf4d0cccf82d34d888420921c216cd78",label:"Date",date:a().format("YYYY-MM-DD"),minDate:this.getMinDate(),maxDate:this.getMaxDate()}),r("ir-booking-billing-recipient",{key:"65ae41ec0d5d0298cf254eff0f6b3361cff270a3",onRecipientChange:e=>this.selectedRecipient=e.detail,booking:this.booking}),r("div",{key:"21d3928333189bb78b5d56e56e20e9ba6f2da35e",class:"ir-invoice__services"},r("p",{key:"9f68ebd963e49723ee462c6468a3d0aa477a90a0",class:"ir-invoice__form-control-label"},"Choose what to invoice"),r("div",{key:"0d397f83776854c40bef9ce22fd8f2e51a260c1d",class:"ir-invoice__services-container"},this.renderRooms(),this.booking.pickup_info&&r("div",{key:"006b4077bd25aa5fd1a5f58513bb1a1fdf589a9d",class:"ir-invoice__service"},r("wa-checkbox",{key:"26faf09ac4dcf3109763d8ca4246fb47deab709c",class:"ir-invoice__checkbox"},r("div",{key:"214ef837404fbe85fbd61c2e5c875f5f82bdbf0d"},"Pickup"))),this.booking.extra_services?.map((e=>r("div",{key:e.system_id,class:"ir-invoice__service"},r("wa-checkbox",{class:"ir-invoice__checkbox"},r("div",null)))))))),r("div",{key:"9e2cb975151aa015d069cc712873bfa475761133",slot:"footer",class:"ir__drawer-footer"},r("ir-custom-button",{key:"538ffa5bed5a4de71488df3ea8f85effa9d0c2e8",size:"medium",appearance:"filled",class:"w-100 flex-fill",variant:"neutral",onClickHandler:()=>{this.closeDrawer()}},"Cancel"),r("ir-custom-button",{key:"ba769d5e22f91cacf6633fd63cc9317c572561fa",onClickHandler:()=>{this.handleConfirmInvoice(true)},size:"medium",class:"w-100 flex-fill",appearance:"outlined",variant:"brand"},"Pro-forma invoice"),r("ir-custom-button",{key:"c512c70b0d2e638093fd0285f0aade54191381f0",onClickHandler:()=>{this.handleConfirmInvoice()},class:"w-100 flex-fill",size:"medium",variant:"brand"},"Confirm invoice"))))}static get watchers(){return{booking:["handleBookingChange"]}}};l.style=n;export{l as ir_invoice};
//# sourceMappingURL=p-8bd9df46.entry.js.map