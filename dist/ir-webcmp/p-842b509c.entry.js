import{r as t,c as e,h as i,H as s}from"./p-ee49d535.js";import{T as n}from"./p-cab2ff69.js";import{l as a}from"./p-806fad31.js";import{c as o}from"./p-9c08500e.js";import{h as d}from"./p-6c4ba7c0.js";import{v as c}from"./p-4ed69de7.js";import"./p-06203439.js";import"./p-e016a0cc.js";import"./p-4eb12235.js";const h=".sc-igl-tba-booking-view-h{display:block}.guestTitle.sc-igl-tba-booking-view{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:2px;margin-bottom:5px;margin-top:5px;padding-left:5px;padding-right:5px}.guestTitle.selectedOrder.sc-igl-tba-booking-view{background-color:#f9f9c9}.pointer.sc-igl-tba-booking-view{cursor:pointer}hr.sc-igl-tba-booking-view{margin-top:8px;margin-bottom:0px}.bookingContainer.sc-igl-tba-booking-view{background-color:#ececec}.actionsContainer.sc-igl-tba-booking-view{display:flex;align-items:center;padding:5px !important;width:100%;gap:16px}.room-select.sc-igl-tba-booking-view{flex:1}.selectContainer.sc-igl-tba-booking-view{width:195px;margin-right:8px}.buttonsContainer.sc-igl-tba-booking-view{box-sizing:border-box;display:flex;align-items:center;justify-content:flex-end;padding:0;margin:0;gap:0.5rem}";const l=h;const r=class{constructor(i){t(this,i);this.highlightToBeAssignedBookingEvent=e(this,"highlightToBeAssignedBookingEvent",7);this.addToBeAssignedEvent=e(this,"addToBeAssignedEvent",7);this.scrollPageToRoom=e(this,"scrollPageToRoom",7);this.assignRoomEvent=e(this,"assignRoomEvent",7);this.highlightSection=false;this.allRoomsList=[];this.toBeAssignedService=new n;this.calendarData=undefined;this.selectedDate=undefined;this.eventData={};this.categoriesData={};this.categoryId=undefined;this.categoryIndex=undefined;this.eventIndex=undefined;this.renderAgain=false;this.selectedRoom=-1;this.isLoading=null}componentShouldUpdate(t,e,i){if(i==="selectedDate"&&t!==e){this.highlightSection=false;this.selectedRoom=-1;return true}else if(i==="eventData"&&t!==e){this.selectedRoom=-1;return true}return true}componentWillLoad(){if(this.categoryIndex===0&&this.eventIndex===0){setTimeout((()=>{this.handleHighlightAvailability()}),100)}}highlightBookingEvent(t){let e=t.detail.data;if(e.bookingId!=this.eventData.ID){this.highlightSection=false;this.selectedRoom=-1;this.renderView()}else{this.highlightSection=true;this.renderView()}}onSelectRoom(t){if(t.stopImmediatePropagation){t.stopImmediatePropagation();t.stopPropagation()}this.selectedRoom=parseInt(t.target.value)}async handleAssignUnit(t,e=false){try{t.stopImmediatePropagation();t.stopPropagation();if(this.selectedRoom){this.isLoading=e?"checkin":"default";await this.toBeAssignedService.assignUnit({booking_nbr:this.eventData.BOOKING_NUMBER,identifier:this.eventData.ID,pr_id:this.selectedRoom,check_in:e});let t=Object.assign(Object.assign({},this.eventData),{PR_ID:this.selectedRoom});this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[t]});this.assignRoomEvent.emit({key:"assignRoom",data:t})}}catch(t){console.log(t)}finally{this.isLoading=null}}handleHighlightAvailability(){this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:this.eventData.ID,fromDate:this.eventData.FROM_DATE}});if(!this.selectedDate){return}let t=[];let e=[];t=this.eventData.availableRooms.map((t=>{e.push({calendar_cell:null,id:t.PR_ID,name:t.roomName});return Object.assign(Object.assign({},t),{defaultDateRange:this.eventData.defaultDateRange,identifier:this.eventData.identifier})}));this.allRoomsList=e;this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:t});this.scrollPageToRoom.emit({key:"scrollPageToRoom",id:this.categoryId,refClass:"category_"+this.categoryId});this.renderView()}handleCloseAssignment(t){t.stopImmediatePropagation();t.stopPropagation();this.highlightSection=false;this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:"----"}});this.onSelectRoom({target:{value:""}});this.selectedRoom=-1;this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.renderView()}renderView(){this.renderAgain=!this.renderAgain}canCheckIn(){if(!o.checkin_enabled){return false}if(d(new Date).isSameOrAfter(new Date(this.eventData.FROM_DATE),"days")&&d(new Date).isBefore(new Date(this.eventData.TO_DATE),"days")){return true}return false}render(){return i(s,{key:"2c103cf2c3c7ced09b4f4a73f065f1872b7288a2"},i("div",{key:"3c7cb622636892b2aa6c1e688d4d0343133549b1",class:"bookingContainer",onClick:()=>this.handleHighlightAvailability()},i("div",{key:"299651e5fdb5628a203b8e86262f2de633829b09",class:`guestTitle ${this.highlightSection?"selectedOrder":""} pointer font-small-3`,"data-toggle":"tooltip","data-placement":"top","data-original-title":"Click to assign unit"},`Book# ${this.eventData.BOOKING_NUMBER} - ${this.eventData.NAME}`),i("div",{key:"e451a3ddf963d72cb8d060c4ae304eabd362aefa",class:"row m-0 p-0 actionsContainer"},i("select",{key:"48bef6325a6f17fe1a2ed8763d4397d300f241a0",class:"form-control input-sm room-select flex-grow-1",id:c(),onChange:t=>this.onSelectRoom(t)},i("option",{key:"9c650f67c94a88ef8a2d0c9fba91a2b3836d8f3c",value:"",selected:this.selectedRoom==-1},a.entries.Lcz_AssignUnit),this.allRoomsList.map((t=>i("option",{value:t.id,selected:this.selectedRoom==t.id},t.name)))),this.highlightSection?i("div",{class:"buttonsContainer bg-red"},i("button",{type:"button",class:"btn btn-secondary btn-sm mx-0",onClick:t=>this.handleCloseAssignment(t)},i("svg",{class:"m-0 p-0",xmlns:"http://www.w3.org/2000/svg",height:"12",width:"9",viewBox:"0 0 384 512"},i("path",{fill:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"})))):null),i("div",{key:"cad44a9960cdd96ef7f2767ff0e814fadc8d1111",class:"d-flex align-items-center ",style:{gap:"0.5rem",paddingInline:"5px"}},i("ir-button",{key:"f2325b5536ab3823e3c8e21c2cf604d2484aeb5c",isLoading:this.isLoading==="default",size:"sm",class:"flex-grow-1",text:a.entries.Lcz_Assign,onClickHandler:t=>this.handleAssignUnit(t),btn_disabled:this.selectedRoom===-1}),this.canCheckIn()&&i("ir-button",{key:"ffcbfb304c3df00ec3906dffe6701d8f4cc14c6b",isLoading:this.isLoading==="checkin",size:"sm",class:"flex-grow-1",text:a.entries.Lcz_AssignedAndChecIn,onClickHandler:t=>this.handleAssignUnit(t,true),btn_disabled:this.selectedRoom===-1})),i("hr",{key:"49e098cea9ec40296399ebc58f095b35f38dbd72"})))}};r.style=l;const g=".sc-igl-tba-category-view-h{display:block}";const f=g;const b=class{constructor(i){t(this,i);this.assignUnitEvent=e(this,"assignUnitEvent",7);this.calendarData=undefined;this.selectedDate=undefined;this.categoriesData={};this.categoryId=undefined;this.eventDatas=undefined;this.categoryIndex=undefined;this.renderAgain=false}componentWillLoad(){}handleAssignRoomEvent(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.eventDatas=this.eventDatas.filter((t=>t.ID!=e.data.ID));this.calendarData.bookingEvents.push(e.data);this.assignUnitEvent.emit({key:"assignUnit",data:{RT_ID:this.categoryId,selectedDate:this.selectedDate,assignEvent:e.data,calendarData:this.calendarData}});this.renderView()}getEventView(t,e){return e.map(((e,s)=>i("igl-tba-booking-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,eventData:e,categoriesData:this.categoriesData,categoryId:t,categoryIndex:this.categoryIndex,eventIndex:s,onAssignRoomEvent:t=>this.handleAssignRoomEvent(t)})))}renderView(){this.renderAgain=!this.renderAgain}render(){var t;return i(s,{key:"6d7644cc1b86754316c943695e2703c26913860c"},i("div",{key:"91e60fc7dcb4bbc9ece285979f87d33d55e22510",class:"sectionContainer"},i("div",{key:"568c15054e8ad866f1bc00d44fd8e1ac9c90e609",class:"font-weight-bold mt-1 font-small-3"},(t=this.categoriesData[this.categoryId])===null||t===void 0?void 0:t.name),this.getEventView(this.categoryId,this.eventDatas)))}};b.style=f;export{r as igl_tba_booking_view,b as igl_tba_category_view};
//# sourceMappingURL=p-842b509c.entry.js.map