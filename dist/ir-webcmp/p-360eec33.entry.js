import{r as e,c as t,g as r,h as i,H as s}from"./p-d239357b.js";import{a as n}from"./p-bf44a732.js";import{D as h}from"./p-367551b0.js";const a=".sc-ir-property-switcher-dialog-content-h{display:block}.property-switcher__search-input.sc-ir-property-switcher-dialog-content{padding:1rem}.property-switcher__search-input.sc-ir-property-switcher-dialog-content::part(base){font-size:16px;height:32px}.property-switcher__status.sc-ir-property-switcher-dialog-content{padding:1rem;font-size:0.875rem;color:var(--ir-color-text-muted, #646464)}@media (min-width: 640px){.property-switcher__results.sc-ir-property-switcher-dialog-content{max-height:250px;min-height:150px;overflow-y:auto;padding-bottom:1rem}}";const o=a;var c=undefined&&undefined.__decorate||function(e,t,r,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,r):i,h;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")n=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)if(h=e[a])n=(s<3?h(n):s>3?h(t,r,n):h(t,r))||n;return s>3&&n&&Object.defineProperty(t,r,n),n};const p=class{constructor(r){e(this,r);this.propertySelected=t(this,"propertySelected",7);this.linkedPropertyChange=t(this,"linkedPropertyChange",7)}get el(){return r(this)}open=false;selectedPropertyId;properties=[];propertySelected;linkedPropertyChange;filteredProperties=[];searchTerm="";highlightedIndex=-1;inputRef;resetOnOpenFrame;focusOnLoadFrame;handleOpenChange(e){if(!e){return}this.resetOnOpenFrame=requestAnimationFrame((()=>{this.resetSearch()}))}componentDidLoad(){this.focusOnLoadFrame=requestAnimationFrame((()=>{this.inputRef?.focusInput()}))}disconnectedCallback(){if(this.resetOnOpenFrame)cancelAnimationFrame(this.resetOnOpenFrame);if(this.focusOnLoadFrame)cancelAnimationFrame(this.focusOnLoadFrame)}handleSelectedPropertyIdChange(){this.syncHighlightedIndex()}resetSearch(){this.searchTerm="";this.filteredProperties=[];this.highlightedIndex=-1}async fetchProperties(e){const t=e.trim();if(!t){this.filteredProperties=[];this.highlightedIndex=-1;return}try{const{data:e}=await n.post("/Fetch_Properties",{SEARCH_TERM:t});const r=e.My_Result;this.filteredProperties=r}catch(e){console.error("Failed to fetch properties",e);this.filteredProperties=[]}if(!this.filteredProperties.length){this.highlightedIndex=-1;return}const r=this.getSelectedIndex(this.filteredProperties);this.highlightedIndex=r>=0?r:0;requestAnimationFrame((()=>this.ensureHighlightedVisible()))}getSelectedIndex(e){if(!this.selectedPropertyId){return-1}return e.findIndex((e=>this.getPropertyId(e)===this.selectedPropertyId))}syncHighlightedIndex(){if(!this.filteredProperties.length){this.highlightedIndex=-1;return}const e=this.getSelectedIndex(this.filteredProperties);if(e>=0){this.highlightedIndex=e;return}this.highlightedIndex=Math.min(Math.max(this.highlightedIndex,0),this.filteredProperties.length-1)}handleSearchChange=e=>{this.searchTerm=e.detail??"";this.fetchProperties(this.searchTerm)};handleKeyDown=e=>{if(!this.filteredProperties.length){return}switch(e.key){case"ArrowDown":e.preventDefault();this.highlightedIndex=Math.min(this.filteredProperties.length-1,this.highlightedIndex+1);this.ensureHighlightedVisible();break;case"ArrowUp":e.preventDefault();this.highlightedIndex=Math.max(0,this.highlightedIndex-1);this.ensureHighlightedVisible();break;case"Enter":e.preventDefault();this.selectProperty(this.filteredProperties[this.highlightedIndex]);break}};ensureHighlightedVisible(){if(this.highlightedIndex<0){return}const e=this.el.querySelectorAll("wa-option");const t=e?.[this.highlightedIndex];t?.scrollIntoView({block:"nearest",inline:"nearest"})}selectProperty(e){if(!e){return}const t=this.getPropertyId(e);if(typeof t!=="number"){return}this.propertySelected.emit(t)}getPropertyId(e){return"PROPERTY_ID"in e?e.PROPERTY_ID:e.property_id}renderStatus(e){return i("div",{class:"property-switcher__status"},e)}render(){return i(s,{key:"47daa8547a4ef20867653794149b0fb47874098d"},i("ir-input",{key:"96c727f22d28f9b11d69980bdbd0e72965fdb39a",autofocus:true,ref:e=>this.inputRef=e,placeholder:"Enter name or A number",class:"property-switcher__search-input",value:this.searchTerm,"onText-change":this.handleSearchChange,onKeyDown:this.handleKeyDown,withClear:true}),i("div",{key:"118d8e75bff2246c473dc90ba8c37b184a16e9dd",tabIndex:-1,class:"property-switcher__results"},!this.searchTerm&&this.properties?.length>0&&i("div",{key:"e56b4ff3a15cf0340d1f2b6fec0cebab2a3b75a9"},i("p",{key:"286aad3cf19361be3f7e3f711c42bf8d6bf03bf7",style:{padding:"1rem",margin:"0",paddingTop:"0"}},"Linked Properties"),this.properties.map((e=>{const t=`${e.name}`;return i("wa-option",{onClick:()=>{this.linkedPropertyChange.emit(e)},selected:this.selectedPropertyId===e.property_id,value:e.property_id?.toString(),label:t},t)}))),this.searchTerm&&this.filteredProperties.length===0&&this.renderStatus("No properties found"),this.filteredProperties.map(((e,t)=>{const r=`${e.COUNTRY_CODE}: ${e.PROPERTY_NAME} - ${e.A_NAME}`;return i("wa-option",{onClick:()=>this.selectProperty(e),selected:this.selectedPropertyId===e.PROPERTY_ID,current:this.highlightedIndex===t,value:e.PROPERTY_ID?.toString(),label:r},r)}))))}static get watchers(){return{open:["handleOpenChange"],selectedPropertyId:["handleSelectedPropertyIdChange"]}}};c([h(300)],p.prototype,"fetchProperties",null);p.style=o;export{p as ir_property_switcher_dialog_content};
//# sourceMappingURL=p-360eec33.entry.js.map