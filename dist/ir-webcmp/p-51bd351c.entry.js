import{r as t,c as e,h as i,F as s,H as n,g as o}from"./p-53d64953.js";import{N as r,O as l,I as a,J as h,f as d}from"./p-ba0d5d8c.js";import{E as c}from"./p-46a94ca6.js";import{h as b}from"./p-6c4ba7c0.js";import{l as u}from"./p-71768c2d.js";import{c as g}from"./p-00df8713.js";import"./p-b859bcd5.js";import"./p-bf44a732.js";import"./p-a973aec7.js";import"./p-08fe3669.js";const m=".sc-igl-booking-event-hover-h{display:block;position:relative;z-index:100}.btn.sc-igl-booking-event-hover{padding-left:4px !important;padding-right:4px !important}.balance_amount.sc-igl-booking-event-hover{color:#ff4961;font-size:0.75rem}.user-notes.sc-igl-booking-event-hover{margin-left:4px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:5;line-clamp:5;overflow:hidden;max-width:100%;height:auto}.events_btns.sc-igl-booking-event-hover{display:inline-flex;align-items:center;justify-content:center;gap:0.5rem}.mx-01.sc-igl-booking-event-hover{--m:5px;margin-left:var(--m) !important;margin-right:var(--m) !important}.pointerContainerTop.sc-igl-booking-event-hover{top:-26px}.pointerContainer.sc-igl-booking-event-hover{position:absolute;height:10px;width:350px;left:var(--el-left, 50%);transform:translateX(-50%)}.ota-notes.sc-igl-booking-event-hover{width:450px}.iglPopOver.sc-igl-booking-event-hover{position:absolute;background-color:#fff;padding:10px;border:1px solid #656ee7;border-radius:6px;left:var(--el-left, 50%);transform:translateX(-50%) translateY(10px);box-shadow:1px 0px 20px rgba(0, 0, 0, 0.2)}.iglPopOver.infoBubble.sc-igl-booking-event-hover{min-width:350px}.iglPopOver.blockedView.sc-igl-booking-event-hover{max-width:400px;width:400px}.iglPopOver.newBookingOptions.sc-igl-booking-event-hover{overflow-wrap:break-word !important;min-width:230px;width:fit-content}.bubblePointer.sc-igl-booking-event-hover{position:absolute;width:0;height:0;left:50%;border-left:10px solid transparent;border-right:10px solid transparent;transform:translate(-50%, 0px)}.bubblePointTop.sc-igl-booking-event-hover{border-top:10px solid #656ee7}.bubblePointBottom.sc-igl-booking-event-hover{border-bottom:10px solid #656ee7}.bubbleInfoAbove.sc-igl-booking-event-hover{bottom:35px}.updateBtnIcon.sc-igl-booking-event-hover{margin-right:4px}.icon-image.sc-igl-booking-event-hover{height:1.5rem;width:1.5rem;margin-right:5px}";const p=m;const v=class{constructor(i){t(this,i);this.showBookingPopup=e(this,"showBookingPopup",7);this.hideBubbleInfo=e(this,"hideBubbleInfo",7);this.deleteButton=e(this,"deleteButton",7);this.bookingCreated=e(this,"bookingCreated",7);this.showDialog=e(this,"showDialog",7);this.bubbleInfoTop=false;this.is_vacation_rental=false;this.shouldHideUnassignUnit=false;this.eventService=new c;this.hideButtons=false}componentWillLoad(){let t=this.bookingEvent.roomsInfo.find((t=>t.id===this.bookingEvent.RATE_TYPE));if(t){this.shouldHideUnassignUnit=t.physicalrooms.length===1}if(b(this.bookingEvent.TO_DATE,"YYYY-MM-DD").isBefore(b())){this.hideButtons=true}this.canCheckInOrCheckout=b().isSameOrAfter(new Date(this.bookingEvent.FROM_DATE),"days")&&b().isBefore(new Date(this.bookingEvent.TO_DATE),"days")}handleBookingEventChange(t,e){if(t!==e)this.canCheckInOrCheckout=b(new Date).isSameOrAfter(new Date(this.bookingEvent.FROM_DATE),"days")&&b(new Date).isBefore(new Date(this.bookingEvent.TO_DATE),"days")}getBookingId(){return this.bookingEvent.ID}hideBubble(){this.hideBubbleInfo.emit({key:"hidebubble",currentInfoBubbleId:this.getBookingId()})}handleListenKeyDown(t){if(t.key==="Escape"){t.stopPropagation();this.hideBubble()}else return}getTotalOccupants(){var t,e,i;const{CHILDREN_COUNT:s,ADULTS_COUNT:n}=this.bookingEvent;if(s===0){return`${n} ${n>1?u.entries.Lcz_AdultsCaption.toLowerCase():(t=u.entries.Lcz_Single_Adult)===null||t===void 0?void 0:t.toLowerCase()}`}return`${n} ${n>1?u.entries.Lcz_AdultsCaption.toLowerCase():(e=u.entries.Lcz_Single_Adult)===null||e===void 0?void 0:e.toLowerCase()}, ${s} ${s>1?u.entries.Lcz_ChildCaption.toLowerCase():(i=u.entries.Lcz_Single_Child)===null||i===void 0?void 0:i.toLowerCase()}`}getPhoneNumber(){return this.bookingEvent.PHONE}getCountry(){return r(this.bookingEvent.COUNTRY,this.countries).name}getPhoneCode(){if(this.bookingEvent.PHONE_PREFIX){return this.bookingEvent.PHONE_PREFIX}return r(this.bookingEvent.COUNTRY,this.countries).phone_prefix}renderPhone(){return this.bookingEvent.COUNTRY?`${this.bookingEvent.is_direct?this.getPhoneCode()+"-":""}${this.getPhoneNumber()} - ${this.getCountry()}`:this.getPhoneNumber()}getInternalNote(){return this.bookingEvent.INTERNAL_NOTE}getTotalPrice(){return this.bookingEvent.TOTAL_PRICE}getArrivalTime(){return this.bookingEvent.ARRIVAL_TIME}getRatePlan(){var t,e,i;if(!this.bookingEvent){return}const s=(i=(e=(t=this.bookingEvent)===null||t===void 0?void 0:t.booking)===null||e===void 0?void 0:e.rooms)===null||i===void 0?void 0:i.find((t=>t.assigned_units_pool===this.bookingEvent.ID));if(!s){console.warn(`Couldn't find room with pool ${this.bookingEvent.ID}`);return null}let n="";n+=s.rateplan["short_name"];if(s.rateplan["is_non_refundable"]){n+=` - ${u.entries.Lcz_NonRefundable}`}return n}getEntryDate(){return this.bookingEvent.ENTRY_DATE}isNewBooking(){return this.getBookingId()==="NEW_TEMP_EVENT"}isCheckedIn(){return this.bookingEvent.STATUS==="IN-HOUSE"}isBlockedDateEvent(){return this.bookingEvent.STATUS==="BLOCKED"||this.bookingEvent.STATUS==="BLOCKED-WITH-DATES"}hasSplitBooking(){return this.bookingEvent.hasOwnProperty("splitBookingEvents")&&this.bookingEvent.splitBookingEvents}canCheckIn(){return l({from_date:this.bookingEvent.FROM_DATE,to_date:this.bookingEvent.TO_DATE,isCheckedIn:this.isCheckedIn()})}canCheckOut(){var t,e,i,s;if(!g.checkin_enabled||g.is_automatic_check_in_out){return false}if(this.isCheckedIn()){return true}const n=b();if(((e=(t=this.bookingEvent.ROOM_INFO)===null||t===void 0?void 0:t.in_out)===null||e===void 0?void 0:e.code)==="000"&&b().isSameOrAfter(new Date(this.bookingEvent.TO_DATE),"days")&&a(n.toDate(),h((i=g.checkin_checkout_hours)===null||i===void 0?void 0:i.offset,(s=g.checkin_checkout_hours)===null||s===void 0?void 0:s.hour))){return true}return false}handleBlockDateUpdate(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.bookingEvent=Object.assign(Object.assign({},this.bookingEvent),e.data)}handleEditBooking(){this.bookingEvent.TITLE=u.entries.Lcz_EditBookingFor;this.handleBookingOption("EDIT_BOOKING")}getStringDateFormat(t){return t.getFullYear()+"-"+(t.getMonth()<9?"0":"")+(t.getMonth()+1)+"-"+(t.getDate()<=9?"0":"")+t.getDate()}handleAddRoom(){var t;let e=new Date(this.bookingEvent.FROM_DATE);e.setHours(0,0,0,0);let i=this.getStringDateFormat(e);let s=new Date(this.bookingEvent.TO_DATE);s.setHours(0,0,0,0);let n=this.getStringDateFormat(s);let o={ID:"",NAME:"",BOOKING_NUMBER:this.bookingEvent.BOOKING_NUMBER,FROM_DATE:i,TO_DATE:n,roomsInfo:this.bookingEvent.roomsInfo,ARRIVAL:this.bookingEvent.ARRIVAL,ADD_ROOM_TO_BOOKING:this.bookingEvent.ID,TITLE:"Add Room to #"+this.bookingEvent.BOOKING_NUMBER,event_type:"ADD_ROOM",ROOMS:this.bookingEvent.ROOMS,GUEST:this.bookingEvent.GUEST,message:this.bookingEvent.NOTES,SOURCE:this.bookingEvent.SOURCE,booking:(t=this.bookingEvent)===null||t===void 0?void 0:t.booking,defaultDateRange:{fromDate:e,fromDateStr:"",toDate:s,toDateStr:"",dateDifference:0,editabled:true,message:"Including 5.00% City Tax - Excluding 11.00% VAT"}};this.handleBookingOption("ADD_ROOM",o)}handleCustomerCheckIn(){var t,e;const{adult_nbr:i,children_nbr:s,infant_nbr:n}=this.bookingEvent.ROOM_INFO.occupancy;this.showDialog.emit({reason:"checkin",bookingNumber:this.bookingEvent.BOOKING_NUMBER,roomIdentifier:this.bookingEvent.IDENTIFIER,roomName:"",roomUnit:"",sidebarPayload:{identifier:this.bookingEvent.IDENTIFIER,bookingNumber:this.bookingEvent.BOOKING_NUMBER,checkin:false,roomName:(e=(t=this.bookingEvent.ROOM_INFO.unit)===null||t===void 0?void 0:t.name)!==null&&e!==void 0?e:"",sharing_persons:this.bookingEvent.ROOM_INFO.sharing_persons,totalGuests:i+s+n}})}handleCustomerCheckOut(){this.showDialog.emit({reason:"checkout",bookingNumber:this.bookingEvent.BOOKING_NUMBER,roomIdentifier:this.bookingEvent.IDENTIFIER,roomName:"",roomUnit:""})}handleDeleteEvent(){this.hideBubble();this.deleteButton.emit(this.bookingEvent.POOL);console.log("Delete Event")}async handleUpdateBlockedDates(){try{this.isLoading="update";setTimeout((()=>{this.hideBubble()}),50);await this.eventService.updateBlockedEvent(this.bookingEvent);this.isLoading=""}catch(t){}}handleConvertBlockedDateToBooking(){this.handleBookingOption("BAR_BOOKING")}getRoomInfo(){const t=+this.bookingEvent.PR_ID;let e={};for(const i of this.bookingEvent.roomsInfo){for(const s of i.physicalrooms){if(t===s.id){e.CATEGORY=i.name;e.ROOM_NAME=s.name;e.ROOMS_INFO=i;return e}}}return e}renderTitle(t,e){switch(t){case"EDIT_BOOKING":return`${u.entries.Lcz_EditBookingFor} ${e.CATEGORY} ${e.ROOM_NAME}`;case"ADD_ROOM":return`${u.entries.Lcz_AddingUnitToBooking}# ${this.bookingEvent.BOOKING_NUMBER}`;case"SPLIT_BOOKING":return u.entries.Lcz_Adding+` ${e.CATEGORY} ${e.ROOM_NAME}`;default:return`${u.entries.Lcz_NewBookingFor} ${e.CATEGORY} ${e.ROOM_NAME}`}}handleBookingOption(t,e=null){const i=this.getRoomInfo();let s=e?e:this.bookingEvent;s.event_type=t;s.TITLE=this.renderTitle(t,i);if(["003","002","004"].includes(this.bookingEvent.STATUS_CODE)){s.roomsInfo=[i.ROOMS_INFO]}if(t==="BAR_BOOKING"&&this.bookingEvent.STATUS!=="TEMP-EVENT"){const{FROM_DATE:t,TO_DATE:e,PR_ID:i,RELEASE_AFTER_HOURS:n,ENTRY_DATE:o,OPTIONAL_REASON:r,ENTRY_MINUTE:l,ENTRY_HOUR:a,STATUS_CODE:h}=this.bookingEvent;s.block_exposed_unit_props={from_date:t,to_date:e,NOTES:r,pr_id:i,STAY_STATUS_CODE:h,DESCRIPTION:n,BLOCKED_TILL_DATE:o,BLOCKED_TILL_HOUR:a,BLOCKED_TILL_MINUTE:l};this.handleDeleteEvent()}this.showBookingPopup.emit({key:"add",data:Object.assign({},s)});this.hideBubbleInfo.emit({key:"hidebubble",currentInfoBubbleId:this.getBookingId()})}getOTANotes(t=3){var e;if(!this.bookingEvent.ota_notes||((e=this.bookingEvent.ota_notes)===null||e===void 0?void 0:e.length)===0){return null}const i=[...this.bookingEvent.ota_notes];const s="<br>- ";if(i.length>t){i[t-1]={statement:`${i[t-1].statement} <span style="color: #1e9ff2;">more...</span>`}}return i.slice(0,t).map((t=>`${s}${t.statement}`)).join("")}getInfoElement(){var t,e,s,n,o,r;return i("div",{class:`iglPopOver infoBubble ${this.bubbleInfoTop?"bubbleInfoAbove":""} text-left`},i("div",{class:`row p-0 m-0  ${this.bookingEvent.BALANCE>1?"pb-0":"pb-1"}`},i("div",{class:"px-0  col-8 font-weight-bold font-medium-1 d-flex align-items-center"},i("img",{src:(e=(t=this.bookingEvent)===null||t===void 0?void 0:t.origin)===null||e===void 0?void 0:e.Icon,alt:(n=(s=this.bookingEvent)===null||s===void 0?void 0:s.origin)===null||n===void 0?void 0:n.Label,class:"icon-image"}),i("p",{class:"p-0 m-0"},!this.bookingEvent.is_direct?this.bookingEvent.channel_booking_nbr:this.bookingEvent.BOOKING_NUMBER)),i("div",{class:"pr-0 col-4 text-right"},d(this.currency.symbol,this.getTotalPrice()))),this.bookingEvent.BALANCE>1&&i("p",{class:"pr-0 m-0 p-0 text-right balance_amount"},u.entries.Lcz_Balance,": ",d(this.currency.symbol,this.bookingEvent.BALANCE)),i("div",{class:"row p-0 m-0"},i("div",{class:"px-0 pr-0 col-12"},i("ir-date-view",{from_date:this.bookingEvent.defaultDates.from_date,to_date:this.bookingEvent.defaultDates.to_date,showDateDifference:false}))),this.getArrivalTime()&&i("ir-label",{containerStyle:{padding:"0",margin:"0"},class:"m-0 p-0",labelText:`${u.entries.Lcz_ArrivalTime}:`,content:this.getArrivalTime()}),this.getTotalOccupants()&&i("ir-label",{class:"m-0 p-0",containerStyle:{padding:"0",margin:"0"},labelText:`${u.entries.Lcz_Occupancy}:`,content:this.getTotalOccupants()}),this.getPhoneNumber()&&i("ir-label",{containerStyle:{padding:"0",margin:"0"},class:"m-0 p-0",labelText:`${u.entries.Lcz_Phone}:`,content:this.renderPhone()}),this.getRatePlan()&&i("ir-label",{containerStyle:{padding:"0",margin:"0"},class:"m-0 p-0",labelText:`${u.entries.Lcz_RatePlan}:`,content:this.getRatePlan()}),((o=this.bookingEvent.DEPARTURE_TIME)===null||o===void 0?void 0:o.code)!=="000"&&i("ir-label",{containerStyle:{padding:"0",margin:"0"},class:"m-0 p-0",labelText:`Departure time:`,content:(r=this.bookingEvent.DEPARTURE_TIME)===null||r===void 0?void 0:r.description}),this.bookingEvent.PRIVATE_NOTE&&i("ir-label",{containerStyle:{padding:"0",margin:"0"},class:"m-0 p-0",labelText:`${u.entries.Lcz_BookingPrivateNote}:`,display:"inline",content:this.bookingEvent.PRIVATE_NOTE}),this.bookingEvent.is_direct&&i("ir-label",{containerStyle:{padding:"0",margin:"0"},labelText:`${u.entries.Lcz_GuestRemark}:`,display:"inline",content:this.bookingEvent.NOTES}),i("ir-label",{containerStyle:{padding:"0",margin:"0"},labelText:`${u.entries.Lcz_ChannelNotes}:`,display:"inline",content:this.getOTANotes(),renderContentAsHtml:true}),this.getInternalNote()&&i("ir-label",{labelText:`${u.entries.Lcz_InternalRemark}:`,content:this.getInternalNote()}),i("div",{class:"row p-0 m-0 mt-2"},i("div",{class:"full-width d-flex align-items-center",style:{gap:"0.25rem"},role:"group"},i("ir-button",{style:{"--icon-size":"0.875rem"},onClickHandler:()=>this.handleEditBooking(),class:"w-100",btn_block:true,text:u.entries.Lcz_Edit,icon_name:"edit",btn_styles:"h-100",size:"sm"}),this.bookingEvent.is_direct&&this.bookingEvent.IS_EDITABLE&&!this.hideButtons&&i("ir-button",{style:{"--icon-size":"0.875rem"},text:u.entries.Lcz_AddRoom,icon_name:"square_plus",size:"sm",class:"w-100",btn_styles:"h-100",onClickHandler:()=>this.handleAddRoom()}),this.canCheckIn()&&i("ir-button",{class:"w-100",style:{"--icon-size":"0.875rem"},text:u.entries.Lcz_CheckIn,onClickHandler:()=>this.handleCustomerCheckIn(),icon_name:"edit",btn_styles:"h-100",size:"sm"}),this.canCheckOut()&&i("ir-button",{class:"w-100",btn_styles:"h-100",style:{"--icon-size":"0.875rem"},text:u.entries.Lcz_CheckOut,icon_name:"edit",onClickHandler:()=>this.handleCustomerCheckOut(),size:"sm"}),this.hideButtons?null:!this.shouldHideUnassignUnit&&i("ir-button",{class:"w-100",btn_styles:"h-100",style:{"--icon-size":"0.875rem"},size:"sm",text:u.entries.Lcz_Unassign,icon_name:"xmark",onClickHandler:t=>{this.handleDeleteEvent()}}))))}getNewBookingOptions(){const t=this.bookingEvent.roomsInfo[0].rateplans.some((t=>t.is_active));return i("div",{class:`iglPopOver d-flex flex-column newBookingOptions ${this.bubbleInfoTop?"bubbleInfoAbove":""} text-left`,style:{gap:"0.5rem"}},t?i(s,null,i("ir-button",{size:"sm",btn_block:true,"data-testid":"bar_booking_btn",text:u.entries.Lcz_CreateNewBooking,onClickHandler:t=>{this.handleBookingOption("BAR_BOOKING")}}),this.hasSplitBooking()&&i("ir-button",{size:"sm",btn_block:true,text:u.entries.Lcz_AssignUnitToExistingBooking,onClickHandler:t=>{this.handleBookingOption("SPLIT_BOOKING")}})):i("p",{class:"text-danger"},u.entries.Lcz_NoRatePlanDefined),i("ir-button",{size:"sm",text:u.entries.Lcz_Blockdates,btn_block:true,onClickHandler:t=>{this.handleBookingOption("BLOCK_DATES")}}))}getBlockedView(){console.log("booking event",this.bookingEvent);return i("div",{class:`iglPopOver blockedView ${this.bubbleInfoTop?"bubbleInfoAbove":""} text-left`},i("igl-block-dates-view",{isEventHover:true,entryHour:this.bookingEvent.ENTRY_HOUR,entryMinute:this.bookingEvent.ENTRY_MINUTE,defaultData:this.bookingEvent,fromDate:this.bookingEvent.defaultDates.from_date,toDate:this.bookingEvent.defaultDates.to_date,entryDate:this.getEntryDate(),onDataUpdateEvent:t=>this.handleBlockDateUpdate(t)}),i("div",{class:"row p-0 m-0 mt-2"},i("div",{class:"full-width d-flex align-items-center",style:{gap:"0.25rem"},role:"group"},i("ir-button",{btn_disabled:this.isLoading==="update",text:u.entries.Lcz_Update,onClickHandler:t=>{this.handleUpdateBlockedDates()},icon_name:"edit",size:"sm",btn_styles:"h-100",isLoading:this.isLoading==="update",style:{"--icon-size":"0.875rem"},btn_block:true,class:"w-100"}),i("ir-button",{class:"w-100 h-100 my-0",btn_block:true,btn_styles:"h-100",size:"sm",text:u.entries.Lcz_ConvertSplitBooking,onClickHandler:()=>{this.handleConvertBlockedDateToBooking()}}),i("ir-button",{class:"w-100",btn_styles:"h-100",btn_block:true,size:"sm",style:{"--icon-size":"0.875rem"},icon_name:"trash",btn_color:"danger",onClickHandler:t=>{this.handleDeleteEvent()},text:u.entries.Lcz_Delete}))))}render(){return i(n,{key:"71a3d2f8acaeca1e72096858f8993fce8fe594df"},i("div",{key:"ee2926fcf097b29de15739565af99cc7e355123d",class:`pointerContainer ${this.bubbleInfoTop?"pointerContainerTop":""}`},i("div",{key:"0cfe5ab88e99881959815276ba9afa23e5b5df6c",class:`bubblePointer ${this.bubbleInfoTop?"bubblePointTop":"bubblePointBottom"}`})),this.isBlockedDateEvent()?this.getBlockedView():null,this.isNewBooking()?this.getNewBookingOptions():null,!this.isBlockedDateEvent()&&!this.isNewBooking()?this.getInfoElement():null)}get element(){return o(this)}static get watchers(){return{bookingEvent:["handleBookingEventChange"]}}};v.style=p;export{v as igl_booking_event_hover};
//# sourceMappingURL=p-51bd351c.entry.js.map