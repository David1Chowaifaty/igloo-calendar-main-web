import{r as t,c as i,h as e,H as s,g as n}from"./p-ee49d535.js";import{R as o}from"./p-4bd413fa.js";import{B as r}from"./p-f93ca8fe.js";import{f as h,d as a,i as c,g as l,a as f,c as u,b as d}from"./p-e016a0cc.js";import{E as p}from"./p-1d75ffba.js";import{h as g}from"./p-6c4ba7c0.js";import{T as b}from"./p-cab2ff69.js";import{c as y,b as w,t as m,a as v,g as k,d as O}from"./p-08469bc4.js";import{l as D}from"./p-806fad31.js";import{c as E}from"./p-8e74896a.js";import{h as A,a as C,r as _}from"./p-8f37a731.js";import{T as j}from"./p-972be3f6.js";import"./p-06203439.js";import"./p-4eb12235.js";const T=Object.create(null);T["open"]="0";T["close"]="1";T["ping"]="2";T["pong"]="3";T["message"]="4";T["upgrade"]="5";T["noop"]="6";const N=Object.create(null);Object.keys(T).forEach((t=>{N[T[t]]=t}));const B={type:"error",data:"parser error"};const S=typeof Blob==="function"||typeof Blob!=="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]";const R=typeof ArrayBuffer==="function";const I=t=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer;const M=({type:t,data:i},e,s)=>{if(S&&i instanceof Blob){if(e){return s(i)}else{return L(i,s)}}else if(R&&(i instanceof ArrayBuffer||I(i))){if(e){return s(i)}else{return L(new Blob([i]),s)}}return s(T[t]+(i||""))};const L=(t,i)=>{const e=new FileReader;e.onload=function(){const t=e.result.split(",")[1];i("b"+(t||""))};return e.readAsDataURL(t)};function U(t){if(t instanceof Uint8Array){return t}else if(t instanceof ArrayBuffer){return new Uint8Array(t)}else{return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}}let x;function Y(t,i){if(S&&t.data instanceof Blob){return t.data.arrayBuffer().then(U).then(i)}else if(R&&(t.data instanceof ArrayBuffer||I(t.data))){return i(U(t.data))}M(t,false,(t=>{if(!x){x=new TextEncoder}i(x.encode(t))}))}const P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const H=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(let t=0;t<P.length;t++){H[P.charCodeAt(t)]=t}const G=t=>{let i=t.length*.75,e=t.length,s,n=0,o,r,h,a;if(t[t.length-1]==="="){i--;if(t[t.length-2]==="="){i--}}const c=new ArrayBuffer(i),l=new Uint8Array(c);for(s=0;s<e;s+=4){o=H[t.charCodeAt(s)];r=H[t.charCodeAt(s+1)];h=H[t.charCodeAt(s+2)];a=H[t.charCodeAt(s+3)];l[n++]=o<<2|r>>4;l[n++]=(r&15)<<4|h>>2;l[n++]=(h&3)<<6|a&63}return c};const V=typeof ArrayBuffer==="function";const F=(t,i)=>{if(typeof t!=="string"){return{type:"message",data:$(t,i)}}const e=t.charAt(0);if(e==="b"){return{type:"message",data:K(t.substring(1),i)}}const s=N[e];if(!s){return B}return t.length>1?{type:N[e],data:t.substring(1)}:{type:N[e]}};const K=(t,i)=>{if(V){const e=G(t);return $(e,i)}else{return{base64:true,data:t}}};const $=(t,i)=>{switch(i){case"blob":if(t instanceof Blob){return t}else{return new Blob([t])}case"arraybuffer":default:if(t instanceof ArrayBuffer){return t}else{return t.buffer}}};const J=String.fromCharCode(30);const W=(t,i)=>{const e=t.length;const s=new Array(e);let n=0;t.forEach(((t,o)=>{M(t,false,(t=>{s[o]=t;if(++n===e){i(s.join(J))}}))}))};const q=(t,i)=>{const e=t.split(J);const s=[];for(let t=0;t<e.length;t++){const n=F(e[t],i);s.push(n);if(n.type==="error"){break}}return s};function X(){return new TransformStream({transform(t,i){Y(t,(e=>{const s=e.length;let n;if(s<126){n=new Uint8Array(1);new DataView(n.buffer).setUint8(0,s)}else if(s<65536){n=new Uint8Array(3);const t=new DataView(n.buffer);t.setUint8(0,126);t.setUint16(1,s)}else{n=new Uint8Array(9);const t=new DataView(n.buffer);t.setUint8(0,127);t.setBigUint64(1,BigInt(s))}if(t.data&&typeof t.data!=="string"){n[0]|=128}i.enqueue(n);i.enqueue(e)}))}})}let z;function Q(t){return t.reduce(((t,i)=>t+i.length),0)}function Z(t,i){if(t[0].length===i){return t.shift()}const e=new Uint8Array(i);let s=0;for(let n=0;n<i;n++){e[n]=t[0][s++];if(s===t[0].length){t.shift();s=0}}if(t.length&&s<t[0].length){t[0]=t[0].slice(s)}return e}function tt(t,i){if(!z){z=new TextDecoder}const e=[];let s=0;let n=-1;let o=false;return new TransformStream({transform(r,h){e.push(r);while(true){if(s===0){if(Q(e)<1){break}const t=Z(e,1);o=(t[0]&128)===128;n=t[0]&127;if(n<126){s=3}else if(n===126){s=1}else{s=2}}else if(s===1){if(Q(e)<2){break}const t=Z(e,2);n=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0);s=3}else if(s===2){if(Q(e)<8){break}const t=Z(e,8);const i=new DataView(t.buffer,t.byteOffset,t.length);const o=i.getUint32(0);if(o>Math.pow(2,53-32)-1){h.enqueue(B);break}n=o*Math.pow(2,32)+i.getUint32(4);s=3}else{if(Q(e)<n){break}const t=Z(e,n);h.enqueue(F(o?t:z.decode(t),i));s=0}if(n===0||n>t){h.enqueue(B);break}}}})}const it=4;function et(t){if(t)return st(t)}function st(t){for(var i in et.prototype){t[i]=et.prototype[i]}return t}et.prototype.on=et.prototype.addEventListener=function(t,i){this._callbacks=this._callbacks||{};(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(i);return this};et.prototype.once=function(t,i){function e(){this.off(t,e);i.apply(this,arguments)}e.fn=i;this.on(t,e);return this};et.prototype.off=et.prototype.removeListener=et.prototype.removeAllListeners=et.prototype.removeEventListener=function(t,i){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var e=this._callbacks["$"+t];if(!e)return this;if(1==arguments.length){delete this._callbacks["$"+t];return this}var s;for(var n=0;n<e.length;n++){s=e[n];if(s===i||s.fn===i){e.splice(n,1);break}}if(e.length===0){delete this._callbacks["$"+t]}return this};et.prototype.emit=function(t){this._callbacks=this._callbacks||{};var i=new Array(arguments.length-1),e=this._callbacks["$"+t];for(var s=1;s<arguments.length;s++){i[s-1]=arguments[s]}if(e){e=e.slice(0);for(var s=0,n=e.length;s<n;++s){e[s].apply(this,i)}}return this};et.prototype.emitReserved=et.prototype.emit;et.prototype.listeners=function(t){this._callbacks=this._callbacks||{};return this._callbacks["$"+t]||[]};et.prototype.hasListeners=function(t){return!!this.listeners(t).length};const nt=(()=>{if(typeof self!=="undefined"){return self}else if(typeof window!=="undefined"){return window}else{return Function("return this")()}})();function ot(t,...i){return i.reduce(((i,e)=>{if(t.hasOwnProperty(e)){i[e]=t[e]}return i}),{})}const rt=nt.setTimeout;const ht=nt.clearTimeout;function at(t,i){if(i.useNativeTimers){t.setTimeoutFn=rt.bind(nt);t.clearTimeoutFn=ht.bind(nt)}else{t.setTimeoutFn=nt.setTimeout.bind(nt);t.clearTimeoutFn=nt.clearTimeout.bind(nt)}}const ct=1.33;function lt(t){if(typeof t==="string"){return ft(t)}return Math.ceil((t.byteLength||t.size)*ct)}function ft(t){let i=0,e=0;for(let s=0,n=t.length;s<n;s++){i=t.charCodeAt(s);if(i<128){e+=1}else if(i<2048){e+=2}else if(i<55296||i>=57344){e+=3}else{s++;e+=4}}return e}function ut(t){let i="";for(let e in t){if(t.hasOwnProperty(e)){if(i.length)i+="&";i+=encodeURIComponent(e)+"="+encodeURIComponent(t[e])}}return i}function dt(t){let i={};let e=t.split("&");for(let t=0,s=e.length;t<s;t++){let s=e[t].split("=");i[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return i}class pt extends Error{constructor(t,i,e){super(t);this.description=i;this.context=e;this.type="TransportError"}}class gt extends et{constructor(t){super();this.writable=false;at(this,t);this.opts=t;this.query=t.query;this.socket=t.socket}onError(t,i,e){super.emitReserved("error",new pt(t,i,e));return this}open(){this.readyState="opening";this.doOpen();return this}close(){if(this.readyState==="opening"||this.readyState==="open"){this.doClose();this.onClose()}return this}send(t){if(this.readyState==="open"){this.write(t)}}onOpen(){this.readyState="open";this.writable=true;super.emitReserved("open")}onData(t){const i=F(t,this.socket.binaryType);this.onPacket(i)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed";super.emitReserved("close",t)}pause(t){}createUri(t,i={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){if(this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)){return":"+this.opts.port}else{return""}}_query(t){const i=ut(t);return i.length?"?"+i:""}}const bt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),yt=64,wt={};let mt=0,vt=0,kt;function Ot(t){let i="";do{i=bt[t%yt]+i;t=Math.floor(t/yt)}while(t>0);return i}function Dt(){const t=Ot(+new Date);if(t!==kt)return mt=0,kt=t;return t+"."+Ot(mt++)}for(;vt<yt;vt++)wt[bt[vt]]=vt;let Et=false;try{Et=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(t){}const At=Et;function Ct(t){const i=t.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!i||At)){return new XMLHttpRequest}}catch(t){}if(!i){try{return new(nt[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}}function _t(){}function jt(){}const Tt=function(){const t=new Ct({xdomain:false});return null!=t.responseType}();class Nt extends gt{constructor(t){super(t);this.polling=false;if(typeof location!=="undefined"){const i="https:"===location.protocol;let e=location.port;if(!e){e=i?"443":"80"}this.xd=typeof location!=="undefined"&&t.hostname!==location.hostname||e!==t.port}const i=t&&t.forceBase64;this.supportsBinary=Tt&&!i;if(this.opts.withCredentials){this.cookieJar=_t()}}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const i=()=>{this.readyState="paused";t()};if(this.polling||!this.writable){let t=0;if(this.polling){t++;this.once("pollComplete",(function(){--t||i()}))}if(!this.writable){t++;this.once("drain",(function(){--t||i()}))}}else{i()}}poll(){this.polling=true;this.doPoll();this.emitReserved("poll")}onData(t){const i=t=>{if("opening"===this.readyState&&t.type==="open"){this.onOpen()}if("close"===t.type){this.onClose({description:"transport closed by the server"});return false}this.onPacket(t)};q(t,this.socket.binaryType).forEach(i);if("closed"!==this.readyState){this.polling=false;this.emitReserved("pollComplete");if("open"===this.readyState){this.poll()}}}doClose(){const t=()=>{this.write([{type:"close"}])};if("open"===this.readyState){t()}else{this.once("open",t)}}write(t){this.writable=false;W(t,(t=>{this.doWrite(t,(()=>{this.writable=true;this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http";const i=this.query||{};if(false!==this.opts.timestampRequests){i[this.opts.timestampParam]=Dt()}if(!this.supportsBinary&&!i.sid){i.b64=1}return this.createUri(t,i)}request(t={}){Object.assign(t,{xd:this.xd,cookieJar:this.cookieJar},this.opts);return new Bt(this.uri(),t)}doWrite(t,i){const e=this.request({method:"POST",data:t});e.on("success",i);e.on("error",((t,i)=>{this.onError("xhr post error",t,i)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this));t.on("error",((t,i)=>{this.onError("xhr poll error",t,i)}));this.pollXhr=t}}class Bt extends et{constructor(t,i){super();at(this,i);this.opts=i;this.method=i.method||"GET";this.uri=t;this.data=undefined!==i.data?i.data:null;this.create()}create(){var t;const i=ot(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const e=this.xhr=new Ct(i);try{e.open(this.method,this.uri,true);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(true);for(let t in this.opts.extraHeaders){if(this.opts.extraHeaders.hasOwnProperty(t)){e.setRequestHeader(t,this.opts.extraHeaders[t])}}}}catch(t){}if("POST"===this.method){try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}}try{e.setRequestHeader("Accept","*/*")}catch(t){}(t=this.opts.cookieJar)===null||t===void 0?void 0:t.addCookies(e);if("withCredentials"in e){e.withCredentials=this.opts.withCredentials}if(this.opts.requestTimeout){e.timeout=this.opts.requestTimeout}e.onreadystatechange=()=>{var t;if(e.readyState===3){(t=this.opts.cookieJar)===null||t===void 0?void 0:t.parseCookies(e)}if(4!==e.readyState)return;if(200===e.status||1223===e.status){this.onLoad()}else{this.setTimeoutFn((()=>{this.onError(typeof e.status==="number"?e.status:0)}),0)}};e.send(this.data)}catch(t){this.setTimeoutFn((()=>{this.onError(t)}),0);return}if(typeof document!=="undefined"){this.index=Bt.requestsCount++;Bt.requests[this.index]=this}}onError(t){this.emitReserved("error",t,this.xhr);this.cleanup(true)}cleanup(t){if("undefined"===typeof this.xhr||null===this.xhr){return}this.xhr.onreadystatechange=jt;if(t){try{this.xhr.abort()}catch(t){}}if(typeof document!=="undefined"){delete Bt.requests[this.index]}this.xhr=null}onLoad(){const t=this.xhr.responseText;if(t!==null){this.emitReserved("data",t);this.emitReserved("success");this.cleanup()}}abort(){this.cleanup()}}Bt.requestsCount=0;Bt.requests={};if(typeof document!=="undefined"){if(typeof attachEvent==="function"){attachEvent("onunload",St)}else if(typeof addEventListener==="function"){const t="onpagehide"in nt?"pagehide":"unload";addEventListener(t,St,false)}}function St(){for(let t in Bt.requests){if(Bt.requests.hasOwnProperty(t)){Bt.requests[t].abort()}}}const Rt=(()=>{const t=typeof Promise==="function"&&typeof Promise.resolve==="function";if(t){return t=>Promise.resolve().then(t)}else{return(t,i)=>i(t,0)}})();const It=nt.WebSocket||nt.MozWebSocket;const Mt="arraybuffer";const Lt=typeof navigator!=="undefined"&&typeof navigator.product==="string"&&navigator.product.toLowerCase()==="reactnative";class Ut extends gt{constructor(t){super(t);this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check()){return}const t=this.uri();const i=this.opts.protocols;const e=Lt?{}:ot(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");if(this.opts.extraHeaders){e.headers=this.opts.extraHeaders}try{this.ws=!Lt?i?new It(t,i):new It(t):new It(t,i,e)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType;this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{if(this.opts.autoUnref){this.ws._socket.unref()}this.onOpen()};this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t});this.ws.onmessage=t=>this.onData(t.data);this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=false;for(let i=0;i<t.length;i++){const e=t[i];const s=i===t.length-1;M(e,this.supportsBinary,(t=>{try{{this.ws.send(t)}}catch(t){}if(s){Rt((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){if(typeof this.ws!=="undefined"){this.ws.close();this.ws=null}}uri(){const t=this.opts.secure?"wss":"ws";const i=this.query||{};if(this.opts.timestampRequests){i[this.opts.timestampParam]=Dt()}if(!this.supportsBinary){i.b64=1}return this.createUri(t,i)}check(){return!!It}}class xt extends gt{get name(){return"webtransport"}doOpen(){if(typeof WebTransport!=="function"){return}this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]);this.transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)}));this.transport.ready.then((()=>{this.transport.createBidirectionalStream().then((t=>{const i=tt(Number.MAX_SAFE_INTEGER,this.socket.binaryType);const e=t.readable.pipeThrough(i).getReader();const s=X();s.readable.pipeTo(t.writable);this.writer=s.writable.getWriter();const n=()=>{e.read().then((({done:t,value:i})=>{if(t){return}this.onPacket(i);n()})).catch((t=>{}))};n();const o={type:"open"};if(this.query.sid){o.data=`{"sid":"${this.query.sid}"}`}this.writer.write(o).then((()=>this.onOpen()))}))}))}write(t){this.writable=false;for(let i=0;i<t.length;i++){const e=t[i];const s=i===t.length-1;this.writer.write(e).then((()=>{if(s){Rt((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){var t;(t=this.transport)===null||t===void 0?void 0:t.close()}}const Yt={websocket:Ut,webtransport:xt,polling:Nt};const Pt=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;const Ht=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Gt(t){if(t.length>2e3){throw"URI too long"}const i=t,e=t.indexOf("["),s=t.indexOf("]");if(e!=-1&&s!=-1){t=t.substring(0,e)+t.substring(e,s).replace(/:/g,";")+t.substring(s,t.length)}let n=Pt.exec(t||""),o={},r=14;while(r--){o[Ht[r]]=n[r]||""}if(e!=-1&&s!=-1){o.source=i;o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":");o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":");o.ipv6uri=true}o.pathNames=Vt(o,o["path"]);o.queryKey=Ft(o,o["query"]);return o}function Vt(t,i){const e=/\/{2,9}/g,s=i.replace(e,"/").split("/");if(i.slice(0,1)=="/"||i.length===0){s.splice(0,1)}if(i.slice(-1)=="/"){s.splice(s.length-1,1)}return s}function Ft(t,i){const e={};i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,i,s){if(i){e[i]=s}}));return e}class Kt extends et{constructor(t,i={}){super();this.binaryType=Mt;this.writeBuffer=[];if(t&&"object"===typeof t){i=t;t=null}if(t){t=Gt(t);i.hostname=t.host;i.secure=t.protocol==="https"||t.protocol==="wss";i.port=t.port;if(t.query)i.query=t.query}else if(i.host){i.hostname=Gt(i.host).host}at(this,i);this.secure=null!=i.secure?i.secure:typeof location!=="undefined"&&"https:"===location.protocol;if(i.hostname&&!i.port){i.port=this.secure?"443":"80"}this.hostname=i.hostname||(typeof location!=="undefined"?location.hostname:"localhost");this.port=i.port||(typeof location!=="undefined"&&location.port?location.port:this.secure?"443":"80");this.transports=i.transports||["polling","websocket","webtransport"];this.writeBuffer=[];this.prevBufferLen=0;this.opts=Object.assign({path:"/engine.io",agent:false,withCredentials:false,upgrade:true,timestampParam:"t",rememberUpgrade:false,addTrailingSlash:true,rejectUnauthorized:true,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:false},i);this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":"");if(typeof this.opts.query==="string"){this.opts.query=dt(this.opts.query)}this.id=null;this.upgrades=null;this.pingInterval=null;this.pingTimeout=null;this.pingTimeoutTimer=null;if(typeof addEventListener==="function"){if(this.opts.closeOnBeforeunload){this.beforeunloadEventListener=()=>{if(this.transport){this.transport.removeAllListeners();this.transport.close()}};addEventListener("beforeunload",this.beforeunloadEventListener,false)}if(this.hostname!=="localhost"){this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})};addEventListener("offline",this.offlineEventListener,false)}}this.open()}createTransport(t){const i=Object.assign({},this.opts.query);i.EIO=it;i.transport=t;if(this.id)i.sid=this.id;const e=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new Yt[t](e)}open(){let t;if(this.opts.rememberUpgrade&&Kt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1){t="websocket"}else if(0===this.transports.length){this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);return}else{t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){this.transports.shift();this.open();return}t.open();this.setTransport(t)}setTransport(t){if(this.transport){this.transport.removeAllListeners()}this.transport=t;t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let i=this.createTransport(t);let e=false;Kt.priorWebsocketSuccess=false;const s=()=>{if(e)return;i.send([{type:"ping",data:"probe"}]);i.once("packet",(t=>{if(e)return;if("pong"===t.type&&"probe"===t.data){this.upgrading=true;this.emitReserved("upgrading",i);if(!i)return;Kt.priorWebsocketSuccess="websocket"===i.name;this.transport.pause((()=>{if(e)return;if("closed"===this.readyState)return;c();this.setTransport(i);i.send([{type:"upgrade"}]);this.emitReserved("upgrade",i);i=null;this.upgrading=false;this.flush()}))}else{const t=new Error("probe error");t.transport=i.name;this.emitReserved("upgradeError",t)}}))};function n(){if(e)return;e=true;c();i.close();i=null}const o=t=>{const e=new Error("probe error: "+t);e.transport=i.name;n();this.emitReserved("upgradeError",e)};function r(){o("transport closed")}function h(){o("socket closed")}function a(t){if(i&&t.name!==i.name){n()}}const c=()=>{i.removeListener("open",s);i.removeListener("error",o);i.removeListener("close",r);this.off("close",h);this.off("upgrading",a)};i.once("open",s);i.once("error",o);i.once("close",r);this.once("close",h);this.once("upgrading",a);if(this.upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"){this.setTimeoutFn((()=>{if(!e){i.open()}}),200)}else{i.open()}}onOpen(){this.readyState="open";Kt.priorWebsocketSuccess="websocket"===this.transport.name;this.emitReserved("open");this.flush();if("open"===this.readyState&&this.opts.upgrade){let t=0;const i=this.upgrades.length;for(;t<i;t++){this.probe(this.upgrades[t])}}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.emitReserved("packet",t);this.emitReserved("heartbeat");this.resetPingTimeout();switch(t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.sendPacket("pong");this.emitReserved("ping");this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=t.data;this.onError(i);break;case"message":this.emitReserved("data",t.data);this.emitReserved("message",t.data);break}}}onHandshake(t){this.emitReserved("handshake",t);this.id=t.sid;this.transport.query.sid=t.sid;this.upgrades=this.filterUpgrades(t.upgrades);this.pingInterval=t.pingInterval;this.pingTimeout=t.pingTimeout;this.maxPayload=t.maxPayload;this.onOpen();if("closed"===this.readyState)return;this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer);this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout);if(this.opts.autoUnref){this.pingTimeoutTimer.unref()}}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(0===this.writeBuffer.length){this.emitReserved("drain")}else{this.flush()}}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t);this.prevBufferLen=t.length;this.emitReserved("flush")}}getWritablePackets(){const t=this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1;if(!t){return this.writeBuffer}let i=1;for(let t=0;t<this.writeBuffer.length;t++){const e=this.writeBuffer[t].data;if(e){i+=lt(e)}if(t>0&&i>this.maxPayload){return this.writeBuffer.slice(0,t)}i+=2}return this.writeBuffer}write(t,i,e){this.sendPacket("message",t,i,e);return this}send(t,i,e){this.sendPacket("message",t,i,e);return this}sendPacket(t,i,e,s){if("function"===typeof i){s=i;i=undefined}if("function"===typeof e){s=e;e=null}if("closing"===this.readyState||"closed"===this.readyState){return}e=e||{};e.compress=false!==e.compress;const n={type:t,data:i,options:e};this.emitReserved("packetCreate",n);this.writeBuffer.push(n);if(s)this.once("flush",s);this.flush()}close(){const t=()=>{this.onClose("forced close");this.transport.close()};const i=()=>{this.off("upgrade",i);this.off("upgradeError",i);t()};const e=()=>{this.once("upgrade",i);this.once("upgradeError",i)};if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";if(this.writeBuffer.length){this.once("drain",(()=>{if(this.upgrading){e()}else{t()}}))}else if(this.upgrading){e()}else{t()}}return this}onError(t){Kt.priorWebsocketSuccess=false;this.emitReserved("error",t);this.onClose("transport error",t)}onClose(t,i){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.clearTimeoutFn(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();if(typeof removeEventListener==="function"){removeEventListener("beforeunload",this.beforeunloadEventListener,false);removeEventListener("offline",this.offlineEventListener,false)}this.readyState="closed";this.id=null;this.emitReserved("close",t,i);this.writeBuffer=[];this.prevBufferLen=0}}filterUpgrades(t){const i=[];let e=0;const s=t.length;for(;e<s;e++){if(~this.transports.indexOf(t[e]))i.push(t[e])}return i}}Kt.protocol=it;function $t(t,i="",e){let s=t;e=e||typeof location!=="undefined"&&location;if(null==t)t=e.protocol+"//"+e.host;if(typeof t==="string"){if("/"===t.charAt(0)){if("/"===t.charAt(1)){t=e.protocol+t}else{t=e.host+t}}if(!/^(https?|wss?):\/\//.test(t)){if("undefined"!==typeof e){t=e.protocol+"//"+t}else{t="https://"+t}}s=Gt(t)}if(!s.port){if(/^(http|ws)$/.test(s.protocol)){s.port="80"}else if(/^(http|ws)s$/.test(s.protocol)){s.port="443"}}s.path=s.path||"/";const n=s.host.indexOf(":")!==-1;const o=n?"["+s.host+"]":s.host;s.id=s.protocol+"://"+o+":"+s.port+i;s.href=s.protocol+"://"+o+(e&&e.port===s.port?"":":"+s.port);return s}const Jt=typeof ArrayBuffer==="function";const Wt=t=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer;const qt=Object.prototype.toString;const Xt=typeof Blob==="function"||typeof Blob!=="undefined"&&qt.call(Blob)==="[object BlobConstructor]";const zt=typeof File==="function"||typeof File!=="undefined"&&qt.call(File)==="[object FileConstructor]";function Qt(t){return Jt&&(t instanceof ArrayBuffer||Wt(t))||Xt&&t instanceof Blob||zt&&t instanceof File}function Zt(t,i){if(!t||typeof t!=="object"){return false}if(Array.isArray(t)){for(let i=0,e=t.length;i<e;i++){if(Zt(t[i])){return true}}return false}if(Qt(t)){return true}if(t.toJSON&&typeof t.toJSON==="function"&&arguments.length===1){return Zt(t.toJSON(),true)}for(const i in t){if(Object.prototype.hasOwnProperty.call(t,i)&&Zt(t[i])){return true}}return false}function ti(t){const i=[];const e=t.data;const s=t;s.data=ii(e,i);s.attachments=i.length;return{packet:s,buffers:i}}function ii(t,i){if(!t)return t;if(Qt(t)){const e={_placeholder:true,num:i.length};i.push(t);return e}else if(Array.isArray(t)){const e=new Array(t.length);for(let s=0;s<t.length;s++){e[s]=ii(t[s],i)}return e}else if(typeof t==="object"&&!(t instanceof Date)){const e={};for(const s in t){if(Object.prototype.hasOwnProperty.call(t,s)){e[s]=ii(t[s],i)}}return e}return t}function ei(t,i){t.data=si(t.data,i);delete t.attachments;return t}function si(t,i){if(!t)return t;if(t&&t._placeholder===true){const e=typeof t.num==="number"&&t.num>=0&&t.num<i.length;if(e){return i[t.num]}else{throw new Error("illegal attachments")}}else if(Array.isArray(t)){for(let e=0;e<t.length;e++){t[e]=si(t[e],i)}}else if(typeof t==="object"){for(const e in t){if(Object.prototype.hasOwnProperty.call(t,e)){t[e]=si(t[e],i)}}}return t}const ni=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];const oi=5;var ri;(function(t){t[t["CONNECT"]=0]="CONNECT";t[t["DISCONNECT"]=1]="DISCONNECT";t[t["EVENT"]=2]="EVENT";t[t["ACK"]=3]="ACK";t[t["CONNECT_ERROR"]=4]="CONNECT_ERROR";t[t["BINARY_EVENT"]=5]="BINARY_EVENT";t[t["BINARY_ACK"]=6]="BINARY_ACK"})(ri||(ri={}));class hi{constructor(t){this.replacer=t}encode(t){if(t.type===ri.EVENT||t.type===ri.ACK){if(Zt(t)){return this.encodeAsBinary({type:t.type===ri.EVENT?ri.BINARY_EVENT:ri.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}}return[this.encodeAsString(t)]}encodeAsString(t){let i=""+t.type;if(t.type===ri.BINARY_EVENT||t.type===ri.BINARY_ACK){i+=t.attachments+"-"}if(t.nsp&&"/"!==t.nsp){i+=t.nsp+","}if(null!=t.id){i+=t.id}if(null!=t.data){i+=JSON.stringify(t.data,this.replacer)}return i}encodeAsBinary(t){const i=ti(t);const e=this.encodeAsString(i.packet);const s=i.buffers;s.unshift(e);return s}}function ai(t){return Object.prototype.toString.call(t)==="[object Object]"}class ci extends et{constructor(t){super();this.reviver=t}add(t){let i;if(typeof t==="string"){if(this.reconstructor){throw new Error("got plaintext data when reconstructing a packet")}i=this.decodeString(t);const e=i.type===ri.BINARY_EVENT;if(e||i.type===ri.BINARY_ACK){i.type=e?ri.EVENT:ri.ACK;this.reconstructor=new li(i);if(i.attachments===0){super.emitReserved("decoded",i)}}else{super.emitReserved("decoded",i)}}else if(Qt(t)||t.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{i=this.reconstructor.takeBinaryData(t);if(i){this.reconstructor=null;super.emitReserved("decoded",i)}}}else{throw new Error("Unknown type: "+t)}}decodeString(t){let i=0;const e={type:Number(t.charAt(0))};if(ri[e.type]===undefined){throw new Error("unknown packet type "+e.type)}if(e.type===ri.BINARY_EVENT||e.type===ri.BINARY_ACK){const s=i+1;while(t.charAt(++i)!=="-"&&i!=t.length){}const n=t.substring(s,i);if(n!=Number(n)||t.charAt(i)!=="-"){throw new Error("Illegal attachments")}e.attachments=Number(n)}if("/"===t.charAt(i+1)){const s=i+1;while(++i){const e=t.charAt(i);if(","===e)break;if(i===t.length)break}e.nsp=t.substring(s,i)}else{e.nsp="/"}const s=t.charAt(i+1);if(""!==s&&Number(s)==s){const s=i+1;while(++i){const e=t.charAt(i);if(null==e||Number(e)!=e){--i;break}if(i===t.length)break}e.id=Number(t.substring(s,i+1))}if(t.charAt(++i)){const s=this.tryParse(t.substr(i));if(ci.isPayloadValid(e.type,s)){e.data=s}else{throw new Error("invalid payload")}}return e}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return false}}static isPayloadValid(t,i){switch(t){case ri.CONNECT:return ai(i);case ri.DISCONNECT:return i===undefined;case ri.CONNECT_ERROR:return typeof i==="string"||ai(i);case ri.EVENT:case ri.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]==="number"||typeof i[0]==="string"&&ni.indexOf(i[0])===-1);case ri.ACK:case ri.BINARY_ACK:return Array.isArray(i)}}destroy(){if(this.reconstructor){this.reconstructor.finishedReconstruction();this.reconstructor=null}}}class li{constructor(t){this.packet=t;this.buffers=[];this.reconPack=t}takeBinaryData(t){this.buffers.push(t);if(this.buffers.length===this.reconPack.attachments){const t=ei(this.reconPack,this.buffers);this.finishedReconstruction();return t}return null}finishedReconstruction(){this.reconPack=null;this.buffers=[]}}const fi=Object.freeze({__proto__:null,protocol:oi,get PacketType(){return ri},Encoder:hi,Decoder:ci});function ui(t,i,e){t.on(i,e);return function s(){t.off(i,e)}}const di=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class pi extends et{constructor(t,i,e){super();this.connected=false;this.recovered=false;this.receiveBuffer=[];this.sendBuffer=[];this._queue=[];this._queueSeq=0;this.ids=0;this.acks={};this.flags={};this.io=t;this.nsp=i;if(e&&e.auth){this.auth=e.auth}this._opts=Object.assign({},e);if(this.io._autoConnect)this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ui(t,"open",this.onopen.bind(this)),ui(t,"packet",this.onpacket.bind(this)),ui(t,"error",this.onerror.bind(this)),ui(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){if(this.connected)return this;this.subEvents();if(!this.io["_reconnecting"])this.io.open();if("open"===this.io._readyState)this.onopen();return this}open(){return this.connect()}send(...t){t.unshift("message");this.emit.apply(this,t);return this}emit(t,...i){if(di.hasOwnProperty(t)){throw new Error('"'+t.toString()+'" is a reserved event name')}i.unshift(t);if(this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile){this._addToQueue(i);return this}const e={type:ri.EVENT,data:i};e.options={};e.options.compress=this.flags.compress!==false;if("function"===typeof i[i.length-1]){const t=this.ids++;const s=i.pop();this._registerAckCallback(t,s);e.id=t}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;const n=this.flags.volatile&&(!s||!this.connected);if(n);else if(this.connected){this.notifyOutgoingListeners(e);this.packet(e)}else{this.sendBuffer.push(e)}this.flags={};return this}_registerAckCallback(t,i){var e;const s=(e=this.flags.timeout)!==null&&e!==void 0?e:this._opts.ackTimeout;if(s===undefined){this.acks[t]=i;return}const n=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let i=0;i<this.sendBuffer.length;i++){if(this.sendBuffer[i].id===t){this.sendBuffer.splice(i,1)}}i.call(this,new Error("operation has timed out"))}),s);const o=(...t)=>{this.io.clearTimeoutFn(n);i.apply(this,t)};o.withError=true;this.acks[t]=o}emitWithAck(t,...i){return new Promise(((e,s)=>{const n=(t,i)=>t?s(t):e(i);n.withError=true;i.push(n);this.emit(t,...i)}))}_addToQueue(t){let i;if(typeof t[t.length-1]==="function"){i=t.pop()}const e={id:this._queueSeq++,tryCount:0,pending:false,args:t,flags:Object.assign({fromQueue:true},this.flags)};t.push(((t,...s)=>{if(e!==this._queue[0]){return}const n=t!==null;if(n){if(e.tryCount>this._opts.retries){this._queue.shift();if(i){i(t)}}}else{this._queue.shift();if(i){i(null,...s)}}e.pending=false;return this._drainQueue()}));this._queue.push(e);this._drainQueue()}_drainQueue(t=false){if(!this.connected||this._queue.length===0){return}const i=this._queue[0];if(i.pending&&!t){return}i.pending=true;i.tryCount++;this.flags=i.flags;this.emit.apply(this,i.args)}packet(t){t.nsp=this.nsp;this.io._packet(t)}onopen(){if(typeof this.auth=="function"){this.auth((t=>{this._sendConnectPacket(t)}))}else{this._sendConnectPacket(this.auth)}}_sendConnectPacket(t){this.packet({type:ri.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){if(!this.connected){this.emitReserved("connect_error",t)}}onclose(t,i){this.connected=false;delete this.id;this.emitReserved("disconnect",t,i);this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{const i=this.sendBuffer.some((i=>String(i.id)===t));if(!i){const i=this.acks[t];delete this.acks[t];if(i.withError){i.call(this,new Error("socket has been disconnected"))}}}))}onpacket(t){const i=t.nsp===this.nsp;if(!i)return;switch(t.type){case ri.CONNECT:if(t.data&&t.data.sid){this.onconnect(t.data.sid,t.data.pid)}else{this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"))}break;case ri.EVENT:case ri.BINARY_EVENT:this.onevent(t);break;case ri.ACK:case ri.BINARY_ACK:this.onack(t);break;case ri.DISCONNECT:this.ondisconnect();break;case ri.CONNECT_ERROR:this.destroy();const i=new Error(t.data.message);i.data=t.data.data;this.emitReserved("connect_error",i);break}}onevent(t){const i=t.data||[];if(null!=t.id){i.push(this.ack(t.id))}if(this.connected){this.emitEvent(i)}else{this.receiveBuffer.push(Object.freeze(i))}}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const e of i){e.apply(this,t)}}super.emit.apply(this,t);if(this._pid&&t.length&&typeof t[t.length-1]==="string"){this._lastOffset=t[t.length-1]}}ack(t){const i=this;let e=false;return function(...s){if(e)return;e=true;i.packet({type:ri.ACK,id:t,data:s})}}onack(t){const i=this.acks[t.id];if(typeof i!=="function"){return}delete this.acks[t.id];if(i.withError){t.data.unshift(null)}i.apply(this,t.data)}onconnect(t,i){this.id=t;this.recovered=i&&this._pid===i;this._pid=i;this.connected=true;this.emitBuffered();this.emitReserved("connect");this._drainQueue(true)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t)));this.receiveBuffer=[];this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t);this.packet(t)}));this.sendBuffer=[]}ondisconnect(){this.destroy();this.onclose("io server disconnect")}destroy(){if(this.subs){this.subs.forEach((t=>t()));this.subs=undefined}this.io["_destroy"](this)}disconnect(){if(this.connected){this.packet({type:ri.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}close(){return this.disconnect()}compress(t){this.flags.compress=t;return this}get volatile(){this.flags.volatile=true;return this}timeout(t){this.flags.timeout=t;return this}onAny(t){this._anyListeners=this._anyListeners||[];this._anyListeners.push(t);return this}prependAny(t){this._anyListeners=this._anyListeners||[];this._anyListeners.unshift(t);return this}offAny(t){if(!this._anyListeners){return this}if(t){const i=this._anyListeners;for(let e=0;e<i.length;e++){if(t===i[e]){i.splice(e,1);return this}}}else{this._anyListeners=[]}return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.push(t);return this}prependAnyOutgoing(t){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.unshift(t);return this}offAnyOutgoing(t){if(!this._anyOutgoingListeners){return this}if(t){const i=this._anyOutgoingListeners;for(let e=0;e<i.length;e++){if(t===i[e]){i.splice(e,1);return this}}}else{this._anyOutgoingListeners=[]}return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const e of i){e.apply(this,t.data)}}}}function gi(t){t=t||{};this.ms=t.min||100;this.max=t.max||1e4;this.factor=t.factor||2;this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0;this.attempts=0}gi.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random();var e=Math.floor(i*this.jitter*t);t=(Math.floor(i*10)&1)==0?t-e:t+e}return Math.min(t,this.max)|0};gi.prototype.reset=function(){this.attempts=0};gi.prototype.setMin=function(t){this.ms=t};gi.prototype.setMax=function(t){this.max=t};gi.prototype.setJitter=function(t){this.jitter=t};class bi extends et{constructor(t,i){var e;super();this.nsps={};this.subs=[];if(t&&"object"===typeof t){i=t;t=undefined}i=i||{};i.path=i.path||"/socket.io";this.opts=i;at(this,i);this.reconnection(i.reconnection!==false);this.reconnectionAttempts(i.reconnectionAttempts||Infinity);this.reconnectionDelay(i.reconnectionDelay||1e3);this.reconnectionDelayMax(i.reconnectionDelayMax||5e3);this.randomizationFactor((e=i.randomizationFactor)!==null&&e!==void 0?e:.5);this.backoff=new gi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==i.timeout?2e4:i.timeout);this._readyState="closed";this.uri=t;const s=i.parser||fi;this.encoder=new s.Encoder;this.decoder=new s.Decoder;this._autoConnect=i.autoConnect!==false;if(this._autoConnect)this.open()}reconnection(t){if(!arguments.length)return this._reconnection;this._reconnection=!!t;return this}reconnectionAttempts(t){if(t===undefined)return this._reconnectionAttempts;this._reconnectionAttempts=t;return this}reconnectionDelay(t){var i;if(t===undefined)return this._reconnectionDelay;this._reconnectionDelay=t;(i=this.backoff)===null||i===void 0?void 0:i.setMin(t);return this}randomizationFactor(t){var i;if(t===undefined)return this._randomizationFactor;this._randomizationFactor=t;(i=this.backoff)===null||i===void 0?void 0:i.setJitter(t);return this}reconnectionDelayMax(t){var i;if(t===undefined)return this._reconnectionDelayMax;this._reconnectionDelayMax=t;(i=this.backoff)===null||i===void 0?void 0:i.setMax(t);return this}timeout(t){if(!arguments.length)return this._timeout;this._timeout=t;return this}maybeReconnectOnOpen(){if(!this._reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Kt(this.uri,this.opts);const i=this.engine;const e=this;this._readyState="opening";this.skipReconnect=false;const s=ui(i,"open",(function(){e.onopen();t&&t()}));const n=i=>{this.cleanup();this._readyState="closed";this.emitReserved("error",i);if(t){t(i)}else{this.maybeReconnectOnOpen()}};const o=ui(i,"error",n);if(false!==this._timeout){const t=this._timeout;const e=this.setTimeoutFn((()=>{s();n(new Error("timeout"));i.close()}),t);if(this.opts.autoUnref){e.unref()}this.subs.push((()=>{this.clearTimeoutFn(e)}))}this.subs.push(s);this.subs.push(o);return this}connect(t){return this.open(t)}onopen(){this.cleanup();this._readyState="open";this.emitReserved("open");const t=this.engine;this.subs.push(ui(t,"ping",this.onping.bind(this)),ui(t,"data",this.ondata.bind(this)),ui(t,"error",this.onerror.bind(this)),ui(t,"close",this.onclose.bind(this)),ui(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){Rt((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,i){let e=this.nsps[t];if(!e){e=new pi(this,t,i);this.nsps[t]=e}else if(this._autoConnect&&!e.active){e.connect()}return e}_destroy(t){const i=Object.keys(this.nsps);for(const t of i){const i=this.nsps[t];if(i.active){return}}this._close()}_packet(t){const i=this.encoder.encode(t);for(let e=0;e<i.length;e++){this.engine.write(i[e],t.options)}}cleanup(){this.subs.forEach((t=>t()));this.subs.length=0;this.decoder.destroy()}_close(){this.skipReconnect=true;this._reconnecting=false;this.onclose("forced close");if(this.engine)this.engine.close()}disconnect(){return this._close()}onclose(t,i){this.cleanup();this.backoff.reset();this._readyState="closed";this.emitReserved("close",t,i);if(this._reconnection&&!this.skipReconnect){this.reconnect()}}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts){this.backoff.reset();this.emitReserved("reconnect_failed");this._reconnecting=false}else{const i=this.backoff.duration();this._reconnecting=true;const e=this.setTimeoutFn((()=>{if(t.skipReconnect)return;this.emitReserved("reconnect_attempt",t.backoff.attempts);if(t.skipReconnect)return;t.open((i=>{if(i){t._reconnecting=false;t.reconnect();this.emitReserved("reconnect_error",i)}else{t.onreconnect()}}))}),i);if(this.opts.autoUnref){e.unref()}this.subs.push((()=>{this.clearTimeoutFn(e)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=false;this.backoff.reset();this.emitReserved("reconnect",t)}}const yi={};function wi(t,i){if(typeof t==="object"){i=t;t=undefined}i=i||{};const e=$t(t,i.path||"/socket.io");const s=e.source;const n=e.id;const o=e.path;const r=yi[n]&&o in yi[n]["nsps"];const h=i.forceNew||i["force new connection"]||false===i.multiplex||r;let a;if(h){a=new bi(s,i)}else{if(!yi[n]){yi[n]=new bi(s,i)}a=yi[n]}if(e.query&&!i.query){i.query=e.queryKey}return a.socket(e.path,i)}Object.assign(wi,{Manager:bi,Socket:pi,io:wi,connect:wi});const mi=".sc-igloo-calendar-h{display:block;position:relative;background-color:#ffffff;height:100%;text-align:center}.igl-calendar.sc-igloo-calendar{display:grid;grid-template-columns:1fr;height:100%}.calendarScrollContainer.sc-igloo-calendar{width:100%;height:100%;overflow:auto;position:relative;white-space:nowrap;border-left:2px solid grey}.showToBeAssigned.sc-igloo-calendar,.showLegend.sc-igloo-calendar{grid-template-columns:330px 1fr}#calendarContainer.sc-igloo-calendar{position:absolute}.legendContainer.sc-igloo-calendar,.tobeAssignedContainer.sc-igloo-calendar{display:none;height:100%;overflow-y:auto;padding-left:0.5em !important;padding-right:0.5em !important}.showToBeAssigned.sc-igloo-calendar .tobeAssignedContainer.sc-igloo-calendar{display:block}.showLegend.sc-igloo-calendar .legendContainer.sc-igloo-calendar{display:block}.tobeBooked.sc-igloo-calendar{padding-top:8px;padding-bottom:8px;text-align:left}";const vi=mi;const ki=class{constructor(e){t(this,e);this.dragOverHighlightElement=i(this,"dragOverHighlightElement",7);this.moveBookingTo=i(this,"moveBookingTo",7);this.calculateUnassignedDates=i(this,"calculateUnassignedDates",7);this.reduceAvailableUnitEvent=i(this,"reduceAvailableUnitEvent",7);this.revertBooking=i(this,"revertBooking",7);this.bookingService=new r;this.roomService=new o;this.eventsService=new p;this.toBeAssignedService=new b;this.countryNodeList=[];this.visibleCalendarCells={x:[],y:[]};this.today="";this.reachedEndOfCalendar=false;this.token=new j;this.scrollViewDragPos={top:0,left:0,x:0,y:0};this.onScrollContentMoveHandler=t=>{if(t.buttons!==1){return}const i=t.clientX-this.scrollViewDragPos.x;const e=t.clientY-this.scrollViewDragPos.y;this.scrollContainer.scrollTop=this.scrollViewDragPos.top-e;this.scrollContainer.scrollLeft=this.scrollViewDragPos.left-i;if(Math.abs(i)>5||Math.abs(e)>5){this.scrollViewDragging=true}};this.onScrollContentMoveEndHandler=()=>{document.removeEventListener("mousemove",this.onScrollContentMoveHandler);document.removeEventListener("mouseup",this.onScrollContentMoveEndHandler)};this.propertyid=undefined;this.from_date=undefined;this.to_date=undefined;this.language=undefined;this.loadingMessage=undefined;this.currencyName=undefined;this.ticket="";this.p=undefined;this.calendarData=new Object;this.property_id=undefined;this.days=new Array;this.scrollViewDragging=false;this.dialogData=null;this.bookingItem=null;this.editBookingItem=null;this.showLegend=false;this.showPaymentDetails=false;this.showToBeAssigned=false;this.unassignedDates={};this.roomNightsData=null;this.renderAgain=false;this.showBookProperty=false;this.totalAvailabilityQueue=[];this.highlightedDate=undefined;this.calDates=undefined;this.isAuthenticated=false}componentWillLoad(){this.init()}componentDidLoad(){this.scrollToElement(this.today)}async handleDeleteEvent(t){try{t.stopImmediatePropagation();t.preventDefault();await this.eventsService.deleteEvent(t.detail)}catch(t){}}scrollPageToRoom(t){let i=t.detail.refClass;this.scrollContainer=this.scrollContainer||this.element.querySelector(".calendarScrollContainer");const e=this.element.querySelector(".topLeftCell");const s=this.element.querySelector("."+i);if(s){this.scrollContainer.scrollTo({top:0});const t=s.getBoundingClientRect();const i=this.scrollContainer.getBoundingClientRect();const n=e.getBoundingClientRect();this.scrollContainer.scrollTo({top:t.top-i.top-n.height-t.height})}}handleShowDialog(t){var i;t.stopImmediatePropagation();t.stopPropagation();this.dialogData=t.detail;(i=this.calendarModalEl)===null||i===void 0?void 0:i.openModal()}handleShowRoomNightsDialog(t){this.roomNightsData=t.detail}handleBookingDatasChange(t){t.stopPropagation();t.stopImmediatePropagation();let i=[...this.calendarData.bookingEvents];i=i.filter((t=>t.ID!=="NEW_TEMP_EVENT"));i.push(...t.detail.filter((t=>t.STATUS==="PENDING-CONFIRMATION")));this.updateBookingEventsDateRange(t.detail);this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:i})}handleUpdateBookingEvent(t){t.stopPropagation();t.stopImmediatePropagation();const i=t.detail;this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:this.calendarData.bookingEvents.map((t=>{if(i.ID===t.ID){return i}return t}))})}showBookingPopupEventDataHandler(t){t.preventDefault();t.stopImmediatePropagation();this.onOptionSelect(t)}updateEventDataHandler(t){let i=this.calendarData.bookingEvents.find((i=>i.id===t.detail.id));if(i&&t.detail&&t.detail.data){Object.entries(t.detail.data).forEach((([t,e])=>{i[t]=e}))}}dragOverEventDataHandler(t){if(t.detail.id==="CALCULATE_DRAG_OVER_BOUNDS"){let i=document.querySelector("igl-cal-header .topLeftCell");let e=document.querySelectorAll(".headersContainer .headerCell");let s=document.querySelectorAll(".bodyContainer .roomRow .roomTitle");this.visibleCalendarCells={x:[],y:[]};e.forEach((t=>{const e=t;this.visibleCalendarCells.x.push({left:e.offsetLeft+i.offsetWidth,width:e.offsetWidth,id:e.getAttribute("data-day")})}));s.forEach((t=>{const i=t;this.visibleCalendarCells.y.push({top:i.offsetTop,height:i.offsetHeight,id:i.getAttribute("data-room")})}));this.highlightDragOver(true,t.detail.data)}else if(t.detail.id==="DRAG_OVER"){this.highlightDragOver(true,t.detail.data)}else if(t.detail.id==="DRAG_OVER_END"){this.highlightDragOver(false,t.detail.data)}else if(t.detail.id==="STRETCH_OVER_END"){this.highlightDragOver(false,t.detail.data)}}ticketChanged(t,i){if(t===i){return}this.token.setToken(this.ticket);this.initializeApp()}init(){this.calDates={from:this.from_date,to:this.to_date};if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}this.calDates={from:this.from_date,to:this.to_date};A("unassigned_dates",(t=>{if(Object.keys(t).length===0&&this.highlightedDate!==""){this.highlightedDate=""}}))}renderModalBody(){var t,i;switch((t=this.dialogData)===null||t===void 0?void 0:t.reason){case"checkin":{return`Are you sure you want to Check In this unit?`}case"checkout":{return"Are you sure you want to Check Out this unit?"}case"reallocate":return((i=this.dialogData)===null||i===void 0?void 0:i.description)||"";default:return"Unknown modal content"}}setUpCalendarData(t,i){console.log(t);this.calendarData.currency=t["My_Result"].currency;this.calendarData.allowedBookingSources=t["My_Result"].allowed_booking_sources;this.calendarData.adultChildConstraints=t["My_Result"].adult_child_constraints;console.log(this.calendarData.allowedBookingSources);this.calendarData.legendData=this.getLegendData(t);this.calendarData.is_vacation_rental=t["My_Result"].is_vacation_rental;this.calendarData.from_date=i.My_Params_Get_Rooming_Data.FROM;this.calendarData.to_date=i.My_Params_Get_Rooming_Data.TO;this.calendarData.startingDate=new Date(i.My_Params_Get_Rooming_Data.FROM).getTime();this.calendarData.endingDate=new Date(i.My_Params_Get_Rooming_Data.TO).getTime();this.calendarData.formattedLegendData=h(this.calendarData.legendData);let e=i.myBookings||[];e=e.filter((t=>{const i=g(t.TO_DATE,"YYYY-MM-DD");const e=g(t.FROM_DATE,"YYYY-MM-DD");return!i.isSame(e)}));this.calendarData.bookingEvents=e;this.calendarData.toBeAssignedEvents=[]}async initializeApp(){try{let t=this.propertyid;if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}let i=null;if(!t){console.log(t);const e=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true,include_units_hk_status:true});i=e;t=e.My_Result.id}this.property_id=t;const e=[this.bookingService.getCalendarData(t,this.from_date,this.to_date),this.bookingService.getCountries(this.language),this.roomService.fetchLanguage(this.language)];if(this.propertyid){e.push(this.roomService.getExposedProperty({id:this.propertyid,language:this.language,is_backend:true,include_units_hk_status:true}))}const s=await Promise.all(e);if(!i){i=s[s.length-1]}const[n,o]=s;y.days=n.days;y.months=n.months;this.setRoomsData(i);this.countryNodeList=o;this.setUpCalendarData(i,n);let r=i["My_Result"]["allowed_payment_methods"];this.showPaymentDetails=r.some((t=>t.code==="001"||t.code==="004"));this.updateBookingEventsDateRange(this.calendarData.bookingEvents);this.updateBookingEventsDateRange(this.calendarData.toBeAssignedEvents);this.today=this.transformDateForScroll(new Date);let h=new Date(this.calendarData.startingDate);h.setHours(0,0,0,0);this.days=n.days;this.calendarData.days=this.days;this.calendarData.monthsInfo=n.months;y.fromDate=this.calendarData.from_date;y.toDate=this.calendarData.to_date;setTimeout((()=>{this.scrollToElement(this.today)}),200);if(!this.calendarData.is_vacation_rental){const t=await this.toBeAssignedService.getUnassignedDates(this.property_id,a(new Date),this.to_date);this.unassignedDates={fromDate:this.from_date,toDate:this.to_date,data:Object.assign(Object.assign({},this.unassignedDates),t)};this.calendarData=Object.assign(Object.assign({},this.calendarData),{unassignedDates:t});C(t)}this.socket=wi("https://realtime.igloorooms.com/");this.socket.on("MSG",(async t=>{await this.handleSocketMessage(t)}))}catch(t){console.error("Initializing Calendar Error",t)}}async handleSocketMessage(t){const i=JSON.parse(t);if(!i){return}const{REASON:e,KEY:s,PAYLOAD:n}=i;if(s.toString()!==this.property_id.toString()){return}let o;if(["DELETE_CALENDAR_POOL","GET_UNASSIGNED_DATES"].includes(e)){o=n}else{o=JSON.parse(n)}console.log(s,o);const r={DORESERVATION:this.handleDoReservation,BLOCK_EXPOSED_UNIT:this.handleBlockExposedUnit,ASSIGN_EXPOSED_ROOM:this.handleAssignExposedRoom,REALLOCATE_EXPOSED_ROOM_BLOCK:this.handleReallocateExposedRoomBlock,DELETE_CALENDAR_POOL:this.handleDeleteCalendarPool,GET_UNASSIGNED_DATES:this.handleGetUnassignedDates,UPDATE_CALENDAR_AVAILABILITY:this.handleUpdateCalendarAvailability,CHANGE_IN_DUE_AMOUNT:this.handleChangeInDueAmount,CHANGE_IN_BOOK_STATUS:this.handleChangeInBookStatus,NON_TECHNICAL_CHANGE_IN_BOOKING:this.handleNonTechnicalChangeInBooking,ROOM_STATUS_CHANGED:this.handleRoomStatusChanged,UNIT_HK_STATUS_CHANGED:this.handleUnitHKStatusChanged};const h=r[e];if(h){await h.call(this,o)}else{console.warn(`Unhandled REASON: ${e}`)}}handleRoomStatusChanged(t){this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:[...this.calendarData.bookingEvents.map((i=>{if(i.IDENTIFIER===t.room_identifier){return Object.assign(Object.assign({},i),{CHECKIN:t.status==="001",CHECKOUT:t.status==="002",STATUS:w[t.status==="001"?"000":"003"]})}return i}))]})}handleUnitHKStatusChanged(t){console.log("hk unit change",t);const i=[...this.calendarData.roomsInfo];const e=i.findIndex((i=>i.id===t.ROOM_CATEGORY_ID));if(e!==-1){const s=Object.assign({},i[e]);const n=s.physicalrooms.findIndex((i=>i.id===t.PR_ID));if(n!==-1){const o=[...s.physicalrooms];const r=Object.assign({},o[n]);r.hk_status=t.HKS_CODE;o[n]=r;s.physicalrooms=o;i[e]=s;this.calendarData=Object.assign(Object.assign({},this.calendarData),{roomsInfo:i})}}}async handleDoReservation(t){const i=m(t);this.AddOrUpdateRoomBookings(i)}async handleBlockExposedUnit(t){const i=[await v(t)];this.AddOrUpdateRoomBookings(i)}async handleAssignExposedRoom(t){console.log(t);const i=m(t);this.AddOrUpdateRoomBookings(i)}async handleReallocateExposedRoomBlock(t){await this.handleBlockExposedUnit(t)}async handleDeleteCalendarPool(t){console.log("delete calendar pool");this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:this.calendarData.bookingEvents.filter((i=>i.POOL!==t))})}async handleGetUnassignedDates(t){const i=this.parseDateRange(t);if(!this.calendarData.is_vacation_rental&&new Date(i.FROM_DATE).getTime()>=this.calendarData.startingDate&&new Date(i.TO_DATE).getTime()<=this.calendarData.endingDate){const t=await this.toBeAssignedService.getUnassignedDates(this.property_id,a(new Date(i.FROM_DATE)),a(new Date(i.TO_DATE)));C(t);this.unassignedDates={fromDate:a(new Date(i.FROM_DATE)),toDate:a(new Date(i.TO_DATE)),data:t};if(Object.keys(t).length===0){_(a(new Date(i.FROM_DATE)),a(new Date(i.TO_DATE)));this.reduceAvailableUnitEvent.emit({fromDate:a(new Date(i.FROM_DATE)),toDate:a(new Date(i.TO_DATE))})}}}parseDateRange(t){const i={};const e=t.split("|");e.forEach((t=>{const e=t.split(":");i[e[0]]=e[1]}));return i}handleUpdateCalendarAvailability(t){this.totalAvailabilityQueue.push(t);if(this.totalAvailabilityQueue.length>0){clearTimeout(this.availabilityTimeout)}this.availabilityTimeout=setTimeout((()=>{this.updateTotalAvailability()}),1e3)}handleChangeInDueAmount(t){this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:this.calendarData.bookingEvents.map((i=>{if(t.pools.includes(i.ID)){return Object.assign(Object.assign({},i),{BALANCE:t.due_amount})}return i}))})}handleChangeInBookStatus(t){this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:this.calendarData.bookingEvents.map((i=>{if(t.pools.includes(i.ID)){return Object.assign(Object.assign({},i),{STATUS:i.STATUS!=="IN-HOUSE"?w[t.status_code]:t.status_code==="001"?w[t.status_code]:"IN-HOUSE"})}return i}))})}handleNonTechnicalChangeInBooking(t){this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:this.calendarData.bookingEvents.map((i=>{if(i.BOOKING_NUMBER===t.booking_nbr){return Object.assign(Object.assign({},i),{PRIVATE_NOTE:k(t.extras)})}return i}))})}checkBookingAvailability(t){return this.calendarData.bookingEvents.some((i=>i.ID===t.ID||i.FROM_DATE===t.FROM_DATE&&i.TO_DATE===t.TO_DATE&&i.PR_ID===t.PR_ID))}updateBookingEventsDateRange(t){const i=g();t.forEach((t=>{t.legendData=this.calendarData.formattedLegendData;t.defaultDateRange={};t.defaultDateRange.fromDate=new Date(t.FROM_DATE+"T00:00:00");t.defaultDateRange.fromDateStr=this.getDateStr(t.defaultDateRange.fromDate);t.defaultDateRange.fromDateTimeStamp=t.defaultDateRange.fromDate.getTime();t.defaultDateRange.toDate=new Date(t.TO_DATE+"T00:00:00");t.defaultDateRange.toDateStr=this.getDateStr(t.defaultDateRange.toDate);t.defaultDateRange.toDateTimeStamp=t.defaultDateRange.toDate.getTime();t.defaultDateRange.dateDifference=t.NO_OF_DAYS;t.roomsInfo=[...this.calendarData.roomsInfo];if(!c(t.STATUS_CODE)){if(E.checkin_enabled){if(t.CHECKOUT){t.STATUS=w["003"]}if(t.CHECKIN){t.STATUS=w["000"]}}else{const e=g(t.TO_DATE,"YYYY-MM-DD");const s=g(t.FROM_DATE,"YYYY-MM-DD");if(t.STATUS!=="PENDING"){if(s.isSame(i,"day")&&i.hour()>=12){t.STATUS=w["000"]}else if(i.isAfter(s,"day")&&i.isBefore(e,"day")){t.STATUS=w["000"]}else if(e.isSame(i,"day")&&i.hour()<12){t.STATUS=w["000"]}else if(e.isSame(i,"day")&&i.hour()>=12||e.isBefore(i,"day")){t.STATUS=w["003"]}}}}}))}updateTotalAvailability(){let t=[...y.days];this.totalAvailabilityQueue.forEach((i=>{let e=new Date(i.date);e.setMilliseconds(0);e.setSeconds(0);e.setMinutes(0);e.setHours(0);const s=t.findIndex((t=>t.currentDate===e.getTime()));if(s!=-1){const e=t[s].rate.findIndex((t=>t.id===i.room_type_id));if(e!=-1){t[s].rate[e].exposed_inventory.rts=i.availability}}}));y.days=[...t]}setRoomsData(t){var i,e;let s=new Array;if((e=(i=t.My_Result)===null||i===void 0?void 0:i.roomtypes)===null||e===void 0?void 0:e.length){s=t.My_Result.roomtypes;t.My_Result.roomtypes.forEach((t=>{t.expanded=true}))}E.roomsInfo=s;this.calendarData.roomsInfo=s}getLegendData(t){return t["My_Result"].calendar_legends}getDateStr(t,i="default"){return t.getDate()+" "+t.toLocaleString(i,{month:"short"})+" "+t.getFullYear()}scrollToElement(t){this.scrollContainer=this.scrollContainer||this.element.querySelector(".calendarScrollContainer");const i=this.element.querySelector(".topLeftCell");const e=this.element.querySelector(".day-"+t);if(e){this.scrollContainer.scrollTo({left:0});const t=e.getBoundingClientRect();const s=this.scrollContainer.getBoundingClientRect();const n=i.getBoundingClientRect();this.scrollContainer.scrollTo({left:t.left-s.left-n.width-t.width})}}AddOrUpdateRoomBookings(t,i=undefined){let e=[...this.calendarData.bookingEvents];t.forEach((t=>{if(!this.checkBookingAvailability(t)){e=e.filter((i=>i.ID!==t.ID))}}));this.updateBookingEventsDateRange(t);if(i){e=e.filter((t=>t.POOL===i))}t.forEach((t=>{if(!e.some((i=>i.ID===t.ID))){e.push(t)}}));this.calendarData=Object.assign(Object.assign({},this.calendarData),{bookingEvents:e})}transformDateForScroll(t){return g(t).format("D_M_YYYY")}shouldRenderCalendarView(){return this.calendarData&&this.calendarData.days&&this.calendarData.days.length}onOptionSelect(t){const i=t.detail;const e=this.element.querySelector("#iglooCalendar");switch(i.key){case"showAssigned":e.classList.remove("showLegend");e.classList.remove("showToBeAssigned");e.classList.toggle("showToBeAssigned");this.showLegend=false;this.showToBeAssigned=true;break;case"showLegend":e.classList.remove("showToBeAssigned");e.classList.remove("showLegend");e.classList.toggle("showLegend");this.showLegend=true;this.showToBeAssigned=false;break;case"calendar":let t=new Date;if(i.data.start!==undefined&&i.data.end!==undefined){t=i.data.start.toDate();this.handleDateSearch(i.data)}else{t=new Date(i.data);t.setDate(t.getDate()+1);if(!(i===null||i===void 0?void 0:i.noScroll)){this.scrollToElement(t.getDate()+"_"+(t.getMonth()+1)+"_"+t.getFullYear())}}this.highlightedDate=this.transformDateForScroll(t);break;case"search":break;case"add":if(i.data.event_type!=="EDIT_BOOKING"){this.bookingItem=i.data}else{this.editBookingItem=i.data}break;case"gotoToday":this.scrollToElement(this.today);break;case"closeSideMenu":this.closeSideMenu();this.highlightedDate="";this.showBookProperty=false;break}}async addDatesToCalendar(t,i){const e=await this.bookingService.getCalendarData(this.property_id,t,i);const s=e.myBookings||[];this.updateBookingEventsDateRange(s);if(new Date(t).getTime()<new Date(this.calendarData.startingDate).getTime()){this.calendarData.startingDate=new Date(t).getTime();this.calendarData.from_date=t;y.fromDate=this.calendarData.from_date;this.days=[...e.days,...this.days];let i=[...e.months];if(this.calendarData.monthsInfo[0].monthName===e.months[e.months.length-1].monthName){this.calendarData.monthsInfo[0].daysCount=this.calendarData.monthsInfo[0].daysCount+e.months[e.months.length-1].daysCount;i.pop()}let n=JSON.parse(JSON.stringify(s));n=n.filter((t=>{const i=this.calendarData.bookingEvents.findIndex((i=>i.ID===t.ID));if(i!==-1){this.calendarData.bookingEvents[i].FROM_DATE=t.FROM_DATE;this.calendarData.bookingEvents[i].NO_OF_DAYS=O(t.FROM_DATE,this.calendarData.bookingEvents[i].TO_DATE);return false}return true}));y.days=this.days;this.calendarData=Object.assign(Object.assign({},this.calendarData),{days:this.days,monthsInfo:[...i,...this.calendarData.monthsInfo],bookingEvents:[...this.calendarData.bookingEvents,...n]})}else{this.calendarData.endingDate=new Date(i).getTime();this.calendarData.to_date=i;y.toDate=this.calendarData.to_date;let n=[...e.months];this.days=[...this.days,...e.days];if(this.calendarData.monthsInfo[this.calendarData.monthsInfo.length-1].monthName===e.months[0].monthName){this.calendarData.monthsInfo[this.calendarData.monthsInfo.length-1].daysCount=this.calendarData.monthsInfo[this.calendarData.monthsInfo.length-1].daysCount+e.months[0].daysCount;n.shift()}let o=JSON.parse(JSON.stringify(s));o=o.filter((t=>{const i=this.calendarData.bookingEvents.findIndex((i=>i.ID===t.ID));if(i!==-1){this.calendarData.bookingEvents[i].TO_DATE=t.TO_DATE;this.calendarData.bookingEvents[i].NO_OF_DAYS=O(this.calendarData.bookingEvents[i].FROM_DATE,t.TO_DATE);return false}return true}));y.days=this.days;this.calendarData=Object.assign(Object.assign({},this.calendarData),{days:this.days,monthsInfo:[...this.calendarData.monthsInfo,...n],bookingEvents:[...this.calendarData.bookingEvents,...o]});const r=await this.toBeAssignedService.getUnassignedDates(this.property_id,t,i);this.calendarData.unassignedDates=Object.assign(Object.assign({},this.calendarData.unassignedDates),r);this.unassignedDates={fromDate:t,toDate:i,data:r};C(r)}}async handleDateSearch(t){const i=g(t.start).toDate();const e=g(this.calDates.from).toDate();const s=t.end.toDate();const n=this.calendarData.endingDate;if(i.getTime()<new Date(this.calDates.from).getTime()){await this.addDatesToCalendar(g(i).add(-1,"days").format("YYYY-MM-DD"),g(e).add(-1,"days").format("YYYY-MM-DD"));this.calDates=Object.assign(Object.assign({},this.calDates),{from:t.start.add(-1,"days").format("YYYY-MM-DD")});this.scrollToElement(this.transformDateForScroll(i))}else if(i.getTime()>e.getTime()&&i.getTime()<n&&s.getTime()<n){this.scrollToElement(this.transformDateForScroll(i))}else if(i.getTime()>n){const t=l(new Date(this.calendarData.endingDate));await this.addDatesToCalendar(t,g(s).add(2,"months").format("YYYY-MM-DD"));this.scrollToElement(this.transformDateForScroll(i))}}closeSideMenu(){const t=this.element.querySelector("#iglooCalendar");t.classList.remove("showToBeAssigned");t.classList.remove("showLegend");this.showLegend=false;this.showToBeAssigned=false}dragScrollContent(t){this.scrollViewDragging=false;let i=t&&t.target?this.hasAncestorWithClass(t.target,"preventPageScroll"):false;if(!i&&t.buttons===1){this.scrollViewDragPos={left:this.scrollContainer.scrollLeft,top:this.scrollContainer.scrollTop,x:t.clientX,y:t.clientY};document.addEventListener("mousemove",this.onScrollContentMoveHandler);document.addEventListener("mouseup",this.onScrollContentMoveEndHandler)}}calendarScrolling(){if(this.scrollContainer){if(this.highlightedDate){const t=document.querySelector(`.day-${this.highlightedDate}`);if(t){const{left:i,right:e}=t.getBoundingClientRect();const s=i>=0&&e<=window.innerWidth;if(!s){this.highlightedDate=""}}}const t=this.scrollContainer.getBoundingClientRect();let i=170;let e=t.width-i;let s=t.x+i;let n=t.x+t.width;let o=Array.from(this.element.querySelectorAll(".monthCell"));if(o.length){o.map((async t=>{let i=t.getBoundingClientRect();if(o.indexOf(t)===o.length-1){if(i.x+i.width<=n&&!this.reachedEndOfCalendar){this.reachedEndOfCalendar=true;const t=f(new Date(this.calendarData.endingDate));const i=l(new Date(this.calendarData.endingDate));await this.addDatesToCalendar(i,t);this.reachedEndOfCalendar=false}}if(i.x+i.width<s);else if(i.x>n);else{let o=t.querySelector(".monthTitle");let r=0;let h=i.width;if(i.x<s){r=Math.abs(i.x)-s;r=i.x<0?Math.abs(i.x)+s:Math.abs(r);h=i.x+i.width>n?e:i.x+i.width-s}else{h=e-h>h?h:e-i.x+s}o.style.marginLeft=r+"px";o.style.width=h+"px"}}))}}}hasAncestorWithClass(t,i){let e=t;while(e!==null){if(e.matches(`.${i}`)){return true}e=e.parentElement}return false}async highlightDragOver(t,i){let e,s;if(i){e=this.visibleCalendarCells.x.find((t=>t.left<i.x&&i.x<=t.left+t.width));s=this.visibleCalendarCells.y.find((t=>t.top<i.y&&i.y<=t.top+t.height))}if(t&&e&&s){this.dragOverHighlightElement.emit({dragOverElement:s.id+"_"+e.id})}else{this.dragOverHighlightElement.emit({dragOverElement:""})}if(!t){this.moveBookingTo.emit({bookingId:i.id,fromRoomId:i.fromRoomId,toRoomId:s&&s.id||"revert",moveToDay:e&&e.id||"revert",pool:i.pool,from_date:u(e&&e.id),to_date:d(e&&e.id,i.nbOfDays)})}}handleModalConfirm(){var t;const i=()=>{this.dialogData=null};try{switch((t=this.dialogData)===null||t===void 0?void 0:t.reason){case"checkin":case"checkout":{const{bookingNumber:t,roomIdentifier:e}=this.dialogData;const s=this.dialogData.reason==="checkin"?"001":"002";this.bookingService.handleExposedRoomInOut({booking_nbr:t,room_identifier:e,status:s}).finally(i);break}case"reallocate":{if(!this.dialogData){console.warn("No dialog data available for reallocation.");return}const{pool:t,toRoomId:e,from_date:s,to_date:n}=this.dialogData;this.eventsService.reallocateEvent(t,e,s,n).then(i).catch((()=>{console.error("Reallocation failed. Reverting booking.");this.revertBooking.emit(t)})).finally(i);break}default:i();break}}catch(t){console.error("Error handling modal confirm:",t);i()}}handleModalCancel(){var t;if(((t=this.dialogData)===null||t===void 0?void 0:t.reason)==="reallocate"){this.revertBooking.emit(this.dialogData.pool)}this.dialogData=null}handleRoomNightsDialogClose(t){if(t.detail.type==="cancel"){this.revertBooking.emit(this.roomNightsData.pool)}this.roomNightsData=null}handleSideBarToggle(t){var i;if(t.detail){if(this.editBookingItem){this.editBookingItem=null}if(this.roomNightsData){this.revertBooking.emit(this.roomNightsData.pool);this.roomNightsData=null}if(((i=this.dialogData)===null||i===void 0?void 0:i.reason)==="reallocate"){this.revertBooking.emit(this.dialogData.pool);this.dialogData=null}}}handleCloseBookingWindow(){this.bookingItem=null}render(){var t,i,n;return e(s,{key:"ae1625bd334541c40cb740999fcee48b875abd5a"},e("ir-toast",{key:"b7ea75abaa7cd4d695e55f1e2156d61badbeaf37"}),e("ir-interceptor",{key:"55df4aeeefe6d1d4ab7888cb56d46c4f43fd0bbf"}),e("div",{key:"8821d628d3d105d909c4ada0caff6f5657adb076",id:"iglooCalendar",class:"igl-calendar"},this.shouldRenderCalendarView()?[this.showToBeAssigned?e("igl-to-be-assigned",{unassignedDatesProp:this.unassignedDates,to_date:this.to_date,from_date:this.from_date,propertyid:this.property_id,class:"tobeAssignedContainer",calendarData:this.calendarData,onOptionEvent:t=>this.onOptionSelect(t)}):null,this.showLegend?e("igl-legends",{class:"legendContainer",legendData:this.calendarData.legendData,onOptionEvent:t=>this.onOptionSelect(t)}):null,e("div",{class:"calendarScrollContainer",onMouseDown:t=>this.dragScrollContent(t),onScroll:()=>this.calendarScrolling()},e("div",{id:"calendarContainer"},e("igl-cal-header",{unassignedDates:this.unassignedDates,to_date:this.to_date,propertyid:this.property_id,today:this.today,calendarData:this.calendarData,highlightedDate:this.highlightedDate,onOptionEvent:t=>this.onOptionSelect(t)}),e("igl-cal-body",{propertyId:this.property_id,language:this.language,countryNodeList:this.countryNodeList,currency:this.calendarData.currency,today:this.today,highlightedDate:this.highlightedDate,isScrollViewDragging:this.scrollViewDragging,calendarData:this.calendarData}),e("igl-cal-footer",{highlightedDate:this.highlightedDate,today:this.today,calendarData:this.calendarData,onOptionEvent:t=>this.onOptionSelect(t)})))]:e("ir-loading-screen",{message:"Preparing Calendar Data"})),this.bookingItem&&e("igl-book-property",{key:"fc6770993c33b569f09baaf95f1b17f8ef4eec45",allowedBookingSources:this.calendarData.allowedBookingSources,adultChildConstraints:this.calendarData.adultChildConstraints,showPaymentDetails:this.showPaymentDetails,countryNodeList:this.countryNodeList,currency:this.calendarData.currency,language:this.language,propertyid:this.property_id,bookingData:this.bookingItem,onCloseBookingWindow:()=>this.handleCloseBookingWindow()}),e("ir-sidebar",{key:"9a65afb427168cf192d325e16f2ca0c90d8f06bd",onIrSidebarToggle:this.handleSideBarToggle.bind(this),open:this.roomNightsData!==null||this.editBookingItem&&this.editBookingItem.event_type==="EDIT_BOOKING",showCloseButton:false,sidebarStyles:{width:this.editBookingItem?"80rem":"var(--sidebar-width,40rem)",background:this.roomNightsData?"white":"#F2F3F8"}},this.roomNightsData&&e("ir-room-nights",{key:"e95668f47386ab6acd417e94a50cd9f077dab615",slot:"sidebar-body",pool:this.roomNightsData.pool,onCloseRoomNightsDialog:this.handleRoomNightsDialogClose.bind(this),language:this.language,bookingNumber:this.roomNightsData.bookingNumber,identifier:this.roomNightsData.identifier,toDate:this.roomNightsData.to_date,fromDate:this.roomNightsData.from_date,defaultDates:this.roomNightsData.defaultDates,ticket:this.ticket,propertyId:this.property_id}),this.editBookingItem&&this.editBookingItem.event_type==="EDIT_BOOKING"&&e("ir-booking-details",{key:"e4e02e1d97e196a5ec6eb0c4dc24d5d8f3e58a49",slot:"sidebar-body",hasPrint:true,hasReceipt:true,hasCloseButton:true,onCloseSidebar:()=>this.editBookingItem=null,is_from_front_desk:true,propertyid:this.property_id,hasRoomEdit:true,hasRoomDelete:true,bookingNumber:this.editBookingItem.BOOKING_NUMBER,ticket:this.ticket,language:this.language,hasRoomAdd:true})),e("ir-modal",{key:"2c1d9a5dfcc764d31ded936e47e5be37e40bf131",ref:t=>this.calendarModalEl=t,modalTitle:"",rightBtnActive:((t=this.dialogData)===null||t===void 0?void 0:t.reason)==="reallocate"?!this.dialogData.hideConfirmButton:true,leftBtnText:(i=D===null||D===void 0?void 0:D.entries)===null||i===void 0?void 0:i.Lcz_Cancel,rightBtnText:(n=D===null||D===void 0?void 0:D.entries)===null||n===void 0?void 0:n.Lcz_Confirm,modalBody:this.renderModalBody(),onConfirmModal:this.handleModalConfirm.bind(this),onCancelModal:this.handleModalCancel.bind(this)}))}get element(){return n(this)}static get watchers(){return{ticket:["ticketChanged"]}}};ki.style=vi;export{ki as igloo_calendar};
//# sourceMappingURL=p-4819b5ad.entry.js.map