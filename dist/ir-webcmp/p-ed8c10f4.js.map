{"version":3,"names":["ClickOutside","proto","methodName","descriptor","originalConnected","connectedCallback","originalDisconnected","disconnectedCallback","originalDidUnload","componentDidUnload","args","host","getClickOutsideHost","this","callback","bind","registerClickOutside","apply","unregisterClickOutside","component","element","isDomAvailable","__irClickOutsideCleanup__","handler","event","isEventInsideHost","call","window","addEventListener","removeEventListener","instance","getElement","path","composedPath","Array","isArray","includes","target","contains","shadowRoot","document"],"sources":["src/decorators/ClickOutside.ts"],"sourcesContent":["import { getElement, ComponentInterface } from '@stencil/core';\nimport { HTMLStencilElement } from '@stencil/core/internal';\n\n/**\n * Call this function as soon as the click outside of annotated method's host is done.\n * @example\n```\n@ClickOutside()\ncallback() {\n  // this will run when click outside of element (host component) is done.\n}\n```\n */\nexport function ClickOutside() {\n  return (proto: ComponentInterface, methodName: string, descriptor: PropertyDescriptor) => {\n    const originalConnected = proto.connectedCallback;\n    const originalDisconnected = proto.disconnectedCallback;\n    const originalDidUnload = proto.componentDidUnload;\n\n    proto.connectedCallback = function (...args: any[]) {\n      const host = getClickOutsideHost(this);\n      if (host) {\n        const callback = (this as any)[methodName]?.bind(this);\n        if (callback) {\n          registerClickOutside(this, host, callback);\n        }\n      }\n\n      return originalConnected?.apply(this, args);\n    };\n\n    proto.disconnectedCallback = function (...args: any[]) {\n      const host = getClickOutsideHost(this);\n      if (host) {\n        unregisterClickOutside(host);\n      }\n\n      return originalDisconnected?.apply(this, args);\n    };\n\n    proto.componentDidUnload = function (...args: any[]) {\n      const host = getClickOutsideHost(this);\n      if (host) {\n        unregisterClickOutside(host);\n      }\n\n      return originalDidUnload?.apply(this, args);\n    };\n\n    return descriptor;\n  };\n}\n\n/**\n * Register callback function for HTMLElement to be executed when user clicks outside of element.\n * @example\n```\n<span \n    ref={spanEl => registerClickOutside(this, spanEl, () => this.test())}>\n      Hello, World!\n</span>;\n```\n */\nexport function registerClickOutside(component: ComponentInterface, element: HTMLClickOutsideElement, callback: (event: Event) => void): void {\n  if (!element || !isDomAvailable()) return;\n  if (element.__irClickOutsideCleanup__) return;\n\n  const handler = (event: Event) => {\n    if (isEventInsideHost(element as any, event)) {\n      return;\n    }\n\n    callback.call(component, event);\n  };\n\n  window.addEventListener('click', handler, true);\n\n  element.__irClickOutsideCleanup__ = () => {\n    window.removeEventListener('click', handler, true);\n  };\n}\n\nexport function unregisterClickOutside(element: HTMLClickOutsideElement | null | undefined): void {\n  if (!element || !isDomAvailable()) return;\n  element.__irClickOutsideCleanup__?.();\n  delete element.__irClickOutsideCleanup__;\n}\n\nexport interface HTMLClickOutsideElement extends HTMLStencilElement {\n  __irClickOutsideCleanup__?: () => void;\n}\n\nfunction getClickOutsideHost(instance: any): HTMLClickOutsideElement | null {\n  if (!isDomAvailable()) return null;\n\n  try {\n    return getElement(instance) as HTMLClickOutsideElement;\n  } catch {\n    return null;\n  }\n}\n\nfunction isEventInsideHost(host: HTMLElement, event: Event): boolean {\n  if (!event) return false;\n\n  const path = typeof event.composedPath === 'function' ? event.composedPath() : [];\n  if (Array.isArray(path) && path.includes(host)) {\n    return true;\n  }\n\n  const target = event.target as Node | null;\n  if (!target) return false;\n\n  if (host === target) return true;\n  if (typeof (host as any).contains === 'function' && host.contains(target)) return true;\n\n  return !!host.shadowRoot?.contains(target);\n}\n\nfunction isDomAvailable(): boolean {\n  return typeof window !== 'undefined' && typeof document !== 'undefined';\n}\n"],"mappings":"6CAagBA,IACd,MAAO,CAACC,EAA2BC,EAAoBC,KACrD,MAAMC,EAAoBH,EAAMI,kBAChC,MAAMC,EAAuBL,EAAMM,qBACnC,MAAMC,EAAoBP,EAAMQ,mBAEhCR,EAAMI,kBAAoB,YAAaK,GACrC,MAAMC,EAAOC,EAAoBC,MACjC,GAAIF,EAAM,CACR,MAAMG,EAAYD,KAAaX,IAAaa,KAAKF,MACjD,GAAIC,EAAU,CACZE,EAAqBH,KAAMF,EAAMG,E,EAIrC,OAAOV,GAAmBa,MAAMJ,KAAMH,E,EAGxCT,EAAMM,qBAAuB,YAAaG,GACxC,MAAMC,EAAOC,EAAoBC,MACjC,GAAIF,EAAM,CACRO,EAAuBP,E,CAGzB,OAAOL,GAAsBW,MAAMJ,KAAMH,E,EAG3CT,EAAMQ,mBAAqB,YAAaC,GACtC,MAAMC,EAAOC,EAAoBC,MACjC,GAAIF,EAAM,CACRO,EAAuBP,E,CAGzB,OAAOH,GAAmBS,MAAMJ,KAAMH,E,EAGxC,OAAOP,CAAU,CAErB,C,SAYgBa,EAAqBG,EAA+BC,EAAkCN,GACpG,IAAKM,IAAYC,IAAkB,OACnC,GAAID,EAAQE,0BAA2B,OAEvC,MAAMC,EAAWC,IACf,GAAIC,EAAkBL,EAAgBI,GAAQ,CAC5C,M,CAGFV,EAASY,KAAKP,EAAWK,EAAM,EAGjCG,OAAOC,iBAAiB,QAASL,EAAS,MAE1CH,EAAQE,0BAA4B,KAClCK,OAAOE,oBAAoB,QAASN,EAAS,KAAK,CAEtD,C,SAEgBL,EAAuBE,GACrC,IAAKA,IAAYC,IAAkB,OACnCD,EAAQE,qCACDF,EAAQE,yBACjB,CAMA,SAASV,EAAoBkB,GAC3B,IAAKT,IAAkB,OAAO,KAE9B,IACE,OAAOU,EAAWD,E,CAClB,MACA,OAAO,I,CAEX,CAEA,SAASL,EAAkBd,EAAmBa,GAC5C,IAAKA,EAAO,OAAO,MAEnB,MAAMQ,SAAcR,EAAMS,eAAiB,WAAaT,EAAMS,eAAiB,GAC/E,GAAIC,MAAMC,QAAQH,IAASA,EAAKI,SAASzB,GAAO,CAC9C,OAAO,I,CAGT,MAAM0B,EAASb,EAAMa,OACrB,IAAKA,EAAQ,OAAO,MAEpB,GAAI1B,IAAS0B,EAAQ,OAAO,KAC5B,UAAY1B,EAAa2B,WAAa,YAAc3B,EAAK2B,SAASD,GAAS,OAAO,KAElF,QAAS1B,EAAK4B,YAAYD,SAASD,EACrC,CAEA,SAAShB,IACP,cAAcM,SAAW,oBAAsBa,WAAa,WAC9D,Q","ignoreList":[]}