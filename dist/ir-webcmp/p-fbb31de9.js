import{h as e}from"./p-6c4ba7c0.js";import{i as n,d as t}from"./p-35ce2cf2.js";import{a as o}from"./p-bf44a732.js";import{l as i}from"./p-2fcb9a1f.js";import"./p-a66990e0.js";import{c as l}from"./p-41fabaeb.js";async function r(e){const n=[];const t=await _();for(const o of e){for(const e of o.days){for(const o of e.room_types){c(o.physicalrooms,n,t)}}}return n}function c(e,n,t){for(const o of e){for(const e in o.calendar_cell){if(o.calendar_cell[e].Is_Available===false){v(o.calendar_cell[e],n,t)}}}}const a={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const u={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function s(e,n){if(e===null&&n===null)return"";if(n!==null&&n!==""){return`${e!==null&&e!==void 0?e:""} , ${n!==null&&n!==void 0?n:""}`}return e}async function _(){try{const{data:e}=await o.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return e.My_Result.map((e=>({code:e.CODE_NAME,value:e.CODE_VALUE_EN})))}catch(e){console.log(e)}}function d(n,t,o){const l=new Date(n);l.setHours(t);l.setMinutes(o);return`${i.entries.Lcz_BlockedTill} ${e(l).format("MMM DD, HH:mm")}`}function O(o,i){var l,r,c,_,O,v,b,T,E,m;if(n(o.STAY_STATUS_CODE)){const n=e(o.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(o.DATE)?o.My_Block_Info.from_date:o.DATE;const l=e(o.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(o.DATE)?o.My_Block_Info.to_date:o.DATE;return{ID:o.POOL,NOTES:"",BALANCE:"",NAME:o.My_Block_Info.NOTES!==""?o.My_Block_Info.NOTES:o.STAY_STATUS_CODE==="003"?d(o.My_Block_Info.BLOCKED_TILL_DATE,o.My_Block_Info.BLOCKED_TILL_HOUR,o.My_Block_Info.BLOCKED_TILL_MINUTE):i.find((e=>e.code===o.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:o.My_Block_Info.DESCRIPTION,PR_ID:o.My_Block_Info.pr_id,ENTRY_DATE:o.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:o.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:o.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:o.My_Block_Info.NOTES,FROM_DATE:n,TO_DATE:l,NO_OF_DAYS:t(n,l),STATUS:a[o.STAY_STATUS_CODE],POOL:o.POOL,STATUS_CODE:o.STAY_STATUS_CODE,OUT_OF_SERVICE:o.STAY_STATUS_CODE==="004",FROM_DATE_STR:o.My_Block_Info.format.from_date,TO_DATE_STR:o.My_Block_Info.format.to_date,defaultDates:{from_date:o.My_Block_Info.from_date,to_date:o.My_Block_Info.to_date}}}if(o.booking.booking_nbr.toString()==="77054273380"){console.log("booking",o)}const N=e(o.room.from_date,"YYYY-MM-DD").isAfter(o.DATE)?o.room.from_date:o.DATE;const S=e(o.room.to_date,"YYYY-MM-DD").isAfter(o.DATE)?o.room.to_date:o.DATE;const A=(l=o.room.sharing_persons)===null||l===void 0?void 0:l.find((e=>e.is_main));return{ID:o.POOL,FROM_DATE:N,TO_DATE:S,NO_OF_DAYS:t(N,S),STATUS:u[(r=o.booking)===null||r===void 0?void 0:r.status.code],NAME:s(A===null||A===void 0?void 0:A.first_name,A===null||A===void 0?void 0:A.last_name),IDENTIFIER:o.room.identifier,PR_ID:o.pr_id,POOL:o.POOL,BOOKING_NUMBER:o.booking.booking_nbr,NOTES:o.booking.is_direct?o.booking.remark:null,PRIVATE_NOTE:f(o.booking.extras),is_direct:o.booking.is_direct,BALANCE:(c=o.booking.financial)===null||c===void 0?void 0:c.due_amount,channel_booking_nbr:o.booking.channel_booking_nbr,ARRIVAL_TIME:o.booking.arrival.description,defaultDates:{from_date:o.room.from_date,to_date:o.room.to_date},ENTRY_DATE:o.booking.booked_on.date,PHONE_PREFIX:o.booking.guest.country_phone_prefix,IS_EDITABLE:o.booking.is_editable,ARRIVAL:o.booking.arrival,PHONE:(_=o.booking.guest.mobile_without_prefix)!==null&&_!==void 0?_:"",RATE:o.room.total,RATE_PLAN:o.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:o.room.rateplan.id,RATE_TYPE:(v=(O=o.room)===null||O===void 0?void 0:O.roomtype)===null||v===void 0?void 0:v.id,ADULTS_COUNT:o.room.occupancy.adult_nbr,CHILDREN_COUNT:o.room.occupancy.children_nbr,origin:o.booking.origin,GUEST:o.booking.guest,ROOMS:o.booking.rooms,cancelation:o.room.rateplan.cancelation,guarantee:o.room.rateplan.guarantee,TOTAL_PRICE:(b=o.booking.financial)===null||b===void 0?void 0:b.gross_total,COUNTRY:o.booking.guest.country_id,FROM_DATE_STR:o.booking.format.from_date,TO_DATE_STR:o.booking.format.to_date,adult_child_offering:o.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:o.booking.source.code,description:o.booking.source.description,tag:o.booking.source.tag},CHECKIN:((T=o.room.in_out)===null||T===void 0?void 0:T.code)==="001",CHECKOUT:((E=o.room.in_out)===null||E===void 0?void 0:E.code)==="002",ROOM_INFO:{occupancy:o.room.occupancy,sharing_persons:o.room.sharing_persons,unit:o.room.unit,in_out:o.room.in_out},BASE_STATUS_CODE:(m=o.booking.status)===null||m===void 0?void 0:m.code}}function v(e,n,t){const o=n.findIndex((n=>n.POOL===e.POOL));if(o===-1){const o=O(e,t);n.push(o)}}function f(e){var n;if(!e){return null}return((n=e.find((e=>e.key==="private_note")))===null||n===void 0?void 0:n.value)||null}const b={checkout_guest:null,guest:null,tax_statement:null,roomTypes:[],enableBooking:false,resetBooking:false,ratePlanSelections:{},isInFreeCancelationZone:false,bookingAvailabilityParams:{from_date:null,to_date:null,adult_nbr:0,child_nbr:0,infant_nbr:0},booking:null,fictus_booking_nbr:null,event_type:{type:"PLUS_BOOKING"}};let{state:T,onChange:E,reset:m}=l(b);function N(){m()}function S(e,n){var t;if(!e){return null}if(!n||T.resetBooking){return e[0]}return(t=e===null||e===void 0?void 0:e.find((e=>e.adult_nbr===n.adult_nbr&&e.child_nbr===n.child_nbr)))!==null&&t!==void 0?t:null}E("roomTypes",(e=>{const n=T.ratePlanSelections;const t={};e.forEach((e=>{if(!e.is_active)return;t[e.id]=t[e.id]||{};e.rateplans.forEach((o=>{var i,l,r,c;if(!o.is_active||!((i=o===null||o===void 0?void 0:o.variations)===null||i===void 0?void 0:i.length))return;const a=(l=n[e.id])===null||l===void 0?void 0:l[o.id];t[e.id][o.id]=a&&Object.keys(a).length>0?Object.assign(Object.assign({},a),{ratePlan:o,selected_variation:(r=S(o.variations,a.selected_variation))!==null&&r!==void 0?r:null,visibleInventory:e.inventory,reserved:e.inventory===0?0:T.resetBooking?0:a.reserved,checkoutVariations:e.inventory===0?[]:a.checkoutVariations,checkoutBedSelection:e.inventory===0?[]:a.checkoutBedSelection,checkoutSmokingSelection:e.inventory===0?[]:a.checkoutSmokingSelection,guestName:e.inventory===0?[]:a.guestName,roomtype:Object.assign({},a.roomtype)}):{reserved:0,rp_amount:0,view_mode:"001",guest:null,visibleInventory:e.inventory,selected_variation:(c=o===null||o===void 0?void 0:o.variations[0])!==null&&c!==void 0?c:null,ratePlan:o,guestName:[],is_bed_configuration_enabled:e.is_bed_configuration_enabled,roomtype:Object.assign(Object.assign({},e),{physicalrooms:null,rateplans:null,availabilities:null}),checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[]}}))}));T.ratePlanSelections=t;T.resetBooking=false}));function A(e){const n=T.ratePlanSelections[e];const t=e=>Object.entries(n).reduce(((n,[t,o])=>Number(t)!==e?n+o.reserved:n),0);const o=Object.fromEntries(Object.entries(n).map((([n,o])=>{const i=t(Number(n));const l=T.roomTypes.find((n=>n.id===e));const r=l?l.inventory-i:0;return[n,Object.assign(Object.assign({},o),{visibleInventory:r>0?r:0})]})));if(JSON.stringify(n)!==JSON.stringify(o)){T.ratePlanSelections=Object.assign(Object.assign({},T.ratePlanSelections),{[e]:o})}}function I({ratePlanId:e,roomTypeId:n,params:t}){T.ratePlanSelections=Object.assign(Object.assign({},T.ratePlanSelections),{[Number(n)]:Object.assign(Object.assign({},T.ratePlanSelections[Number(n)]),{[e]:Object.assign(Object.assign({},T.ratePlanSelections[n][e]),t)})})}function D({ratePlanId:e,roomTypeId:n,rooms:t,guest:o}){var i;if(!T.ratePlanSelections[n]){T.ratePlanSelections[n]={}}const l=(i=T.roomTypes)===null||i===void 0?void 0:i.find((e=>e.id===n));if(!l){throw new Error("Invalid room type id")}const r=l.rateplans.find((n=>n.id===e));if(!r){throw new Error("Invalid rate plan")}let c=Array.from({length:t},(()=>({first_name:"",last_name:"",unit:null,bed_preference:null,infant_nbr:null})));if(o){c=o}if(!T.ratePlanSelections[n][e]){T.ratePlanSelections[n][e]={guestName:null,reserved:0,view_mode:"001",rp_amount:0,guest:c,is_bed_configuration_enabled:l.is_bed_configuration_enabled,visibleInventory:0,selected_variation:null,ratePlan:r,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],roomtype:{id:l.id,name:l.name,physicalrooms:null,rateplans:null,availabilities:null,inventory:l.inventory,rate:l.rate,bedding_setup:l.bedding_setup,smoking_option:l.smoking_option,is_bed_configuration_enabled:l.is_bed_configuration_enabled}}}T.ratePlanSelections=Object.assign(Object.assign({},T.ratePlanSelections),{[Number(n)]:Object.assign(Object.assign({},T.ratePlanSelections[Number(n)]),{[e]:Object.assign(Object.assign({},T.ratePlanSelections[n][e]),{reserved:t,checkoutVariations:[],guest:c})})});A(n)}function p(e,n){if(!T.ratePlanSelections||!T.ratePlanSelections[e]){return{reserved:0,guest:null,visibleInventory:0,selected_variation:null,ratePlan:null,guestName:[],is_bed_configuration_enabled:false,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],rp_amount:0,view_mode:"001",roomtype:null}}return T.ratePlanSelections[e][n]}function R(e,n){T[e]=n}function j(){return Object.values(T.ratePlanSelections).reduce(((e,n)=>e+Object.values(n).reduce(((e,n)=>{if(n.reserved===0){return e}return e+n.reserved}),0)),0)}function g(){const e=Object.entries(T.ratePlanSelections).reduce(((e,[n,t])=>{const o=T.roomTypes.find((e=>e.id.toString()===n.toString()));e[n]=Object.entries(t).reduce(((e,[n,t])=>{var i;e[n]=Object.assign(Object.assign({},t),{reserved:0,visibleInventory:(i=o===null||o===void 0?void 0:o.inventory)!==null&&i!==void 0?i:t.visibleInventory});return e}),{});return e}),{});T.ratePlanSelections=Object.assign({},e)}export{N as a,T as b,j as c,D as d,p as e,r as g,R as m,g as r,I as u};
//# sourceMappingURL=p-fbb31de9.js.map