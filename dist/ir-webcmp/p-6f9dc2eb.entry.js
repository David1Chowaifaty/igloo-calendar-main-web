import{r as t,c as e,h as i,F as s,H as o,g as a}from"./p-53d64953.js";import{b as n,B as r,m as l,c,r as d,a as h,d as u}from"./p-111e62af.js";import{e as f,H as b,x as p,i as m,f as g,g as v,I as y,J as k,l as _}from"./p-555baa24.js";import{V as x}from"./p-39011dec.js";import{h as w}from"./p-6c4ba7c0.js";import{l as D}from"./p-71768c2d.js";import{i as O}from"./p-2e94af0d.js";import{c as C,i as T}from"./p-00df8713.js";import{a as Y}from"./p-bf44a732.js";import{R as I}from"./p-429a4d65.js";import{P as M}from"./p-9592e7ee.js";import{T as E}from"./p-a93581f3.js";import{c as B}from"./p-6b5b5b8a.js";import{z as S,Z as j,a as R}from"./p-b859bcd5.js";import{a as A,_ as N,b as L}from"./p-b2679b77.js";import{M as z}from"./p-518eace5.js";import{v as P}from"./p-4ed69de7.js";import"./p-a973aec7.js";var G=undefined&&undefined.__rest||function(t,e){var i={};for(var s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0)i[s]=t[s];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var o=0,s=Object.getOwnPropertySymbols(t);o<s.length;o++){if(e.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(t,s[o]))i[s[o]]=t[s[o]]}return i};class H{setBookingInfoFromAutoComplete(t,e){var i,s,o;t.bookedByInfoData={id:e.guest.id,email:e.guest.email,firstName:e.guest.first_name,lastName:e.guest.last_name,countryId:e.guest.country_id,isdCode:(s=(i=e.guest)===null||i===void 0?void 0:i.country_phone_prefix)!==null&&s!==void 0?s:(o=e.guest)===null||o===void 0?void 0:o.country_id.toString(),contactNumber:e.guest.mobile,selectedArrivalTime:e.arrival,emailGuest:e.guest.subscribe_to_news_letter,message:e.remark,cardNumber:"",cardHolderName:"",expiryMonth:"",expiryYear:"",bookingNumber:e.booking_nbr,rooms:e.rooms,from_date:e.from_date,to_date:e.to_date}}resetRoomsInfoAndMessage(t){t.defaultData.roomsInfo=[];t.message=""}onDataRoomUpdate(t,e,i,s,o){let a=e;const{data:n,key:r,changedKey:l}=t.detail;const c=`c_${n.roomCategoryId}`;const d=`p_${n.ratePlanId}`;if(this.shouldClearData(r)){a=new Map}this.initializeRoomCategoryIfNeeded(c,a);if(s){if(l==="rate"){if(a.has(c)&&a.get(c).has(d)){this.applyBookingEditToSelectedRoom(c,d,n,a,o,i)}}else{if(l!=="rateType"){if(l==="adult_child_offering"){if(a.has(c)&&e.get(c).has(d)){this.applyBookingEditToSelectedRoom(c,d,n,a,o,i)}}else{this.applyBookingEditToSelectedRoom(c,d,n,a,o,i)}}}}else{this.setSelectedRoomData(c,d,n,a)}this.cleanupEmptyData(c,a);return a}shouldClearData(t){return t==="clearData"||t==="EDIT_BOOKING"}initializeRoomCategoryIfNeeded(t,e){if(!e.has(t)){e.set(t,new Map)}}setSelectedRoomData(t,e,i,s){let o=s.get(t);if(i.totalRooms===0||i.inventory===0){o.delete(e)}else{s.set(t,o.set(e,Object.assign(Object.assign({},i),{selectedUnits:Array(i.totalRooms).fill(-1)})))}}cleanupEmptyData(t,e){if(e.has(t)){let i=e.get(t);if(i.size===0){e.delete(t)}}}applyBookingEditToSelectedRoom(t,e,i,s,o,a){s.clear();let n={};if(a){n=Object.assign(Object.assign({},i),{guestName:o||"",roomId:""})}else{n=Object.assign({},i)}s.set(t,(new Map).set(e,n))}calculateAmount({is_amount_modified:t,selected_variation:e,view_mode:i,rp_amount:s}){const o=e.nights.length;if(t){return i==="002"?s:s/o}}generateDailyRates(t,e){let i=t.selected_variation;const s=t.is_amount_modified?this.calculateAmount(t):null;if(t.guest[e].infant_nbr>0&&!t.is_amount_modified){if(!this.variationService){this.variationService=new x}i=this.variationService.getVariationBasedOnInfants({variations:t.ratePlan.variations,baseVariation:t.selected_variation,infants:t.guest[e].infant_nbr})}return i.nights.map((t=>({date:t.night,amount:s!==null&&s!==void 0?s:t.discounted_amount,cost:null})))}getBookedRooms({check_in:t,check_out:e,notes:i,identifier:s,override_unit:o,unit:a,auto_check_in:r}){var l,c;const d=[];for(const h in n.ratePlanSelections){const u=n.ratePlanSelections[h];for(const n in u){const h=u[n];if(h.reserved>0){for(let n=0;n<h.reserved;n++){const{first_name:u,last_name:f}=h.guest[n];d.push({identifier:s,roomtype:h.roomtype,rateplan:h.ratePlan,prepayment_amount_gross:0,unit:o?{id:a}:h.guest[n].unit?{id:h.guest[n].unit}:null,occupancy:{adult_nbr:h.selected_variation.adult_nbr,children_nbr:Number((l=h.selected_variation.child_nbr)!==null&&l!==void 0?l:0)-Math.max(Number((c=h.guest[n].infant_nbr)!==null&&c!==void 0?c:0),0),infant_nbr:h.guest[n].infant_nbr},bed_preference:h.guest[n].bed_preference,from_date:w(t).format("YYYY-MM-DD"),to_date:w(e).format("YYYY-MM-DD"),notes:i,check_in:r,days:this.generateDailyRates(h,n),guest:{email:null,first_name:u,last_name:f,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null,cci:null}})}}}}return d}async prepareBookUserServiceParams({context:t,sourceOption:e,check_in:i}){var s,o;try{if(!t||!t.dateRangeData){throw new Error("Invalid context: Missing date range data.")}const a=new Date(t.dateRangeData.fromDate);const n=new Date(t.dateRangeData.toDate);const r=(e=null,i=false)=>this.getBookedRooms({check_in:a,check_out:n,identifier:e,notes:"",override_unit:t.isEventType("BAR_BOOKING")?true:false,unit:t.isEventType("BAR_BOOKING")?t.bookingData.PR_ID:null,auto_check_in:i});const l=(t,e)=>{var{pickup_info:i,extra_services:s,is_direct:o,is_in_loyalty_mode:a,promo_key:n,extras:r}=t,l=G(t,["pickup_info","extra_services","is_direct","is_in_loyalty_mode","promo_key","extras"]);return{assign_units:true,is_pms:true,is_direct:o,is_backend:true,is_in_loyalty_mode:a,promo_key:n,extras:r,booking:Object.assign(Object.assign({},l),{rooms:e}),extra_services:s,pickup_info:i}};let c=null;switch(t.defaultData.event_type){case"EDIT_BOOKING":{const{booking:e,currentRoomType:i}=t.defaultData;const o=e.rooms.filter((t=>t.identifier!==i.identifier));console.log("currentRoomType",i);const a=r(i.identifier,((s=i.in_out)===null||s===void 0?void 0:s.code)==="001");c=l(e,[...o,...a]);break}case"ADD_ROOM":case"SPLIT_BOOKING":{const{booking:e,ROOMS:i}=t.defaultData;if(!e){throw new Error("Missing booking")}const s=r();const o=t.defaultData.event_type==="ADD_ROOM"?i!==null&&i!==void 0?i:[]:e===null||e===void 0?void 0:e.rooms;c=l(e,[...o,...s]);break}default:{const s=r(null,i);const{bookedByInfoData:l}=t;const d=e.type==="TRAVEL_AGENCY";c={assign_units:true,is_pms:true,is_direct:true,is_backend:true,is_in_loyalty_mode:false,promo_key:null,extras:f,agent:d?{id:e.tag}:null,booking:{from_date:w(a).format("YYYY-MM-DD"),to_date:w(n).format("YYYY-MM-DD"),remark:l.message||null,booking_nbr:"",property:{id:t.propertyid},booked_on:{date:w().format("YYYY-MM-DD"),hour:(new Date).getHours(),minute:(new Date).getMinutes()},source:d?"":e,rooms:s,currency:t.currency,arrival:{code:l.selectedArrivalTime},guest:{email:l.email===""?null:l.email||null,first_name:l.firstName,last_name:l.lastName,country_id:l.countryId===""?null:l.countryId,city:null,mobile:l.contactNumber===null?"":l.contactNumber,country_phone_prefix:(o=l===null||l===void 0?void 0:l.isdCode)!==null&&o!==void 0?o:null,address:"",dob:null,subscribe_to_news_letter:l.emailGuest||false,cci:l.cardNumber?{nbr:l.cardNumber,holder_name:l.cardHolderName,expiry_month:l.expiryMonth,expiry_year:l.expiryYear}:null}},pickup_info:null};break}}return c}catch(t){console.error(t)}}getRoomCategoryByRoomId(t){var e;return(e=t.roomsInfo)===null||e===void 0?void 0:e.find((e=>e.id===t.RATE_TYPE))}setEditingRoomInfo(t,e){const i=this.getRoomCategoryByRoomId(t);const s=!i?"":`c_${i===null||i===void 0?void 0:i.id}`;const o=`p_${t.RATE_PLAN_ID}`;const a={adultCount:t.ADULTS_COUNT,rate:t.RATE,rateType:t.RATE_TYPE,ratePlanId:t.RATE_PLAN_ID,roomCategoryId:i?i.id:"",roomCategoryName:i?i.name:"",totalRooms:1,ratePlanName:t.RATE_PLAN,roomId:t.PR_ID,guestName:t.NAME,cancelation:t.cancelation,guarantee:t.guarantee,adult_child_offering:t.adult_child_offering};e.set(s,(new Map).set(o,a))}}const K=".sc-igl-book-property-h{position:fixed;top:0;right:0;width:100vw;min-height:100vh;z-index:99;overflow:hidden}.card-title.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%}.card-header-container.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%;display:flex;align-items:center;box-sizing:border-box;padding:1rem 0;justify-content:space-between}.loading-container.sc-igl-book-property{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.card-header-container.sc-igl-book-property h3.sc-igl-book-property{padding:0;margin:0}.background-overlay.sc-igl-book-property{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.25)}.formContainer.sc-igl-book-property{height:calc(100% - 79px);overflow:auto}.gap-30.sc-igl-book-property{gap:30px}.block-date.sc-igl-book-property{width:100%}.sideWindow.sc-igl-book-property{position:absolute;inset:0;left:unset;background-color:#ffffff;width:100%;overflow:auto;animation:slideInFromRight 0.5s}.card.sc-igl-book-property{top:0;z-index:1000}.close.sc-igl-book-property{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.close-icon.sc-igl-book-property{position:absolute;top:18px;right:33px;outline:none}button.sc-igl-book-property:not(:disabled),[type='button'].sc-igl-book-property:not(:disabled){cursor:pointer}.sheet-footer.sc-igl-book-property{width:100%}@media only screen and (min-width: 1200px){.sideWindow.sc-igl-book-property{max-width:70%}}@media only screen and (min-width: 2000px){.sideWindow.sc-igl-book-property{max-width:40%}}@media only screen and (min-width: 768px) and (max-width: 1200px){.sideWindow.sc-igl-book-property{max-width:90%}}@media only screen and (min-width: 600px) and (max-width: 768px){.sideWindow.sc-igl-book-property{max-width:75%}}@media only screen and (min-width: 641px){.block-date.sc-igl-book-property{max-width:450px;padding-bottom:0 !important}}@keyframes slideInFromRight{from{transform:translateX(120%)}to{transform:translateX(0)}}@keyframes slideOutToRight{from{transform:translateX(0)}to{transform:translateX(120%)}}.sideWindow--exit.sc-igl-book-property{animation:slideOutToRight 0.5s forwards}";const U=K;const F=".sc-igl-book-property-h{height:100%}.sheet-container.sc-igl-book-property{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-book-property{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-book-property{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-book-property{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-book-property{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-book-property{flex-direction:row;align-items:center}}";const V=F;const W=class{constructor(i){t(this,i);this.closeBookingWindow=e(this,"closeBookingWindow",7);this.blockedCreated=e(this,"blockedCreated",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.animateIrButton=e(this,"animateIrButton",7);this.animateIrSelect=e(this,"animateIrSelect",7);this.toast=e(this,"toast",7);this.showPaymentDetails=false;this.adultChildCount={adult:0,child:0};this.renderAgain=false;this.bookingHistory=[];this.initialRoomIds=null;this.showSplitBookingOption=false;this.sourceOptions=[];this.guestData=[];this.bookedByInfoData={};this.blockDatesData={};this.ratePricingMode=[];this.selectedUnits=new Map;this.bedPreferenceType=[];this.bookingService=new r;this.bookPropertyService=new H;this.updatedBooking=false;this.MAX_HISTORY_LENGTH=2}async componentWillLoad(){console.log("<==>roomtypes<==>",n===null||n===void 0?void 0:n.roomTypes);if(n.roomTypes){l("roomTypes",[]);l("ratePlanSelections",{})}this.handleKeyDown=this.handleKeyDown.bind(this);this.initializeDefaultDateRange();if(!this.bookingData.defaultDateRange){return}this.initializeDefaultData();this.wasBlockedUnit=this.defaultData.hasOwnProperty("block_exposed_unit_props");l("event_type",{type:this.defaultData.event_type});this.fetchSetupEntriesAndInitialize()}componentDidLoad(){document.addEventListener("keydown",this.handleKeyDown);b(true)}disconnectedCallback(){document.removeEventListener("keydown",this.handleKeyDown)}clearBooking(t){if(this.isEventType("SPLIT_BOOKING")){t.stopImmediatePropagation();t.stopPropagation();this.bookedByInfoData={};this.bookPropertyService.resetRoomsInfoAndMessage(this);this.renderPage()}}async handleSpiltBookingSelected(t){t.stopImmediatePropagation();t.stopPropagation();const{key:e,data:i}=t.detail;if(e==="select"||e==="blur"&&i!==""){const t=await this.bookingService.getExposedBooking(i.booking_nbr||i,this.language);this.defaultData=Object.assign(Object.assign({},this.defaultData),{booking:t});this.bookPropertyService.setBookingInfoFromAutoComplete(this,t);this.sourceOption=t.source;this.renderPage()}}handleAdultChildChange(t){if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){this.bookPropertyService.resetRoomsInfoAndMessage(this)}const{adult:e,child:i}=t.detail;this.adultChildCount=Object.assign({},t.detail);this.updateBookingHistory({adults:Number(e),children:Number(i)})}onDateRangeSelect(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.updateBookingHistory({dates:{checkIn:new Date(this.dateRangeData.fromDate),checkOut:new Date(new Date(e.data.toDate))}});console.log("date changed",e);if(e.key==="selectedDateRange"){this.dateRangeData=e.data;if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){this.defaultData.roomsInfo=[]}else if(this.adultChildCount.adult!==0){this.checkBookingAvailability()}}}handleSourceDropDown(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;const i=this.sourceOptions.find((t=>t.id===e.toString()));this.sourceOption={code:e,description:i.value||"",tag:i.tag,id:i.id,type:i.type}}gotoSplitPageTwo(){this.gotoPage("page_two")}handleButtonClicked(t){var e,i;switch(t.detail.key){case"save":this.bookUser(false);break;case"cancel":t.stopImmediatePropagation();t.stopPropagation();this.closeWindow();break;case"back":t.stopImmediatePropagation();t.stopPropagation();if(this.isEventType("BAR_BOOKING")){d()}this.gotoPage("page_one");break;case"book":this.bookUser(false);break;case"bookAndCheckIn":this.bookUser(true);break;case"next":t.stopImmediatePropagation();t.stopPropagation();if(!((e=this.adultChildCount)===null||e===void 0?void 0:e.adult)){this.animateIrSelect.emit("adult_child_select");break}if(c()>0){this.gotoPage("page_two");break}else if(((i=this.defaultData)===null||i===void 0?void 0:i.roomsInfo.length)===0){this.animateIrButton.emit("check_availability");break}this.toast.emit({type:"error",description:D.entries.Lcz_SelectRatePlan,title:D.entries.Lcz_SelectRatePlan});break;case"check":this.checkBookingAvailability();break}}updateBookingHistory(t){var e,i,s,o,a,n,r,l;const c=this.bookingHistory[this.bookingHistory.length-1];const d={dates:{checkIn:((e=t.dates)===null||e===void 0?void 0:e.checkIn)||((i=c===null||c===void 0?void 0:c.dates)===null||i===void 0?void 0:i.checkIn)||new Date(this.dateRangeData.fromDate),checkOut:((s=t.dates)===null||s===void 0?void 0:s.checkOut)||((o=c===null||c===void 0?void 0:c.dates)===null||o===void 0?void 0:o.checkOut)||new Date(this.dateRangeData.toDate)},adults:(n=(a=t.adults)!==null&&a!==void 0?a:c===null||c===void 0?void 0:c.adults)!==null&&n!==void 0?n:this.adultChildCount.adult,children:(l=(r=t.children)!==null&&r!==void 0?r:c===null||c===void 0?void 0:c.children)!==null&&l!==void 0?l:this.adultChildCount.child};this.bookingHistory.push(d);if(this.bookingHistory.length>this.MAX_HISTORY_LENGTH){this.bookingHistory.shift()}}handleKeyDown(t){if(t.key==="Escape"){this.closeWindow()}}initializeDefaultDateRange(){this.defaultDateRange={from_date:this.bookingData.FROM_DATE,to_date:this.bookingData.TO_DATE}}initializeDefaultData(){this.defaultData=this.bookingData;this.dateRangeData=Object.assign({},this.defaultData.defaultDateRange)}async fetchSetupEntriesAndInitialize(){try{const t=await this.fetchSetupEntries();this.setSourceOptions(this.allowedBookingSources);this.setOtherProperties(t);this.initializeEventData()}catch(t){console.error("Error fetching setup entries:",t)}}initializeEventData(){if(this.isEventType("EDIT_BOOKING")){this.initializeEditBookingData()}if(!this.isEventType("BAR_BOOKING")){this.bookPropertyService.resetRoomsInfoAndMessage(this)}this.initializePage()}initializeEditBookingData(){var t,e,i,s,o;this.adultChildCount={adult:this.defaultData.ADULTS_COUNT,child:this.defaultData.CHILDREN_COUNT};this.initialRoomIds={roomName:this.defaultData.roomName,ratePlanId:this.defaultData.RATE_PLAN_ID,roomId:this.defaultData.PR_ID,roomTypeId:this.defaultData.RATE_TYPE};const{currentRoomType:a,GUEST:n}=this.defaultData;console.log(n);l("guest",{bed_preference:(t=a.bed_preference)===null||t===void 0?void 0:t.toString(),infant_nbr:a.occupancy.infant_nbr,first_name:(e=n.first_name)!==null&&e!==void 0?e:"",last_name:(i=n.last_name)!==null&&i!==void 0?i:"",unit:(o=(s=a.unit)===null||s===void 0?void 0:s.id)===null||o===void 0?void 0:o.toString()});this.checkBookingAvailability();this.bookPropertyService.setEditingRoomInfo(this.defaultData,this.selectedUnits)}initializePage(){switch(this.defaultData.event_type){case"SPLIT_BOOKING":this.showSplitBookingOption=true;this.page="page_one";break;case"BLOCK_DATES":this.page="page_block_date";break;default:this.page="page_one";break}}async fetchSetupEntries(){return await this.bookingService.fetchSetupEntries()}isGuestDataIncomplete(){for(const t in n.ratePlanSelections){const e=n.ratePlanSelections[t];for(const t in e){const i=e[t];if(i.reserved>0){for(const t of i.guest){if(t.first_name===""||t.last_name===""){return true}}}}}return false}isButtonDisabled(){const t=(t,e,i)=>{if(!t){return true}if(t===this.guestData){return this.isGuestDataIncomplete()}if(e==="selectedArrivalTime"){if(t[e]!==undefined){return t[e].code===""}else{return true}}return t[e]===i||t[e]===undefined};return t(this.guestData,"guestName","")||t(this.bookedByInfoData,"firstName","")||t(this.bookedByInfoData,"lastName","")||t(this.bookedByInfoData,"selectedArrivalTime","")}setSourceOptions(t){this.sourceOptions=t.map((t=>({id:t.id,value:t.description,tag:t.tag,type:t.type})));if(this.isEventType("EDIT_BOOKING")){this.sourceOption=Object.assign({},this.defaultData.SOURCE)}else{this.sourceOption={code:t[0].code,description:t[0].description,tag:t[0].tag,type:t[0].type,id:t[0].id}}}setOtherProperties(t){this.ratePricingMode=t===null||t===void 0?void 0:t.ratePricingMode;this.bookedByInfoData.arrivalTime=t.arrivalTime;this.bedPreferenceType=t.bedPreferenceType}async checkBookingAvailability(){h();const t=w(this.dateRangeData.fromDate).format("YYYY-MM-DD");const e=w(this.dateRangeData.toDate).format("YYYY-MM-DD");const i=this.sourceOption["type"]==="TRAVEL_AGENCY";try{const s=this.isEventType("EDIT_BOOKING")?[this.defaultData.RATE_TYPE]:[];const o=this.isEventType("BAR_BOOKING")?this.defaultData.roomsInfo.map((t=>t.id)):[];const a=await this.bookingService.getBookingAvailability({from_date:t,to_date:e,propertyid:this.propertyid,adultChildCount:this.adultChildCount,language:this.language,room_type_ids:o,currency:this.currency,agent_id:i?this.sourceOption["tag"]:null,is_in_agent_mode:i,room_type_ids_to_update:s});if(!this.isEventType("EDIT_BOOKING")){this.defaultData.defaultDateRange.fromDate=new Date(this.dateRangeData.fromDate);this.defaultData.defaultDateRange.toDate=new Date(this.dateRangeData.toDate)}this.defaultData=Object.assign(Object.assign({},this.defaultData),{roomsInfo:a});if(this.isEventType("EDIT_BOOKING")&&!this.updatedBooking){this.updateBooking()}}catch(t){console.error("Error initializing booking availability:",t)}}updateBooking(){var t,e,i;try{const{currentRoomType:s,GUEST:o}=this.defaultData;const a=s.roomtype.id;const n=s.rateplan.id;console.log({GUEST:o});const r={bed_preference:(t=s.bed_preference)===null||t===void 0?void 0:t.toString(),infant_nbr:s.occupancy.infant_nbr,last_name:o.last_name,first_name:o.first_name,unit:(i=(e=s.unit)===null||e===void 0?void 0:e.id)===null||i===void 0?void 0:i.toString(),roomtype_id:s.roomtype.id};l("guest",r);u({roomTypeId:a,ratePlanId:n,rooms:1,guest:[r]})}catch(t){console.error(t)}}async checkAndBlockDate(){try{const{block_exposed_unit_props:t}=this.defaultData;await this.bookingService.getBookingAvailability({from_date:t.from_date,to_date:t.to_date,propertyid:this.propertyid,adultChildCount:{adult:2,child:0},language:this.language,room_type_ids:this.defaultData.roomsInfo.map((t=>t.id)),currency:this.currency});const e=n.roomTypes.every((t=>{if(t.is_available_to_book){return true}return t.inventory>0&&t["not_available_reason"]==="ALL-RATES-PLAN-NOT-BOOKABLE"}));if(e){await this.handleBlockDate(false)}else{console.log("Blocked date is unavailable. Continuing...")}}catch(t){console.error("Error checking and blocking date:",t)}}async closeWindow(){h();b(false);if(this.wasBlockedUnit&&!this.didReservation){await this.checkAndBlockDate()}const t=document.querySelector(".sideWindow");if(!t)return;t.classList.add("sideWindow--exit");setTimeout((()=>{this.closeBookingWindow.emit();document.removeEventListener("keydown",this.handleKeyDown)}),300)}isEventType(t){return this.defaultData.event_type===t}handleBlockDateUpdate(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.blockDatesData=e.data}handleGuestInfoUpdate(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;if(e.guestRefKey){if(this.isEventType("BAR_BOOKING")||this.wasBlockedUnit||this.isEventType("SPLIT_BOOKING")){this.guestData[e.guestRefKey]=Object.assign(Object.assign({},e.data),{roomId:this.defaultData.PR_ID})}else this.guestData[e.guestRefKey]=e.data}}handleBookedByInfoUpdate(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.bookedByInfoData=e.value.data}renderPage(){this.renderAgain=!this.renderAgain}gotoPage(t){this.page=t;this.renderPage()}getPageBlockDatesView(){return i(s,null,i("igl-block-dates-view",{fromDate:this.defaultData.FROM_DATE,toDate:this.defaultData.TO_DATE,entryDate:this.defaultData.ENTRY_DATE,onDataUpdateEvent:t=>this.handleBlockDateUpdate(t)}))}handlePageTwoDataUpdateEvent(t){t.stopImmediatePropagation();t.stopPropagation();if(t.detail.key==="propertyBookedBy"){this.handleBookedByInfoUpdate(t)}else{this.handleGuestInfoUpdate(t)}}async handleBlockDate(t=true){const e=this.wasBlockedUnit?this.defaultData.block_exposed_unit_props:(()=>{const t=p(+this.blockDatesData.RELEASE_AFTER_HOURS);return Object.assign({from_date:m(this.defaultData.defaultDateRange.fromDate),to_date:m(this.defaultData.defaultDateRange.toDate),NOTES:this.blockDatesData.OPTIONAL_REASON||"",pr_id:this.defaultData.PR_ID.toString(),STAY_STATUS_CODE:this.blockDatesData.OUT_OF_SERVICE?"004":this.blockDatesData.RELEASE_AFTER_HOURS===0?"002":"003",DESCRIPTION:this.blockDatesData.RELEASE_AFTER_HOURS||""},t)})();await this.bookingService.blockUnit(e);if(t)this.closeWindow()}async bookUser(t){this.setLoadingState(t);if(this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")){if(this.isGuestDataIncomplete()){this.isLoading="";return}}else if(this.isButtonDisabled()){this.isLoading="";return}try{if(this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")){this.bookedByInfoData.message=this.defaultData.NOTES}this.didReservation=true;const e=await this.bookPropertyService.prepareBookUserServiceParams({context:this,sourceOption:this.sourceOption,check_in:t});await this.bookingService.doReservation(e);await this.adjustBlockedDatesAfterReservation(e);this.resetBookingEvt.emit(null)}catch(t){console.error("Error booking user:",t)}finally{this.resetLoadingState()}}async adjustBlockedDatesAfterReservation(t){if(!this.wasBlockedUnit){return}const e=w(this.defaultData.block_exposed_unit_props.from_date,"YYYY-MM-DD");const i=w(t.booking.from_date,"YYYY-MM-DD");const s=w(this.defaultData.block_exposed_unit_props.to_date,"YYYY-MM-DD");const o=w(t.booking.to_date,"YYYY-MM-DD");if(o.isBefore(s,"days")){const t=Object.assign(Object.assign({},this.defaultData.block_exposed_unit_props),{from_date:o.format("YYYY-MM-DD")});await this.bookingService.blockUnit(t)}if(i.isAfter(e,"days")){const t=Object.assign(Object.assign({},this.defaultData.block_exposed_unit_props),{to_date:i.format("YYYY-MM-DD")});await this.bookingService.blockUnit(t)}return}setLoadingState(t){if(this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")){this.isLoading="save"}else{this.isLoading=t?"bookAndCheckIn":"book"}}resetLoadingState(){this.isLoading="";setTimeout((()=>{this.closeWindow()}),100)}getCurrentPage(t){return this.page===t}render(){return i(o,{key:"324bdfc36b285205b2975314060fa56eb1a16b41","data-testid":"book_property_sheet h-100"},i("div",{key:"c784d8ccf59d03deba46bb2ac88d03d535d3b11d",class:"background-overlay",onClick:()=>this.closeWindow()}),i("div",{key:"a11b29b1e21940deadb6f50b95a965412c9bd5c3",class:"sideWindow sheet-container "+(this.getCurrentPage("page_block_date")?"block-date":"")},O("/Get_Setup_Entries_By_TBL_NAME_MULTI")?i("div",{class:"loading-container"},i("ir-spinner",null)):i(s,null,i("div",{class:"sheet-header"},i("div",{class:"card-header-container mb-2"},i("h3",{class:"text-left font-medium-2 px-2"},this.getCurrentPage("page_block_date")?this.defaultData.BLOCK_DATES_TITLE:this.defaultData.TITLE),i("ir-icon",{class:"px-2",onIconClickHandler:()=>{this.closeWindow()}},i("svg",{slot:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:20,width:20},i("path",{fill:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))))),i("div",{class:"px-2 sheet-body"},this.getCurrentPage("page_one")&&i("igl-booking-overview-page",{wasBlockedUnit:this.wasBlockedUnit,initialRoomIds:this.initialRoomIds,defaultDaterange:this.defaultDateRange,eventType:this.defaultData.event_type,selectedRooms:this.selectedUnits,currency:this.currency,showSplitBookingOption:this.showSplitBookingOption,ratePricingMode:this.ratePricingMode,dateRangeData:this.dateRangeData,bookingData:this.defaultData,adultChildCount:this.adultChildCount,bookedByInfoData:this.bookedByInfoData,adultChildConstraints:this.adultChildConstraints,sourceOptions:this.sourceOptions,propertyId:this.propertyid}),this.getCurrentPage("page_two")&&i("igl-booking-form",{currency:this.currency,propertyId:this.propertyid,showPaymentDetails:this.showPaymentDetails,selectedGuestData:this.guestData,countries:this.countries,isLoading:this.isLoading,selectedRooms:this.selectedUnits,bedPreferenceType:this.bedPreferenceType,dateRangeData:this.dateRangeData,bookingData:this.defaultData,showSplitBookingOption:this.showSplitBookingOption,language:this.language,bookedByInfoData:this.bookedByInfoData,defaultGuestData:this.defaultData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),onDataUpdateEvent:t=>this.handlePageTwoDataUpdateEvent(t)}),this.getCurrentPage("page_block_date")?this.getPageBlockDatesView():null),this.getCurrentPage("page_block_date")?i("div",{class:"sheet-footer"},i("ir-button",{text:D.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClick:()=>this.closeWindow()}),i("ir-button",{text:D.entries.Lcz_Blockdates,isLoading:O("/Block_Exposed_Unit"),class:"flex-fill",onClick:()=>this.handleBlockDate()})):i("igl-book-property-footer",{page:this.page,dateRangeData:this.dateRangeData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),isLoading:this.isLoading,class:"sheet-footer",eventType:this.bookingData.event_type}))))}};W.style=U+V;const q=".sc-igl-book-property-footer-h{width:100% !important;background:#000}";const X=q;const J=class{constructor(i){t(this,i);this.buttonClicked=e(this,"buttonClicked",7);this.disabled=true}isEventType(t){return t===this.eventType}editNext(t){if(this.isEventType("EDIT_BOOKING")){if(t==="Cancel"){return"flex-fill"}else{return"d-none d-md-block  flex-fill"}}return"flex-fill"}renderButton({label:t,type:e,disabled:s,icon_name:o,isLoading:a,icon_position:n="right"}){return i("div",{class:this.shouldRenderTwoButtons()?` ${this.editNext(t)}`:"flex-fill"},i("ir-button",{isLoading:a,btn_color:e==="cancel"||e==="back"?"secondary":"primary",text:t,btn_disabled:s,onClickHandler:()=>{this.buttonClicked.emit({key:e})},class:"full-width",btn_styles:"justify-content-center",icon_name:o,iconPosition:n,style:{"--icon-size":"1rem"},icon_style:{paddingBottom:"1.9px"}}))}shouldRenderTwoButtons(){return this.isEventType("PLUS_BOOKING")||this.isEventType("ADD_ROOM")||this.isEventType("EDIT_BOOKING")}render(){var t;if(this.page==="page_one"){return i(o,null,this.isEventType("EDIT_BOOKING")?i(s,null,this.renderButton({type:"cancel",label:D.entries.Lcz_Cancel}),this.shouldRenderTwoButtons()&&this.renderButton({type:"next",label:`${D.entries.Lcz_Next}`,disabled:O("/Get_Exposed_Booking_Availability"),icon_name:"angles_right"})):i(s,null,this.renderButton({type:"cancel",label:D.entries.Lcz_Cancel}),this.shouldRenderTwoButtons()&&this.renderButton({type:"next",label:`${D.entries.Lcz_Next}`,icon_name:"angles_right"})))}const e=C.checkin_enabled&&w(new Date((t=this.dateRangeData)===null||t===void 0?void 0:t.fromDate)).isSame(new Date,"day");return i(s,null,this.isEditOrAddRoomEvent?i(s,null,this.renderButton({type:"back",icon_position:"left",label:D.entries.Lcz_Back,icon_name:"angles_left"}),this.renderButton({type:"save",label:D.entries.Lcz_Save,isLoading:this.isLoading==="save"})):i(s,null,this.renderButton({type:"back",icon_position:"left",label:D.entries.Lcz_Back,icon_name:"angles_left"}),this.renderButton({type:"book",label:D.entries.Lcz_Book,isLoading:this.isLoading==="book"}),e&&this.renderButton({type:"bookAndCheckIn",label:D.entries.Lcz_BookAndChekcIn,isLoading:this.isLoading==="bookAndCheckIn"})))}};J.style=X;const Q=".sc-igl-booking-form-h{display:flex;flex-direction:column}";const Z=Q;const tt=class{constructor(i){t(this,i);this.dataUpdateEvent=e(this,"dataUpdateEvent",7);this.buttonClicked=e(this,"buttonClicked",7);this.selectedUnits={}}componentWillLoad(){this.initializeGuestData();this.selectedBookedByData=this.bookedByInfoData}initializeGuestData(){let t=0;const e=Object.assign({},this.selectedUnits);const i=(t,e,i,s)=>{if(i&&s===2){return t*e}return t};this.selectedUnits=e;this.guestData=[];this.selectedRooms.forEach(((s,o)=>{s.forEach((s=>{e[o]=s.selectedUnits;t+=s.totalRooms*i(s.rate,this.dateRangeData.dateDifference,s.isRateModified,s.rateType);for(let t=1;t<=s.totalRooms;t++){this.guestData.push(Object.assign({guestName:"",roomId:"",preference:""},s))}}))}));this.bookingData.TOTAL_PRICE=t}handleOnApplicationInfoDataUpdateEvent(t,e){const i=t.detail;const s=`c_${i.data.roomCategoryId}`;const o=[...this.selectedUnits[s]||[]];o[e]=i.data.roomId;this.selectedUnits=Object.assign(Object.assign({},this.selectedUnits),{[s]:o});this.dataUpdateEvent.emit({key:"applicationInfoUpdateEvent",value:t.detail})}handleEventData(t,e,i){if(e==="application-info"){this.handleOnApplicationInfoDataUpdateEvent(t,i)}else{this.selectedBookedByData=t.detail.data;this.dataUpdateEvent.emit({key:"propertyBookedBy",value:t.detail})}}isGuestDataIncomplete(){if(this.selectedGuestData.length!==this.guestData.length){return true}for(const t of this.selectedGuestData){if(t.guestName===""||t.preference===""||t.roomId===""){return true}}return false}isButtonDisabled(t){const e=(t,e,i)=>{if(!t){return true}if(t===this.selectedGuestData){return this.isGuestDataIncomplete()}if(e==="selectedArrivalTime"){if(t[e]!==undefined){return t[e].code===""}else{return true}}return t[e]===i||t[e]===undefined};return this.isLoading===t||e(this.selectedGuestData,"guestName","")||e(this.selectedBookedByData,"isdCode","")||e(this.selectedBookedByData,"contactNumber","")||e(this.selectedBookedByData,"firstName","")||e(this.selectedBookedByData,"lastName","")||e(this.selectedBookedByData,"countryId",-1)||e(this.selectedBookedByData,"selectedArrivalTime","")||e(this.selectedBookedByData,"email","")}render(){return i("div",{key:"3190328c2638fb7119081614d2a79f6edf915af0",class:"d-flex flex-column h-100"},i("div",{key:"e2d0e208954b0465f205238bfb6e03657381ff84",class:"d-flex flex-wrap"},i("ir-date-view",{key:"40239b7700bfe2e03a466609b1996f0a45bad6b0",class:"mr-1 flex-fill font-weight-bold font-medium-1",from_date:new Date(this.dateRangeData.fromDate),to_date:new Date(this.dateRangeData.toDate),dateOption:"DD MMM YYYY"}),this.guestData.length>1&&i("div",{key:"e3840c69deb186376d4e45079e28cf847179e28d",class:"mt-1 mt-md-0 text-right"},D.entries.Lcz_TotalPrice," ",i("span",{key:"5edd663ca6455f0e939c479795f1de6ade494cc4",class:"font-weight-bold font-medium-1"},g(this.currency.symbol,this.bookingData.TOTAL_PRICE||"0")))),Object.values(n.ratePlanSelections).map((t=>Object.values(t).map((t=>{const e=t;if(e.reserved===0){return null}return[...new Array(e.reserved)].map(((t,s)=>i("igl-application-info",{totalNights:Number(this.dateRangeData.dateDifference),bedPreferenceType:this.bedPreferenceType,currency:this.currency,guestInfo:e.guest?e.guest[s]:null,bookingType:this.bookingData.event_type,rateplanSelection:e,key:`${e.ratePlan.id}_${s}`,roomIndex:s,baseData:this.bookingData.event_type==="EDIT_BOOKING"?{roomtypeId:this.bookingData.currentRoomType.roomtype.id,unit:this.bookingData.currentRoomType.unit}:undefined})))})))),this.isEditOrAddRoomEvent||this.showSplitBookingOption?null:i("igl-property-booked-by",{propertyId:this.propertyId,countries:this.countries,language:this.language,showPaymentDetails:this.showPaymentDetails,defaultData:this.bookedByInfoData,onDataUpdateEvent:t=>{this.handleEventData(t,"propertyBookedBy",0)}}))}};tt.style=Z;const et=".sc-igl-booking-overview-page-h{display:block}.sc-igl-booking-overview-page-h>*.sc-igl-booking-overview-page{margin:0;padding:auto}.scrollContent.sc-igl-booking-overview-page{height:calc(100% - 79px);overflow:auto;position:relative}.loading-container.sc-igl-booking-overview-page{display:flex;align-items:center;justify-content:center;height:100%;background:white;position:absolute;inset:0;z-index:100}.loader.sc-igl-booking-overview-page{width:1.25rem;height:1.25rem;border:2.5px solid #3f3f3f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}";const it=et;const st=class{constructor(i){t(this,i);this.roomsDataUpdate=e(this,"roomsDataUpdate",7)}getSplitBookings(){return this.bookingData.hasOwnProperty("splitBookingEvents")&&this.bookingData.splitBookingEvents||[]}isEventType(t){return t===this.eventType}setMinDate(){if(!this.isEventType("EDIT_BOOKING")){return}const t=w(this.bookingData.FROM_DATE,"YYYY-MM-DD");const e=w();if(t.isAfter(e)){return e.add(-2,"weeks").format("YYYY-MM-DD")}return t.add(-2,"weeks").format("YYYY-MM-DD")}render(){var t;return i(o,{key:"7dbcbd3460de6c6003d500e273c9dee471328e79"},i("igl-book-property-header",{key:"3c39cdf58e0888b5d12bb5a1b684660379b7150d",wasBlockedUnit:this.wasBlockedUnit,bookedByInfoData:this.bookedByInfoData,defaultDaterange:this.defaultDaterange,dateRangeData:this.dateRangeData,minDate:this.setMinDate(),adultChildCount:this.adultChildCount,splitBookingId:this.showSplitBookingOption,bookingData:this.bookingData,sourceOptions:this.sourceOptions,message:this.message,bookingDataDefaultDateRange:this.bookingData.defaultDateRange,showSplitBookingOption:this.showSplitBookingOption,adultChildConstraints:this.adultChildConstraints,splitBookings:this.getSplitBookings(),propertyId:this.propertyId}),i("div",{key:"801e9ca572ce8029c5a7c1877cdb0ec8d732c1b1",class:" text-left"},O("/Check_Availability")&&this.isEventType("EDIT_BOOKING")?i("div",{class:"loading-container"},i("div",{class:"loader"})):i(s,null,(t=n.roomTypes)===null||t===void 0?void 0:t.map((t=>i("igl-room-type",{initialRoomIds:this.initialRoomIds,isBookDisabled:Object.keys(this.bookedByInfoData).length<=1,key:`room-type-${t.id}`,currency:this.currency,ratePricingMode:this.ratePricingMode,dateDifference:this.dateRangeData.dateDifference,bookingType:this.bookingData.event_type,roomType:t,class:"mt-2 mb-1 p-0","data-testid":`room_type_${t.id}`,id:t.id.toString(),roomInfoId:this.selectedRooms.has(`c_${t.id}`)?t.id:null,onDataUpdateEvent:t=>this.roomsDataUpdate.emit(t.detail)}))))))}};st.style=it;const ot=".sc-ir-booking-details-h{overflow-x:hidden;--ir-dialog-max-width:20rem;font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-booking-details-h *.sc-ir-booking-details{font-family:inherit !important;font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.font-medium.sc-ir-booking-details{font-weight:600}.sc-ir-booking-details-h th.sc-ir-booking-details{font-weight:600}.h-28.sc-ir-booking-details{height:2rem}.mx-01.sc-ir-booking-details{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}.date-margin.sc-ir-booking-details{margin-right:5px}.pickup-margin.sc-ir-booking-details{margin-bottom:7px !important}.header-date.sc-ir-booking-details{padding-left:5px !important}.pointer.sc-ir-booking-details{cursor:pointer}.sc-ir-booking-details:root{--sidebar-width:50rem}.loading-container.sc-ir-booking-details{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.sm-padding-right.sc-ir-booking-details{padding-right:0.2rem}.sm-padding-left.sc-ir-booking-details{padding-left:0.2rem}.sm-padding-top.sc-ir-booking-details{padding-top:0.2rem}.sm-padding-bottom.sc-ir-booking-details{padding-bottom:0.2rem}.info-notes.sc-ir-booking-details{list-style:none;padding-left:0}.light-blue-bg.sc-ir-booking-details{background-color:#acecff;padding:0.2rem 0.3rem}.iframeHeight.sc-ir-booking-details{height:17.5rem}.dialog-title.sc-ir-booking-details{width:fit-content}";const at=ot;const nt=class{constructor(i){t(this,i);this.toast=e(this,"toast",7);this.bookingChanged=e(this,"bookingChanged",7);this.closeSidebar=e(this,"closeSidebar",7);this.language="en";this.ticket="";this.bookingNumber="";this.is_from_front_desk=false;this.hasPrint=false;this.hasReceipt=false;this.hasDelete=false;this.hasMenu=false;this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.hasCloseButton=false;this.bookingItem=null;this.statusData=[];this.calendarData={};this.guestData=null;this.rerenderFlag=false;this.sidebarState=null;this.isUpdateClicked=false;this.isPMSLogLoading=false;this.modalState=null;this.bookingService=new r;this.roomService=new I;this.paymentService=new M;this.token=new E;this.printingBaseUrl="https://gateway.igloorooms.com/PrintBooking/%1/printing?id=%2"}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}ticketChanged(t,e){if(t===e){return}this.token.setToken(this.ticket);this.initializeApp()}handleSideBarEvents(t){this.sidebarState=t.detail.type;this.sidebarPayload=t.detail.payload}handleIconClick(t){const e=t.target;switch(e.id){case"pickup":this.sidebarState="pickup";return;case"close":this.closeSidebar.emit(null);return;case"email":this.modalState={type:"email",message:D.entries.Lcz_EmailBookingto.replace("%1",this.booking.guest.email),loading:O("/Send_Booking_Confirmation_Email")};this.modalRef.openModal();return;case"print":this.openPrintingScreen();return;case"receipt":this.openPrintingScreen("invoice");return;case"book-delete":return;case"menu":window.location.href="https://x.igloorooms.com/manage/acbookinglist.aspx";return;case"room-add":this.bookingItem={ID:"",NAME:this.booking.guest.last_name,EMAIL:this.booking.guest.email,PHONE:this.booking.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.booking.from_date,ARRIVAL:this.booking.arrival,TO_DATE:this.booking.to_date,TITLE:`${D.entries.Lcz_AddingUnitToBooking}# ${this.booking.booking_nbr}`,defaultDateRange:{fromDate:new Date(this.booking.from_date),fromDateStr:"",toDate:new Date(this.booking.to_date),toDateStr:"",dateDifference:0,message:""},event_type:"ADD_ROOM",booking:this.booking,BOOKING_NUMBER:this.booking.booking_nbr,ADD_ROOM_TO_BOOKING:this.booking.booking_nbr,GUEST:this.booking.guest,message:this.booking.remark,SOURCE:this.booking.source,ROOMS:this.booking.rooms};return;case"extra_service_btn":this.sidebarState="extra_service";return;case"add-payment":return}}async handleResetExposedCancellationDueAmount(t){t.stopImmediatePropagation();t.stopPropagation();const e=await this.paymentService.GetExposedCancellationDueAmount({booking_nbr:this.booking.booking_nbr,currency_id:this.booking.currency.id});this.paymentActions=[...e]}handleEditInitiated(t){this.bookingItem=t.detail}handleRoomGuestsUpdate(t){const{identifier:e,guests:i}=t.detail;const s=[...this.booking.rooms];let o=s.findIndex((t=>t.identifier===e));if(o===-1){return}const a=s[o];const n=Object.assign(Object.assign({},a),{sharing_persons:i});s[o]=n;this.booking=Object.assign(Object.assign({},this.booking),{rooms:[...s]})}async handleResetBooking(t){t.stopPropagation();t.stopImmediatePropagation();if(t.detail){return this.booking=t.detail}await this.resetBooking()}handleEditExtraService(t){this.selectedService=t.detail;this.sidebarState="extra_service"}setRoomsData(t){var e,i;let s=new Array;if((i=(e=t.My_Result)===null||e===void 0?void 0:e.roomtypes)===null||i===void 0?void 0:i.length){s=t.My_Result.roomtypes;t.My_Result.roomtypes.forEach((t=>{t.expanded=true}))}this.calendarData.roomsInfo=s}async initializeApp(){var t,e;try{const[i,s,o,a,n]=await Promise.all([this.roomService.getExposedProperty({id:this.propertyid||0,language:this.language,aname:this.p}),this.roomService.fetchLanguage(this.language),this.bookingService.getCountries(this.language),this.bookingService.getExposedBooking(this.bookingNumber,this.language),this.bookingService.getSetupEntriesByTableNameMulti(["_BED_PREFERENCE_TYPE","_DEPARTURE_TIME"])]);this.property_id=(t=i===null||i===void 0?void 0:i.My_Result)===null||t===void 0?void 0:t.id;const{bed_preference_type:r,departure_time:l}=this.bookingService.groupEntryTablesResult(n);this.bedPreference=r;this.departureTime=l;console.log(l);if((a===null||a===void 0?void 0:a.booking_nbr)&&((e=a===null||a===void 0?void 0:a.currency)===null||e===void 0?void 0:e.id)&&a.is_direct){this.paymentService.GetExposedCancellationDueAmount({booking_nbr:a.booking_nbr,currency_id:a.currency.id}).then((t=>{this.paymentActions=t}))}if(!(D===null||D===void 0?void 0:D.entries)){D.entries=s.entries;D.direction=s.direction}this.countries=o;const c=i===null||i===void 0?void 0:i.My_Result;if(c){const{allowed_payment_methods:t,currency:e,allowed_booking_sources:s,adult_child_constraints:o,calendar_legends:a,aname:n}=c;this.printingBaseUrl=this.printingBaseUrl.replace("%1",n).replace("%2",this.bookingNumber);this.calendarData={currency:e,allowed_booking_sources:s,adult_child_constraints:o,legendData:a};this.setRoomsData(i);const r=["001","004"];this.showPaymentDetails=t===null||t===void 0?void 0:t.some((t=>r.includes(t.code)))}else{console.warn("Room response is missing 'My_Result'.")}this.guestData=a.guest;this.booking=a}catch(t){console.error("Error initializing app:",t)}}async openPrintingScreen(t="print",e="new"){if(e==="old"){if(t==="invoice"){return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.booking.system_id}&&PM=I&TK=${this.ticket}`)}return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.booking.system_id}&&PM=B&TK=${this.ticket}`)}let i=this.printingBaseUrl;if(t==="invoice"){i=i+"&mode=invoice"}const{data:s}=await Y.post(`Get_ShortLiving_Token`);if(!s.ExceptionMsg){i=i+`&token=${s.My_Result}`}window.open(i)}handleCloseBookingWindow(){this.bookingItem=null}handleDeleteFinish(t){this.booking=Object.assign(Object.assign({},this.booking),{rooms:this.booking.rooms.filter((e=>e.identifier!==t.detail))})}async resetBooking(){try{const t=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);this.booking=Object.assign({},t);this.bookingChanged.emit(this.booking)}catch(t){console.log(t)}}async handleModalConfirm(t){t.stopImmediatePropagation();t.stopPropagation();switch(this.modalState.type){case"email":await this.bookingService.sendBookingConfirmationEmail(this.booking.booking_nbr,this.language);break}this.modalState=null;this.modalRef.closeModal()}renderSidebarContent(){var t,e,s,o,a,n;const r=()=>{this.sidebarState=null};switch(this.sidebarState){case"guest":return i("ir-guest-info",{isInSideBar:true,headerShown:true,slot:"sidebar-body",booking_nbr:this.bookingNumber,email:(t=this.booking)===null||t===void 0?void 0:t.guest.email,language:this.language,onCloseSideBar:r});case"pickup":return i("ir-pickup",{bookingDates:{from:this.booking.from_date,to:this.booking.to_date},slot:"sidebar-body",defaultPickupData:this.booking.pickup_info,bookingNumber:this.booking.booking_nbr,numberOfPersons:this.booking.occupancy.adult_nbr+this.booking.occupancy.children_nbr,onCloseModal:r});case"extra_note":return i("ir-booking-extra-note",{slot:"sidebar-body",booking:this.booking,onCloseModal:()=>this.sidebarState=null});case"extra_service":return i("ir-extra-service-config",{service:this.selectedService,booking:{from_date:this.booking.from_date,to_date:this.booking.to_date,booking_nbr:this.booking.booking_nbr,currency:this.booking.currency},slot:"sidebar-body",onCloseModal:()=>{r();if(this.selectedService){this.selectedService=null}}});case"room-guest":return i("ir-room-guests",{countries:this.countries,language:this.language,identifier:(e=this.sidebarPayload)===null||e===void 0?void 0:e.identifier,bookingNumber:this.booking.booking_nbr,roomName:(s=this.sidebarPayload)===null||s===void 0?void 0:s.roomName,totalGuests:(o=this.sidebarPayload)===null||o===void 0?void 0:o.totalGuests,sharedPersons:(a=this.sidebarPayload)===null||a===void 0?void 0:a.sharing_persons,slot:"sidebar-body",checkIn:(n=this.sidebarPayload)===null||n===void 0?void 0:n.checkin,onCloseModal:r});default:return null}}render(){var t,e,o;if(!this.booking){return i("div",{class:"loading-container"},i("ir-spinner",null))}return[i(s,null,!this.is_from_front_desk&&i(s,null,i("ir-toast",null),i("ir-interceptor",null))),i("ir-booking-header",{booking:this.booking,hasCloseButton:this.hasCloseButton,hasDelete:this.hasDelete,hasMenu:this.hasMenu,hasPrint:this.hasPrint,hasReceipt:this.hasReceipt,hasEmail:["001","002"].includes((e=(t=this.booking)===null||t===void 0?void 0:t.status)===null||e===void 0?void 0:e.code)}),i("div",{class:"fluid-container p-1 text-left mx-0"},i("div",{class:"row m-0"},i("div",{class:"col-12 p-0 mx-0 pr-lg-1 col-lg-6"},i("ir-reservation-information",{countries:this.countries,booking:this.booking}),i("div",{class:"font-size-large d-flex justify-content-between align-items-center mb-1"},i("ir-date-view",{from_date:this.booking.from_date,to_date:this.booking.to_date}),this.hasRoomAdd&&this.booking.is_editable&&i("ir-button",{id:"room-add",icon_name:"square_plus",variant:"icon",style:{"--icon-size":"1.5rem"}})),i("div",{class:"card p-0 mx-0"},this.booking.rooms.map(((t,e)=>{const s=this.handleRoomCheckin(t);const o=this.handleRoomCheckout(t);return[i("ir-room",{room:t,property_id:this.property_id,language:this.language,departureTime:this.departureTime,bedPreferences:this.bedPreference,isEditable:this.booking.is_editable,legendData:this.calendarData.legendData,roomsInfo:this.calendarData.roomsInfo,myRoomTypeFoodCat:t.roomtype.name,mealCodeName:t.rateplan.short_name,currency:this.booking.currency.symbol,hasRoomEdit:this.hasRoomEdit&&this.booking.status.code!=="003"&&this.booking.is_direct,hasRoomDelete:this.hasRoomDelete&&this.booking.status.code!=="003"&&this.booking.is_direct,hasCheckIn:s,hasCheckOut:o,booking:this.booking,bookingIndex:e,onDeleteFinished:this.handleDeleteFinish.bind(this)}),e!==this.booking.rooms.length-1&&i("hr",{class:"mr-2 ml-2 my-0 p-0"})]}))),i("ir-pickup-view",{booking:this.booking}),i("section",null,i("div",{class:"font-size-large d-flex justify-content-between align-items-center mb-1"},i("p",{class:"font-size-large p-0 m-0 "},D.entries.Lcz_ExtraServices),i("ir-button",{id:"extra_service_btn",icon_name:"square_plus",variant:"icon",style:{"--icon-size":"1.5rem"}})),i("ir-extra-services",{booking:{booking_nbr:this.booking.booking_nbr,currency:this.booking.currency,extra_services:this.booking.extra_services}}))),i("div",{class:"col-12 p-0 m-0 pl-lg-1 col-lg-6"},i("ir-payment-details",{paymentActions:this.paymentActions,bookingDetails:this.booking})))),i("ir-modal",{modalBody:(o=this.modalState)===null||o===void 0?void 0:o.message,leftBtnText:D.entries.Lcz_Cancel,rightBtnText:D.entries.Lcz_Confirm,autoClose:false,isLoading:O("/Send_Booking_Confirmation_Email"),ref:t=>this.modalRef=t,onConfirmModal:t=>{this.handleModalConfirm(t)},onCancelModal:()=>{this.modalRef.closeModal()}}),i("ir-sidebar",{open:this.sidebarState!==null,side:"right",id:"editGuestInfo",style:{"--sidebar-width":this.sidebarState==="room-guest"?"60rem":undefined},onIrSidebarToggle:t=>{t.stopImmediatePropagation();t.stopPropagation();this.sidebarState=null},showCloseButton:false},this.renderSidebarContent()),i(s,null,this.bookingItem&&i("igl-book-property",{allowedBookingSources:this.calendarData.allowed_booking_sources,adultChildConstraints:this.calendarData.adult_child_constraints,showPaymentDetails:this.showPaymentDetails,countries:this.countries,currency:this.calendarData.currency,language:this.language,propertyid:this.property_id,bookingData:this.bookingItem,onCloseBookingWindow:()=>this.handleCloseBookingWindow()}))]}handleRoomCheckout(t){if(!C.checkin_enabled||C.is_automatic_check_in_out){return false}return t.in_out.code==="001"}handleRoomCheckin(t){if(!C.checkin_enabled||C.is_automatic_check_in_out){return false}if(!t.unit){return false}if(t.in_out&&t.in_out.code!=="000"){return false}if(w().isSameOrAfter(w(t.from_date,"YYYY-MM-DD"),"days")&&w().isBefore(w(t.to_date,"YYYY-MM-DD"),"days")){return true}return false}get element(){return a(this)}static get watchers(){return{ticket:["ticketChanged"]}}};nt.style=at;const rt=".sc-ir-booking-extra-note-h{display:block}";const lt=rt;const ct=".sc-ir-booking-extra-note-h{height:100%}.sheet-container.sc-ir-booking-extra-note{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-booking-extra-note{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-booking-extra-note{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-booking-extra-note{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-booking-extra-note{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-booking-extra-note{flex-direction:row;align-items:center}}";const dt=ct;const ht=class{constructor(i){t(this,i);this.closeModal=e(this,"closeModal",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.isLoading=false;this.note="";this.bookingService=new r}componentWillLoad(){if(this.booking.extras){this.setNote(v(this.booking.extras))}}setNote(t){this.note=t}async savePrivateNote(){try{this.isLoading=true;let t=this.booking.extras||[];const e={key:"private_note",value:this.note};if(t.length===0){t.push(e)}else{const i=t.findIndex((t=>t.key==="private_note"));if(i===-1){t.push(e)}else{t[i]=e}}const i=await this.bookingService.doReservation({assign_units:true,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,booking:this.booking,Is_Non_Technical_Change:true,extras:t});this.resetBookingEvt.emit(i);this.closeModal.emit(null)}catch(t){console.error(t)}finally{this.isLoading=false}}render(){return i("form",{key:"8757a9b14433f8f0437db73943e852d0c6e9982e",class:"sheet-container h-100",onSubmit:t=>{t.preventDefault();this.savePrivateNote()}},i("ir-title",{key:"2a9518b13d8384801128ceb034c9831f56f81197",class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:D.entries.Lcz_PrivateNote,displayContext:"sidebar"}),i("div",{key:"d764895b338320b9101057551bd3e987a26dc44d",class:"sheet-body px-1"},i("ir-textarea",{key:"e79b1d2c840fc0618bfff1989c71f949b9bce9a2",placeholder:D.entries.Lcz_PrivateNote_MaxChar,label:"",value:this.note,maxLength:150,onTextChange:t=>this.setNote(t.detail)})),i("div",{key:"d99a1651a32c28494810d713846458784560ef0a",class:"sheet-footer"},i("ir-button",{key:"24cdb33e02da7f4a605752bbb1129a3039622b72",onClickHandler:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-sm-0 flex-fill  mr-sm-1'}`,text:D.entries.Lcz_Cancel,btn_color:"secondary"}),i("ir-button",{key:"5b2556b97a5cd71b7b7e33a79bb3548f082992f7",btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center ml-sm-1",isLoading:this.isLoading,text:D.entries.Lcz_Save,btn_color:"primary",btn_type:"submit"})))}};ht.style=lt+dt;const ut=".sc-ir-booking-header-h{display:block}.confirmed.sc-ir-booking-header{color:#fff;display:flex;align-items:center}.bg-ir-green.sc-ir-booking-header{background:#629a4c;padding:0.2rem 0.3rem}.bg-ir-red.sc-ir-booking-header{background:#ff4961;padding:0.2rem 0.3rem}.bg-ir-orange.sc-ir-booking-header{background:#ff9149;padding:0.2rem 0.3rem}";const ft=ut;const bt=class{constructor(i){t(this,i);this.toast=e(this,"toast",7);this.closeSidebar=e(this,"closeSidebar",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.openSidebar=e(this,"openSidebar",7);this.hasEmail=true;this.bookingStatus=null;this.confirmationBG={"001":"bg-ir-orange","002":"bg-ir-green","003":"bg-ir-red","004":"bg-ir-red"};this.bookingService=new r;this.alertMessage=`ALERT! Modifying an OTA booking will create a discrepancy between igloorooms and the source. Future guest modifications on the OTA may require manual adjustmentsofthebooking.`}handleSelectChange(t){t.stopPropagation();t.stopImmediatePropagation();const e=t.target;this.bookingStatus=e.selectedValue}async updateStatus(){if(!this.bookingStatus||this.bookingStatus==="-1"){this.toast.emit({type:"error",description:"",title:D.entries.Lcz_SelectStatus,position:"top-right"});return}try{await this.bookingService.changeExposedBookingStatus({book_nbr:this.booking.booking_nbr,status:this.bookingStatus});this.toast.emit({type:"success",description:"",title:D.entries.Lcz_StatusUpdatedSuccessfully,position:"top-right"});this.bookingStatus=null;this.resetBookingEvt.emit(null)}catch(t){console.log(t)}}openDialog(t){const{type:e}=t;this.currentDialogStatus=e;this.dialogRef.openModal()}renderDialogBody(){switch(this.currentDialogStatus){case"pms":return i("ir-pms-logs",{slot:"modal-body",bookingNumber:this.booking.booking_nbr});case"events-log":return i("ir-events-log",{booking:this.booking,slot:"modal-body",bookingNumber:this.booking.booking_nbr})}}render(){var t,e;const s=this.booking.ota_manipulations?this.booking.ota_manipulations[this.booking.ota_manipulations.length-1]:null;return i("div",{key:"3c3d87bac36d514f1a646bcc531f8181a2959ad3",class:"fluid-container px-1"},i("div",{key:"f9ec8af22a17c54bcabbeb0c898aea9be3e669a3",class:"d-flex flex-column p-0 mx-0 flex-lg-row align-items-md-center justify-content-between mt-1"},i("div",{key:"66cac96d4a3a93c2390af9b7fa36a57843bff369",class:"m-0 p-0 mb-1 mb-lg-0 mt-md-0"},i("p",{key:"d3dd41876966054096719dc0957c0b994d8666f6",class:"font-size-large m-0 p-0"},`${D.entries.Lcz_Booking}#${this.booking.booking_nbr}`),i("p",{key:"61fc7183441149ffd3a8143f50dd3b84a6301f80",class:"m-0 p-0"},!this.booking.is_direct&&i("span",{key:"3154b2ca8eb27fa458ce80adce9dc62de5d1f3d1",class:"mr-1 m-0"},this.booking.channel_booking_nbr))),i("div",{key:"40c8b010ef7d505a685736579bf869cd3ccf6601",class:"d-flex justify-content-end align-items-center",style:{gap:"1rem",flexWrap:"wrap"}},i("div",{key:"2a00e6e71ed34246a133ea16b8f3bf80ee2bcc5c",class:"d-flex flex-column align-items-center"},i("span",{key:"e805a54a664f03cd25064bb15bdae9c6b3578e56",class:`confirmed btn-sm m-0  ${this.confirmationBG[this.booking.is_requested_to_cancel?"003":this.booking.status.code]}`},this.booking.is_requested_to_cancel?D.entries.Lcz_CancellationRequested:this.booking.status.description),s&&i("ir-popover",{key:"890284168c55e8ea40b309bcc40938438ee26de3",trigger:"hover",renderContentAsHtml:true,content:`<div><p>Modified by ${s.user} at ${s.date} ${s.hour}:${s.minute}.</p>\n                <p>${this.alertMessage}</p></div>`},i("p",{key:"4e971132922d93124b9d92c43ac58f77b598bee4",class:"mx-0 p-0 small text-danger",style:{marginTop:"0.25rem",marginBottom:"0"}},i("b",{key:"b57a3fda9a32191895b0fe7a9170b7060c1c2b10"},"Modified")))),this.booking.allowed_actions.length>0&&this.booking.is_editable&&i("div",{key:"74c3c0ca1f68362339139a605869950ede97ba24",class:"m-0 p-0 d-flex align-items-center",style:{gap:"0.25rem"}},i("ir-select",{key:"9cd8231974d9ee6529e83ddc3d8f53633939c3b5",selectContainerStyle:"h-28",selectStyles:"d-flex status-select align-items-center h-28",firstOption:D.entries.Lcz_Select,id:"update-status",size:"sm","label-available":"false",data:this.booking.allowed_actions.map((t=>({text:t.description,value:t.code}))),textSize:"sm",class:"sm-padding-right m-0 ",selectedValue:this.bookingStatus}),i("ir-button",{key:"994867e657738df7a2a7a7272470697fb040133b",onClickHandler:()=>{if(!this.booking.is_direct){this.modalEl.openModal();return}this.updateStatus()},btn_styles:"h-28",isLoading:O("/Change_Exposed_Booking_Status"),btn_disabled:O("/Change_Exposed_Booking_Status"),id:"update-status-btn",size:"sm",text:"Update"})),i("ir-button",{key:"aef75d498e9a4008c71fc001ccbb3f2744160d6c",size:"sm",btn_color:"outline",text:D.entries.Lcz_EventsLog,onClickHandler:t=>{t.stopImmediatePropagation();t.stopPropagation();this.openDialog({type:"events-log"})}}),C.is_pms_enabled&&i("ir-button",{key:"b49e678efdd72bc5dd598aa45c6aa9f57f81c6cd",size:"sm",btn_color:"outline",text:D.entries.Lcz_pms,onClick:t=>{t.stopImmediatePropagation();t.stopPropagation();this.openDialog({type:"pms"})}}),this.hasReceipt&&i("ir-button",{key:"7c9620adf9076314d67eb8e7eab08e422125f948",variant:"icon",id:"receipt",icon_name:"reciept",class:"",style:{"--icon-size":"1.65rem"}}),this.hasPrint&&i("ir-button",{key:"7c5dc56951c0442c5fa87cae27338e9dba9ef5f9",variant:"icon",id:"print",icon_name:"print",class:"",style:{"--icon-size":"1.65rem"}}),this.hasEmail&&i("ir-button",{key:"4f695ad231b81123b24c9f64c1bc30894ccb2100",variant:"icon",id:"email",title:"Email this booking",icon_name:"email",class:"",style:{"--icon-size":"1.65rem"}}),this.hasDelete&&i("ir-button",{key:"652ab04e4c2f0433bd058d581793f9c3ec1aab1e",variant:"icon",id:"book-delete",icon_name:"trash",class:"",style:Object.assign(Object.assign({},B.danger),{"--icon-size":"1.65rem"})}),this.hasMenu&&i("ir-button",{key:"35bacee2053efa67ea8b8236b3af745c6fc9c440",variant:"icon",class:"mr-1",id:"menu",icon_name:"menu_list",style:{"--icon-size":"1.65rem"}}),this.hasCloseButton&&i("ir-button",{key:"3420792e92c346602b5f6544ff4683c76689a981",id:"close",variant:"icon",style:{"--icon-size":"1.65rem"},icon_name:"xmark",class:"ml-2",onClickHandler:t=>{t.stopPropagation();t.stopImmediatePropagation();this.closeSidebar.emit(null)}}))),i("ir-dialog",{key:"8bbd4e709d09a2d2988696666823c0b618185f16",onOpenChange:t=>{if(!t.detail){this.currentDialogStatus=null}},style:this.currentDialogStatus==="events-log"&&{"--ir-dialog-max-width":"max-content"},ref:t=>this.dialogRef=t},this.renderDialogBody()),i("ir-modal",{key:"c235f43ef868f60246f2ceea6194155b82413809",ref:t=>this.modalEl=t,modalTitle:"",leftBtnText:(t=D===null||D===void 0?void 0:D.entries)===null||t===void 0?void 0:t.Lcz_Cancel,rightBtnText:(e=D===null||D===void 0?void 0:D.entries)===null||e===void 0?void 0:e.Lcz_Confirm,modalBody:D.entries.Lcz_OTA_Modification_Alter,isLoading:O("/Change_Exposed_Booking_Status"),onConfirmModal:this.updateStatus.bind(this)}))}};bt.style=ft;const pt=":host{display:block;margin:0;padding:0;box-sizing:border-box}.backdrop{opacity:0;background:rgba(0, 0, 0, 0.2);position:fixed;inset:0;z-index:99999998}.backdrop[data-state='opened']{animation:overlayShow 150ms cubic-bezier(0.16, 1, 0.3, 1) forwards}.backdrop[data-state='closed']{opacity:0;pointer-events:none}.modal-container{box-sizing:border-box;margin:0;box-shadow:hsl(206 22% 7% / 35%) 0px 10px 38px -10px, hsl(206 22% 7% / 20%) 0px 10px 20px -15px;position:fixed;z-index:99999999;overflow-y:auto;top:50%;left:50%;background:white;transform:translate(-50%, -50%);width:90%;min-height:fit-content;height:fit-content;max-width:var(--ir-dialog-max-width, 40rem);min-width:var(--ir-dialog-min-width);max-height:85vh;border-radius:8px;padding:0;animation:contentShow 300ms cubic-bezier(0.16, 1, 0.3, 1)}.modal-footer ::slotted(*){flex-direction:row;align-items:center;justify-content:end;gap:8px;--ir-btn-width:inherit}.modal-footer{--ir-btn-width:100%}.modal-title ::slotted(*){font-size:18px;font-weight:600;color:#101828;margin-bottom:8px}.modal-body ::slotted(*){font-size:14px;font-weight:400;color:#475467;padding:0;margin:0}@keyframes overlayShow{from{opacity:0}to{opacity:1}}@keyframes contentShow{from{opacity:0;transform:translate(-50%, -48%) scale(0.96)}to{opacity:1;transform:translate(-50%, -50%) scale(1)}}.dialog-close-button{position:absolute;top:15px;right:15px}";const mt=pt;const gt=class{constructor(i){t(this,i);this.openChange=e(this,"openChange",7);this.open=false;this.isOpen=false}componentWillLoad(){if(this.open){this.openModal()}}componentDidLoad(){this.prepareFocusTrap()}async openModal(){this.isOpen=true;document.body.style.overflow="hidden";setTimeout((()=>{this.prepareFocusTrap()}),10);this.openChange.emit(this.isOpen)}async closeModal(){console.log("close");if(!this.isOpen){return}document.body.style.overflow="visible";this.isOpen=false;this.openChange.emit(this.isOpen)}handleOpenChange(){if(this.open){this.openModal()}else{this.closeModal()}}handleKeyDown(t){if(!this.isOpen){return}let e=t.key==="Tab";if(t.key==="Escape"&&this.isOpen){this.closeModal()}if(!e){return}if(!t.shiftKey&&document.activeElement===this.lastFocusableElement){this.firstFocusableElement.focus();t.preventDefault()}if(t.shiftKey&&document.activeElement===this.firstFocusableElement){this.lastFocusableElement.focus();t.preventDefault()}}disconnectedCallback(){document.body.style.overflow="visible"}prepareFocusTrap(){const t='button,ir-dropdown ,[href], input, select, textarea, [tabindex]:not([tabindex="-1"])';const e=this.el.shadowRoot.querySelectorAll(t);if(e.length===0)return;this.firstFocusableElement=e[0];this.lastFocusableElement=e[e.length-1];this.firstFocusableElement.focus()}render(){return i(o,{key:"7367c6e74712a161ae4afe30fd60b485c2456448"},i("div",{key:"bf8e8028537f5dfc8d8bb723650cd44cd940e2e9",class:"backdrop","data-state":this.isOpen?"opened":"closed",onClick:()=>this.closeModal()}),this.isOpen&&i("div",{key:"7412cce9ba0e25cff3c605a8deb5fecc41f2854d",class:"modal-container",tabIndex:-1,role:"dialog","aria-labelledby":"dialog1Title","aria-describedby":"dialog1Desc"},i("ir-icon",{key:"84267bb03675fb4d6dd9f8863a5dab0330cf4adc",id:"close",class:"dialog-close-button",onIconClickHandler:()=>this.closeModal()},i("svg",{key:"d62a5a482bc171eaa10be9b61d4cdc347c91568c",slot:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:18,width:18},i("path",{key:"64ad55d0e14f2320b159aa10251281b951e71318",fill:"#104064",class:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))),i("div",{key:"3b51140ecff9dc255dba9ec1300303aca8108731",class:"modal-title",id:"dialog1Title"},i("slot",{key:"07487607f7987aa8c2c69227cc7ca69601898d76",name:"modal-title"})),i("div",{key:"2108a8575332d39761abbb37c4c4bce1429a787c",class:"modal-body",id:"dialog1Desc"},i("slot",{key:"9ac00dff185281003167f24b1bf35e59d4f3669a",name:"modal-body"})),i("div",{key:"58fe71b34715d1e5dcab57a472fd6eededcfdf16",class:"modal-footer"},i("slot",{key:"2faccca96c46884ad9b9226948abecfcc5e48d5d",name:"modal-footer"}))))}get el(){return a(this)}static get watchers(){return{open:["handleOpenChange"]}}};gt.style=mt;const vt=".sc-ir-events-log-h{display:block}.beta.sc-ir-events-log{background:var(--red);color:white;padding:0.2rem 0.3rem;font-size:12px;border-radius:4px;margin:0}.event-row.sc-ir-events-log{padding-bottom:0.5rem}.list-title.sc-ir-events-log{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-events-log{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-events-log{color:#629a4c;font-weight:600}.list-item.red.sc-ir-events-log{color:#ff4961;font-weight:600}.dates-row.sc-ir-events-log{display:flex;align-items:center;gap:0.875rem}";const yt=vt;const kt=class{constructor(e){t(this,e)}componentWillLoad(){this.init()}async init(){try{this.bookingEvents=this.booking.events}catch(t){console.error(t)}}render(){var t;return i("div",{key:"256ee8682b6d9c02ae561d72f679bce5530a898b",class:"p-1"},i("div",{key:"cc4ffeead2dd05d6656efc8c801656111d002ee1",class:"d-flex  align-items-center",style:{gap:"0.5rem"}},i("h3",{key:"72edf1656a095ced391708e3c7a176c1f5f0f443",class:" text-left p-0 m-0  dialog-title "},D.entries.Lcz_EventsLog)),O("/Get_Exposed_Booking_Events")?i("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},i("ir-spinner",null)):i(s,null,i("table",{class:" dialog-container-height"},i("thead",{style:{opacity:"0"}},i("tr",null,i("th",null,"date"),i("th",null,"user"),i("th",null,"status"))),i("tbody",null,(t=this.bookingEvents)===null||t===void 0?void 0:t.map((t=>i("tr",{key:t.id,class:"pb-1"},i("td",{class:"event-row dates-row"},i("span",null,t.date),i("span",null,String(t.hour).padStart(2,"0"),":",String(t.minute).padStart(2,"0"),":",String(t.second).padStart(2,"0"))),i("td",{class:"pl-3 event-row "},t.type),i("td",{class:"pl-1 event-row "},t.user))))))))}};kt.style=yt;const _t=".sc-ir-extra-service-h{display:block}.extra-service-container.sc-ir-extra-service{display:flex;align-items:start;justify-content:space-between;gap:0.5rem}.extra-service-container.sc-ir-extra-service *.sc-ir-extra-service{padding:0;margin:0;box-sizing:border-box}.extra-service-actions.sc-ir-extra-service{display:flex;align-items:center;gap:0.5rem}.extra-service-conditional-date.sc-ir-extra-service{margin-top:0.5rem}.extra-service-price.sc-ir-extra-service{white-space:nowrap}";const xt=_t;const wt=class{constructor(i){t(this,i);this.editExtraService=e(this,"editExtraService",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.bookingService=new r}async deleteService(){try{await this.bookingService.doBookingExtraService({service:this.service,is_remove:true,booking_nbr:this.bookingNumber});this.resetBookingEvt.emit(null)}catch(t){console.log(t)}}render(){return i(o,{key:"04e69af6bca32153913fac83a93702f7187a6edd"},i("div",{key:"f77202a5aaded11932f46a71f4728c6784139de8",class:"p-1"},i("div",{key:"da6753626ada4e7720d750075e1bbc1a9a18d001",class:"extra-service-container"},i("p",{key:"819096419f7ec816b5edb5d3d1cce26ddd6ad28d",class:"extra-service-description"},this.service.description),i("div",{key:"4e607bd8e84dd2e28f2c1c4b44bbdba9e83de3f8",class:"extra-service-actions"},this.service.price&&i("p",{key:"82890e887b15d8441df8852943906b70364f124e",class:"extra-service-price p-0 m-0 font-weight-bold"},g(this.currencySymbol,this.service.price)),i("ir-button",{key:"f5dab9393ec9afb6c04487b823c5a18202e195e9",id:`serviceEdit-${this.service.booking_system_id}`,class:"extra-service-edit-btn m-0 p-0",variant:"icon",icon_name:"edit",style:B.secondary,onClickHandler:()=>this.editExtraService.emit(this.service)}),i("ir-button",{key:"6f29fb06d57018fe946bda96e0a6b854c9877a48",class:"extra-service-delete-btn m-0 p-0",variant:"icon",onClickHandler:()=>this.irModalRef.openModal(),id:`roomDelete-${this.service.booking_system_id}`,icon_name:"trash",style:B.danger}))),i("div",{key:"bd667984daee5e8a67d3803364cbb55775f93c66",class:"extra-service-conditional-date"},this.service.start_date&&this.service.end_date?i("ir-date-view",{class:"extra-service-date-view mr-1",from_date:this.service.start_date,to_date:this.service.end_date,showDateDifference:false}):this.service.start_date&&i("p",{class:"extra-service-date-view"},w(new Date(this.service.start_date)).format("MMM DD, YYYY")))),i("ir-modal",{key:"a1ec7807e43deef94ac70a2ca27c7ad5a8bd200b",autoClose:false,ref:t=>this.irModalRef=t,isLoading:O("/Do_Booking_Extra_Service"),onConfirmModal:this.deleteService.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:D.entries.Lcz_Cancel,rightBtnText:D.entries.Lcz_Delete,leftBtnColor:"secondary",rightBtnColor:"danger",modalTitle:D.entries.Lcz_Confirmation,modalBody:`${D.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${D.entries.Lcz_ThisService} ${D.entries.Lcz_FromThisBooking}`}))}};wt.style=xt;const Dt=S.object({type:S.object({code:S.union([S.string().min(3),S.literal("")]).optional(),description:S.union([S.string(),S.literal("")]).optional()}),number:S.union([S.string().min(2),S.literal("")]).optional().nullable()});const Ot=S.object({id:S.number().optional(),first_name:S.union([S.string().min(2),S.literal("")]).optional(),last_name:S.union([S.string().min(2),S.literal("")]).optional(),country_id:S.coerce.number().min(0).optional(),dob:S.string().nullable().optional().refine((t=>t===undefined||w(t,"DD/MM/YYYY",true).isValid()||t===""||t===null),"Invalid date format").transform((t=>{if(t===undefined||t===""||t===null)return null;const e=w(t,"DD/MM/YYYY",true).isValid();return e?null:w(t,"DD/MM/YYYY").format("YYYY-MM-DD")})),id_info:Dt.optional(),is_main:S.boolean().default(false)});function Ct(t){var e;Ot.parse(t);const i=t=>t!==null&&t!==undefined&&t.trim()!=="";const s=[];if(t.is_main){if(!i(t.first_name)){s.push({path:["first_name"],code:R.custom,message:"First name is required for main guest"})}if(!i(t.last_name)){s.push({path:["last_name"],code:R.custom,message:"Last name is required for main guest"})}}const o=i(t.first_name)||i(t.last_name)||i(t.dob)||t.country_id!==null&&t.country_id!==undefined&&t.country_id>0||i((e=t.id_info)===null||e===void 0?void 0:e.number);if(o){if(!i(t.first_name)){s.push({path:["first_name"],code:R.custom,message:"First name is required when other guest information is provided"})}if(!i(t.last_name)){s.push({path:["last_name"],code:R.custom,message:"Last name is required when other guest information is provided"})}}if(s.length>=1){throw new j(s)}}const Tt=S.object({booking_system_id:S.number().optional(),cost:S.coerce.number().nullable(),currency_id:S.number().min(1),description:S.string().min(1),end_date:S.string().nullable(),price:S.coerce.number(),start_date:S.string().nullable(),system_id:S.number().optional()});const Yt=".sc-ir-extra-service-config-h{display:block;--ir-input-border-color:#cacfe7}.sc-ir-extra-service-config-h .input-group-text.sc-ir-extra-service-config{border-color:var(--ir-input-border-color)}.currency-ph.sc-ir-extra-service-config{padding:0;margin:0;color:#3b4781;display:flex;align-items:center;justify-content:center;padding:0 0 0 0.25rem;border-top:1px solid var(--ir-input-border-color);border-bottom:1px solid var(--ir-input-border-color);border-left:1px solid transparent;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.service-description-input.sc-ir-extra-service-config{height:70px !important}.service-description.sc-ir-extra-service-config .input-group-prepend.sc-ir-extra-service-config{background-color:#f4f5fa;border:1px solid var(--ir-input-border-color);border-top-left-radius:0.25rem;border-bottom-left-radius:0.25rem}.service-date-container.sc-ir-extra-service-config{padding:0;margin:0;display:flex;align-items:center;position:relative;width:100%;justify-content:center}.service-date-container.sc-ir-extra-service-config .btn-container.sc-ir-extra-service-config{position:absolute;right:5px;margin:0;display:flex;align-items:center;justify-content:center;padding:0}.service-description.sc-ir-extra-service-config .input-group-text.sc-ir-extra-service-config{height:fit-content;border:0;padding-top:0.75rem !important}.price-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config,.cost-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config{border-top:1px solid #1e9ff2;border-bottom:1px solid #1e9ff2;border-left:1px solid #1e9ff2}.currency-ph[data-state='error'].sc-ir-extra-service-config{border-color:var(--red, #ff4961)}.price-input.sc-ir-extra-service-config:focus{border-right-width:1px !important}.is-invalid.sc-ir-extra-service-config{background-image:none !important}.price-input.sc-ir-extra-service-config,.cost-input.sc-ir-extra-service-config{border-left:0}.row-group.sc-ir-extra-service-config{display:flex;flex-direction:column;gap:0.5rem}@media (min-width: 640px){.row-group.sc-ir-extra-service-config{flex-direction:row;align-items:center;gap:0}.cost-label.sc-ir-extra-service-config{border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.until-prepend.sc-ir-extra-service-config,.cost-input-placeholder.sc-ir-extra-service-config{border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}.date-from.sc-ir-extra-service-config,.price-input.sc-ir-extra-service-config{border-right-width:0 !important;border-top-right-radius:0 !important;border-bottom-right-radius:0 !important}}.date-focused.sc-ir-extra-service-config{border-color:#1e9ff2}";const It=Yt;const Mt=".sc-ir-extra-service-config-h{height:100%}.sheet-container.sc-ir-extra-service-config{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-extra-service-config{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-extra-service-config{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-extra-service-config{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-extra-service-config{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-extra-service-config{flex-direction:row;align-items:center}}";const Et=Mt;const Bt=class{constructor(i){t(this,i);this.closeModal=e(this,"closeModal",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.bookingService=new r}componentWillLoad(){if(this.service){this.s_service=Object.assign({},this.service)}}async saveAmenity(){try{Tt.parse(this.s_service);await this.bookingService.doBookingExtraService({service:this.s_service,booking_nbr:this.booking.booking_nbr,is_remove:false});this.resetBookingEvt.emit(null);this.closeModal.emit(null)}catch(t){if(t instanceof j){this.error=true}console.error(t)}}updateService(t){let e=this.s_service;if(!e){e={cost:null,description:null,end_date:null,start_date:null,price:null,currency_id:this.booking.currency.id}}this.s_service=Object.assign(Object.assign({},e),t)}validatePrice(){var t,e,i,s;if(((t=this.s_service)===null||t===void 0?void 0:t.price)===undefined||((i=(e=this.s_service)===null||e===void 0?void 0:e.price)===null||i===void 0?void 0:i.toString())===""){return false}const o=Tt.pick({price:true});const a=o.safeParse({price:(s=this.s_service)===null||s===void 0?void 0:s.price});return a.success}render(){var t,e,s,o,a,n,r,l,c,d,h,u,f,b;return i("form",{key:"57d9215be41ffb2fb8d764784ee6b7fd7f22c7ed",class:"sheet-container",onSubmit:async t=>{t.preventDefault();await this.saveAmenity()}},i("ir-title",{key:"571b30f45fa675f841e42d5bc1d8160d063cb54a",class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:D.entries.Lcz_ExtraServices,displayContext:"sidebar"}),i("section",{key:"145b811eabd2ecf53049dd70d30acdcb3b44fce4",class:"px-1 sheet-body"},i("fieldset",{key:"d44131037350b527155a42ae8bfec9b455df3a0d",class:"input-group mb-1 service-description"},i("div",{key:"0a64e41a3460e0fa528085c2f18c48444d86dd43",class:"input-group-prepend"},i("span",{key:"8856246858f5107f1e51a8ad08dfabff05e6f4c0",class:"input-group-text"},D.entries.Lcz_Description)),i("textarea",{key:"957d896f25f6256464d078a2c3b93d149120ac7f",value:(t=this.s_service)===null||t===void 0?void 0:t.description,class:`form-control service-description-input ${this.error&&!((e=this.s_service)===null||e===void 0?void 0:e.description)?"is-invalid":""}`,style:{height:"7rem"},maxLength:250,onChange:t=>this.updateService({description:t.target.value}),"aria-label":"Amenity description"})),i("div",{key:"198272d3eeff9c1477ae1168e88d6118bf075bdb",class:"row-group mb-1"},i("div",{key:"02fae4566061820a02e9f4681fd90ce6dba504da",class:"input-group"},i("div",{key:"d22bc965e36592b9e3fd4f948d8a0817084a59f2",class:"input-group-prepend"},i("span",{key:"d931063b0ac4abe200ef0a12a1b24d95be508cf4",class:"input-group-text",id:"basic-addon1"},D.entries.Lcz_DatesOn)),i("div",{key:"7e321d7651a1489a8abdf538b7c943d11bda4f61",class:"form-control p-0 m-0 d-flex align-items-center justify-content-center date-from"},i("div",{key:"346b5cb1c5257c8e7d34c0ea10cf07f3b868e7e3",class:"service-date-container"},i("ir-date-picker",{key:"766fc408dd83b69803b3ea0174467e9b0f75b5a4",emitEmptyDate:true,date:(s=this.s_service)===null||s===void 0?void 0:s.start_date,minDate:this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:t=>{var e;return this.updateService({start_date:(e=t.detail.start)===null||e===void 0?void 0:e.format("YYYY-MM-DD")})}},i("input",{key:"34c075077bef12cc4470541c492866fc197d22ba",type:"text",slot:"trigger",value:((o=this.s_service)===null||o===void 0?void 0:o.start_date)?A(this.s_service.start_date):null,style:{borderLeftWidth:"0",borderRightWidth:"0",width:"100%",borderRadius:"0"},class:"text-center w-100 form-control input-sm"})),((a=this.s_service)===null||a===void 0?void 0:a.start_date)&&i("div",{key:"d0c34ab597ac2e5310869c47aa409af95b8041d0",class:"btn-container"},i("ir-button",{key:"5ed55d77febf76d8e97cad822a3db1057f30db3f",title:"clear",id:"close",variant:"icon",style:{"--icon-size":"0.875rem"},icon_name:"xmark-fill",class:"ml-2",onClickHandler:t=>{t.stopImmediatePropagation();t.stopPropagation();this.updateService({start_date:null})}}))))),i("div",{key:"85b63ffad74b59f42d7a7f26fb940783b92c08a7",class:"input-group"},i("div",{key:"a4e69557e2afbae3352a76974b0a7cea8770b396",class:"input-group-prepend "},i("span",{key:"f2d7e014121ceb05299258862144b07120840864",class:"input-group-text until-prepend",id:"basic-addon1"},D.entries.Lcz_TillAndIncluding)),i("div",{key:"ce91756ea06f9da4f517eaf7efa33a2fc477cea6",class:"form-control p-0 m-0 d-flex align-items-center justify-content-center"},i("div",{key:"3ad115b96603148f52fda264952d99007fa417a4",class:"service-date-container"},i("ir-date-picker",{key:"d09116a0b4876fbc213d0176834a3e8efc726bda",emitEmptyDate:true,date:(n=this.s_service)===null||n===void 0?void 0:n.end_date,minDate:(l=(r=this.s_service)===null||r===void 0?void 0:r.start_date)!==null&&l!==void 0?l:this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:t=>{var e;t.stopImmediatePropagation();t.stopPropagation();this.updateService({end_date:(e=t.detail.start)===null||e===void 0?void 0:e.format("YYYY-MM-DD")})}},i("input",{key:"a3b1bc681e8315402d8923923e9bbc7ec2079861",slot:"trigger",value:((c=this.s_service)===null||c===void 0?void 0:c.end_date)?A(this.s_service.end_date):null,style:{borderLeftWidth:"0",borderRightWidth:"0",width:"100%"},class:"text-center form-control input-sm"})),((d=this.s_service)===null||d===void 0?void 0:d.end_date)&&i("div",{key:"92285b01b75f8794b72825c4288510503c22b8e2",class:"btn-container"},i("ir-button",{key:"abadec48507e6ef392b8fe03d8ce8a666aff15a5",title:"clear",id:"close",variant:"icon",style:{"--icon-size":"0.875rem"},icon_name:"xmark-fill",class:"ml-2",onClickHandler:t=>{t.stopImmediatePropagation();t.stopPropagation();this.updateService({end_date:null})}})))))),i("div",{key:"744c4671bbb10a8fafc44176752c3dc44555cf43",class:"row-group"},i("ir-price-input",{key:"b6779de0e9e5295e8a86ec0fdfbfd940fa632a28",label:"Price",currency:this.booking.currency.symbol,class:"ir-br-input-none",value:(u=(h=this.s_service)===null||h===void 0?void 0:h.price)===null||u===void 0?void 0:u.toString(),zod:Tt.pick({price:true}),"aria-label":D.entries.Lcz_Price,wrapKey:"price","aria-describedby":"service price",autoValidate:false,"data-state":this.error&&!this.validatePrice()?"error":"",onTextChange:t=>this.updateService({price:parseFloat(t.detail)})}),i("ir-price-input",{key:"4e1450bd70cdefed3486cc4f801ff2fc50d35d04",autoValidate:false,label:D.entries.Lcz_Cost,labelStyle:"rounded-0 border-left-0",currency:this.booking.currency.symbol,value:(b=(f=this.s_service)===null||f===void 0?void 0:f.cost)===null||b===void 0?void 0:b.toString(),zod:Tt.pick({cost:true}),onTextChange:t=>this.updateService({cost:parseFloat(t.detail)}),wrapKey:"cost","aria-label":"Cost","aria-describedby":"service cost"}))),i("div",{key:"da9c5df4dec2a91e60db52c759d4302dd1492dd1",class:"sheet-footer"},i("ir-button",{key:"79dc61a841ca8566be9ae0001695a254b525175b",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`flex-fill`,text:D.entries.Lcz_Cancel,btn_color:"secondary"}),i("ir-button",{key:"4933fe9223ffb0e390a3d5e472119c683cdaeff1",btn_styles:"justify-content-center align-items-center",class:"flex-fill",btn_type:"submit",isLoading:O("/Do_Booking_Extra_Service"),text:D.entries.Lcz_Save,btn_color:"primary"})))}};Bt.style=It+Et;const St=".sc-ir-extra-services-h{display:block}";const jt=St;const Rt=class{constructor(e){t(this,e)}render(){var t;return i(o,{key:"95ab56ac5ea7bf34ecf098a6b5236379852339d1",class:"card p-0 "},(t=this.booking.extra_services)===null||t===void 0?void 0:t.map(((t,e)=>i(s,null,i("ir-extra-service",{bookingNumber:this.booking.booking_nbr,currencySymbol:this.booking.currency.symbol,key:t.booking_system_id,service:t}),e!==this.booking.extra_services.length-1&&i("hr",{class:"mr-2 ml-2 my-0 p-0"})))))}};Rt.style=jt;const At=".input-group-text.sc-ir-guest-info{min-width:10rem;text-align:left}.mobilePrefixSelect.sc-ir-guest-info{border-right-width:0;border-top-right-radius:0;border-bottom-right-radius:0}.mobilePrefixInput.sc-ir-guest-info{border-top-left-radius:0;border-bottom-left-radius:0}.check-container.sc-ir-guest-info{position:relative;cursor:pointer;font-size:14px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;align-items:center}.check-container.sc-ir-guest-info input.sc-ir-guest-info{position:relative;opacity:0;cursor:pointer;height:0;width:0}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info{position:relative;top:0;left:0;height:20px;width:20px;border:1px solid #cacfe7;border-radius:4px;transition:all 0.3s ease}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info{background-color:#1e9ff2;border-color:#1e9ff2}.checkmark.sc-ir-guest-info:after{content:'';position:absolute;display:none}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info:after{display:block}.check-label.sc-ir-guest-info{margin-left:10px !important}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info:after{left:6px;top:3px;width:6px;height:10px;border:solid white;border-width:0 2px 2px 0;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.ir-card-header.sc-ir-guest-info{width:100%;border-bottom:1px solid #e4e5ec}.close-icon.sc-ir-guest-info{margin:0}.border-theme.sc-ir-guest-info{border:1px solid #cacfe7}.loading-container.sc-ir-guest-info{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}";const Nt=At;const Lt=".sc-ir-guest-info-h{height:100%}.sheet-container.sc-ir-guest-info{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-guest-info{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-guest-info{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-guest-info{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-guest-info{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-guest-info{flex-direction:row;align-items:center}}";const zt=Lt;const $t=class{constructor(i){t(this,i);this.closeSideBar=e(this,"closeSideBar",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.guest=null;this.isLoading=true;this.autoValidate=false;this.bookingService=new r;this.roomService=new I;this.token=new E}async componentWillLoad(){if(this.ticket){this.token.setToken(this.ticket)}if(!!this.token.getToken())this.init()}ticketChanged(t,e){if(t===e){return}this.token.setToken(this.ticket);this.init()}async init(){try{console.log("first");this.isLoading=true;const[t,e,i]=await Promise.all([this.bookingService.fetchGuest(this.email),this.bookingService.getCountries(this.language),!D||!D.entries||Object.keys(D.entries).length===0?this.roomService.fetchLanguage(this.language):Promise.resolve(null)]);if(i){D.entries=i.entries;D.direction=i.direction}this.countries=e;this.guest=Object.assign(Object.assign({},t),{mobile:t.mobile_without_prefix})}catch(t){console.log(t)}finally{this.isLoading=false}}handleInputChange(t){this.guest=Object.assign(Object.assign({},this.guest),t)}async editGuest(){var t;try{this.autoValidate=true;await this.bookingService.editExposedGuest(this.guest,(t=this.booking_nbr)!==null&&t!==void 0?t:null);this.closeSideBar.emit(null);this.resetBookingEvt.emit(null)}catch(t){console.log(t)}}render(){var t,e,o,a,n,r,l,c,d,h,u,f;if(this.isLoading&&this.isInSideBar){i("div",{class:"loading-container"},i("ir-spinner",null))}if(this.isLoading){return null}return i("form",{class:"p-0 sheet-container",onSubmit:async t=>{t.preventDefault();await this.editGuest()}},this.headerShown&&i("ir-title",{class:"px-1 sheet-header",displayContext:"sidebar",label:D.entries.Lcz_GuestDetails}),i("div",{class:this.isInSideBar?"sheet-body":"card-content collapse show "},i("div",{class:this.headerShown?"card-body px-1 pt-0":"pt-0"},i("ir-input-text",{autoValidate:this.autoValidate,label:(t=D.entries)===null||t===void 0?void 0:t.Lcz_FirstName,name:"firstName",value:(e=this.guest)===null||e===void 0?void 0:e.first_name,required:true,onTextChange:t=>this.handleInputChange({first_name:t.detail})}),i("ir-input-text",{autoValidate:this.autoValidate,label:(o=D.entries)===null||o===void 0?void 0:o.Lcz_LastName,name:"lastName",value:(a=this.guest)===null||a===void 0?void 0:a.last_name,required:true,onTextChange:t=>this.handleInputChange({last_name:t.detail})}),i("ir-input-text",{label:(n=D.entries)===null||n===void 0?void 0:n.Lcz_Email,name:"email",value:(r=this.guest)===null||r===void 0?void 0:r.email,required:true,onTextChange:t=>this.handleInputChange({email:t.detail})}),i("ir-input-text",{label:(l=D.entries)===null||l===void 0?void 0:l.Lcz_AlternativeEmail,name:"altEmail",value:(c=this.guest)===null||c===void 0?void 0:c.alternative_email,onTextChange:t=>this.handleInputChange({alternative_email:t.detail})}),i("ir-country-picker",{country:this.countries.find((t=>t.id===this.guest.country_id)),label:(d=D.entries)===null||d===void 0?void 0:d.Lcz_Country,onCountryChange:t=>this.handleInputChange({country_id:t.detail.id}),countries:this.countries}),i("ir-phone-input",{onTextChange:t=>{t.stopImmediatePropagation();t.stopPropagation();const{mobile:e,phone_prefix:i}=t.detail;if(e!==this.guest.mobile){this.handleInputChange({mobile:e})}if(i!==this.guest.country_phone_prefix)this.handleInputChange({country_phone_prefix:i})},phone_prefix:this.guest.country_phone_prefix,value:this.guest.mobile,language:this.language,label:(h=D.entries)===null||h===void 0?void 0:h.Lcz_MobilePhone,countries:this.countries}),i("div",{class:"mb-2"},i("ir-textarea",{variant:"prepend",onTextChange:t=>this.handleInputChange({notes:t.detail}),value:(u=this.guest)===null||u===void 0?void 0:u.notes,label:(f=D.entries)===null||f===void 0?void 0:f.Lcz_PrivateNote})),i("div",{class:"p-0 m-0"},i("label",{class:`check-container m-0 p-0`},i("input",{class:"m-0 p-0",type:"checkbox",name:"newsletter",checked:this.guest.subscribe_to_news_letter,onInput:t=>this.handleInputChange({subscribe_to_news_letter:t.target.checked})}),i("span",{class:"checkmark m-0 p-0"}),i("span",{class:"m-0 p-0  check-label"},D.entries.Lcz_Newsletter)),!this.isInSideBar&&i(s,null,i("hr",null),i("ir-button",{isLoading:this.isLoading,btn_disabled:this.isLoading,btn_styles:"d-flex align-items-center justify-content-center",text:D.entries.Lcz_Save,onClickHandler:this.editGuest.bind(this),color:"btn-primary"}))))),this.isInSideBar&&i("div",{class:"sheet-footer"},i("ir-button",{"data-testid":"cancel",onClickHandler:()=>this.closeSideBar.emit(null),class:"flex-fill m-0 p-0",btn_styles:"w-100 m-0  justify-content-center align-items-center",btn_color:"secondary",text:D.entries.Lcz_Cancel}),i("ir-button",{"data-testid":"save",isLoading:O("/Edit_Exposed_Guest"),btn_disabled:this.isLoading,class:"flex-fill m-0",btn_type:"submit",btn_styles:"w-100 m-0  justify-content-center align-items-center",text:D.entries.Lcz_Save})))}static get watchers(){return{ticket:["ticketChanged"]}}};$t.style=Nt+zt;const Pt=".sc-ir-payment-actions-h{display:block}.sc-ir-payment-actions-h p.sc-ir-payment-actions,.sc-ir-payment-actions-h div.sc-ir-payment-actions,.sc-ir-payment-actions-h span.sc-ir-payment-actions,.sc-ir-payment-actions-h ir-icons.sc-ir-payment-actions{box-sizing:border-box;padding:0;margin:0}.action-container.sc-ir-payment-actions td.sc-ir-payment-actions{padding:0px 0.5rem;padding-bottom:0.5rem}.action-container.sc-ir-payment-actions .amount_action.sc-ir-payment-actions{padding-inline-start:0}.overdue_action.sc-ir-payment-actions{color:#ff4961;border-radius:0.25rem;display:flex;align-items:center;gap:0.5rem}.future_action.sc-ir-payment-actions{border-radius:0.25rem;color:#1e9ff2;display:flex;align-items:center;justify-content:start;gap:0.5rem}.date_action.sc-ir-payment-actions{font-weight:500}.amount_action.sc-ir-payment-actions{font-weight:600}";const Gt=Pt;const Ht=class{constructor(i){t(this,i);this.generatePayment=e(this,"generatePayment",7)}render(){var t,e;if(((t=this.paymentAction)===null||t===void 0?void 0:t.filter((t=>t.amount!==0)).length)==0){return null}return i(o,null,i("div",{class:"my-1"},i("span",{class:"font-medium"},"Payment actions")),i("table",null,i("thead",null,i("th",null,i("p",{class:"sr-only"},"Amount")),i("th",null,i("p",{class:"sr-only"},"Due date")),i("th",null,i("p",{class:"sr-only"},"Pay")),i("th",null,i("p",{class:"sr-only"},"Status"))),i("tbody",null,(e=this.paymentAction)===null||e===void 0?void 0:e.map((t=>{if(!t.due_on){return null}return i("tr",{class:"action-container"},i("td",{class:"amount_action"},g(t.currency.symbol,t.amount)),i("td",{class:"date_action"},w(new Date(t.due_on)).format("ddd, DD MMM YYYY")),t.amount>0&&i("td",null,i("ir-button",{btn_color:"outline",text:"Pay",size:"sm",onClickHandler:()=>this.generatePayment.emit(t)})),t.type==="overdue"&&t.amount>0&&i("td",null,i("div",{class:"overdue_action"},i("svg",{height:16,width:16,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},i("path",{fill:"currentColor",d:"M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480L40 480c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24l0 112c0 13.3 10.7 24 24 24s24-10.7 24-24l0-112c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"})),i("span",null,"Overdue"))),t.type==="future"&&t.amount>0&&i("td",null,i("div",{class:"future_action "},i("svg",{xmlns:"http://www.w3.org/2000/svg",height:16,width:16,viewBox:"0 0 512 512"},i("path",{fill:"currentColor",d:"M256 0a256 256 0 1 1 0 512A256 256 0 1 1 256 0zM232 120l0 136c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2 280 120c0-13.3-10.7-24-24-24s-24 10.7-24 24z"})),i("span",null,w(new Date(t.due_on)).isSame(new Date)?"Today":"Future"))))})))))}};Ht.style=Gt;const Kt=".sc-ir-payment-details-h{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-payment-details-h *.sc-ir-payment-details{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sm-margin-right.sc-ir-payment-details{margin-right:5px !important;background:#000}.action_icons.sc-ir-payment-details{width:60px}.w-60.sc-ir-payment-details{width:100px;padding:0 5px}.payments-height.sc-ir-payment-details{height:30px}.payment_date.sc-ir-payment-details{width:100px}.iframeHeight.sc-ir-payment-details{height:max-content;height:22.5rem}.designation.sc-ir-payment-details{width:120px}.total-cost-container.sc-ir-payment-details{background:#7cbebe;color:white;padding:0.5rem;border-radius:5px}.payment-actions.sc-ir-payment-details{display:flex;align-items:center;justify-content:center;height:100%;gap:0.5rem}.payment_action_beta_container.sc-ir-payment-details{border:1px solid var(--red);position:relative;padding:4px;box-sizing:border-box;border-radius:4px}.beta.sc-ir-payment-details{position:absolute;top:4px;background:var(--red);color:white;padding:0.2rem 0.3rem;font-size:12px;border-radius:4px;right:4px;margin:0}";const Ut=Kt;const Ft=class{constructor(i){t(this,i);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.resetExposedCancelationDueAmount=e(this,"resetExposedCancelationDueAmount",7);this.toast=e(this,"toast",7);this.newTableRow=false;this.collapsedPayment=false;this.collapsedGuarantee=false;this.flag=false;this.confirmModal=false;this.paymentDetailsUrl="";this.paymentExceptionMessage="";this.modal_mode=null;this.paymentService=new M;this.bookingService=new r;this.paymentBackground="white"}handlePaymentGeneration(t){const e=t.detail;this.newTableRow=true;this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{amount:e.amount,date:e.due_on});this.paymentBackground="rgba(250, 253, 174)"}async componentWillLoad(){try{this.initializeItemToBeAdded()}catch(t){if(this.bookingDetails.guest.cci){return}if(!this.bookingDetails.is_direct&&this.bookingDetails.channel_booking_nbr){this.paymentExceptionMessage=t}}}initializeItemToBeAdded(){this.itemToBeAdded={id:-1,date:w().format("YYYY-MM-DD"),amount:null,currency:this.bookingDetails.currency,designation:"",reference:""};this.paymentBackground="white"}async _processPaymentSave(){if(this.itemToBeAdded.amount===null){this.toast.emit({type:"error",title:D.entries.Lcz_EnterAmount,description:"",position:"top-right"});return}if(Number(this.itemToBeAdded.amount)>Number(this.bookingDetails.financial.due_amount)){this.modal_mode="save";this.openModal();return}this._handleSave()}async _handleSave(){this.paymentBackground="white";try{await this.paymentService.AddPayment(this.itemToBeAdded,this.bookingDetails.booking_nbr);this.initializeItemToBeAdded();this.resetBookingEvt.emit(null);this.resetExposedCancelationDueAmount.emit(null)}catch(t){console.log(t)}}handlePaymentInputChange(t,e,i){this.paymentBackground="white";if(t==="amount"){if(!isNaN(e)||e===""){if(e===""){this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[t]:null})}else{this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[t]:parseFloat(e)})}}else if(i&&i.target){let t=i.target;let e=t.value;e=e.replace(/[^\d-]|(?<!^)-/g,"");t.value=e}}else{this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[t]:e})}}async cancelPayment(){try{await this.paymentService.CancelPayment(this.toBeDeletedItem.id);const t=this.bookingDetails.financial.payments.filter((t=>t.id!==this.toBeDeletedItem.id));this.bookingDetails=Object.assign(Object.assign({},this.bookingDetails),{financial:Object.assign(Object.assign({},this.bookingDetails.financial),{payments:t})});this.confirmModal=!this.confirmModal;this.resetBookingEvt.emit(null);this.resetExposedCancelationDueAmount.emit(null);this.toBeDeletedItem=null;this.modal_mode=null}catch(t){console.log(t)}}async handleConfirmModal(t){this.paymentBackground="white";t.stopImmediatePropagation();t.stopPropagation();if(this.modal_mode==="delete"){await this.cancelPayment()}else{await this._handleSave()}}openModal(){const t=document.querySelector(".delete-record-modal");t.openModal()}async handleCancelModal(t){t.stopImmediatePropagation();t.stopPropagation();try{this.paymentBackground="white";if(this.modal_mode==="save"){this.initializeItemToBeAdded()}}catch(t){console.log(t)}}handleBookingDetails(){if(this.newTableRow){this.newTableRow=false}}handleDateChange(t){this.handlePaymentInputChange("date",t.detail.end.format("YYYY-MM-DD"))}_renderTableRow(t,e="normal"){var o,a,n,r;return i(s,null,i("tr",null,i("td",{class:"border payments-height border-light border-bottom-0 text-center"},e==="normal"?i("span",{class:"sm-padding-left"},A(t.date)):i("ir-date-picker",{date:((o=this.itemToBeAdded)===null||o===void 0?void 0:o.date)?new Date(this.itemToBeAdded.date):new Date,minDate:w().add(-2,"months").startOf("month").format("YYYY-MM-DD"),class:"d-flex justify-content-center",onDateChanged:this.handleDateChange.bind(this)},i("input",{type:"text",slot:"trigger",value:A((a=this.itemToBeAdded)===null||a===void 0?void 0:a.date),class:"text-center  form-control flex-grow-1 w-100",style:{border:"0",marginLeft:"auto",marginRight:"auto",width:"100%"}}))),i("td",{class:"border payments-height border-light border-bottom-0 text-center "},e==="normal"?i("span",{class:"sm-padding-right"},g(this.bookingDetails.currency.symbol,t.amount)):i("ir-price-input",{value:(n=this.itemToBeAdded.amount)===null||n===void 0?void 0:n.toString(),onTextChange:t=>this.handlePaymentInputChange("amount",Number(t.detail),t),inputStyle:"border-0 rounded-0 text-center py-0 m-0 w-100"})),i("td",{class:"border payments-height border-light border-bottom-0 text-center"},e==="normal"?i("span",{class:"sm-padding-left"},t.designation):i("input",{class:"border-0 w-100 form-control py-0 m-0",onInput:t=>this.handlePaymentInputChange("designation",t.target.value),type:"text"})),i("td",{rowSpan:2,class:"border payments-height border-light border-bottom-0 text-center"},i("div",{class:"payment-actions"},e==="add"&&i("ir-button",{variant:"icon",icon_name:"save",style:B.secondary,isLoading:e==="add"&&O("/Do_Payment"),class:"m-0",onClickHandler:()=>{this._processPaymentSave()}}),i("ir-button",{variant:"icon",icon_name:"trash",style:B.danger,isLoading:((r=this.toBeDeletedItem)===null||r===void 0?void 0:r.id)===(t===null||t===void 0?void 0:t.id)&&O("/Cancel_Payment"),onClickHandler:e==="add"?()=>{this.newTableRow=false;this.initializeItemToBeAdded()}:()=>{this.modal_mode="delete";this.toBeDeletedItem=t;this.openModal()}})))),i("tr",null,i("td",{colSpan:3,class:"border border-light payments-height border-bottom-0 text-center"},e==="normal"?i("span",{class:"sm-padding-left "},t.reference):i("input",{class:"border-0 w-100  form-control py-0 m-0",onKeyPress:t=>{if(t.key==="Enter"){this.newTableRow=false;this._handleSave()}},onInput:t=>this.handlePaymentInputChange("reference",t.target.value),type:"text"}))))}formatCurrency(t,e,i="en-US"){if(!e){return}if(t>=0){return new Intl.NumberFormat(i,{style:"currency",currency:e,minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}return}bookingGuarantee(){var t,e,s,o,a,n,r,l,c,d,h,u,f,b,p,m,g,v,k,_,x,w,O,C,T,Y,I,M,E,B,S,j,R,A,N,L,z,$;const P=this.bookingDetails.is_direct?this.getPaymentMethod():null;if(this.bookingDetails.is_direct&&!P&&!this.bookingDetails.guest.cci){return null}return i("div",{class:"mb-1"},i("div",{class:"d-flex align-items-center"},i("span",{class:"mr-1 font-medium"},D.entries.Lcz_BookingGuarantee,!!P&&i("span",null,": ",P)),(!this.bookingDetails.is_direct||this.bookingDetails.is_direct&&this.bookingDetails.guest.cci)&&i("ir-button",{id:"drawer-icon","data-toggle":"collapse","data-target":`.guarrantee`,"aria-expanded":this.collapsedGuarantee?"true":"false","aria-controls":"myCollapse",class:"sm-padding-right pointer",variant:"icon",icon_name:"credit_card",onClickHandler:async()=>{if(!this.bookingDetails.is_direct&&this.bookingDetails.channel_booking_nbr&&!this.bookingDetails.guest.cci&&!this.collapsedGuarantee){this.paymentDetailsUrl=await this.bookingService.getPCICardInfoURL(this.bookingDetails.booking_nbr)}this.collapsedGuarantee=!this.collapsedGuarantee}})),i("div",{class:"collapse guarrantee "},this.bookingDetails.guest.cci?[i("div",null,((e=(t=this.bookingDetails)===null||t===void 0?void 0:t.guest)===null||e===void 0?void 0:e.cci)&&"Card:"," ",i("span",null,((a=(o=(s=this.bookingDetails)===null||s===void 0?void 0:s.guest)===null||o===void 0?void 0:o.cci)===null||a===void 0?void 0:a.nbr)||"")," ",((l=(r=(n=this.bookingDetails)===null||n===void 0?void 0:n.guest)===null||r===void 0?void 0:r.cci)===null||l===void 0?void 0:l.expiry_month)&&"Expiry: ",i("span",null," ",((h=(d=(c=this.bookingDetails)===null||c===void 0?void 0:c.guest)===null||d===void 0?void 0:d.cci)===null||h===void 0?void 0:h.expiry_month)||""," ",((b=(f=(u=this.bookingDetails)===null||u===void 0?void 0:u.guest)===null||f===void 0?void 0:f.cci)===null||b===void 0?void 0:b.expiry_year)&&"/"+((g=(m=(p=this.bookingDetails)===null||p===void 0?void 0:p.guest)===null||m===void 0?void 0:m.cci)===null||g===void 0?void 0:g.expiry_year))),i("div",null,((k=(v=this.bookingDetails)===null||v===void 0?void 0:v.guest)===null||k===void 0?void 0:k.cci.holder_name)&&"Name:"," ",i("span",null,((w=(x=(_=this.bookingDetails)===null||_===void 0?void 0:_.guest)===null||x===void 0?void 0:x.cci)===null||w===void 0?void 0:w.holder_name)||"")," ",((T=(C=(O=this.bookingDetails)===null||O===void 0?void 0:O.guest)===null||C===void 0?void 0:C.cci)===null||T===void 0?void 0:T.cvc)&&"- CVC:"," ",i("span",null," ",((M=(I=(Y=this.bookingDetails)===null||Y===void 0?void 0:Y.guest)===null||I===void 0?void 0:I.cci)===null||M===void 0?void 0:M.cvc)||""))]:this.paymentDetailsUrl?i("iframe",{src:this.paymentDetailsUrl,width:"100%",class:"iframeHeight",frameborder:"0",name:"payment"}):i("div",{class:"text-center"},this.paymentExceptionMessage)),!this.bookingDetails.is_direct&&this.bookingDetails.ota_guarante&&i("div",null,i("ir-label",{content:((E=this.bookingDetails.ota_guarante)===null||E===void 0?void 0:E.card_type)+`${((B=this.bookingDetails.ota_guarante)===null||B===void 0?void 0:B.is_virtual)?" (virtual)":""}`,labelText:`${D.entries.Lcz_CardType}:`}),i("ir-label",{content:(S=this.bookingDetails.ota_guarante)===null||S===void 0?void 0:S.cardholder_name,labelText:`${D.entries.Lcz_CardHolderName}:`}),i("ir-label",{content:(j=this.bookingDetails.ota_guarante)===null||j===void 0?void 0:j.card_number,labelText:`${D.entries.Lcz_CardNumber}:`}),i("ir-label",{content:this.formatCurrency(y(Number((A=(R=this.bookingDetails.ota_guarante)===null||R===void 0?void 0:R.meta)===null||A===void 0?void 0:A.virtual_card_current_balance),Number((L=(N=this.bookingDetails.ota_guarante)===null||N===void 0?void 0:N.meta)===null||L===void 0?void 0:L.virtual_card_decimal_places)),($=(z=this.bookingDetails.ota_guarante)===null||z===void 0?void 0:z.meta)===null||$===void 0?void 0:$.virtual_card_currency_code),labelText:`${D.entries.Lcz_CardBalance}:`})))}checkPaymentCode(t){var e,i,s;console.log(C.allowed_payment_methods);return(s=(i=(e=C.allowed_payment_methods)===null||e===void 0?void 0:e.find((e=>e.code===t)))===null||i===void 0?void 0:i.description)!==null&&s!==void 0?s:null}getPaymentMethod(){var t,e,i,s;let o=null;const a=(e=(t=this.bookingDetails)===null||t===void 0?void 0:t.extras)===null||e===void 0?void 0:e.find((t=>t.key==="payment_code"));if(this.bookingDetails.agent){const t=(s=(i=this.bookingDetails)===null||i===void 0?void 0:i.extras)===null||s===void 0?void 0:s.find((t=>t.key==="agent_payment_mode"));if(t){o=t.value==="001"?D.entries.Lcz_OnCredit:a?this.checkPaymentCode(a.value):null}}else{if(a){o=this.checkPaymentCode(a.value)}}return o}_renderDueDate(t){return i("tr",null,i("td",{class:"pr-1"},A(t.date)),i("td",{class:"pr-1"},g(this.bookingDetails.currency.symbol,t.amount)),i("td",{class:"pr-1"},t.description),i("td",{class:"collapse font-size-small roomName"},t.room))}render(){var t,e;if(!this.bookingDetails.financial){return null}return[i("div",{class:"card m-0"},i("div",{class:"p-1"},this.bookingDetails.financial.gross_cost>0&&this.bookingDetails.financial.gross_cost!==null&&i("div",{class:"mb-2 h4 total-cost-container"},D.entries.Lcz_TotalCost,": ",i("span",null,g(this.bookingDetails.currency.symbol,this.bookingDetails.financial.gross_cost))),i("div",{class:" h4"},D.entries.Lcz_Balance,":"," ",i("span",{class:"danger font-weight-bold"},g(this.bookingDetails.currency.symbol,this.bookingDetails.financial.due_amount))),i("div",{class:"mb-2 h4"},D.entries.Lcz_Collected,":"," ",i("span",{class:""},g(this.bookingDetails.currency.symbol,this.bookingDetails.financial.payments?this.bookingDetails.financial.payments.reduce(((t,e)=>t+e.amount),0):0))),this.bookingGuarantee(),((t=this.paymentActions)===null||t===void 0?void 0:t.filter((t=>t.amount!==0)).length)>0&&this.bookingDetails.is_direct&&i("div",{class:"payment_action_beta_container"},i("p",{class:"beta"},"Beta"),i("ir-payment-actions",{paymentAction:this.paymentActions,booking:this.bookingDetails})),i("div",{class:"mt-2 d-flex  flex-column rounded payment-container"},i("div",{class:"d-flex align-items-center justify-content-between"},i("span",{class:"font-medium"},D.entries.Lcz_Payments," history"),i("ir-button",{id:"add-payment",variant:"icon",icon_name:"square_plus",style:{"--icon-size":"1.5rem"},onClickHandler:()=>{this.newTableRow=true}})),i("table",{class:"mt-1",style:{backgroundColor:this.paymentBackground}},i("thead",null,i("tr",null,i("th",{class:"border border-light border-bottom-0 text-center payment_date"},D.entries.Lcz_Dates),i("th",{class:"border border-light border-bottom-0 text-center w-60"},D.entries.Lcz_Amount),i("th",{class:"border border-light border-bottom-0 text-center designation"},D.entries.Lcz_Designation),i("th",{class:"border border-light border-bottom-0 text-center action_icons"},i("span",{class:"sr-only"},"payment actions")))),i("tbody",null,(e=this.bookingDetails.financial.payments)===null||e===void 0?void 0:e.map((t=>this._renderTableRow(t))),this.newTableRow?this._renderTableRow(null,"add"):null))))),i("ir-modal",{item:this.toBeDeletedItem,class:"delete-record-modal",modalTitle:D.entries.Lcz_Confirmation,modalBody:this.modal_mode==="delete"?D.entries.Lcz_IfDeletedPermantlyLost:D.entries.Lcz_EnteringAmountGreaterThanDue,iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:D.entries.Lcz_Cancel,rightBtnText:this.modal_mode==="delete"?D.entries.Lcz_Delete:D.entries.Lcz_Confirm,leftBtnColor:"secondary",rightBtnColor:this.modal_mode==="delete"?"danger":"primary",onConfirmModal:this.handleConfirmModal.bind(this),onCancelModal:this.handleCancelModal.bind(this)})]}static get watchers(){return{bookingDetails:["handleBookingDetails"]}}};Ft.style=Ut;class Vt{async savePickup(t,e,i){try{const s=t.arrival_time.split(":");await Y.post(`/Do_Pickup`,{booking_nbr:e,is_remove:i,currency:t.currency,date:t.arrival_date,details:t.flight_details,hour:s[0],minute:s[1],nbr_of_units:t.number_of_vehicles,selected_option:t.selected_option,total:+t.due_upon_booking})}catch(t){console.log(t)}}transformDefaultPickupData(t){const e=t.hour&&t.minute?k(t.hour)+":"+k(t.minute):"";return{arrival_date:t.date,arrival_time:e,currency:t.currency,due_upon_booking:t.total.toFixed(2),flight_details:t.details,location:t.selected_option.location.id,number_of_vehicles:t.nbr_of_units,selected_option:t.selected_option,vehicle_type_code:t.selected_option.vehicle.code}}getAvailableLocations(t){let e=[];C.pickup_service.allowed_options.forEach((i=>{if(e.filter((t=>t.value===i.location.id)).length===0){e.push({text:t+" "+i.location.description,value:i.location.id})}}));return e}createPickupSchema(t,e){return S.object({arrival_date:S.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Invalid date format, expected YYYY-MM-DD"}).refine((i=>{const s=w(i,"YYYY-MM-DD",true);const o=w(t,"YYYY-MM-DD",true);const a=w(e,"YYYY-MM-DD",true);return s.isValid()&&o.isValid()&&a.isValid()&&s.isBetween(o,a,undefined,"[]")}),{message:`arrival_date must be between ${t} and ${e}`}),arrival_time:S.string().regex(/^\d{2}:\d{2}$/,{message:"Invalid time format. Expected HH:MM"}).refine((t=>{const[e,i]=t.split(":").map(Number);return e>=0&&e<=23&&i>=0&&i<=59}),{message:"Time values are out of range"}),flight_details:S.string().nonempty({message:"Flight details cannot be empty"}),vehicle_type_code:S.string().nonempty({message:"Vehicle type code cannot be empty"}),number_of_vehicles:S.coerce.number().min(1,{message:"At least one vehicle is required"})})}validateForm(t,e){try{e.parse(t);return null}catch(t){console.log(t);const e={};if(t instanceof j){t.issues.forEach((t=>{e[t.path[0]]=true}));return e}}}getNumberOfVehicles(t,e){let i=Math.ceil(e/t);let s=i>1?i:1;let o=i>1?2:3;return Array.from({length:i+o},((t,e)=>s+e))}getPickUpPersonStatus(t){const e=C.pickup_service.allowed_pricing_models.find((e=>e.code===t));if(!e){return null}return e.description}updateDue(t){const e=this.getPickUpPersonStatus(t.code);if(!e){return}if(e==="Person"){return t.amount*t.numberOfPersons}else{return t.amount*t.number_of_vehicles}}}const Wt=".sc-ir-pickup-h{display:block}.custom-card-container.sc-ir-pickup{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e4e5ec}.card-title.sc-ir-pickup{flex:1}.border-theme.sc-ir-pickup{border:1px solid #cacfe7}@media (min-width: 768px){.price-input-container.sc-ir-pickup{max-width:290px}}";const qt=Wt;const Xt=".sc-ir-pickup-h{height:100%}.sheet-container.sc-ir-pickup{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-pickup{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-pickup{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-pickup{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-pickup{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-pickup{flex-direction:row;align-items:center}}";const Jt=Xt;const Qt=class{constructor(i){t(this,i);this.closeModal=e(this,"closeModal",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.numberOfPersons=0;this.isLoading=false;this.allowedOptionsByLocation=[];this.pickupData={location:-1,flight_details:"",due_upon_booking:"",number_of_vehicles:1,vehicle_type_code:"",currency:undefined,arrival_time:"",arrival_date:null,selected_option:undefined};this.vehicleCapacity=[];this.cause=null;this.autoValidate=false;this.pickupService=new Vt;this.arrival_time_mask={mask:"HH:mm",blocks:{HH:{mask:z,from:0,to:23,placeholderChar:"H"},mm:{mask:z,from:0,to:59,placeholderChar:"m"}},lazy:false,placeholderChar:"_"}}componentWillLoad(){if(this.defaultPickupData){const t=this.pickupService.transformDefaultPickupData(this.defaultPickupData);this.vehicleCapacity=this.pickupService.getNumberOfVehicles(t.selected_option.vehicle.capacity,this.numberOfPersons);this.allowedOptionsByLocation=C.pickup_service.allowed_options.filter((e=>e.location.id===t.location));this.pickupData=Object.assign({},t)}this.pickupSchema=this.pickupService.createPickupSchema(this.bookingDates.from,this.bookingDates.to)}handleLocationChange(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;if(e===""){this.updatePickupData("location",-1)}if(e!==""){this.allowedOptionsByLocation=C.pickup_service.allowed_options.filter((t=>t.location.id.toString()===e));let t=this.allowedOptionsByLocation[0];if(!t){return}this.vehicleCapacity=this.pickupService.getNumberOfVehicles(t.vehicle.capacity,this.numberOfPersons);this.pickupData=Object.assign(Object.assign({},this.pickupData),{location:e,selected_option:t,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:t.amount,code:t.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:t.vehicle.code,currency:t.currency})}}handleVehicleQuantityChange(t){if(t.detail===""){return}const e=+t.detail;this.pickupData=Object.assign(Object.assign({},this.pickupData),{number_of_vehicles:e,due_upon_booking:this.pickupService.updateDue({amount:this.pickupData.selected_option.amount,code:this.pickupData.selected_option.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:e}).toFixed(2)})}handleVehicleTypeChange(t){if(t.detail===""){this.pickupData=Object.assign(Object.assign({},this.pickupData),{due_upon_booking:"",vehicle_type_code:""});return}let e=C.pickup_service.allowed_options.find((e=>e.location.id===+this.pickupData.location&&e.vehicle.code===t.detail));if(!e){return}this.vehicleCapacity=[...this.pickupService.getNumberOfVehicles(e.vehicle.capacity,this.numberOfPersons)];this.pickupData=Object.assign(Object.assign({},this.pickupData),{selected_option:e,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:e.amount,code:e.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:e.vehicle.code})}updatePickupData(t,e){this.pickupData=Object.assign(Object.assign({},this.pickupData),{[t]:e})}async savePickup(){try{this.isLoading=true;this.autoValidate=true;if(this.errors){this.errors=null}this.errors=this.pickupService.validateForm(this.pickupData,this.pickupSchema);if(this.errors){return}await this.pickupService.savePickup(this.pickupData,this.bookingNumber,this.defaultPickupData!==null&&this.pickupData.location===-1);this.resetBookingEvt.emit(null);this.closeModal.emit(null)}catch(t){console.error(t)}finally{this.isLoading=false}}render(){var t,e,s,o,a;return i("form",{key:"de75c789733b0311fa2d8af0d58c1fc9a7a85ef8",class:"sheet-container",onSubmit:async t=>{t.preventDefault();await this.savePickup()}},i("ir-title",{key:"2b083c43018117fa4adfbfed50bc1222c35f8895",class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:D.entries.Lcz_Pickup,displayContext:"sidebar"}),i("section",{key:"2c55c0f9c741301c2c4bdc691c48b4a3a0a65a74",class:"px-1 sheet-body"},i("ir-select",{key:"beba143d9a288846df99c0945924f335e61304f6",testId:"pickup_location",selectedValue:this.pickupData.location,selectContainerStyle:"mb-1",onSelectChange:this.handleLocationChange.bind(this),firstOption:D.entries.Lcz_Pickup_NoThankYou,class:"m-0 mb-1",LabelAvailable:false,data:this.pickupService.getAvailableLocations(D.entries.Lcz_Pickup_YesFrom)}),this.pickupData.location>0&&i("div",{key:"92716aa2f70236804c1042c0ae63bc8ee77c08a4",class:"m-0 p-0","data-testid":"pickup_body"},i("div",{key:"161fc3d2a2047d8df492a388a42c18a8a0099890",class:"d-flex"},i("div",{key:"4a3475769d2c6ddcd4e5e67049d4d9cb4e3ef110",class:"form-group  mr-1"},i("div",{key:"2dc4e7728f9a8c22022989e3334ab32780ce2e93",class:"input-group row m-0"},i("div",{key:"c9c0e92f16b7411d1169458092afeef6cba377f7",class:`input-group-prepend col-5 p-0 text-dark border-0`},i("label",{key:"bf20663a262086c210df6df4de765dae9793ca2c",class:`input-group-text  flex-grow-1 text-dark border-theme `},D.entries.Lcz_ArrivalDate)),i("div",{key:"c089a0fd0d54f6a4a1bc972f01f91c9766b1ea59",class:"form-control  form-control-md col-7 d-flex align-items-center px-0 mx-0",style:{border:"0"}},i("ir-date-picker",{key:"07102f76e29a001c4206e44aada1655c77858223","data-testid":"pickup_arrival_date",date:this.pickupData.arrival_date,minDate:this.bookingDates.from,maxDate:(t=this.bookingDates)===null||t===void 0?void 0:t.to,emitEmptyDate:true,"aria-invalid":((e=this.errors)===null||e===void 0?void 0:e.arrival_date)&&!this.pickupData.arrival_date?"true":"false",onDateChanged:t=>{var e;this.updatePickupData("arrival_date",(e=t.detail.start)===null||e===void 0?void 0:e.format("YYYY-MM-DD"))}},i("input",{key:"5ee82825f0637d363f0dacf189ed311a086317c5",type:"text",slot:"trigger",value:this.pickupData.arrival_date?w(this.pickupData.arrival_date).format("MMM DD, YYYY"):null,class:`form-control input-sm ${((s=this.errors)===null||s===void 0?void 0:s.arrival_date)&&!this.pickupData.arrival_date?"border-danger":""} text-center`,style:{borderTopLeftRadius:"0",borderBottomLeftRadius:"0",width:"100%"}}))))),i("ir-input-text",{key:"6e49ac8bb440a093b1939e1ac46b9eabefc0b2be",autoValidate:this.autoValidate,wrapKey:"arrival_time",testId:"pickup_arrival_time",error:(o=this.errors)===null||o===void 0?void 0:o.arrival_time,value:this.pickupData.arrival_time,zod:this.pickupSchema.pick({arrival_time:true}),label:D.entries.Lcz_Time,inputStyles:"col-sm-4","data-state":this.cause==="arrival_time"?"error":"",mask:this.arrival_time_mask,onTextChange:t=>this.updatePickupData("arrival_time",t.detail)})),i("ir-input-text",{key:"92fdd8d27e96b9eb526a5e64ca7b1619db5e6f93",wrapKey:"flight_details",zod:this.pickupSchema.pick({flight_details:true}),autoValidate:this.autoValidate,testId:"pickup_flight_details",value:this.pickupData.flight_details,label:D.entries.Lcz_FlightDetails,onTextChange:t=>this.updatePickupData("flight_details",t.detail),placeholder:"",error:(a=this.errors)===null||a===void 0?void 0:a.flight_details}),i("ir-select",{key:"418cb4d0ac6e023af6a148c289c9b018a86185a7",testId:"pickup_vehicle_type_code",selectContainerStyle:"mb-1",error:this.cause==="vehicle_type_code",onSelectChange:this.handleVehicleTypeChange.bind(this),firstOption:D.entries.Lcz_Select,selectedValue:this.pickupData.vehicle_type_code,class:"m-0",LabelAvailable:false,data:this.allowedOptionsByLocation.map((t=>({text:t.vehicle.description,value:t.vehicle.code})))}),i("div",{key:"c9227001eeea30e273b1078870d30e067390e6b9",class:"d-flex flex-column flex-md-row"},i("ir-select",{key:"24fb31404ed8de34ad178ee410df555141c0a593",showFirstOption:false,testId:"pickup_number_of_vehicles",labelBorder:"theme",selectContainerStyle:"mb-1",onSelectChange:this.handleVehicleQuantityChange.bind(this),selectedValue:this.pickupData.number_of_vehicles,error:this.cause==="number_of_vehicles",labelWidth:7,class:"m-0  mb-md-0 mr-md-1 flex-fill",label:D.entries.Lcz_NbrOfVehicles,data:this.vehicleCapacity.map((t=>({text:t,value:t})))}),i("div",{key:"e606953cd4d8579e76b8a0f579d7ea3064bae9a3",class:"price-input-container"},i("ir-price-input",{key:"fd18042f5ba0cf68949663ce0b7898c03b686ee6",readOnly:true,label:`${D.entries.Lcz_DueUponBooking}`,value:this.pickupData.due_upon_booking,currency:this.pickupData.currency.symbol}))))),i("div",{key:"8412f6ef8910494c7ef48e320e329227c1ba5c94",class:"sheet-footer"},i("ir-button",{key:"a302b0760631ce40715757bcbb6342b91a086551",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`flex-fill`,text:D.entries.Lcz_Cancel,btn_color:"secondary"}),(this.defaultPickupData||this.pickupData.location!==-1)&&i("ir-button",{key:"0ad51fb0706d64194d5116828123660e52736ba8",btn_styles:"justify-content-center align-items-center",class:"flex-fill",isLoading:this.isLoading,text:D.entries.Lcz_Save,btn_color:"primary",btn_type:"submit"})))}get el(){return a(this)}};Qt.style=qt+Jt;const Zt=".sc-ir-pickup-view-h{display:block}";const te=Zt;const ee=class{constructor(e){t(this,e)}render(){if(!C.pickup_service.is_enabled||!this.booking.is_editable){return null}return i(o,null,i("div",{class:"mb-1"},i("div",{class:"d-flex w-100 mb-1 align-items-center justify-content-between"},i("p",{class:"font-size-large p-0 m-0 "},D.entries.Lcz_Pickup),i("ir-button",{id:"pickup","data-testid":"new_pickup_btn",variant:"icon",icon_name:"edit",style:Object.assign(Object.assign({},B.secondary),{"--icon-size":"1.5rem"})})),this.booking.pickup_info&&i("div",{class:"card"},i("div",{class:"p-1"},i("div",{class:"d-flex align-items-center py-0 my-0 pickup-margin"},i("p",{class:"font-weight-bold mr-1 py-0 my-0"},D.entries.Lcz_Date,": ",i("span",{class:"font-weight-normal"},w(this.booking.pickup_info.date,"YYYY-MM-DD").format("MMM DD, YYYY"))),this.booking.pickup_info.hour&&this.booking.pickup_info.minute&&i("p",{class:"font-weight-bold flex-fill py-0 my-0"},D.entries.Lcz_Time,":",i("span",{class:"font-weight-normal"}," ",N(this.booking.pickup_info.hour.toString(),this.booking.pickup_info.minute.toString()))),i("p",{class:"font-weight-bold py-0 my-0"},D.entries.Lcz_DueUponBooking,":"," ",i("span",{class:"font-weight-normal"},this.booking.pickup_info.currency.symbol,this.booking.pickup_info.total))),i("p",{class:"font-weight-bold py-0 my-0"},D.entries.Lcz_FlightDetails,":",i("span",{class:"font-weight-normal"}," ",`${this.booking.pickup_info.details}`)),i("p",{class:"py-0 my-0 pickup-margin"},`${this.booking.pickup_info.selected_option.vehicle.description}`),i("p",{class:"font-weight-bold py-0 my-0 pickup-margin"},D.entries.Lcz_NbrOfVehicles,":",i("span",{class:"font-weight-normal"}," ",`${this.booking.pickup_info.nbr_of_units}`)),i("p",{class:"small py-0 my-0 pickup-margin"},C.pickup_service.pickup_instruction.description,C.pickup_service.pickup_cancelation_prepayment.description)))))}};ee.style=te;const ie=".sc-ir-pms-logs-h{display:block}.dialog-container-height.sc-ir-pms-logs{height:4rem}.list-title.sc-ir-pms-logs{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-pms-logs{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-pms-logs{color:#629a4c;font-weight:600}.list-item.red.sc-ir-pms-logs{color:#ff4961;font-weight:600}";const se=ie;const oe=class{constructor(e){t(this,e);this.bookingService=new r}componentWillLoad(){this.init()}async init(){try{this.pmsLogs=await this.bookingService.fetchPMSLogs(this.bookingNumber)}catch(t){console.error(t)}}render(){var t,e,s,o,a,n,r,l;return i("div",{key:"c7855c75740a4f34db464af7bf67e8f7d2a9caad",class:"p-1"},i("h3",{key:"3b5d72e1aaff6932d9aa32dec75b7ffa70aee761",class:" text-left mb-1 dialog-title "},D.entries.Lcz_PMS_Logs),O("/Get_Exposed_PMS_Logs")?i("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},i("ir-spinner",null)):i("div",{class:"dialog-container-height"},i("div",{class:"d-flex align-items-center ",style:{paddingBottom:"0.5rem"}},i("p",{class:"list-title p-0 m-0"},D.entries.Lcz_SentAt),((t=this.pmsLogs)===null||t===void 0?void 0:t.sent_date)?i("p",{class:"list-item"},(e=this.pmsLogs)===null||e===void 0?void 0:e.sent_date," ",N((s=this.pmsLogs)===null||s===void 0?void 0:s.sent_hour.toString(),(o=this.pmsLogs)===null||o===void 0?void 0:o.sent_minute.toString())):i("p",{class:`list-item ${((a=this.pmsLogs)===null||a===void 0?void 0:a.sent_date)?"green":"red"}`},((n=this.pmsLogs)===null||n===void 0?void 0:n.is_acknowledged)?D.entries.Lcz_YES:D.entries.Lcz_NO)),i("div",{class:"d-flex align-items-center p-0 m-0"},i("h4",{class:"list-title p-0 m-0"},D.entries.Lcz_Acknowledged),i("p",{class:`list-item  ${((r=this.pmsLogs)===null||r===void 0?void 0:r.is_acknowledged)?"green":"red"}`},((l=this.pmsLogs)===null||l===void 0?void 0:l.is_acknowledged)?D.entries.Lcz_YES:D.entries.Lcz_NO))))}};oe.style=se;const ae=":host{display:block;width:100%}*{box-sizing:border-box}.popover-trigger{all:unset;cursor:pointer}.popover-trigger:hover,.popover-trigger:focus{color:#000}";const ne=ae;const re=class{constructor(e){t(this,e);this.irPopoverLeft="10px";this.placement="auto";this.trigger="focus";this.renderContentAsHtml=false;this.initialized=false}componentDidLoad(){if(this.initialized){return}this.initializePopover()}initializePopover(){$(this.popoverTrigger).popover({trigger:this.trigger,content:this.content,placement:this.placement,html:this.renderContentAsHtml});this.initialized=true}disconnectedCallback(){$(this.popoverTrigger).popover("dispose")}render(){return i(o,{key:"064f7e9d42863b6989154054178b32bfe649e270",style:{"--ir-popover-left":this.irPopoverLeft}},this.trigger!=="focus"?i("p",{ref:t=>this.popoverTrigger=t,class:"popover-title m-0 p-0",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer"}},i("slot",null)):i("button",{tabindex:"0",class:"popover-trigger",ref:t=>this.popoverTrigger=t},i("slot",null)))}get el(){return a(this)}};re.style=ne;const le=".sc-ir-reservation-information-h{display:block}";const ce=le;const de=class{constructor(i){t(this,i);this.openSidebar=e(this,"openSidebar",7);this.userCountry=null}componentWillLoad(){var t,e,i;const s=(e=(t=this.booking)===null||t===void 0?void 0:t.guest)===null||e===void 0?void 0:e.country_id;this.userCountry=s?((i=this.countries)===null||i===void 0?void 0:i.find((t=>t.id===s)))||null:null}handleEditClick(t,e){t.stopImmediatePropagation();t.stopPropagation();this.openSidebar.emit({type:e})}renderPhoneNumber(){const{mobile_without_prefix:t,country_phone_prefix:e,country_id:i}=this.booking.guest;if(!t){return null}if(e){return e+" "+t}if(i){const e=this.countries.find((t=>t.id===i));if(!e){throw new Error("Invalid country id")}return e.phone_prefix+" "+t}return t}render(){var t,e,s,o,a,n;const r=v(this.booking.extras);return i("div",{key:"e15d17cd1ec922b781470a03915961aed7acfacc",class:"card"},i("div",{key:"bf08209974a4ceec689ea00507c8906bdfee5208",class:"p-1"},i("p",{key:"b716f0effad645b1585a71ae3de7b45c20d26eab"},this.booking.property.name||""),i("ir-label",{key:"272dad2262a0e1e576971d3f6507f433b8672575",labelText:`${D.entries.Lcz_Source}:`,content:this.booking.origin.Label,image:{src:this.booking.origin.Icon,alt:this.booking.origin.Label}}),i("ir-label",{key:"4e72251d0d806f32695fdd6954ffc264e7fcbb0d",renderContentAsHtml:true,labelText:`${D.entries.Lcz_BookedOn}:`,content:`${A(this.booking.booked_on.date)}&nbsp&nbsp&nbsp&nbsp${N(this.booking.booked_on.hour.toString(),this.booking.booked_on.minute.toString())}`}),i("ir-label",{key:"03765d916cb31a0fc123e23958800a8e8f2ec14b",labelText:`${D.entries.Lcz_BookedBy}:`,content:`${this.booking.guest.first_name} ${this.booking.guest.last_name}`},((t=this.booking.guest)===null||t===void 0?void 0:t.nbr_confirmed_bookings)>1&&!this.booking.agent&&i("div",{key:"18f451e84e00398cba27df2e373b99de7b6ff4f2",class:"m-0 p-0",slot:"prefix"},i("ir-tooltip",{key:"9228efc8fe844d184d70ac273942fec66ad5d236",message:`${D.entries.Lcz_BookingsNbr}`.replace("%1",this.booking.guest.nbr_confirmed_bookings.toString()),customSlot:true},i("div",{key:"df0a66c89bf1f86e2bcba0dfedddaa8eee7101a8",class:"d-flex align-items-center m-0 p-0",slot:"tooltip-trigger",style:{gap:"0.25rem"}},i("p",{key:"d474fb8e75c4b69bd9f329a99740f05ba42d3399",class:"p-0 m-0",style:{color:"#FB0AAD"}},this.booking.guest.nbr_confirmed_bookings),i("ir-icons",{key:"f3dfae4d2073911868d3a5e004fefd4be44eb190",style:{"--icon-size":"1rem"},color:"#FB0AAD",name:"heart-fill"})))),i("ir-button",{key:"28fe49ab27b8f5cfa21fec23e4297bbffce7213d",slot:"suffix",variant:"icon",icon_name:"edit",style:Object.assign(Object.assign({},B.secondary),{"--icon-size":"1.1rem"}),onClickHandler:t=>this.handleEditClick(t,"guest")})),this.booking.guest.mobile&&i("ir-label",{key:"28a2bc6e4e12e113216f8757c3e60edfdb7bf8aa",labelText:`${D.entries.Lcz_Phone}:`,content:this.renderPhoneNumber()}),!this.booking.agent&&i("ir-label",{key:"a8a271bade196c51f7017fb7bdf841fe2dfeae1e",labelText:`${D.entries.Lcz_Email}:`,content:this.booking.guest.email}),this.booking.guest.alternative_email&&i("ir-label",{key:"4313376f758cf733309d43e8c151d8838fb8c4a7",labelText:`${D.entries.Lcz_AlternativeEmail}:`,content:this.booking.guest.alternative_email}),((s=(e=this.booking)===null||e===void 0?void 0:e.guest)===null||s===void 0?void 0:s.address)&&i("ir-label",{key:"ab13ddd72cdbde91ed741d438d75d762780d3dba",labelText:`${D.entries.Lcz_Address}:`,content:this.booking.guest.address}),this.userCountry&&i("ir-label",{key:"f240c9560ee93545bd4e44a09a99e73387d2caf5",labelText:`${D.entries.Lcz_Country}:`,isCountryImage:true,content:this.userCountry.name,image:{src:this.userCountry.flag,alt:this.userCountry.name}}),((o=this.booking.guest)===null||o===void 0?void 0:o.notes)&&i("ir-label",{key:"40737039628585fb5f61755a02e141bd89e09bee",display:"inline",labelText:`${D.entries.Lcz_GuestPrivateNote}:`,content:(a=this.booking.guest)===null||a===void 0?void 0:a.notes}),this.booking.is_direct&&i("ir-label",{key:"9e156e6332be385e20bc498a28519b28947b3cce",labelText:`${D.entries.Lcz_ArrivalTime}:`,content:this.booking.arrival.description}),this.booking.promo_key&&i("ir-label",{key:"18ceefbd60d0c9776d7b65bc1be5b16e67b8c7de",labelText:`${D.entries.Lcz_Coupon}:`,content:this.booking.promo_key}),this.booking.is_in_loyalty_mode&&!this.booking.promo_key&&i("div",{key:"96834b2ac03f4ea33c3eff1be0a55424d8d0feb6",class:"d-flex align-items-center"},i("svg",{key:"9dcd9dfe92ebbdf1e7a24428133c9f11f3167aca",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},i("path",{key:"38ffdec63bf93fb885d11abd0ae8a7c2b4dac174",fill:"#fc6c85",d:"M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"})),i("p",{key:"300c011c5d0c6aabebb17c1f329b8bb9ef783d42",class:"m-0 p-0 ml-1"},D.entries.Lcz_LoyaltyDiscountApplied)),this.booking.is_direct?i("ir-label",{labelText:`${D.entries.Lcz_GuestRemark}:`,display:"inline",content:this.booking.remark}):i("ota-label",{class:"m-0 p-0",label:`${D.entries.Lcz_ChannelNotes||"Channel notes"}:`,remarks:this.booking.ota_notes,maxVisibleItems:(n=this.booking.ota_notes)===null||n===void 0?void 0:n.length}),i("div",{key:"be4bcc8dd3122486d1b9ebe57bda41e02ae529b3",class:"d-flex align-items-center justify-content-between"},i("ir-label",{key:"37dbe5a1273b2421a7f4443e4fd64fe588d55b03",labelText:`${D.entries.Lcz_BookingPrivateNote}:`,placeholder:D.entries.Lcz_VisibleToHotelOnly,content:r,display:r?"inline":"flex"}),i("ir-button",{key:"7bdea5528a367baaf8b955448ec336b0e2fb36fd",variant:"icon",icon_name:"edit",style:B.secondary,onClickHandler:t=>this.handleEditClick(t,"extra_note")}))))}};de.style=ce;const he=".light-blue-bg.sc-ir-room{background:#acecff;padding:0.1rem 0.3rem;border-radius:5px;display:block;max-width:100px;box-sizing:border-box;display:inline-block;overflow:hidden;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:default}.room_statements.sc-ir-room{display:block;width:100%}.room_statements.sc-ir-room{display:block;width:100%}.room_statements.sc-ir-room span.sc-ir-room{display:inline;white-space:normal;line-height:1.5;word-break:break-word}.room_statements.sc-ir-room b.sc-ir-room{display:inline;margin-right:5px}.payment-container.sc-ir-room{position:absolute;right:1rem;height:fit-content}.sc-ir-room-h{position:relative}.sm-mr.sc-ir-room{margin-right:3px}.subtotal_row.sc-ir-room{padding-top:8px;font-weight:600}.room_actions_btns.sc-ir-room{gap:0.5rem}.night-cost.sc-ir-room{color:#7cbebe}.room_actions_btns.sc-ir-room{white-space:nowrap;width:max-content}.room_actions_btns.sc-ir-room{flex:1 1 0%;display:flex;justify-content:flex-end}.mx-0-5.sc-ir-room{margin-left:2px !important;margin-right:2px !important}.tax-width.sc-ir-room{font-size:10px}.sm-mb-1.sc-ir-room{margin-bottom:5px !important}.sm-mt-1.sc-ir-room{margin-top:5px !important}.mx-01.sc-ir-room{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}";const ue=he;const fe=class{constructor(i){t(this,i);this.deleteFinished=e(this,"deleteFinished",7);this.toast=e(this,"toast",7);this.pressCheckIn=e(this,"pressCheckIn",7);this.pressCheckOut=e(this,"pressCheckOut",7);this.editInitiated=e(this,"editInitiated",7);this.resetbooking=e(this,"resetbooking",7);this.openSidebar=e(this,"openSidebar",7);this.currency="USD";this.language="en";this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.collapsed=false;this.isLoading=false;this.modalReason=null;this.isModelOpen=false;this.bookingService=new r}componentWillLoad(){this.mainGuest=this.getMainGuest()}handleClick(t){let e=t.target;if(e.id=="checkin"){this.pressCheckIn.emit(this.room)}else if(e.id=="checkout"){this.pressCheckOut.emit(this.room)}}handleRoomDataChange(){this.mainGuest=this.getMainGuest()}getDateStr(t,e="default"){return t.getDate()+" "+t.toLocaleString(e,{month:"short"})+" "+t.getFullYear()}handleEditClick(){var t,e,i,s,o,a,n,r;this.editInitiated.emit({event_type:"EDIT_BOOKING",ID:this.room["assigned_units_pool"],NAME:_((t=this.mainGuest)===null||t===void 0?void 0:t.first_name,(e=this.mainGuest)===null||e===void 0?void 0:e.last_name),EMAIL:this.booking.guest.email,PHONE:this.booking.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.booking.from_date,TO_DATE:this.booking.to_date,TITLE:`${D.entries.Lcz_EditBookingFor} ${(s=(i=this.room)===null||i===void 0?void 0:i.roomtype)===null||s===void 0?void 0:s.name} ${((a=(o=this.room)===null||o===void 0?void 0:o.unit)===null||a===void 0?void 0:a.name)||""}`,defaultDateRange:{dateDifference:this.room.days.length,fromDate:new Date(this.room.from_date+"T00:00:00"),fromDateStr:this.getDateStr(new Date(this.room.from_date+"T00:00:00")),toDate:new Date(this.room.to_date+"T00:00:00"),toDateStr:this.getDateStr(new Date(this.room.to_date+"T00:00:00")),message:""},bed_preference:this.room.bed_preference,adult_child_offering:this.room.rateplan.selected_variation.adult_child_offering,ADULTS_COUNT:this.room.rateplan.selected_variation.adult_nbr,ARRIVAL:this.booking.arrival,ARRIVAL_TIME:this.booking.arrival.description,BOOKING_NUMBER:this.booking.booking_nbr,cancelation:this.room.rateplan.cancelation,channel_booking_nbr:this.booking.channel_booking_nbr,CHILDREN_COUNT:this.room.rateplan.selected_variation.child_nbr,COUNTRY:this.booking.guest.country_id,ENTRY_DATE:this.booking.from_date,FROM_DATE_STR:this.booking.format.from_date,guarantee:this.room.rateplan.guarantee,GUEST:this.mainGuest,IDENTIFIER:this.room.identifier,is_direct:this.booking.is_direct,IS_EDITABLE:this.booking.is_editable,NO_OF_DAYS:this.room.days.length,NOTES:this.booking.remark,origin:this.booking.origin,POOL:this.room["assigned_units_pool"],PR_ID:(n=this.room.unit)===null||n===void 0?void 0:n.id,RATE:this.room.total,RATE_PLAN:this.room.rateplan.name,RATE_PLAN_ID:this.room.rateplan.id,RATE_TYPE:this.room.roomtype.id,ROOMS:this.booking.rooms,SOURCE:this.booking.source,SPLIT_BOOKING:false,STATUS:"IN-HOUSE",TO_DATE_STR:this.booking.format.to_date,TOTAL_PRICE:this.booking.total,legendData:this.legendData,roomsInfo:this.roomsInfo,roomName:((r=this.room.unit)===null||r===void 0?void 0:r.name)||"",PICKUP_INFO:this.booking.pickup_info,booking:this.booking,currentRoomType:this.room})}openModal(t){if(!t){return}this.modalReason=t;this.modal.openModal()}async handleModalConfirmation(t){try{t.stopImmediatePropagation();t.stopPropagation();if(!this.modalReason){return}this.isLoading=true;switch(this.modalReason){case"delete":await this.deleteRoom();break;case"checkin":case"checkout":await this.bookingService.handleExposedRoomInOut({booking_nbr:this.booking.booking_nbr,room_identifier:this.room.identifier,status:this.modalReason==="checkin"?"001":"002"});this.resetbooking.emit(null);break}}catch(t){console.log(t)}finally{this.isLoading=false;this.modalReason=null;this.modal.closeModal()}}async deleteRoom(){let t=[...this.booking.rooms];t=t.filter((t=>t.identifier!==this.room.identifier));const e={assign_units:true,check_in:true,is_pms:true,is_direct:true,booking:{booking_nbr:this.booking.booking_nbr,from_date:this.booking.from_date,to_date:this.booking.to_date,remark:this.booking.remark,property:this.booking.property,source:this.booking.source,currency:this.booking.currency,arrival:this.booking.arrival,guest:this.booking.guest,rooms:t},extras:this.booking.extras,pickup_info:this.booking.pickup_info};await this.bookingService.doReservation(e);this.deleteFinished.emit(this.room.identifier)}async updateDepartureTime(t){try{await this.bookingService.setDepartureTime({property_id:this.property_id,code:t,room_identifier:this.room.identifier});this.toast.emit({type:"success",description:"",title:"Saved Successfully",position:"top-right"})}catch(t){console.log(t)}}formatVariation({infant_nbr:t,adult_nbr:e,children_nbr:i}){const s=e>0?e:0;const o=i>0?i:0;const a=t>0?t:0;const n=s>1?D.entries.Lcz_Adults.toLowerCase():D.entries.Lcz_Adult.toLowerCase();const r=o>1?D.entries.Lcz_Children.toLowerCase():D.entries.Lcz_Child.toLowerCase();const l=a>1?D.entries.Lcz_Infants.toLowerCase():D.entries.Lcz_Infant.toLowerCase();const c=[];if(s>0){c.push(`${s} ${n}`)}if(o>0){c.push(`${o} ${r}`)}if(a>0){c.push(`${a} ${l}`)}return c.join("&nbsp&nbsp&nbsp&nbsp")}getSmokingLabel(){var t,e,i;if(this.booking.is_direct){if(!this.room.smoking_option){return null}const i=C.roomsInfo.find((t=>t.id===this.room.roomtype.id));if(i){const s=(t=i["smoking_option"])===null||t===void 0?void 0:t.allowed_smoking_options;if(s){return(e=s.find((t=>t.code===this.room.smoking_option)))===null||e===void 0?void 0:e.description}return null}return null}return(i=this.room.ota_meta)===null||i===void 0?void 0:i.smoking_preferences}getBedName(){var t,e;if(this.booking.is_direct){const e=this.bedPreferences.find((t=>{var e,i;return t.CODE_NAME===((i=(e=this.room)===null||e===void 0?void 0:e.bed_preference)===null||i===void 0?void 0:i.toString())}));if(!e){return}return(t=e[`CODE_VALUE_${this.language}`])!==null&&t!==void 0?t:e.CODE_VALUE_EN}return(e=this.room.ota_meta)===null||e===void 0?void 0:e.bed_preferences}renderModalMessage(){switch(this.modalReason){case"delete":return`${D.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${this.room.roomtype.name} ${this.room.unit?this.room.unit.name:""} ${D.entries.Lcz_FromThisBooking}`;case"checkin":return`Are you sure you want to Check In this unit?\n`;case"checkout":return`Are you sure you want to Check Out this unit?`;default:return""}}handleCheckIn(){const{adult_nbr:t,children_nbr:e,infant_nbr:i}=this.room.occupancy;if(this.room.sharing_persons.length<t+e+i){return this.showGuestModal()}return this.renderModalMessage()}getMainGuest(){var t;return(t=this.room.sharing_persons)===null||t===void 0?void 0:t.find((t=>t.is_main))}render(){var t,e,a,n;const r=this.getBedName();return i(o,{key:"6c9694c877b47f5e63ef8a500c78990c7f20ee2d",class:"p-1 d-flex m-0"},i("ir-button",{key:"8cfd851a779da4cbafbb444ff3be647e4b68ca3f",variant:"icon",id:"drawer-icon","data-toggle":"collapse","data-target":`#roomCollapse-${(t=this.room.identifier)===null||t===void 0?void 0:t.split(" ").join("")}`,"aria-expanded":this.collapsed?"true":"false","aria-controls":"myCollapse",class:"mr-1",icon_name:this.collapsed?"closed_eye":"open_eye",onClickHandler:()=>{this.collapsed=!this.collapsed},style:{"--icon-size":"1.6rem"}}),i("div",{key:"c182ae14d896826e3a4df205825de81722c3748b",class:"flex-fill m-0 "},i("div",{key:"e34d8a3af41cb003c02f548b453b934f94580fb1",class:"d-flex align-items-start justify-content-between sm-mb-1"},i("p",{key:"927bae0af761838f025072c6952afada2ad69207",class:"m-0 p-0"},i("span",{key:"2da0ac3b49bb4ba4454e7d7a8f67fd2af2ebd64f",class:"m-0 p-0",style:{fontWeight:"600"}},this.myRoomTypeFoodCat||""," ")," ",this.mealCodeName," ",this.room.rateplan.is_non_refundable&&` - ${D.entries.Lcz_NonRefundable}`," "),i("div",{key:"a39e69722c7eb857734244dc34261c9e8c90eaeb",class:"d-flex m-0 p-0 align-items-center room_actions_btns"},i("span",{key:"272f65390bd8608a275d3627e43c3948ce439ea5",class:"p-0 m-0 font-weight-bold"},g(this.currency,this.room["gross_total"])),this.hasRoomEdit&&this.isEditable&&i("ir-button",{key:"6a14dc3a66c8bdd345c223f14309f2a4884c2a6d",id:`roomEdit-${this.room.identifier}`,variant:"icon",icon_name:"edit",style:B.secondary,onClickHandler:this.handleEditClick.bind(this)}),this.hasRoomDelete&&this.isEditable&&i("ir-button",{key:"e208b973a9cc832e32f1aed308e44bd3e24d5b60",variant:"icon",onClickHandler:this.openModal.bind(this,"delete"),id:`roomDelete-${this.room.identifier}`,icon_name:"trash",style:B.danger}))),i("div",{key:"935b6bb350d392a4e0677d469ad34a7dd432a743",class:"d-flex align-items-center sm-mb-1"},i("ir-date-view",{key:"fb025b08c4064c2608b356a31389c9519f4472fb",class:"mr-1  flex-grow-1",style:{width:"fit-content"},from_date:this.room.from_date,to_date:this.room.to_date,showDateDifference:false}),!T(this.room.roomtype.id)&&C.is_frontdesk_enabled&&this.room.unit&&i("div",{key:"7cd2cecfcd3e4c710f2bc9823859090fda0fab8e",class:"d-flex justify-content-center align-items-center"},i("ir-tooltip",{key:"a616bfdc02fee02f9f433dedf82b43eaccaada0b",message:this.room.unit.name,customSlot:true},i("span",{key:"67aea0c1cd430b14e8625a6a0b82009648293adb",slot:"tooltip-trigger",class:`light-blue-bg  ${this.hasCheckIn||this.hasCheckOut?"mr-2":""} `},this.room.unit.name))),this.hasCheckIn&&i("ir-button",{key:"f952ed8438a4f96d0cbebbd5a16f516c07faa077",onClickHandler:this.handleCheckIn.bind(this),id:"checkin",btn_color:"outline",size:"sm",text:D.entries.Lcz_CheckIn}),this.hasCheckOut&&i("ir-button",{key:"ebfb167547257948c7eff9bf8a11adf955623634",onClickHandler:this.openModal.bind(this,"checkout"),id:"checkout",btn_color:"outline",size:"sm",text:D.entries.Lcz_CheckOut})),i("div",{key:"286844ecdff20f46372cd4acc92c368652517ce9",class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("p",{key:"176a4feb98ff14f0179a12100bff60889ede41d7",class:"m-0 p-0"},`${this.mainGuest.first_name||""} ${this.mainGuest.last_name||""}`),this.room.rateplan.selected_variation.adult_nbr>0&&(this.room.unit?i("ir-tooltip",{message:"View guests",class:"m-0 p-0",customSlot:true},i("ir-button",{class:"m-0 p-0",slot:"tooltip-trigger",btn_color:"link",renderContentAsHtml:true,onClickHandler:()=>this.showGuestModal(),size:"sm",btnStyle:{width:"fit-content",margin:"0",padding:"0",fontSize:"inherit",textAlign:"center",lineHeight:"1.2"},text:this.formatVariation(this.room.occupancy)})):i("span",{innerHTML:this.formatVariation(this.room.occupancy)})),r&&i("p",{key:"7e63d54bbdcfc129b7e1afe964f190d30563a9ce",class:"m-0 p-0"},"(",r,")")),i("div",{key:"9cca8ed1694417353e6afa282291557fb0bb0126",class:"d-flex align-items-center",style:{marginTop:"0.5rem",marginBottom:"0.875rem",gap:"0.5rem"}},i("p",{key:"fff7dc4b2d19e041571a847f8e61b1c02eb7b03d",class:"m-0 p-0"},"Expected departure time:"),i("ir-select",{key:"d9e01b68d30d8502271d83f1227e13e5dcf517ff",selectedValue:(e=this.room.departure_time)===null||e===void 0?void 0:e.code,LabelAvailable:false,showFirstOption:false,onSelectChange:t=>{this.updateDepartureTime(t.detail)},data:(a=this.departureTime)===null||a===void 0?void 0:a.map((t=>{var e,i;return{text:(i=t[`CODE_VALUE_${(e=this.language)===null||e===void 0?void 0:e.toUpperCase()}`])!==null&&i!==void 0?i:t[`CODE_VALUE_EN`],value:t.CODE_NAME}}))})),i("div",{key:"8f42acc91b9992921c7570a74e730f5263e6bf34",class:"collapse",id:`roomCollapse-${(n=this.room.identifier)===null||n===void 0?void 0:n.split(" ").join("")}`},i("div",{key:"fa5565fe0fe6d39c008a13bdf285e4b13f84c5c5",class:"d-flex sm-mb-1 sm-mt-1"},i("div",{key:"45f02757240cdec31df9ec5ece14096c56a458e4",class:" sm-padding-top"},i("p",{key:"651959ba296b077cd79d2184813410f34fd3872e",class:"sm-padding-right",style:{fontWeight:"600"}},`${D.entries.Lcz_Breakdown}:`)),i("div",{key:"1b0e50b2bb749ffce71d23c08dd5746bcab2baf4",class:"flex-fill"},i("table",{key:"63e436bf57293756925d6f9dafb3e2028943704e"},this.room.days.length>0&&this.room.days.map((t=>i("tr",null,i("td",{class:"pr-2 text-right"},L(t.date)),i("td",{class:"text-right"},g(this.currency,t.amount)),t.cost>0&&t.cost!==null&&i("td",{class:"pl-2 text-left night-cost"},g(this.currency,t.cost))))),i("tr",{key:"81f4458f313b4217c969d6a0db71a3c869ba80fa",class:""},i("th",{key:"d0b53960e96bef6616ced039b8f228a59710dbf7",class:"text-right pr-2 subtotal_row"},D.entries.Lcz_SubTotal),i("th",{key:"a49c5fc60f4c66861376a03a686bfd25a4dd251d",class:"text-right subtotal_row"},g(this.currency,this.room.total)),this.room.gross_cost>0&&this.room.gross_cost!==null&&i("th",{key:"01b0db32e4da89f5533e85496231819bc3e09041",class:"pl-2 text-right night-cost"},g(this.currency,this.room.cost))),this.booking.is_direct?i(s,null,(()=>{const t=C.taxes.filter((t=>t.pct>0));return t.map((t=>i("tr",null,i("td",{class:"text-right pr-2"},t.is_exlusive?D.entries.Lcz_Excluding:D.entries.Lcz_Including," ",t.name," (",t.pct,"%)"),i("td",{class:"text-right"},g(this.currency,this.room.total*t.pct/100)),this.room.gross_cost>0&&this.room.gross_cost!==null&&i("td",{class:"pl-2 text-right night-cost"},g(this.currency,this.room.cost*t.pct/100)))))})()):i(s,null,(()=>{const t=this.room.ota_taxes.filter((t=>t.amount>0));return t.map((t=>i("tr",null,i("td",{class:"text-right pr-2"},t.is_exlusive?D.entries.Lcz_Excluding:D.entries.Lcz_Including," ",t.name),i("td",{class:"text-right"},t.currency.symbol,t.amount))))})())))),i("ir-label",{key:"971376af571045b7f449b1e69325a6c57c5ba701",labelText:`${D.entries.Lcz_SmokingOptions}:`,display:"inline",content:this.getSmokingLabel()}),this.booking.is_direct&&i(s,{key:"1072af549f31c9fce4127e2e784ba7bf0661c96a"},this.room.rateplan.cancelation&&i("ir-label",{key:"81d20ea57241f83b5c7062433e2e18ea468e10f9",labelText:`${D.entries.Lcz_Cancellation}:`,display:"inline",content:this.room.rateplan.cancelation||"",renderContentAsHtml:true}),this.room.rateplan.guarantee&&i("ir-label",{key:"da4816698f0df751654371e3eef6b3cc7df3bc3b",labelText:`${D.entries.Lcz_Guarantee}:`,display:"inline",content:this.room.rateplan.guarantee||"",renderContentAsHtml:true})),this.room.ota_meta&&i("div",{key:"8c045f7e40365ee3aea8f821a2d9ef24be3b3cec"},i("ir-label",{key:"cece74e670e4a79bc0188e19e0ed9b74ec3942f0",labelText:`${D.entries.Lcz_MealPlan}:`,display:"inline",content:this.room.ota_meta.meal_plan}),i("ir-label",{key:"580198f1380b0023adbd35724aceb078dbbaaded",labelText:`${D.entries.Lcz_Policies}:`,display:"inline",content:this.room.ota_meta.policies})))),i("ir-modal",{key:"f1efe122e1d74c47fbf0e649dda71e824768feda",autoClose:false,ref:t=>this.modal=t,isLoading:this.isLoading,onConfirmModal:this.handleModalConfirmation.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:D.entries.Lcz_Cancel,rightBtnText:this.modalReason==="delete"?D.entries.Lcz_Delete:D.entries.Lcz_Confirm,leftBtnColor:"secondary",rightBtnColor:this.modalReason==="delete"?"danger":"primary",modalTitle:D.entries.Lcz_Confirmation,modalBody:this.renderModalMessage()}))}showGuestModal(){var t;const{adult_nbr:e,children_nbr:i,infant_nbr:s}=this.room.occupancy;this.openSidebar.emit({type:"room-guest",payload:{roomName:(t=this.room.unit)===null||t===void 0?void 0:t.name,sharing_persons:this.room.sharing_persons,totalGuests:e+i+s,checkin:this.hasCheckIn,identifier:this.room.identifier}})}get element(){return a(this)}static get watchers(){return{room:["handleRoomDataChange"]}}};fe.style=ue;const be={id:-1,full_name:"",country_id:null,dob:"",id_info:{type:{code:null,description:null},number:""},address:null,alternative_email:null,cci:null,city:null,country:undefined,country_phone_prefix:null,email:null,first_name:"",last_name:"",mobile:null,nbr_confirmed_bookings:0,notes:null,password:null,subscribe_to_news_letter:null};const pe={mask:Date,pattern:"DD/MM/YYYY",lazy:false,min:new Date(1900,0,1),max:new Date,format:t=>w(t).format("DD/MM/YYYY"),parse:t=>w(t,"DD/MM/YYYY").toDate(),autofix:true,placeholderChar:"_",blocks:{YYYY:{mask:z,from:1970,to:(new Date).getFullYear(),placeholderChar:"Y"},MM:{mask:z,from:1,to:12,placeholderChar:"M"},DD:{mask:z,from:1,to:31,placeholderChar:"D"}}};const me=".sc-ir-room-guests-h{display:block;height:100%;position:relative;text-align:start !important}.id-select.sc-ir-room-guests{border-top-right-radius:0;border-bottom-right-radius:0;border-right-width:0}.sc-ir-room-guests-h{display:block;width:100%}.guest-grid.sc-ir-room-guests>*.sc-ir-room-guests{height:100%}.guests-labels.sc-ir-room-guests{display:none}.guest_label.sc-ir-room-guests{width:100px;color:#6b6f82}.sharing_persons_label.sc-ir-room-guests{display:none}.loading-container.sc-ir-room-guests{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.guest_document.sc-ir-room-guests input.sc-ir-room-guests{border-top-left-radius:0;border-bottom-left-radius:0}.guests-labels.sc-ir-room-guests *.sc-ir-room-guests,.sharing_persons_label.sc-ir-room-guests{margin-bottom:0.5rem;padding-bottom:0}@media (min-width: 768px){.sharing_persons_label.sc-ir-room-guests{display:block}.guest_country_picker.sc-ir-room-guests{margin-bottom:3px}.guest-grid.sc-ir-room-guests{display:grid;grid-template-columns:2fr 2fr 2fr 2fr 5fr;gap:0.5rem;align-items:flex-start}.guest_label.sc-ir-room-guests,.sharing_persons_heading.sc-ir-room-guests,.main_guest_heading.sc-ir-room-guests{display:none}}";const ge=me;const ve=".sc-ir-room-guests-h{height:100%}.sheet-container.sc-ir-room-guests{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-room-guests{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-room-guests{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-room-guests{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-room-guests{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-room-guests{flex-direction:row;align-items:center}}";const ye=ve;const ke=class{constructor(i){t(this,i);this.closeModal=e(this,"closeModal",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.updateRoomGuests=e(this,"updateRoomGuests",7);this.sharedPersons=[];this.totalGuests=0;this.language="en";this.guests=[];this.idTypes=[];this.error={};this.autoValidate=false;this.bookingService=new r}componentWillLoad(){this.init();this.initializeGuests()}async init(){try{this.isLoading=true;const[t,e]=await Promise.all([this.bookingService.getUserDefaultCountry(),this.bookingService.getSetupEntriesByTableName("_ID_TYPE")]);this.idTypes=e;if(t){this.propertyCountry=this.countries.find((e=>e.id===t.COUNTRY_ID))}}catch(t){console.error(t)}finally{this.isLoading=false}}initializeGuests(){var t,e;let i=[];if(this.totalGuests>this.sharedPersons.length){const s=this.totalGuests-this.sharedPersons.length;i=[...this.sharedPersons,...Array(s).fill(Object.assign(Object.assign({},be),{id_info:Object.assign(Object.assign({},be.id_info),{type:{code:((t=this.idTypes[0])===null||t===void 0?void 0:t.CODE_NAME)||"001",description:((e=this.idTypes[0])===null||e===void 0?void 0:e.CODE_VALUE_EN)||""},number:""})}))]}else{i=[...this.sharedPersons]}i=i.map((t=>Object.assign(Object.assign({},t),{dob:new Date(t.dob).getFullYear()===1900?null:t.dob})));this.guests=i.map((t=>Object.assign(Object.assign({},t),{dob:t.dob?w(new Date(t.dob)).format("DD/MM/YYYY"):"",country_id:t.country?t.country.id:null})))}updateGuestInfo(t,e){const i=[...this.guests];let s=i[t];s=Object.assign(Object.assign({},s),e);i[t]=s;this.guests=[...i]}async saveGuests(){try{this.error={};this.autoValidate=true;for(const t of this.guests){Ct(t)}await this.bookingService.handleExposedRoomGuests({booking_nbr:this.bookingNumber,identifier:this.identifier,guests:this.guests.map((t=>{if(!t.first_name&&t.id===-1){return null}return Object.assign(Object.assign({},t),{dob:t.dob?w(t.dob,"DD/MM/YYYY").format("YYYY-MM-DD"):null})})).filter(Boolean)});if(this.checkIn){await this.bookingService.handleExposedRoomInOut({booking_nbr:this.bookingNumber,room_identifier:this.identifier,status:"001"})}this.closeModal.emit(null);this.updateRoomGuests.emit({identifier:this.identifier,guests:this.guests});this.resetBookingEvt.emit()}catch(t){console.log(t);if(t instanceof j){let e={};t.issues.forEach((t=>{e[t.path[t.path.length-1]]=true}));this.error=Object.assign({},e)}}}render(){if(this.isLoading){return i("div",{class:"loading-container"},i("ir-spinner",null))}return i("form",{class:"sheet-container",style:{minWidth:"300px"},onSubmit:t=>{t.preventDefault();this.saveGuests()}},i("ir-title",{class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:`Room ${this.roomName}`,displayContext:"sidebar"}),i("section",{class:"sheet-body px-1"},i("div",{class:""},i("div",{class:"guest-grid guests-labels"},i("p",{class:""},D.entries.Lcz_MainGuest),i("p",{class:""}),i("p",{class:" "},D.entries.Lcz_DOB),i("p",{class:""},D.entries.Lcz_Nationality),i("p",{class:" "},D.entries.Lcz_Documents)),i("h5",{class:"main_guest_heading"},D.entries.Lcz_MainGuest),this.guests.map(((t,e)=>{var o,a;let n=true;try{Ct(t)}catch(t){n=false}console.log(`row ${e}=>${n}`);return i(s,null,e===1&&i("div",{class:"d-flex mx-0 px-0"},i("h5",{class:"mx-0 px-0 sharing_persons_heading"},D.entries.Lcz_PersonsSharingRoom),i("p",{class:"mx-0 px-0 sharing_persons_label"},D.entries.Lcz_PersonsSharingRoom)),i("div",{key:e,class:"guest-grid"},i("div",{class:"m-0 p-0 d-flex align-items-center h-100"},i("p",{class:"guest_label"},"First name"),i("ir-input-text",{class:"flex-grow-1 h-100",id:`first_name_${e}`,zod:Ot.pick({first_name:true}),error:!!this.error["first_name"]&&!n,autoValidate:this.autoValidate,wrapKey:"first_name",placeholder:"First name",onTextChange:t=>this.updateGuestInfo(e,{first_name:t.detail}),value:t.first_name,maxLength:40})),i("div",{class:"m-0 p-0 d-flex align-items-center h-100"},i("p",{class:"guest_label"},"Last name"),i("ir-input-text",{maxLength:40,class:"flex-grow-1 h-100",id:`last_name_${e}`,zod:Ot.pick({last_name:true}),error:!!this.error["last_name"]&&!n,autoValidate:this.autoValidate,wrapKey:"last_name",placeholder:"Last name",onTextChange:t=>this.updateGuestInfo(e,{last_name:t.detail}),value:t.last_name})),i("div",{class:"flex-grow-0 m-0 p-0 h-100 d-flex align-items-center"},i("p",{class:"guest_label"},D.entries.Lcz_DOB),i("ir-input-text",{class:"flex-grow-1 h-100",id:`dob_${e}`,zod:Ot.pick({dob:true}),error:!!this.error["dob"]&&!n,autoValidate:this.autoValidate,wrapKey:"dob",mask:pe,placeholder:"",onTextChange:t=>{this.updateGuestInfo(e,{dob:t.detail})},value:t.dob})),i("div",{class:" m-0 p-0 d-flex align-items-center"},i("p",{class:"guest_label"},D.entries.Lcz_Nationality),i("div",{class:"mx-0 flex-grow-1  h-100"},i("ir-country-picker",{class:"h-100",propertyCountry:this.propertyCountry,id:`{locales.entries.Lcz_Nationality}_${e}`,error:!!this.error["country_id"]&&!t.country_id,country:(o=this.countries)===null||o===void 0?void 0:o.find((e=>{var i,s,o;return((i=e.id)===null||i===void 0?void 0:i.toString())===((o=(s=t.country)===null||s===void 0?void 0:s.id)===null||o===void 0?void 0:o.toString())})),onCountryChange:t=>{var i,s,o;return this.updateGuestInfo(e,{country_id:(o=(s=(i=t.detail)===null||i===void 0?void 0:i.id)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:null,country:t.detail})},countries:this.countries}))),i("div",{class:"flex-grow-1 m-0 p-0 d-flex align-items-center"},i("p",{class:"guest_label"},D.entries.Lcz_Documents),i("div",{class:" d-flex m-0 flex-grow-1 h-100"},i("ir-select",{selectForcedStyles:{borderTopRightRadius:"0px",borderBottomRightRadius:"0px",borderRight:"0"},selectStyles:"rounded-top-0 rounded-bottom-0",onSelectChange:t=>{this.updateGuestInfo(e,{id_info:Object.assign(Object.assign({},this.guests[e].id_info),{type:{code:t.detail,description:""}})})},selectedValue:t.id_info.type.code,LabelAvailable:false,showFirstOption:false,data:(a=this.idTypes)===null||a===void 0?void 0:a.map((t=>{var e;return{text:(e=t[`CODE_VALUE_${this.language.toUpperCase()}`])!==null&&e!==void 0?e:t[`CODE_VALUE_EN`],value:t.CODE_NAME}}))}),i("ir-input-text",{autoValidate:this.autoValidate,maxLength:18,placeholder:"12345",class:"flex-grow-1 guest_document",type:"text",inputForcedStyle:{borderTopLeftRadius:"0px",borderBottomLeftRadius:"0px"},value:t.id_info.number,zod:Dt.pick({number:true}),error:!!this.error["number"]&&!n,wrapKey:"number",inputStyles:"form-control",onTextChange:t=>this.updateGuestInfo(e,{id_info:Object.assign(Object.assign({},this.guests[e].id_info),{number:t.detail})})})))))})))),i("div",{class:"sheet-footer"},i("ir-button",{onClick:()=>this.closeModal.emit(null),class:`flex-fill`,text:D.entries.Lcz_Cancel,btn_color:"secondary"}),i("ir-button",{btn_type:"submit",class:"flex-fill",isLoading:O("/Handle_Exposed_Room_Guests"),text:this.checkIn?D.entries.Lcz_CheckIn:D.entries.Lcz_Save,btn_color:"primary"})))}};ke.style=ge+ye;const _e="*.sc-ota-label{margin:0;padding:0}.sc-ota-label-h{display:flex;margin-bottom:5px;gap:5px}.label_title.sc-ota-label{min-width:max-content;padding:0;margin:0;font-weight:600}.ota-message-list.sc-ota-label{margin:0 3px;padding:0;overflow:hidden;width:100%;word-wrap:break-word !important;overflow-wrap:break-word !important}.ota-message-item.sc-ota-label{width:100%;line-height:1.5;margin:0;padding:0;word-wrap:break-word !important;overflow-wrap:break-word !important}.ota-message-item.sc-ota-label::before{content:'- ';margin-right:0.25rem}.ota-visibility-toggle.sc-ota-label{background:white;color:var(--blue);padding:0;margin:0;margin-left:3px;font-size:12px;border:0}.ota-visibility-toggle.sc-ota-label:hover{color:#355270}.ota-message-list.sc-ota-label{margin:0 3px;padding:0;overflow:hidden;width:100%;word-wrap:break-word !important;overflow-wrap:break-word !important;white-space:normal;list-style:none}.ota-message-item.sc-ota-label{width:100%;line-height:1.5;margin:0 0 0 1.2em;padding:0;word-wrap:break-word !important;overflow-wrap:break-word !important;white-space:normal;position:relative}";const xe=_e;const we=class{constructor(e){t(this,e);this.maxVisibleItems=3;this.showAll=false;this.toggleShowAll=()=>{this.showAll=!this.showAll}}render(){if(!this.remarks){return null}const t=this.showAll?this.remarks:this.remarks.slice(0,this.maxVisibleItems);return i(o,null,i("p",{class:"label_title"},this.label),i("ul",{class:"ota-message-list"},t.map(((e,s)=>i("li",{key:P(),class:"ota-message-item"},e.statement," ",this.remarks.length>this.maxVisibleItems&&s===t.length-1&&i("button",{class:"ota-visibility-toggle",onClick:this.toggleShowAll},this.showAll?D.entries.Lcz_ShowLess:D.entries.Lcz_ShowMore))))))}};we.style=xe;export{W as igl_book_property,J as igl_book_property_footer,tt as igl_booking_form,st as igl_booking_overview_page,nt as ir_booking_details,ht as ir_booking_extra_note,bt as ir_booking_header,gt as ir_dialog,kt as ir_events_log,wt as ir_extra_service,Bt as ir_extra_service_config,Rt as ir_extra_services,$t as ir_guest_info,Ht as ir_payment_actions,Ft as ir_payment_details,Qt as ir_pickup,ee as ir_pickup_view,oe as ir_pms_logs,re as ir_popover,de as ir_reservation_information,fe as ir_room,ke as ir_room_guests,we as ota_label};
//# sourceMappingURL=p-6f9dc2eb.entry.js.map