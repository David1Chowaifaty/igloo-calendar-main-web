import{r as t,c as i,h as e,H as s}from"./p-d239357b.js";import{P as n,p as a}from"./p-e9dcefff.js";import{R as o}from"./p-34b319c3.js";import{l as r}from"./p-4e493fea.js";import{T as l}from"./p-f8b7c0cd.js";import"./p-bf44a732.js";import"./p-c5894a47.js";import"./p-99cb260a.js";const c=".sc-ir-payment-option-h{display:block}.payment-table-container.sc-ir-payment-option{display:flex;align-items:center;justify-content:center}.po-view.sc-ir-payment-option{padding:0;margin:0}.payment-img.sc-ir-payment-option{height:18px;display:none}.loading-container.sc-ir-payment-option{background:white;display:flex;align-items:center;flex-direction:column;align-items:center;justify-content:center;width:100%;height:40rem}.payment-option-loader.sc-ir-payment-option{width:1.25rem;height:1.25rem;border:2.5px solid #3f3f3f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}.loading-container.default.sc-ir-payment-option{height:100vh;width:100%}@media (min-width: 768px){.po-view.sc-ir-payment-option{display:flex;align-items:center;justify-content:space-between;gap:0.5rem}.dataTable.sc-ir-payment-option{width:70%}.payment-img.sc-ir-payment-option{display:block}.actions-header.sc-ir-payment-option{width:max-content !important}.payment-table-container.sc-ir-payment-option{justify-content:flex-start}}@media (min-width: 1280px){.dataTable.sc-ir-payment-option{width:50%}}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}";const p=c;const h=class{constructor(e){t(this,e);this.toast=i(this,"toast",7)}propertyid;ticket;p;language="en";defaultStyles=true;hideLogs=true;paymentOptions=[];isLoading=false;selectedOption=null;toast;paymentOptionService=new n;roomService=new o;token=new l;propertyOptionsById;propertyOptionsByCode;componentWillLoad(){if(!!this.ticket){this.token.setToken(this.ticket);this.init()}}ticketChanged(t,i){if(t===i){return}this.token.setToken(this.ticket);this.init()}init(){this.initServices();this.fetchData()}handleCloseModal(t){t.stopPropagation();t.stopImmediatePropagation();this.closeModal(t.detail)}closeModal(t){if(t){this.modifyPaymentList(t);if(t.is_payment_gateway){this.propertyOptionsById.set(t.id,t)}else{this.propertyOptionsByCode.set(t.code,t)}}else{if(!this.propertyOptionsByCode.has(a.selectedOption?.code)&&!this.propertyOptionsById.has(a.selectedOption?.id)){this.modifyPaymentList({...a.selectedOption,is_active:false})}}a.selectedOption=null;a.mode=null}async fetchData(){try{if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}this.isLoading=true;let t=this.propertyid;if(!t){console.log("fetching property id");const i=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language});t=i.My_Result.id}const[i,e,s]=await Promise.all([this.paymentOptionService.GetExposedPaymentMethods(),this.paymentOptionService.GetPropertyPaymentMethods(t),this.roomService.fetchLanguage(this.language,["_PAYMENT_BACK"])]);r.entries=s.entries;r.direction=s.direction;this.propertyOptionsById=new Map(e?.map((t=>[t.id,t])));this.propertyOptionsByCode=new Map(e?.map((t=>[t.code,t])));this.paymentOptions=i?.map((t=>{if(t.is_payment_gateway){return this.propertyOptionsById.get(t.id)||t}return this.propertyOptionsByCode.get(t.code)||t}))}catch(t){console.error(t)}finally{this.isLoading=false}}initServices(){this.token.setToken(this.ticket)}modifyPaymentList(t){let i=[...this.paymentOptions];console.log(t);let e=i.findIndex((i=>i.code===t.code));if(e===-1){throw new Error("Invalid code")}i[e]={...t};this.paymentOptions=[...i]}async handleCheckChange(t,i){t.stopPropagation();t.stopImmediatePropagation();const e=t.detail;const s={...i,is_active:e,property_id:this.propertyid};if(i.code!=="005"&&!i.is_payment_gateway){await this.changePaymentMethod(s);this.modifyPaymentList(s);if(i.code==="000"&&e&&this.paymentOptions.filter((t=>t.code!=="000")).every((t=>t.is_active===false||t.is_active===null))){this.toast.emit({type:"success",description:"",title:r.entries["Lcz_YouNeedToSelect"],position:"top-right"})}return}if(!this.showEditButton(i)){this.modifyPaymentList(s);return}if(e&&i.data?.some((t=>t.value===null))){a.mode="create";a.selectedOption=s}else{await this.changePaymentMethod(s)}this.modifyPaymentList(s)}async changePaymentMethod(t){try{await this.paymentOptionService.HandlePaymentMethod(t);this.toast.emit({position:"top-right",title:"Saved Successfully",description:"",type:"success"})}catch(t){console.log(t)}}showEditButton(t){if(!t.is_payment_gateway&&t.code!=="005"){return false}return t.code==="005"||t.is_payment_gateway&&t.data?.length>0}render(){if(this.isLoading===true||this.paymentOptions&&this.paymentOptions.length===0){return e(s,{class:this.defaultStyles?"p-2":""},e("div",{class:`loading-container ${this.defaultStyles?"default":""}`},e("span",{class:"payment-option-loader"})))}return e(s,{class:this.defaultStyles?"p-2":""},e("ir-toast",null),e("ir-interceptor",null),e("div",{class:`${this.defaultStyles?"card ":""} p-1 flex-fill m-0`},e("div",{class:"d-flex align-items-center mb-2"},e("div",{class:"p-0 m-0 mr-1"},e("ir-icons",{name:"credit_card"})),e("h3",{class:"m-0 p-0"},r?.entries?.Lcz_PaymentOptions)),e("div",{class:"payment-table-container"},e("table",{class:"table table-striped table-bordered no-footer dataTable"},e("thead",null,e("tr",null,e("th",{scope:"col",class:"text-left"},r?.entries?.Lcz_PaymentMethod),e("th",{scope:"col"},r?.entries?.Lcz_Status),e("th",{scope:"col",class:"actions-header"},r?.entries?.Lcz_Action))),e("tbody",{class:""},this.paymentOptions?.map((t=>{if(t.code==="004"){return null}return e("tr",{key:t.id},e("td",{class:"text-left po-description"},e("div",{class:"po-view"},e("span",{class:"p-0 m-0"},t?.description))),e("td",null,e("ir-switch",{checked:t.is_active,onCheckChange:i=>this.handleCheckChange(i,t)})),e("td",{class:"payment-action"},this.showEditButton(t)&&e("ir-button",{title:r?.entries?.Lcz_Edit,variant:"icon",icon_name:"edit",onClickHandler:()=>{a.selectedOption=t;a.mode="edit"}})))})))))),e("ir-sidebar",{onIrSidebarToggle:()=>{this.closeModal(null)},side:"right",showCloseButton:false,open:a?.selectedOption!==null},a?.selectedOption&&e("ir-option-details",{propertyId:this.propertyid,slot:"sidebar-body"})))}static get watchers(){return{ticket:["ticketChanged"]}}};h.style=p;export{h as ir_payment_option};
//# sourceMappingURL=p-4d333a29.entry.js.map