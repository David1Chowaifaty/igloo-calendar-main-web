{"version":3,"names":["irPropertySwitcherDialogContentCss","IrPropertySwitcherDialogContentStyle0","IrPropertySwitcherDialogContent","open","selectedPropertyId","properties","propertySelected","linkedPropertyChange","filteredProperties","searchTerm","highlightedIndex","inputRef","resetOnOpenFrame","focusOnLoadFrame","handleOpenChange","isOpen","this","requestAnimationFrame","resetSearch","componentDidLoad","focusInput","disconnectedCallback","cancelAnimationFrame","handleSelectedPropertyIdChange","syncHighlightedIndex","fetchProperties","query","trim","data","axios","post","SEARCH_TERM","My_Result","error","console","length","selectedIndex","getSelectedIndex","ensureHighlightedVisible","list","findIndex","property","getPropertyId","Math","min","max","handleSearchChange","event","detail","handleKeyDown","key","preventDefault","selectProperty","options","el","querySelectorAll","option","scrollIntoView","block","inline","propertyId","emit","PROPERTY_ID","property_id","renderStatus","text","h","class","render","Host","autofocus","ref","placeholder","value","onKeyDown","withClear","tabIndex","style","padding","margin","paddingTop","map","label","name","onClick","selected","toString","index","COUNTRY_CODE","PROPERTY_NAME","A_NAME","current","__decorate","Debounce"],"sources":["src/components/pms-header/ir-property-switcher/ir-property-switcher-dialog-content.css?tag=ir-property-switcher-dialog-content&encapsulation=scoped","src/components/pms-header/ir-property-switcher/ir-property-switcher-dialog-content.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.property-switcher__search-input {\n  padding: 1rem;\n}\n.property-switcher__search-input::part(base) {\n  font-size: 16px;\n  height: 32px;\n}\n/* .property-switcher__results {\n  max-height: 250px;\n  min-height: 150px;\n  overflow-y: auto;\n  padding-bottom: 1rem;\n} */\n\n.property-switcher__status {\n  padding: 1rem;\n  font-size: 0.875rem;\n  color: var(--ir-color-text-muted, #646464);\n}\n\n@media (min-width: 640px) {\n  .property-switcher__results {\n    max-height: 250px;\n    min-height: 150px;\n    overflow-y: auto;\n    padding-bottom: 1rem;\n  }\n}\n","import { Component, Element, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { FetchedProperty, LinkedProperty } from '@/services/property.service';\nimport axios from 'axios';\nimport { Debounce } from '../../../decorators/debounce';\n\n/**\n * Internal component responsible for rendering the searchable list of properties inside the switcher dialog.\n * It owns the data fetching, filtering and keyboard navigation logic so the parent dialog stays lean.\n */\n@Component({\n  tag: 'ir-property-switcher-dialog-content',\n  styleUrl: 'ir-property-switcher-dialog-content.css',\n  scoped: true,\n})\nexport class IrPropertySwitcherDialogContent {\n  @Element() el: HTMLIrPropertySwitcherDialogContentElement;\n\n  /** Whether the surrounding dialog is open. Used to focus and reset the search input as needed. */\n  @Prop() open: boolean = false;\n\n  /** ID of the property that is currently selected in the parent component. */\n  @Prop() selectedPropertyId?: number;\n\n  /** Linked properties provided by the parent switcher. */\n  @Prop() properties: LinkedProperty[] = [];\n\n  /** Emits whenever the user picks a property from the list. */\n  @Event({ bubbles: true, composed: true }) propertySelected: EventEmitter<FetchedProperty['PROPERTY_ID']>;\n  @Event({ bubbles: true, composed: true })\n  linkedPropertyChange: EventEmitter<LinkedProperty>;\n\n  @State() private filteredProperties: FetchedProperty[] = [];\n  @State() private searchTerm: string = '';\n  @State() private highlightedIndex: number = -1;\n\n  private inputRef?: HTMLIrInputElement;\n  private resetOnOpenFrame: number;\n  private focusOnLoadFrame: number;\n\n  @Watch('open')\n  handleOpenChange(isOpen: boolean) {\n    if (!isOpen) {\n      return;\n    }\n    this.resetOnOpenFrame = requestAnimationFrame(() => {\n      // this.inputRef?.focusInput();\n      this.resetSearch();\n    });\n  }\n\n  componentDidLoad() {\n    this.focusOnLoadFrame = requestAnimationFrame(() => {\n      this.inputRef?.focusInput();\n    });\n  }\n\n  disconnectedCallback() {\n    if (this.resetOnOpenFrame) cancelAnimationFrame(this.resetOnOpenFrame);\n    if (this.focusOnLoadFrame) cancelAnimationFrame(this.focusOnLoadFrame);\n  }\n\n  @Watch('selectedPropertyId')\n  handleSelectedPropertyIdChange() {\n    this.syncHighlightedIndex();\n  }\n\n  private resetSearch() {\n    this.searchTerm = '';\n    this.filteredProperties = [];\n    this.highlightedIndex = -1;\n  }\n\n  @Debounce(300)\n  private async fetchProperties(searchTerm: string) {\n    const query = searchTerm.trim();\n    if (!query) {\n      this.filteredProperties = [];\n      this.highlightedIndex = -1;\n      return;\n    }\n\n    try {\n      const { data } = await axios.post('/Fetch_Properties', { SEARCH_TERM: query });\n      const properties = data.My_Result;\n      this.filteredProperties = properties;\n    } catch (error) {\n      console.error('Failed to fetch properties', error);\n      this.filteredProperties = [];\n    }\n\n    if (!this.filteredProperties.length) {\n      this.highlightedIndex = -1;\n      return;\n    }\n\n    const selectedIndex = this.getSelectedIndex(this.filteredProperties);\n    this.highlightedIndex = selectedIndex >= 0 ? selectedIndex : 0;\n    requestAnimationFrame(() => this.ensureHighlightedVisible());\n  }\n\n  private getSelectedIndex(list: FetchedProperty[]) {\n    if (!this.selectedPropertyId) {\n      return -1;\n    }\n    return list.findIndex(property => this.getPropertyId(property) === this.selectedPropertyId);\n  }\n\n  private syncHighlightedIndex() {\n    if (!this.filteredProperties.length) {\n      this.highlightedIndex = -1;\n      return;\n    }\n    const selectedIndex = this.getSelectedIndex(this.filteredProperties);\n    if (selectedIndex >= 0) {\n      this.highlightedIndex = selectedIndex;\n      return;\n    }\n    this.highlightedIndex = Math.min(Math.max(this.highlightedIndex, 0), this.filteredProperties.length - 1);\n  }\n\n  private handleSearchChange = (event: CustomEvent<string>) => {\n    this.searchTerm = event.detail ?? '';\n    this.fetchProperties(this.searchTerm);\n  };\n\n  private handleKeyDown = (event: KeyboardEvent) => {\n    if (!this.filteredProperties.length) {\n      return;\n    }\n\n    switch (event.key) {\n      case 'ArrowDown':\n        event.preventDefault();\n        this.highlightedIndex = Math.min(this.filteredProperties.length - 1, this.highlightedIndex + 1);\n        this.ensureHighlightedVisible();\n        break;\n      case 'ArrowUp':\n        event.preventDefault();\n        this.highlightedIndex = Math.max(0, this.highlightedIndex - 1);\n        this.ensureHighlightedVisible();\n        break;\n      case 'Enter':\n        event.preventDefault();\n        this.selectProperty(this.filteredProperties[this.highlightedIndex]);\n        break;\n    }\n  };\n\n  private ensureHighlightedVisible() {\n    if (this.highlightedIndex < 0) {\n      return;\n    }\n    const options = this.el.querySelectorAll('wa-option');\n    const option = options?.[this.highlightedIndex];\n    option?.scrollIntoView({ block: 'nearest', inline: 'nearest' });\n  }\n\n  private selectProperty(property?: FetchedProperty | LinkedProperty) {\n    if (!property) {\n      return;\n    }\n    const propertyId = this.getPropertyId(property);\n    if (typeof propertyId !== 'number') {\n      return;\n    }\n    this.propertySelected.emit(propertyId);\n  }\n\n  private getPropertyId(property: FetchedProperty | LinkedProperty) {\n    return 'PROPERTY_ID' in property ? property.PROPERTY_ID : property.property_id;\n  }\n\n  private renderStatus(text: string) {\n    return <div class=\"property-switcher__status\">{text}</div>;\n  }\n\n  render() {\n    return (\n      <Host>\n        <ir-input\n          autofocus\n          ref={el => (this.inputRef = el)}\n          placeholder=\"Enter name or A number\"\n          class=\"property-switcher__search-input\"\n          value={this.searchTerm}\n          onText-change={this.handleSearchChange}\n          onKeyDown={this.handleKeyDown}\n          withClear\n        ></ir-input>\n        <div tabIndex={-1} class=\"property-switcher__results\">\n          {!this.searchTerm && this.properties?.length > 0 && (\n            <div>\n              <p style={{ padding: '1rem', margin: '0', paddingTop: '0' }}>Linked Properties</p>\n              {this.properties.map(property => {\n                const label = `${property.name}`;\n                return (\n                  <wa-option\n                    onClick={() => {\n                      // this.selectProperty(property as any);\n                      this.linkedPropertyChange.emit(property);\n                    }}\n                    selected={this.selectedPropertyId === property.property_id}\n                    value={property.property_id?.toString()}\n                    label={label}\n                  >\n                    {label}\n                  </wa-option>\n                );\n              })}\n            </div>\n          )}\n          {this.searchTerm && this.filteredProperties.length === 0 && this.renderStatus('No properties found')}\n          {this.filteredProperties.map((property, index) => {\n            const label = `${property.COUNTRY_CODE}: ${property.PROPERTY_NAME} - ${property.A_NAME}`;\n            return (\n              <wa-option\n                onClick={() => this.selectProperty(property)}\n                selected={this.selectedPropertyId === property.PROPERTY_ID}\n                current={this.highlightedIndex === index}\n                value={property.PROPERTY_ID?.toString()}\n                label={label}\n              >\n                {label}\n              </wa-option>\n            );\n          })}\n        </div>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}