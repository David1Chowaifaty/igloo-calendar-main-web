import{r as i,h as t,H as s,g as e}from"./p-c3b5e9c5.js";import{B as o,u as n,b as l,o as a}from"./p-41ee8d7b.js";import{R as r}from"./p-a6de11cc.js";import{l as c}from"./p-c8c28d39.js";import{q as d,f as h}from"./p-2d9a41e4.js";import{h as g}from"./p-6c4ba7c0.js";import{a as u}from"./p-84f11abc.js";import{T as m}from"./p-f809ad08.js";import{i as p}from"./p-57fee81d.js";import"./p-00204f5a.js";import"./p-d90a6658.js";import"./p-a26400c5.js";const b=".sc-ir-booking-listing-h{display:block;height:100%}.logo.sc-ir-booking-listing{height:2rem;width:2rem}.card.sc-ir-booking-listing{overflow-x:auto}.secondary-p.sc-ir-booking-listing{font-size:12px !important}.room-service.sc-ir-booking-listing{display:flex;align-items:center;justify-content:space-between;gap:0.5rem;width:100%;padding:0.25rem 0}.room-name-container.sc-ir-booking-listing{background:#acecff;padding:0.1rem 0.3rem;border-radius:5px}.h-screen.sc-ir-booking-listing{height:100%}.price-span.sc-ir-booking-listing{margin:0;margin-right:5px}.main-container.sc-ir-booking-listing{height:100%;overflow-y:auto}.badge.ct_ir_badge.sc-ir-booking-listing{padding:0.2rem 0.3rem}.yellow_dot.sc-ir-booking-listing{height:0.5rem;width:0.5rem;height:0.5rem;width:0.8rem;border-radius:50%;background:rgb(244, 213, 82);margin-left:0.5rem;display:inline-flex;padding:0;margin:0}.booking_name.sc-ir-booking-listing{display:flex;align-items:center;gap:0.4rem}.bg-ir-red.sc-ir-booking-listing{background:#ff4961;padding:0.2rem 0.3rem}.due-btn.sc-ir-booking-listing{border:1px solid #ff4961;color:#ff4961;cursor:pointer;padding:1px 0.25rem !important;font-size:12px !important}.due-btn.sc-ir-booking-listing:hover{background:#ff4961;color:white}.booking_number.sc-ir-booking-listing{all:unset;cursor:pointer}.booking_number.sc-ir-booking-listing:hover{color:#1e9ff2}.in-out.sc-ir-booking-listing{width:150px !important}.booking_guest_name.sc-ir-booking-listing{width:fit-content;padding:0 !important;margin:0}.booking_guest_name.sc-ir-booking-listing .button-text.sc-ir-booking-listing{padding:0 !important}.buttons-container.sc-ir-booking-listing{gap:10px}td.sc-ir-booking-listing ul.sc-ir-booking-listing{width:max-content !important}td.sc-ir-booking-listing{width:max-content !important}.date-p.sc-ir-booking-listing{width:max-content !important;min-width:100%;text-align:center !important}.booking-label-gap.sc-ir-booking-listing{gap:5px}@media (min-width: 1024px){.yellow_dot.sc-ir-booking-listing{height:0.5rem;width:0.5rem}}";const v=b;const f=class{constructor(t){i(this,t);this.bookingListingService=new o;this.roomService=new r;this.token=new m;this.statusColors={"001":"badge-warning","002":"badge-success","003":"badge-danger","004":"badge-danger"};this.language="";this.ticket="";this.propertyid=undefined;this.rowCount=10;this.p=undefined;this.isLoading=false;this.currentPage=1;this.totalPages=1;this.oldStartValue=0;this.editBookingItem=null;this.showCost=false}componentWillLoad(){n("end_row",this.rowCount);l.rowCount=this.rowCount;if(this.ticket!==""){l.token=this.ticket;this.token.setToken(this.ticket);this.initializeApp()}a("userSelection",(async i=>{const t=i.total_count;this.totalPages=Math.ceil(t/this.rowCount)}));a("bookings",(async i=>{this.showCost=i.some((i=>i.financial.gross_cost!==null&&i.financial.gross_cost>0))}))}ticketChanged(i,t){if(i===t){return}this.token.setToken(this.ticket);l.token=this.ticket;this.initializeApp()}async initializeApp(){try{this.isLoading=true;if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}let i=this.propertyid;if(!i){const t=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true});i=t.My_Result.id}const t=[this.bookingListingService.getExposedBookingsCriteria(i),this.roomService.fetchLanguage(this.language,["_BOOKING_LIST_FRONT"])];if(this.propertyid){t.unshift(this.roomService.getExposedProperty({id:this.propertyid,language:this.language,is_backend:true}))}await Promise.all(t);n("property_id",i);await this.bookingListingService.getExposedBookings(Object.assign(Object.assign({},l.userSelection),{is_to_export:false}))}catch(i){console.error(i)}finally{this.isLoading=false}}handleSideBarToggle(i){if(i.detail){this.editBookingItem=null}}getPaginationBounds(){const i=l.userSelection.total_count;const t=(this.currentPage-1)*this.rowCount;let s=this.currentPage*this.rowCount;s=s>i?i:s;return{startItem:t,endItem:s,totalCount:i}}openModal(){this.listingModalTimeout=setTimeout((()=>{this.listingModal=this.el.querySelector("ir-listing-modal");this.listingModal.editBooking=this.editBookingItem;this.listingModal.openModal()}),100)}disconnectedCallback(){clearTimeout(this.listingModalTimeout)}async handleResetData(i){i.stopImmediatePropagation();i.stopPropagation();await this.bookingListingService.getExposedBookings(Object.assign(Object.assign({},l.userSelection),{is_to_export:false}))}async handleResetStoreData(i){i.stopImmediatePropagation();i.stopPropagation();await this.bookingListingService.getExposedBookings(Object.assign(Object.assign({},l.userSelection),{is_to_export:false}))}handleBookingChanged(i){i.stopImmediatePropagation();i.stopPropagation();l.bookings=[...l.bookings.map((t=>{if(t.booking_nbr===i.detail.booking_nbr){return i.detail}return t}))]}renderItemRange(){const{endItem:i,startItem:t,totalCount:s}=this.getPaginationBounds();return`${c.entries.Lcz_View} ${t+1} - ${i} ${c.entries.Lcz_Of} ${s}`}async updateData(){const{endItem:i,startItem:t}=this.getPaginationBounds();await this.bookingListingService.getExposedBookings(Object.assign(Object.assign({},l.userSelection),{is_to_export:false,start_row:t,end_row:i}))}render(){var i,e,o,n,a,r,m,b,v,f,k,w,y,_,x,C,j,Y,M,D;if(this.isLoading||this.ticket===""){return t("ir-loading-screen",null)}return t(s,null,t("ir-interceptor",null),t("ir-toast",null),t("div",{class:"p-1 main-container"},t("ir-listing-header",{propertyId:this.propertyid,p:this.p,language:this.language}),t("section",null,t("div",{class:"card p-1 flex-fill m-0 mt-2"},t("table",{class:"table table-striped table-bordered no-footer dataTable"},t("thead",null,t("tr",null,t("th",{scope:"col",class:"text-left"},(i=c.entries)===null||i===void 0?void 0:i.Lcz_Booking,"#"),t("th",{scope:"col"},(e=c.entries)===null||e===void 0?void 0:e.Lcz_BookedOn),t("th",{scope:"col"},(o=c.entries)===null||o===void 0?void 0:o.Lcz_GuestSource),t("th",{scope:"col",class:"text-left services-cell"},(n=c.entries)===null||n===void 0?void 0:n.Lcz_Services),t("th",{scope:"col",class:"in-out"},(a=c.entries)===null||a===void 0?void 0:a.Lcz_Dates),t("th",{scope:"col"},t("span",{class:"price-span"},(r=c.entries)===null||r===void 0?void 0:r.Lcz_Amount),t("ir-tooltip",{customSlot:true,message:`<span style="width:100%;display:block;">${(m=c.entries)===null||m===void 0?void 0:m.Lcz_BookingBalance}</span><span>${(b=c.entries)===null||b===void 0?void 0:b.Lcz_ClickToSettle}</span>`},t("span",{slot:"tooltip-trigger",class:"m-0 btn due-btn"},(v=c.entries)===null||v===void 0?void 0:v.Lcz_Balance))),this.showCost&&t("th",{scope:"col",class:"services-cell"},(f=c.entries)===null||f===void 0?void 0:f.Lcz_Cost),t("th",{scope:"col"},(k=c.entries)===null||k===void 0?void 0:k.Lcz_Status),t("th",{scope:"col"},t("p",{class:"sr-only"},"actions")))),t("tbody",{class:""},l.bookings.length===0&&t("tr",null,t("td",{colSpan:8},(w=c.entries)===null||w===void 0?void 0:w.Lcz_NoDataAvailable)),(y=l.bookings)===null||y===void 0?void 0:y.map((i=>{var s,e,o;let n=this.statusColors[i.status.code];return t("tr",{key:i.booking_nbr},t("td",{class:"text-left"},t("ir-button",{btn_color:"link",btnStyle:{padding:"0",margin:"0"},onClickHandler:()=>this.editBookingItem={booking:i,cause:"edit"},text:i.booking_nbr}),i.channel_booking_nbr&&t("p",{class:"p-0 m-0 text-center secondary-p"},i.channel_booking_nbr)),t("td",null,t("p",{class:"p-0 m-0 date-p"},g(i.booked_on.date,"YYYY-MM-DD").format("DD-MMM-YYYY")),t("p",{class:"p-0 m-0 secondary-p"},u(i.booked_on.hour.toString(),i.booked_on.minute.toString()))),t("td",null,t("div",{class:"h-100 d-flex align-items-center ",style:{width:"max-content"}},t("img",{class:"mr-2 logo",src:i.origin.Icon,alt:i.origin.Label}),t("div",{class:"text-left"},t("div",{class:"d-flex align-items-center"},t("div",{class:"booking_name m-0 p-0"},t("ir-button",{btn_color:"link",onClickHandler:()=>this.editBookingItem={booking:i,cause:"guest"},text:`${i.guest.first_name} ${(s=i.guest.last_name)!==null&&s!==void 0?s:""}`,btnStyle:{width:"fit-content",padding:"0",margin:"0"},labelStyle:{padding:"0"}}),i.guest.nbr_confirmed_bookings>1&&!i.agent&&t("div",{class:"m-0 p-0"},t("ir-tooltip",{message:`${c.entries.Lcz_BookingsNbr}`.replace("%1",i.guest.nbr_confirmed_bookings.toString()),customSlot:true},t("div",{class:"d-flex align-items-center my-0 p-0",slot:"tooltip-trigger"},t("ir-icons",{style:{"--icon-size":"0.875rem"},color:"#FB0AAD",name:"heart-fill"})))),t("span",{class:"p-0 m-0"},i.occupancy.adult_nbr,c.entries.Lcz_P),d(i.extras)&&t("span",{class:"yellow_dot"}))),t("div",{class:"d-flex align-items-center booking-label-gap"},t("p",{class:"p-0 m-0 secondary-p"},i.origin.Label),i.is_in_loyalty_mode&&!i.promo_key&&t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},t("title",null,c.entries.Lcz_LoyaltyDiscountApplied),t("path",{fill:"#fc6c85",d:"M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"})),i.promo_key&&t("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",height:18,width:18},t("title",null,c.entries.Lcz_Coupon+":"+i.promo_key),t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z"})))))),t("td",null,t("ul",null,i.rooms.map((i=>{var s,e,o,n,l,a,r;return t("li",null,t("div",{class:"room-service"},t("p",{class:"m-0 p-0"},i.roomtype.name),i.unit&&!p(i.roomtype.id)&&(((e=(s=i.unit)===null||s===void 0?void 0:s.name)===null||e===void 0?void 0:e.length)>4?t("ir-tooltip",{customSlot:true,message:(o=i.unit)===null||o===void 0?void 0:o.name},t("p",{class:"room-name-container cursor-pointer m-0",slot:"tooltip-trigger"},(l=(n=i.unit)===null||n===void 0?void 0:n.name)===null||l===void 0?void 0:l.substring(0,4))):t("p",{class:"room-name-container  m-0"},(r=(a=i.unit)===null||a===void 0?void 0:a.name)===null||r===void 0?void 0:r.substring(0,4)))))})),i.extra_services&&t("li",null,c.entries.Lcz_ExtraServices))),t("td",null,t("p",{class:"p-0 m-0 date-p"},g(i.from_date,"YYYY-MM-DD").format("DD-MMM-YYYY")),t("p",{class:"p-0 m-0 date-p"},g(i.to_date,"YYYY-MM-DD").format("DD-MMM-YYYY"))),t("td",null,t("p",{class:"p-0 m-0"},h(i.currency.symbol,(o=(e=i.financial)===null||e===void 0?void 0:e.gross_total)!==null&&o!==void 0?o:0)),i.financial.due_amount>0&&t("buuton",{onClick:()=>{this.editBookingItem={booking:i,cause:"payment"};this.openModal()},class:"btn p-0 m-0 due-btn"},h(i.currency.symbol,i.financial.due_amount))),this.showCost&&t("td",null,i.financial.gross_cost!==null&&i.financial.gross_cost===0?"_":h(i.currency.symbol,i.financial.gross_cost)),t("td",null,t("p",{class:`m-0 badge ${n} ct_ir_badge`},i.status.description)),t("td",null,t("div",{class:"d-flex justify-content-center align-items-center",style:{gap:"8px"}},t("ir-button",{title:"Edit booking",variant:"icon",icon_name:"edit",onClickHandler:()=>this.editBookingItem={booking:i,cause:"edit"}}),t("ir-button",{title:"Delete booking",style:{"--icon-button-color":"#ff4961","--icon-button-hover-color":"#FF1635"},variant:"icon",icon_name:"trash",onClickHandler:()=>{this.editBookingItem={booking:i,cause:"delete"};this.openModal()}}))))})))),this.totalPages>1&&t("section",{class:"d-flex flex-column flex-md-row align-items-center justify-content-between pagination-container"},t("p",{class:"m-0 mb-1 mb-md-0"},this.renderItemRange()),t("div",{class:"d-flex align-items-center buttons-container"},t("ir-button",{size:"sm",btn_disabled:this.currentPage===1,onClickHandler:async()=>{this.currentPage=1;await this.updateData()},icon_name:"angles_left",style:{"--icon-size":"0.875rem"}}),t("ir-button",{size:"sm",btn_disabled:this.currentPage===1,onClickHandler:async()=>{this.currentPage=this.currentPage-1;await this.updateData()},icon_name:"angle_left",style:{"--icon-size":"0.875rem"}}),t("ir-select",{selectedValue:this.currentPage.toString(),LabelAvailable:false,showFirstOption:false,onSelectChange:async i=>{this.currentPage=+i.detail;await this.updateData()},data:Array.from(Array(this.totalPages),((i,t)=>t+1)).map((i=>({text:i.toString(),value:i.toString()})))}),t("ir-button",{size:"sm",btn_disabled:this.currentPage===this.totalPages,onClickHandler:async()=>{this.currentPage=this.currentPage+1;await this.updateData()},icon_name:"angle_right",style:{"--icon-size":"0.875rem"}}),t("ir-button",{size:"sm",btn_disabled:this.currentPage===this.totalPages,onClickHandler:async()=>{this.currentPage=this.totalPages;console.log(this.currentPage);await this.updateData()},icon_name:"angles_right",style:{"--icon-size":"0.875rem"}})))))),this.editBookingItem&&t("ir-listing-modal",{onModalClosed:()=>this.editBookingItem=null}),t("ir-sidebar",{onIrSidebarToggle:this.handleSideBarToggle.bind(this),open:this.editBookingItem!==null&&["edit","guest"].includes(this.editBookingItem.cause),showCloseButton:false,sidebarStyles:((_=this.editBookingItem)===null||_===void 0?void 0:_.cause)==="guest"?{background:"white"}:{width:this.editBookingItem?"80rem":"var(--sidebar-width,40rem)",background:"#F2F3F8"}},((x=this.editBookingItem)===null||x===void 0?void 0:x.cause)==="edit"&&t("ir-booking-details",{slot:"sidebar-body",p:this.p,hasPrint:true,hasReceipt:true,is_from_front_desk:true,propertyid:this.propertyid,hasRoomEdit:true,hasRoomDelete:true,hasCloseButton:true,onCloseSidebar:()=>this.editBookingItem=null,bookingNumber:this.editBookingItem.booking.booking_nbr,ticket:this.ticket,language:this.language,hasRoomAdd:true}),((C=this.editBookingItem)===null||C===void 0?void 0:C.cause)==="guest"&&t("ir-guest-info",{slot:"sidebar-body",isInSideBar:true,headerShown:true,booking_nbr:(Y=(j=this.editBookingItem)===null||j===void 0?void 0:j.booking)===null||Y===void 0?void 0:Y.booking_nbr,email:(D=(M=this.editBookingItem)===null||M===void 0?void 0:M.booking)===null||D===void 0?void 0:D.guest.email,language:this.language,onCloseSideBar:()=>this.editBookingItem=null})))}get el(){return e(this)}static get watchers(){return{ticket:["ticketChanged"]}}};f.style=v;export{f as ir_booking_listing};
//# sourceMappingURL=p-de882136.entry.js.map