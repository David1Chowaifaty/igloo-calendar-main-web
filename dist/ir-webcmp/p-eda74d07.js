import{h as n}from"./p-6c4ba7c0.js";import{z as t}from"./p-7fc0c3ea.js";import{f as e,d as o}from"./p-52112b10.js";import{a as s}from"./p-bf44a732.js";import{l as a}from"./p-e19fbf2a.js";import{c as r}from"./p-7482373c.js";const i={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const c={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function u(n,t){if(n===null&&t===null)return"";if(t!==null&&t!==""){return`${n!==null&&n!==void 0?n:""} , ${t!==null&&t!==void 0?t:""}`}return n}async function d(){try{const{data:n}=await s.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return n.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}catch(n){console.log(n)}}function D(t,e,o){const s=new Date(t);s.setHours(e);s.setMinutes(o);return`${a.entries.Lcz_BlockedTill} ${n(s).format("MMM DD, HH:mm")}`}function _(t){var e,o,s,a;const{in_out:i,status_code:u,from_date:d,to_date:D}=t;if(r.checkin_enabled){if((i===null||i===void 0?void 0:i.code)==="001"){return c["000"]}else if((i===null||i===void 0?void 0:i.code)==="002"){if(!r.is_automatic_check_in_out){const t=n();const s=n(D,"YYYY-MM-DD");const a=n(d,"YYYY-MM-DD");const i=O(t.toDate(),N((e=r.checkin_checkout_hours)===null||e===void 0?void 0:e.offset,(o=r.checkin_checkout_hours)===null||o===void 0?void 0:o.hour));if(t.isSame(s,"days")&&t.isAfter(a,"days")&&i||t.isAfter(s,"days")){return c["003"]}else{return c["002"]}}}return c[u||"001"]}else{const t=n();const e=n(D,"YYYY-MM-DD");const o=n(d,"YYYY-MM-DD");const i=O(t.toDate(),N((s=r.checkin_checkout_hours)===null||s===void 0?void 0:s.offset,(a=r.checkin_checkout_hours)===null||a===void 0?void 0:a.hour));if(o.isSame(t,"day")&&i){return c["000"]}else if(t.isAfter(o,"day")&&t.isBefore(e,"day")){return c["000"]}else if(e.isSame(t,"day")&&i){return c["000"]}else if(e.isSame(t,"day")&&i||e.isBefore(t,"day")){return c["003"]}else{return c[u||"001"]}}}function l(n){var t;if(!n){return null}return((t=n.find((n=>n.key==="private_note")))===null||t===void 0?void 0:t.value)||null}function E(t){let s=[];const a=t.rooms.filter((n=>!!n["assigned_units_pool"]));a.forEach((a=>{var r,i,c,d,D,E;const T=n(a.from_date,"YYYY-MM-DD").isAfter(n(e.fromDate,"YYYY-MM-DD"))?a.from_date:e.fromDate;const Y=a.to_date;if(n(a.to_date,"YYYY-MM-DD").isBefore(n(e.fromDate,"YYYY-MM-DD"))){return}const O=(r=a.sharing_persons)===null||r===void 0?void 0:r.find((n=>n.is_main));s.push({CHECKIN:false,CHECKOUT:false,ID:a["assigned_units_pool"],TO_DATE:Y,FROM_DATE:T,PRIVATE_NOTE:l(t.extras),NO_OF_DAYS:o(T,Y),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(i=t.financial)===null||i===void 0?void 0:i.due_amount,STATUS:_({in_out:a.in_out,from_date:a.from_date,to_date:a.to_date,status_code:(c=t.status)===null||c===void 0?void 0:c.code}),NAME:u(O===null||O===void 0?void 0:O.first_name,O.last_name),PHONE:(d=t.guest.mobile_without_prefix)!==null&&d!==void 0?d:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:a.total,RATE_PLAN:a.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:a.rateplan.id,IDENTIFIER:a.identifier,RATE_TYPE:a.roomtype.id,ADULTS_COUNT:a.occupancy.adult_nbr,CHILDREN_COUNT:a.occupancy.children_nbr,PR_ID:+a.unit.id,POOL:a["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:a.rateplan.cancelation,guarantee:a.rateplan.guarantee,TOTAL_PRICE:(D=t.financial)===null||D===void 0?void 0:D.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:a.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:a.from_date,to_date:a.to_date},ROOM_INFO:{occupancy:a.occupancy,sharing_persons:a.sharing_persons,unit:a.unit,in_out:a.in_out},BASE_STATUS_CODE:(E=t.status)===null||E===void 0?void 0:E.code})}));return s}async function T(n){const t=await d();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""?n.NOTES:n.STAY_STATUS_CODE==="003"?D(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):t.find((t=>t.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:Y(n.from_date,n.to_date),STATUS:i[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date,defaultDates:{from_date:n.from_date,to_date:n.to_date}}}function Y(t,e){const o=n(t,"YYYY-MM-DD").startOf("day");const s=n(e,"YYYY-MM-DD").endOf("day");const a=s.diff(o,"days");return a||1}function O(n,t){return n.getHours()>=t.getHours()&&n.getMinutes()>=t.getMinutes()}function N(n,t){const e=new Date;const o=n*60*60*1e3;const s=new Date(e.getTime()+o);const a=s.getUTCFullYear();const r=s.getUTCMonth();const i=s.getUTCDate();const c=t-n;return new Date(Date.UTC(a,r,i,c))}function f(n){const t=n.getFullYear();const e=(n.getMonth()+1).toString().padStart(2,"0");const o=n.getDate().toString().padStart(2,"0");return`${t}-${e}-${o}`}function M(n){let t={};const e={"IN-HOUSE":{id:1,clsName:"IN_HOUSE"},CONFIRMED:{id:2,clsName:"CONFIRMED"},"PENDING-CONFIRMATION":{id:3,clsName:"PENDING_CONFIRMATION"},"SPLIT-UNIT":{id:4,clsName:"SPLIT_UNIT"},"CHECKED-IN":{id:5,clsName:"CHECKED_IN"},"CHECKED-OUT":{id:5,clsName:"CHECKED_OUT"},BLOCKED:{id:6,clsName:"BLOCKED"},"BLOCKED-WITH-DATES":{id:7,clsName:"BLOCKED_WITH_DATES"},NOTES:{id:8,clsName:"NOTES"},"OUTSTANDING-BALANCE":{id:9,clsName:"OUTSTANDING_BALANCE"},"TEMP-EVENT":{id:10,clsName:"PENDING_CONFIRMATION"}};n.forEach((n=>{t[n.id]=n;t.statusId=e}));return t}function A(n){return["003","002","004"].includes(n)}const I=(n,t)=>t.find((t=>t.id===n));function S(n){const t=new Date;const e=n;t.setHours(t.getHours()+e,t.getMinutes(),0,0);return{BLOCKED_TILL_DATE:f(t),BLOCKED_TILL_HOUR:t.getHours().toString(),BLOCKED_TILL_MINUTE:t.getMinutes().toString()}}function R(t,e){const o=n(t,"D_M_YYYY");o.add(e,"days");return o.format("YYYY-MM-DD")}function v(t){const e=n(t,"D_M_YYYY");return e.format("YYYY-MM-DD")}function C(t){return n(t).add(2,"months").format("YYYY-MM-DD")}function m(t,e="DD MMM YYYY"){const o=n(t,e).format("ddd, DD MMM YYYY");return o}function L(t){return n(t).add(1,"days").format("YYYY-MM-DD")}function y(t){return n(t,"YYYY-MM-DD").format("DD/MM ddd")}function U(t,e){let o=[];let s=n.min(n(t).add(1,"days"),n(e));let a=n.max(n(t),n(e));while(s<a){o.push(s.format("YYYY-MM-DD"));s=s.clone().add(1,"days")}return o}function B(n){return n<10?n.toString().padStart(2,"0"):n.toString()}function p(n){if(n===""){return true}const e=t.string().email().safeParse(n);return!e.success}function H(n,t){return n+" "+t.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}const P=[{key:"private_note",value:""},{key:"is_backend",value:true},{key:"ERROR_EMAIL",value:""},{key:"agent_payment_mode",value:""},{key:"payment_code",value:""}];function F(n,t="add"){const e=JSON.parse(sessionStorage.getItem("backend_anchor"));if(e){if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify(Object.assign(Object.assign({},e),n)))}else if(t==="remove"){const t=Object.keys(n);t.forEach((n=>{if(n in e){delete e[n]}}));return sessionStorage.setItem("backend_anchor",JSON.stringify(e))}}else{if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify(Object.assign({},n)))}}}function K(){const n=JSON.parse(sessionStorage.getItem("backend_anchor"));if(n){return n.login||null}return null}function b({from_date:t,to_date:e,isCheckedIn:o}){var s,a;if(!r.checkin_enabled||r.is_automatic_check_in_out){return false}if(o){return false}const i=n();if(n().isSameOrAfter(new Date(t),"days")&&n().isBefore(new Date(e),"days")||n().isSame(new Date(e),"days")&&!O(i.toDate(),N((s=r.checkin_checkout_hours)===null||s===void 0?void 0:s.offset,(a=r.checkin_checkout_hours)===null||a===void 0?void 0:a.hour))){return true}return false}export{O as A,N as B,l as a,u as b,Y as c,f as d,P as e,H as f,S as g,M as h,_ as i,T as j,c as k,A as l,L as m,C as n,v as o,R as p,K as q,B as r,F as s,E as t,U as u,p as v,y as w,m as x,I as y,b as z};
//# sourceMappingURL=p-eda74d07.js.map