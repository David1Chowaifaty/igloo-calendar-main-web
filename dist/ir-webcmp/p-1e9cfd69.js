import{h as n}from"./p-6c4ba7c0.js";import{z as t}from"./p-b859bcd5.js";import{c as o}from"./p-00df8713.js";import{a as e}from"./p-bf44a732.js";import{l as i}from"./p-71768c2d.js";import{c as a}from"./p-a973aec7.js";const s={days:[],months:[],fromDate:"",toDate:"",disabled_cells:new Map,cleaningTasks:new Map};const{state:r,onChange:c}=a(s);function d(n){var t;const o=new Map;for(const e of n){const n=new Map((t=o.get(e.unit.id))!==null&&t!==void 0?t:new Map);n.set(e.date,e);o.set(e.unit.id,n)}r.cleaningTasks=new Map(o)}function u({unitId:n,date:t}){const o=new Map(r.cleaningTasks);if(!o.has(n)){return}const e=new Map(o.get(n));e.delete(t);o.set(n,e);r.cleaningTasks=new Map(o)}function l({unitId:n,date:t,task:o}){var e;const i=new Map(r.cleaningTasks);const a=new Map((e=i.get(n))!==null&&e!==void 0?e:new Map);a.set(t,o!==null&&o!==void 0?o:t);i.set(n,a);r.cleaningTasks=new Map(i)}async function _(n){const t=[];const o=await f();for(const e of n){for(const n of e.days){for(const e of n.room_types){E(e.physicalrooms,t,o)}}}return t}function E(n,t,o){for(const e of n){for(const n in e.calendar_cell){if(e.calendar_cell[n].Is_Available===false){A(e.calendar_cell[n],t,o)}}}}const D={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const T={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function O(n,t){if(n===null&&t===null||!n)return"";if(!!t){return`${n!==null&&n!==void 0?n:""} ${t!==null&&t!==void 0?t:""}`}return n}async function f(){try{const{data:n}=await e.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return n.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}catch(n){console.log(n)}}function Y(t,o,e){const a=new Date(t);a.setHours(o);a.setMinutes(e);return`${i.entries.Lcz_BlockedTill} ${n(a).format("MMM DD, HH:mm")}`}function N(t,o){var e,i,a,s,r,c,d,u,l,_,E,f,N;if(P(t.STAY_STATUS_CODE)){const e=n(t.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.from_date:t.DATE;const i=n(t.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.to_date:t.DATE;return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.My_Block_Info.NOTES!==""&&t.My_Block_Info.NOTES!==null?t.My_Block_Info.NOTES:t.STAY_STATUS_CODE==="003"?Y(t.My_Block_Info.BLOCKED_TILL_DATE,t.My_Block_Info.BLOCKED_TILL_HOUR,t.My_Block_Info.BLOCKED_TILL_MINUTE):o.find((n=>n.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.My_Block_Info.DESCRIPTION,PR_ID:t.My_Block_Info.pr_id,ENTRY_DATE:t.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:t.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.My_Block_Info.NOTES,FROM_DATE:e,TO_DATE:i,NO_OF_DAYS:U(e,i),STATUS:D[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.My_Block_Info.format.from_date,TO_DATE_STR:t.My_Block_Info.format.to_date,defaultDates:{from_date:t.My_Block_Info.from_date,to_date:t.My_Block_Info.to_date}}}if(t.booking.booking_nbr.toString()==="00553011358"){console.log(t)}const M=n(t.room.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.from_date:t.DATE;const A=n(t.room.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.to_date:t.DATE;const v=(e=t.room.sharing_persons)===null||e===void 0?void 0:e.find((n=>n.is_main));return{ID:t.POOL,FROM_DATE:M,TO_DATE:A,NO_OF_DAYS:U(M,A),STATUS:T[(i=t.booking)===null||i===void 0?void 0:i.status.code],NAME:O(v===null||v===void 0?void 0:v.first_name,v===null||v===void 0?void 0:v.last_name)||O((a=t===null||t===void 0?void 0:t.booking.guest)===null||a===void 0?void 0:a.first_name,(r=(s=t===null||t===void 0?void 0:t.booking)===null||s===void 0?void 0:s.guest)===null||r===void 0?void 0:r.last_name),IDENTIFIER:t.room.identifier,PR_ID:t.pr_id,POOL:t.POOL,BOOKING_NUMBER:t.booking.booking_nbr,NOTES:t.booking.is_direct?t.booking.remark:null,PRIVATE_NOTE:I(t.booking.extras),is_direct:t.booking.is_direct,BALANCE:(c=t.booking.financial)===null||c===void 0?void 0:c.due_amount,channel_booking_nbr:t.booking.channel_booking_nbr,ARRIVAL_TIME:t.booking.arrival.description,defaultDates:{from_date:t.room.from_date,to_date:t.room.to_date},DEPARTURE_TIME:t.room.departure_time,ENTRY_DATE:t.booking.booked_on.date,PHONE_PREFIX:t.booking.guest.country_phone_prefix,IS_EDITABLE:t.booking.is_editable,ARRIVAL:t.booking.arrival,PHONE:(d=t.booking.guest.mobile_without_prefix)!==null&&d!==void 0?d:"",RATE:t.room.total,RATE_PLAN:t.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:t.room.rateplan.id,RATE_TYPE:(l=(u=t.room)===null||u===void 0?void 0:u.roomtype)===null||l===void 0?void 0:l.id,ADULTS_COUNT:t.room.occupancy.adult_nbr,CHILDREN_COUNT:t.room.occupancy.children_nbr,origin:t.booking.origin,GUEST:t.booking.guest,ROOMS:t.booking.rooms,cancelation:t.room.rateplan.cancelation,guarantee:t.room.rateplan.guarantee,TOTAL_PRICE:(_=t.booking.financial)===null||_===void 0?void 0:_.gross_total_with_extras,COUNTRY:t.booking.guest.country_id,FROM_DATE_STR:t.booking.format.from_date,TO_DATE_STR:t.booking.format.to_date,adult_child_offering:t.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:t.booking.source.code,description:t.booking.source.description,tag:t.booking.source.tag},CHECKIN:((E=t.room.in_out)===null||E===void 0?void 0:E.code)==="001",CHECKOUT:((f=t.room.in_out)===null||f===void 0?void 0:f.code)==="002",ROOM_INFO:{occupancy:t.room.occupancy,sharing_persons:t.room.sharing_persons,unit:t.room.unit,in_out:t.room.in_out},BASE_STATUS_CODE:(N=t.booking.status)===null||N===void 0?void 0:N.code}}function M(t){var e,i;const{in_out:a,status_code:s,from_date:r,to_date:c}=t;if(o.checkin_enabled){if((a===null||a===void 0?void 0:a.code)==="001"){return T["000"]}else if((a===null||a===void 0?void 0:a.code)==="002"){if(!o.is_automatic_check_in_out){const t=n();const a=n(c,"YYYY-MM-DD");const s=n(r,"YYYY-MM-DD");const d=m(t.toDate(),p((e=o.checkin_checkout_hours)===null||e===void 0?void 0:e.offset,(i=o.checkin_checkout_hours)===null||i===void 0?void 0:i.hour));if(t.isSame(a,"days")&&t.isAfter(s,"days")&&d||t.isAfter(a,"days")){return T["003"]}else{return T["002"]}}}return T[s||"001"]}else{const t=n();const o=n(c,"YYYY-MM-DD");const e=n(r,"YYYY-MM-DD");if(s!=="PENDING"){if(e.isSame(t,"day")&&t.hour()>=12){return T["000"]}else if(t.isAfter(e,"day")&&t.isBefore(o,"day")){return T["000"]}else if(o.isSame(t,"day")&&t.hour()<12){return T["000"]}else if(o.isSame(t,"day")&&t.hour()>=12||o.isBefore(t,"day")){return T["003"]}else{return T[s||"001"]}}}}function A(n,t,o){const e=t.findIndex((t=>t.POOL===n.POOL));if(e===-1){const e=N(n,o);t.push(e)}}function I(n){var t;if(!n){return null}return((t=n.find((n=>n.key==="private_note")))===null||t===void 0?void 0:t.value)||null}function v(t){let o=[];const e=t.rooms.filter((n=>!!n["assigned_units_pool"]));e.forEach((e=>{var i,a,s,c,d,u;const l=n(e.from_date,"YYYY-MM-DD").isAfter(n(r.fromDate,"YYYY-MM-DD"))?e.from_date:r.fromDate;const _=e.to_date;if(n(e.to_date,"YYYY-MM-DD").isBefore(n(r.fromDate,"YYYY-MM-DD"))){return}const E=(i=e.sharing_persons)===null||i===void 0?void 0:i.find((n=>n.is_main));o.push({CHECKIN:false,CHECKOUT:false,ID:e["assigned_units_pool"],TO_DATE:_,FROM_DATE:l,PRIVATE_NOTE:I(t.extras),NO_OF_DAYS:U(l,_),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(a=t.financial)===null||a===void 0?void 0:a.due_amount,STATUS:M({in_out:e.in_out,from_date:e.from_date,to_date:e.to_date,status_code:(s=t.status)===null||s===void 0?void 0:s.code}),NAME:O(E===null||E===void 0?void 0:E.first_name,E.last_name)||O(e.guest.first_name,e.guest.last_name),PHONE:(c=t.guest.mobile_without_prefix)!==null&&c!==void 0?c:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:e.total,RATE_PLAN:e.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:e.rateplan.id,IDENTIFIER:e.identifier,RATE_TYPE:e.roomtype.id,ADULTS_COUNT:e.occupancy.adult_nbr,CHILDREN_COUNT:e.occupancy.children_nbr,PR_ID:+e.unit.id,POOL:e["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:e.rateplan.cancelation,guarantee:e.rateplan.guarantee,TOTAL_PRICE:(d=t.financial)===null||d===void 0?void 0:d.gross_total_with_extras,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:e.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,DEPARTURE_TIME:e.departure_time,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:e.from_date,to_date:e.to_date},ROOM_INFO:{occupancy:e.occupancy,sharing_persons:e.sharing_persons,unit:e.unit,in_out:e.in_out},BASE_STATUS_CODE:(u=t.status)===null||u===void 0?void 0:u.code})}));return o}async function R(n){const t=await f();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""&&n.NOTES!==null?n.NOTES:n.STAY_STATUS_CODE==="003"?Y(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):t.find((t=>t.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:S(n.from_date,n.to_date),STATUS:D[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date,defaultDates:{from_date:n.from_date,to_date:n.to_date}}}function S(t,o){const e=n(t,"YYYY-MM-DD").startOf("day");const i=n(o,"YYYY-MM-DD").endOf("day");const a=i.diff(e,"days");return a||1}function m(n,t){return n.getHours()>=t.getHours()&&n.getMinutes()>=t.getMinutes()}function p(n,t){const o=new Date;const e=n*60*60*1e3;const i=new Date(o.getTime()+e);const a=i.getUTCFullYear();const s=i.getUTCMonth();const r=i.getUTCDate();const c=t-n;return new Date(Date.UTC(a,s,r,c))}function C(t,o,e="D_M_YYYY"){const i=`${t.split(" ")[1]} ${o}`;const a=n(i,"DD MMM YYYY");if(!a.isValid()){throw new Error("Invalid Date")}return a.format(e)}function L(t,o){const e=n(t+" "+o,"ddd DD MMM YYYY").toDate();e.setHours(0,0,0,0);return e.getTime()}function U(n,t){const o=new Date(n);const e=new Date(t);return Math.ceil((e.getTime()-o.getTime())/(1e3*60*60*24))}function y(n){const t=n.getFullYear();const o=(n.getMonth()+1).toString().padStart(2,"0");const e=n.getDate().toString().padStart(2,"0");return`${t}-${o}-${e}`}function g(n){let t={};const o={"IN-HOUSE":{id:1,clsName:"IN_HOUSE"},CONFIRMED:{id:2,clsName:"CONFIRMED"},"PENDING-CONFIRMATION":{id:3,clsName:"PENDING_CONFIRMATION"},"SPLIT-UNIT":{id:4,clsName:"SPLIT_UNIT"},"CHECKED-IN":{id:5,clsName:"CHECKED_IN"},"CHECKED-OUT":{id:5,clsName:"CHECKED_OUT"},BLOCKED:{id:6,clsName:"BLOCKED"},"BLOCKED-WITH-DATES":{id:7,clsName:"BLOCKED_WITH_DATES"},NOTES:{id:8,clsName:"NOTES"},"OUTSTANDING-BALANCE":{id:9,clsName:"OUTSTANDING_BALANCE"},"TEMP-EVENT":{id:10,clsName:"PENDING_CONFIRMATION"}};n.forEach((n=>{t[n.id]=n;t.statusId=o}));return t}function P(n){return["003","002","004"].includes(n)}const w=(n,t)=>t.find((t=>t.id===n));function F(n){const t=new Date;const o=n;t.setHours(t.getHours()+o,t.getMinutes(),0,0);return{BLOCKED_TILL_DATE:y(t),BLOCKED_TILL_HOUR:t.getHours().toString(),BLOCKED_TILL_MINUTE:t.getMinutes().toString()}}function h(t,o){const e=n(t,"D_M_YYYY");e.add(o,"days");return e.format("YYYY-MM-DD")}function B(t){const o=n(t,"D_M_YYYY");return o.format("YYYY-MM-DD")}function H(t){return n(t).add(2,"months").format("YYYY-MM-DD")}function b(t,o="DD MMM YYYY"){const e=n(t,o).format("ddd, DD MMM YYYY");return e}function K(t){return n(t).add(1,"days").format("YYYY-MM-DD")}function k(t){return n(t,"YYYY-MM-DD").format("DD/MM ddd")}function G(t,o){let e=[];let i=n.min(n(t).add(1,"days"),n(o));let a=n.max(n(t),n(o));while(i<a){e.push(i.format("YYYY-MM-DD"));i=i.clone().add(1,"days")}return e}function j(n){return n<10?n.toString().padStart(2,"0"):n.toString()}function x(n){if(n===""){return true}const o=t.string().email().safeParse(n);return!o.success}function V(n,t){return n+" "+t.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}const $=[{key:"private_note",value:""},{key:"is_backend",value:true},{key:"ERROR_EMAIL",value:""},{key:"agent_payment_mode",value:""},{key:"payment_code",value:""}];function J(n,t="add"){const o=JSON.parse(sessionStorage.getItem("backend_anchor"));if(o){if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify(Object.assign(Object.assign({},o),n)))}else if(t==="remove"){const t=Object.keys(n);t.forEach((n=>{if(n in o){delete o[n]}}));return sessionStorage.setItem("backend_anchor",JSON.stringify(o))}}else{if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify(Object.assign({},n)))}}}function W(){const n=JSON.parse(sessionStorage.getItem("backend_anchor"));if(n){return n.login||null}return null}function X({from_date:t,to_date:e,isCheckedIn:i}){var a,s;if(!o.checkin_enabled||o.is_automatic_check_in_out){return false}if(i){return false}const r=n();if(n().isSameOrAfter(new Date(t),"days")&&n().isBefore(new Date(e),"days")||n().isSame(new Date(e),"days")&&!m(r.toDate(),p((a=o.checkin_checkout_hours)===null||a===void 0?void 0:a.offset,(s=o.checkin_checkout_hours)===null||s===void 0?void 0:s.hour))){return true}return false}function q(n,t){const o=document.createElement("a");o.href=n;o.download=t||n;document.body.appendChild(o);o.click();document.body.removeChild(o)}function z(n,t){const o=Math.pow(10,t);return n/o}async function Q(n=200){return new Promise((t=>setTimeout((()=>t(null)),n)))}function Z(n){const t="data-ir-scroll-locked";let o=document.body.getAttribute(t);if(!document.getElementById("scroll-lock-style")){const n=document.createElement("style");n.id="scroll-lock-style";n.innerHTML=`\n      body:dir(ltr)[data-ir-scroll-locked] {\n        overflow: hidden !important;\n        overscroll-behavior: contain;\n        position: relative !important;\n        padding-left: 0px;\n        padding-top: 0px;\n        padding-right: 0px;\n        margin-left: 0;\n        margin-top: 0;\n        margin-right: 15px !important;\n      }\n      body:dir(rtl)[data-ir-scroll-locked] {\n        overflow: hidden !important;\n        overscroll-behavior: contain;\n        position: relative !important;\n        padding-left: 0px;\n        padding-top: 0px;\n        padding-right: 0px;\n        margin-right: 0;\n        margin-top: 0;\n        margin-left: 15px !important;\n      }\n    `;document.head.appendChild(n)}if(!o){document.body.setAttribute(t,"1")}else{const e=n?Number(o)+1:Number(o)-1;document.body.setAttribute(t,e.toString());if(e<=0){document.body.removeAttribute(t)}}}export{T as A,P as B,K as C,H as D,B as E,h as F,U as G,m as H,p as I,G as J,k as K,b as L,w as M,X as N,I as a,q as b,S as c,y as d,$ as e,V as f,F as g,Z as h,O as i,_ as j,C as k,L as l,W as m,J as n,g as o,r as p,d as q,j as r,Q as s,z as t,M as u,x as v,u as w,l as x,v as y,R as z};
//# sourceMappingURL=p-1e9cfd69.js.map