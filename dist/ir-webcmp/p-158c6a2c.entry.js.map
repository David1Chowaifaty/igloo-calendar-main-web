{"version":3,"names":["irArrivalsCss","IrArrivalsStyle0","IrArrivals","ticket","propertyid","language","p","pageSize","bookingNumber","booking","paymentEntries","isPageLoading","payment","roomGuestState","countries","tokenService","Token","roomService","RoomService","bookingService","BookingService","paymentFolioRef","componentWillLoad","this","setToken","init","setArrivalsPageSize","onArrivalsStoreChange","_","getBookings","handlePageSizeChange","newValue","oldValue","handleTicketChange","handleBookingPayment","e","stopImmediatePropagation","stopPropagation","booking_nbr","detail","arrivalsStore","bookings","find","b","paymentType","types","CODE_NAME","payment_type","code","description","CODE_VALUE_EN","operation","NOTES","openFolio","handleOpen","handleResetExposedCancellationDueAmount","Error","propertyId","getExposedProperty","id","aname","is_backend","__","setupEntries","Promise","all","calendar_data","property","resolve","fetchLanguage","getCountries","getSetupEntriesByTableNameMulti","pay_type","pay_type_group","pay_method","groupEntryTablesResult","groups","methods","error","total_count","getRoomsToCheckIn","property_id","toString","check_in_date","today","page_index","pagination","currentPage","page_size","setArrivalsTotal","initializeArrivalsStore","handlePaginationChange","event","nextPage","setArrivalsPage","handlePaginationPageSizeChange","nextPageSize","Number","isFinite","normalizedPageSize","Math","floor","handleCheckingRoom","render","h","Host","handledEndpoints","class","onCheckInRoom","onRequestPageChange","onRequestPageSizeChange","onDrawerHide","withoutHeader","open","style","hasPrint","hasReceipt","hasCloseButton","onCloseSidebar","is_from_front_desk","hasRoomEdit","hasRoomDelete","hasRoomAdd","height","mode","ref","el","onCloseModal","identifier","roomName","totalGuests","sharedPersons","sharing_persons","checkIn","checkin","irBookingEmailLogsCss","IrBookingEmailLogsStyle0","IrBookingEmailLogs","data","token","key","gap","inputContainerStyle","margin","value","onTextChange","placeholder","size","text","onClickHandler","async","axios","post","BOOK_NBR","ExceptionMsg","My_Result","JSON","stringify","getAllParams","params","URLSearchParams","window","location","search","out","entries","irBookingListingCss","IrBookingListingStyle0","IrBookingListing","rowCount","baseUrl","userType","isLoading","editBookingItem","showCost","bookingListingService","BookingListingService","propertyService","PropertyService","listingModal","listingModalTimeout","allowedProperties","havePrivilege","setBaseUrl","updateUserSelection","booking_listing","setPaginationPageSize","initializeApp","onBookingListingChange","updatePaginationFromSelection","some","financial","gross_cost","ticketChanged","fetchBookings","getExposedBookings","userSelection","is_to_export","isPrivilegedUser","propertyData","parallelRequests","getExposedBookingsCriteria","allowedPropertiesIndex","push","length","getExposedAllowedProperties","results","map","updateUserSelections","property_ids","userTypeCode","console","handleSideBarToggle","geSearchFiltersFromParams","log","obj","s","status","filter","from","to","openModal","setTimeout","querySelector","editBooking","disconnectedCallback","clearTimeout","setPaginationPage","handleResetStoreData","handleBookingChanged","findBooking","handleSelectGuestEvent","cause","handleGuestChanged","guest","newGuest","onGuestInfoDrawerClosed","email","irDailyRevenueCss","IrDailyRevenueStyle0","IrDailyRevenue","groupedPayment","previousDateGroupedPayments","filters","date","moment","format","users","sideBarEvent","preventPageLoad","handleOpenSidebar","handleFetchNewReports","getPaymentReports","handleResetBooking","handleSidebarClose","renderSidebarBody","type","slot","payload","include_units_hk_status","requests","groupPaymentsByName","payments","Map","payTypeCode","payMethodCode","get","set","sort","a","aNum","bNum","isNaN","localeCompare","isExportToExcel","excludeYesterday","getReportObj","report","method","METHOD","PAY_TYPE_CODE","PAY_METHOD_CODE","amount","AMOUNT","DATE","hour","HOUR","minute","MINUTE","user","USER","currency","CURRENCY","bookingNbr","BOOKING_NBR","v4","getDailyRevenueReport","is_export_to_excel","add","btn_color","locales","Lcz_Export","btnStyle","iconPosition","icon_name","icon_style","groupedPayments","sidebarStyles","width","background","Boolean","showCloseButton","onIrSidebarToggle","irDeparturesCss","IrDeparturesStyle0","IrDepartures","checkoutState","invoiceState","onDeparturesStoreChange","departuresStore","getRoomsToCheckout","check_out_date","setDepartureTotal","initializeDeparturesStore","handleCheckoutRoom","setDeparturesPage","handleCheckoutDialogClosed","state","reason","setDeparturesPageSize","handleInvoiceClose","onCheckoutRoom","onCheckoutDialogClosed","onInvoiceClose","roomIdentifier","irHkTasksCss","IrHkTasksStyle0","IrHkTasks","isCleaningLoading","selectedDuration","selectedHouseKeeper","selectedRoom","archiveOpened","isSidebarOpen","isApplyFiltersLoading","modalCauses","clearSelectedHkTasks","hkNameCache","houseKeepingService","HouseKeepingService","table_sorting","modal","handleCloseSidebar","handleSortingChanged","field","direction","handleSkipSelectedTask","task","setLoading","getExposedHKSetup","tasksResult","getHkTasks","from_date","to_date","housekeepers","cleaning_frequency","housekeeping_store","hk_criteria","cleaning_frequencies","dusty_window","dusty_periods","highlight_window","highlight_checkin_options","tasks","updateTasks","buildHousekeeperNameCache","forEach","hk","name","updateTasksStore","t","housekeeper","hkm_id","hkName","handleHeaderButtonPress","sortingArray","Array","url","fetchTasksWithFilters","downloadFile","handleSelectedTaskCleaningEvent","handleModalConfirmation","hkTasksStore","selectedTasks","unit","editHkSkip","COMMENT","HK_SKIP_ID","HK_SKIP_REASON_CODE","PR_ID","executeHKAction","actions","unit_id","clearSelectedTasks","closeModal","applyFilters","export_to_excel","cleaning_periods","dusty_units","highlight_check_ins","onApplyFilters","onRowSelectChange","updateSelectedTasks","autoClose","onConfirmModal","bind","onCancelModal","iconAvailable","icon","leftBtnText","Lcz_Cancel","rightBtnText","Lcz_Confirm","leftBtnColor","rightBtnColor","modalTitle","Lcz_Confirmation","modalBody","getToken","irHousekeepingCss","IrHousekeepingStyle0","IrHousekeeping","toast","selectedCleaningFrequency","handleResetData","include_sales_rate_plans","updateHKStore","housekeeping_enabled","saveAutomaticCheckInCheckout","SetAutomaticCheckInOut","default_properties","flag","emit","position","title","saveCleaningFrequency","setExposedCleaningFrequency","Lcz_HouseKeepingAndCheckInSetup","borderShown","label","Lcz_CheckInOutGuestsAutomatically","showFirstOption","selectedValue","is_automatic_check_in_out","onSelectChange","Lcz_YesAsPerPropertyPolicy","Lcz_NoIWillDoItManually","Lcz_CleaningFrequency","v","isRequestPending","irMonthlyBookingsReportCss","IrMonthlyBookingsReportStyle0","IrMonthlyBookingsReport","reports","stats","baseFilters","firstOfMonth","startOf","lastOfMonth","endOf","include_previous_year","handleApplyFiltersChange","getReports","day","Date","units_booked","Units_booked","occupancy_percent","Occupancy","adr","ADR","rooms_revenue","Rooms_Revenue","total_guests","Total_Guests","getMonthlyStats","currentReports","enrichedReports","DailyStats","rest","previousYearReports","formattedReports","current","previous","prev","last_year","alignItems","Occupancy_Difference_From_Previous_Month","cardTitle","AverageOccupancy","toFixed","subtitle","TotalUnitsBooked","PeakDays","pd","concat","join","max","OccupancyPercent","irSalesByChannelCss","IrSalesByChannelStyle0","IrSalesByChannel","salesData","channelSalesFilters","propertyID","FROM_DATE","TO_DATE","BOOK_CASE","WINDOW","unshift","properties","LIST_AC_ID","getChannelSales","filterParams","currentSales","AC_ID","undefined","shouldFetchPreviousYear","enrichedSales","previousYearSales","subtract","SOURCE","toLowerCase","record","groupSalesRecordsBySource","records","getCurrencyId","r","createKey","source","trim","currencyId","sumValues","mergeLastYear","base","incoming","NIGHTS","PCT","REVENUE","PROPERTY_ID","PROPERTY_NAME","grouped","existing","merged","result","values","totalRevenue","reduce","sum","lastYearTotal","irSalesByCountryCss","IrSalesByCountryStyle0","IrSalesByCountry","salesFilters","getCountrySales","mappedCountries","country","formatSalesData","COUNTRY","country_id","COUNTRY_ID","nights","percentage","revenue","number_of_guests","salesReports","irUserManagementCss","IrUserManagementStyle0","IrUserManagement","isSuperAdmin","baseUserTypeCode","userId","allowedUsersTypes","userService","UserService","userTypes","socket","superAdminId","fetchUsers","fetchUserTypes","io","on","msg","handleSocketMessage","msgAsObject","parse","REASON","KEY","PAYLOAD","reasonHandlers","EMAIL_VERIFIED","updateUserVerificationStatus","handler","call","warn","idx","findIndex","u","is_email_verified","getExposedPropertyUsers","u1","u2","priority","p1","p2","username","res","getSetupEntriesByTableName","getLov","allowedUsers","allowed_user_types","toUpperCase","f","disconnect","suppressToastEndpoints","Lcz_ExtranetUsers","haveAdminPrivileges","includes"],"sources":["src/components/ir-arrivals/ir-arrivals.css?tag=ir-arrivals&encapsulation=scoped","src/components/ir-arrivals/ir-arrivals.tsx","src/components/ir-booking-email-logs/ir-booking-email-logs.css?tag=ir-booking-email-logs&encapsulation=scoped","src/components/ir-booking-email-logs/ir-booking-email-logs.tsx","src/utils/browserHistory.ts","src/components/ir-booking-listing/ir-booking-listing.css?tag=ir-booking-listing&encapsulation=scoped","src/components/ir-booking-listing/ir-booking-listing.tsx","src/components/ir-daily-revenue/ir-daily-revenue.css?tag=ir-daily-revenue&encapsulation=scoped","src/components/ir-daily-revenue/ir-daily-revenue.tsx","src/components/ir-departures/ir-departures.css?tag=ir-departures&encapsulation=scoped","src/components/ir-departures/ir-departures.tsx","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.css?tag=ir-hk-tasks&encapsulation=scoped","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.tsx","src/components/ir-housekeeping/ir-housekeeping.css?tag=ir-housekeeping&encapsulation=scoped","src/components/ir-housekeeping/ir-housekeeping.tsx","src/components/ir-monthly-bookings-report/ir-monthly-bookings-report.css?tag=ir-monthly-bookings-report&encapsulation=scoped","src/components/ir-monthly-bookings-report/ir-monthly-bookings-report.tsx","src/components/ir-sales-by-channel/ir-sales-by-channel.css?tag=ir-sales-by-channel&encapsulation=scoped","src/components/ir-sales-by-channel/ir-sales-by-channel.tsx","src/components/ir-sales-by-country/ir-sales-by-country.css?tag=ir-sales-by-country&encapsulation=scoped","src/components/ir-sales-by-country/ir-sales-by-country.tsx","src/components/ir-user-management/ir-user-management.css?tag=ir-user-management&encapsulation=scoped","src/components/ir-user-management/ir-user-management.tsx"],"sourcesContent":[".page-title {\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-xl);\n}\n","import type { PaginationChangeEvent } from '@/components/ir-pagination/ir-pagination';\nimport { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { RoomService } from '@/services/room.service';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries, RoomGuestsPayload } from '../ir-booking-details/types';\nimport { arrivalsStore, initializeArrivalsStore, onArrivalsStoreChange, setArrivalsPage, setArrivalsPageSize, setArrivalsTotal } from '@/stores/arrivals.store';\nimport { ICountry } from '@/models/IBooking';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-arrivals',\n  styleUrls: ['ir-arrivals.css'],\n  scoped: true,\n})\nexport class IrArrivals {\n  /**\n   * Authentication token issued by the PMS backend.\n   * Required for initializing the component and making API calls.\n   */\n  @Prop() ticket: string;\n\n  /**\n   * ID of the property (hotel) for which arrivals should be displayed.\n   * Used in API calls related to rooms, bookings, and check-ins.\n   */\n  @Prop() propertyid: number;\n\n  /**\n   * Two-letter language code (ISO) used for translations and API locale.\n   * Defaults to `'en'`.\n   */\n  @Prop() language: string = 'en';\n\n  /**\n   * Property alias or short identifier used by backend endpoints (aname).\n   * Passed to `getExposedProperty` when initializing the component.\n   */\n  @Prop() p: string;\n\n  /**\n   * Number of arrivals to load per page in the arrivals table.\n   * Used to configure pagination via Arrivals Store.\n   * Defaults to `20`.\n   */\n  @Prop() pageSize: number = 20;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n  @State() roomGuestState: RoomGuestsPayload = null;\n  @State() countries: ICountry[];\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n    setArrivalsPageSize(this.pageSize);\n    onArrivalsStoreChange('today', _ => {\n      this.getBookings();\n    });\n  }\n\n  @Watch('pageSize')\n  handlePageSizeChange(newValue: number, oldValue: number) {\n    if (newValue !== oldValue) setArrivalsPageSize(newValue);\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = arrivalsStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n  @Listen('resetExposedCancellationDueAmount')\n  async handleResetExposedCancellationDueAmount(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.getBookings();\n  }\n  private async init() {\n    try {\n      this.isPageLoading = true;\n\n      if (!this.propertyid && !this.p) {\n        throw new Error('Missing credentials');\n      }\n      let propertyId = this.propertyid;\n\n      if (!propertyId) {\n        await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n      }\n\n      const [_, __, countries, setupEntries] = await Promise.all([\n        calendar_data?.property ? Promise.resolve(null) : this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getCountries(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getBookings(),\n      ]);\n      this.countries = countries;\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getBookings() {\n    const { bookings, total_count } = await this.bookingService.getRoomsToCheckIn({\n      property_id: calendar_data.property.id?.toString() ?? this.propertyid?.toString(),\n      check_in_date: arrivalsStore.today,\n      page_index: arrivalsStore.pagination.currentPage,\n      page_size: arrivalsStore.pagination.pageSize,\n    });\n    setArrivalsTotal(total_count ?? 0);\n    initializeArrivalsStore(bookings);\n  }\n\n  private async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPage = event.detail?.currentPage ?? 1;\n    if (nextPage === arrivalsStore.pagination.currentPage) {\n      return;\n    }\n    setArrivalsPage(nextPage);\n    await this.getBookings();\n  }\n\n  private async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPageSize = event.detail?.pageSize;\n    if (!Number.isFinite(nextPageSize)) {\n      return;\n    }\n    const normalizedPageSize = Math.floor(Number(nextPageSize));\n    if (normalizedPageSize === arrivalsStore.pagination.pageSize) {\n      return;\n    }\n    setArrivalsPageSize(normalizedPageSize);\n    await this.getBookings();\n  }\n  private handleCheckingRoom(event: CustomEvent<RoomGuestsPayload>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.roomGuestState = event.detail;\n  }\n  // @Listen(\"resetBookingEvt\")\n  // handleResetBookings(e:CustomEvent){\n  //   e.stopImmediatePropagation();\n  //   e.stopPropagation();\n  //   this.\n  // }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor handledEndpoints={['/Get_Rooms_To_Check_in']}></ir-interceptor>\n        <div class=\"ir-page__container\">\n          <h3 class=\"page-title\">Arrivals</h3>\n          {/* <ir-arrivals-filters></ir-arrivals-filters> */}\n          <ir-arrivals-table\n            onCheckInRoom={event => this.handleCheckingRoom(event as CustomEvent<RoomGuestsPayload>)}\n            onRequestPageChange={event => this.handlePaginationChange(event as CustomEvent<PaginationChangeEvent>)}\n            onRequestPageSizeChange={event => this.handlePaginationPageSizeChange(event as CustomEvent<PaginationChangeEvent>)}\n          ></ir-arrivals-table>\n          <ir-drawer\n            onDrawerHide={e => {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              this.bookingNumber = null;\n            }}\n            withoutHeader\n            open={!!this.bookingNumber}\n            style={{\n              '--ir-drawer-width': '80rem',\n              '--ir-drawer-background-color': '#F2F3F8',\n              '--ir-drawer-padding-left': '0',\n              '--ir-drawer-padding-top': '0',\n              '--ir-drawer-padding-bottom': '0',\n              '--ir-drawer-padding-right': '0',\n            }}\n          >\n            {this.bookingNumber && (\n              <ir-booking-details\n                hasPrint\n                hasReceipt\n                hasCloseButton\n                onCloseSidebar={() => (this.bookingNumber = null)}\n                is_from_front_desk\n                propertyid={this.propertyid as any}\n                hasRoomEdit\n                hasRoomDelete\n                bookingNumber={this.bookingNumber.toString()}\n                ticket={this.ticket}\n                language={this.language}\n                hasRoomAdd\n              ></ir-booking-details>\n            )}\n          </ir-drawer>\n          <ir-payment-folio\n            style={{ height: 'auto' }}\n            bookingNumber={this.booking?.booking_nbr}\n            paymentEntries={this.paymentEntries}\n            payment={this.payment}\n            mode={'payment-action'}\n            ref={el => (this.paymentFolioRef = el)}\n            onCloseModal={() => {\n              this.booking = null;\n              this.payment = null;\n            }}\n          ></ir-payment-folio>\n          <ir-room-guests\n            open={this.roomGuestState !== null}\n            countries={this.countries}\n            language={this.language}\n            identifier={this.roomGuestState?.identifier}\n            bookingNumber={this.roomGuestState?.booking_nbr?.toString()}\n            roomName={this.roomGuestState?.roomName}\n            totalGuests={this.roomGuestState?.totalGuests}\n            sharedPersons={this.roomGuestState?.sharing_persons}\n            checkIn={this.roomGuestState?.checkin}\n            onCloseModal={() => (this.roomGuestState = null)}\n          ></ir-room-guests>\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-booking-email-logs',\n  styleUrl: 'ir-booking-email-logs.css',\n  scoped: true,\n})\nexport class IrBookingEmailLogs {\n  @Prop() ticket: string;\n\n  @State() data: any[];\n  @State() bookingNumber: string;\n\n  private token = new Token();\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n    }\n  }\n\n  @Watch('ticket')\n  handleTicketChange() {\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n    }\n  }\n\n  render() {\n    return (\n      <Host class=\"p-1\">\n        <ir-interceptor handledEndpoints={['/Get_Email_log_By_BOOK_NBR']}></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"d-flex align-items-center mb-1\" style={{ gap: '0.5rem' }}>\n          <ir-input-text\n            class=\"m-0\"\n            inputContainerStyle={{ margin: '0' }}\n            value={this.bookingNumber}\n            onTextChange={e => (this.bookingNumber = e.detail)}\n            placeholder=\"booking number\"\n          ></ir-input-text>\n          <ir-button\n            size=\"sm\"\n            text=\"search\"\n            onClickHandler={async () => {\n              const { data } = await axios.post('/Get_Email_log_By_BOOK_NBR', {\n                BOOK_NBR: this.bookingNumber,\n              });\n              if (data.ExceptionMsg) {\n                return;\n              }\n              this.data = data.My_Result;\n            }}\n          ></ir-button>\n        </div>\n        <p>{JSON.stringify(this.data, null, 2)}</p>\n      </Host>\n    );\n  }\n}\n","// src/utils/browserHistory.ts\n\n/**\n * A small utility for reading and writing browser history\n * and manipulating URL search params in a type-safe way.\n */\n\ntype Parser<T> = (value: string | null) => T;\n\n// Common parsers/serializers\nexport const ParamTypes = {\n  string: {\n    parse: (v: string | null): string => v ?? '',\n    serialize: (v: string): string => v,\n  },\n  number: {\n    parse: (v: string | null): number => {\n      if (v == null || v === '') return NaN;\n      const n = Number(v);\n      return isNaN(n) ? NaN : n;\n    },\n    serialize: (v: number): string => String(v),\n  },\n  boolean: {\n    parse: (v: string | null): boolean => v === 'true',\n    serialize: (v: boolean): string => (v ? 'true' : 'false'),\n  },\n} as const;\n\n/**\n * Read a single search‑param, parse it, and return a typed value.\n * Falls back to defaultValue if missing or parse fails.\n */\nexport function getParam<T>(key: string, { parse }: { parse: Parser<T> }, defaultValue: T): T {\n  const params = new URLSearchParams(window.location.search);\n  const raw = params.get(key);\n  try {\n    if (raw == null) return defaultValue;\n    return parse(raw);\n  } catch {\n    return defaultValue;\n  }\n}\n\n/** Helpers for the three built‑in types */\nexport function getStringParam(key: string, defaultValue = ''): string {\n  return getParam(key, ParamTypes.string, defaultValue);\n}\n\nexport function getNumberParam(key: string, defaultValue = NaN): number {\n  return getParam(key, ParamTypes.number, defaultValue);\n}\n\nexport function getBooleanParam(key: string, defaultValue = false): boolean {\n  return getParam(key, ParamTypes.boolean, defaultValue);\n}\n\n/**\n * Read all current search params into a Record<string, string>\n */\nexport function getAllParams(): Record<string, string> {\n  const params = new URLSearchParams(window.location.search);\n  const out: Record<string, string> = {};\n  for (const [key, value] of params.entries()) {\n    out[key] = value;\n  }\n  return out;\n}\n\ninterface SetParamsOptions {\n  /** if true, uses replaceState instead of pushState */\n  replace?: boolean;\n}\n\n/**\n * Update one or more search params.\n * Pass null to delete a param.\n * By default uses history.pushState; set replace: true to call replaceState.\n */\nexport function setParams(updates: Record<string, string | number | boolean | null>, options: SetParamsOptions = {}): void {\n  const params = new URLSearchParams(window.location.search);\n\n  for (const [key, value] of Object.entries(updates)) {\n    if (!value) {\n      params.delete(key);\n    } else {\n      params.set(key, String(value));\n    }\n  }\n\n  const newSearch = params.toString();\n  const newUrl = window.location.pathname + (newSearch ? `?${newSearch}` : '') + window.location.hash;\n\n  if (options.replace) {\n    window.history.replaceState(window.history.state, '', newUrl);\n  } else {\n    window.history.pushState(window.history.state, '', newUrl);\n  }\n}\n\n/**\n * Push a new history entry.\n * `path` may include search or hash.\n * `state` is the history state object.\n */\nexport function pushHistory(path: string, state: any = {}): void {\n  window.history.pushState(state, '', path);\n}\n\n/**\n * Replace the current history entry.\n * `path` may include search or hash.\n * `state` is the history state object.\n */\nexport function replaceHistory(path: string, state: any = {}): void {\n  window.history.replaceState(state, '', path);\n}\n",":host {\n  display: block;\n  padding: var(--wa-space-l);\n  position: relative;\n}\n","import { Booking } from '@/models/booking.dto';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { RoomService } from '@/services/room.service';\nimport booking_listing, {\n  updateUserSelection,\n  onBookingListingChange,\n  updateUserSelections,\n  ExposedBookingsParams,\n  setPaginationPage,\n  setPaginationPageSize,\n  updatePaginationFromSelection,\n} from '@/stores/booking_listing.store';\nimport { isPrivilegedUser } from '@/utils/utils';\nimport { Component, Host, Prop, State, Watch, h, Element, Listen } from '@stencil/core';\nimport Token from '@/models/Token';\nimport { getAllParams } from '@/utils/browserHistory';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { AllowedProperties, PropertyService } from '@/services/property.service';\nimport type { PaginationChangeEvent } from '@/components/ir-pagination/ir-pagination';\nimport { GuestChangedEvent } from '@/components';\n\n@Component({\n  tag: 'ir-booking-listing',\n  styleUrls: ['ir-booking-listing.css'],\n  scoped: true,\n})\nexport class IrBookingListing {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() rowCount: number = 20;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n  @Prop() userType: number;\n\n  @State() isLoading = false;\n  @State() editBookingItem: { booking: Booking; cause: 'edit' | 'payment' | 'delete' | 'guest' } | null = null;\n  @State() showCost = false;\n  @State() paymentEntries: PaymentEntries;\n  @State() payment: Payment;\n  @State() booking: Booking;\n\n  private bookingListingService = new BookingListingService();\n  private bookingService = new BookingService();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private token = new Token();\n\n  private listingModal: HTMLIrListingModalElement;\n  private listingModalTimeout: NodeJS.Timeout;\n  private allowedProperties: number[];\n  private havePrivilege: boolean;\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    updateUserSelection('end_row', this.rowCount);\n    booking_listing.rowCount = this.rowCount;\n    setPaginationPageSize(this.rowCount);\n    if (this.ticket !== '') {\n      booking_listing.token = this.ticket;\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n    onBookingListingChange('userSelection', newValue => {\n      updatePaginationFromSelection(newValue);\n    });\n    onBookingListingChange('bookings', newValue => {\n      this.showCost = newValue.some(booking => booking.financial.gross_cost !== null && booking.financial.gross_cost > 0);\n    });\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    booking_listing.token = this.ticket;\n    this.initializeApp();\n  }\n\n  private async fetchBookings() {\n    await this.bookingListingService.getExposedBookings({\n      ...booking_listing.userSelection,\n      is_to_export: false,\n    });\n  }\n\n  private async initializeApp() {\n    try {\n      this.isLoading = true;\n      this.havePrivilege = isPrivilegedUser(this.userType);\n\n      let propertyId = this.propertyid;\n      if (!this.havePrivilege) {\n        if (!this.propertyid && !this.p) {\n          throw new Error('Property ID or username is required');\n        }\n\n        if (!propertyId) {\n          const propertyData = await this.roomService.getExposedProperty({\n            id: 0,\n            aname: this.p,\n            language: this.language,\n            is_backend: true,\n          });\n          propertyId = propertyData.My_Result.id;\n        }\n      }\n\n      const parallelRequests: Promise<unknown>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.bookingListingService.getExposedBookingsCriteria(this.havePrivilege ? null : propertyId),\n        this.roomService.fetchLanguage(this.language, ['_BOOKING_LIST_FRONT']),\n      ];\n\n      // let propertyDataIndex: number | null = null;\n      let allowedPropertiesIndex: number | null = null;\n\n      if (this.propertyid && !this.havePrivilege) {\n        // propertyDataIndex = parallelRequests.length;\n        parallelRequests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n          }),\n        );\n      }\n\n      if (this.havePrivilege) {\n        allowedPropertiesIndex = parallelRequests.length;\n        parallelRequests.push(this.propertyService.getExposedAllowedProperties());\n      }\n\n      const results = await Promise.all(parallelRequests);\n\n      const [setupEntries] = results;\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries as any);\n\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n\n      this.allowedProperties = allowedPropertiesIndex !== null ? (results[allowedPropertiesIndex] as AllowedProperties)?.map(p => p.id) : null;\n\n      updateUserSelection('property_id', propertyId);\n\n      updateUserSelections({\n        property_ids: this.allowedProperties,\n        userTypeCode: this.userType,\n      });\n\n      await this.fetchBookings();\n    } catch (error) {\n      console.error('Error initializing app:', error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  handleSideBarToggle(e: CustomEvent<boolean>) {\n    if (e.detail) {\n      this.editBookingItem = null;\n    }\n  }\n  geSearchFiltersFromParams() {\n    //e=10&status=002&from=2025-04-15&to=2025-04-22&filter=2&c=Alitalia+Cabin+Crew\n    const params = getAllParams();\n    if (params) {\n      console.log('update params');\n      let obj: Partial<ExposedBookingsParams> = {};\n      if (params.e) {\n        obj['end_row'] = Number(params.e);\n      }\n      if (params.s) {\n        obj['start_row'] = Number(params.s);\n      }\n      if (params.status) {\n        obj['booking_status'] = params.status;\n      }\n      if (params.filter) {\n        obj['filter_type'] = params.filter;\n      }\n      if (params.from) {\n        obj['from'] = params.from;\n      }\n      if (params.to) {\n        obj['to'] = params.to;\n      }\n      updateUserSelections(obj);\n    }\n    console.log('params=>', params);\n  }\n  openModal() {\n    this.listingModalTimeout = setTimeout(() => {\n      this.listingModal = this.el.querySelector('ir-listing-modal');\n      this.listingModal.editBooking = this.editBookingItem;\n      this.listingModal.openModal();\n    }, 100);\n  }\n  disconnectedCallback() {\n    clearTimeout(this.listingModalTimeout);\n  }\n\n  @Listen('requestPageChange')\n  async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    if (!event.detail) {\n      return;\n    }\n    setPaginationPage(event.detail.currentPage);\n    await this.fetchBookings();\n  }\n\n  @Listen('requestPageSizeChange')\n  async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    if (!event.detail || !event.detail.pageSize) {\n      return;\n    }\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    setPaginationPageSize(event.detail.pageSize);\n    await this.fetchBookings();\n  }\n\n  @Listen('resetBookingData')\n  async handleResetStoreData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchBookings();\n  }\n\n  @Listen('bookingChanged')\n  handleBookingChanged(e: CustomEvent<Booking>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    booking_listing.bookings = [\n      ...booking_listing.bookings.map(b => {\n        if (b.booking_nbr === e.detail.booking_nbr) {\n          return e.detail;\n        }\n        return b;\n      }),\n    ];\n  }\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = this.findBooking(booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n  @Listen('guestSelected')\n  handleSelectGuestEvent(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const booking = this.findBooking(e.detail);\n    if (!booking) {\n      return;\n    }\n    this.editBookingItem = {\n      booking,\n      cause: 'guest',\n    };\n  }\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation;\n    const booking = this.findBooking(e.detail);\n    if (!booking) {\n      return;\n    }\n    this.editBookingItem = {\n      booking,\n      cause: 'edit',\n    };\n  }\n\n  @Listen('resetExposedCancellationDueAmount')\n  async handleResetExposedCancellationDueAmount(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchBookings();\n  }\n\n  @Listen('guestChanged')\n  handleGuestChanged(e: CustomEvent<GuestChangedEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n\n    booking_listing.bookings = booking_listing.bookings.map(b => {\n      const guest = { ...b.guest };\n      const newGuest = e.detail;\n      if (guest.id === newGuest.id) {\n        return { ...b, guest: { ...guest, ...newGuest } };\n      }\n      return b;\n    });\n  }\n\n  private findBooking(bookingNumber: Booking['booking_nbr']) {\n    return booking_listing.bookings.find(b => b.booking_nbr === bookingNumber);\n  }\n  render() {\n    if (this.isLoading || this.ticket === '') {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"main-container\">\n          <ir-listing-header propertyId={this.propertyid} p={this.p} language={this.language}></ir-listing-header>\n          <section class=\"mt-2\">\n            <ir-booking-listing-table></ir-booking-listing-table>\n          </section>\n        </div>\n        <ir-drawer\n          style={{\n            '--ir-drawer-width': '80rem',\n            '--ir-drawer-background-color': '#F2F3F8',\n            '--ir-drawer-padding-left': '0',\n            '--ir-drawer-padding-top': '0',\n            '--ir-drawer-padding-bottom': '0',\n            '--ir-drawer-padding-right': '0',\n          }}\n          onDrawerHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.editBookingItem = null;\n          }}\n          withoutHeader\n          open={this.editBookingItem?.cause === 'edit'}\n        >\n          {this.editBookingItem?.booking && (\n            <ir-booking-details\n              hasPrint\n              hasReceipt\n              hasCloseButton\n              onCloseSidebar={() => (this.editBookingItem = null)}\n              is_from_front_desk\n              propertyid={this.propertyid as any}\n              hasRoomEdit\n              hasRoomDelete\n              bookingNumber={this.editBookingItem.booking?.booking_nbr.toString()}\n              ticket={this.ticket}\n              language={this.language}\n              hasRoomAdd\n            ></ir-booking-details>\n          )}\n        </ir-drawer>\n        <ir-guest-info-drawer\n          onGuestInfoDrawerClosed={() => {\n            this.editBookingItem = null;\n          }}\n          booking_nbr={this.editBookingItem?.booking?.booking_nbr}\n          email={this.editBookingItem?.booking?.guest.email}\n          language={this.language}\n          open={this.editBookingItem?.cause === 'guest'}\n        ></ir-guest-info-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n.daily-revenue__meta {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.daily-revenue__table {\n  flex: 1 1 0%;\n}\n\n/*sm*/\n@media (min-width: 768px) {\n  .daily-revenue__meta {\n    flex-direction: row;\n  }\n}\n","import Token from '@/models/Token';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { DailyPaymentFilter, FolioPayment, GroupedFolioPayment, SidebarOpenEvent } from './types';\nimport { v4 } from 'uuid';\nimport moment from 'moment';\nimport { PaymentEntries } from '../ir-booking-details/types';\n\n@Component({\n  tag: 'ir-daily-revenue',\n  styleUrl: 'ir-daily-revenue.css',\n  scoped: true,\n})\nexport class IrDailyRevenue {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isPageLoading: boolean;\n  @State() property_id: number;\n  @State() groupedPayment: GroupedFolioPayment;\n  @State() previousDateGroupedPayments: GroupedFolioPayment;\n  @State() isLoading: string;\n  @State() filters: DailyPaymentFilter = { date: moment().format('YYYY-MM-DD'), users: null };\n  @State() sideBarEvent: SidebarOpenEvent | null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private bookingService = new BookingService();\n  private paymentEntries: PaymentEntries;\n\n  @Event() preventPageLoad: EventEmitter<null>;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.tokenService.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  @Listen('revenueOpenSidebar')\n  handleOpenSidebar(e: CustomEvent<SidebarOpenEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = e.detail;\n  }\n  @Listen('fetchNewReports')\n  handleFetchNewReports(e: CustomEvent<DailyPaymentFilter>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.filters = { ...e.detail };\n    this.getPaymentReports();\n  }\n  @Listen('resetBookingEvt')\n  async handleResetBooking(e: CustomEvent) {\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    this.getPaymentReports(false, true);\n  }\n\n  private handleSidebarClose = (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = null;\n  };\n\n  private renderSidebarBody() {\n    if (!this.sideBarEvent) {\n      return;\n    }\n    switch (this.sideBarEvent.type) {\n      case 'booking':\n        return (\n          <ir-booking-details\n            slot=\"sidebar-body\"\n            hasPrint\n            hasReceipt\n            hasCloseButton\n            onCloseSidebar={this.handleSidebarClose}\n            is_from_front_desk\n            propertyid={this.property_id}\n            hasRoomEdit\n            hasRoomDelete\n            bookingNumber={this.sideBarEvent.payload.bookingNumber.toString()}\n            ticket={this.ticket}\n            language={this.language}\n            hasRoomAdd\n          ></ir-booking-details>\n        );\n      default:\n        return null;\n    }\n  }\n\n  private async initializeApp() {\n    this.isPageLoading = true;\n\n    try {\n      let propertyId = this.propertyid;\n      if (!propertyId && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n\n      this.property_id = propertyId;\n\n      const requests: Promise<any>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getPaymentReports(),\n        this.roomService.fetchLanguage(this.language),\n      ];\n      if (propertyId) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [setupEntries] = await Promise.all(requests);\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n  private groupPaymentsByName(payments: FolioPayment[]): GroupedFolioPayment {\n    const groupedPayment: GroupedFolioPayment = new Map();\n\n    for (const payment of payments) {\n      const key = `${payment.payTypeCode}_${payment.payMethodCode}`;\n      const p = groupedPayment.get(key) ?? [];\n      groupedPayment.set(key, [...p, payment]);\n    }\n    return new Map(\n      [...groupedPayment.entries()].sort(([a], [b]) => {\n        const aNum = Number(a);\n        const bNum = Number(b);\n        if (!isNaN(aNum) && !isNaN(bNum)) {\n          return aNum - bNum;\n        }\n        return a.localeCompare(b);\n      }),\n    );\n  }\n\n  private async getPaymentReports(isExportToExcel = false, excludeYesterday = false) {\n    try {\n      const getReportObj = (report): FolioPayment => {\n        return {\n          method: report.METHOD,\n          payTypeCode: report.PAY_TYPE_CODE,\n          payMethodCode: report.PAY_METHOD_CODE,\n          amount: report.AMOUNT,\n          date: report.DATE,\n          hour: report.HOUR,\n          minute: report.MINUTE,\n          user: report.USER,\n          currency: report.CURRENCY,\n          bookingNbr: report.BOOKING_NBR,\n          id: v4(),\n        };\n      };\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n\n      const requests = [\n        this.propertyService.getDailyRevenueReport({\n          date: this.filters.date,\n          property_id: this.property_id?.toString(),\n          is_export_to_excel: isExportToExcel,\n        }),\n      ];\n      if (!isExportToExcel && !excludeYesterday) {\n        requests.push(\n          this.propertyService.getDailyRevenueReport({\n            date: moment(this.filters.date, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD'),\n            property_id: this.property_id?.toString(),\n            is_export_to_excel: isExportToExcel,\n          }),\n        );\n      }\n\n      const results = await Promise.all(requests);\n      if (!isExportToExcel) {\n        if (results[0]) {\n          this.groupedPayment = this.groupPaymentsByName(results[0]?.map(getReportObj));\n        } else {\n          this.groupedPayment = new Map();\n        }\n        if (results[1]) this.previousDateGroupedPayments = this.groupPaymentsByName(results[1]?.map(getReportObj));\n      }\n    } catch (e) {\n      console.log(e);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Daily Revenue</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getPaymentReports(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <ir-revenue-summary\n            previousDateGroupedPayments={this.previousDateGroupedPayments}\n            groupedPayments={this.groupedPayment}\n            paymentEntries={this.paymentEntries}\n          ></ir-revenue-summary>\n          <div class=\"daily-revenue__meta\">\n            <ir-daily-revenue-filters isLoading={this.isLoading === 'filter'} payments={this.groupedPayment}></ir-daily-revenue-filters>\n            <ir-revenue-table filters={this.filters} class={'daily-revenue__table'} paymentEntries={this.paymentEntries} payments={this.groupedPayment}></ir-revenue-table>\n          </div>\n        </section>\n        <ir-sidebar\n          sidebarStyles={{\n            width: this.sideBarEvent?.type === 'booking' ? '80rem' : 'var(--sidebar-width,40rem)',\n            background: this.sideBarEvent?.type === 'booking' ? '#F2F3F8' : 'white',\n          }}\n          open={Boolean(this.sideBarEvent)}\n          showCloseButton={false}\n          onIrSidebarToggle={this.handleSidebarClose}\n        >\n          {this.renderSidebarBody()}\n        </ir-sidebar>\n      </Host>\n    );\n  }\n}\n",".page-title {\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-xl);\n  /* margin-bottom: 1rem; */\n}\n","import { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { departuresStore, initializeDeparturesStore, onDeparturesStoreChange, setDeparturesPage, setDeparturesPageSize, setDepartureTotal } from '@/stores/departures.store';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { RoomService } from '@/services/room.service';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { PaginationChangeEvent } from '../ir-pagination/ir-pagination';\nimport { CheckoutDialogCloseEvent, CheckoutRoomEvent } from '@/components';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-departures',\n  styleUrls: ['ir-departures.css'],\n  scoped: true,\n})\nexport class IrDepartures {\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() language: string = 'en';\n  @Prop() p: string;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n  @State() checkoutState: CheckoutRoomEvent = null;\n  @State() invoiceState: CheckoutRoomEvent = null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n    onDeparturesStoreChange('today', _ => {\n      this.getBookings();\n    });\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = departuresStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n  @Listen('resetExposedCancellationDueAmount')\n  async handleResetExposedCancellationDueAmount(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.getBookings();\n  }\n  private async init() {\n    try {\n      this.isPageLoading = true;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Missing credentials');\n      }\n      let propertyId = this.propertyid;\n\n      if (!propertyId) {\n        await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n      }\n      const [_, __, setupEntries] = await Promise.all([\n        calendar_data?.property ? Promise.resolve(null) : this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getBookings(),\n      ]);\n\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getBookings() {\n    const { bookings, total_count } = await this.bookingService.getRoomsToCheckout({\n      property_id: calendar_data.property?.id?.toString() || this.propertyid?.toString(),\n      check_out_date: departuresStore.today,\n      page_index: departuresStore.pagination.currentPage,\n      page_size: departuresStore.pagination.pageSize,\n    });\n    setDepartureTotal(total_count ?? 0);\n    initializeDeparturesStore(bookings);\n  }\n  private handleCheckoutRoom(event: CustomEvent<CheckoutRoomEvent>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.checkoutState = event.detail;\n  }\n  private async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPage = event.detail?.currentPage ?? 1;\n    if (nextPage === departuresStore.pagination.currentPage) {\n      return;\n    }\n    setDeparturesPage(nextPage);\n    await this.getBookings();\n  }\n\n  private async handleCheckoutDialogClosed(event: CustomEvent<CheckoutDialogCloseEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const state = { ...this.checkoutState };\n    this.checkoutState = null;\n    switch (event.detail.reason) {\n      case 'checkout':\n        await this.getBookings();\n        break;\n      case 'openInvoice':\n        this.invoiceState = { ...state };\n        await this.getBookings();\n        break;\n    }\n  }\n\n  private async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPageSize = event.detail?.pageSize;\n    if (!Number.isFinite(nextPageSize)) {\n      return;\n    }\n    const normalizedPageSize = Math.floor(Number(nextPageSize));\n    if (normalizedPageSize === departuresStore.pagination.pageSize) {\n      return;\n    }\n    setDeparturesPageSize(normalizedPageSize);\n    await this.getBookings();\n  }\n  private handleInvoiceClose(event: CustomEvent<void>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.invoiceState = null;\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor handledEndpoints={['/Get_Rooms_To_Check_Out']}></ir-interceptor>\n        <div class={'ir-page__container'}>\n          <h3 class=\"page-title\">Departures</h3>\n          {/* <ir-departures-filter></ir-departures-filter> */}\n          <ir-departures-table\n            onCheckoutRoom={event => this.handleCheckoutRoom(event as CustomEvent<CheckoutRoomEvent>)}\n            onRequestPageChange={event => this.handlePaginationChange(event as CustomEvent<PaginationChangeEvent>)}\n            onRequestPageSizeChange={event => this.handlePaginationPageSizeChange(event as CustomEvent<PaginationChangeEvent>)}\n          ></ir-departures-table>\n        </div>\n        <ir-drawer\n          onDrawerHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.bookingNumber = null;\n          }}\n          withoutHeader\n          open={!!this.bookingNumber}\n          style={{\n            '--ir-drawer-width': '80rem',\n            '--ir-drawer-background-color': '#F2F3F8',\n            '--ir-drawer-padding-left': '0',\n            '--ir-drawer-padding-right': '0',\n            '--ir-drawer-padding-top': '0',\n            '--ir-drawer-padding-bottom': '0',\n          }}\n        >\n          {this.bookingNumber && (\n            <ir-booking-details\n              hasPrint\n              hasReceipt\n              hasCloseButton\n              onCloseSidebar={() => (this.bookingNumber = null)}\n              is_from_front_desk\n              propertyid={this.propertyid as any}\n              hasRoomEdit\n              hasRoomDelete\n              bookingNumber={this.bookingNumber.toString()}\n              ticket={this.ticket}\n              language={this.language}\n              hasRoomAdd\n            ></ir-booking-details>\n          )}\n        </ir-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n        <ir-checkout-dialog\n          booking={this.checkoutState?.booking}\n          identifier={this.checkoutState?.identifier}\n          open={this.checkoutState !== null}\n          onCheckoutDialogClosed={event => this.handleCheckoutDialogClosed(event as CustomEvent<CheckoutDialogCloseEvent>)}\n        ></ir-checkout-dialog>\n        <ir-invoice\n          onInvoiceClose={event => this.handleInvoiceClose(event as CustomEvent<void>)}\n          booking={this.invoiceState?.booking}\n          roomIdentifier={this.invoiceState?.identifier}\n          open={this.invoiceState !== null}\n        ></ir-invoice>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  box-sizing: border-box;\n}\n:host * {\n  box-sizing: border-box;\n}\n\n@media only screen and (min-width: 900px) {\n  /* td {\n    min-width: 140px !important;\n    width: max-content !important;\n  } */\n}\n@media only screen and (max-width: 900px) {\n  /* td {\n    min-width: 100px !important;\n  } */\n  /* .table-container {\n    width: max-content !important;\n  } */\n}\n/*sm*/\n@media (min-width: 640px) {\n}\n\n/*md*/\n@media (min-width: 768px) {\n}\n\n.tasks-view {\n  display: flex;\n  flex-direction: column;\n}\n/*lg*/\n@media (min-width: 1024px) {\n  .tasks-view {\n    flex-direction: row;\n  }\n}\n\n/*xl*/\n@media (min-width: 1280px) {\n}\n\n/*2xl*/\n@media (min-width: 1536px) {\n}\n","import { CleanTaskEvent, IPendingActions } from '@/models/housekeeping';\nimport Token from '@/models/Token';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport housekeeping_store from '@/stores/housekeeping.store';\n// import { isRequestPending } from '@/stores/ir-interceptor.store';\nimport locales from '@/stores/locales.store';\nimport { Component, Host, Prop, State, h, Element, Watch, Event, EventEmitter, Listen } from '@stencil/core';\nimport moment from 'moment';\nimport { v4 } from 'uuid';\nimport { TaskFilters } from './types';\nimport { downloadFile } from '@/utils/utils';\nimport { updateTasks as updateTasksStore, updateSelectedTasks, clearSelectedTasks, hkTasksStore, setLoading } from '@/stores/hk-tasks.store';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-hk-tasks',\n  styleUrl: 'ir-hk-tasks.css',\n  scoped: true,\n})\nexport class IrHkTasks {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n\n  @State() isLoading = false;\n  @State() isCleaningLoading = false;\n  @State() selectedDuration = '';\n  @State() selectedHouseKeeper = '0';\n  @State() selectedRoom: IPendingActions | null = null;\n  @State() archiveOpened = false;\n  @State() property_id: number;\n  @State() isSidebarOpen: boolean;\n  @State() isApplyFiltersLoading: boolean;\n  @State() filters: TaskFilters;\n  @State() modalCauses: CleanTaskEvent & { cause: 'skip' | 'clean' };\n\n  @Event({ bubbles: true, composed: true }) clearSelectedHkTasks: EventEmitter<void>;\n\n  private hkNameCache: Record<number, string> = {};\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n  private token = new Token();\n  private table_sorting: Map<string, 'ASC' | 'DESC'> = new Map();\n  private modal: HTMLIrModalElement;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket !== '') {\n      this.token.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.init();\n  }\n\n  @Listen('closeSideBar')\n  handleCloseSidebar(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.isSidebarOpen = false;\n  }\n  @Listen('sortingChanged')\n  handleSortingChanged(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { field, direction } = e.detail;\n    console.log(e.detail);\n    if (field === 'date') {\n      return;\n    }\n    this.table_sorting.set(field, direction);\n  }\n  @Listen('skipSelectedTask')\n  handleSkipSelectedTask(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalCauses = { task: e.detail, cause: 'skip' };\n    this.modal?.openModal();\n  }\n\n  private async init() {\n    try {\n      this.isLoading = true;\n      setLoading(true);\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.houseKeepingService.getExposedHKSetup(this.property_id), this.roomService.fetchLanguage(this.language)];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      const tasksResult = await this.houseKeepingService.getHkTasks({\n        property_id: this.property_id,\n        from_date: moment().format('YYYY-MM-DD'),\n        to_date: moment().format('YYYY-MM-DD'),\n        housekeepers: [],\n        cleaning_frequency: (calendar_data.cleaning_frequency ?? housekeeping_store?.hk_criteria?.cleaning_frequencies[0])?.code,\n        dusty_window: housekeeping_store?.hk_criteria?.dusty_periods[0]?.code,\n        highlight_window: housekeeping_store?.hk_criteria?.highlight_checkin_options[0]?.code,\n      });\n\n      // updateTaskList();\n      if (tasksResult?.tasks) {\n        this.updateTasks(tasksResult.tasks);\n      }\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n      setLoading(false);\n    }\n  }\n\n  private buildHousekeeperNameCache() {\n    this.hkNameCache = {};\n    housekeeping_store.hk_criteria?.housekeepers?.forEach(hk => {\n      if (hk.id != null && hk.name != null) {\n        this.hkNameCache[hk.id] = hk.name;\n      }\n    });\n  }\n\n  private updateTasks(tasks: any[]) {\n    this.buildHousekeeperNameCache();\n    updateTasksStore(\n      tasks.map(t => ({\n        ...t,\n        id: v4(),\n        housekeeper: (() => {\n          const name = this.hkNameCache[t.hkm_id];\n          if (name) {\n            return name;\n          }\n          const hkName = housekeeping_store.hk_criteria?.housekeepers?.find(hk => hk.id === t.hkm_id)?.name;\n          this.hkNameCache[t.hkm_id] = hkName;\n          return hkName;\n        })(),\n      })),\n    );\n  }\n  @Listen('headerButtonPress')\n  async handleHeaderButtonPress(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { name } = e.detail;\n    switch (name) {\n      case 'cleaned':\n      case 'clean-inspect':\n        this.modal?.openModal();\n        this.modalCauses = {\n          task: null,\n          cause: 'clean',\n          status: name === 'clean-inspect' ? '004' : '001',\n        };\n        break;\n      case 'export':\n        const sortingArray: { key: string; value: string }[] = Array.from(this.table_sorting.entries()).map(([key, value]) => ({\n          key,\n          value,\n        }));\n        console.log(sortingArray);\n        const { url } = await this.fetchTasksWithFilters(true);\n        downloadFile(url);\n        break;\n      case 'archive':\n        this.isSidebarOpen = true;\n        break;\n    }\n  }\n  @Listen('cleanSelectedTask')\n  handleSelectedTaskCleaningEvent(e: CustomEvent<CleanTaskEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalCauses = { ...e.detail, cause: 'clean' };\n    this.modal?.openModal();\n  }\n\n  private async handleModalConfirmation(e: CustomEvent) {\n    try {\n      e.stopImmediatePropagation();\n      e.stopPropagation();\n      if (hkTasksStore.selectedTasks.length === 0) {\n        return;\n      }\n      this.isCleaningLoading = true;\n      if (this.modalCauses?.cause === 'skip') {\n        const { booking_nbr, date, unit } = this.modalCauses.task;\n        await this.houseKeepingService.editHkSkip({\n          BOOK_NBR: booking_nbr,\n          DATE: date,\n          COMMENT: '',\n          HK_SKIP_ID: -1,\n          HK_SKIP_REASON_CODE: '001',\n          PR_ID: unit.id,\n        });\n      } else {\n        await this.houseKeepingService.executeHKAction({\n          actions: hkTasksStore.selectedTasks.map(t => ({\n            description: 'Cleaned',\n            hkm_id: t.hkm_id === 0 ? null : t.hkm_id,\n            unit_id: t.unit.id,\n            booking_nbr: t.booking_nbr,\n            status: this.modalCauses?.status ?? '001',\n          })),\n        });\n      }\n      await this.fetchTasksWithFilters();\n    } finally {\n      clearSelectedTasks();\n      if (this.modalCauses) {\n        this.modalCauses = null;\n      }\n      this.isCleaningLoading = false;\n      // this.clearSelectedTasks.emit();\n      this.modal.closeModal();\n    }\n  }\n\n  private async applyFilters(e: CustomEvent) {\n    try {\n      this.isApplyFiltersLoading = true;\n      e.stopImmediatePropagation();\n      e.stopPropagation();\n      this.filters = { ...e.detail };\n      await this.fetchTasksWithFilters();\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isApplyFiltersLoading = false;\n    }\n  }\n\n  private async fetchTasksWithFilters(export_to_excel: boolean = false) {\n    const { cleaning_periods, housekeepers, cleaning_frequencies, dusty_units, highlight_check_ins } = this.filters ?? {};\n\n    const { tasks, url } = await this.houseKeepingService.getHkTasks({\n      housekeepers,\n      cleaning_frequency: cleaning_frequencies?.code,\n      dusty_window: dusty_units?.code,\n      highlight_window: highlight_check_ins?.code,\n      property_id: this.property_id,\n      from_date: moment().format('YYYY-MM-DD'),\n      to_date: cleaning_periods?.code || moment().format('YYYY-MM-DD'),\n      is_export_to_excel: export_to_excel,\n    });\n    console.log(tasks);\n    if (tasks) {\n      this.updateTasks(tasks);\n    }\n    return { tasks, url };\n  }\n\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host data-testid=\"hk_tasks_base\">\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-1 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <h3>Housekeeping Tasks</h3>\n          <div class=\"tasks-view \" style={{ gap: '1rem' }}>\n            <ir-tasks-filters\n              isLoading={this.isApplyFiltersLoading}\n              onApplyFilters={e => {\n                this.applyFilters(e);\n              }}\n            ></ir-tasks-filters>\n            <div class=\"d-flex w-100 flex-column\" style={{ gap: '1rem' }}>\n              <ir-tasks-table\n                onRowSelectChange={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  updateSelectedTasks(e.detail);\n                }}\n                class=\"flex-grow-1 w-100\"\n              ></ir-tasks-table>\n              {/* <ir-tasks-table-pagination></ir-tasks-table-pagination> */}\n            </div>\n          </div>\n        </section>\n        <ir-modal\n          autoClose={false}\n          ref={el => (this.modal = el)}\n          isLoading={this.isCleaningLoading}\n          onConfirmModal={this.handleModalConfirmation.bind(this)}\n          onCancelModal={() => {\n            if (this.modalCauses) {\n              clearSelectedTasks();\n              this.modalCauses = null;\n            }\n          }}\n          iconAvailable={true}\n          icon=\"ft-alert-triangle danger h1\"\n          leftBtnText={locales.entries.Lcz_Cancel}\n          rightBtnText={locales.entries.Lcz_Confirm}\n          leftBtnColor=\"secondary\"\n          rightBtnColor={'primary'}\n          modalTitle={locales.entries.Lcz_Confirmation}\n          modalBody={\n            this.modalCauses\n              ? this.modalCauses?.cause === 'clean'\n                ? this.modalCauses.task\n                  ? `Update ${this.modalCauses?.task?.unit?.name} to Clean`\n                  : 'Update selected unit(s) to Clean'\n                : 'Skip cleaning and reschedule for tomorrow.'\n              : 'Update selected unit(s) to Clean'\n          }\n        ></ir-modal>\n        <ir-sidebar\n          open={this.isSidebarOpen}\n          id=\"editGuestInfo\"\n          onIrSidebarToggle={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.isSidebarOpen = false;\n          }}\n          // sidebarStyles={{\n          //   width: '80vw',\n          // }}\n          showCloseButton={false}\n        >\n          {this.isSidebarOpen && <ir-hk-archive ticket={this.token.getToken()} propertyId={this.property_id} slot=\"sidebar-body\"></ir-hk-archive>}\n        </ir-sidebar>\n        {/* <ir-title class=\"d-none d-md-flex\" label={locales.entries.Lcz_HousekeepingTasks} justifyContent=\"space-between\">\n            <ir-button slot=\"title-body\" text={locales.entries.Lcz_Archive} size=\"sm\"></ir-button>\n          </ir-title> */}\n      </Host>\n    );\n  }\n}\n",":host {\r\n  display: block;\r\n}\r\n","import Token from '@/models/Token';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport calendar_data from '@/stores/calendar-data';\nimport housekeeping_store, { updateHKStore } from '@/stores/housekeeping.store';\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport locales from '@/stores/locales.store';\nimport { PropertyService } from '@/services/property.service';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n@Component({\n  tag: 'ir-housekeeping',\n  styleUrl: 'ir-housekeeping.css',\n  scoped: true,\n})\nexport class IrHousekeeping {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n\n  @State() isLoading = false;\n\n  @Event() toast: EventEmitter<IToast>;\n\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n  private propertyService = new PropertyService();\n  private token = new Token();\n  modal: HTMLIrModalElement;\n  selectedCleaningFrequency: any;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket !== '') {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.houseKeepingService.getExposedHKSetup(this.propertyid);\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  async initializeApp() {\n    try {\n      this.isLoading = true;\n      let propertyId = this.propertyid;\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_sales_rate_plans: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n      updateHKStore('default_properties', { token: this.ticket, property_id: propertyId, language: this.language });\n      const requests: Array<Promise<any>> = [];\n      if (calendar_data.housekeeping_enabled) {\n        requests.push(this.houseKeepingService.getExposedHKSetup(propertyId));\n      }\n      requests.push(this.roomService.fetchLanguage(this.language, ['_HK_FRONT', '_PMS_FRONT']));\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_sales_rate_plans: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      this.selectedCleaningFrequency = calendar_data.cleaning_frequency?.code;\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  private async saveAutomaticCheckInCheckout(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.roomService.SetAutomaticCheckInOut({\n        property_id: housekeeping_store.default_properties.property_id,\n        flag: e.detail === 'auto',\n      });\n      this.toast.emit({\n        position: 'top-right',\n        title: 'Saved Successfully',\n        description: '',\n        type: 'success',\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  private async saveCleaningFrequency(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.propertyService.setExposedCleaningFrequency({\n        property_id: housekeeping_store.default_properties.property_id,\n        code: this.selectedCleaningFrequency,\n      });\n      calendar_data.cleaning_frequency = { code: this.selectedCleaningFrequency, description: '' };\n      this.toast.emit({\n        position: 'top-right',\n        title: 'Saved Successfully',\n        description: '',\n        type: 'success',\n      });\n      this.modal.closeModal();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    console.log(calendar_data.cleaning_frequency);\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <section class=\"p-1\">\n          <h3 class=\"mb-2\">{locales.entries.Lcz_HouseKeepingAndCheckInSetup}</h3>\n          <div class=\"card p-1\">\n            <ir-title borderShown label=\"Operations Settings\"></ir-title>\n            <div class={'d-flex align-items-center mb-1'}>\n              <p class=\"my-0 py-0 mr-1\">{locales.entries.Lcz_CheckInOutGuestsAutomatically}</p>\n              <ir-select\n                showFirstOption={false}\n                selectedValue={calendar_data.is_automatic_check_in_out ? 'auto' : 'manual'}\n                onSelectChange={e => this.saveAutomaticCheckInCheckout(e)}\n                data={[\n                  { text: locales.entries.Lcz_YesAsPerPropertyPolicy, value: 'auto' },\n                  { text: locales.entries.Lcz_NoIWillDoItManually, value: 'manual' },\n                ]}\n              ></ir-select>\n            </div>\n            <div class={'d-flex align-items-center'}>\n              <p class=\"my-0 py-0 mr-1\">{locales.entries.Lcz_CleaningFrequency}:</p>\n              <ir-select\n                showFirstOption={false}\n                selectedValue={this.selectedCleaningFrequency}\n                onSelectChange={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  this.selectedCleaningFrequency = e.detail;\n                  this.modal.openModal();\n                }}\n                data={housekeeping_store?.hk_criteria?.cleaning_frequencies.map(v => ({\n                  text: v.description,\n                  value: v.code,\n                }))}\n              ></ir-select>\n            </div>\n          </div>\n          {/*<ir-unit-status class=\"mb-1\"></ir-unit-status>*/}\n          {calendar_data.housekeeping_enabled && <ir-hk-team class=\"mb-1\"></ir-hk-team>}\n          <ir-modal\n            autoClose={false}\n            ref={el => (this.modal = el)}\n            isLoading={isRequestPending('/Set_Exposed_Cleaning_Frequency')}\n            onConfirmModal={this.saveCleaningFrequency.bind(this)}\n            iconAvailable={true}\n            onCancelModal={() => {\n              this.selectedCleaningFrequency = calendar_data.cleaning_frequency?.code;\n            }}\n            icon=\"ft-alert-triangle danger h1\"\n            leftBtnText={locales.entries.Lcz_Cancel}\n            rightBtnText={locales.entries.Lcz_Confirm}\n            leftBtnColor=\"secondary\"\n            rightBtnColor={'primary'}\n            modalTitle={locales.entries.Lcz_Confirmation}\n            modalBody={'This action will reschedule all cleaning tasks. Do you want to continue?'}\n          ></ir-modal>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { DailyReport, DailyReportFilter } from './types';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { RoomService } from '@/services/room.service';\nimport { DailyStat, MonthlyStatsResults, PropertyService } from '@/services/property.service';\n\n@Component({\n  tag: 'ir-monthly-bookings-report',\n  styleUrl: 'ir-monthly-bookings-report.css',\n  scoped: true,\n})\nexport class IrMonthlyBookingsReport {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isPageLoading = true;\n  @State() isLoading: 'export' | 'filter' | null = null;\n\n  @State() reports: DailyReport[] = [];\n  @State() filters: DailyReportFilter;\n  @State() property_id: number;\n  @State() stats: Omit<MonthlyStatsResults, 'DailyStats'>;\n\n  private baseFilters: DailyReportFilter;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n\n  componentWillLoad() {\n    this.baseFilters = {\n      date: {\n        description: moment().format('MMMM YYYY'),\n        firstOfMonth: moment().startOf('month').format('YYYY-MM-DD'),\n        lastOfMonth: moment().endOf('month').format('YYYY-MM-DD'),\n      },\n      include_previous_year: false,\n    };\n    this.filters = this.baseFilters;\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Listen('applyFilters')\n  handleApplyFiltersChange(e: CustomEvent<DailyReportFilter>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.filters = e.detail;\n    this.getReports();\n  }\n\n  private async init() {\n    try {\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.roomService.fetchLanguage(this.language), this.getReports()];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getReports(isExportToExcel = false) {\n    try {\n      const getReportObj = (report: DailyStat): DailyReport => {\n        return {\n          day: report.Date,\n          units_booked: report.Units_booked,\n          occupancy_percent: report.Occupancy,\n          adr: report.ADR,\n          rooms_revenue: report.Rooms_Revenue,\n          total_guests: report?.Total_Guests,\n        };\n      };\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n      const { date, include_previous_year } = this.filters;\n\n      const requests = [\n        this.propertyService.getMonthlyStats({\n          from_date: date.firstOfMonth,\n          to_date: date.lastOfMonth,\n          property_id: this.property_id,\n          is_export_to_excel: isExportToExcel,\n        }),\n      ];\n\n      if (include_previous_year) {\n        requests.push(\n          this.propertyService.getMonthlyStats({\n            from_date: moment(date.firstOfMonth, 'YYYY-MM-DD').add(-1, 'year').format('YYYY-MM-DD'),\n            to_date: moment(date.lastOfMonth, 'YYYY-MM-DD').add(-1, 'years').format('YYYY-MM-DD'),\n            property_id: this.property_id,\n          }),\n        );\n      }\n\n      const results = await Promise.all(requests);\n      const currentReports = results[0];\n      let enrichedReports: DailyReport[] = [];\n      const { DailyStats, ...rest } = currentReports;\n\n      this.stats = { ...rest };\n\n      if (include_previous_year && results[isExportToExcel ? 0 : 1]) {\n        const previousYearReports = results[isExportToExcel ? 0 : 1];\n        let formattedReports = previousYearReports.DailyStats.map(getReportObj);\n        enrichedReports = DailyStats.map(getReportObj).map(current => {\n          const previous = formattedReports.find(prev => prev.day === moment(current.day, 'YYYY-MM-DD').add(-1, 'years').format('YYYY-MM-DD'));\n          return {\n            ...current,\n            last_year: previous ?? null,\n          };\n        });\n      } else {\n        enrichedReports = DailyStats.map(getReportObj);\n      }\n      this.reports = [...enrichedReports];\n    } catch (e) {\n      console.log(e);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Daily Occupancy</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getReports(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <section>\n            <div class=\"d-flex flex-column flex-md-row w-100\" style={{ gap: '1rem', alignItems: 'stretch' }}>\n              <ir-stats-card\n                icon={this.stats?.Occupancy_Difference_From_Previous_Month < 0 ? 'arrow-trend-down' : 'arrow-trend-up'}\n                cardTitle=\"Average Occupancy\"\n                value={this.stats.AverageOccupancy ? this.stats?.AverageOccupancy.toFixed(2) + '%' : null}\n                subtitle={`${this.stats?.Occupancy_Difference_From_Previous_Month < 0 ? '' : '+'}${this.stats?.Occupancy_Difference_From_Previous_Month.toFixed(\n                  2,\n                )}% from last month`}\n              ></ir-stats-card>\n\n              <ir-stats-card\n                icon=\"hotel\"\n                cardTitle=\"Total Units\"\n                value={this.stats?.TotalUnitsBooked ? this.stats?.TotalUnitsBooked.toString() : null}\n                subtitle=\"Booked\"\n              ></ir-stats-card>\n\n              <ir-stats-card icon=\"user_group\" cardTitle=\"Total Guests\" value={this.stats?.Total_Guests?.toString()} subtitle=\"Stayed\"></ir-stats-card>\n\n              <ir-stats-card\n                icon=\"calendar\"\n                cardTitle=\"Peak Days\"\n                value={this.stats?.PeakDays.length === 0 ? null : this.stats?.PeakDays?.map(pd => moment(pd.Date, 'YYYY-MM-DD').format('D').concat('th')).join(' - ')}\n                subtitle={`${Math.max(...(this.stats.PeakDays?.map(pd => pd.OccupancyPercent) || []))}% occupancy`}\n              ></ir-stats-card>\n            </div>\n            <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n              <ir-monthly-bookings-report-filter isLoading={this.isLoading === 'filter'} class=\"filters-card\" baseFilters={this.baseFilters}></ir-monthly-bookings-report-filter>\n              <ir-monthly-bookings-report-table reports={this.reports}></ir-monthly-bookings-report-table>\n            </div>\n          </section>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport Token from '@/models/Token';\nimport { AllowedProperties, PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport moment from 'moment';\nimport { ChannelReport, ChannelReportResult, ChannelSaleFilter, SalesByChannelMode } from './types';\n@Component({\n  tag: 'ir-sales-by-channel',\n  styleUrl: 'ir-sales-by-channel.css',\n  scoped: true,\n})\nexport class IrSalesByChannel {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: string;\n  @Prop() p: string;\n  @Prop() mode!: SalesByChannelMode;\n\n  @State() isLoading: 'filter' | 'export' | null = null;\n  @State() isPageLoading = true;\n\n  @State() salesData: ChannelReportResult;\n  @State() channelSalesFilters: ChannelSaleFilter;\n  @State() allowedProperties: AllowedProperties = [];\n  @State() propertyID: number;\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n\n  private baseFilters: ChannelSaleFilter = {\n    FROM_DATE: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    TO_DATE: moment().format('YYYY-MM-DD'),\n    BOOK_CASE: '001',\n    WINDOW: 7,\n    include_previous_year: false,\n    is_export_to_excel: false,\n  };\n\n  componentWillLoad() {\n    this.channelSalesFilters = this.baseFilters;\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  private async initializeApp() {\n    try {\n      if (!this.mode) {\n        throw new Error(\"Missing required 'mode'. Please set it to either 'property' or 'mpo'.\");\n      }\n      if (!this.propertyid && this.mode === 'property' && !this.p) {\n        throw new Error('Missing Property ID or aname');\n      }\n      if (this.mode === 'property') {\n        const property = await this.propertyService.getExposedProperty({\n          id: Number(this.propertyid ?? 0),\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n        this.propertyID = property.My_Result.id;\n      }\n      const requests: Promise<unknown>[] = [, this.roomService.fetchLanguage(this.language)];\n      if (this.mode === 'mpo') {\n        requests.unshift(this.propertyService.getExposedAllowedProperties());\n        const [properties] = await Promise.all(requests);\n        this.allowedProperties = [...(properties as any)];\n      }\n\n      this.baseFilters = { ...this.baseFilters, LIST_AC_ID: this.allowedProperties?.map(p => p.id) };\n      this.channelSalesFilters = { ...this.baseFilters };\n\n      await this.getChannelSales();\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getChannelSales(isExportToExcel = false) {\n    try {\n      const { include_previous_year, LIST_AC_ID, ...filterParams } = this.channelSalesFilters;\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n      const currentSales = await this.propertyService.getChannelSales({\n        is_export_to_excel: isExportToExcel,\n        ...filterParams,\n        AC_ID: this.propertyID ? this.propertyID.toString() : undefined,\n        ...filterParams,\n        LIST_AC_ID: this.propertyID ? null : LIST_AC_ID,\n      });\n      const shouldFetchPreviousYear = !isExportToExcel && include_previous_year;\n      let enrichedSales: ChannelReportResult = [];\n      if (shouldFetchPreviousYear) {\n        const previousYearSales = await this.propertyService.getChannelSales({\n          AC_ID: this.propertyID ? this.propertyID.toString() : undefined,\n          ...filterParams,\n          LIST_AC_ID: this.propertyID ? null : LIST_AC_ID,\n          FROM_DATE: moment(filterParams.FROM_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n          TO_DATE: moment(filterParams.TO_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n        });\n\n        enrichedSales = currentSales.map(current => {\n          const previous = previousYearSales.find(prev => prev.SOURCE.toLowerCase() === current.SOURCE.toLowerCase());\n          return {\n            ...current,\n            last_year: previous ? previous : null,\n          };\n        });\n      } else {\n        enrichedSales = currentSales.map(record => ({\n          ...record,\n          last_year: null,\n        }));\n      }\n      /**\n       * Groups sales records by SOURCE and currency.id, summing numeric fields\n       * and recalculating PCT based on the total REVENUE.\n       */\n      const groupSalesRecordsBySource = (records: ChannelReportResult): ChannelReportResult => {\n        if (!records || records.length === 0) return records;\n\n        // Helper to extract currency ID from various possible formats\n        const getCurrencyId = (r: ChannelReport): string | null => {\n          return r?.currency ?? null;\n        };\n\n        // Create unique key for grouping\n        const createKey = (r: ChannelReport): string => {\n          const source = r.SOURCE.toString().toLowerCase().trim();\n          const currencyId = getCurrencyId(r);\n          return `${source}__${currencyId ?? 'null'}`;\n        };\n\n        // Sum two values safely\n        const sumValues = (a: number | undefined, b: number | undefined): number => {\n          return (a ?? 0) + (b ?? 0);\n        };\n\n        // Merge numeric fields from last_year objects\n        const mergeLastYear = (base: ChannelReport['last_year'], incoming: ChannelReport['last_year']): ChannelReport['last_year'] => {\n          if (!incoming) return base;\n          if (!base) return { ...incoming };\n\n          return {\n            NIGHTS: sumValues(base.NIGHTS, incoming.NIGHTS),\n            PCT: sumValues(base.PCT, incoming.PCT), // Will recalculate later\n            REVENUE: sumValues(base.REVENUE, incoming.REVENUE),\n            SOURCE: base.SOURCE,\n            PROPERTY_ID: base.PROPERTY_ID,\n            PROPERTY_NAME: base.PROPERTY_NAME,\n            currency: base.currency,\n          };\n        };\n\n        // Group records by key\n        const grouped = new Map<string, ChannelReport>();\n\n        for (const record of records) {\n          const key = createKey(record);\n          const existing = grouped.get(key);\n\n          if (!existing) {\n            // First record for this key - clone it\n            grouped.set(key, { ...record });\n          } else {\n            // Merge with existing record\n            const merged: ChannelReport = {\n              ...existing,\n              NIGHTS: sumValues(existing.NIGHTS, record.NIGHTS),\n              PCT: 0, // Will recalculate after summing all REVENUE\n              REVENUE: sumValues(existing.REVENUE, record.REVENUE),\n              last_year: mergeLastYear(existing.last_year, record.last_year),\n            };\n            grouped.set(key, merged);\n          }\n        }\n\n        // Convert to array\n        const result = Array.from(grouped.values());\n\n        // Recalculate PCT based on total REVENUE\n        const totalRevenue = result.reduce((sum, r) => sum + (r.REVENUE ?? 0), 0);\n\n        if (totalRevenue > 0) {\n          for (const record of result) {\n            record.PCT = (record.REVENUE / totalRevenue) * 100;\n\n            // Also recalculate last_year PCT if it exists\n            if (record.last_year) {\n              const lastYearTotal = result.reduce((sum, r) => sum + (r.last_year?.REVENUE ?? 0), 0);\n              if (lastYearTotal > 0) {\n                record.last_year.PCT = (record.last_year.REVENUE / lastYearTotal) * 100;\n              }\n            }\n          }\n        }\n\n        return result;\n      };\n\n      this.salesData = [...groupSalesRecordsBySource(enrichedSales)];\n    } catch (error) {\n      console.error('Failed to fetch sales data:', error);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Sales by Channel</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getChannelSales(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          {/* <ir-sales-by-country-summary salesReports={this.salesData}></ir-sales-by-country-summary> */}\n          <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n            <ir-sales-by-channel-filters\n              isLoading={this.isLoading === 'filter'}\n              onApplyFilters={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.channelSalesFilters = { ...e.detail };\n                this.getChannelSales();\n              }}\n              allowedProperties={this.allowedProperties}\n              baseFilters={this.baseFilters}\n            ></ir-sales-by-channel-filters>\n            <ir-sales-by-channel-table mode={this.mode} allowedProperties={this.allowedProperties} class=\"card mb-0\" records={this.salesData}></ir-sales-by-channel-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { BaseSalesRecord, CountrySalesFilter, MappedCountries, SalesRecord } from './types';\nimport moment from 'moment';\nimport { v4 } from 'uuid';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { ICountry } from '@/models/IBooking';\n\n@Component({\n  tag: 'ir-sales-by-country',\n  styleUrl: 'ir-sales-by-country.css',\n  scoped: true,\n})\nexport class IrSalesByCountry {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isLoading: 'filter' | 'export' | null = null;\n  @State() isPageLoading = true;\n  @State() property_id: number;\n  @State() salesData: SalesRecord[];\n  @State() salesFilters: CountrySalesFilter;\n  @State() countries: MappedCountries = new Map();\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private bookingService = new BookingService();\n\n  private baseFilters = {\n    FROM_DATE: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    TO_DATE: moment().format('YYYY-MM-DD'),\n    BOOK_CASE: '001',\n    WINDOW: 7,\n    include_previous_year: false,\n  };\n\n  componentWillLoad() {\n    this.salesFilters = this.baseFilters;\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n  private async initializeApp() {\n    try {\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.bookingService.getCountries(this.language), this.roomService.fetchLanguage(this.language), this.getCountrySales()];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [countries] = await Promise.all(requests);\n      const mappedCountries = new Map();\n      (countries as ICountry[]).map(country => {\n        mappedCountries.set(country.id, {\n          flag: country.flag,\n          name: country.name,\n        });\n      });\n      this.countries = mappedCountries;\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getCountrySales(isExportToExcel = false) {\n    const formatSalesData = (data): Omit<BaseSalesRecord, 'id'> => {\n      return {\n        country: data.COUNTRY,\n        country_id: data.COUNTRY_ID,\n        nights: data.NIGHTS,\n        percentage: data.PCT,\n        revenue: data.REVENUE,\n        number_of_guests: data.Total_Guests,\n      };\n    };\n    try {\n      const { include_previous_year, ...filterParams } = this.salesFilters;\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n\n      const currentSales = await this.propertyService.getCountrySales({\n        AC_ID: this.property_id,\n        is_export_to_excel: isExportToExcel,\n        ...filterParams,\n      });\n\n      const shouldFetchPreviousYear = !isExportToExcel && include_previous_year;\n\n      let enrichedSales: SalesRecord[] = [];\n\n      if (shouldFetchPreviousYear) {\n        const previousYearSales = await this.propertyService.getCountrySales({\n          AC_ID: this.property_id,\n          is_export_to_excel: false,\n          ...filterParams,\n          FROM_DATE: moment(filterParams.FROM_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n          TO_DATE: moment(filterParams.TO_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n        });\n\n        enrichedSales = currentSales.map(current => {\n          const previous = previousYearSales.find(prev => prev.COUNTRY.toLowerCase() === current.COUNTRY.toLowerCase());\n          return {\n            id: v4(),\n            ...formatSalesData(current),\n            last_year: previous ? formatSalesData(previous) : null,\n          };\n        });\n      } else {\n        enrichedSales = currentSales.map(record => ({\n          id: v4(),\n          ...formatSalesData(record),\n          last_year: null,\n        }));\n      }\n\n      // this.salesData = enrichedSales.sort((a, b) => {\n      //   if (a.country_id === 0) return -1;\n      //   if (b.country_id === 0) return 1;\n      //   return 0;\n      // });\n      this.salesData = [...enrichedSales];\n    } catch (error) {\n      console.error('Failed to fetch sales data:', error);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Sales by Country</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getCountrySales(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <ir-sales-by-country-summary salesReports={this.salesData}></ir-sales-by-country-summary>\n          <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n            <ir-sales-filters\n              isLoading={this.isLoading === 'filter'}\n              onApplyFilters={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.salesFilters = e.detail;\n                this.getCountrySales();\n              }}\n              class=\"filters-card\"\n              baseFilters={this.baseFilters}\n            ></ir-sales-filters>\n            <ir-sales-table mappedCountries={this.countries} class=\"card mb-0\" records={this.salesData}></ir-sales-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  height: 100%;\n}\n","import Token from '@/models/Token';\nimport { User } from '@/models/Users';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { RoomService } from '@/services/room.service';\nimport { UserService } from '@/services/user.service';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { AllowedUser } from './types';\nimport { bookingReasons } from '@/models/IBooking';\nimport { io, Socket } from 'socket.io-client';\nimport locales from '@/stores/locales.store';\n\n@Component({\n  tag: 'ir-user-management',\n  styleUrl: 'ir-user-management.css',\n  scoped: true,\n})\nexport class IrUserManagement {\n  @Prop() language: string = '';\n  @Prop() baseUrl: string;\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() isSuperAdmin: boolean = true;\n  @Prop() userTypeCode: string | number;\n  @Prop() baseUserTypeCode: string | number;\n  @Prop() userId: string | number;\n\n  @State() isLoading = true;\n  @State() users: User[] = [];\n  @State() property_id: number;\n  @State() allowedUsersTypes: AllowedUser[] = [];\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private userService = new UserService();\n  private bookingService = new BookingService();\n\n  private userTypes: Map<number | string, string> = new Map();\n  private socket: Socket;\n\n  private superAdminId = '5';\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchUsers();\n  }\n\n  private async initializeApp() {\n    try {\n      if (this.baseUrl) {\n        this.token.setBaseUrl(this.baseUrl);\n      }\n      this.isLoading = true;\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.fetchUserTypes(), this.fetchUsers(), this.roomService.fetchLanguage(this.language, ['_USER_MGT'])];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      this.socket = io('https://realtime.igloorooms.com/');\n      this.socket.on('MSG', async msg => {\n        await this.handleSocketMessage(msg);\n      });\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private async handleSocketMessage(msg: string) {\n    const msgAsObject = JSON.parse(msg);\n    if (!msgAsObject) {\n      return;\n    }\n\n    const { REASON, KEY, PAYLOAD }: { REASON: bookingReasons; KEY: any; PAYLOAD: any } = msgAsObject;\n\n    if (KEY.toString() !== this.property_id.toString()) {\n      return;\n    }\n\n    let result = JSON.parse(PAYLOAD);\n    console.log(KEY, result);\n    // const reasonHandlers: Partial<Record<bookingReasons, Function>> = {\n    //   DORESERVATION: this.updateUserVerificationStatus,\n    // };\n    const reasonHandlers: Partial<Record<bookingReasons, Function>> = {\n      EMAIL_VERIFIED: this.updateUserVerificationStatus,\n    };\n    const handler = reasonHandlers[REASON];\n    if (handler) {\n      await handler.call(this, result);\n    } else {\n      console.warn(`Unhandled REASON: ${REASON}`);\n    }\n  }\n\n  public updateUserVerificationStatus(result: { id: string | number }) {\n    const users = [...this.users];\n    const idx = users.findIndex(u => u.id === result.id);\n    if (idx === -1) {\n      console.warn(`User ${result.id} not found`);\n      return;\n    }\n    users[idx] = {\n      ...users[idx],\n      is_email_verified: true,\n    };\n    this.users = users;\n  }\n\n  private async fetchUsers() {\n    const users = await this.userService.getExposedPropertyUsers({ property_id: this.propertyid });\n    this.users = [...users].sort((u1: User, u2: User) => {\n      const priority = (u: User) => {\n        const t = u.type.toString();\n        if (t === this.superAdminId) return 0;\n        if (t === '17') return 1;\n        return 2;\n      };\n      //sort by priority\n      const p1 = priority(u1),\n        p2 = priority(u2);\n      if (p1 !== p2) {\n        return p1 - p2;\n      }\n      // //sort by user id\n      // if (p1 === 1) {\n      //   const id1 = u1.id.toString(),\n      //     id2 = u2.id.toString(),\n      //     me = this.userId.toString();\n      //   if (id1 === me) return -1; // u1 is me → goes before u2\n      //   if (id2 === me) return 1; // u2 is me → u1 goes after\n      // }\n\n      // 3) sort by username\n      return u1.username.localeCompare(u2.username);\n    });\n  }\n  private async fetchUserTypes() {\n    const res = await Promise.all([this.bookingService.getSetupEntriesByTableName('_USER_TYPE'), this.bookingService.getLov()]);\n    const allowedUsers = res[1]?.My_Result?.allowed_user_types;\n    for (const e of res[0]) {\n      const value = e[`CODE_VALUE_${this.language?.toUpperCase() ?? 'EN'}`];\n      if (allowedUsers.find(f => f.code === e.CODE_NAME)) {\n        this.allowedUsersTypes.push({ code: e.CODE_NAME, value });\n      }\n      this.userTypes.set(e.CODE_NAME.toString(), value);\n    }\n  }\n  disconnectedCallback() {\n    this.socket.disconnect();\n  }\n  render() {\n    if (this.isLoading) {\n      return (\n        <Host>\n          <ir-toast></ir-toast>\n          <ir-interceptor></ir-interceptor>\n          <ir-loading-screen></ir-loading-screen>\n        </Host>\n      );\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor suppressToastEndpoints={['/Change_User_Pwd', '/Handle_Exposed_User']}></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex  pb-2 align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">{locales.entries.Lcz_ExtranetUsers}</h3>\n          </div>\n\n          <div class=\"\" style={{ gap: '1rem' }}>\n            <ir-user-management-table\n              property_id={this.property_id}\n              baseUserTypeCode={this.baseUserTypeCode}\n              allowedUsersTypes={this.allowedUsersTypes}\n              userTypeCode={this.userTypeCode}\n              haveAdminPrivileges={[this.superAdminId, '17'].includes(this.userTypeCode?.toString())}\n              userTypes={this.userTypes}\n              class=\"card\"\n              isSuperAdmin={this.userTypeCode?.toString() === this.superAdminId}\n              users={this.users}\n            ></ir-user-management-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n"],"mappings":"y3BAAA,MAAMA,EAAgB,iNACtB,MAAAC,EAAeD,E,MCeFE,EAAU,M,yBAKbC,OAMAC,WAMAC,SAAmB,KAMnBC,EAOAC,SAAmB,GAElBC,cACAC,QACAC,eACAC,cACAC,QACAC,eAAoC,KACpCC,UAEDC,aAAe,IAAIC,EACnBC,YAAc,IAAIC,EAClBC,eAAiB,IAAIC,EAErBC,gBAER,iBAAAC,GACE,GAAIC,KAAKpB,OAAQ,CACfoB,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKE,M,CAEPC,EAAoBH,KAAKhB,UACzBoB,EAAsB,SAASC,IAC7BL,KAAKM,aAAa,G,CAKtB,oBAAAC,CAAqBC,EAAkBC,GACrC,GAAID,IAAaC,EAAUN,EAAoBK,E,CAIjD,kBAAAE,CAAmBF,EAAkBC,GACnC,GAAID,IAAaC,GAAYD,EAAU,CACrCR,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKE,M,EAKT,oBAAAS,CAAqBC,GACnBA,EAAEC,2BACFD,EAAEE,kBACF,MAAMC,YAAEA,EAAW1B,QAAEA,GAAYuB,EAAEI,OACnChB,KAAKd,QAAU+B,EAAcC,SAASC,MAAKC,GAAKA,EAAEL,cAAgBA,IAClE,MAAMM,EAAcrB,KAAKb,eAAemC,MAAMH,MAAKpC,GAAKA,EAAEwC,YAAclC,EAAQmC,aAAaC,OAC7FzB,KAAKX,QAAU,IACVA,EACHmC,aAAc,CACZC,KAAMJ,EAAYE,UAClBG,YAAaL,EAAYM,cACzBC,UAAWP,EAAYQ,QAG3B7B,KAAKF,gBAAgBgC,W,CAIvB,UAAAC,CAAWnB,GACTZ,KAAKf,cAAgB2B,EAAEI,M,CAGzB,6CAAMgB,CAAwCpB,GAC5CA,EAAEC,2BACFD,EAAEE,wBACId,KAAKM,a,CAEL,UAAMJ,GACZ,IACEF,KAAKZ,cAAgB,KAErB,IAAKY,KAAKnB,aAAemB,KAAKjB,EAAG,CAC/B,MAAM,IAAIkD,MAAM,sB,CAElB,IAAIC,EAAalC,KAAKnB,WAEtB,IAAKqD,EAAY,OACTlC,KAAKN,YAAYyC,mBAAmB,CACxCC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,M,CAIhB,MAAOjC,EAAGkC,EAAIhD,EAAWiD,SAAsBC,QAAQC,IAAI,CACzDC,GAAeC,SAAWH,QAAQI,QAAQ,MAAQ7C,KAAKN,YAAYyC,mBAAmB,CAAEC,GAAIpC,KAAKnB,YAAc,EAAGC,SAAUkB,KAAKlB,SAAUuD,MAAOrC,KAAKjB,IACvJiB,KAAKN,YAAYoD,cAAc9C,KAAKlB,UACpCkB,KAAKJ,eAAemD,aAAa/C,KAAKlB,UACtCkB,KAAKJ,eAAeoD,gCAAgC,CAAC,uBAAwB,kBAAmB,YAAa,kBAAmB,gBAChIhD,KAAKM,gBAEPN,KAAKT,UAAYA,EACjB,MAAM0D,SAAEA,EAAQC,eAAEA,EAAcC,WAAEA,GAAenD,KAAKJ,eAAewD,uBAAuBZ,GAE5FxC,KAAKb,eAAiB,CAAEmC,MAAO2B,EAAUI,OAAQH,EAAgBI,QAASH,E,CAC1E,MAAOI,G,SAEPvD,KAAKZ,cAAgB,K,EAIjB,iBAAMkB,GACZ,MAAMY,SAAEA,EAAQsC,YAAEA,SAAsBxD,KAAKJ,eAAe6D,kBAAkB,CAC5EC,YAAaf,EAAcC,SAASR,IAAIuB,YAAc3D,KAAKnB,YAAY8E,WACvEC,cAAe3C,EAAc4C,MAC7BC,WAAY7C,EAAc8C,WAAWC,YACrCC,UAAWhD,EAAc8C,WAAW/E,WAEtCkF,EAAiBV,GAAe,GAChCW,EAAwBjD,E,CAGlB,4BAAMkD,CAAuBC,GACnCA,EAAMxD,2BACNwD,EAAMvD,kBACN,MAAMwD,EAAWD,EAAMrD,QAAQgD,aAAe,EAC9C,GAAIM,IAAarD,EAAc8C,WAAWC,YAAa,CACrD,M,CAEFO,EAAgBD,SACVtE,KAAKM,a,CAGL,oCAAMkE,CAA+BH,GAC3CA,EAAMxD,2BACNwD,EAAMvD,kBACN,MAAM2D,EAAeJ,EAAMrD,QAAQhC,SACnC,IAAK0F,OAAOC,SAASF,GAAe,CAClC,M,CAEF,MAAMG,EAAqBC,KAAKC,MAAMJ,OAAOD,IAC7C,GAAIG,IAAuB3D,EAAc8C,WAAW/E,SAAU,CAC5D,M,CAEFmB,EAAoByE,SACd5E,KAAKM,a,CAEL,kBAAAyE,CAAmBV,GACzBA,EAAMxD,2BACNwD,EAAMvD,kBACNd,KAAKV,eAAiB+E,EAAMrD,M,CAQ9B,MAAAgE,GACE,GAAIhF,KAAKZ,cAAe,CACtB,OAAO6F,EAAA,yB,CAET,OACEA,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,kBAAgBE,iBAAkB,CAAC,4BACnCF,EAAA,OAAKG,MAAM,sBACTH,EAAA,MAAIG,MAAM,cAAY,YAEtBH,EAAA,qBACEI,cAAehB,GAASrE,KAAK+E,mBAAmBV,GAChDiB,oBAAqBjB,GAASrE,KAAKoE,uBAAuBC,GAC1DkB,wBAAyBlB,GAASrE,KAAKwE,+BAA+BH,KAExEY,EAAA,aACEO,aAAc5E,IACZA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKf,cAAgB,IAAI,EAE3BwG,cAAa,KACbC,OAAQ1F,KAAKf,cACb0G,MAAO,CACL,oBAAqB,QACrB,+BAAgC,UAChC,2BAA4B,IAC5B,0BAA2B,IAC3B,6BAA8B,IAC9B,4BAA6B,MAG9B3F,KAAKf,eACJgG,EAAA,sBACEW,SAAQ,KACRC,WAAU,KACVC,eAAc,KACdC,eAAgB,IAAO/F,KAAKf,cAAgB,KAC5C+G,mBAAkB,KAClBnH,WAAYmB,KAAKnB,WACjBoH,YAAW,KACXC,cAAa,KACbjH,cAAee,KAAKf,cAAc0E,WAClC/E,OAAQoB,KAAKpB,OACbE,SAAUkB,KAAKlB,SACfqH,WAAU,QAIhBlB,EAAA,oBACEU,MAAO,CAAES,OAAQ,QACjBnH,cAAee,KAAKd,SAAS6B,YAC7B5B,eAAgBa,KAAKb,eACrBE,QAASW,KAAKX,QACdgH,KAAM,iBACNC,IAAKC,GAAOvG,KAAKF,gBAAkByG,EACnCC,aAAc,KACZxG,KAAKd,QAAU,KACfc,KAAKX,QAAU,IAAI,IAGvB4F,EAAA,kBACES,KAAM1F,KAAKV,iBAAmB,KAC9BC,UAAWS,KAAKT,UAChBT,SAAUkB,KAAKlB,SACf2H,WAAYzG,KAAKV,gBAAgBmH,WACjCxH,cAAee,KAAKV,gBAAgByB,aAAa4C,WACjD+C,SAAU1G,KAAKV,gBAAgBoH,SAC/BC,YAAa3G,KAAKV,gBAAgBqH,YAClCC,cAAe5G,KAAKV,gBAAgBuH,gBACpCC,QAAS9G,KAAKV,gBAAgByH,QAC9BP,aAAc,IAAOxG,KAAKV,eAAiB,Q,2GC5QvD,MAAM0H,EAAwB,6CAC9B,MAAAC,EAAeD,E,MCQFE,EAAkB,M,yBACrBtI,OAECuI,KACAlI,cAEDmI,MAAQ,IAAI3H,EAEpB,iBAAAM,GACE,GAAIC,KAAKpB,OAAQ,CACfoB,KAAKoH,MAAMnH,SAASD,KAAKpB,O,EAK7B,kBAAA8B,GACE,GAAIV,KAAKpB,OAAQ,CACfoB,KAAKoH,MAAMnH,SAASD,KAAKpB,O,EAI7B,MAAAoG,GACE,OACEC,EAACC,EAAI,CAAAmC,IAAA,2CAACjC,MAAM,OACVH,EAAA,kBAAAoC,IAAA,2CAAgBlC,iBAAkB,CAAC,gCACnCF,EAAA,YAAAoC,IAAA,6CACApC,EAAA,OAAAoC,IAAA,2CAAKjC,MAAM,iCAAiCO,MAAO,CAAE2B,IAAK,WACxDrC,EAAA,iBAAAoC,IAAA,2CACEjC,MAAM,MACNmC,oBAAqB,CAAEC,OAAQ,KAC/BC,MAAOzH,KAAKf,cACZyI,aAAc9G,GAAMZ,KAAKf,cAAgB2B,EAAEI,OAC3C2G,YAAY,mBAEd1C,EAAA,aAAAoC,IAAA,2CACEO,KAAK,KACLC,KAAK,SACLC,eAAgBC,UACd,MAAMZ,KAAEA,SAAea,EAAMC,KAAK,6BAA8B,CAC9DC,SAAUlI,KAAKf,gBAEjB,GAAIkI,EAAKgB,aAAc,CACrB,M,CAEFnI,KAAKmH,KAAOA,EAAKiB,SAAS,KAIhCnD,EAAA,KAAAoC,IAAA,4CAAIgB,KAAKC,UAAUtI,KAAKmH,KAAM,KAAM,I,kFCG5BoB,IACd,MAAMC,EAAS,IAAIC,gBAAgBC,OAAOC,SAASC,QACnD,MAAMC,EAA8B,GACpC,IAAK,MAAOxB,EAAKI,KAAUe,EAAOM,UAAW,CAC3CD,EAAIxB,GAAOI,C,CAEb,OAAOoB,CACT,CCnEA,MAAME,GAAsB,sFAC5B,MAAAC,GAAeD,G,MC0BFE,GAAgB,M,iDAGnBnK,SAAmB,GACnBF,OAAiB,GACjBC,WACAqK,SAAmB,GACnBnK,EACAoK,QACAC,SAECC,UAAY,MACZC,gBAA+F,KAC/FC,SAAW,MACXpK,eACAE,QACAH,QAEDsK,sBAAwB,IAAIC,EAC5B7J,eAAiB,IAAIC,EACrBH,YAAc,IAAIC,EAClB+J,gBAAkB,IAAIC,EACtBvC,MAAQ,IAAI3H,EAEZmK,aACAC,oBACAC,kBACAC,cACAjK,gBAER,iBAAAC,GACE,GAAIC,KAAKmJ,QAAS,CAChBnJ,KAAKoH,MAAM4C,WAAWhK,KAAKmJ,Q,CAE7Bc,EAAoB,UAAWjK,KAAKkJ,UACpCgB,EAAgBhB,SAAWlJ,KAAKkJ,SAChCiB,EAAsBnK,KAAKkJ,UAC3B,GAAIlJ,KAAKpB,SAAW,GAAI,CACtBsL,EAAgB9C,MAAQpH,KAAKpB,OAC7BoB,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,CAEPC,EAAuB,iBAAiB7J,IACtC8J,EAA8B9J,EAAS,IAEzC6J,EAAuB,YAAY7J,IACjCR,KAAKuJ,SAAW/I,EAAS+J,MAAKrL,GAAWA,EAAQsL,UAAUC,aAAe,MAAQvL,EAAQsL,UAAUC,WAAa,GAAE,G,CAIvH,aAAAC,CAAclK,EAAkBC,GAC9B,GAAID,IAAaC,EAAU,CACzB,M,CAEFT,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBsL,EAAgB9C,MAAQpH,KAAKpB,OAC7BoB,KAAKoK,e,CAGC,mBAAMO,SACN3K,KAAKwJ,sBAAsBoB,mBAAmB,IAC/CV,EAAgBW,cACnBC,aAAc,O,CAIV,mBAAMV,GACZ,IACEpK,KAAKqJ,UAAY,KACjBrJ,KAAK+J,cAAgBgB,EAAiB/K,KAAKoJ,UAE3C,IAAIlH,EAAalC,KAAKnB,WACtB,IAAKmB,KAAK+J,cAAe,CACvB,IAAK/J,KAAKnB,aAAemB,KAAKjB,EAAG,CAC/B,MAAM,IAAIkD,MAAM,sC,CAGlB,IAAKC,EAAY,CACf,MAAM8I,QAAqBhL,KAAKN,YAAYyC,mBAAmB,CAC7DC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,OAEdJ,EAAa8I,EAAa5C,UAAUhG,E,EAIxC,MAAM6I,EAAuC,CAC3CjL,KAAKJ,eAAeoD,gCAAgC,CAAC,YAAa,kBAAmB,gBACrFhD,KAAKwJ,sBAAsB0B,2BAA2BlL,KAAK+J,cAAgB,KAAO7H,GAClFlC,KAAKN,YAAYoD,cAAc9C,KAAKlB,SAAU,CAAC,yBAIjD,IAAIqM,EAAwC,KAE5C,GAAInL,KAAKnB,aAAemB,KAAK+J,cAAe,CAE1CkB,EAAiBG,KACfpL,KAAKN,YAAYyC,mBAAmB,CAClCC,GAAIpC,KAAKnB,WACTC,SAAUkB,KAAKlB,SACfwD,WAAY,O,CAKlB,GAAItC,KAAK+J,cAAe,CACtBoB,EAAyBF,EAAiBI,OAC1CJ,EAAiBG,KAAKpL,KAAK0J,gBAAgB4B,8B,CAG7C,MAAMC,QAAgB9I,QAAQC,IAAIuI,GAElC,MAAOzI,GAAgB+I,EACvB,MAAMtI,SAAEA,EAAQC,eAAEA,EAAcC,WAAEA,GAAenD,KAAKJ,eAAewD,uBAAuBZ,GAE5FxC,KAAKb,eAAiB,CACpBkE,OAAQH,EACRI,QAASH,EACT7B,MAAO2B,GAGTjD,KAAK8J,kBAAoBqB,IAA2B,KAAQI,EAAQJ,IAA+CK,KAAIzM,GAAKA,EAAEqD,KAAM,KAEpI6H,EAAoB,cAAe/H,GAEnCuJ,EAAqB,CACnBC,aAAc1L,KAAK8J,kBACnB6B,aAAc3L,KAAKoJ,iBAGfpJ,KAAK2K,e,CACX,MAAOpH,GACPqI,QAAQrI,MAAM,0BAA2BA,E,SAEzCvD,KAAKqJ,UAAY,K,EAIrB,mBAAAwC,CAAoBjL,GAClB,GAAIA,EAAEI,OAAQ,CACZhB,KAAKsJ,gBAAkB,I,EAG3B,yBAAAwC,GAEE,MAAMtD,EAASD,IACf,GAAIC,EAAQ,CACVoD,QAAQG,IAAI,iBACZ,IAAIC,EAAsC,GAC1C,GAAIxD,EAAO5H,EAAG,CACZoL,EAAI,WAAatH,OAAO8D,EAAO5H,E,CAEjC,GAAI4H,EAAOyD,EAAG,CACZD,EAAI,aAAetH,OAAO8D,EAAOyD,E,CAEnC,GAAIzD,EAAO0D,OAAQ,CACjBF,EAAI,kBAAoBxD,EAAO0D,M,CAEjC,GAAI1D,EAAO2D,OAAQ,CACjBH,EAAI,eAAiBxD,EAAO2D,M,CAE9B,GAAI3D,EAAO4D,KAAM,CACfJ,EAAI,QAAUxD,EAAO4D,I,CAEvB,GAAI5D,EAAO6D,GAAI,CACbL,EAAI,MAAQxD,EAAO6D,E,CAErBZ,EAAqBO,E,CAEvBJ,QAAQG,IAAI,WAAYvD,E,CAE1B,SAAA8D,GACEtM,KAAK6J,oBAAsB0C,YAAW,KACpCvM,KAAK4J,aAAe5J,KAAKuG,GAAGiG,cAAc,oBAC1CxM,KAAK4J,aAAa6C,YAAczM,KAAKsJ,gBACrCtJ,KAAK4J,aAAa0C,WAAW,GAC5B,I,CAEL,oBAAAI,GACEC,aAAa3M,KAAK6J,oB,CAIpB,4BAAMzF,CAAuBC,GAC3BA,EAAMxD,2BACNwD,EAAMvD,kBACN,IAAKuD,EAAMrD,OAAQ,CACjB,M,CAEF4L,EAAkBvI,EAAMrD,OAAOgD,mBACzBhE,KAAK2K,e,CAIb,oCAAMnG,CAA+BH,GACnC,IAAKA,EAAMrD,SAAWqD,EAAMrD,OAAOhC,SAAU,CAC3C,M,CAEFqF,EAAMxD,2BACNwD,EAAMvD,kBACNqJ,EAAsB9F,EAAMrD,OAAOhC,gBAC7BgB,KAAK2K,e,CAIb,0BAAMkC,CAAqBjM,GACzBA,EAAEC,2BACFD,EAAEE,wBACId,KAAK2K,e,CAIb,oBAAAmC,CAAqBlM,GACnBA,EAAEC,2BACFD,EAAEE,kBACFoJ,EAAgBhJ,SAAW,IACtBgJ,EAAgBhJ,SAASsK,KAAIpK,IAC9B,GAAIA,EAAEL,cAAgBH,EAAEI,OAAOD,YAAa,CAC1C,OAAOH,EAAEI,M,CAEX,OAAOI,CAAC,I,CAKd,oBAAAT,CAAqBC,GACnBA,EAAEC,2BACFD,EAAEE,kBACF,MAAMC,YAAEA,EAAW1B,QAAEA,GAAYuB,EAAEI,OACnChB,KAAKd,QAAUc,KAAK+M,YAAYhM,GAChC,MAAMM,EAAcrB,KAAKb,eAAemC,MAAMH,MAAKpC,GAAKA,EAAEwC,YAAclC,EAAQmC,aAAaC,OAC7FzB,KAAKX,QAAU,IACVA,EACHmC,aAAc,CACZC,KAAMJ,EAAYE,UAClBG,YAAaL,EAAYM,cACzBC,UAAWP,EAAYQ,QAG3B7B,KAAKF,gBAAgBgC,W,CAGvB,sBAAAkL,CAAuBpM,GACrBA,EAAEC,2BACFD,EAAEE,kBACF,MAAM5B,EAAUc,KAAK+M,YAAYnM,EAAEI,QACnC,IAAK9B,EAAS,CACZ,M,CAEFc,KAAKsJ,gBAAkB,CACrBpK,UACA+N,MAAO,Q,CAIX,UAAAlL,CAAWnB,GACTA,EAAEC,2BAEF,MAAM3B,EAAUc,KAAK+M,YAAYnM,EAAEI,QACnC,IAAK9B,EAAS,CACZ,M,CAEFc,KAAKsJ,gBAAkB,CACrBpK,UACA+N,MAAO,O,CAKX,6CAAMjL,CAAwCpB,GAC5CA,EAAEC,2BACFD,EAAEE,wBACId,KAAK2K,e,CAIb,kBAAAuC,CAAmBtM,GACjBA,EAAEC,2BACFD,EAAEE,kBAEFoJ,EAAgBhJ,SAAWgJ,EAAgBhJ,SAASsK,KAAIpK,IACtD,MAAM+L,EAAQ,IAAK/L,EAAE+L,OACrB,MAAMC,EAAWxM,EAAEI,OACnB,GAAImM,EAAM/K,KAAOgL,EAAShL,GAAI,CAC5B,MAAO,IAAKhB,EAAG+L,MAAO,IAAKA,KAAUC,G,CAEvC,OAAOhM,CAAC,G,CAIJ,WAAA2L,CAAY9N,GAClB,OAAOiL,EAAgBhJ,SAASC,MAAKC,GAAKA,EAAEL,cAAgB9B,G,CAE9D,MAAA+F,GACE,GAAIhF,KAAKqJ,WAAarJ,KAAKpB,SAAW,GAAI,CACxC,OAAOqG,EAAA,yB,CAET,OACEA,EAACC,EAAI,KACHD,EAAA,uBACAA,EAAA,iBACAA,EAAA,OAAKG,MAAM,kBACTH,EAAA,qBAAmB/C,WAAYlC,KAAKnB,WAAYE,EAAGiB,KAAKjB,EAAGD,SAAUkB,KAAKlB,WAC1EmG,EAAA,WAASG,MAAM,QACbH,EAAA,mCAGJA,EAAA,aACEU,MAAO,CACL,oBAAqB,QACrB,+BAAgC,UAChC,2BAA4B,IAC5B,0BAA2B,IAC3B,6BAA8B,IAC9B,4BAA6B,KAE/BH,aAAc5E,IACZA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKsJ,gBAAkB,IAAI,EAE7B7D,cAAa,KACbC,KAAM1F,KAAKsJ,iBAAiB2D,QAAU,QAErCjN,KAAKsJ,iBAAiBpK,SACrB+F,EAAA,sBACEW,SAAQ,KACRC,WAAU,KACVC,eAAc,KACdC,eAAgB,IAAO/F,KAAKsJ,gBAAkB,KAC9CtD,mBAAkB,KAClBnH,WAAYmB,KAAKnB,WACjBoH,YAAW,KACXC,cAAa,KACbjH,cAAee,KAAKsJ,gBAAgBpK,SAAS6B,YAAY4C,WACzD/E,OAAQoB,KAAKpB,OACbE,SAAUkB,KAAKlB,SACfqH,WAAU,QAIhBlB,EAAA,wBACEoI,wBAAyB,KACvBrN,KAAKsJ,gBAAkB,IAAI,EAE7BvI,YAAaf,KAAKsJ,iBAAiBpK,SAAS6B,YAC5CuM,MAAOtN,KAAKsJ,iBAAiBpK,SAASiO,MAAMG,MAC5CxO,SAAUkB,KAAKlB,SACf4G,KAAM1F,KAAKsJ,iBAAiB2D,QAAU,UAExChI,EAAA,oBACEU,MAAO,CAAES,OAAQ,QACjBnH,cAAee,KAAKd,SAAS6B,YAC7B5B,eAAgBa,KAAKb,eACrBE,QAASW,KAAKX,QACdgH,KAAM,iBACNC,IAAKC,GAAOvG,KAAKF,gBAAkByG,EACnCC,aAAc,KACZxG,KAAKd,QAAU,KACfc,KAAKX,QAAU,IAAI,I,sECrY/B,MAAMkO,GAAoB,0QAC1B,MAAAC,GAAeD,G,MCeFE,GAAc,M,0EACjB3O,SAAmB,GACnBF,OAAiB,GACjBC,WACAE,EAECK,cACAsE,YACAgK,eACAC,4BACAtE,UACAuE,QAA8B,CAAEC,KAAMC,IAASC,OAAO,cAAeC,MAAO,MAC5EC,aAEDzO,aAAe,IAAIC,EACnBC,YAAc,IAAIC,EAClB+J,gBAAkB,IAAIC,EACtB/J,eAAiB,IAAIC,EACrBV,eAEC+O,gBAET,iBAAAnO,GACE,GAAIC,KAAKpB,OAAQ,CACfoB,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKoK,e,EAKT,aAAAM,CAAclK,EAAkBC,GAC9B,GAAID,IAAaC,EAAU,CACzB,M,CAEFT,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKoK,e,CAIP,iBAAA+D,CAAkBvN,GAChBA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKiO,aAAerN,EAAEI,M,CAGxB,qBAAAoN,CAAsBxN,GACpBA,EAAEC,2BACFD,EAAEE,kBACFd,KAAK4N,QAAU,IAAKhN,EAAEI,QACtBhB,KAAKqO,mB,CAGP,wBAAMC,CAAmB1N,GACvBA,EAAEE,kBACFF,EAAEC,2BACFb,KAAKqO,kBAAkB,MAAO,K,CAGxBE,mBAAsB3N,IAC5BA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKiO,aAAe,IAAI,EAGlB,iBAAAO,GACN,IAAKxO,KAAKiO,aAAc,CACtB,M,CAEF,OAAQjO,KAAKiO,aAAaQ,MACxB,IAAK,UACH,OACExJ,EAAA,sBACEyJ,KAAK,eACL9I,SAAQ,KACRC,WAAU,KACVC,eAAc,KACdC,eAAgB/F,KAAKuO,mBACrBvI,mBAAkB,KAClBnH,WAAYmB,KAAK0D,YACjBuC,YAAW,KACXC,cAAa,KACbjH,cAAee,KAAKiO,aAAaU,QAAQ1P,cAAc0E,WACvD/E,OAAQoB,KAAKpB,OACbE,SAAUkB,KAAKlB,SACfqH,WAAU,OAGhB,QACE,OAAO,K,CAIL,mBAAMiE,GACZpK,KAAKZ,cAAgB,KAErB,IACE,IAAI8C,EAAalC,KAAKnB,WACtB,IAAKqD,IAAelC,KAAKjB,EAAG,CAC1B,MAAM,IAAIkD,MAAM,sC,CAElB,IAAKC,EAAY,CACf,MAAM8I,QAAqBhL,KAAKN,YAAYyC,mBAAmB,CAC7DC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,OAE3B1M,EAAa8I,EAAa5C,UAAUhG,E,CAGtCpC,KAAK0D,YAAcxB,EAEnB,MAAM2M,EAA2B,CAC/B7O,KAAKJ,eAAeoD,gCAAgC,CAAC,YAAa,kBAAmB,gBACrFhD,KAAKqO,oBACLrO,KAAKN,YAAYoD,cAAc9C,KAAKlB,WAEtC,GAAIoD,EAAY,CACd2M,EAASzD,KACPpL,KAAKN,YAAYyC,mBAAmB,CAClCC,GAAIF,EACJpD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,O,CAK/B,MAAOpM,SAAsBC,QAAQC,IAAImM,GACzC,MAAM5L,SAAEA,EAAQC,eAAEA,EAAcC,WAAEA,GAAenD,KAAKJ,eAAewD,uBAAuBZ,GAC5FxC,KAAKb,eAAiB,CACpBkE,OAAQH,EACRI,QAASH,EACT7B,MAAO2B,E,CAET,MAAOM,GACPqI,QAAQG,IAAIxI,E,SAEZvD,KAAKZ,cAAgB,K,EAGjB,mBAAA0P,CAAoBC,GAC1B,MAAMrB,EAAsC,IAAIsB,IAEhD,IAAK,MAAM3P,KAAW0P,EAAU,CAC9B,MAAM1H,EAAM,GAAGhI,EAAQ4P,eAAe5P,EAAQ6P,gBAC9C,MAAMnQ,EAAI2O,EAAeyB,IAAI9H,IAAQ,GACrCqG,EAAe0B,IAAI/H,EAAK,IAAItI,EAAGM,G,CAEjC,OAAO,IAAI2P,IACT,IAAItB,EAAe5E,WAAWuG,MAAK,EAAEC,IAAKlO,MACxC,MAAMmO,EAAO7K,OAAO4K,GACpB,MAAME,EAAO9K,OAAOtD,GACpB,IAAKqO,MAAMF,KAAUE,MAAMD,GAAO,CAChC,OAAOD,EAAOC,C,CAEhB,OAAOF,EAAEI,cAActO,EAAE,I,CAKvB,uBAAMiN,CAAkBsB,EAAkB,MAAOC,EAAmB,OAC1E,IACE,MAAMC,EAAgBC,IACb,CACLC,OAAQD,EAAOE,OACff,YAAaa,EAAOG,cACpBf,cAAeY,EAAOI,gBACtBC,OAAQL,EAAOM,OACfvC,KAAMiC,EAAOO,KACbC,KAAMR,EAAOS,KACbC,OAAQV,EAAOW,OACfC,KAAMZ,EAAOa,KACbC,SAAUd,EAAOe,SACjBC,WAAYhB,EAAOiB,YACnB3O,GAAI4O,MAGRhR,KAAKqJ,UAAYsG,EAAkB,SAAW,SAE9C,MAAMd,EAAW,CACf7O,KAAK0J,gBAAgBuH,sBAAsB,CACzCpD,KAAM7N,KAAK4N,QAAQC,KACnBnK,YAAa1D,KAAK0D,aAAaC,WAC/BuN,mBAAoBvB,KAGxB,IAAKA,IAAoBC,EAAkB,CACzCf,EAASzD,KACPpL,KAAK0J,gBAAgBuH,sBAAsB,CACzCpD,KAAMC,EAAO9N,KAAK4N,QAAQC,KAAM,cAAcsD,KAAK,EAAG,QAAQpD,OAAO,cACrErK,YAAa1D,KAAK0D,aAAaC,WAC/BuN,mBAAoBvB,I,CAK1B,MAAMpE,QAAgB9I,QAAQC,IAAImM,GAClC,IAAKc,EAAiB,CACpB,GAAIpE,EAAQ,GAAI,CACdvL,KAAK0N,eAAiB1N,KAAK8O,oBAAoBvD,EAAQ,IAAIC,IAAIqE,G,KAC1D,CACL7P,KAAK0N,eAAiB,IAAIsB,G,CAE5B,GAAIzD,EAAQ,GAAIvL,KAAK2N,4BAA8B3N,KAAK8O,oBAAoBvD,EAAQ,IAAIC,IAAIqE,G,EAE9F,MAAOjP,GACPgL,QAAQG,IAAInL,E,SAEZZ,KAAKqJ,UAAY,I,EAIrB,MAAArE,GACE,GAAIhF,KAAKZ,cAAe,CACtB,OAAO6F,EAAA,yB,CAET,OACEA,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,uBACAA,EAAA,WAASG,MAAM,yBAAyBO,MAAO,CAAE2B,IAAK,SACpDrC,EAAA,OAAKG,MAAM,qDACTH,EAAA,MAAIG,MAAM,gBAAc,iBACxBH,EAAA,aACE2C,KAAK,KACLwJ,UAAU,UACV/H,UAAWrJ,KAAKqJ,YAAc,SAC9BxB,KAAMwJ,EAAQvI,SAASwI,WACvBxJ,eAAgBC,MAAMnH,IACpBA,EAAEC,2BACFD,EAAEE,wBACId,KAAKqO,kBAAkB,KAAK,EAEpCkD,SAAU,CAAEnL,OAAQ,QACpBoL,aAAa,QACbC,UAAU,OACVC,WAAY,CAAE,cAAe,WAGjCzM,EAAA,sBACE0I,4BAA6B3N,KAAK2N,4BAClCgE,gBAAiB3R,KAAK0N,eACtBvO,eAAgBa,KAAKb,iBAEvB8F,EAAA,OAAKG,MAAM,uBACTH,EAAA,4BAA0BoE,UAAWrJ,KAAKqJ,YAAc,SAAU0F,SAAU/O,KAAK0N,iBACjFzI,EAAA,oBAAkB2I,QAAS5N,KAAK4N,QAASxI,MAAO,uBAAwBjG,eAAgBa,KAAKb,eAAgB4P,SAAU/O,KAAK0N,mBAGhIzI,EAAA,cACE2M,cAAe,CACbC,MAAO7R,KAAKiO,cAAcQ,OAAS,UAAY,QAAU,6BACzDqD,WAAY9R,KAAKiO,cAAcQ,OAAS,UAAY,UAAY,SAElE/I,KAAMqM,QAAQ/R,KAAKiO,cACnB+D,gBAAiB,MACjBC,kBAAmBjS,KAAKuO,oBAEvBvO,KAAKwO,qB,sECpRhB,MAAM0D,GAAkB,mNACxB,MAAAC,GAAeD,G,MCeFE,GAAY,M,yBACfxT,OACAC,WACAC,SAAmB,KACnBC,EAECE,cACAC,QACAC,eACAC,cACAC,QACAgT,cAAmC,KACnCC,aAAkC,KAEnC9S,aAAe,IAAIC,EACnBC,YAAc,IAAIC,EAClBC,eAAiB,IAAIC,EAErBC,gBAER,iBAAAC,GACE,GAAIC,KAAKpB,OAAQ,CACfoB,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKE,M,CAEPqS,EAAwB,SAASlS,IAC/BL,KAAKM,aAAa,G,CAKtB,kBAAAI,CAAmBF,EAAkBC,GACnC,GAAID,IAAaC,EAAU,CACzBT,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKE,M,EAKT,UAAA6B,CAAWnB,GACTZ,KAAKf,cAAgB2B,EAAEI,M,CAIzB,oBAAAL,CAAqBC,GACnBA,EAAEC,2BACFD,EAAEE,kBACF,MAAMC,YAAEA,EAAW1B,QAAEA,GAAYuB,EAAEI,OACnChB,KAAKd,QAAUsT,EAAgBtR,SAASC,MAAKC,GAAKA,EAAEL,cAAgBA,IACpE,MAAMM,EAAcrB,KAAKb,eAAemC,MAAMH,MAAKpC,GAAKA,EAAEwC,YAAclC,EAAQmC,aAAaC,OAC7FzB,KAAKX,QAAU,IACVA,EACHmC,aAAc,CACZC,KAAMJ,EAAYE,UAClBG,YAAaL,EAAYM,cACzBC,UAAWP,EAAYQ,QAG3B7B,KAAKF,gBAAgBgC,W,CAGvB,6CAAME,CAAwCpB,GAC5CA,EAAEC,2BACFD,EAAEE,wBACId,KAAKM,a,CAEL,UAAMJ,GACZ,IACEF,KAAKZ,cAAgB,KACrB,IAAKY,KAAKnB,aAAemB,KAAKjB,EAAG,CAC/B,MAAM,IAAIkD,MAAM,sB,CAElB,IAAIC,EAAalC,KAAKnB,WAEtB,IAAKqD,EAAY,OACTlC,KAAKN,YAAYyC,mBAAmB,CACxCC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,M,CAGhB,MAAOjC,EAAGkC,EAAIC,SAAsBC,QAAQC,IAAI,CAC9CC,GAAeC,SAAWH,QAAQI,QAAQ,MAAQ7C,KAAKN,YAAYyC,mBAAmB,CAAEC,GAAIpC,KAAKnB,YAAc,EAAGC,SAAUkB,KAAKlB,SAAUuD,MAAOrC,KAAKjB,IACvJiB,KAAKN,YAAYoD,cAAc9C,KAAKlB,UACpCkB,KAAKJ,eAAeoD,gCAAgC,CAAC,uBAAwB,kBAAmB,YAAa,kBAAmB,gBAChIhD,KAAKM,gBAGP,MAAM2C,SAAEA,EAAQC,eAAEA,EAAcC,WAAEA,GAAenD,KAAKJ,eAAewD,uBAAuBZ,GAE5FxC,KAAKb,eAAiB,CAAEmC,MAAO2B,EAAUI,OAAQH,EAAgBI,QAASH,E,CAC1E,MAAOI,G,SAEPvD,KAAKZ,cAAgB,K,EAIjB,iBAAMkB,GACZ,MAAMY,SAAEA,EAAQsC,YAAEA,SAAsBxD,KAAKJ,eAAe6S,mBAAmB,CAC7E/O,YAAaf,EAAcC,UAAUR,IAAIuB,YAAc3D,KAAKnB,YAAY8E,WACxE+O,eAAgBF,EAAgB3O,MAChCC,WAAY0O,EAAgBzO,WAAWC,YACvCC,UAAWuO,EAAgBzO,WAAW/E,WAExC2T,EAAkBnP,GAAe,GACjCoP,EAA0B1R,E,CAEpB,kBAAA2R,CAAmBxO,GACzBA,EAAMxD,2BACNwD,EAAMvD,kBACNd,KAAKqS,cAAgBhO,EAAMrD,M,CAErB,4BAAMoD,CAAuBC,GACnCA,EAAMxD,2BACNwD,EAAMvD,kBACN,MAAMwD,EAAWD,EAAMrD,QAAQgD,aAAe,EAC9C,GAAIM,IAAakO,EAAgBzO,WAAWC,YAAa,CACvD,M,CAEF8O,EAAkBxO,SACZtE,KAAKM,a,CAGL,gCAAMyS,CAA2B1O,GACvCA,EAAMxD,2BACNwD,EAAMvD,kBACN,MAAMkS,EAAQ,IAAKhT,KAAKqS,eACxBrS,KAAKqS,cAAgB,KACrB,OAAQhO,EAAMrD,OAAOiS,QACnB,IAAK,iBACGjT,KAAKM,cACX,MACF,IAAK,cACHN,KAAKsS,aAAe,IAAKU,SACnBhT,KAAKM,cACX,M,CAIE,oCAAMkE,CAA+BH,GAC3CA,EAAMxD,2BACNwD,EAAMvD,kBACN,MAAM2D,EAAeJ,EAAMrD,QAAQhC,SACnC,IAAK0F,OAAOC,SAASF,GAAe,CAClC,M,CAEF,MAAMG,EAAqBC,KAAKC,MAAMJ,OAAOD,IAC7C,GAAIG,IAAuB4N,EAAgBzO,WAAW/E,SAAU,CAC9D,M,CAEFkU,EAAsBtO,SAChB5E,KAAKM,a,CAEL,kBAAA6S,CAAmB9O,GACzBA,EAAMxD,2BACNwD,EAAMvD,kBACNd,KAAKsS,aAAe,I,CAEtB,MAAAtN,GACE,GAAIhF,KAAKZ,cAAe,CACtB,OAAO6F,EAAA,yB,CAET,OACEA,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,kBAAgBE,iBAAkB,CAAC,6BACnCF,EAAA,OAAKG,MAAO,sBACVH,EAAA,MAAIG,MAAM,cAAY,cAEtBH,EAAA,uBACEmO,eAAgB/O,GAASrE,KAAK6S,mBAAmBxO,GACjDiB,oBAAqBjB,GAASrE,KAAKoE,uBAAuBC,GAC1DkB,wBAAyBlB,GAASrE,KAAKwE,+BAA+BH,MAG1EY,EAAA,aACEO,aAAc5E,IACZA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKf,cAAgB,IAAI,EAE3BwG,cAAa,KACbC,OAAQ1F,KAAKf,cACb0G,MAAO,CACL,oBAAqB,QACrB,+BAAgC,UAChC,2BAA4B,IAC5B,4BAA6B,IAC7B,0BAA2B,IAC3B,6BAA8B,MAG/B3F,KAAKf,eACJgG,EAAA,sBACEW,SAAQ,KACRC,WAAU,KACVC,eAAc,KACdC,eAAgB,IAAO/F,KAAKf,cAAgB,KAC5C+G,mBAAkB,KAClBnH,WAAYmB,KAAKnB,WACjBoH,YAAW,KACXC,cAAa,KACbjH,cAAee,KAAKf,cAAc0E,WAClC/E,OAAQoB,KAAKpB,OACbE,SAAUkB,KAAKlB,SACfqH,WAAU,QAIhBlB,EAAA,oBACEU,MAAO,CAAES,OAAQ,QACjBnH,cAAee,KAAKd,SAAS6B,YAC7B5B,eAAgBa,KAAKb,eACrBE,QAASW,KAAKX,QACdgH,KAAM,iBACNC,IAAKC,GAAOvG,KAAKF,gBAAkByG,EACnCC,aAAc,KACZxG,KAAKd,QAAU,KACfc,KAAKX,QAAU,IAAI,IAGvB4F,EAAA,sBACE/F,QAASc,KAAKqS,eAAenT,QAC7BuH,WAAYzG,KAAKqS,eAAe5L,WAChCf,KAAM1F,KAAKqS,gBAAkB,KAC7BgB,uBAAwBhP,GAASrE,KAAK+S,2BAA2B1O,KAEnEY,EAAA,cACEqO,eAAgBjP,GAASrE,KAAKmT,mBAAmB9O,GACjDnF,QAASc,KAAKsS,cAAcpT,QAC5BqU,eAAgBvT,KAAKsS,cAAc7L,WACnCf,KAAM1F,KAAKsS,eAAiB,O,2ECxPtC,MAAMkB,GAAe,0PACrB,MAAAC,GAAeD,G,MCmBFE,GAAS,M,4GAGZ5U,SAAmB,GACnBF,OAAiB,GACjBC,WACAE,EACAoK,QAECE,UAAY,MACZsK,kBAAoB,MACpBC,iBAAmB,GACnBC,oBAAsB,IACtBC,aAAuC,KACvCC,cAAgB,MAChBrQ,YACAsQ,cACAC,sBACArG,QACAsG,YAEiCC,qBAElCC,YAAsC,GACtC1U,YAAc,IAAIC,EAClB0U,oBAAsB,IAAIC,EAC1BlN,MAAQ,IAAI3H,EACZ8U,cAA6C,IAAIvF,IACjDwF,MAER,iBAAAzU,GACE,GAAIC,KAAKmJ,QAAS,CAChBnJ,KAAKoH,MAAM4C,WAAWhK,KAAKmJ,Q,CAE7B,GAAInJ,KAAKpB,SAAW,GAAI,CACtBoB,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKE,M,EAKT,aAAAwK,CAAclK,EAAkBC,GAC9B,GAAID,IAAaC,EAAU,CACzB,M,CAEFT,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKE,M,CAIP,kBAAAuU,CAAmB7T,GACjBA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKgU,cAAgB,K,CAGvB,oBAAAU,CAAqB9T,GACnBA,EAAEC,2BACFD,EAAEE,kBACF,MAAM6T,MAAEA,EAAKC,UAAEA,GAAchU,EAAEI,OAC/B4K,QAAQG,IAAInL,EAAEI,QACd,GAAI2T,IAAU,OAAQ,CACpB,M,CAEF3U,KAAKuU,cAAcnF,IAAIuF,EAAOC,E,CAGhC,sBAAAC,CAAuBjU,GACrBA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKkU,YAAc,CAAEY,KAAMlU,EAAEI,OAAQiM,MAAO,QAC5CjN,KAAKwU,OAAOlI,W,CAGN,UAAMpM,GACZ,IACEF,KAAKqJ,UAAY,KACjB0L,EAAW,MACX,IAAI7S,EAAalC,KAAKnB,WACtB,IAAKmB,KAAKnB,aAAemB,KAAKjB,EAAG,CAC/B,MAAM,IAAIkD,MAAM,sC,CAGlB,IAAKC,EAAY,CACf0J,QAAQG,IAAI7J,GACZ,MAAM8I,QAAqBhL,KAAKN,YAAYyC,mBAAmB,CAC7DC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,OAG3B1M,EAAa8I,EAAa5C,UAAUhG,E,CAEtCpC,KAAK0D,YAAcxB,EACnB,MAAM2M,EAAW,CAAC7O,KAAKqU,oBAAoBW,kBAAkBhV,KAAK0D,aAAc1D,KAAKN,YAAYoD,cAAc9C,KAAKlB,WACpH,GAAIkB,KAAKnB,WAAY,CACnBgQ,EAASzD,KACPpL,KAAKN,YAAYyC,mBAAmB,CAClCC,GAAIpC,KAAKnB,WACTC,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,O,OAKzBnM,QAAQC,IAAImM,GAClB,MAAMoG,QAAoBjV,KAAKqU,oBAAoBa,WAAW,CAC5DxR,YAAa1D,KAAK0D,YAClByR,UAAWrH,IAASC,OAAO,cAC3BqH,QAAStH,IAASC,OAAO,cACzBsH,aAAc,GACdC,oBAAqB3S,EAAc2S,oBAAsBC,GAAoBC,aAAaC,qBAAqB,KAAKhU,KACpHiU,aAAcH,GAAoBC,aAAaG,cAAc,IAAIlU,KACjEmU,iBAAkBL,GAAoBC,aAAaK,0BAA0B,IAAIpU,OAInF,GAAIwT,GAAaa,MAAO,CACtB9V,KAAK+V,YAAYd,EAAYa,M,EAE/B,MAAOvS,GACPqI,QAAQG,IAAIxI,E,SAEZvD,KAAKqJ,UAAY,MACjB0L,EAAW,M,EAIP,yBAAAiB,GACNhW,KAAKoU,YAAc,GACnBmB,EAAmBC,aAAaH,cAAcY,SAAQC,IACpD,GAAIA,EAAG9T,IAAM,MAAQ8T,EAAGC,MAAQ,KAAM,CACpCnW,KAAKoU,YAAY8B,EAAG9T,IAAM8T,EAAGC,I,KAK3B,WAAAJ,CAAYD,GAClB9V,KAAKgW,4BACLI,EACEN,EAAMtK,KAAI6K,IAAC,IACNA,EACHjU,GAAI4O,IACJsF,YAAa,MACX,MAAMH,EAAOnW,KAAKoU,YAAYiC,EAAEE,QAChC,GAAIJ,EAAM,CACR,OAAOA,C,CAET,MAAMK,EAASjB,EAAmBC,aAAaH,cAAclU,MAAK+U,GAAMA,EAAG9T,KAAOiU,EAAEE,UAASJ,KAC7FnW,KAAKoU,YAAYiC,EAAEE,QAAUC,EAC7B,OAAOA,CACR,EARY,O,CAanB,6BAAMC,CAAwB7V,GAC5BA,EAAEC,2BACFD,EAAEE,kBACF,MAAMqV,KAAEA,GAASvV,EAAEI,OACnB,OAAQmV,GACN,IAAK,UACL,IAAK,gBACHnW,KAAKwU,OAAOlI,YACZtM,KAAKkU,YAAc,CACjBY,KAAM,KACN7H,MAAO,QACPf,OAAQiK,IAAS,gBAAkB,MAAQ,OAE7C,MACF,IAAK,SACH,MAAMO,EAAiDC,MAAMvK,KAAKpM,KAAKuU,cAAczL,WAAW0C,KAAI,EAAEnE,EAAKI,MAAM,CAC/GJ,MACAI,YAEFmE,QAAQG,IAAI2K,GACZ,MAAME,IAAEA,SAAc5W,KAAK6W,sBAAsB,MACjDC,EAAaF,GACb,MACF,IAAK,UACH5W,KAAKgU,cAAgB,KACrB,M,CAIN,+BAAA+C,CAAgCnW,GAC9BA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKkU,YAAc,IAAKtT,EAAEI,OAAQiM,MAAO,SACzCjN,KAAKwU,OAAOlI,W,CAGN,6BAAM0K,CAAwBpW,GACpC,IACEA,EAAEC,2BACFD,EAAEE,kBACF,GAAImW,EAAaC,cAAc7L,SAAW,EAAG,CAC3C,M,CAEFrL,KAAK2T,kBAAoB,KACzB,GAAI3T,KAAKkU,aAAajH,QAAU,OAAQ,CACtC,MAAMlM,YAAEA,EAAW8M,KAAEA,EAAIsJ,KAAEA,GAASnX,KAAKkU,YAAYY,WAC/C9U,KAAKqU,oBAAoB+C,WAAW,CACxClP,SAAUnH,EACVsP,KAAMxC,EACNwJ,QAAS,GACTC,YAAa,EACbC,oBAAqB,MACrBC,MAAOL,EAAK/U,I,KAET,OACCpC,KAAKqU,oBAAoBoD,gBAAgB,CAC7CC,QAAST,EAAaC,cAAc1L,KAAI6K,IAAC,CACvC3U,YAAa,UACb6U,OAAQF,EAAEE,SAAW,EAAI,KAAOF,EAAEE,OAClCoB,QAAStB,EAAEc,KAAK/U,GAChBrB,YAAasV,EAAEtV,YACfmL,OAAQlM,KAAKkU,aAAahI,QAAU,W,OAIpClM,KAAK6W,uB,SAEXe,IACA,GAAI5X,KAAKkU,YAAa,CACpBlU,KAAKkU,YAAc,I,CAErBlU,KAAK2T,kBAAoB,MAEzB3T,KAAKwU,MAAMqD,Y,EAIP,kBAAMC,CAAalX,GACzB,IACEZ,KAAKiU,sBAAwB,KAC7BrT,EAAEC,2BACFD,EAAEE,kBACFd,KAAK4N,QAAU,IAAKhN,EAAEI,cAChBhB,KAAK6W,uB,CACX,MAAOtT,GACPqI,QAAQG,IAAIxI,E,SAEZvD,KAAKiU,sBAAwB,K,EAIzB,2BAAM4C,CAAsBkB,EAA2B,OAC7D,MAAMC,iBAAEA,EAAgB3C,aAAEA,EAAYI,qBAAEA,EAAoBwC,YAAEA,EAAWC,oBAAEA,GAAwBlY,KAAK4N,SAAW,GAEnH,MAAMkI,MAAEA,EAAKc,IAAEA,SAAc5W,KAAKqU,oBAAoBa,WAAW,CAC/DG,eACAC,mBAAoBG,GAAsBhU,KAC1CiU,aAAcuC,GAAaxW,KAC3BmU,iBAAkBsC,GAAqBzW,KACvCiC,YAAa1D,KAAK0D,YAClByR,UAAWrH,IAASC,OAAO,cAC3BqH,QAAS4C,GAAkBvW,MAAQqM,IAASC,OAAO,cACnDmD,mBAAoB6G,IAEtBnM,QAAQG,IAAI+J,GACZ,GAAIA,EAAO,CACT9V,KAAK+V,YAAYD,E,CAEnB,MAAO,CAAEA,QAAOc,M,CAGlB,MAAA5R,GACE,GAAIhF,KAAKqJ,UAAW,CAClB,OAAOpE,EAAA,yB,CAET,OACEA,EAACC,EAAI,eAAa,iBAChBD,EAAA,iBACAA,EAAA,uBACAA,EAAA,WAASG,MAAM,yBAAyBO,MAAO,CAAE2B,IAAK,SACpDrC,EAAA,gCACAA,EAAA,OAAKG,MAAM,cAAcO,MAAO,CAAE2B,IAAK,SACrCrC,EAAA,oBACEoE,UAAWrJ,KAAKiU,sBAChBkE,eAAgBvX,IACdZ,KAAK8X,aAAalX,EAAE,IAGxBqE,EAAA,OAAKG,MAAM,2BAA2BO,MAAO,CAAE2B,IAAK,SAClDrC,EAAA,kBACEmT,kBAAmBxX,IACjBA,EAAEC,2BACFD,EAAEE,kBACFuX,EAAoBzX,EAAEI,OAAO,EAE/BoE,MAAM,yBAMdH,EAAA,YACEqT,UAAW,MACXhS,IAAKC,GAAOvG,KAAKwU,MAAQjO,EACzB8C,UAAWrJ,KAAK2T,kBAChB4E,eAAgBvY,KAAKgX,wBAAwBwB,KAAKxY,MAClDyY,cAAe,KACb,GAAIzY,KAAKkU,YAAa,CACpB0D,IACA5X,KAAKkU,YAAc,I,GAGvBwE,cAAe,KACfC,KAAK,8BACLC,YAAavH,EAAQvI,QAAQ+P,WAC7BC,aAAczH,EAAQvI,QAAQiQ,YAC9BC,aAAa,YACbC,cAAe,UACfC,WAAY7H,EAAQvI,QAAQqQ,iBAC5BC,UACEpZ,KAAKkU,YACDlU,KAAKkU,aAAajH,QAAU,QAC1BjN,KAAKkU,YAAYY,KACf,UAAU9U,KAAKkU,aAAaY,MAAMqC,MAAMhB,gBACxC,mCACF,6CACF,qCAGRlR,EAAA,cACES,KAAM1F,KAAKgU,cACX5R,GAAG,gBACH6P,kBAAmBrR,IACjBA,EAAEC,2BACFD,EAAEE,kBACFd,KAAKgU,cAAgB,KAAK,EAK5BhC,gBAAiB,OAEhBhS,KAAKgU,eAAiB/O,EAAA,iBAAerG,OAAQoB,KAAKoH,MAAMiS,WAAYnX,WAAYlC,KAAK0D,YAAagL,KAAK,kB,sECzWlH,MAAM4K,GAAoB,uCAC1B,MAAAC,GAAeD,G,MCcFE,GAAc,M,sDACjB1a,SAAmB,GACnBF,OAAiB,GAEjBC,WACAE,EACAoK,QAECE,UAAY,MAEZoQ,MAED/Z,YAAc,IAAIC,EAClB0U,oBAAsB,IAAIC,EAC1B5K,gBAAkB,IAAIC,EACtBvC,MAAQ,IAAI3H,EACpB+U,MACAkF,0BAEA,iBAAA3Z,GACE,GAAIC,KAAKmJ,QAAS,CAChBnJ,KAAKoH,MAAM4C,WAAWhK,KAAKmJ,Q,CAE7B,GAAInJ,KAAKpB,SAAW,GAAI,CACtBoB,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,EAIT,qBAAMuP,CAAgB/Y,GACpBA,EAAEC,2BACFD,EAAEE,wBACId,KAAKqU,oBAAoBW,kBAAkBhV,KAAKnB,W,CAGxD,aAAA6L,CAAclK,EAAkBC,GAC9B,GAAID,IAAaC,EAAU,CACzB,M,CAEFT,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,CAGP,mBAAMA,GACJ,IACEpK,KAAKqJ,UAAY,KACjB,IAAInH,EAAalC,KAAKnB,WACtB,IAAKqD,EAAY,CACf,MAAM8I,QAAqBhL,KAAKN,YAAYyC,mBAAmB,CAC7DC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsX,yBAA0B,OAE5B1X,EAAa8I,EAAa5C,UAAUhG,E,CAEtCyX,EAAc,qBAAsB,CAAEzS,MAAOpH,KAAKpB,OAAQ8E,YAAaxB,EAAYpD,SAAUkB,KAAKlB,WAClG,MAAM+P,EAAgC,GACtC,GAAIlM,EAAcmX,qBAAsB,CACtCjL,EAASzD,KAAKpL,KAAKqU,oBAAoBW,kBAAkB9S,G,CAE3D2M,EAASzD,KAAKpL,KAAKN,YAAYoD,cAAc9C,KAAKlB,SAAU,CAAC,YAAa,gBAC1E,GAAIkB,KAAKnB,WAAY,CACnBgQ,EAASzD,KACPpL,KAAKN,YAAYyC,mBAAmB,CAClCC,GAAIF,EACJpD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsX,yBAA0B,O,OAK1BnX,QAAQC,IAAImM,GAClB7O,KAAK0Z,0BAA4B/W,EAAc2S,oBAAoB7T,I,CACnE,MAAO8B,GACPqI,QAAQrI,MAAMA,E,SAEdvD,KAAKqJ,UAAY,K,EAGb,kCAAM0Q,CAA6BnZ,GACzCA,EAAEC,2BACFD,EAAEE,kBACF,UACQd,KAAKN,YAAYsa,uBAAuB,CAC5CtW,YAAa6R,EAAmB0E,mBAAmBvW,YACnDwW,KAAMtZ,EAAEI,SAAW,SAErBhB,KAAKyZ,MAAMU,KAAK,CACdC,SAAU,YACVC,MAAO,qBACP3Y,YAAa,GACb+M,KAAM,W,CAER,MAAOlL,GACPqI,QAAQG,IAAIxI,E,EAGR,2BAAM+W,CAAsB1Z,GAClCA,EAAEC,2BACFD,EAAEE,kBACF,UACQd,KAAK0J,gBAAgB6Q,4BAA4B,CACrD7W,YAAa6R,EAAmB0E,mBAAmBvW,YACnDjC,KAAMzB,KAAK0Z,4BAEb/W,EAAc2S,mBAAqB,CAAE7T,KAAMzB,KAAK0Z,0BAA2BhY,YAAa,IACxF1B,KAAKyZ,MAAMU,KAAK,CACdC,SAAU,YACVC,MAAO,qBACP3Y,YAAa,GACb+M,KAAM,YAERzO,KAAKwU,MAAMqD,Y,CACX,MAAOtU,GACPqI,QAAQG,IAAIxI,E,EAGhB,MAAAyB,GACE,GAAIhF,KAAKqJ,UAAW,CAClB,OAAOpE,EAAA,yB,CAET2G,QAAQG,IAAIpJ,EAAc2S,oBAC1B,OACErQ,EAACC,EAAI,KACHD,EAAA,uBACAA,EAAA,iBACAA,EAAA,WAASG,MAAM,OACbH,EAAA,MAAIG,MAAM,QAAQiM,EAAQvI,QAAQ0R,iCAClCvV,EAAA,OAAKG,MAAM,YACTH,EAAA,YAAUwV,YAAW,KAACC,MAAM,wBAC5BzV,EAAA,OAAKG,MAAO,kCACVH,EAAA,KAAGG,MAAM,kBAAkBiM,EAAQvI,QAAQ6R,mCAC3C1V,EAAA,aACE2V,gBAAiB,MACjBC,cAAelY,EAAcmY,0BAA4B,OAAS,SAClEC,eAAgBna,GAAKZ,KAAK+Z,6BAA6BnZ,GACvDuG,KAAM,CACJ,CAAEU,KAAMwJ,EAAQvI,QAAQkS,2BAA4BvT,MAAO,QAC3D,CAAEI,KAAMwJ,EAAQvI,QAAQmS,wBAAyBxT,MAAO,cAI9DxC,EAAA,OAAKG,MAAO,6BACVH,EAAA,KAAGG,MAAM,kBAAkBiM,EAAQvI,QAAQoS,sBAAqB,KAChEjW,EAAA,aACE2V,gBAAiB,MACjBC,cAAe7a,KAAK0Z,0BACpBqB,eAAgBna,IACdA,EAAEC,2BACFD,EAAEE,kBACFd,KAAK0Z,0BAA4B9Y,EAAEI,OACnChB,KAAKwU,MAAMlI,WAAW,EAExBnF,KAAMoO,GAAoBC,aAAaC,qBAAqBjK,KAAI2P,IAAC,CAC/DtT,KAAMsT,EAAEzZ,YACR+F,MAAO0T,EAAE1Z,aAMhBkB,EAAcmX,sBAAwB7U,EAAA,cAAYG,MAAM,SACzDH,EAAA,YACEqT,UAAW,MACXhS,IAAKC,GAAOvG,KAAKwU,MAAQjO,EACzB8C,UAAW+R,EAAiB,mCAC5B7C,eAAgBvY,KAAKsa,sBAAsB9B,KAAKxY,MAChD0Y,cAAe,KACfD,cAAe,KACbzY,KAAK0Z,0BAA4B/W,EAAc2S,oBAAoB7T,IAAI,EAEzEkX,KAAK,8BACLC,YAAavH,EAAQvI,QAAQ+P,WAC7BC,aAAczH,EAAQvI,QAAQiQ,YAC9BC,aAAa,YACbC,cAAe,UACfC,WAAY7H,EAAQvI,QAAQqQ,iBAC5BC,UAAW,8E,sECnMvB,MAAMiC,GAA6B,kDACnC,MAAAC,GAAeD,G,MCYFE,GAAuB,M,yBAC1Bzc,SAAmB,GACnBF,OAAiB,GACjBC,WACAE,EAECK,cAAgB,KAChBiK,UAAwC,KAExCmS,QAAyB,GACzB5N,QACAlK,YACA+X,MAEDC,YAEAlc,aAAe,IAAIC,EACnBC,YAAc,IAAIC,EAClB+J,gBAAkB,IAAIC,EAE9B,iBAAA5J,GACEC,KAAK0b,YAAc,CACjB7N,KAAM,CACJnM,YAAaoM,IAASC,OAAO,aAC7B4N,aAAc7N,IAAS8N,QAAQ,SAAS7N,OAAO,cAC/C8N,YAAa/N,IAASgO,MAAM,SAAS/N,OAAO,eAE9CgO,sBAAuB,OAEzB/b,KAAK4N,QAAU5N,KAAK0b,YACpB,GAAI1b,KAAKpB,OAAQ,CACfoB,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKE,M,EAIT,kBAAAQ,CAAmBF,EAAkBC,GACnC,GAAID,IAAaC,EAAU,CACzBT,KAAKR,aAAaS,SAASD,KAAKpB,QAChCoB,KAAKE,M,EAIT,wBAAA8b,CAAyBpb,GACvBA,EAAEC,2BACFD,EAAEE,kBACFd,KAAK4N,QAAUhN,EAAEI,OACjBhB,KAAKic,Y,CAGC,UAAM/b,GACZ,IACE,IAAIgC,EAAalC,KAAKnB,WACtB,IAAKmB,KAAKnB,aAAemB,KAAKjB,EAAG,CAC/B,MAAM,IAAIkD,MAAM,sC,CAGlB,IAAKC,EAAY,CACf0J,QAAQG,IAAI7J,GACZ,MAAM8I,QAAqBhL,KAAKN,YAAYyC,mBAAmB,CAC7DC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,OAG3B1M,EAAa8I,EAAa5C,UAAUhG,E,CAEtCpC,KAAK0D,YAAcxB,EACnB,MAAM2M,EAAW,CAAC7O,KAAKN,YAAYoD,cAAc9C,KAAKlB,UAAWkB,KAAKic,cACtE,GAAIjc,KAAKnB,WAAY,CACnBgQ,EAASzD,KACPpL,KAAKN,YAAYyC,mBAAmB,CAClCC,GAAIpC,KAAKnB,WACTC,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,O,OAKzBnM,QAAQC,IAAImM,E,CAClB,MAAOtL,GACPqI,QAAQG,IAAIxI,E,SAEZvD,KAAKZ,cAAgB,K,EAIjB,gBAAM6c,CAAWtM,EAAkB,OACzC,IACE,MAAME,EAAgBC,IACb,CACLoM,IAAKpM,EAAOqM,KACZC,aAActM,EAAOuM,aACrBC,kBAAmBxM,EAAOyM,UAC1BC,IAAK1M,EAAO2M,IACZC,cAAe5M,EAAO6M,cACtBC,aAAc9M,GAAQ+M,eAG1B7c,KAAKqJ,UAAYsG,EAAkB,SAAW,SAC9C,MAAM9B,KAAEA,EAAIkO,sBAAEA,GAA0B/b,KAAK4N,QAE7C,MAAMiB,EAAW,CACf7O,KAAK0J,gBAAgBoT,gBAAgB,CACnC3H,UAAWtH,EAAK8N,aAChBvG,QAASvH,EAAKgO,YACdnY,YAAa1D,KAAK0D,YAClBwN,mBAAoBvB,KAIxB,GAAIoM,EAAuB,CACzBlN,EAASzD,KACPpL,KAAK0J,gBAAgBoT,gBAAgB,CACnC3H,UAAWrH,EAAOD,EAAK8N,aAAc,cAAcxK,KAAK,EAAG,QAAQpD,OAAO,cAC1EqH,QAAStH,EAAOD,EAAKgO,YAAa,cAAc1K,KAAK,EAAG,SAASpD,OAAO,cACxErK,YAAa1D,KAAK0D,c,CAKxB,MAAM6H,QAAgB9I,QAAQC,IAAImM,GAClC,MAAMkO,EAAiBxR,EAAQ,GAC/B,IAAIyR,EAAiC,GACrC,MAAMC,WAAEA,KAAeC,GAASH,EAEhC/c,KAAKyb,MAAQ,IAAKyB,GAElB,GAAInB,GAAyBxQ,EAAQoE,EAAkB,EAAI,GAAI,CAC7D,MAAMwN,EAAsB5R,EAAQoE,EAAkB,EAAI,GAC1D,IAAIyN,EAAmBD,EAAoBF,WAAWzR,IAAIqE,GAC1DmN,EAAkBC,EAAWzR,IAAIqE,GAAcrE,KAAI6R,IACjD,MAAMC,EAAWF,EAAiBjc,MAAKoc,GAAQA,EAAKrB,MAAQpO,EAAOuP,EAAQnB,IAAK,cAAc/K,KAAK,EAAG,SAASpD,OAAO,gBACtH,MAAO,IACFsP,EACHG,UAAWF,GAAY,KACxB,G,KAEE,CACLN,EAAkBC,EAAWzR,IAAIqE,E,CAEnC7P,KAAKwb,QAAU,IAAIwB,E,CACnB,MAAOpc,GACPgL,QAAQG,IAAInL,E,SAEZZ,KAAKqJ,UAAY,I,EAGrB,MAAArE,GACE,GAAIhF,KAAKZ,cAAe,CACtB,OAAO6F,EAAA,yB,CAET,OACEA,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,uBACAA,EAAA,WAASG,MAAM,yBAAyBO,MAAO,CAAE2B,IAAK,SACpDrC,EAAA,OAAKG,MAAM,qDACTH,EAAA,MAAIG,MAAM,gBAAc,mBACxBH,EAAA,aACE2C,KAAK,KACLwJ,UAAU,UACV/H,UAAWrJ,KAAKqJ,YAAc,SAC9BxB,KAAMwJ,EAAQvI,SAASwI,WACvBxJ,eAAgBC,MAAMnH,IACpBA,EAAEC,2BACFD,EAAEE,wBACId,KAAKic,WAAW,KAAK,EAE7B1K,SAAU,CAAEnL,OAAQ,QACpBoL,aAAa,QACbC,UAAU,OACVC,WAAY,CAAE,cAAe,WAGjCzM,EAAA,eACEA,EAAA,OAAKG,MAAM,uCAAuCO,MAAO,CAAE2B,IAAK,OAAQmW,WAAY,YAClFxY,EAAA,iBACE0T,KAAM3Y,KAAKyb,OAAOiC,yCAA2C,EAAI,mBAAqB,iBACtFC,UAAU,oBACVlW,MAAOzH,KAAKyb,MAAMmC,iBAAmB5d,KAAKyb,OAAOmC,iBAAiBC,QAAQ,GAAK,IAAM,KACrFC,SAAU,GAAG9d,KAAKyb,OAAOiC,yCAA2C,EAAI,GAAK,MAAM1d,KAAKyb,OAAOiC,yCAAyCG,QACtI,wBAIJ5Y,EAAA,iBACE0T,KAAK,QACLgF,UAAU,cACVlW,MAAOzH,KAAKyb,OAAOsC,iBAAmB/d,KAAKyb,OAAOsC,iBAAiBpa,WAAa,KAChFma,SAAS,WAGX7Y,EAAA,iBAAe0T,KAAK,aAAagF,UAAU,eAAelW,MAAOzH,KAAKyb,OAAOoB,cAAclZ,WAAYma,SAAS,WAEhH7Y,EAAA,iBACE0T,KAAK,WACLgF,UAAU,YACVlW,MAAOzH,KAAKyb,OAAOuC,SAAS3S,SAAW,EAAI,KAAOrL,KAAKyb,OAAOuC,UAAUxS,KAAIyS,GAAMnQ,EAAOmQ,EAAG9B,KAAM,cAAcpO,OAAO,KAAKmQ,OAAO,QAAOC,KAAK,OAC/IL,SAAU,GAAGjZ,KAAKuZ,OAAQpe,KAAKyb,MAAMuC,UAAUxS,KAAIyS,GAAMA,EAAGI,oBAAqB,oBAGrFpZ,EAAA,OAAKG,MAAM,uCAAuCO,MAAO,CAAE2B,IAAK,SAC9DrC,EAAA,qCAAmCoE,UAAWrJ,KAAKqJ,YAAc,SAAUjE,MAAM,eAAesW,YAAa1b,KAAK0b,cAClHzW,EAAA,oCAAkCuW,QAASxb,KAAKwb,a,2EC5N9D,MAAM8C,GAAsB,2CAC5B,MAAAC,GAAeD,G,MCWFE,GAAgB,M,yBACnB1f,SAAmB,GACnBF,OAAiB,GACjBC,WACAE,EACAsH,KAECgD,UAAwC,KACxCjK,cAAgB,KAEhBqf,UACAC,oBACA5U,kBAAuC,GACvC6U,WAEDvX,MAAQ,IAAI3H,EACZC,YAAc,IAAIC,EAClB+J,gBAAkB,IAAIC,EAEtB+R,YAAiC,CACvCkD,UAAW9Q,IAASqD,KAAK,EAAG,QAAQpD,OAAO,cAC3C8Q,QAAS/Q,IAASC,OAAO,cACzB+Q,UAAW,MACXC,OAAQ,EACRhD,sBAAuB,MACvB7K,mBAAoB,OAGtB,iBAAAnR,GACEC,KAAK0e,oBAAsB1e,KAAK0b,YAChC,GAAI1b,KAAKpB,OAAQ,CACfoB,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,EAKT,aAAAM,CAAclK,EAAkBC,GAC9B,GAAID,IAAaC,EAAU,CACzB,M,CAEFT,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,CAGC,mBAAMA,GACZ,IACE,IAAKpK,KAAKqG,KAAM,CACd,MAAM,IAAIpE,MAAM,wE,CAElB,IAAKjC,KAAKnB,YAAcmB,KAAKqG,OAAS,aAAerG,KAAKjB,EAAG,CAC3D,MAAM,IAAIkD,MAAM,+B,CAElB,GAAIjC,KAAKqG,OAAS,WAAY,CAC5B,MAAMzD,QAAiB5C,KAAK0J,gBAAgBvH,mBAAmB,CAC7DC,GAAIsC,OAAO1E,KAAKnB,YAAc,GAC9BwD,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,OAEdtC,KAAK2e,WAAa/b,EAASwF,UAAUhG,E,CAEvC,MAAMyM,EAA+B,EAAG7O,KAAKN,YAAYoD,cAAc9C,KAAKlB,WAC5E,GAAIkB,KAAKqG,OAAS,MAAO,CACvBwI,EAASmQ,QAAQhf,KAAK0J,gBAAgB4B,+BACtC,MAAO2T,SAAoBxc,QAAQC,IAAImM,GACvC7O,KAAK8J,kBAAoB,IAAKmV,E,CAGhCjf,KAAK0b,YAAc,IAAK1b,KAAK0b,YAAawD,WAAYlf,KAAK8J,mBAAmB0B,KAAIzM,GAAKA,EAAEqD,MACzFpC,KAAK0e,oBAAsB,IAAK1e,KAAK0b,mBAE/B1b,KAAKmf,iB,CACX,MAAO5b,GACPqI,QAAQG,IAAIxI,E,SAEZvD,KAAKZ,cAAgB,K,EAIjB,qBAAM+f,CAAgBxP,EAAkB,OAC9C,IACE,MAAMoM,sBAAEA,EAAqBmD,WAAEA,KAAeE,GAAiBpf,KAAK0e,oBACpE1e,KAAKqJ,UAAYsG,EAAkB,SAAW,SAC9C,MAAM0P,QAAqBrf,KAAK0J,gBAAgByV,gBAAgB,CAC9DjO,mBAAoBvB,KACjByP,EACHE,MAAOtf,KAAK2e,WAAa3e,KAAK2e,WAAWhb,WAAa4b,aACnDH,EACHF,WAAYlf,KAAK2e,WAAa,KAAOO,IAEvC,MAAMM,GAA2B7P,GAAmBoM,EACpD,IAAI0D,EAAqC,GACzC,GAAID,EAAyB,CAC3B,MAAME,QAA0B1f,KAAK0J,gBAAgByV,gBAAgB,CACnEG,MAAOtf,KAAK2e,WAAa3e,KAAK2e,WAAWhb,WAAa4b,aACnDH,EACHF,WAAYlf,KAAK2e,WAAa,KAAOO,EACrCN,UAAW9Q,EAAOsR,EAAaR,WAAWe,SAAS,EAAG,QAAQ5R,OAAO,cACrE8Q,QAAS/Q,EAAOsR,EAAaP,SAASc,SAAS,EAAG,QAAQ5R,OAAO,gBAGnE0R,EAAgBJ,EAAa7T,KAAI6R,IAC/B,MAAMC,EAAWoC,EAAkBve,MAAKoc,GAAQA,EAAKqC,OAAOC,gBAAkBxC,EAAQuC,OAAOC,gBAC7F,MAAO,IACFxC,EACHG,UAAWF,EAAWA,EAAW,KAClC,G,KAEE,CACLmC,EAAgBJ,EAAa7T,KAAIsU,IAAM,IAClCA,EACHtC,UAAW,Q,CAOf,MAAMuC,EAA6BC,IACjC,IAAKA,GAAWA,EAAQ3U,SAAW,EAAG,OAAO2U,EAG7C,MAAMC,EAAiBC,GACdA,GAAGtP,UAAY,KAIxB,MAAMuP,EAAaD,IACjB,MAAME,EAASF,EAAEN,OAAOjc,WAAWkc,cAAcQ,OACjD,MAAMC,EAAaL,EAAcC,GACjC,MAAO,GAAGE,MAAWE,GAAc,QAAQ,EAI7C,MAAMC,EAAY,CAACjR,EAAuBlO,KAChCkO,GAAK,IAAMlO,GAAK,GAI1B,MAAMof,EAAgB,CAACC,EAAkCC,KACvD,IAAKA,EAAU,OAAOD,EACtB,IAAKA,EAAM,MAAO,IAAKC,GAEvB,MAAO,CACLC,OAAQJ,EAAUE,EAAKE,OAAQD,EAASC,QACxCC,IAAKL,EAAUE,EAAKG,IAAKF,EAASE,KAClCC,QAASN,EAAUE,EAAKI,QAASH,EAASG,SAC1CjB,OAAQa,EAAKb,OACbkB,YAAaL,EAAKK,YAClBC,cAAeN,EAAKM,cACpBnQ,SAAU6P,EAAK7P,SAChB,EAIH,MAAMoQ,EAAU,IAAIhS,IAEpB,IAAK,MAAM8Q,KAAUE,EAAS,CAC5B,MAAM3Y,EAAM8Y,EAAUL,GACtB,MAAMmB,EAAWD,EAAQ7R,IAAI9H,GAE7B,IAAK4Z,EAAU,CAEbD,EAAQ5R,IAAI/H,EAAK,IAAKyY,G,KACjB,CAEL,MAAMoB,EAAwB,IACzBD,EACHN,OAAQJ,EAAUU,EAASN,OAAQb,EAAOa,QAC1CC,IAAK,EACLC,QAASN,EAAUU,EAASJ,QAASf,EAAOe,SAC5CrD,UAAWgD,EAAcS,EAASzD,UAAWsC,EAAOtC,YAEtDwD,EAAQ5R,IAAI/H,EAAK6Z,E,EAKrB,MAAMC,EAASxK,MAAMvK,KAAK4U,EAAQI,UAGlC,MAAMC,EAAeF,EAAOG,QAAO,CAACC,EAAKrB,IAAMqB,GAAOrB,EAAEW,SAAW,IAAI,GAEvE,GAAIQ,EAAe,EAAG,CACpB,IAAK,MAAMvB,KAAUqB,EAAQ,CAC3BrB,EAAOc,IAAOd,EAAOe,QAAUQ,EAAgB,IAG/C,GAAIvB,EAAOtC,UAAW,CACpB,MAAMgE,EAAgBL,EAAOG,QAAO,CAACC,EAAKrB,IAAMqB,GAAOrB,EAAE1C,WAAWqD,SAAW,IAAI,GACnF,GAAIW,EAAgB,EAAG,CACrB1B,EAAOtC,UAAUoD,IAAOd,EAAOtC,UAAUqD,QAAUW,EAAiB,G,IAM5E,OAAOL,CAAM,EAGfnhB,KAAKye,UAAY,IAAIsB,EAA0BN,G,CAC/C,MAAOlc,GACPqI,QAAQrI,MAAM,8BAA+BA,E,SAE7CvD,KAAKqJ,UAAY,I,EAGrB,MAAArE,GACE,GAAIhF,KAAKZ,cAAe,CACtB,OAAO6F,EAAA,yB,CAET,OACEA,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,uBACAA,EAAA,WAASG,MAAM,yBAAyBO,MAAO,CAAE2B,IAAK,SACpDrC,EAAA,OAAKG,MAAM,qDACTH,EAAA,MAAIG,MAAM,gBAAc,oBACxBH,EAAA,aACE2C,KAAK,KACLwJ,UAAU,UACV/H,UAAWrJ,KAAKqJ,YAAc,SAC9BxB,KAAMwJ,EAAQvI,QAAQwI,WACtBxJ,eAAgBC,MAAMnH,IACpBA,EAAEC,2BACFD,EAAEE,wBACId,KAAKmf,gBAAgB,KAAK,EAElC5N,SAAU,CAAEnL,OAAQ,QACpBoL,aAAa,QACbC,UAAU,OACVC,WAAY,CAAE,cAAe,WAIjCzM,EAAA,OAAKG,MAAM,uCAAuCO,MAAO,CAAE2B,IAAK,SAC9DrC,EAAA,+BACEoE,UAAWrJ,KAAKqJ,YAAc,SAC9B8O,eAAgBvX,IACdA,EAAEC,2BACFD,EAAEE,kBACFd,KAAK0e,oBAAsB,IAAK9d,EAAEI,QAClChB,KAAKmf,iBAAiB,EAExBrV,kBAAmB9J,KAAK8J,kBACxB4R,YAAa1b,KAAK0b,cAEpBzW,EAAA,6BAA2BoB,KAAMrG,KAAKqG,KAAMyD,kBAAmB9J,KAAK8J,kBAAmB1E,MAAM,YAAY4a,QAAShgB,KAAKye,c,sECpQnI,MAAMgD,GAAsB,2CAC5B,MAAAC,GAAeD,G,MCeFE,GAAgB,M,yBACnB7iB,SAAmB,GACnBF,OAAiB,GACjBC,WACAE,EAECsK,UAAwC,KACxCjK,cAAgB,KAChBsE,YACA+a,UACAmD,aACAriB,UAA6B,IAAIyP,IAElC5H,MAAQ,IAAI3H,EACZC,YAAc,IAAIC,EAClB+J,gBAAkB,IAAIC,EACtB/J,eAAiB,IAAIC,EAErB6b,YAAc,CACpBkD,UAAW9Q,IAASqD,KAAK,EAAG,QAAQpD,OAAO,cAC3C8Q,QAAS/Q,IAASC,OAAO,cACzB+Q,UAAW,MACXC,OAAQ,EACRhD,sBAAuB,OAGzB,iBAAAhc,GACEC,KAAK4hB,aAAe5hB,KAAK0b,YACzB,GAAI1b,KAAKpB,OAAQ,CACfoB,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,EAIT,aAAAM,CAAclK,EAAkBC,GAC9B,GAAID,IAAaC,EAAU,CACzB,M,CAEFT,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,CAEC,mBAAMA,GACZ,IACE,IAAIlI,EAAalC,KAAKnB,WACtB,IAAKmB,KAAKnB,aAAemB,KAAKjB,EAAG,CAC/B,MAAM,IAAIkD,MAAM,sC,CAGlB,IAAKC,EAAY,CACf0J,QAAQG,IAAI7J,GACZ,MAAM8I,QAAqBhL,KAAKN,YAAYyC,mBAAmB,CAC7DC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,OAG3B1M,EAAa8I,EAAa5C,UAAUhG,E,CAEtCpC,KAAK0D,YAAcxB,EACnB,MAAM2M,EAAW,CAAC7O,KAAKJ,eAAemD,aAAa/C,KAAKlB,UAAWkB,KAAKN,YAAYoD,cAAc9C,KAAKlB,UAAWkB,KAAK6hB,mBACvH,GAAI7hB,KAAKnB,WAAY,CACnBgQ,EAASzD,KACPpL,KAAKN,YAAYyC,mBAAmB,CAClCC,GAAIpC,KAAKnB,WACTC,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,O,CAK/B,MAAOrP,SAAmBkD,QAAQC,IAAImM,GACtC,MAAMiT,EAAkB,IAAI9S,IAC3BzP,EAAyBiM,KAAIuW,IAC5BD,EAAgB1S,IAAI2S,EAAQ3f,GAAI,CAC9B8X,KAAM6H,EAAQ7H,KACd/D,KAAM4L,EAAQ5L,MACd,IAEJnW,KAAKT,UAAYuiB,C,CACjB,MAAOve,GACPqI,QAAQG,IAAIxI,E,SAEZvD,KAAKZ,cAAgB,K,EAIjB,qBAAMyiB,CAAgBlS,EAAkB,OAC9C,MAAMqS,EAAmB7a,IAChB,CACL4a,QAAS5a,EAAK8a,QACdC,WAAY/a,EAAKgb,WACjBC,OAAQjb,EAAKwZ,OACb0B,WAAYlb,EAAKyZ,IACjB0B,QAASnb,EAAK0Z,QACd0B,iBAAkBpb,EAAK0V,eAG3B,IACE,MAAMd,sBAAEA,KAA0BqD,GAAiBpf,KAAK4hB,aACxD5hB,KAAKqJ,UAAYsG,EAAkB,SAAW,SAE9C,MAAM0P,QAAqBrf,KAAK0J,gBAAgBmY,gBAAgB,CAC9DvC,MAAOtf,KAAK0D,YACZwN,mBAAoBvB,KACjByP,IAGL,MAAMI,GAA2B7P,GAAmBoM,EAEpD,IAAI0D,EAA+B,GAEnC,GAAID,EAAyB,CAC3B,MAAME,QAA0B1f,KAAK0J,gBAAgBmY,gBAAgB,CACnEvC,MAAOtf,KAAK0D,YACZwN,mBAAoB,SACjBkO,EACHR,UAAW9Q,EAAOsR,EAAaR,WAAWe,SAAS,EAAG,QAAQ5R,OAAO,cACrE8Q,QAAS/Q,EAAOsR,EAAaP,SAASc,SAAS,EAAG,QAAQ5R,OAAO,gBAGnE0R,EAAgBJ,EAAa7T,KAAI6R,IAC/B,MAAMC,EAAWoC,EAAkBve,MAAKoc,GAAQA,EAAK0E,QAAQpC,gBAAkBxC,EAAQ4E,QAAQpC,gBAC/F,MAAO,CACLzd,GAAI4O,OACDgR,EAAgB3E,GACnBG,UAAWF,EAAW0E,EAAgB1E,GAAY,KACnD,G,KAEE,CACLmC,EAAgBJ,EAAa7T,KAAIsU,IAAM,CACrC1d,GAAI4O,OACDgR,EAAgBlC,GACnBtC,UAAW,Q,CASfxd,KAAKye,UAAY,IAAIgB,E,CACrB,MAAOlc,GACPqI,QAAQrI,MAAM,8BAA+BA,E,SAE7CvD,KAAKqJ,UAAY,I,EAGrB,MAAArE,GACE,GAAIhF,KAAKZ,cAAe,CACtB,OAAO6F,EAAA,yB,CAET,OACEA,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,uBACAA,EAAA,WAASG,MAAM,yBAAyBO,MAAO,CAAE2B,IAAK,SACpDrC,EAAA,OAAKG,MAAM,qDACTH,EAAA,MAAIG,MAAM,gBAAc,oBACxBH,EAAA,aACE2C,KAAK,KACLwJ,UAAU,UACV/H,UAAWrJ,KAAKqJ,YAAc,SAC9BxB,KAAMwJ,EAAQvI,QAAQwI,WACtBxJ,eAAgBC,MAAMnH,IACpBA,EAAEC,2BACFD,EAAEE,wBACId,KAAK6hB,gBAAgB,KAAK,EAElCtQ,SAAU,CAAEnL,OAAQ,QACpBoL,aAAa,QACbC,UAAU,OACVC,WAAY,CAAE,cAAe,WAGjCzM,EAAA,+BAA6Bud,aAAcxiB,KAAKye,YAChDxZ,EAAA,OAAKG,MAAM,uCAAuCO,MAAO,CAAE2B,IAAK,SAC9DrC,EAAA,oBACEoE,UAAWrJ,KAAKqJ,YAAc,SAC9B8O,eAAgBvX,IACdA,EAAEC,2BACFD,EAAEE,kBACFd,KAAK4hB,aAAehhB,EAAEI,OACtBhB,KAAK6hB,iBAAiB,EAExBzc,MAAM,eACNsW,YAAa1b,KAAK0b,cAEpBzW,EAAA,kBAAgB6c,gBAAiB9hB,KAAKT,UAAW6F,MAAM,YAAY4a,QAAShgB,KAAKye,c,sEC/M7F,MAAMgE,GAAsB,sDAC5B,MAAAC,GAAeD,G,MCeFE,GAAgB,M,yBACnB7jB,SAAmB,GACnBqK,QACAvK,OACAC,WACAE,EACA6jB,aAAwB,KACxBjX,aACAkX,iBACAC,OAECzZ,UAAY,KACZ2E,MAAgB,GAChBtK,YACAqf,kBAAmC,GAEpC3b,MAAQ,IAAI3H,EACZC,YAAc,IAAIC,EAClBqjB,YAAc,IAAIC,EAClBrjB,eAAiB,IAAIC,EAErBqjB,UAA0C,IAAIlU,IAC9CmU,OAEAC,aAAe,IAEvB,iBAAArjB,GACE,GAAIC,KAAKmJ,QAAS,CAChBnJ,KAAKoH,MAAM4C,WAAWhK,KAAKmJ,Q,CAE7B,GAAInJ,KAAKpB,OAAQ,CACfoB,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,EAKT,aAAAM,CAAclK,EAAkBC,GAC9B,GAAID,IAAaC,EAAU,CACzB,M,CAEFT,KAAKoH,MAAMnH,SAASD,KAAKpB,QACzBoB,KAAKoK,e,CAIP,qBAAMuP,CAAgB/Y,GACpBA,EAAEC,2BACFD,EAAEE,wBACId,KAAKqjB,Y,CAGL,mBAAMjZ,GACZ,IACE,GAAIpK,KAAKmJ,QAAS,CAChBnJ,KAAKoH,MAAM4C,WAAWhK,KAAKmJ,Q,CAE7BnJ,KAAKqJ,UAAY,KACjB,IAAInH,EAAalC,KAAKnB,WACtB,IAAKmB,KAAKnB,aAAemB,KAAKjB,EAAG,CAC/B,MAAM,IAAIkD,MAAM,sC,CAGlB,IAAKC,EAAY,CACf0J,QAAQG,IAAI7J,GACZ,MAAM8I,QAAqBhL,KAAKN,YAAYyC,mBAAmB,CAC7DC,GAAI,EACJC,MAAOrC,KAAKjB,EACZD,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,OAG3B1M,EAAa8I,EAAa5C,UAAUhG,E,CAEtCpC,KAAK0D,YAAcxB,EACnB,MAAM2M,EAAW,CAAC7O,KAAKsjB,iBAAkBtjB,KAAKqjB,aAAcrjB,KAAKN,YAAYoD,cAAc9C,KAAKlB,SAAU,CAAC,eAC3G,GAAIkB,KAAKnB,WAAY,CACnBgQ,EAASzD,KACPpL,KAAKN,YAAYyC,mBAAmB,CAClCC,GAAIpC,KAAKnB,WACTC,SAAUkB,KAAKlB,SACfwD,WAAY,KACZsM,wBAAyB,O,OAKzBnM,QAAQC,IAAImM,GAClB7O,KAAKmjB,OAASI,EAAG,oCACjBvjB,KAAKmjB,OAAOK,GAAG,OAAOzb,MAAM0b,UACpBzjB,KAAK0jB,oBAAoBD,EAAI,G,CAErC,MAAOlgB,GACPqI,QAAQG,IAAIxI,E,SAEZvD,KAAKqJ,UAAY,K,EAIb,yBAAMqa,CAAoBD,GAChC,MAAME,EAActb,KAAKub,MAAMH,GAC/B,IAAKE,EAAa,CAChB,M,CAGF,MAAME,OAAEA,EAAMC,IAAEA,EAAGC,QAAEA,GAAgEJ,EAErF,GAAIG,EAAIngB,aAAe3D,KAAK0D,YAAYC,WAAY,CAClD,M,CAGF,IAAIwd,EAAS9Y,KAAKub,MAAMG,GACxBnY,QAAQG,IAAI+X,EAAK3C,GAIjB,MAAM6C,EAA4D,CAChEC,eAAgBjkB,KAAKkkB,8BAEvB,MAAMC,EAAUH,EAAeH,GAC/B,GAAIM,EAAS,OACLA,EAAQC,KAAKpkB,KAAMmhB,E,KACpB,CACLvV,QAAQyY,KAAK,qBAAqBR,I,EAI/B,4BAAAK,CAA6B/C,GAClC,MAAMnT,EAAQ,IAAIhO,KAAKgO,OACvB,MAAMsW,EAAMtW,EAAMuW,WAAUC,GAAKA,EAAEpiB,KAAO+e,EAAO/e,KACjD,GAAIkiB,KAAS,EAAG,CACd1Y,QAAQyY,KAAK,QAAQlD,EAAO/e,gBAC5B,M,CAEF4L,EAAMsW,GAAO,IACRtW,EAAMsW,GACTG,kBAAmB,MAErBzkB,KAAKgO,MAAQA,C,CAGP,gBAAMqV,GACZ,MAAMrV,QAAchO,KAAKgjB,YAAY0B,wBAAwB,CAAEhhB,YAAa1D,KAAKnB,aACjFmB,KAAKgO,MAAQ,IAAIA,GAAOqB,MAAK,CAACsV,EAAUC,KACtC,MAAMC,EAAYL,IAChB,MAAMnO,EAAImO,EAAE/V,KAAK9K,WACjB,GAAI0S,IAAMrW,KAAKojB,aAAc,OAAO,EACpC,GAAI/M,IAAM,KAAM,OAAO,EACvB,OAAO,CAAC,EAGV,MAAMyO,EAAKD,EAASF,GAClBI,EAAKF,EAASD,GAChB,GAAIE,IAAOC,EAAI,CACb,OAAOD,EAAKC,C,CAYd,OAAOJ,EAAGK,SAAStV,cAAckV,EAAGI,SAAS,G,CAGzC,oBAAM1B,GACZ,MAAM2B,QAAYxiB,QAAQC,IAAI,CAAC1C,KAAKJ,eAAeslB,2BAA2B,cAAellB,KAAKJ,eAAeulB,WACjH,MAAMC,EAAeH,EAAI,IAAI7c,WAAWid,mBACxC,IAAK,MAAMzkB,KAAKqkB,EAAI,GAAI,CACtB,MAAMxd,EAAQ7G,EAAE,cAAcZ,KAAKlB,UAAUwmB,eAAiB,QAC9D,GAAIF,EAAajkB,MAAKokB,GAAKA,EAAE9jB,OAASb,EAAEW,YAAY,CAClDvB,KAAK+iB,kBAAkB3X,KAAK,CAAE3J,KAAMb,EAAEW,UAAWkG,S,CAEnDzH,KAAKkjB,UAAU9T,IAAIxO,EAAEW,UAAUoC,WAAY8D,E,EAG/C,oBAAAiF,GACE1M,KAAKmjB,OAAOqC,Y,CAEd,MAAAxgB,GACE,GAAIhF,KAAKqJ,UAAW,CAClB,OACEpE,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,uBACAA,EAAA,0B,CAIN,OACEA,EAACC,EAAI,KACHD,EAAA,iBACAA,EAAA,kBAAgBwgB,uBAAwB,CAAC,mBAAoB,0BAC7DxgB,EAAA,WAASG,MAAM,yBAAyBO,MAAO,CAAE2B,IAAK,SACpDrC,EAAA,OAAKG,MAAM,2DACTH,EAAA,MAAIG,MAAM,gBAAgBiM,EAAQvI,QAAQ4c,oBAG5CzgB,EAAA,OAAKG,MAAM,GAAGO,MAAO,CAAE2B,IAAK,SAC1BrC,EAAA,4BACEvB,YAAa1D,KAAK0D,YAClBmf,iBAAkB7iB,KAAK6iB,iBACvBE,kBAAmB/iB,KAAK+iB,kBACxBpX,aAAc3L,KAAK2L,aACnBga,oBAAqB,CAAC3lB,KAAKojB,aAAc,MAAMwC,SAAS5lB,KAAK2L,cAAchI,YAC3Euf,UAAWljB,KAAKkjB,UAChB9d,MAAM,OACNwd,aAAc5iB,KAAK2L,cAAchI,aAAe3D,KAAKojB,aACrDpV,MAAOhO,KAAKgO,U","ignoreList":[]}