import{r as e,c as t,h as i,g as s,F as o,H as a}from"./p-d239357b.js";import{B as n,r}from"./p-ae6a57a8.js";import{n as l,f as c,v as d,j as h,w as g,d as f,x as b,y as p,z as u}from"./p-ae2f332f.js";import{l as m,m as k,a as y,c as v,t as w,n as x,o as D}from"./p-8af1cf5e.js";import{h as _}from"./p-6c4ba7c0.js";import{E as Y,P as C}from"./p-f125a157.js";import{l as M}from"./p-4e493fea.js";import{c as E}from"./p-99cb260a.js";import{z as T,Z as S}from"./p-748cfd41.js";import{T as R}from"./p-e94220ef.js";import{h as I,g as L}from"./p-6bd0489d.js";import{H as B}from"./p-63d20f50.js";import{i as N}from"./p-6fec77c0.js";import{I as A}from"./p-518eace5.js";import{v as O}from"./p-4ed69de7.js";import"./p-bf44a732.js";import"./p-c5894a47.js";const z=".sc-igl-blocked-date-drawer-h{display:block;text-align:start}";const P=z;const H=class{constructor(i){e(this,i);this.blockedDateDrawerClosed=t(this,"blockedDateDrawerClosed",7)}open;label;fromDate;toDate;unitId;isLoading=false;blockDatesData={from_date:"",to_date:"",NOTES:"",pr_id:null,STAY_STATUS_CODE:null,DESCRIPTION:null,BLOCKED_TILL_DATE:null,BLOCKED_TILL_HOUR:null,BLOCKED_TILL_MINUTE:null};blockedDateDrawerClosed;bookingService=new n;async handleBlockDate(){try{this.isLoading=true;const e=(()=>{const e=l(this.blockDatesData.RELEASE_AFTER_HOURS!==null?Number(this.blockDatesData.RELEASE_AFTER_HOURS):null);return{from_date:this.fromDate,to_date:this.toDate,NOTES:this.blockDatesData.OPTIONAL_REASON||"",pr_id:this.unitId.toString(),STAY_STATUS_CODE:this.blockDatesData.OUT_OF_SERVICE?"004":this.blockDatesData.RELEASE_AFTER_HOURS===0?"002":"003",DESCRIPTION:this.blockDatesData.RELEASE_AFTER_HOURS||"",...e}})();await this.bookingService.blockUnit(e);this.closeDrawer()}catch(e){}finally{this.isLoading=false}}closeDrawer(){this.blockedDateDrawerClosed.emit();this.blockDatesData={from_date:"",to_date:"",NOTES:"",pr_id:null,STAY_STATUS_CODE:null,DESCRIPTION:null,BLOCKED_TILL_DATE:null,BLOCKED_TILL_HOUR:null,BLOCKED_TILL_MINUTE:null}}render(){return i("ir-drawer",{key:"df4ea602affe6c7d3a935a266c4af5fd26e8cffd",label:this.label,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeDrawer()},open:this.open},this.open&&i("igl-block-dates-view",{key:"2df2ebd96064ca5e71ddde03689cb273c66f9ae8",onDataUpdateEvent:e=>this.blockDatesData={...e.detail.data},fromDate:this.fromDate,toDate:this.toDate}),i("div",{key:"99f7020714059cbc7aa1d31cfc8a2e73be5233ce",slot:"footer",class:"ir__drawer-footer"},i("ir-custom-button",{key:"02f6d08008ee74be195ba6454e118f14b3e96b7a","data-drawer":"close",size:"medium",appearance:"filled",variant:"neutral"},"Cancel"),i("ir-custom-button",{key:"ea178b9248d29d323f3a9983589bc96daf9aa643",loading:this.isLoading,onClickHandler:()=>{this.handleBlockDate()},size:"medium",appearance:"accent",variant:"brand"},"Save")))}};H.style=P;const U=".sc-igl-booking-event-h{display:block;position:absolute;--ota-bar-width:2px;--stripe-period:20px;--split-border-width:5px;--split-border-color:var(--wa-color-text-normal)}.bookingEventBase.sc-igl-booking-event{position:absolute;width:100%;height:100%;border-radius:4px;background-color:rgb(49, 190, 241);transform:skewX(-22deg);cursor:pointer}.bookingEventBase.leftSplit.sc-igl-booking-event{border-left:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.rightSplit.sc-igl-booking-event{border-right:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.fullSplit.sc-igl-booking-event{border-right:var(--split-border-width) solid var(--split-border-color);border-left:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.fullSplit.skewedLeft.sc-igl-booking-event,.bookingEventBase.leftSplit.skewedLeft.sc-igl-booking-event{border-left:0}.bookingEventBase.fullSplit.skewedRight.sc-igl-booking-event,.bookingEventBase.leftSplit.skewedRight.sc-igl-booking-event{border-right:0}.bookingEventBase.pending.sc-igl-booking-event{border-width:2px;border-style:dashed;border-color:var(--wa-color-success-fill-loud)}.bookingEvent.sc-igl-booking-event{cursor:pointer}.ota-booking-event.sc-igl-booking-event{border-width:var(--ota-bar-width) !important}.bookingEventHiddenBase.sc-igl-booking-event{position:absolute;top:0;left:-4px;width:calc(100% + 8px)}.bookingEventBase.skewedLeft.sc-igl-booking-event::before,.bookingEventBase.skewedRight.sc-igl-booking-event::before{content:'';position:absolute;top:0;bottom:0;width:50%;height:100%;left:-4px;background-color:var(--ir-event-bg);border-radius:4px}.bookingEventBase.skewedLeft.sc-igl-booking-event::before{transform-origin:right;transform:skewX(22deg);border-top-left-radius:0;border-bottom-left-radius:0}.bookingEventBase.fullSplit.skewedLeft.sc-igl-booking-event::before,.bookingEventBase.leftSplit.skewedLeft.sc-igl-booking-event::before{border-left:var(--split-border-width) solid var(--split-border-color) !important;z-index:2;background-color:transparent}.bookingEventBase.fullSplit.skewedRight.sc-igl-booking-event::before,.bookingEventBase.leftRight.skewedRight.sc-igl-booking-event::before{border-right:var(--split-border-width) solid var(--split-border-color) !important;z-index:2;background-color:transparent}.bookingEventBase.skewedRight.sc-igl-booking-event::before{transform-origin:left;transform:skewX(22deg 0deg);border-top-right-radius:0;border-bottom-right-radius:0}.bookingEventBase.border.skewedLeft.sc-igl-booking-event::before{border:var(--ota-bar-width) solid #424242;border-right:0;border-left:0;border-top-right-radius:0;border-bottom-right-radius:0;top:calc(var(--ota-bar-width) * -1);height:20px;left:-4px}.bookingEventBase.border.skewedRight.sc-igl-booking-event::before{border:var(--ota-bar-width) solid #424242;border-left:0;border-right:0;border-top-left-radius:0;border-bottom-left-radius:0;top:calc(var(--ota-bar-width) * -1);height:20px;right:-4px}.bookingEventBase.striped-bar.fullSplit.skewedLeft.vertical.sc-igl-booking-event::after,.bookingEventBase.striped-bar.leftSplit.skewedLeft.vertical.sc-igl-booking-event::after{z-index:1;border-left:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.striped-bar.fullSplit.skewedRight.vertical.sc-igl-booking-event::after,.bookingEventBase.striped-bar.rightSplit.skewedRight.vertical.sc-igl-booking-event::after{z-index:1;border-right:var(--split-border-width) solid var(--split-border-color)}.bookingEventBase.striped-bar.vertical.sc-igl-booking-event::after{--stripe-angle:360deg}.bookingEventBase.striped-bar.sc-igl-booking-event::after{content:'';position:absolute;inset:0;border-radius:4px;background:repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-event-bg) 0,\n    var(--ir-event-bg) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  );backface-visibility:hidden}.bookingEventBase.skewedRight.striped-bar.sc-igl-booking-event::after,.bookingEventBase.border.skewedRight.sc-igl-booking-event::after{right:-8px}.bookingEventBase.skewedLeft.striped-bar.sc-igl-booking-event::after,.bookingEventBase.border.skewedLeft.sc-igl-booking-event::after{left:-8px}.bookingEventBase.striped-bar.animated.sc-igl-booking-event::after{background-size:28.28px 28.28px;backface-visibility:hidden;animation:stripes 0.8s linear infinite;will-change:background-position}@keyframes stripes{0%{background-position:0 0}100%{background-position:28.28px 0}}.bookingEventDragHandle.sc-igl-booking-event{position:absolute;top:0;width:15px;height:100%;opacity:0.1;background-color:rgba(0, 0, 0, 0.15);transform:skewX(-22deg);border-radius:4px;cursor:pointer}.sc-igl-booking-event-h:hover .bookingEventDragHandle.sc-igl-booking-event{display:block;opacity:1}.newEvent.sc-igl-booking-event-h:hover .bookingEventDragHandle.sc-igl-booking-event{display:none;opacity:1}.leftSide.sc-igl-booking-event{left:0}.rightSide.sc-igl-booking-event{right:0}.leftSide.skewedLeft.sc-igl-booking-event{transform:skewX(0)}.rightSide.skewedRight.sc-igl-booking-event{transform:skewX(0)}.bookingEventTitle.sc-igl-booking-event{position:relative;top:2px;left:5px;max-width:calc(100% - 10px);color:#fff;font-size:0.8em;overflow:hidden;text-overflow:ellipsis;-webkit-user-select:none;user-select:none;-webkit-user-drag:none;cursor:pointer}.legend_circle.sc-igl-booking-event{width:10px;height:10px;margin:3px 3px 3px 2px;border:1px solid #fff;border-radius:100%}.noteIcon.sc-igl-booking-event{position:absolute;bottom:-8px;left:2px}.balanceIcon.sc-igl-booking-event{position:absolute;top:-8px;right:2px}.splitBooking.sc-igl-booking-event{border-right:2px solid #000000}.bookingEventTitle.pending.sc-igl-booking-event{color:var(--wa-color-success-on-quiet) !important}";const F=U;const j=class{constructor(i){e(this,i);this.hideBubbleInfo=t(this,"hideBubbleInfo",7);this.updateEventData=t(this,"updateEventData",7);this.dragOverEventData=t(this,"dragOverEventData",7);this.showRoomNightsDialog=t(this,"showRoomNightsDialog",7);this.showDialog=t(this,"showDialog",7);this.resetStretchedBooking=t(this,"resetStretchedBooking",7);this.toast=t(this,"toast",7);this.updateBookingEvent=t(this,"updateBookingEvent",7)}get element(){return s(this)}currency;is_vacation_rental=false;language;bookingEvent;allBookingEvents=[];countries;hideBubbleInfo;updateEventData;dragOverEventData;showRoomNightsDialog;showDialog;resetStretchedBooking;toast;updateBookingEvent;renderElement=false;position;isShrinking=null;dayWidth=0;eventSpace=8;vertSpace=10;showInfoPopup=false;bubbleInfoTopSide=false;isStretch=false;eventsService=new Y;bookingService=new n;resizeSide="";isDragging=false;initialX;initialY;currentX;currentY;initialWidth;initialLeft;finalWidth;dragInitPos;dragEndPos;elementRect;isTouchStart;moveDifferenceX;moveDifferenceY;animationFrameId=null;handleMouseMoveBind=this.handleMouseMove.bind(this);handleMouseUpBind=this.handleMouseUp.bind(this);handleClickOutsideBind=this.handleClickOutside.bind(this);role="";componentWillLoad(){window.addEventListener("click",this.handleClickOutsideBind);this.bookingEvent.SPLIT_INDEX=m(this.bookingEvent.ROOMS);if(this.bookingEvent.SPLIT_INDEX){this.role=k(this.bookingEvent.SPLIT_INDEX,this.bookingEvent.IDENTIFIER)??""}}componentDidLoad(){if(this.isNewEvent()){if(!this.bookingEvent.hideBubble){setTimeout((async()=>{if(["003","002","004"].includes(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}else{this.showEventInfo(true)}this.renderAgain()}),1)}}}disconnectedCallback(){window.removeEventListener("click",this.handleClickOutsideBind);if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}}handleClickOutside(e){const t=e.target;if(!this.element.contains(t)){this.showEventInfo(false)}}hideBubbleInfoPopup(e){if(e.detail.currentInfoBubbleId!=this.getBookingId()||e.detail.key==="hidebubble"&&e.detail.currentInfoBubbleId===this.getBookingId()){this.showInfoPopup=false;this.renderAgain()}}async moveBookingToHandler(e){try{if(e.detail.bookingId!==this.getBookingId()){this.showEventInfo(false);return}if(e.detail.moveToDay==="revert"||e.detail.toRoomId==="revert"){e.detail.moveToDay=this.bookingEvent.FROM_DATE;e.detail.toRoomId=e.detail.fromRoomId;if(this.isTouchStart&&this.moveDifferenceX<=5&&this.moveDifferenceY<=5&&!this.isStretch){if(c(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}}else{this.animationFrameId=requestAnimationFrame((()=>{this.resetBookingToInitialPosition()}));return}}else{if(this.isTouchStart&&this.moveDifferenceX<=5&&this.moveDifferenceY<=5&&!this.isStretch){if(c(this.bookingEvent.STATUS_CODE)){this.showEventInfo(true)}else if(["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"].includes(this.bookingEvent.STATUS)){await this.fetchAndAssignBookingData()}}else{const{pool:t,to_date:i,from_date:s,toRoomId:o}=e.detail;const a=_(i,"YYYY-MM-DD").add(-1,"days").format("YYYY-MM-DD");console.log(this.findRoomType(Number(this.bookingEvent.PR_ID)),this.findRoomType(Number(o)));if((!_(this.bookingEvent.TO_DATE,"YYYY-MM-DD").isSame(_(i,"YYYY-MM-DD"),"dates")||this.findRoomType(Number(this.bookingEvent.PR_ID))!==this.findRoomType(Number(o)))&&(y.disabled_cells.get(`${o}_${s}`)?.disabled||y.disabled_cells.get(`${o}_${i}`)?.disabled&&y.disabled_cells.get(`${o}_${a}`)?.disabled)&&!this.isStretch){this.reset("This room isnâ€™t available for the entire selected period. Please choose different dates or a different room.")}if(this.checkIfSlotOccupied(o,s,i)){this.reset("Overlapping Dates")}if(t){if(c(this.bookingEvent.STATUS_CODE)){await this.eventsService.reallocateEvent(t,o,s,i).catch((()=>{this.resetBookingToInitialPosition()}))}else{if(this.isShrinking||!this.isStretch){const{description:t,status:a,newRatePlans:n,matchedRatePlan:r}=this.getModalDescription(o,s,i);let l=false;if(a==="400"){l=true}const c=this.bookingEvent.defaultDates.from_date;const d=this.bookingEvent.defaultDates.to_date;const h=v(c,d);let g=null;let f=c;let b=d;if(this.isShrinking){if(_(s,"YYYY-MM-DD").isAfter(_(c,"YYYY-MM-DD"))&&_(i,"YYYY-MM-DD").isBefore(_(d,"YYYY-MM-DD"))){f=c;b=i}else{g=_(s,"YYYY-MM-DD").isAfter(_(c,"YYYY-MM-DD"))?"left":_(i,"YYYY-MM-DD").isBefore(_(d,"YYYY-MM-DD"))?"right":null;if(g==="left"){f=s}if(g==="right"){b=i}}}else{console.log("stretching");if(_(s,"YYYY-MM-DD").isBefore(_(c,"YYYY-MM-DD"))){f=s;const e=_(s,"YYYY-MM-DD").add(h,"days");b=e.isBefore(_(i,"YYYY-MM-DD"),"days")?i:e.format("YYYY-MM-DD")}else if(_(i,"YYYY-MM-DD").isAfter(_(d,"YYYY-MM-DD"))){b=i;f=_(i,"YYYY-MM-DD").subtract(h,"days").format("YYYY-MM-DD")}}console.warn({fromDate:f,toDate:b});this.showDialog.emit({reason:"reallocate",...e.detail,description:t,title:"",rateplans:n,matchedRatePlan:r,hideConfirmButton:l,from_date:f,to_date:b})}else{const e=this.bookingEvent.defaultDates.from_date;const a=this.bookingEvent.defaultDates.to_date;const n=(e,t)=>{let i=e;let s=0;while(i!==t){if(y.disabled_cells.get(`${o}_${i}`)?.disabled){s++}i=_(i,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD")}if(s>=1){this.reset(M.entries.Lcz_ThisUnitIsNotAvailable)}};if(_(a,"YYYY-MM-DD").isBefore(_(i),"dates")){n(a,i)}else if(_(e,"YYYY-MM-DD").isAfter(_(s,"YYYY-MM-DD"),"dates")){n(s,e)}const r={booking:this.bookingEvent,bookingNumber:this.bookingEvent.BOOKING_NUMBER,identifier:this.bookingEvent.IDENTIFIER,to_date:i,pool:t,from_date:s,defaultDates:this.bookingEvent.defaultDates};if(!this.bookingEvent.is_direct){this.showDialog.emit({reason:"stretch",...r})}else{this.showRoomNightsDialog.emit(r)}}}this.isShrinking=null}}}}catch(e){this.toast.emit({position:"top-right",title:e.message,description:"",type:"error"});console.log("something went wrong")}}buildBarIds(){const e=this.getBookingId();return{bar:`event_${e}`,lateCheckout:`event_late_checkout_${e}`,balance:`event_balance_${e}`}}async fetchAndAssignBookingData(){try{console.log("clicked on book#",this.bookingEvent.BOOKING_NUMBER);const e=["IN-HOUSE","CONFIRMED","PENDING-CONFIRMATION","CHECKED-OUT"];if(!e.includes(this.bookingEvent.STATUS)){return}const t=await this.bookingService.getExposedBooking(this.bookingEvent.BOOKING_NUMBER,"en");const i={...t};const s=t.rooms.filter((e=>e["assigned_units_pool"]===this.bookingEvent.ID));if(s.length===0){throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty array`)}if(s.some((e=>e["assigned_units_pool"]===null))){throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty pool`)}t.rooms=s;const o=w(t)[0];const{ID:a,TO_DATE:n,FROM_DATE:r,NO_OF_DAYS:l,STATUS:c,NAME:d,IDENTIFIER:h,origin:g,TOTAL_PRICE:f,PR_ID:b,POOL:p,BOOKING_NUMBER:u,NOTES:m,is_direct:k,BALANCE:y,channel_booking_nbr:v,...x}=o;this.bookingEvent={...x,...this.bookingEvent,channel_booking_nbr:v,booking:t,base_booking:i,DEPARTURE_TIME:x.DEPARTURE_TIME,PHONE:x.PHONE,PHONE_PREFIX:x.PHONE_PREFIX,PRIVATE_NOTE:x.PRIVATE_NOTE,origin:g,BALANCE:y,TOTAL_PRICE:f,ROOM_INFO:{...this.bookingEvent.ROOM_INFO,sharing_persons:x.ROOM_INFO.sharing_persons}};this.updateBookingEvent.emit(this.bookingEvent);this.showEventInfo(true)}catch(e){console.error(e.message)}}reset(e){this.animationFrameId=requestAnimationFrame((()=>{this.resetBookingToInitialPosition()}));throw new Error(e)}findRoomType=e=>{let t=this.bookingEvent.roomsInfo.filter((t=>t.physicalrooms.some((t=>t.id===+e))));if(t.length){return t[0].id}return null};getModalDescription(e,t,i){if(!this.bookingEvent.is_direct){if(this.isShrinking){return{description:M.entries.Lcz_OTA_Modification_Alter,status:"200"}}else{if(_(t,"YYYY-MM-DD").isSame(_(this.bookingEvent.FROM_DATE,"YYYY-MM-DD"))&&_(i,"YYYY-MM-DD").isSame(_(this.bookingEvent.TO_DATE,"YYYY-MM-DD"))){const t=this.findRoomType(this.bookingEvent.PR_ID);const i=this.findRoomType(e);if(t===i){return{description:`${M.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`,status:"200"}}else{const e=d({rateplan_id:this.bookingEvent.RATE_PLAN_ID,roomTypeId:i,roomTypes:E?.property?.roomtypes});return{description:M.entries.Lcz_OTA_Modification_Alter,status:"200",newRatePlans:Array.isArray(e)?e:undefined,matchedRatePlan:Array.isArray(e)?null:e}}}return{description:M.entries.Lcz_CannotChangeCHBookings+".",status:"400"}}}else{if(!this.isShrinking){const t=this.findRoomType(Number(this.bookingEvent.PR_ID));const i=this.findRoomType(Number(e));if(t===i){console.log("same rt");if(this.bookingEvent.PR_ID.toString()===e.toString()){return{description:M.entries.Lcz_ConfrmModiication+".",status:"200"}}return{description:`${M.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`,status:"200"}}else{const e=d({rateplan_id:this.bookingEvent.RATE_PLAN_ID,roomTypeId:i,roomTypes:E?.property?.roomtypes});return{description:M.entries.Lcz_SameRatesWillBeKept,status:"200",newRatePlans:Array.isArray(e)?e:undefined,matchedRatePlan:Array.isArray(e)?null:e}}}return{description:M.entries.Lcz_ConfrmModiication+".",status:"200"}}}resetBookingToInitialPosition(){if(this.isStretch){this.element.style.left=`${this.initialLeft}px`;this.element.style.width=`${this.initialWidth}px`;this.isStretch=false;this.finalWidth=this.initialWidth;this.isShrinking=null}else{this.element.style.top=`${this.dragInitPos.top}px`;this.element.style.left=`${this.dragInitPos.left}px`}}handleRevertBooking(e){if(this.bookingEvent.POOL===e.detail){this.resetBookingToInitialPosition()}}checkIfSlotOccupied(e,t,i){const s=_(t,"YYYY-MM-DD");const o=_(i,"YYYY-MM-DD");const a=this.allBookingEvents.some((t=>{if(t.POOL===this.bookingEvent.POOL){return false}const i=_(t.FROM_DATE,"YYYY-MM-DD").add(1,"days");const a=_(t.TO_DATE,"YYYY-MM-DD");return t.PR_ID===+e&&o.isSameOrAfter(i)&&s.isBefore(a)}));return a}renderAgain(){this.renderElement=!this.renderElement}getUniqueId(){return(new Date).getTime()}isSplitBooking(){return!!this.bookingEvent.SPLIT_BOOKING}isNewEvent(){return this.getBookingId()==="NEW_TEMP_EVENT"}isHighlightEventType(){return this.getEventType()==="HIGH_LIGHT"}getBookingId(){return this.bookingEvent.ID}getBookingStatus(){return this.bookingEvent.STATUS}getBookedBy(){return this.bookingEvent.NAME}getBookedRoomId(){return this.bookingEvent.PR_ID}getEventStartingDate(){return new Date(this.bookingEvent.FROM_DATE)}getEventEndingDate(){return new Date(this.bookingEvent.TO_DATE)}getEventType(){return this.bookingEvent.event_type}getEventLegend(){let e=this.bookingEvent?.legendData.statusId[this.getBookingStatus()];let t=this.isNewEvent()?{color:"#f9f9c9"}:{};return{...this.bookingEvent?.legendData[e.id],...e,...t}}getLegendOfStatus(e){let t=this.bookingEvent?.legendData.statusId[e];return{...this.bookingEvent.legendData[t.id],...t}}getNoteNode(){if(this.bookingEvent.NOTES||this.bookingEvent.INTERNAL_NOTE||this.bookingEvent.PRIVATE_NOTE){return this.getLegendOfStatus("NOTES")}return null}getBalanceNode(){if(this.bookingEvent.BALANCE!==null&&this.bookingEvent.BALANCE>=1){return this.getLegendOfStatus("OUTSTANDING-BALANCE")}return null}setStayDays(e){this.bookingEvent.NO_OF_DAYS=e;this.renderAgain()}getStayDays(){return this.bookingEvent.NO_OF_DAYS}getPosition(){let e=this.getEventStartingDate();let t=".room_"+this.getBookedRoomId()+"_"+e.getDate()+"_"+(e.getMonth()+1)+"_"+e.getFullYear();let i=document.querySelector(".bodyContainer");let s=document.querySelector(t);let o={top:"0",left:"0",width:"0",height:"20px"};if(s&&i&&s.getBoundingClientRect()&&i.getBoundingClientRect()){let e=i.getBoundingClientRect();let t=s.getBoundingClientRect();this.dayWidth=this.dayWidth||t.width;o.top=t.top+t.height/2-this.vertSpace-e.top+"px";o.left=t.left+(!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?0:this.dayWidth/2)+this.eventSpace/2-e.left+"px";o.width=(this.getStayDays()+(!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?.5:0))*this.dayWidth-this.eventSpace+"px"}else{console.log(this.bookingEvent);console.log("Locating event cell failed ",t)}return o}getNumber(e){return e?parseFloat(e):0}startDragging(e,t){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();if(this.isNewEvent()||this.isHighlightEventType()){return null}this.resizeSide=t;this.isDragging=true;this.showEventInfo(false);this.isStretch=t!=="move";if(t==="move"){this.initialX=e.clientX||e.touches[0].clientX;this.initialY=e.clientY||e.touches[0].clientY;this.elementRect=this.element.getBoundingClientRect();const t=0;const i=0;this.dragInitPos={id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.getNumber(this.element.style.top)+i,left:this.getNumber(this.element.style.left)+t};this.dragInitPos.x=this.dragInitPos.left;this.dragInitPos.y=this.dragInitPos.top;this.dragEndPos={...this.dragInitPos};this.element.style.top=`${this.dragInitPos.top}px`;this.element.style.left=`${this.dragInitPos.left}px`;this.isTouchStart=true;this.dragOverEventData.emit({id:"CALCULATE_DRAG_OVER_BOUNDS",data:this.dragInitPos})}else{this.initialWidth=this.element.offsetWidth;this.initialLeft=this.element.offsetLeft;this.initialX=e.clientX||e.touches[0].clientX;this.dragOverEventData.emit({id:"CALCULATE_DRAG_OVER_BOUNDS",data:{id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.getNumber(this.element.style.top),left:this.initialLeft,x:this.initialX,y:e.clientY||e.touches[0].clientY}})}document.addEventListener("mousemove",this.handleMouseMoveBind);document.addEventListener("touchmove",this.handleMouseMoveBind);document.addEventListener("pointermove",this.handleMouseMoveBind);document.addEventListener("mouseup",this.handleMouseUpBind);document.addEventListener("touchup",this.handleMouseUpBind);document.addEventListener("pointerup",this.handleMouseUpBind)}handleMouseMove(e){if(this.isDragging){this.currentX=e.clientX||e.touches[0].clientX;let t=this.currentX-this.initialX;if(this.resizeSide==="move"){this.currentY=e.clientY||e.touches[0].clientY;let i=this.currentY-this.initialY;this.element.style.top=`${this.dragInitPos.top+i}px`;this.element.style.left=`${this.dragInitPos.left+t}px`;this.dragEndPos={id:this.getBookingId(),fromRoomId:this.getBookedRoomId(),top:this.dragInitPos.top+i,left:this.dragInitPos.left+t};this.dragEndPos.x=this.dragEndPos.left;this.dragEndPos.y=this.dragEndPos.top;this.dragOverEventData.emit({id:"DRAG_OVER",data:this.dragEndPos})}else{if(this.role==="fullSplit"){return}const e=!this.bookingEvent.is_direct&&!c(this.bookingEvent.STATUS_CODE);let i=this.initialWidth;if(this.resizeSide=="rightSide"){i=this.initialWidth+t;i=Math.min(i,this.initialX+this.element.offsetWidth);i=Math.max(this.dayWidth-this.eventSpace,i);this.isShrinking=t<0;if(!this.isShrinking&&e){return}if(this.role==="rightSplit"){return}this.element.style.width=`${i}px`}else if(this.resizeSide=="leftSide"){this.isShrinking=t>0;if(!this.isShrinking&&e){return}if(this.role==="leftSplit"){return}i=Math.max(this.dayWidth-this.eventSpace,this.initialWidth-t);let s=this.initialLeft+(this.initialWidth-i);this.element.style.left=`${s}px`;this.element.style.width=`${i}px`}this.finalWidth=i}}else{console.log("still mouse move listening...")}}handleMouseUp(){if(this.isDragging){if(this.resizeSide==="move"){if(this.isTouchStart){this.moveDifferenceX=Math.abs(this.dragEndPos.x-this.dragInitPos.x);this.moveDifferenceY=Math.abs(this.dragEndPos.y-this.dragInitPos.y)}this.dragOverEventData.emit({id:"DRAG_OVER_END",data:{...this.dragEndPos,pool:this.bookingEvent.POOL,nbOfDays:this.bookingEvent.NO_OF_DAYS}})}else{const e=this.finalWidth-(!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?this.dayWidth/2:0);const t=Math.round(e/this.dayWidth);console.log(e,this.dayWidth,t);let i=this.getStayDays();if(i!=t&&!isNaN(t)){if(this.resizeSide=="leftSide"){this.element.style.left=`${this.initialLeft+(i-t)*this.dayWidth}px`}else{if(t<i){this.isShrinking=true}}this.dragOverEventData.emit({id:"STRETCH_OVER_END",data:{id:this.getBookingId(),fromRoomId:+this.getBookedRoomId(),x:+this.element.style.left.replace("px",""),y:+this.element.style.top.replace("px",""),pool:this.bookingEvent.POOL,nbOfDays:t}});const e=!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?+this.dayWidth/2:0;this.element.style.width=`${t*this.dayWidth-this.eventSpace+e}px`}else{this.element.style.left=`${this.initialLeft}px`;this.element.style.width=`${t*this.dayWidth-this.eventSpace}px`}}}else{console.log("still mouse up listening...")}this.isDragging=false;document.removeEventListener("mousemove",this.handleMouseMoveBind);document.removeEventListener("touchmove",this.handleMouseMoveBind);document.removeEventListener("pointermove",this.handleMouseMoveBind);document.removeEventListener("mouseup",this.handleMouseUpBind);document.removeEventListener("touchup",this.handleMouseUpBind);document.removeEventListener("pointerup",this.handleMouseUpBind)}updateData(e){this.updateEventData.emit(e)}calculateHoverPosition(){const e=this.element.getBoundingClientRect();const t=e.width;const i=e.left;const s=window.innerWidth;let o;if(t<=s){o=t/2}else{o=s/2-i}return{position:"absolute",left:`${o}px`,transform:"translateX(-50%)"}}renderEventBookingNumber(){if(this.bookingEvent.STATUS==="TEMP-EVENT"||this.bookingEvent.ID==="NEW_TEMP_EVENT"){return""}if(c(this.bookingEvent.STATUS_CODE)){return""}if(!this.bookingEvent.is_direct){return` - ${this.bookingEvent.channel_booking_nbr}`}return` - ${this.bookingEvent.BOOKING_NUMBER}`}showEventInfo(e){if(this.isHighlightEventType()||this.bookingEvent.hideBubble){return null}if(e){let e=document.querySelector(".calendarScrollContainer");let t=e.getBoundingClientRect();let i=this.element.getBoundingClientRect();let s=t.height/2+t.top+50;if(i.top<s){this.bubbleInfoTopSide=false}else{this.bubbleInfoTopSide=true}}if(e){this.hideBubbleInfo.emit({key:"hidePopup",currentInfoBubbleId:this.getBookingId()})}this.showInfoPopup=e;this.renderAgain()}isDepartureAfterHotelCheckout(){if(E.property.is_automatic_check_in_out){return}const e=this.bookingEvent.DEPARTURE_TIME;if(!e?.code){return false}const t=_(E.property.time_constraints.check_out_till,"HH:mm");const i=_(e.description,"HH:mm");return t.isBefore(i)}computeSplitRole(){const e=m(this.bookingEvent.ROOMS);let t=null;if(e){t=k(e,this.bookingEvent.IDENTIFIER)??""}return t}render(){let e=this.getEventLegend();let t=this.getNoteNode();let s=this.getBalanceNode();const{balance:n,bar:r,lateCheckout:l}=this.buildBarIds();let d=this.bookingEvent.ROOM_INFO?.calendar_extra?this.bookingEvent.ROOM_INFO.calendar_extra?.booking_color?.color??e.color:e.color;const{foreground:g,stripe:f}=E.colorsForegrounds?.[d]??{foreground:"",checkout:""};const b=this.isDepartureAfterHotelCheckout();d=this.bookingEvent.STATUS==="CHECKED-OUT"?e.color:d;const p=this.computeSplitRole();const u=this.bookingEvent.STATUS==="PENDING-CONFIRMATION";return i(a,{key:"eb127cd69809d746ab226628e0c0676323446a1c",class:`bookingEvent  ${this.isNewEvent()||this.isHighlightEventType()?"newEvent":""} ${e.clsName} `,style:this.getPosition(),id:r},i("div",{key:"b055009622f436198e4603755ebba0f03e7ee97f",class:{bookingEventBase:true,pending:u,skewedLeft:!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)),skewedRight:!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)),"striped-bar vertical":this.bookingEvent.STATUS==="IN-HOUSE","striped-bar animated":c(this.bookingEvent.STATUS_CODE)&&this.bookingEvent.STATUS_CODE==="003","border border-dark ota-booking-event":!this.bookingEvent.is_direct&&!c(this.bookingEvent.STATUS_CODE)&&this.bookingEvent.STATUS!=="TEMP-EVENT"&&this.bookingEvent.ID!=="NEW_TEMP_EVENT",[p]:true},style:{backgroundColor:d,"--ir-event-bg":d,"--ir-event-bg-stripe-color":f},onTouchStart:e=>this.startDragging(e,"move"),onMouseDown:e=>this.startDragging(e,"move")}),b&&i("wa-tooltip",{key:"0e530e20617718e489947db07bd1cd0c3d80e787",for:l},"Departure time: ",this.bookingEvent.DEPARTURE_TIME?.description),s&&i("wa-tooltip",{key:"b290b9250a3ca5e3ea2ac331607df57d586f655a",for:n},"Balance: ",h(E.property.currency.symbol,this.bookingEvent.BALANCE)),t?i("div",{class:"legend_circle noteIcon",style:{backgroundColor:t.color}}):null,(s||b)&&i("div",{key:"c5fa2900080493585f7b8808ba28f0a5326b77ce",class:"balanceIcon d-flex"},b&&i("div",{key:"8ae68a47d144b9a3169859356bc47de5ab3e528c",id:l,class:"legend_circle",style:{backgroundColor:"#999999"}}),s?i("div",{id:n,class:"legend_circle",style:{backgroundColor:"#f34752"}}):null),i("div",{key:"afec5d2571d14ccc46a4c02a2690b7a254bde72b",class:`bookingEventTitle ${u?"pending":""}`,style:!u&&{color:g},onTouchStart:e=>this.startDragging(e,"move"),onMouseDown:e=>this.startDragging(e,"move")},this.getBookedBy(),this.renderEventBookingNumber()),i(o,{key:"b34e91c045203d870b875cec9049e9ccd171182d"},i("div",{key:"b21f41cf7d1068b9ced3563d31e6ecbb6c7498df",class:`bookingEventDragHandle leftSide ${!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?"skewedLeft":""}\n            ${!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE))?"skewedRight":""}`,onTouchStart:e=>this.startDragging(e,"leftSide"),onMouseDown:e=>this.startDragging(e,"leftSide")}),i("div",{key:"994bd0b1cb14e51924dc48230ffd8d96e81eb288",class:`bookingEventDragHandle rightSide ${!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE))?"skewedLeft":""}\n              ${!this.isNewEvent()&&_(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE))?"skewedRight":""}`,onTouchStart:e=>this.startDragging(e,"rightSide"),onMouseDown:e=>this.startDragging(e,"rightSide")})),this.showInfoPopup?i("igl-booking-event-hover",{is_vacation_rental:this.is_vacation_rental,countries:this.countries,currency:this.currency,class:"top",bookingEvent:this.bookingEvent,bubbleInfoTop:this.bubbleInfoTopSide,style:this.calculateHoverPosition()}):null)}};j.style=F;class V{isActive=false;onIntercept;constructor(e){this.onIntercept=e.onIntercept??(()=>{});if(e.autoActivate){this.activate()}}activate(){if(this.isActive)return;window.addEventListener("beforeunload",this.handleBeforeUnload,{capture:true});this.isActive=true}deactivate(){if(!this.isActive)return;window.removeEventListener("beforeunload",this.handleBeforeUnload,{capture:true});this.isActive=false}handleBeforeUnload=e=>{this.onIntercept();e.preventDefault();e.returnValue=""}}const W=".sc-igl-bulk-block-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-bulk-block{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-bulk-block{transition:all 0.5s ease}.physical-room.sc-igl-bulk-block{margin-left:1rem !important;padding-top:0.5rem}.physical-room.sc-igl-bulk-block>td.sc-igl-bulk-block:last-child{padding-left:1rem}.room-type-list.sc-igl-bulk-block{padding:0;margin:0}.room-type-list.sc-igl-bulk-block>li.sc-igl-bulk-block,.physical-room.sc-igl-bulk-block,.room-type-row.sc-igl-bulk-block{list-style:none}";const q=W;const G=".sc-igl-bulk-block-h{height:100%}.sheet-container.sc-igl-bulk-block{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-block{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-block{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-block{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-block{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-block{flex-direction:row;align-items:center}}";const K=G;const X=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.toast=t(this,"toast",7)}maxDatesLength=8;property_id;selectedRoomTypes=new Map;selectedUnit=null;errors;isLoading;blockState="block";dates=[{from:null,to:null}];closeModal;toast;sidebar;dateRefs=[];reloadInterceptor;minDate=_().format("YYYY-MM-DD");bookingService=new n;datesSchema=T.array(T.object({from:T.any().refine((e=>_.isMoment(e)),{message:"Invalid 'from' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD"))),to:T.any().refine((e=>_.isMoment(e)),{message:"Invalid 'to' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD")))}));unitSections;datesSections;componentDidLoad(){this.reloadInterceptor=new V({autoActivate:false});this.sidebar=document.querySelector("ir-sidebar")}disconnectedCallback(){this.reloadInterceptor.deactivate()}async addBlockDates(){try{this.errors=null;this.isLoading=true;const e=this.datesSchema.parse(this.dates);if(!this.selectedUnit){this.unitSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="rooms";return}if(this.blockState==="block"){await this.bookingService.blockAvailabilityForBrackets({unit_id:this.selectedUnit?.unit_id,description:"",property_id:E.property.id,block_status_code:"002",brackets:e.map((e=>({from_date:e.from,to_date:e.to})))})}else{await this.bookingService.unBlockUnitByPeriod({unit_id:this.selectedUnit?.unit_id,from_date:e[0].from,to_date:e[0].to})}this.activate();this.deactivate();this.toast.emit({type:"success",title:M.entries.Lcz_RequestSubmittedSuccessfully,description:""});this.isLoading=false;this.closeModal.emit()}catch(e){console.log(e);if(e instanceof S){this.datesSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="dates"}}finally{this.isLoading=false}}activate(){this.reloadInterceptor.activate();if(this.sidebar)this.sidebar.preventClose=true}deactivate(){this.reloadInterceptor.deactivate();if(this.sidebar)this.sidebar.preventClose=false}handleDateChange({index:e,date:t,key:i}){const s=[...this.dates];s[e]={...s[e],[i]:t};if(i==="from"&&s[e].to?.isBefore(t,"dates")){s[e].to=null}for(let i=e+1;i<s.length;i++){const e=s[i]?.from;if(e&&e.isSameOrBefore(t,"day")){s[i]={from:null,to:null}}}this.dates=s;setTimeout((()=>{if(i==="from"){this.dateRefs[e]?.to.openDatePicker()}else{const e=s.findIndex((e=>e.from===null));if(e>-1){this.dateRefs[e]?.from.openDatePicker()}}}),100)}addDateRow(){const e=this.dates[this.dates.length-1];if(!e.from||!e.to){this.errors="dates";return}this.errors=null;this.dates=[...this.dates,{from:null,to:null}];setTimeout((()=>{this.dateRefs[this.dates.length-1].to?.scrollIntoView({behavior:"smooth",block:"center"})}),100)}render(){return i("form",{key:"c0c512b5176ad9c7ccd975e2d0ac784ace8d7ccb",class:"bulk-sheet-container",onSubmit:e=>{e.preventDefault();this.addBlockDates()}},i("div",{key:"ddb241caecba6fac489426dece48e03119dc48a8",class:"sheet-body px-1"},i("div",{key:"df17a6f8e66a0e89f27c6ed232da579947cb24e5",class:"text-muted text-left pt-0 my-0 d-flex align-items-center pb-1",style:{gap:"0.5rem"}},i("p",{key:"0ec15c2023e82f117c3e63c1640e5afdf4747559",class:"m-0 p-0"},"Select the unit to"),i("ir-select",{key:"f2bff04764a2451c5ec01390325381c2afc9a0c7",showFirstOption:false,selectedValue:this.blockState,data:[{text:"Block",value:"block"},{text:"Unblock",value:"unblock"}],onSelectChange:e=>{this.blockState=e.detail}})),i("div",{key:"17893fa7d2b7fbdf9150ee0a9b7d2712f34dc497"},this.errors==="rooms"&&i("p",{key:"f713da1b228d9810c429f53bc92b28c48d96d156",class:"text-danger text-left smaller p-0 ",style:{"margin-bottom":"0.5rem"}},E.is_vacation_rental?M.entries.Lcz_PlzSelectOneListing:M.entries.Lcz_PlzSelectOneUnit),i("ul",{key:"a2c64eb43b7b5ce9f2822023fc72e737f18a377a",class:"room-type-list",ref:e=>this.unitSections=e},E.roomsInfo.map((e=>i(o,null,i("li",{key:`roomTypeRow-${e.id}`,class:`room-type-row`},i("div",{class:"d-flex choice-row"},i("span",{class:"pl-1 text-left room-type-name"},e.name))),e.physicalrooms.map(((t,s)=>{const o=s===e.physicalrooms.length-1?"pb-1":"";return i("li",{key:`physicalRoom-${t.id}-${s}`,class:`physical-room ${o}`},i("div",{class:"d-flex choice-row"},i("ir-radio",{class:"pl-1 ",name:"unit",checked:this.selectedUnit?.unit_id===t.id,onCheckChange:()=>this.selectedUnit={roomtype_id:e.id,unit_id:t.id},label:t.name})))}))))))),i("table",{key:"461482c37c649f56102508685dddf5f054f8be84",class:"mt-1",ref:e=>this.datesSections=e},i("thead",{key:"2d61d092449cfcdfefe46587d9019b5399ed44db"},i("tr",{key:"88e89f4c2c28bfb5f8abeb448b16994ee9424024"},i("th",{key:"c34554a1c4dc6c809a8ed5a1ea164c3082f831c2",class:"text-left"},M.entries.Lcz_From),i("th",{key:"b6e057d7459f026bd41e4224be22f6b19dc35c0a",class:"text-left"},M.entries.Lcz_ToExclusive),i("td",{key:"5cd66ffb79f0f24793c58a33d206eda7a16b1e90"},this.dates.length!==this.maxDatesLength&&this.blockState==="block"&&i("ir-button",{key:"a6c892a8d3b7a0844aa3c837ef4705e663d0ca60",variant:"icon",icon_name:"plus",onClickHandler:()=>{this.addDateRow()}})))),i("tbody",{key:"2369a44f56fe5f5ead659f59bde606f28905b4cf"},this.dates.map(((e,t)=>{if(!this.dateRefs[t]){this.dateRefs[t]={}}const s=t>0?this.dates[t-1]?.to.clone().add(1,"days")?.format("YYYY-MM-DD")??this.minDate:this.minDate;const o=this.dates[t].from?this.dates[t]?.from.clone().add(1,"days")?.format("YYYY-MM-DD"):this.minDate;return i("tr",{key:`date_${t}`},i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{ref:e=>{this.dateRefs[t].from=e},forceDestroyOnUpdate:true,minDate:s,"data-testid":"pickup_arrival_date",date:e.from?.format("YYYY-MM-DD"),emitEmptyDate:true,"aria-invalid":String(this.errors==="dates"&&!e.from),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"from"})},onDatePickerFocus:e=>{e.stopImmediatePropagation();e.stopPropagation();if(t===0){return}const i=this.dates.findIndex((e=>!e.from||!e.to));if(!this.dates[i]?.from){this.dateRefs[i]?.from.openDatePicker();return}if(!this.dates[i]?.to){this.dateRefs[i].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.from?e.from.format("MMM DD, YYYY"):null,class:`form-control input-sm ${this.errors==="dates"&&!e.to?"border-danger":""} text-center`,style:{width:"100%"}}))),i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{forceDestroyOnUpdate:true,ref:e=>{this.dateRefs[t].to=e},"data-testid":"pickup_arrival_date",date:e.to?.format("YYYY-MM-DD"),emitEmptyDate:true,minDate:o,"aria-invalid":String(this.errors==="dates"&&!e.to),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"to"})},maxDate:e.from?_(e.from).add(3,"months").format("YYYY-MM-DD"):undefined,onDatePickerFocus:e=>{e.stopImmediatePropagation();e.stopPropagation();const t=this.dates.findIndex((e=>!e.from||!e.to));if(!this.dates[t]?.from){this.dateRefs[t]?.from?.openDatePicker();return}if(!this.dates[t]?.to){this.dateRefs[t].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.to?e.to.format("MMM DD, YYYY"):null,class:`form-control input-sm \n                          ${this.errors==="dates"&&!e.to?"border-danger":""}\n                          text-center`,style:{width:"100%"}}))),t>0&&i("td",{class:"pb-1"},i("ir-button",{variant:"icon",icon_name:"minus",onClickHandler:()=>{this.dates=this.dates.filter(((e,i)=>i!==t))}})))}))))),i("div",{key:"271aa816dae5615313eabeddfb1a1c5d5b72354e",class:"sheet-footer"},i("ir-button",{key:"d45dd7d5f12e095bdbb81b374048d7d2f933cf9c",text:M.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"f6eedd9a8aa1a9260fa1347f105c1e5f8b804361",isLoading:this.isLoading,text:M.entries.Lcz_Confirm,btn_type:"submit",class:"flex-fill"})))}};X.style=q+K;const Z=".bulk-operations-sheet-container.sc-igl-bulk-operations{display:flex;flex-direction:column;height:auto !important;min-height:100vh;background:white !important}.animated-container.sc-igl-bulk-operations{transition:all 0.5s ease}.tabs.sc-igl-bulk-operations{position:sticky;top:var(--ir-tabs-top, 54px);background-color:white;z-index:9999999;padding-top:1rem;margin-bottom:1rem}";const J=Z;const Q=".sc-igl-bulk-operations-h{height:100%}.sheet-container.sc-igl-bulk-operations{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-operations{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-operations{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-operations{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-operations{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-operations{flex-direction:row;align-items:center}}";const ee=Q;const te=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.toast=t(this,"toast",7)}maxDatesLength=8;property_id;closeModal;toast;selectedTab;tabs=[{id:"stop-sale",label:"Stop/Open Sale"},{id:"block",label:"Block Unit"}];tabsEl;titleEl;componentDidLoad(){this.tabsEl.style.setProperty("--ir-tabs-top",this.titleEl?.getBoundingClientRect()?.height?.toString()+"px")}render(){return i("div",{key:"a01e090d3c6791ac28894d4a2a2b3e7ab8400063",class:"bulk-operations-sheet-container"},i("div",{key:"82e503a1ffc1718425cb20e5d370f56cea7c0aba",class:"sheet-header d-flex align-items-center"},i("ir-title",{key:"4532e5753df2607fd317099e84a0261e7785c030",ref:e=>this.titleEl=e,onCloseSideBar:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeModal.emit(null)},class:"px-1 mb-0",label:"Bulk Operations",displayContext:"sidebar"})),i("ir-tabs",{key:"9de08be546b7787884ea00d9668f31e8e78b9231",ref:e=>this.tabsEl=e,class:"tabs",tabs:this.tabs,onTabChanged:e=>this.selectedTab=e.detail}),this.selectedTab?.id==="stop-sale"?i("igl-bulk-stop-sale",{maxDatesLength:this.maxDatesLength,property_id:this.property_id}):i("igl-bulk-block",{maxDatesLength:this.maxDatesLength,property_id:this.property_id}))}};te.style=J+ee;const ie=".sc-igl-bulk-stop-sale-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-bulk-stop-sale{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-bulk-stop-sale{transition:all 0.5s ease}.days-checkbox.sc-igl-bulk-stop-sale{gap:0.5rem}";const se=ie;const oe=".sc-igl-bulk-stop-sale-h{height:100%}.sheet-container.sc-igl-bulk-stop-sale{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-bulk-stop-sale{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-bulk-stop-sale{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-bulk-stop-sale{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-bulk-stop-sale{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-bulk-stop-sale{flex-direction:row;align-items:center}}";const ae=oe;const ne=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7);this.toast=t(this,"toast",7)}maxDatesLength=8;property_id;selectedRoomTypes=[];errors;isLoading;dates=[{from:null,to:null}];selectedWeekdays=new Set(Array(7).fill(null).map(((e,t)=>t)));closeModal;toast;sidebar;dateRefs=[];reloadInterceptor;minDate=_().format("YYYY-MM-DD");bookingService=new n;getDayIndex(e){return _(e,"YYYY-MM-DD").day()}datesSchema=T.array(T.object({from:T.any().refine((e=>_.isMoment(e)),{message:"Invalid 'from' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD"))),to:T.any().refine((e=>_.isMoment(e)),{message:"Invalid 'to' date; expected a Moment object."}).transform((e=>e.format("YYYY-MM-DD")))}));unitSections;weekdaysSections;datesSections;componentDidLoad(){this.reloadInterceptor=new V({autoActivate:false});this.sidebar=document.querySelector("ir-sidebar")}disconnectedCallback(){this.reloadInterceptor.deactivate()}async addBlockDates(){const e=e=>{const t=[];for(const i of e){let e=i.from;const s=_(i.to,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD");while(e!==s){const i=_(e,"YYYY-MM-DD").add(1,"days").format("YYYY-MM-DD");if(!this.selectedWeekdays.has(this.getDayIndex(e))){e=i;continue}for(const i of this.selectedRoomTypes){t.push({room_type_id:i.id,night:e})}e=i}}return t};const t=e=>{const t=new Map(y.disabled_cells);const i=new Map(E.roomsInfo.map(((e,t)=>[e.id,{roomType:e,index:t}])));const s=new Map(y.days.map(((e,t)=>[e.value,t])));const o=new Map;for(const a of e){for(const e of a.restrictions){const{night:n,room_type_id:r}=e;const{roomType:l}=i.get(r);if(!l)continue;const c=s.get(n);if(c===undefined){console.warn(`Couldn't find date ${n}`);continue}const d=y.days[c];const h=`${r}_${n}`;let g=o.get(h);if(!g){g=d.rate.find((e=>e.id===r));if(!g){console.warn(`Couldn't find room type ${r}`);continue}o.set(h,g)}const f=g.exposed_inventory.rts===0;for(const e of l.physicalrooms){const i=`${e.id}_${n}`;t.set(i,{disabled:a.is_closed?true:f,reason:a.is_closed?"stop_sale":f?"inventory":"stop_sale"})}}}y["disabled_cells"]=new Map(t)};try{this.errors=null;this.isLoading=true;const i=this.datesSchema.parse(this.dates);if(this.selectedRoomTypes.length===0){this.unitSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="rooms";return}if(this.selectedWeekdays.size===0){this.weekdaysSections.scrollIntoView({behavior:"smooth",block:"center"});this.errors="weekdays";return}this.activate();const s=e(i);const o=this.selectedRoomTypes.every((e=>e.result==="open"));const a=this.selectedRoomTypes.every((e=>e.result==="closed"));if(a||o){const e={is_closed:a,restrictions:s,property_id:this.property_id};await this.bookingService.setExposedRestrictionPerRoomType(e);t([e])}else{const e=[];for(const t of this.selectedRoomTypes){const i=s.filter((e=>e.room_type_id===t.id));e.push({is_closed:t.result==="closed",restrictions:i,property_id:this.property_id})}await Promise.all(e.map((e=>this.bookingService.setExposedRestrictionPerRoomType(e))));t(e)}this.deactivate();this.toast.emit({type:"success",title:M.entries.Lcz_RequestSubmittedSuccessfully,description:""});this.isLoading=false;this.closeModal.emit()}catch(e){console.log(e);if(e instanceof S){this.datesSections.scrollIntoView({behavior:"smooth",block:"end"});this.errors="dates"}}finally{this.isLoading=false}}activate(){this.reloadInterceptor.activate();if(this.sidebar)this.sidebar.preventClose=true}deactivate(){this.reloadInterceptor.deactivate();if(this.sidebar)this.sidebar.preventClose=false}handleDateChange({index:e,date:t,key:i}){const s=[...this.dates];s[e]={...s[e],[i]:t};if(i==="from"&&s[e].to?.isBefore(t,"dates")){s[e].to=null}for(let i=e+1;i<s.length;i++){const e=s[i]?.from;if(e&&e.isSameOrBefore(t,"day")){s[i]={from:null,to:null}}}this.dates=s;setTimeout((()=>{if(i==="from"){this.dateRefs[e]?.to.openDatePicker()}else{const e=s.findIndex((e=>e.from===null));if(e>-1){this.dateRefs[e]?.from.openDatePicker()}}}),100)}addDateRow(){const e=this.dates[this.dates.length-1];if(!e.from||!e.to){this.errors="dates";return}this.errors=null;this.dates=[...this.dates,{from:null,to:null}];setTimeout((()=>{this.dateRefs[this.dates.length-1].to?.scrollIntoView({behavior:"smooth",block:"center"})}),100)}render(){return i("form",{key:"a45e91a054c7e653e2e68a6cced1e9f9935e620b",class:"bulk-sheet-container",onSubmit:e=>{e.preventDefault();this.addBlockDates()}},i("div",{key:"68c7f098edc7226c4e2ed4c813ac6995a619d4de",class:"sheet-body px-1"},i("div",{key:"11247ec900293e5c58853854827bfe33e74187b5",class:"text-muted text-left py-0 my-0"},i("p",{key:"0d188613da0ea6a0eed2a54db5466e4c1275b532"},"Select the types to stop or open sales for all related rate plans")),i("div",{key:"45166c367fb4f4e86fbd7ec896b6e893e09b6e3d"},this.errors==="rooms"&&i("p",{key:"96b2f88a26ec8ccc01af6b0418bb241369f55fd8",class:"text-danger text-left smaller p-0 ",style:{"margin-bottom":"0.5rem"}},E.is_vacation_rental?M.entries.Lcz_PlzSelectOneListing:M.entries.Lcz_PlzSelectOneUnit),i("table",{key:"6ba9e48a0091f12e63b0a467e72f1caded7fd0df",ref:e=>this.unitSections=e},i("thead",{key:"056aebedd20dd1819cae6d7539a61eb7bed633c7"},i("tr",{key:"4fe74c1dc5825fcb4542e44f7482f3cccb7aabd6"},i("th",{key:"d3e153d7048a39ee56df0174c1fc18cd634f95fd",class:"sr-only"},"choice"),i("th",{key:"cca1dfc4c94df482bc0b12195f8f6475e1cf577a",class:"sr-only"},"room type"))),i("tbody",{key:"366187b1b0a00e0174997687e7928a8484187ab1"},E.roomsInfo.map(((e,t)=>{const s=t===E.roomsInfo.length-1?"":"pb-1";return i("tr",{key:e.id},i("td",{class:`choice-row ${s}`},i("div",{class:"d-flex justify-content-end"},i("ir-select",{firstOption:`${M.entries.Lcz_Select}...`,data:[{value:"open",text:M.entries.Lcz_Open},{value:"closed",text:M.entries.Lcz_StopSale}],onSelectChange:t=>{const i=t.detail;const s=this.selectedRoomTypes.filter((t=>t.id!==e.id));if(i){s.push({id:e.id,result:i})}this.selectedRoomTypes=s}}))),i("td",{class:`pl-1 text-left ${s}`},e.name))}))))),i("p",{key:"ceb18ee8f129c02282fa84361b11a1912f446d91",class:"text-left mt-2 text-muted"},"Included days"),this.errors==="weekdays"&&i("p",{key:"04cd0a78b013cf2517969e31e87329d6c43ca678",class:"text-danger text-left smaller m-0 p-0"},"Please select at least one day"),i("ir-weekday-selector",{key:"21f118a36e7d0dd01d7009487595e42313a09a2d",ref:e=>this.weekdaysSections=e,weekdays:Array.from(this.selectedWeekdays),onWeekdayChange:e=>{e.stopPropagation();e.stopImmediatePropagation();this.selectedWeekdays=new Set(e.detail)}}),i("table",{key:"e4857c28249811d5706d269ebb228c33d8f62f40",class:"mt-1",ref:e=>this.datesSections=e},i("thead",{key:"0668b9ec29d2bb0cdc4dc79331ccc068b1cf602c"},i("tr",{key:"c4b0def0c7c63032a766af95adce36392ec8da1a"},i("th",{key:"f763ffa63f2dc803f24de54fa3503a7201049db9",class:"text-left"},M.entries.Lcz_From),i("th",{key:"99452b17bea3259f57b380f40bfd3ce844cdd022",class:"text-left"},M.entries.Lcz_ToExclusive),i("td",{key:"71bc124290ebf2fb5391800019da32939689dc5d"},this.dates.length!==this.maxDatesLength&&i("ir-button",{key:"e7c5ba52d346a2065190867a20a1f5830d4da954",variant:"icon",icon_name:"plus",onClickHandler:()=>{this.addDateRow()}})))),i("tbody",{key:"b23afe78fb50f4fde9feeb18d6b3896228de64e1"},this.dates.map(((e,t)=>{if(!this.dateRefs[t]){this.dateRefs[t]={}}const s=t>0?this.dates[t-1]?.to.clone().add(1,"days")?.format("YYYY-MM-DD")??this.minDate:this.minDate;const o=this.dates[t].from?this.dates[t]?.from.clone()?.format("YYYY-MM-DD"):this.minDate;return i("tr",{key:`date_${t}`},i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{ref:e=>{this.dateRefs[t].from=e},forceDestroyOnUpdate:true,minDate:s,"data-testid":"pickup_arrival_date",date:e.from?.format("YYYY-MM-DD"),emitEmptyDate:true,"aria-invalid":String(this.errors==="dates"&&!e.from),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"from"})},onDatePickerFocus:e=>{e.stopImmediatePropagation();e.stopPropagation();if(t===0){return}const i=this.dates.findIndex((e=>!e.from||!e.to));if(!this.dates[i]?.from){this.dateRefs[i]?.from.openDatePicker();return}if(!this.dates[i]?.to){this.dateRefs[i].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.from?e.from.format("MMM DD, YYYY"):null,class:`form-control input-sm ${this.errors==="dates"&&!e.to?"border-danger":""} text-center`,style:{width:"100%"}}))),i("td",{class:"pr-1 pb-1"},i("ir-date-picker",{forceDestroyOnUpdate:true,ref:e=>{this.dateRefs[t].to=e},"data-testid":"pickup_arrival_date",date:e.to?.format("YYYY-MM-DD"),emitEmptyDate:true,minDate:o,"aria-invalid":String(this.errors==="dates"&&!e.to),onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDateChange({index:t,date:e.detail.start,key:"to"})},onDatePickerFocus:e=>{e.stopImmediatePropagation();e.stopPropagation();const t=this.dates.findIndex((e=>!e.from||!e.to));if(!this.dates[t]?.from){this.dateRefs[t]?.from?.openDatePicker();return}if(!this.dates[t]?.to){this.dateRefs[t].to.openDatePicker()}}},i("input",{type:"text",slot:"trigger",value:e.to?e.to.format("MMM DD, YYYY"):null,class:`form-control input-sm \n                          ${this.errors==="dates"&&!e.to?"border-danger":""}\n                          text-center`,style:{width:"100%"}}))),t>0&&i("td",{class:"pb-1"},i("ir-button",{variant:"icon",icon_name:"minus",onClickHandler:()=>{this.dates=this.dates.filter(((e,i)=>i!==t))}})))}))))),i("div",{key:"6c0a8e555a9da6c2de32984f6b1bb6f76c7e0012",class:"sheet-footer"},i("ir-button",{key:"69723cbca0e70ac2e9d9fa19cb43cff540f39e24",text:M.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"ac308439a0a1ca42c5062bdd510175fbc11f4f4c",isLoading:this.isLoading,text:M.entries.Lcz_Save,btn_type:"submit",class:"flex-fill"})))}};ne.style=se+ae;const re=".sc-igl-cal-body-h{display:block;color:var(--wa-color-text-normal)}.bodyContainer.sc-igl-cal-body{position:relative}.roomRow.sc-igl-cal-body{width:max-content}.roomRow.sc-igl-cal-body:first-child{margin-top:80px}.categoryName.sc-igl-cal-body{font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.cellData.sc-igl-cal-body{background-color:var(--wa-color-surface-default)}.cellData[data-dirty-room='true'].sc-igl-cal-body::after{content:'';position:absolute;bottom:0;height:100%;left:30%;right:30%;background-color:#d4d0be !important}.cellData.disabled.sc-igl-cal-body{background:var(--wa-color-neutral-fill-quiet);cursor:var(--cell-cursor, not-allowed);transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body{cursor:pointer;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body:hover{background:var(--wa-color-neutral-fill-quiet)}.roomRow.sc-igl-cal-body .room.sc-igl-cal-body:hover[data-hk-enabled='false']{background:var(--wa-color-surface-default);cursor:default}.cellData.sc-igl-cal-body{width:58px;height:30px;display:inline-grid;border-top:1px solid var(--wa-color-surface-border);border-left:1px solid var(--wa-color-surface-border);vertical-align:top}.triangle-button.sc-igl-cal-body{--size:10px;position:absolute;right:-6px;top:-1px;width:0;height:0;padding:0;border:none;background:transparent;cursor:pointer;width:0;height:0;border-left:var(--size) solid transparent;border-right:var(--size) solid transparent;border-bottom:var(--size) solid var(--wa-color-surface-border);transform:rotate(45deg)}.cellData.sc-igl-cal-body:nth-child(2){border-left:0px}.cellData.sc-igl-cal-body:last-child{border-right:1px solid var(--wa-color-surface-border)}.roomHeaderCell.sc-igl-cal-body{position:-webkit-sticky;position:sticky;left:0;background:var(--wa-color-surface-default);border-inline-end:1px solid var(--wa-color-surface-border);width:170px;z-index:1;border-inline-start:0px}.currentDay.sc-igl-cal-body{background-color:var(--wa-color-brand-fill-quiet)}.dragOverHighlight.sc-igl-cal-body{background-color:#f5f5dc !important}.selectedDay.sc-igl-cal-body{background-color:#f9f9c9 !important}.categoryTitle.sc-igl-cal-body{grid-template-columns:1fr 20px;padding-left:10px;cursor:pointer;height:40px;font-size:0.9em}.categoryTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.sc-igl-cal-body{padding-left:20px;font-size:0.9em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.roomTitle.sc-igl-cal-body>.sc-igl-cal-body:nth-child(1){white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.roomTitle.pl10.sc-igl-cal-body{padding-left:10px}.categoryPriceColumn.sc-igl-cal-body{align-items:center;height:40px;-webkit-user-select:none;user-select:none;position:relative}.bookingEventsContainer.sc-igl-cal-body{position:absolute;top:0;left:0}.roomTitle[data-room-has-today-checkin='true'].sc-igl-cal-body{--ir-interactive-hk-bg:var(--wa-color-brand-fill-quiet);color:var(--wa-color-brand-on-quiet);background-color:var(--wa-color-brand-fill-quiet) !important}";const le=re;const ce=class{constructor(i){e(this,i);this.addBookingDatasEvent=t(this,"addBookingDatasEvent",7);this.showBookingPopup=t(this,"showBookingPopup",7);this.scrollPageToRoom=t(this,"scrollPageToRoom",7)}isScrollViewDragging;propertyId;calendarData;today;currency;language;countries;highlightedDate;dragOverElement="";renderAgain=false;selectedRoom=null;selectedRooms={};addBookingDatasEvent;showBookingPopup;scrollPageToRoom;fromRoomId=-1;newEvent;currentDate=new Date;bookingMap=new Map;interactiveTitle=[];dayRateMap=new Map;roomsWithTodayCheckinStatus=new Set;categoriesWithTodayCheckinStatus=new Set;componentWillLoad(){this.currentDate.setHours(0,0,0,0);this.bookingMap=this.getBookingMap(this.getBookingData());this.updateTodayCheckinStatus();y.days.forEach((e=>{this.dayRateMap.set(e.day,e.rate)}));this.updateDisabledCellsCache()}handleCalendarDataChange(){this.bookingMap=this.getBookingMap(this.getBookingData());this.updateTodayCheckinStatus();this.updateDisabledCellsCache()}handleTodayChange(){this.updateTodayCheckinStatus()}dragOverHighlightElementHandler(e){this.dragOverElement=e.detail.dragOverElement}gotoRoom(e){let t=e.detail.roomId;let i=this.getRoomCategoryByRoomId(t);if(!i.expanded){this.toggleCategory(i);setTimeout((()=>{this.scrollToRoom(t)}),10)}else{this.scrollToRoom(t)}}addToBeAssignedEvents(e){this.addBookingDatas(e.detail.data);this.renderElement()}closeWindow(){let e=this.getBookingData().findIndex((e=>e.ID==="NEW_TEMP_EVENT"));if(e!==-1){this.getBookingData().splice(e,1);console.log("removed item..");this.renderElement()}}scrollToRoom(e){this.scrollPageToRoom.emit({key:"scrollPageToRoom",id:e,refClass:"room_"+e})}getRoomCategoryByRoomId(e){return this.calendarData.roomsInfo.find((t=>this.getRoomtypeUnits(t).find((t=>this.getRoomId(t)===e))))}getCategoryName(e){return e.name}getCategoryId(e){return e.id}getTotalPhysicalRooms(e){return this.getRoomtypeUnits(e).length}getRoomtypeUnits(e){return e&&e.physicalrooms||[]}getRoomName(e){return e.name}getRoomId(e){return e.id}getRoomById(e,t){return e.find((e=>this.getRoomId(e)===t))}getBookingData(){return this.calendarData.bookingEvents??[]}addBookingDatas(e){this.addBookingDatasEvent.emit(e)}getSelectedCellRefName(e,t){return"room_"+e+"_"+t.currentDate}getSplitBookingEvents(e){console.log(e.FROM_DATE);return this.getBookingData().some((t=>{if(!["003","002","004"].includes(t.STATUS_CODE)){if(new Date(e.FROM_DATE).getTime()>=new Date(t.FROM_DATE).getTime()&&new Date(e.FROM_DATE).getTime()<=new Date(t.TO_DATE).getTime()){return t}}}))}addNewEvent(e){let t=Object.keys(this.selectedRooms);let s,o;if(this.selectedRooms[t[0]].currentDate<this.selectedRooms[t[1]].currentDate){s=new Date(this.selectedRooms[t[0]].currentDate);o=new Date(this.selectedRooms[t[1]].currentDate)}else{s=new Date(this.selectedRooms[t[1]].currentDate);o=new Date(this.selectedRooms[t[0]].currentDate)}const a=Math.round(Math.abs((o.getTime()-s.getTime())/864e5));this.newEvent={ID:"NEW_TEMP_EVENT",NAME:i("span",null,"Â "),EMAIL:"",PHONE:"",convertBooking:false,REFERENCE_TYPE:"PHONE",FROM_DATE:s.getFullYear()+"-"+this.getTwoDigitNumStr(s.getMonth()+1)+"-"+this.getTwoDigitNumStr(s.getDate()),TO_DATE:o.getFullYear()+"-"+this.getTwoDigitNumStr(o.getMonth()+1)+"-"+this.getTwoDigitNumStr(o.getDate()),BALANCE:"",NOTES:"",RELEASE_AFTER_HOURS:0,PR_ID:this.selectedRooms[t[0]].roomId,ENTRY_DATE:"",NO_OF_DAYS:a,ADULTS_COUNT:1,COUNTRY:"",INTERNAL_NOTE:"",RATE:"",TOTAL_PRICE:"",RATE_PLAN:"",ARRIVAL_TIME:"",TITLE:M.entries.Lcz_NewBookingFor,roomsInfo:[e],CATEGORY:e.name,event_type:"BAR_BOOKING",STATUS:"TEMP-EVENT",defaultDateRange:{fromDate:null,fromDateStr:"",toDate:null,toDateStr:"",dateDifference:a,editable:false,message:"Including 5.00% City Tax - Excluding 11.00% VAT"}};let n=e.name+" "+this.getRoomName(this.getRoomById(this.getRoomtypeUnits(e),this.selectedRooms[t[0]].roomId));this.newEvent.BLOCK_DATES_TITLE=`${M.entries.Lcz_BlockDatesFor} ${n}`;this.newEvent.TITLE+=n;this.newEvent.defaultDateRange.toDate=new Date(this.newEvent.TO_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDate=new Date(this.newEvent.FROM_DATE+"T00:00:00");this.newEvent.defaultDateRange.fromDateStr=this.getDateStr(this.newEvent.defaultDateRange.fromDate);this.newEvent.defaultDateRange.toDateStr=this.getDateStr(this.newEvent.defaultDateRange.toDate);this.newEvent.ENTRY_DATE=(new Date).toISOString();this.newEvent.legendData=this.calendarData.formattedLegendData;let r=this.getSplitBookingEvents(this.newEvent);if(r){this.newEvent.splitBookingEvents=r}this.getBookingData().push(this.newEvent);return this.newEvent}getTwoDigitNumStr(e){return e<=9?"0"+e:e}getDateStr(e,t="default"){return e.getDate()+" "+e.toLocaleString(t,{month:"short"})+" "+e.getFullYear()}removeNewEvent(){this.calendarData.bookingEvents=this.calendarData.bookingEvents.filter((e=>e.ID!=="NEW_TEMP_EVENT"));this.newEvent=null}clickCell(e,t,i){if(!this.isScrollViewDragging&&t.currentDate>=this.currentDate.getTime()){let s=this.getSelectedCellRefName(e,t);if(this.selectedRooms.hasOwnProperty(s)){this.removeNewEvent();delete this.selectedRooms[s];this.renderElement();return}else if(Object.keys(this.selectedRooms).length!=1||this.fromRoomId!=e){this.removeNewEvent();this.selectedRooms={};this.selectedRooms[s]={...t,roomId:e};this.fromRoomId=e;this.renderElement()}else{const o=Object.keys(this.selectedRooms);const a=_(this.selectedRooms[o[0]].value,"YYYY-MM-DD");const n=_(t.value,"YYYY-MM-DD");let r=a.clone().add(1,"days");let l=0;while(r.isBefore(n,"day")){const t=r.format("YYYY-MM-DD");if(this.isCellDisabled(e,t)){l++}r.add(1,"days")}if(l>=1){this.selectedRooms={};this.fromRoomId=e;this.renderElement();return}this.selectedRooms[s]={...t,roomId:e};this.addNewEvent(i);this.selectedRooms={};this.renderElement();this.showNewBookingPopup(this.newEvent)}}}showNewBookingPopup(e){console.log(e)}renderElement(){this.renderAgain=!this.renderAgain}getBookingMap(e){const t=new Map;const i=_().startOf("day");for(const s of e){const e=_(s.FROM_DATE,"YYYY-MM-DD").startOf("day");const o=_(s.TO_DATE,"YYYY-MM-DD").startOf("day");if(i.isSameOrAfter(e)&&i.isSameOrBefore(o)){if(!t.has(s.PR_ID)){t.set(s.PR_ID,s.BOOKING_NUMBER)}else{if(x(_().toDate(),D(E.checkin_checkout_hours?.offset,E.checkin_checkout_hours?.hour))){t.set(s.PR_ID,s.BOOKING_NUMBER)}}}}return t}getRoomtypeDayInventoryCells(e,t=false,s){return y.days.map((a=>i("div",{class:`cellData  font-weight-bold categoryPriceColumn ${e+"_"+a.day} ${a.day===this.today||a.day===this.highlightedDate?"currentDay":""}`},t?i(o,null,i("span",{class:"categoryName"},a.rate[s].exposed_inventory.rts)):"")))}getGeneralUnitsDayCells(e,t,s){return this.calendarData.days.map((o=>{const a=this.isCellDisabled(Number(e),o.value);const n=_(o.value,"YYYY-MM-DD").add(-1,"days").format("YYYY-MM-DD");const r=a&&Object.keys(this.selectedRooms).length===0||a&&this.isCellDisabled(Number(e),n);const l=this.selectedRooms.hasOwnProperty(this.getSelectedCellRefName(e,o));const c=o.day===this.today||o.day===this.highlightedDate;const d=y.cleaningTasks.has(+e)?y.cleaningTasks.get(+e):null;const h=["001","003"].includes(E.cleaning_frequency?.code)?false:d?.has(o.value);return i("div",{class:`cellData position-relative roomCell ${a?"disabled":""} ${"room_"+e+"_"+o.day} ${c?"currentDay":""} ${this.dragOverElement===e+"_"+o.day?"dragOverHighlight":""} ${l?"selectedDay":""}`,style:!r&&{"--cell-cursor":"default"},onClick:()=>{if(r){return}this.clickCell(Number(e),o,t)},"aria-label":s,role:"gridcell","data-room-id":e,"data-date":o.value,"aria-current":c?"date":undefined,"data-room-name":s,"data-dirty-room":String(h),"aria-disabled":String(r),"aria-selected":Boolean(l)})}))}toggleCategory(e){e.expanded=!e.expanded;this.renderElement()}getRoomtypeRow(e,t){if(this.getTotalPhysicalRooms(e)<=1||!e.is_active){return null}const s=this.categoryHasRoomWithTodayCheckin(e);return i("div",{class:"roomRow","data-has-today-checkin":String(s)},i("div",{class:`cellData text-left align-items-center roomHeaderCell categoryTitle ${"category_"+this.getCategoryId(e)}`,onClick:()=>this.toggleCategory(e),"data-has-today-checkin":String(s)},i("div",{class:"categoryName"},i("ir-interactive-title",{popoverTitle:this.getCategoryName(e)})),e.expanded?i("wa-icon",{name:"angle-down"}):i("wa-icon",{name:"angle-right"})),this.getRoomtypeDayInventoryCells("category_"+this.getCategoryId(e),true,t))}getUnitsByRoomtype(e){const t=this.categoryHasRoomWithTodayCheckin(e);if(!e.expanded){return null}return this.getRoomtypeUnits(e)?.map((s=>{if(!s.is_active){return null}const o=this.getTotalPhysicalRooms(e)<=1;const a=o?this.getCategoryName(e):this.getRoomName(s);const n=this.getRoomId(s);const r=this.roomHasTodayCheckin(n);return i("div",{class:"roomRow","data-room-has-today-checkin":String(r)},i("div",{class:`cellData room text-left align-items-center roomHeaderCell  roomTitle ${this.getTotalPhysicalRooms(e)<=1?"pl10":""} ${"room_"+n}`,"data-room-name":a,"data-hk-enabled":String(E.housekeeping_enabled),"data-room":n,"data-room-has-today-checkin":String(r),"data-category-has-today-checkin":String(t),onClick:()=>{if(!E.housekeeping_enabled){return}this.selectedRoom=s},onMouseEnter:()=>{this.interactiveTitle[s.id]?.style?.setProperty("--ir-interactive-hk-bg",r?"var(--wa-color-brand-fill-quiet)":"var(--wa-color-neutral-fill-quiet)")},onMouseLeave:()=>{this.interactiveTitle[s.id]?.style?.removeProperty("--ir-interactive-hk-bg")}},i("ir-interactive-title",{ref:e=>{if(e)this.interactiveTitle[s.id]=e},style:s.hk_status==="003"&&{"--dot-color":"var(--wa-color-neutral-fill-quiet)"},hkStatus:E.housekeeping_enabled&&s.hk_status!=="001",popoverTitle:a},s.hk_status!=="001"&&i("div",{slot:"end",class:"d-flex align-items-center",style:{gap:"0.5rem"}},s.hk_status!=="003"&&i("wa-tooltip",{for:`${s.id}_hk_status_icon`},s.hk_status==="002"?"This unit is dirty":"Inspected"),i("wa-icon",{id:`${s.id}_hk_status_icon`,name:s.hk_status==="004"?"check":"broom",style:s.hk_status==="004"&&{color:"var(--wa-color-success-fill-loud)"}})))),this.getGeneralUnitsDayCells(this.getRoomId(s),e,a))}))}getRoomRows(){return this.calendarData.roomsInfo?.map(((e,t)=>{if(e.is_active){return i(o,null,this.getRoomtypeRow(e,t),e.expanded&&this.getUnitsByRoomtype(e))}else{return null}}))}getTodayCheckinRoomsAndCategories(){const e=_();const t=new Set;const i=new Set;this.getBookingData().forEach((s=>{const o=s?.ROOM_INFO;if(o?.in_out?.code!=="001"){return}if(_(s.FROM_DATE,"YYYY-MM-DD").isAfter(e,"dates")&&_(s.TO_DATE,"YYYY-MM-DD").isBefore(e,"dates")){return}const a=Number(s.PR_ID);if(!Number.isNaN(a)){t.add(a)}const n=Number(s.RATE_TYPE);if(!Number.isNaN(n)){i.add(n)}}));return{rooms:t,categories:i}}updateTodayCheckinStatus(){const{categories:e,rooms:t}=this.getTodayCheckinRoomsAndCategories();this.roomsWithTodayCheckinStatus=t;this.categoriesWithTodayCheckinStatus=e}roomHasTodayCheckin(e){return this.roomsWithTodayCheckinStatus?.has(e)}categoryHasRoomWithTodayCheckin(e){return this.categoriesWithTodayCheckinStatus.has(this.getCategoryId(e))}updateDisabledCellsCache(){y.disabled_cells.clear();this.calendarData.roomsInfo?.forEach(((e,t)=>{if(e.is_active){this.getRoomtypeUnits(e)?.forEach((e=>{if(e.is_active){this.calendarData.days.forEach((i=>{const s=this.getCellKey(e.id,i.value);y.disabled_cells.set(s,{disabled:!i.rate[t].is_available_to_book,reason:"stop_sale"})}))}}))}}))}getCellKey(e,t){return`${e}_${t}`}isCellDisabled(e,t){const i=this.getCellKey(e,t);if(!y.disabled_cells.has(i)){return false}const{disabled:s}=y.disabled_cells.get(i);return s}render(){return i(a,{key:"c0e249370f81722879f107827bd853c4f668f08b"},i("div",{key:"aa97e0f595803ed4e0edefb4c3127273cdcedaeb",class:"bodyContainer"},this.getRoomRows(),i("div",{key:"cf24b6ada182001f30624e2bbfeb6672f87aaf68",class:"bookingEventsContainer preventPageScroll"},this.getBookingData()?.map((e=>i("igl-booking-event",{"data-testid":`booking_${e.BOOKING_NUMBER}`,"data-room-name":e.roomsInfo?.find((t=>t.id===e.RATE_TYPE))?.physicalrooms.find((t=>t.id===e.PR_ID))?.name,language:this.language,is_vacation_rental:this.calendarData.is_vacation_rental,countries:this.countries,currency:this.currency,"data-component-id":e.ID,bookingEvent:e,allBookingEvents:this.getBookingData()}))))),i("igl-housekeeping-dialog",{key:"ad94b4cf4004e36c4fbf80eaa60431dd2bd223e0",onIrAfterClose:e=>{e.stopImmediatePropagation();e.stopPropagation();this.selectedRoom=null},bookingNumber:this.selectedRoom?this.bookingMap.get(this.selectedRoom?.id):undefined,selectedRoom:this.selectedRoom,open:this.selectedRoom!==null}))}static get watchers(){return{calendarData:["handleCalendarDataChange"],today:["handleTodayChange"]}}};ce.style=le;const de=".sc-igl-cal-footer-h{display:block;position:sticky;bottom:0;width:max-content;z-index:3;color:var(--wa-color-text-quiet)}.footerCell.sc-igl-cal-footer{display:-moz-inline-grid;display:-ms-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;bottom:0;width:58px;height:40px;background:var(--wa-color-surface-default);vertical-align:top;border-top:1px solid var(--wa-color-surface-border)}.bottomLeftCell.sc-igl-cal-footer{left:-1px;z-index:2;width:170px;text-align:left;padding-left:15px}.footerCell.sc-igl-cal-footer i.sc-igl-cal-footer{margin-right:5px}.legendBtn.sc-igl-cal-footer{color:#41bff3;color:var(--wa-color-text-link);cursor:pointer}.legendBtn.sc-igl-cal-footer:hover{color:color-mix(in oklab, var(--wa-color-text-link), var(--wa-color-mix-hover))}.isOnline.sc-igl-cal-footer i.sc-igl-cal-footer{color:#2f9c3f;font-weight:bold}.isOffline.sc-igl-cal-footer i.sc-igl-cal-footer{font-weight:bold}.isOffline.sc-igl-cal-footer{color:#a40000}.dayTitle.sc-igl-cal-footer{font-size:0.8em;font-weight:600;display:grid;user-select:none}.currentDay.sc-igl-cal-footer .dayTitle.sc-igl-cal-footer{font-weight:bold}.currentDay.sc-igl-cal-footer{background-color:var(--wa-color-brand-fill-quiet)}.dayCapacityPercent.sc-igl-cal-footer{font-size:0.75em}.badge-pill.sc-igl-cal-footer{padding-left:1em;padding-right:1em;font-size:0.7em;margin-bottom:2px}.weekend.sc-igl-cal-footer{font-weight:bold;color:var(--wa-color-text-normal)}";const he=de;const ge=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7)}optionEvent;calendarData;isLegendOpen=false;today;highlightedDate;_today=_().format("YYYY-MM-DD");handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}render(){return i(a,{key:"c7d24ab8eeda4324dc471ff8e6caebf2183cb5ef",class:"footerContainer"},i("div",{key:"dde02947bb623e3c1754a127b37992eab1c5192e",class:"footerCell bottomLeftCell align-items-center preventPageScroll",style:{paddingLeft:"10px"}},i("button",{key:"fa5a02cd1b11ae86ee96a4cf7971176438f9cadf",class:"m-0 p-0 btn btn-sm  legendBtn d-flex align-items-center",style:{gap:"0.25rem"},onClick:()=>this.handleOptionEvent("showLegend")},this.isLegendOpen?i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640",height:16,width:16},i("path",{fill:"currentColor",d:"M105.4 297.4C92.9 309.9 92.9 330.2 105.4 342.7L265.4 502.7C277.9 515.2 298.2 515.2 310.7 502.7C323.2 490.2 323.2 469.9 310.7 457.4L173.3 320L310.6 182.6C323.1 170.1 323.1 149.8 310.6 137.3C298.1 124.8 277.8 124.8 265.3 137.3L105.3 297.3zM457.4 137.4L297.4 297.4C284.9 309.9 284.9 330.2 297.4 342.7L457.4 502.7C469.9 515.2 490.2 515.2 502.7 502.7C515.2 490.2 515.2 469.9 502.7 457.4L365.3 320L502.6 182.6C515.1 170.1 515.1 149.8 502.6 137.3C490.1 124.8 469.8 124.8 457.3 137.3z"})):i("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640",height:16,width:16},i("path",{fill:"currentColor",d:"M535.1 342.6C547.6 330.1 547.6 309.8 535.1 297.3L375.1 137.3C362.6 124.8 342.3 124.8 329.8 137.3C317.3 149.8 317.3 170.1 329.8 182.6L467.2 320L329.9 457.4C317.4 469.9 317.4 490.2 329.9 502.7C342.4 515.2 362.7 515.2 375.2 502.7L535.2 342.7zM183.1 502.6L343.1 342.6C355.6 330.1 355.6 309.8 343.1 297.3L183.1 137.3C170.6 124.8 150.3 124.8 137.8 137.3C125.3 149.8 125.3 170.1 137.8 182.6L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7z"})),i("span",{key:"34085f587c839bbe4fc08f3368b3b4500bdf7282"},M.entries.Lcz_Legend),i("span",{key:"5a9ab0a2f6b184d7109352c78ebc03b9f88a3f87"},"v1.3"),i("ir-new-badge",{key:"4882303d2d040e13ceda87d2632830e9e088ece6",style:{marginLeft:"0.25rem"}}))),this.calendarData.days.map((e=>i("div",{class:"footerCell align-items-center"},i("div",{class:{"dayTitle full-height align-items-center":true,weekend:g(e.value),currentDay:e.value===this._today||this.highlightedDate===e.day}},e.dayDisplayName)))))}};ge.style=he;const fe=".sc-igl-cal-header-h{display:block;position:absolute;top:0;height:100%;color:var(--wa-color-text-quiet)}.svg-icon.sc-igl-cal-header{height:20px;width:20px}.darkGrey.sc-igl-cal-header{background:#ececec}.btn.sc-igl-cal-header{pointer-events:auto}.dayTitle.weekend.sc-igl-cal-header{font-weight:bold;color:var(--wa-color-text-normal)}.cellData.sc-igl-cal-header{background-color:var(--wa-color-surface-default)}.stickyCell.sc-igl-cal-header{display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid;position:-webkit-sticky;position:sticky;top:0px;height:82px;display:inline-block;vertical-align:top;z-index:2}.headersContainer.sc-igl-cal-header{background-color:var(--wa-color-surface-default)}.headerCell.sc-igl-cal-header{display:inline-grid;width:58px;height:58px;vertical-align:top;background-color:var(--wa-color-surface-default);border-bottom:1px solid var(--wa-color-surface-border)}.monthsContainer.sc-igl-cal-header{height:20px;background-color:var(--wa-color-surface-default);margin-bottom:0.2em}.monthCell.sc-igl-cal-header{display:inline-grid;height:20px;background-color:var(--wa-color-overlay-inline);border-right:1px solid var(--wa-color-surface-border);color:var(--wa-color-neutral-on-quiet);vertical-align:top}.monthCell.sc-igl-cal-header:nth-child(odd){background:var(--wa-color-neutral-fill-normal);color:var(--wa-color-neutral-on-normal)}.monthTitle.sc-igl-cal-header{overflow:hidden;text-overflow:ellipsis;font-size:0.9em;text-transform:uppercase;font-weight:bold;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.topLeftCell.sc-igl-cal-header{left:0px;z-index:3;width:170px;background-color:var(--wa-color-surface-default);display:-ms-inline-grid;display:-moz-inline-grid;display:inline-grid}.datePickerHidden.sc-igl-cal-header{position:absolute;height:100%;width:100%;opacity:0;cursor:pointer;z-index:1}.date_btn.sc-igl-cal-header{cursor:pointer;display:flex;align-items:center;justify-content:center;position:relative}.date_btn.sc-igl-cal-header:hover{background:#f6f6f6;border-radius:0.3rem}.caledarBtns.sc-igl-cal-header{position:relative;cursor:pointer;padding:0.4rem}.caledarBtns.sc-igl-cal-header:hover{background-color:#f6f6f6}.dayTitle.sc-igl-cal-header{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.currentDay.sc-igl-cal-header .dayTitle.sc-igl-cal-header{font-weight:bold}.currentDay.sc-igl-cal-header{background-color:var(--wa-color-brand-fill-quiet)}.dayCapacityPercent.sc-igl-cal-header{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.badge-pill.sc-igl-cal-header{padding:3px 1em;font-size:0.8em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.pointer.sc-igl-cal-header{cursor:pointer}.searchContiner.sc-igl-cal-header{padding-left:10px;padding-right:10px}.searchListContainer.sc-igl-cal-header{background:var(--wa-color-surface-default);border:1px solid var(--wa-color-surface-border);border-bottom:none}.fd-header__badge-btn.sc-igl-cal-header{all:unset;cursor:pointer}.fd-header__badge-btn.sc-igl-cal-header:hover .fd-header__badge.sc-igl-cal-header{background-color:color-mix(in oklab, var(--wa-color-fill-loud, var(--wa-color-neutral-fill-loud)), var(--wa-color-mix-hover))}.searchListItem.sc-igl-cal-header{background:var(--wa-color-surface-default);border-bottom:1px solid var(--wa-color-surface-border);padding-left:8px}.header__fd-actions.sc-igl-cal-header{color:var(--wa-color-text-normal);border-inline-end:1px solid var(--wa-color-surface-border)}.badge-light.sc-igl-cal-header{background-color:#999999;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.min-width-full.sc-igl-cal-header{min-width:100%}.header__fd-actions.sc-igl-cal-header{display:flex;width:170px;box-sizing:border-box;gap:0.875rem;color:var(--wa-color-text-normal);flex-direction:column}";const be=fe;const pe=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.gotoRoomEvent=t(this,"gotoRoomEvent",7);this.gotoToBeAssignedDate=t(this,"gotoToBeAssignedDate",7)}optionEvent;gotoRoomEvent;gotoToBeAssignedDate;calendarData;today;propertyid;unassignedDates;to_date;highlightedDate;renderAgain=false;unassignedRoomsNumber={};roomsList=[];toBeAssignedService=new R;dateRef;dateSelectRef;componentWillLoad(){try{this.initializeRoomsList();if(!this.calendarData.is_vacation_rental){I("unassigned_dates",(e=>{if(Object.keys(e).length>0){this.fetchAndAssignUnassignedRooms()}}))}}catch(e){console.error("Error in componentWillLoad:",e)}}handleCalendarDataChanged(){this.fetchAndAssignUnassignedRooms()}initializeRoomsList(){this.roomsList=[];this.calendarData.roomsInfo.forEach((e=>{this.roomsList=this.roomsList.concat(...e.physicalrooms)}))}async fetchAndAssignUnassignedRooms(){await this.assignRoomsToDate()}async assignRoomsToDate(){try{const{fromDate:e,toDate:t,data:i}=this.unassignedDates;let s=new Date(e);s.setHours(0,0,0,0);let o=s.getTime();while(o<=new Date(t).getTime()){const e=_(o).format("D_M_YYYY");if(i[o]){const t=await this.toBeAssignedService.getUnassignedRooms({from_date:this.calendarData.from_date,to_date:this.calendarData.to_date},this.propertyid,f(new Date(o)),this.calendarData.roomsInfo,this.calendarData.formattedLegendData);this.unassignedRoomsNumber[e]=t.length}else if(this.unassignedRoomsNumber[e]){const t=this.unassignedRoomsNumber[e]-1;this.unassignedRoomsNumber[e]=t<0?0:t}const t=_(o).add(1,"days").toDate();t.setHours(0,0,0,0);o=t.getTime();this.renderView()}}catch(e){console.error(e)}}handleReduceAvailableUnitEvent(e){e.stopImmediatePropagation();e.stopPropagation();const{fromDate:t,toDate:i}=e.detail;let s=new Date(t).getTime();while(s<new Date(i).getTime()){const e=_(s).format("D_M_YYYY");this.unassignedRoomsNumber[e]=this.unassignedRoomsNumber[e]-1;s=_(s).add(1,"days").toDate().getTime()}this.renderView()}showToBeAssigned(e){if(this.unassignedRoomsNumber[e.day]||0){this.handleOptionEvent("showAssigned");setTimeout((()=>{this.gotoToBeAssignedDate.emit({key:"gotoToBeAssignedDate",data:e.currentDate})}),100)}}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}handleDateSelect(e){if(Object.keys(e.detail).length>0){this.handleOptionEvent("calendar",e.detail)}}handleClearSearch(){this.renderView()}handleFilterRooms(e){const t=e.target;let i=t.value.trim();i=i.toLowerCase();if(i===""){this.handleClearSearch()}this.renderView()}handleScrollToRoom(e){this.handleClearSearch();this.gotoRoomEvent.emit({key:"gotoRoom",roomId:e})}getStringDateFormat(e){return e.getFullYear()+"-"+(e.getMonth()<9?"0":"")+(e.getMonth()+1)+"-"+(e.getDate()<=9?"0":"")+e.getDate()}getNewBookingModel(){let e=new Date;e.setHours(0,0,0,0);let t=this.getStringDateFormat(e);e.setDate(e.getDate()+1);e.setHours(0,0,0,0);let i=this.getStringDateFormat(e);return{ID:"",NAME:"",EMAIL:"",PHONE:"",REFERENCE_TYPE:"PHONE",FROM_DATE:t,TO_DATE:i,roomsInfo:this.calendarData.roomsInfo,TITLE:M.entries.Lcz_NewBooking,event_type:"PLUS_BOOKING",legendData:this.calendarData.formattedLegendData,defaultDateRange:{fromDate:new Date(t),fromDateStr:"",toDate:new Date(i),toDateStr:"",dateDifference:0,editabled:true,message:""}}}renderView(){this.renderAgain=!this.renderAgain}render(){return i(a,{key:"c71e62ac4030ba2cb65b6ca0d2e79b1ed9d6280d"},i("div",{key:"27f997a85ca7641679cb1ab8ba79e8861a9bda71",class:"stickyCell align-items-center topLeftCell preventPageScroll"},i("div",{key:"dab3ee14f4e52b05186eb15ca28e9ca51563d347",class:"header__fd-actions"},i("div",{key:"ca378b054692fcb42cdc58f5b96a27c9d98b2d9b",class:"row justify-content-around no-gutters",style:{gap:"0"}},!this.calendarData.is_vacation_rental&&i(o,{key:"0a0f5d2088f7e3e45e0f66849e079c64e1aab6df"},i("wa-tooltip",{key:"0e6c5e21f30a017fc6661961fa4019f7f5d37ce1",for:"fd-unassigned-dates_btn"},M.entries.Lcz_UnassignedUnitsTooltip),i("ir-custom-button",{key:"5be00c8bd3db5bb5dc05c597e61a8c0f5315fe1b",id:"fd-unassigned-dates_btn",variant:"neutral",appearance:"plain",onClickHandler:()=>this.handleOptionEvent("showAssigned")},i("wa-icon",{key:"c25aa35b73d13a3cd6bb190c7d307afee99bdb40",style:{fontSize:"1.5rem"},name:"server",label:M.entries.Lcz_UnassignedUnitsTooltip,"aria-label":M.entries.Lcz_UnassignedUnitsTooltip}))),i("wa-tooltip",{key:"9008500c6a5d8a1068f818a1e927e9f404e2f268",for:"fd-dates-navigation_btn"},M.entries.Lcz_Navigate),i("ir-date-select",{key:"c2a14984416ddec0363ed3738d5da59c5aee083d",minDate:_().add(-2,"months").startOf("month").format("YYYY-MM-DD"),onDateChanged:e=>{console.log("evt",e);this.handleDateSelect(e)},ref:e=>this.dateSelectRef=e},i("ir-custom-button",{key:"a3c1f72f8a4b2beaaf32a642c218f5661653cf48",slot:"trigger",id:"fd-dates-navigation_btn",variant:"neutral",appearance:"plain",onClickHandler:()=>this.handleOptionEvent("calendar")},i("wa-icon",{key:"665ba8294ffaf4ef39f0be738f467e9d2f281b9d",style:{fontSize:"1.5rem"},name:"calendar",variant:"regular",label:M.entries.Lcz_Navigate,"aria-label":M.entries.Lcz_Navigate})),i("div",{key:"30cfe0d38d8dca8c4889bfe2a974375a0c04ec14",class:"fd-dates__actions"},i("wa-divider",{key:"809ff3076c4d78f391f567f2844b9618fe0ed63e"}),i("ir-custom-button",{key:"d31f0723a9276fc5818f90e66b25f55ba2fad07a",variant:"neutral",appearance:"outlined",onClickHandler:()=>{this.handleOptionEvent("gotoToday");this.dateSelectRef.closeDatePicker()}},"Today"))),i(o,{key:"73237056b3154d1c3ef82dd19b3ba159429b4587"},i("wa-tooltip",{key:"b7f7e5d0cf2e7d1584bc71270a7132cd04fc1850",for:"fd-new-booking_btn"},M.entries.Lcz_CreateNewBooking),i("ir-custom-button",{key:"36262e131c7196cb79b7243beaf313ad733c56fe",slot:"trigger",id:"fd-new-booking_btn",variant:"neutral",appearance:"plain",onClickHandler:()=>this.handleOptionEvent("add",this.getNewBookingModel())},i("wa-icon",{key:"3f8a3e9ce9db58da9394b77887f56ec25f95a13f",style:{fontSize:"1.5rem"},name:"plus",label:M.entries.Lcz_CreateNewBooking,"aria-label":M.entries.Lcz_CreateNewBooking}))),i(o,{key:"abf9bd93046157990e8b37646a10ebdfb178aa53"},i("wa-tooltip",{key:"43c4869f1ac39121a6ee5ea35061b9be30648a10",for:"fd-stop-open-sale_btn"},M.entries.Lcz_StopOpenSale),i("ir-custom-button",{key:"34803e9e7b68cae3aadeb896fcc45e0fa06bd95c",slot:"trigger",id:"fd-stop-open-sale_btn",variant:"neutral",appearance:"plain",onClickHandler:()=>this.handleOptionEvent("bulk",this.getNewBookingModel())},i("wa-icon",{key:"9ac98cfbfd64b7240f9a95e1be285b83f1fe3937",variant:"regular",style:{fontSize:"1.5rem"},name:"calendar-xmark",label:M.entries.Lcz_StopOpenSale,"aria-label":M.entries.Lcz_StopOpenSale})))),i("div",{key:"a2194f56f6df91c7b449d61729312ba34c3c0cb1",class:"searchContiner"},i("ir-picker",{key:"6c6c32096c36b468373cff3cc2a4eae6fb229e08",size:"small","onCombobox-select":e=>{this.handleScrollToRoom(Number(e.detail.item.value))}},this.roomsList.map((e=>i("ir-picker-item",{label:e.name,value:e.id},e.name))))))),i("div",{key:"59dcfd8fc7efbd702661cd58754d37d409b88e94",class:"stickyCell headersContainer"},i("div",{key:"428c4762991570c4cc6fc44e0423c5bdbb70d764",class:"monthsContainer"},this.calendarData.monthsInfo.map((e=>i("div",{class:"monthCell",style:{width:e.daysCount*58+"px"}},i("div",{class:"monthTitle"},e.monthName))))),this.calendarData.days.map((e=>i("div",{class:`headerCell align-items-center ${"day-"+e.day} ${e.day===this.today||e.day===this.highlightedDate?"currentDay":""}`,"data-day":e.day},!this.calendarData.is_vacation_rental&&i("div",{class:"preventPageScroll",onClick:()=>this.showToBeAssigned(e)},this.unassignedRoomsNumber[e.day]||e.unassigned_units_nbr!==0?i("button",{class:"fd-header__badge-btn"},i("wa-badge",{class:"fd-header__badge",variant:"brand",appearance:"accent",pill:true},this.unassignedRoomsNumber[e.day]||e.unassigned_units_nbr)):i("wa-badge",{variant:"neutral",appearance:"filled",pill:true}," ",this.unassignedRoomsNumber[e.day]||e.unassigned_units_nbr)),i("div",{class:{dayTitle:true,weekend:g(e.value)}},e.dayDisplayName),i("div",{class:"dayCapacityPercent"},e.occupancy,"%"))))))}static get watchers(){return{unassignedDates:["handleCalendarDataChanged"]}}};pe.style=be;const ue=".sc-igl-housekeeping-dialog-h{display:block;text-align:start}";const me=ue;const ke=class{constructor(i){e(this,i);this.irAfterClose=t(this,"irAfterClose",7)}open;selectedRoom;bookingNumber;propertyId;isLoading=null;irAfterClose;dialogRef;housekeepingService=new B;getStatusLabel(){switch(this.selectedRoom?.hk_status){case"002":return"dirty";case"004":return"inspected";default:return"clean"}}middleButtonLabel(){return this.selectedRoom?.hk_status==="002"?"Clean":"Dirty"}rightButtonLabel(){return this.selectedRoom?.hk_status!=="004"?"Clean & Inspect":"Clean"}async updateHousekeeping(e,t){e.stopImmediatePropagation();e.stopPropagation();try{this.isLoading=e.target.value;await this.housekeepingService.setExposedUnitHKStatus({property_id:E.property.id,status:{code:t},unit:{id:this.selectedRoom?.id}});if(["001","004"].includes(t)){await this.housekeepingService.executeHKAction({actions:[{description:"Cleaned",hkm_id:this.selectedRoom?.housekeeper?.id||null,unit_id:this.selectedRoom?.id,booking_nbr:this.bookingNumber,status:t}]})}}finally{this.isLoading=null;this.dialogRef.closeModal()}}render(){return i("ir-dialog",{key:"beab344e673df4e022adca001bb06bd6ab4d415d",ref:e=>this.dialogRef=e,open:this.open,label:"Housekeeping Update",onIrDialogAfterHide:()=>this.irAfterClose.emit()},i("p",{key:"8f4c6551eef0dc8bc735844e184aea19026772e0",style:{margin:"0"}},`${this.selectedRoom?.name} is currently marked as ${this.getStatusLabel()}.`),i("div",{key:"c4a5640d0694b360fcd694237a02ffe5d0bc1292",slot:"footer",class:"ir-dialog__footer"},i("ir-custom-button",{key:"e1e751402b6f6d48c41b58c006464df50ce52954","data-dialog":"close",size:"medium",variant:"neutral",appearance:"filled"},"Cancel"),i("ir-custom-button",{key:"7bc92a9baa8ecefae711427926fcd5cf4e1e8017",value:"hk-toggle-clean-dirty",size:"medium",variant:"brand",appearance:"outlined",loading:this.isLoading==="hk-toggle-clean-dirty",onClickHandler:e=>this.updateHousekeeping(e,this.selectedRoom.hk_status==="002"?"001":"002")},this.middleButtonLabel()),i("ir-custom-button",{key:"ec429a1facc4d4dd0c173eb06e7c83b4ca9d73b1",value:"hk-clean-inspect",size:"medium",variant:"brand",appearance:"accent",loading:this.isLoading==="hk-clean-inspect",onClickHandler:e=>this.updateHousekeeping(e,this.selectedRoom.hk_status==="004"?"001":"004")},this.rightButtonLabel())))}};ke.style=me;const ye=".sc-igl-legends-h{--spacing:var(--wa-space-l);display:block;width:max-content;color:var(--wa-color-text-normal);font-size:var(--wa-font-size-s);background-color:var(--wa-color-surface-default);border-inline-end:2px solid var(--wa-color-surface-border)}.legend_skew.pending.sc-igl-legends{border-width:1px;border-style:dashed;border-color:var(--wa-color-success-fill-loud)}.legend_skew.in-house.sc-igl-legends{background-color:var(--wa-color-brand-fill-quiet) !important;color:var(--wa-color-brand-on-quiet) !important;width:30px;transform:skew(0);border-radius:0;vertical-align:middle;font-size:12px;text-align:center}.legendRow.sc-igl-legends{position:relative;vertical-align:middle;margin-bottom:0.3rem}.legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle}.legend_skew.sc-igl-legends,.legend_skew-bordered.sc-igl-legends,.legend_skewsplit.sc-igl-legends{transform:skew(-22deg);width:15px;height:16px;border-radius:4px;background-color:var(--ir-skew-background)}.legend_skew.striped.vertical.sc-igl-legends{--stripe-period:17px;--stripe-angle:360deg}.legend_skew.striped.sc-igl-legends{--stripe-period:6px;background:repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-skew-background) 0,\n    var(--ir-skew-background) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  )}.legend_skew.split.sc-igl-legends{border-right:4px solid var(--wa-color-text-normal, black)}.legend_skew-bordered.sc-igl-legends{border:1px solid var(--wa-color-text-normal, black)}.legend_dirty-unit.sc-igl-legends{background-color:white !important;border:1px solid #e0e0e0;height:12px;width:20px;position:relative}.fd-legend__section-title.sc-igl-legends{font-family:var(--wa-font-family-heading);font-weight:var(--wa-font-weight-heading);line-height:var(--wa-line-height-condensed);text-wrap:balance;margin:0;padding:0;margin-bottom:1rem;font-size:var(--wa-font-size-m);color:var(--wa-color-text-normal, black)}.legend_dirty-unit.sc-igl-legends::after{content:'';position:absolute;bottom:0;height:100%;left:30%;right:30%;background-color:#d4d0be !important}.legend_circle.sc-igl-legends{border-radius:100%;width:10px;height:10px;margin:3px 3px 3px 2px}.legend_skewsplit.sc-igl-legends{border-right:2px solid var(--wa-color-text-normal, black)}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends{margin-bottom:0}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends:first-child .legendCal.sc-igl-legends{background-color:var(--wa-color-neutral-fill-normal);color:var(--wa-color-neutral-on-normal)}.legendCalendar.sc-igl-legends .legendRow.sc-igl-legends div.sc-igl-legends{display:inline-block;vertical-align:middle;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.total-availability.sc-igl-legends{font-size:1em !important}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends{width:80px;height:25px;text-align:center;display:inline-grid !important;align-content:center;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.sc-igl-legends .badge.sc-igl-legends{margin-top:0.2rem;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legendCalendar.sc-igl-legends .legendCal.legendCal-h2.sc-igl-legends{height:40px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.br-t.sc-igl-legends{border-top:1px solid var(--wa-color-surface-border)}.br-s.sc-igl-legends{border-left:1px solid var(--wa-color-surface-border);border-right:1px solid var(--wa-color-surface-border)}.br-bt.sc-igl-legends{border-bottom:1px solid var(--wa-color-surface-border)}.hyphenLegend.sc-igl-legends{-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.hyphenLegend.sc-igl-legends::before{width:12px;height:0.5px;content:' ';background-color:var(--wa-color-text-normal, black);vertical-align:middle;display:inline-block;margin-left:5px;margin-right:5px;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.fd-legend__title.sc-igl-legends{align-self:center;flex:1 1 auto;font-style:inherit;font-variant:inherit;font-stretch:inherit;font-family:inherit;font-optical-sizing:inherit;font-size-adjust:inherit;font-kerning:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-language-override:inherit;font-size:var(--wa-font-size-l);font-weight:var(--wa-font-weight-heading);line-height:var(--wa-line-height-condensed);margin:0px;padding:0;color:var(--wa-color-text-normal, black)}.fd-legend__header.sc-igl-legends{display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;background-color:var(--wa-color-surface-default);z-index:1;padding-inline-start:var(--spacing);padding-block-end:0;padding-inline-end:calc(var(--spacing) - var(--wa-form-control-padding-block));padding-block-start:calc(var(--spacing) - var(--wa-form-control-padding-block));border-bottom:1px solid var(--wa-color-surface-border);padding-bottom:calc(var(--spacing) / 2);box-sizing:border-box;background-color:var(--ir-drawer-background-color, var(--wa-color-surface-default))}.fd-legend__shape.sc-igl-legends{display:flex;align-items:center;justify-content:center}.fd-legend__row.sc-igl-legends{display:grid;grid-template-columns:40px 1fr;gap:1rem;margin-bottom:0.5rem}.fd-legend__row-title.sc-igl-legends{padding:0;margin:0;width:fit-content}.legendContainer.sc-igl-legends{padding:0 !important}.fd-legend__body.sc-igl-legends{padding:var(--spacing)}.headerCell.sc-igl-legends{width:70px;display:flex;align-items:center;justify-content:center}.dayTitle.sc-igl-legends{font-size:0.8em;font-weight:600;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.dayCapacityPercent.sc-igl-legends{font-size:0.75em;-webkit-user-select:none;user-select:none;-webkit-user-drag:none}.legend_rectangle.sc-igl-legends{height:12px;width:20px}";const ve=ye;const we=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7)}legendData;bookingColors=[];saveState="idle";saveError;loadingIndex=[];optionEvent;propertyService=new C;saveTimeout;disconnectedCallback(){if(this.saveTimeout){clearTimeout(this.saveTimeout)}}handleSaveStateChange(e){if(e==="error"||e==="idle"){this.loadingIndex=[]}}handleOptionEvent(e,t=""){this.optionEvent.emit({key:e,data:t})}syncCalendarExtra(e){const t=E.property.calendar_extra??{};E.property.calendar_extra={...t,booking_colors:e.map((e=>({...e})))}}get propertyId(){return E.property?.id??E.property.id??null}updateBookingColor(e,t){const i=E.property.calendar_extra?.booking_colors.map(((i,s)=>s===e?{...i,...t}:i));this.syncCalendarExtra(i);if(this.saveState==="saved"){this.saveState="idle"}}async persistBookingColors(){const e=this.propertyId;if(!e){return}if(this.saveState==="saving"){return}this.saveState="saving";this.saveError=undefined;try{await this.propertyService.setPropertyCalendarExtra({property_id:e,value:JSON.stringify(E.property.calendar_extra)});this.saveState="saved";if(this.saveTimeout){clearTimeout(this.saveTimeout)}this.saveTimeout=window.setTimeout((()=>{this.saveState="idle";this.saveTimeout=undefined}),2e3)}catch(e){this.saveState="error";this.saveError=e instanceof Error?e.message:String(e)}}handleNameInput(e,t){this.updateBookingColor(e,{name:t})}handleBlur(e){this.persistBookingColors();if(!this.loadingIndex.includes(e)){this.loadingIndex=[...this.loadingIndex,e]}}handleLoaderComplete(e){this.loadingIndex=this.loadingIndex.filter((t=>t!==e))}updateLegend(){let e=[...E.property.calendar_legends];let t=e[11];e[11]=e[12];e[12]=t;const i=e[13];e=e.filter(((e,t)=>t!==13));e.splice(7,0,i);return e}render(){const e=this.updateLegend();return i(a,{key:"cd55c6dff2d8b1837a0235f0289c6d3087ff9290",class:"legendContainer text-left"},i("div",{key:"97491e2b11a4b772dbac94489f5b93de7669d52c",class:"fd-legend__header"},i("h2",{key:"630aeea7c3f60a7a5f135667dc208ca00eb67699",class:"fd-legend__title",id:"legend-title"},M.entries.Lcz_Legend),i("ir-custom-button",{key:"1758b1d1ca0204d999c958605786a4e7435d8a2b",size:"medium",onClickHandler:()=>this.handleOptionEvent("closeSideMenu"),appearance:"plain",variant:"neutral"},i("wa-icon",{key:"186d5c1298d1983b6beb20c9bae27c5891f73ff0",name:"xmark",variant:"solid",label:"Close","aria-label":"Close",role:"img"}))),i("section",{key:"c9087a0b7ab5f54fdf34427f2ae04b247b2cd73e",class:"fd-legend__body"},i("div",{key:"b4b801fe51ae407e5d130b3b9eeb5fc6d787b7d2"},e.map((e=>{const t=E.colorsForegrounds[e?.color];return i("div",{class:"fd-legend__row"},i("div",{class:"fd-legend__shape"},e.design==="broom"?i("svg",{xmlns:"http://www.w3.org/2000/svg",height:"12",width:"13.5",viewBox:"0 0 576 512",style:{display:"block"}},i("path",{fill:"var(--wa-color-text-normal,black)",d:"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z"})):e.design==="check"?i("svg",{height:14,width:14,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"},i("path",{fill:"green",d:"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z"})):i("div",{class:`legend_${e.design}  ${e.id==="3"?"pending":""} ${e.id==="1"?"in-house":""} ${["1","7"].includes(e.id.toString())?`striped ${e.id.toString()==="1"?"vertical":""}`:""}`,style:{"--ir-skew-background":e.color,"--ir-event-bg-stripe-color":t?.stripe,backgroundColor:e.color}},e.id==="1"&&"5")),i("p",{class:"fd-legend__row-title"},e.name))})),i("wa-divider",{key:"0fecf72f22dfb6a77fb1daaf976d160410b592fd"}),i("h5",{key:"8dbc8f440403435d678c0cec3f1fb1b967534a33",class:"fd-legend__section-title"},"Use custom colors"),E.property.calendar_extra?.booking_colors.map(((e,t)=>{const s=`legend_${e.design}`;return i("div",{key:`legend_${t}`,class:"fd-legend__row"},i("div",{class:"fd-legend__shape"},i("div",{class:s,style:{backgroundColor:e.color}})),i("wa-input",{autocomplete:"off",class:"legendTextarea border-0 m-0 p-0",value:e.name,size:"small",placeholder:"Reason for this color",onchange:e=>{this.handleNameInput(t,e.target.value);this.handleBlur(t)}},this.loadingIndex.includes(t)&&(this.saveState==="saving"||this.saveState==="saved")?i("ir-success-loader",{slot:"end",onLoaderComplete:()=>this.handleLoaderComplete(t)}):null))}))),i("wa-divider",{key:"b4d42f112089bd0ad8b41009ddcb621d16799807"}),i("div",{key:"6cdb1dd2f137d47e577135f068708e3a77081266"},i("div",{key:"2fdab59a5da6a10f4659a56bfd4044266576f561",class:"legendCalendar"},i("div",{key:"c68cc5f70f0ae6d2621d1aad0ed2c1cf25e1e208",class:"legendRow align-items-center"},i("div",{key:"df22efc8add142816ab3c468b86010bd39eff0d9",class:"legendCal br-t br-s br-bt"},i("strong",{key:"a5393cad693431dd7d8d2cb478e39aca5350f7e9"},"MAR 2022")),i("div",{key:"243cad6ec296785917c51c130d08254d13474b6f",class:"hyphenLegend"},M.entries.Lcz_MonthAndYear)),i("div",{key:"97fc2d9d618e3d1b239b51712bd4b02e470e67b8",class:"legendRow"},i("div",{key:"a3cf5c6ca015bbe6ac7af20bbd5438ef102a9956",class:"legendCal headerCell align-items-center br-s"},i("wa-badge",{key:"fd0c46eb260529e96043282e8637caa550e7b043",pill:true},"3")),i("div",{key:"2280c624859b3e47a97d7d961df6614489718f48",class:"hyphenLegend"},i("div",{key:"795f3ba9a48a3ce5bbb240377c617e8a63aedb9f"},M.entries.Lcz_UnassignedUnits))),i("div",{key:"567868ee038138d8b2854fe6555fc04fc58feebd",class:"legendRow"},i("div",{key:"022c67c2bcc92ce4e5779cb22244dec6674e9e56",class:"legendCal dayTitle br-s"},"Fri 18"),i("div",{key:"0a3d54ca31e03633c143e09b7606af641e1c8948",class:"hyphenLegend"},M.entries.Lcz_Date)),i("div",{key:"e6adefec8a1ec6b46c2665fcb7518c43fafecc09",class:"legendRow"},i("div",{key:"6adb42a79b444527bda14a96f0bdcabb848d536a",class:"legendCal br-s br-bt dayCapacityPercent"},"15%"),i("div",{key:"69f9bc13fc35e14ba2c1763fe75e45bc80383156",class:"hyphenLegend"},M.entries.Lcz_Occupancy)),i("div",{key:"03b433e64b57029265537f45816d495be2f6d749",class:"legendRow"},i("div",{key:"a4e1a38799b4b3717e2505d0374f7a06bfed6e16",class:"legendCal br-s br-bt  font-weight-bold total-availability"},"20"),i("div",{key:"e74a3a073cf1a019f4a5d13ae67b5d74822fc41a",class:"hyphenLegend"},M.entries.Lcz_TotalAvailability))))))}static get watchers(){return{saveState:["handleSaveStateChange"]}}};we.style=ve;const xe=".sc-igl-reallocation-dialog-h{display:block;text-align:start}.dialog-body.sc-igl-reallocation-dialog{display:grid;gap:1.5rem}.dialog-body__description.sc-igl-reallocation-dialog{margin:0}.dialog-footer.sc-igl-reallocation-dialog{display:flex;justify-content:flex-end;gap:0.75rem}";const De=xe;const _e=class{constructor(i){e(this,i);this.dialogClose=t(this,"dialogClose",7);this.revertBooking=t(this,"revertBooking",7);this.resetModalState=t(this,"resetModalState",7)}get hostEl(){return s(this)}data;selectedRateplan;showRateplanError=false;dialogClose;revertBooking;resetModalState;dialogEl;rateplanSelectEl;eventsService=new Y;handleDataChange(e){this.resetState(e);if(e){this.dialogEl?.openModal()}else{this.dialogEl?.closeModal()}}async reallocateUnit(){if(!this.data){return}if(!this.validateRateplanSelection()){return}const{pool:e,toRoomId:t,from_date:i,to_date:s,matchedRatePlan:o}=this.data;try{await this.eventsService.reallocateEvent(e,t,i,s,this.data.rateplans?Number(this.selectedRateplan):o?Number(o?.value):undefined)}catch(t){console.log(t);this.revertBooking.emit(e)}finally{this.dialogEl?.closeModal();this.resetModalState.emit()}}get rateplanOptions(){if(!Array.isArray(this.data?.rateplans)){return[]}return this.data.rateplans.map((e=>({...e,text:this.formatRateplanLabel(e)})))}formatRateplanLabel(e){if(!e){return""}const t=e.custom_text?` | ${e.custom_text}`:"";return`${e.text}${t}`.trim()}hasRateplanRequirement(){return this.rateplanOptions.length>0}validateRateplanSelection(){if(!this.hasRateplanRequirement()){return true}if(!this.selectedRateplan){this.showRateplanError=true;this.focusRateplanSelect();return false}return true}focusRateplanSelect(){const e=this.rateplanSelectEl?.shadowRoot?.querySelector("select")??this.rateplanSelectEl?.querySelector("select");if(e){e.focus()}}resetState(e){if(!e){this.selectedRateplan=undefined;this.showRateplanError=false;return}this.selectedRateplan=undefined;this.showRateplanError=false}handleDialogVisibilityChange=e=>{this.dialogClose.emit(false)};handleRateplanChange=e=>{this.selectedRateplan=e;this.showRateplanError=false};handleCancelClick=()=>{this.dialogEl?.closeModal();this.dialogClose.emit(false)};render(){const e=this.hasRateplanRequirement();return i("ir-dialog",{key:"2c0a893936416b965db07af9bdef180176c7cabb",label:"Alert",ref:e=>this.dialogEl=e,onIrDialogHide:this.handleDialogVisibilityChange},this.data&&i(o,{key:"9bc357d9a07c1a2a8b394518fcec4d7e16ef8573"},i("div",{key:"e36181ad90480f77bf7641766778eb1a69ab57d8",class:"dialog-body"},i("p",{key:"065cba11adcce1f2b15972c20a9e3c2e99011f4d",class:"text-left dialog-body__description m-0 p-0"},this.data.description),e&&i("wa-select",{key:"39a38684719358d29db7f31f2ae6f944b47e136d","onwa-hide":e=>{e.stopImmediatePropagation();e.stopPropagation()},defaultValue:"","onwa-show":e=>{e.stopImmediatePropagation();e.stopPropagation()},size:"small","aria-invalid":String(this.showRateplanError),onchange:e=>this.handleRateplanChange(e.target.value)},i("wa-option",{key:"e88a692ba985822c5669a56c9f0e58ba7f7bdccf",value:""},"Select rate plan..."),this.rateplanOptions.map((e=>i("wa-option",{key:e.value,value:e.value},e.text))))),i("div",{key:"846c001b597cb6c66a100c4f6b41d033b536adcd",class:"dialog-footer",slot:"footer"},i("ir-custom-button",{key:"cce435e16766f00c6c5c504ba3e2bb62d94489c5",appearance:"filled",variant:"neutral",onClickHandler:this.handleCancelClick,size:"medium"},"Cancel"),i("ir-custom-button",{key:"539d7b8eddd78164e42cd126a4155b11b6431d49",variant:"brand",onClickHandler:()=>this.reallocateUnit(),size:"medium",loading:N("/ReAllocate_Exposed_Room")},"Confirm"))))}static get watchers(){return{data:["handleDataChange"]}}};_e.style=De;const Ye=T.object({roomtype_id:T.coerce.number(),unit_id:T.coerce.number(),rateplan_id:T.coerce.number()});const Ce=".sc-igl-split-booking-h{display:block}.sc-igl-split-booking-h{display:flex;flex-direction:column;flex:1 1 0%;height:100%}.bulk-sheet-container.sc-igl-split-booking{display:flex;flex-direction:column;flex:1;min-height:0;gap:1rem}.animated-container.sc-igl-split-booking{transition:all 0.5s ease}.physical-room.sc-igl-split-booking{margin-left:1rem !important}.physical-room.sc-igl-split-booking>td.sc-igl-split-booking:last-child{padding-left:1rem}.room-type-list.sc-igl-split-booking{padding:0;margin:0}.room-type-list.sc-igl-split-booking>li.sc-igl-split-booking,.physical-room.sc-igl-split-booking,.room-type-row.sc-igl-split-booking{list-style:none}";const Me=Ce;const Ee=".sc-igl-split-booking-h{height:100%}.sheet-container.sc-igl-split-booking{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-split-booking{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-split-booking{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-split-booking{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-split-booking{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-split-booking{flex-direction:row;align-items:center}}";const Te=Ee;const Se=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7)}booking;identifier;selectedDates;room;roomTypes=[];selectedUnit={};isLoading;errors;mealPlanOptions=null;closeModal;defaultDates;bookingService=new n;componentWillLoad(){this.room=this.getRoom();this.defaultDates={...this.generateDates(this.room)};this.selectedDates={...this.defaultDates};console.log(this.booking)}getRoom(){if(!this.booking){throw new Error("Missing booking")}if(!this.identifier){throw new Error("Missing Identifier")}const e=this.booking.rooms.find((e=>e.identifier===this.identifier));if(!e){throw new Error(`Couldn't find room with identifier ${this.identifier}`)}return e}generateDates(e){let t=_(e.from_date,"YYYY-MM-DD");const i=_(e.to_date,"YYYY-MM-DD").add(-1,"days");const s=_();if(t.isBefore(s)){t=s.clone()}if(t.isSame(s)){return{from_date:t,to_date:i}}if(t.isSameOrAfter(s)){return{from_date:t.clone().add(1,"days"),to_date:i}}return{from_date:s.clone().add(1,"days"),to_date:i}}async checkBookingAvailability(){r(false);const e=this.selectedDates.from_date.format("YYYY-MM-DD");const t=this.selectedDates.to_date.format("YYYY-MM-DD");const i=this.booking.agent!==null;try{const s=await this.bookingService.getBookingAvailability({from_date:e,to_date:t,propertyid:this.booking.property.id,adultChildCount:{adult:1,child:0},language:"en",room_type_ids:[],currency:this.booking.currency,agent_id:i?this.booking.agent.id:null,is_in_agent_mode:i,room_type_ids_to_update:[]});this.roomTypes=s}catch(e){console.error("Error initializing booking availability:",e)}}async doReservation(){try{this.isLoading=true;this.errors=null;const e=Ye.parse(this.selectedUnit);const t=this.booking.rooms.filter((e=>e.identifier!==this.identifier));const i=this.room.in_out?.code==="001"?_().isBefore(this.selectedDates.from_date)?false:true:false;let s=[...t,{...this.room,from_date:this.room.from_date,to_date:this.selectedDates.from_date.format("YYYY-MM-DD"),days:this.room.days.filter((e=>_(e.date,"YYYY-MM-DD").isBefore(this.selectedDates.from_date,"dates"))),departure_time:null},{...this.room,identifier:null,in_out:i?this.room.in_out:{code:"000"},check_in:i,assigned_units_pool:null,parent_room_identifier:this.room.identifier,is_split:true,roomtype:{id:e.roomtype_id},rateplan:{id:e.rateplan_id||this.room.rateplan.id},departure_time:this.room.departure_time,unit:{id:e.unit_id},from_date:this.selectedDates.from_date.format("YYYY-MM-DD"),days:this.room.days.filter((e=>_(e.date,"YYYY-MM-DD").isSameOrAfter(this.selectedDates.from_date,"dates")))}];const o={assign_units:true,is_pms:true,is_direct:this.booking.is_direct,is_backend:true,is_in_loyalty_mode:this.booking.is_in_loyalty_mode,promo_key:this.booking.promo_key,extras:this.booking.extras,agent:this.booking.agent,booking:{from_date:this.booking.from_date,to_date:this.booking.to_date,remark:this.booking.remark,booking_nbr:this.booking.booking_nbr,property:this.booking.property,booked_on:this.booking.booked_on,source:this.booking.source,rooms:s,currency:this.booking.currency,arrival:this.booking.arrival,guest:this.booking.guest},pickup_info:this.booking.pickup_info};console.log(o);await this.bookingService.doReservation(o);this.closeModal.emit(null)}catch(e){const t={};if(e instanceof S){console.error(e);e.issues.forEach((e=>{t[e.path[0]]=true}));this.errors={...t}}}finally{this.isLoading=false}}updateSelectedUnit(e){const t={...this.selectedUnit,...e};const i=E?.property?.roomtypes;const s=d({rateplan_id:this.room.rateplan.id.toString(),roomTypeId:t?.roomtype_id,roomTypes:i});const o=Object.prototype.hasOwnProperty.call(e,"rateplan_id");if(Array.isArray(s)){this.mealPlanOptions=s;if(!o){delete t.rateplan_id}}else{this.mealPlanOptions=null;if(!o){if(s){t.rateplan_id=Number(s.value)}else{delete t.rateplan_id}}}this.selectedUnit=t}render(){return i("form",{key:"17697d438edaa9c12086edeabdac229526dec5fa",onSubmit:e=>{e.preventDefault();this.doReservation()},class:"sheet-container"},i("ir-title",{key:"163826b24623ea5b0a83d90cfc4e342b198486ca",class:"px-1 sheet-header mb-0",displayContext:"sidebar",onCloseSideBar:()=>this.closeModal.emit(),label:`Split unit ${this.room?.unit["name"]}`}),i("section",{key:"abbe2a26648a3b93a95686cd0519831a7c52bbd0",class:"px-1 sheet-body"},i("div",{key:"03312c35a0ded3b91c71eb791cbf382751088f8b",class:"d-flex align-items-center",style:{gap:"0.5rem"}},i("div",{key:"b94ef121e39beb29f256ad93beb3c28c489b7b89"},i("ir-date-view",{key:"07de961ac9b171b394161433ae691885bb10bf6a",from_date:this.room.from_date,to_date:this.room.to_date,showDateDifference:false})),i("p",{key:"b118377f2ccb18786973f68e92fe0c19ba9db2c0",class:"m-0 p-0"},this.room.rateplan.short_name," ",this.room.rateplan.is_non_refundable?M.entries.Lcz_NonRefundable:"")),i("div",{key:"baffc153ff3fe4a5a5235aceddd4de4733133dbe",class:"d-flex align-items-center mt-1",style:{gap:"0.5rem"}},i("span",{key:"c93b890356fd6cd50ef337d5de8f39debd79b0bb"},"From:"),i("ir-date-picker",{key:"3e7a5f7c1898b893bcc5933eebb95517fa253ece","data-testid":"pickup_arrival_date",date:this.selectedDates?.from_date?.format("YYYY-MM-DD"),maxDate:this.defaultDates?.to_date.format("YYYY-MM-DD"),minDate:this.defaultDates?.from_date.format("YYYY-MM-DD"),emitEmptyDate:true,onDateChanged:e=>{this.selectedDates={...this.selectedDates,from_date:e.detail.start}}},i("input",{key:"24e2319fcc83ae289099638daebcc708ef86571e",type:"text",slot:"trigger",value:this.selectedDates.from_date?this.selectedDates.from_date.format("MMM DD, YYYY"):null,class:`form-control input-sm  text-center`,style:{width:"120px"}})),i("ir-button",{key:"8d99ec378c4677e15538a997a84f74720c48f891",isLoading:N("/Check_Availability"),text:"Check available units",size:"sm",onClick:()=>this.checkBookingAvailability()})),this.errors?.roomtype_id&&i("p",{key:"804855accc73e486f1914dad2435989bda3bfa6c",class:"text-danger text-left mt-2"},"Please select a room"),i("ul",{key:"d06979d6d609384200be6af61a3c9611e8b528f3",class:"room-type-list mt-2"},this.roomTypes?.map((e=>{if(!e.is_available_to_book){return null}const t=(()=>{const t=new Map;for(const i of e.rateplans??[]){for(const e of i.assignable_units??[]){if(e.Is_Fully_Available){t.set(e.pr_id,e.name)}}}return Array.from(t,(([e,t])=>({id:e,name:t})))})();return i(o,null,i("li",{key:`roomTypeRow-${e.id}`,class:`room-type-row`},i("div",{class:"d-flex choice-row"},i("span",{class:"text-left room-type-name"},e.name))),t.map(((t,s)=>{const o=s===e.physicalrooms.length-1?"pb-1":"";const a=this.selectedUnit?.unit_id===t.id&&Array.isArray(this.mealPlanOptions)&&this.mealPlanOptions.length>0;return i("li",{key:`physicalRoom-${t.id}-${s}`,class:`physical-room ${o}`},i("div",{class:"d-flex choice-row align-items-center",style:{gap:"0.5rem"}},i("ir-radio",{class:"pl-1",name:"unit",checked:this.selectedUnit?.unit_id===t.id,onCheckChange:()=>this.updateSelectedUnit({roomtype_id:e.id,unit_id:t.id}),label:t.name}),a&&i("ir-select",{firstOption:"Select a new rateplan...",error:this.errors?.rateplan_id&&!this.selectedUnit?.rateplan_id,onSelectChange:e=>{const t=e.detail===null||e.detail===undefined||e.detail===""?undefined:Number(e.detail);this.updateSelectedUnit({rateplan_id:t})},data:this.mealPlanOptions.map((e=>({...e,text:e.text+`${e.custom_text?" | ":""}${e.custom_text}`})))})))})))})))),i("div",{key:"00a70ebe0aab9bbea66be42725014e47ef3b865a",class:"sheet-footer"},i("ir-button",{key:"e81cd496bc690678f58460d0b103e73e4f871b86",text:M.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClickHandler:()=>this.closeModal.emit(null)}),i("ir-button",{key:"1d85529c2c309c741c6275e59dbf447e5e026be1",isLoading:this.isLoading,text:M.entries.Lcz_Confirm,btn_type:"submit",class:"flex-fill"})))}};Se.style=Me+Te;const Re=".sc-igl-tba-category-view-h{display:block}";const Ie=Re;const Le=class{constructor(i){e(this,i);this.assignUnitEvent=t(this,"assignUnitEvent",7)}calendarData;selectedDate;categoriesData={};categoryId;eventDatas;categoryIndex;renderAgain=false;assignUnitEvent;handleAssignRoomEvent(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;this.eventDatas=this.eventDatas.filter((e=>e.ID!=t.data.ID));this.calendarData.bookingEvents.push(t.data);this.assignUnitEvent.emit({key:"assignUnit",data:{RT_ID:this.categoryId,selectedDate:this.selectedDate,assignEvent:t.data,calendarData:this.calendarData}});this.renderView()}getEventView(e,t){return t.map(((t,s)=>i("igl-tba-booking-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,eventData:t,categoriesData:this.categoriesData,categoryId:e,categoryIndex:this.categoryIndex,eventIndex:s,onAssignRoomEvent:e=>this.handleAssignRoomEvent(e)})))}renderView(){this.renderAgain=!this.renderAgain}render(){return i(a,{key:"eb82a07e64c46e6ee4d83f782c8ee1a4ebcc20e9"},i("div",{key:"58d8c2ae6d1c8c71426bfe5f5f0909bf88f697ae",class:"sectionContainer"},i("div",{key:"d2feb4086bc4459eb96ec1dbf2602f95d8150069",class:"font-weight-bold font-small-3"},this.categoriesData[this.categoryId]?.name),this.getEventView(this.categoryId,this.eventDatas)))}};Le.style=Ie;const Be=".sc-igl-to-be-assigned-h{--spacing:var(--wa-space-l);display:block;color:var(--wa-color-text-normal);font-size:var(--wa-font-size-s);background-color:var(--wa-color-surface-default);border-inline-end:2px solid var(--wa-color-surface-border)}.fd-to-be-assigned__title.sc-igl-to-be-assigned{align-self:center;flex:1 1 auto;font-style:inherit;font-variant:inherit;font-stretch:inherit;font-family:inherit;font-optical-sizing:inherit;font-size-adjust:inherit;font-kerning:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-language-override:inherit;font-size:var(--wa-font-size-l);font-weight:var(--wa-font-weight-heading);line-height:var(--wa-line-height-condensed);margin:0px;padding:0;color:var(--wa-color-text-normal, black)}.fd-to-be-assigned__header.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:space-between;padding-inline-start:var(--spacing);padding-block-end:0;padding-inline-end:calc(var(--spacing) - var(--wa-form-control-padding-block));padding-block-start:calc(var(--spacing) - var(--wa-form-control-padding-block));border-bottom:1px solid var(--wa-color-surface-border);padding-bottom:calc(var(--spacing) / 2);box-sizing:border-box;background-color:var(--ir-drawer-background-color, var(--wa-color-surface-default))}.fd-to-be-assigned__header-container.sc-igl-to-be-assigned{position:sticky;top:0;background-color:var(--wa-color-surface-default);z-index:1}.to-be-assigned__body.sc-igl-to-be-assigned{padding:var(--spacing)}.to-be-assigned__body.sc-igl-to-be-assigned .scrollabledArea.sc-igl-to-be-assigned{display:flex;flex-direction:column;gap:1rem}.custom-dropdown.sc-igl-to-be-assigned{cursor:pointer;padding:5px 10px;width:min-content;margin-left:auto;margin-right:auto}.dropdown-toggle.sc-igl-to-be-assigned{all:unset;display:flex;width:max-content;align-items:center;gap:10px}.close_btn_style.sc-igl-to-be-assigned{padding:0.4rem}.close_btn_style.sc-igl-to-be-assigned:hover{background-color:#f6f6f6}.dropdown-menu.sc-igl-to-be-assigned{max-height:250px;overflow-y:auto}.tobeAssignedHeader.sc-igl-to-be-assigned{font-weight:500;letter-spacing:0.05rem;font-size:1.12rem;padding:0;margin:0}.assignment_header.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:space-between;padding-top:5px;margin-bottom:1rem}.dropdown-toggle.sc-igl-to-be-assigned::after{content:none;display:none}.dropdown-toggle.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transition:transform 0.2s ease}.show.sc-igl-to-be-assigned .caret-icon.sc-igl-to-be-assigned{transform:rotate(-180deg)}.stickyHeader.sc-igl-to-be-assigned{position:-webkit-sticky;position:sticky;top:0;background-color:#ffffff;z-index:1}.pointer.sc-igl-to-be-assigned{cursor:pointer}.dots.sc-igl-to-be-assigned{display:flex;align-items:center;justify-content:center;margin:0 3px;padding:0}.dot.sc-igl-to-be-assigned{width:5px;height:5px;margin:5px 4px 0;background-color:#6b6f82;border-radius:50%;animation:dotFlashing 1s infinite linear alternate}.dot.sc-igl-to-be-assigned:nth-child(2){animation-delay:0.2s}.dot.sc-igl-to-be-assigned:nth-child(3){animation-delay:0.4s}@keyframes dotFlashing{0%{opacity:0}50%,100%{opacity:1}}";const Ne=Be;const Ae=class{constructor(i){e(this,i);this.optionEvent=t(this,"optionEvent",7);this.reduceAvailableUnitEvent=t(this,"reduceAvailableUnitEvent",7);this.showBookingPopup=t(this,"showBookingPopup",7);this.addToBeAssignedEvent=t(this,"addToBeAssignedEvent",7);this.highlightToBeAssignedBookingEvent=t(this,"highlightToBeAssignedBookingEvent",7)}unassignedDatesProp;propertyid;from_date;to_date;calendarData;loadingMessage;showDatesList=false;renderAgain=false;orderedDatesList=[];noScroll=false;selectedDateDisplay="";optionEvent;reduceAvailableUnitEvent;showBookingPopup;addToBeAssignedEvent;highlightToBeAssignedBookingEvent;isGotoToBeAssignedDate=false;isLoading=true;selectedDate=null;data={};today=new Date;categoriesData={};toBeAssignedService=new R;unassignedDates;componentWillLoad(){this.reArrangeData();this.loadingMessage=M.entries.Lcz_FetchingUnAssignedUnits}handleUnassignedDatesToBeAssignedChange(e){const{fromDate:t,toDate:i,data:s}=e;let o=new Date(t);o.setHours(0);o.setMinutes(0);o.setSeconds(0);let a=o.getTime();while(a<=new Date(i).getTime()){if(s&&!s[a]&&this.unassignedDates.hasOwnProperty(a)){delete this.unassignedDates[a]}else if(s&&s[a]){this.unassignedDates[a]=s[a]}a=_(a).add(1,"days").toDate().getTime()}this.data={...this.unassignedDates};this.orderedDatesList=Object.keys(this.data).sort(((e,t)=>parseInt(e)-parseInt(t)));if(this.orderedDatesList.length){if(this.selectedDate===null){this.selectedDate=this.orderedDatesList[0]}if(this.selectedDate&&this.data[this.selectedDate]){this.selectedDateDisplay=this.data[this.selectedDate]?.dateStr||this.selectedDateDisplay;this.showForDate(this.selectedDate,false)}else{this.isLoading=false;this.renderView()}}else{this.selectedDate=null;this.selectedDateDisplay="";this.isLoading=false;this.renderView()}}handleAssignUnit(e){const t=e.detail;const i=t.data;e.stopImmediatePropagation();e.stopPropagation();if(t?.key==="assignUnit"&&this.data){if(i?.selectedDate&&this.data[i.selectedDate]){if(this.data[i.selectedDate]?.categories&&Object.keys(this.data[i.selectedDate]?.categories||{})?.length===1){this.isLoading=true;this.noScroll=true}if(i?.RT_ID&&this.data[i.selectedDate]?.categories&&this.data[i.selectedDate].categories[i.RT_ID]&&Array.isArray(this.data[i.selectedDate].categories[i.RT_ID])&&i?.assignEvent?.ID){this.data[i.selectedDate].categories[i.RT_ID]=this.data[i.selectedDate].categories[i.RT_ID].filter((e=>e&&e.ID!==i.assignEvent.ID))}if(i?.calendarData){this.calendarData=i.calendarData}this.renderView()}}}async updateCategories(e,t){try{let i={};const s=await this.toBeAssignedService.getUnassignedRooms({from_date:t.from_date,to_date:t.to_date},this.propertyid,f(new Date(+e)),t.roomsInfo,t.formattedLegendData);s.forEach((e=>{if(!i.hasOwnProperty(e.RT_ID)){i[e.RT_ID]=[e]}else{i[e.RT_ID].push(e)}}));this.unassignedDates[e].categories=i}catch(e){}}async reArrangeData(){try{this.today.setHours(0,0,0,0);this.calendarData.roomsInfo.forEach((e=>{this.categoriesData[e.id]={name:e.name,roomsList:e.physicalrooms,roomIds:e.physicalrooms.map((e=>e.id))}}));this.selectedDate=null;this.unassignedDates=L();console.log(this.unassignedDates);this.data=this.unassignedDates;this.orderedDatesList=Object.keys(this.data).sort(((e,t)=>parseInt(e)-parseInt(t)));if(!this.selectedDate&&this.orderedDatesList.length){this.selectedDate=this.orderedDatesList[0];this.selectedDateDisplay=this.data[this.selectedDate]?.dateStr||""}else if(!this.orderedDatesList.length){this.selectedDateDisplay=""}}catch(e){console.error("Error fetching unassigned dates:",e)}}async componentDidLoad(){setTimeout((()=>{if(!this.isGotoToBeAssignedDate&&Object.keys(this.unassignedDates).length>0){const e=Object.keys(this.unassignedDates)[0];this.showForDate(e)}}),100)}async gotoDate(e){this.isGotoToBeAssignedDate=true;this.showForDate(e.detail.data);this.showDatesList=false;this.renderView()}handleToBeAssignedDate(e){this.showBookingPopup.emit({key:"calendar",data:new Date(e.detail.data.fromDate).getTime()-864e5,noScroll:false})}async showForDate(e,t=true){try{if(t){this.isLoading=true}if(this.showDatesList){this.showUnassignedDate()}await this.updateCategories(e,this.calendarData);this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.showBookingPopup.emit({key:"calendar",data:parseInt(e)-864e5,noScroll:this.noScroll});if(this.isGotoToBeAssignedDate){this.isGotoToBeAssignedDate=false}this.isLoading=false;this.selectedDate=e;this.selectedDateDisplay=this.data[e]?.dateStr||this.selectedDateDisplay;this.renderView()}catch(e){}}getDay(e){const t=new Date(e);const i="default";const s=this.getLocalizedDayOfWeek(t,i);return s+" "+t.getDate()+", "+t.getFullYear()}getLocalizedDayOfWeek(e,t){const i={weekday:"short"};return e.toLocaleDateString(t,i)}handleOptionEvent(e,t=""){this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:"----"}});this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.optionEvent.emit({key:e,data:t})}showUnassignedDate(){this.showDatesList=!this.showDatesList}getToBeAssignedEntities(){}getCategoryView(){if(this.orderedDatesList.length&&this.selectedDate&&this.data[this.selectedDate]){return Object.entries(this.data[this.selectedDate].categories).map((([e,t],s)=>i("igl-tba-category-view",{calendarData:this.calendarData,selectedDate:this.selectedDate,categoryId:e,categoryIndex:s,categoriesData:this.categoriesData,eventDatas:t,onAssignUnitEvent:e=>this.handleAssignUnit(e)})))}else{return null}}renderView(){this.renderAgain=!this.renderAgain}render(){const e=this.selectedDate?this.data[this.selectedDate]:null;return i(a,{key:"b1482e85e47d0c71e328123289c8e6aa52964054",class:"tobeAssignedContainer pr-1 text-left"},i("div",{key:"e6b4b9058e88ac31e21bd147336ec6927cc40d8f",class:"fd-to-be-assigned__header-container"},i("div",{key:"04361baf0f1097654f39d2e9d448761a41a8437a",class:"fd-to-be-assigned__header"},i("h2",{key:"40577d7af25923b4c08ab3b7c1e09c722ab922f4",class:"fd-to-be-assigned__title",id:"to-be-assigned-title"},M.entries.Lcz_Assignments),i("ir-custom-button",{key:"b5ad8e7187f7ac9e1144f3492384e1620ebf3923",size:"medium",onClickHandler:()=>this.handleOptionEvent("closeSideMenu"),appearance:"plain",variant:"neutral"},i("wa-icon",{key:"a448f41e533e279c593411ec41109f30c9e1e53c",name:"xmark",variant:"solid",label:"Close","aria-label":"Close",role:"img"}))),Object.keys(this.data).length===0?i("p",null,M.entries.Lcz_AllBookingsAreAssigned):this.isLoading?i("p",{class:"d-flex align-items-center"},i("span",{class:"p-0"},this.loadingMessage),i("div",{class:"dots"},i("div",{class:"dot"}),i("div",{class:"dot"}),i("div",{class:"dot"}))):i("div",{style:{padding:"0.5rem"}},this.orderedDatesList.length?i("div",{class:`custom-dropdown border border-light rounded text-center `+(this.showDatesList?"show":""),id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},i("div",{class:"dropdown-toggle"},i("span",{class:"font-weight-bold"},e?.dateStr||this.selectedDateDisplay),i("svg",{class:"caret-icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",height:14,width:14},i("path",{fill:"#6b6f82",d:"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"}))),i("div",{class:"dropdown-menu dropdown-menu-right full-width","aria-labelledby":"dropdownMenuButton"},this.orderedDatesList?.map((e=>i("div",{class:"dropdown-item pointer",onClick:()=>this.showForDate(e)},this.data[e].dateStr))))):M.entries.Lcz_AllBookingsAreAssigned)),i("div",{key:"ad56bc4f0b0d8f280b2f17ae3a7959565eb7e7ac",class:"to-be-assigned__body"},!this.isLoading&&i("div",{key:"ff50825688e3b6a3c0e55c135f4212fcb66c9ce0",class:"scrollabledArea"},this.selectedDate?e&&Object.keys(e.categories).length?this.getCategoryView():i("div",null,M.entries.Lcz_AllAssignForThisDay):null)))}static get watchers(){return{unassignedDatesProp:["handleUnassignedDatesToBeAssignedChange"]}}};Ae.style=Ne;const Oe=".sc-ir-interactive-title-h{display:block;width:100%;--hk-green:green}*.sc-ir-interactive-title{box-sizing:border-box}.popover-title.sc-ir-interactive-title{position:relative;width:100%;height:100%;margin:0;padding:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;z-index:10;left:0;display:flex;align-items:center}.popover-container.sc-ir-interactive-title{position:absolute;bottom:0px;left:var(--ir-popover-left, 10px);background:rgb(0, 0, 0);color:white;min-width:100%;box-shadow:rgba(0, 0, 0, 0.2) 0px 2px 10px;z-index:9999;padding:3.5px 7px;border-radius:5px;pointer-events:none;opacity:0;transition:all 100ms ease;font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;font-style:normal;font-weight:400;line-height:1.45;text-decoration:none;text-shadow:none;font-size:0.875rem}.popover-container[data-state='show'].sc-ir-interactive-title{opacity:1}.hk-dot.sc-ir-interactive-title{inset:0;position:absolute;display:flex;align-items:center;justify-content:center;width:fit-content;padding:4px;left:auto;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;padding-inline:var(--ir-popover-left);background:var(--ir-interactive-hk-bg, var(--wa-color-surface-default));color:var(--dot-color, var(--wa-color-text-normal))}.hk-dot.sc-ir-interactive-title-s>*[name='end']{height:12px}";const $e=Oe;const ze=class{constructor(t){e(this,t)}get el(){return s(this)}popoverTitle="";irPopoverLeft="10px";hkStatus=false;cropSize=20;broomTooltip;lastRenderedTitle="";titleContainerRef;popoverInstance;initializePopoverIfNeeded(e,t){if(this.lastRenderedTitle===t&&this.popoverInstance){return}this.disposePopover();const i=document.createElement("span");i.style.visibility="hidden";i.style.position="absolute";i.style.whiteSpace="nowrap";i.textContent=t;document.body.appendChild(i);const s=i.offsetWidth;document.body.removeChild(i);const o=e.clientWidth;const a=this.hkStatus?20:0;const n=s+a>o;if(n&&typeof $!=="undefined"){try{this.popoverInstance=$(e).popover({trigger:"hover",content:t,placement:"top",html:false,sanitize:true,delay:{show:300,hide:100}})}catch(e){console.error("Failed to initialize popover:",e)}}this.lastRenderedTitle=t}disposePopover(){if(this.popoverInstance&&typeof $!=="undefined"){try{$(this.titleContainerRef).popover("dispose");this.popoverInstance=null}catch(e){console.error("Failed to dispose popover:",e)}}}disconnectedCallback(){this.disposePopover()}render(){const e=this.popoverTitle||"";const t=e.length>this.cropSize;const s=t?e.slice(0,this.cropSize)+"...":e;return i(a,{key:"4c87fd4f7d21f635650b29965659362dccbc5126",style:{"--ir-popover-left":this.irPopoverLeft}},i("p",{key:"561f8430e558b4ecd9c21314be551857700dcaf3",ref:t=>{this.titleContainerRef=t;if(t&&e){setTimeout((()=>this.initializePopoverIfNeeded(t,e)),0)}},class:"popover-title",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center",gap:"4px"}},i("span",{key:"d05a96224f5de5722f7d566db33310e3d36ef5f2",class:"cropped-title",style:{flexShrink:"1",minWidth:"0",overflow:"hidden",textOverflow:"ellipsis"}},s),this.hkStatus&&i("div",{key:"bcedef71ad4c7720b7b3819e923a8c2fbed98b1b",title:this.broomTooltip,class:"hk-dot",style:{flexShrink:"0"}},i("slot",{key:"9932ee8aa245ff57239f0b2f4b3515f6217255f5",name:"end"}))))}};ze.style=$e;const Pe=":host{display:inline-flex}.new-badge{font-weight:400;text-align:center;vertical-align:middle !important;text-transform:uppercase;letter-spacing:0.02em;line-height:1;display:inline-flex;align-items:center;justify-content:center;width:fit-content;white-space:nowrap;background:#ff4961;color:white;padding:0.2rem 0.3rem;font-size:0.75rem !important;border-radius:4px}";const He=Pe;const Ue=class{constructor(t){e(this,t)}render(){return i(a,{key:"fc652419be0a78e2ddfaccd3fca6335906332760"},i("span",{key:"a723e95fd8c0c99238bcdcc055f1d2a5a74e0508",class:"new-badge"},"new"))}};Ue.style=He;const Fe=".sc-ir-price-input-h{display:block;--ir-input-border-color:#cacfe7;flex:1 1 0%}.sc-ir-price-input-h .input-group-text.sc-ir-price-input{border-color:var(--ir-input-border-color)}.sc-ir-price-input-h .form-control.sc-ir-price-input,.currency-label.sc-ir-price-input{font-size:14px !important}.ir-bl-lbl-none.sc-ir-price-input,.ir-bl-input-none.sc-ir-price-input{border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}.rate-input.sc-ir-price-input:read-only{background:white !important}.ir-br-lbl-none.sc-ir-price-input,.ir-br-input-none.sc-ir-price-input{border-top-right-radius:0 !important;border-bottom-right-radius:0 !important}.ir-br-none.sc-ir-price-input{border-right:none}.ir-bl-none.sc-ir-price-input{border-left:none}.rate-input-container.sc-ir-price-input{display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;flex:1;padding:0 !important}[class='special-style'].sc-ir-price-input-h .rate-input.sc-ir-price-input{background:black !important}.rate-input.sc-ir-price-input{font-size:0.875rem;line-height:0;padding:0;height:0;box-sizing:border-box;border-left:0;padding-left:0px !important;border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}.currency-label.with-label.sc-ir-price-input{border-radius:0}.currency-label.sc-ir-price-input{box-sizing:border-box;color:#3b4781;border:1px solid #cacfe7;font-size:0.875rem;height:2rem;background:white;border-right:0;border-top-right-radius:0;border-bottom-right-radius:0;pointer-events:none;transition:border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.currency-label.disabled.sc-ir-price-input,.rate-input.sc-ir-price-input:disabled{background-color:#eceff1;border-color:rgba(118, 118, 118, 0.3)}.price-input-group.sc-ir-price-input:focus-within .currency-label.sc-ir-price-input{border-top:1px solid #1e9ff2;border-bottom:1px solid #1e9ff2;border-left:1px solid #1e9ff2}[data-state='error'].sc-ir-price-input-h .currency-label.sc-ir-price-input,[data-state='error'].sc-ir-price-input-h .rate-input.sc-ir-price-input,.error.sc-ir-price-input{border-color:var(--red, #ff4961) !important}.price-input.sc-ir-price-input:focus{border-right-width:1px !important}.is-invalid.sc-ir-price-input{background-image:none !important}";const je=Fe;const Ve=class{constructor(i){e(this,i);this.textChange=t(this,"textChange",7);this.inputBlur=t(this,"inputBlur",7);this.inputFocus=t(this,"inputFocus",7)}get el(){return s(this)}label;readOnly;inputStyle;labelStyle;disabled;currency;autoValidate=true;wrapKey;zod;placeholder="";value="";required=false;minValue;maxValue;testId;error;containerClassname;labelContainerClassname;textChange;inputBlur;inputFocus;id;opts={mask:Number,scale:2,radix:".",mapToRadix:[","],normalizeZeros:true,padFractionalZeros:true,thousandsSeparator:","};mask;inputRef;componentWillLoad(){if(this.el.id){this.id=this.el.id}else{this.id=O()}}componentDidLoad(){if(!this.mask){this.initializeMask()}}initializeMask(){const e={...this.opts};if(this.minValue!==undefined){e["min"]=this.minValue}if(this.maxValue!==undefined){e["max"]=this.maxValue}this.mask=A(this.inputRef,e);if(this.value){this.mask.value=this.value}this.mask.on("accept",(()=>{const e=this.inputRef.value.trim()===""||this.mask.unmaskedValue==="";if(e){this.value="";this.textChange.emit(null)}else{this.value=this.mask.unmaskedValue;this.textChange.emit(this.value)}}))}hasSpecialClass(e){return this.el.classList.contains(e)}validateInput(e){if(!this.autoValidate){return}if(this.zod){try{this.zod.parse(this.wrapKey?{[this.wrapKey]:e}:e);this.error=false}catch(e){console.log(e);this.error=true}}}handleInputChange=()=>{this.validateInput(this.value)};handleBlur=()=>{this.validateInput(this.value);if(this.value){const e=parseFloat(this.value);this.value=e.toFixed(2);if(this.mask){this.mask.value=this.value}}this.inputBlur.emit(this.value)};handleFocus=()=>{this.inputFocus.emit()};render(){return i("fieldset",{key:"2a4dedbee0bcefcf3eb10ae097acac738f77703d",class:`${this.containerClassname} input-group price-input-group m-0 p-0 `},this.label&&i("div",{key:"42ba0f09f8a69b3334a1c888be1af1c03ffbb611",class:`input-group-prepend ${this.labelContainerClassname}`},i("span",{key:"e83297981913fd6d6b93487f95c797da6184c3d8",class:`input-group-text \n                ${this.labelStyle}\n              ${this.hasSpecialClass("ir-bl-lbl-none")?"ir-bl-lbl-none":""}\n              ${this.hasSpecialClass("ir-br-lbl-none")?"ir-br-lbl-none":""}\n              ${this.hasSpecialClass("ir-br-none")?"ir-br-none":""} \n              ${this.hasSpecialClass("ir-bl-none")?"ir-bl-none":""} \n              `},i("label",{key:"7e1df4185add2fbcefee5abc793775ef9e6aa689",class:"p-0 m-0 ",htmlFor:this.id},this.label))),i("div",{key:"14bd9213e9a6ab845e9e30a8aedd728a4f68d095",class:"position-relative has-icon-left rate-input-container"},this.currency&&i("div",{key:"5792c29f1f8b5755a3745cb2a051e0e31edb04cf"},i("span",{key:"28953291fb0469c247776dce2a79dc221beb3d49",class:`input-group-text ${this.disabled?"disabled":""} currency-label ${this.error?"error":""} ${this.label?"with-label":""}`},this.currency)),i("input",{key:"891dd1f6a5549a95b298147a90ae0e4871ac030a",ref:e=>this.inputRef=e,"data-testid":this.testId,disabled:this.disabled,id:this.id,class:`form-control input-sm rate-input \n              ${this.inputStyle}\n              ${this.hasSpecialClass("ir-br-input-none")?"ir-br-input-none":""} \n              ${this.hasSpecialClass("ir-bl-input-none")?"ir-bl-input-none":""} \n              ${this.error?"error":""} py-0 m-0 ${this.currency?"ir-bl-none":""}`,onInput:this.handleInputChange,onBlur:this.handleBlur,onFocus:this.handleFocus,type:"text",placeholder:this.placeholder,readOnly:this.readOnly,"aria-label":this.el.ariaLabel??"price-input","aria-describedby":this.el.ariaDescription??"price-input"})))}};Ve.style=je;const We=".sc-ir-reallocation-drawer-h{display:block}";const qe=We;const Ge=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7)}open;booking;roomIdentifier;pool;closeModal;_id=`reallocation-form_${O()}`;render(){return i("ir-drawer",{key:"065ed4fc8ebb9b635f3c95c5b55b5f938526ea43",label:"Reassign Unit",open:this.open,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeModal.emit()}},this.open&&i("ir-reallocation-form",{key:"601cb5cab0e812b97ea4588fdc171b439bf98ac1",pool:this.pool,formId:this._id,booking:this.booking,identifier:this.roomIdentifier}),i("div",{key:"8864ea48e54df19ffe70f66b3a0ab42297a2c266",slot:"footer",class:"ir__drawer-footer"},i("ir-custom-button",{key:"4bfaa49e2ef6c9cf2d97d6c5a7faf80883a5988b",size:"medium","data-drawer":"close",variant:"neutral",appearance:"filled"},"Cancel"),i("ir-custom-button",{key:"72b894c2b8f33bc938a09154d02559e3090760a3",form:this._id,size:"medium",loading:N("/ReAllocate_Exposed_Room"),type:"submit",variant:"brand"},"Confirm")))}};Ge.style=qe;const Ke=".sc-ir-reallocation-form-h{display:block;height:100%;color:var(--ir-text-color, #1f2a37);font-family:var(--ir-font-family, 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif)}.reallocation-form.sc-ir-reallocation-form{display:flex;flex-direction:column;gap:0.75rem}.booking-summary.sc-ir-reallocation-form{display:flex;flex-direction:column;gap:0.5rem}.rateplan-details.sc-ir-reallocation-form{margin:0;font-weight:500;color:var(--wa-color-text-quiet, #4b5563)}.rateplan-details-unit.sc-ir-reallocation-form{font-weight:700;color:var(--wa-color-text-normal)}.date-picker-row.sc-ir-reallocation-form{display:flex;flex-wrap:wrap;gap:0.5rem;align-items:flex-end}.date-picker-row.sc-ir-reallocation-form .ir-custom-date-picker.sc-ir-reallocation-form{flex:1 1 220px}.error-message.sc-ir-reallocation-form{margin:0;margin-top:0.75rem;color:var(--ir-error-color, #c0392b);font-size:0.95rem}.room-type-list.sc-ir-reallocation-form{display:flex;flex-direction:column;gap:0.75rem}.arrow-container.sc-ir-reallocation-form{width:100%;display:flex;justify-content:center}.choice-row.sc-ir-reallocation-form{display:flex;align-items:center;justify-content:space-between;gap:0.5rem}.room-type-name.sc-ir-reallocation-form{font-weight:600;color:var(--ir-heading-color, #111827)}.physical-room.sc-ir-reallocation-form{display:flex;align-items:center;font-size:0.95rem;padding-inline-start:1rem}.physical-room.sc-ir-reallocation-form::part(label){display:flex;align-items:center}.physical-room.sc-ir-reallocation-form+.physical-room.sc-ir-reallocation-form{margin-top:0.5rem}.physical-room--last.sc-ir-reallocation-form{margin-bottom:0.25rem}.physical-room.sc-ir-reallocation-form wa-select.sc-ir-reallocation-form{margin-left:1rem;min-width:220px}.custom-date-picker.sc-ir-reallocation-form{max-width:200px}.room-type-row.sc-ir-reallocation-form{margin-bottom:0.5rem}";const Xe=Ke;const Ze=class{constructor(i){e(this,i);this.closeModal=t(this,"closeModal",7)}booking;identifier;pool;formId;date;isLoading;room;roomTypes=[];selectedUnit={};errors;mealPlanOptions=null;closeModal;bookingService=new n;eventsService=new Y;componentWillLoad(){this.room=this.getRoom();this.date=_(this.room.from_date,"YYYY-MM-DD");this.checkBookingAvailability()}getRoom(){if(!this.booking){throw new Error("Missing booking")}if(!this.identifier){throw new Error("Missing Identifier")}const e=this.booking.rooms.find((e=>e.identifier===this.identifier));if(!e){throw new Error(`Couldn't find room with identifier ${this.identifier}`)}return e}async checkBookingAvailability(){this.isLoading=true;r(false);const e=this.booking.agent!==null;const{from_date:t,to_date:i}=this.getDates();try{const s=await this.bookingService.getBookingAvailability({from_date:t,to_date:i,propertyid:this.booking.property.id,adultChildCount:{adult:1,child:0},language:"en",room_type_ids:[],currency:this.booking.currency,agent_id:e?this.booking.agent.id:null,is_in_agent_mode:e,room_type_ids_to_update:[]});this.roomTypes=s.filter((e=>e.is_available_to_book));this.isLoading=false}catch(e){console.error("Error initializing booking availability:",e)}}getDates(){return{from_date:this.date.clone().format("YYYY-MM-DD"),to_date:this.date.clone().add(v(this.room.from_date,this.room.to_date),"days").format("YYYY-MM-DD")}}async reallocateUnit(){try{this.errors=null;const e=Ye.parse(this.selectedUnit);const{from_date:t,to_date:i}=this.getDates();await this.eventsService.reallocateEvent(this.pool,e.unit_id,t,i,e.rateplan_id);this.closeModal.emit(null)}catch(e){const t={};if(e instanceof S){console.error(e);e.issues.forEach((e=>{t[e.path[0]]=true}));this.errors={...t}}}}updateSelectedUnit(e){const t={...this.selectedUnit,...e};const i=E?.property?.roomtypes;const s=d({rateplan_id:this.room.rateplan.id.toString(),roomTypeId:t?.roomtype_id,roomTypes:i});const o=Object.prototype.hasOwnProperty.call(e,"rateplan_id");if(Array.isArray(s)){this.mealPlanOptions=s;if(!o){delete t.rateplan_id}}else{this.mealPlanOptions=null;if(!o){if(s){t.rateplan_id=Number(s.value)}else{delete t.rateplan_id}}}this.selectedUnit=t}render(){if(this.isLoading){return i("div",{class:"drawer__loader-container"},i("ir-spinner",null))}return i("form",{id:this.formId,class:"reallocation-form",onSubmit:e=>{e.preventDefault();this.reallocateUnit()}},i("div",{class:"booking-summary"},i("ir-date-view",{from_date:this.room.from_date,to_date:this.room.to_date,showDateDifference:false})),i("div",null,i("wa-callout",{size:"small",appearance:"filled",variant:"neutral"},i("p",{style:{padding:"0",margin:"0"}},i("span",{class:"rateplan-details"},this.room.roomtype.name," ",this.room.rateplan.short_name," ",this.room.rateplan.is_non_refundable?M.entries.Lcz_NonRefundable:""," ",i("span",{class:"rateplan-details-unit"},this.room.unit.name)))),this.errors?.roomtype_id&&i("p",{class:"error-message"},"Please select a room"),this.roomTypes.length===0?i("ir-empty-state",{style:{marginTop:"20vh"}}):i(o,null,i("div",{class:"arrow-container"},i("svg",{height:30,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"},i("path",{d:"M297.4 566.6C309.9 579.1 330.2 579.1 342.7 566.6L502.7 406.6C515.2 394.1 515.2 373.8 502.7 361.3C490.2 348.8 469.9 348.8 457.4 361.3L352 466.7L352 96C352 78.3 337.7 64 320 64C302.3 64 288 78.3 288 96L288 466.7L182.6 361.3C170.1 348.8 149.8 348.8 137.3 361.3C124.8 373.8 124.8 394.1 137.3 406.6L297.3 566.6z"}))),i("wa-callout",{size:"small",appearance:"filled",variant:"neutral"},i("wa-radio-group",{onchange:e=>{const[t,i]=e.target.value.split("_");this.updateSelectedUnit({roomtype_id:Number(t),unit_id:Number(i)})},name:"available-units",class:"room-type-list"},this.roomTypes?.map((e=>{const t=(()=>{const t=new Map;for(const i of e.rateplans??[]){for(const e of i.assignable_units??[]){if(e.Is_Fully_Available){t.set(e.pr_id,e.name)}}}return Array.from(t,(([e,t])=>({id:e,name:t})))})();return i(o,null,i("div",{key:`roomTypeRow-${e.id}`,class:`room-type-row`},i("div",{class:"choice-row"},i("span",{class:"room-type-name"},e.name))),t.map(((s,o)=>{const a=o===t.length-1;const n=this.selectedUnit?.unit_id===s.id&&Array.isArray(this.mealPlanOptions)&&this.mealPlanOptions.length>0;return i("wa-radio",{value:`${e.id}_${s.id}`,checked:this.selectedUnit?.unit_id===s.id,key:`physicalRoom-${s.id}-${o}`,class:`physical-room${a?" physical-room--last":""}`},i("span",null,s.name),n&&i("ir-validator",{value:this.selectedUnit?.rateplan_id,schema:Ye.shape.rateplan_id},i("wa-select",{size:"small",placeholder:"Select a new rateplan...",value:this.selectedUnit?.rateplan_id?.toString(),onchange:e=>{e.stopImmediatePropagation();e.stopPropagation();this.updateSelectedUnit({rateplan_id:Number(e.target.value)})}},this.mealPlanOptions.map((e=>i("wa-option",{value:e.value?.toString()},e.text+`${e.custom_text?" | ":""}${e.custom_text}`))))))})))})))))))}};Ze.style=Xe;const Je=".sc-ir-room-nights-h{display:block;box-sizing:border-box;margin:0;position:relative}.loading-container.sc-ir-room-nights{position:relative;height:100%;width:100%;display:flex;align-items:center;justify-content:center}.close-icon.sc-ir-room-nights{position:absolute;top:18px;right:33px;outline:none}.close.sc-ir-room-nights{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.card.sc-ir-room-nights{top:0;z-index:1000}.card-title.sc-ir-room-nights{border-bottom:1px solid #e4e5ec;width:100%}.irfontgreen.sc-ir-room-nights{color:#0e930e}.currency.sc-ir-room-nights{display:block;position:absolute;margin:0;padding:0;height:auto;left:10px}.rate-input.sc-ir-room-nights{font-size:14px;line-height:0;padding:0;height:0;border-left:0;border-radius:0.25rem !important}.rate-input-container.sc-ir-room-nights{display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;flex:1}.new-currency.sc-ir-room-nights{color:#3b4781;border:1px solid #cacfe7;font-size:0.975rem;height:2rem;background:rgb(255, 255, 255);padding-right:0 !important;border-right:0;border-top-right-radius:0;border-bottom-right-radius:0;transition:border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.input-group-prepend.sc-ir-room-nights span[data-state='focus'].sc-ir-room-nights{border-color:var(--blue)}.input-group-prepend.sc-ir-room-nights span[data-disabled].sc-ir-room-nights{background-color:#eceff1;border-color:rgba(118, 118, 118, 0.3)}.rateInputBorder.sc-ir-room-nights{padding-left:5px !important;padding-right:5px !important;border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}";const Qe=Je;const et=".sc-ir-room-nights-h{height:100%}.sheet-container.sc-ir-room-nights{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-room-nights{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-room-nights{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-room-nights{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-room-nights{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-room-nights{flex-direction:row;align-items:center}}";const tt=et;const it=class{constructor(i){e(this,i);this.closeRoomNightsDialog=t(this,"closeRoomNightsDialog",7)}bookingNumber;propertyId;language;identifier;toDate;fromDate;pool;ticket;defaultDates;bookingEvent;selectedRoom;rates=[];isLoading=false;initialLoading=false;inventory=null;isEndDateBeforeFromDate=false;defaultTotalNights=0;isInputFocused=-1;dates={from_date:new Date,to_date:new Date};closeRoomNightsDialog;bookingService=new n;componentWillLoad(){this.dates={from_date:new Date(this.fromDate),to_date:new Date(this.toDate)};this.init()}isButtonDisabled(){return this.isLoading||this.rates.some((e=>e.amount===-1))||this.inventory===0||this.inventory===null}async init(){try{const{from_date:e}=this.defaultDates;if(_(e,"YYYY-MM-DD").isBefore(_(this.fromDate,"YYYY-MM-DD"))){this.dates.from_date=new Date(e)}else{this.dates.from_date=new Date(this.fromDate)}this.dates.to_date=new Date(this.toDate);this.bookingEvent=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);if(this.bookingEvent){const e=this.bookingEvent.rooms.filter((e=>e.identifier===this.identifier));this.selectedRoom=e[0];const t=this.selectedRoom?.days[this.selectedRoom.days.length-1];if(_(this.toDate).add(-1,"days").isSame(_(t.date))){console.log("here1");const e=await this.fetchBookingAvailability(this.fromDate,this.selectedRoom.days[0].date,this.selectedRoom.rateplan.id);const t=b(this.selectedRoom.days[0].date,this.fromDate);this.isEndDateBeforeFromDate=true;this.rates=[...t.map((i=>({amount:e/t.length,date:i,cost:null}))),...this.selectedRoom.days];this.defaultTotalNights=this.rates.length-this.selectedRoom.days.length}else{console.log("here2");console.log(t);const e=await this.fetchBookingAvailability(this.bookingEvent.to_date,_(this.toDate,"YYYY-MM-DD").format("YYYY-MM-DD"),this.selectedRoom.rateplan.id);const i=b(t.date,this.toDate);this.rates=[...this.selectedRoom.days,...i.map((t=>({amount:e/i.length,date:t,cost:null})))]}}}catch(e){console.log(e)}}handleInput(e,t){let i=e;let s=[...this.rates];i=i.replace(/[^0-9.]/g,"");if(i===""){s[t].amount=-1}else{if(!isNaN(Number(i))){s[t].amount=Number(i)}}this.rates=s}async fetchBookingAvailability(e,t,i){try{this.initialLoading=true;const s=await this.bookingService.getBookingAvailability({from_date:e,to_date:t,propertyid:this.propertyId,adultChildCount:{adult:this.selectedRoom.rateplan.selected_variation.adult_nbr,child:this.selectedRoom.rateplan.selected_variation.child_nbr},language:this.language,currency:this.bookingEvent.currency,room_type_ids:[this.selectedRoom.roomtype.id],rate_plan_ids:[i]});console.log(s[0],i);this.inventory=s[0].inventory;const o=s[0].rateplans.find((e=>e.id===i));if(!o||!o.variations){this.inventory=null;return null}const a=o.variations?.find((e=>e.adult_nbr===this.selectedRoom.rateplan.selected_variation.adult_nbr&&e.child_nbr===this.selectedRoom.rateplan.selected_variation.child_nbr));if(!a){return null}return a.discounted_gross_amount}catch(e){console.error(e)}finally{this.initialLoading=false}}renderInputField(e,t,s){return i("div",{class:"col-3 ml-1 position-relative  m-0 p-0 rate-input-container"},i("ir-price-input",{value:s.amount>0?s.amount.toString():"",disabled:this.inventory===0||this.inventory===null,currency:t,"aria-label":"rate","aria-describedby":"rate cost",onTextChange:t=>this.handleInput(t.detail,e)}))}renderReadOnlyField(e,t){return i("p",{class:"col-9 ml-1 m-0 p-0"},`${e}${Number(t.amount).toFixed(2)}`)}renderRateFields(e,t,i){if(this.isEndDateBeforeFromDate){if(e<this.defaultTotalNights){return this.renderInputField(e,t,i)}else{return this.renderReadOnlyField(t,i)}}else{return e<this.selectedRoom.days.length?this.renderReadOnlyField(t,i):this.renderInputField(e,t,i)}}renderDates(){const e=this.bookingEvent.currency.symbol;return i("div",{class:"mt-2 m-0"},this.rates?.map(((t,s)=>i("div",{class:"row m-0 mt-1 align-items-center"},i("p",{class:"col-2 m-0 p-0"},p(t.date)),this.renderRateFields(s,e,t)))))}async handleRoomConfirmation(){try{this.isLoading=true;let e=[...this.bookingEvent.rooms];let t=e.findIndex((e=>e.identifier===this.identifier));if(t===-1){throw new Error("Invalid Pool")}e[t]={...e[t],days:this.rates,to_date:_(this.dates.to_date).format("YYYY-MM-DD"),from_date:_(this.dates.from_date).format("YYYY-MM-DD")};const i={assign_units:true,check_in:true,is_pms:true,is_direct:true,pickup_info:this.bookingEvent.pickup_info,extra_services:this.bookingEvent.extra_services,booking:{booking_nbr:this.bookingNumber,from_date:_(this.dates.from_date).format("YYYY-MM-DD"),to_date:_(this.dates.to_date).format("YYYY-MM-DD"),remark:this.bookingEvent.remark,property:this.bookingEvent.property,source:this.bookingEvent.source,currency:this.bookingEvent.currency,arrival:this.bookingEvent.arrival,guest:this.bookingEvent.guest,rooms:e}};await this.bookingService.doReservation(i);this.closeRoomNightsDialog.emit({type:"confirm",pool:this.pool})}catch(e){}finally{this.isLoading=false}}render(){if(!this.bookingEvent){return i("div",{class:"loading-container"},i("ir-loading-screen",null))}return i("div",{class:"sheet-container"},i("ir-title",{class:"p-1 sheet-header",onCloseSideBar:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool}),label:`${M.entries.Lcz_AddingRoomNightsTo} ${this.selectedRoom?.roomtype?.name} ${(this.selectedRoom?.unit).name}`,displayContext:"sidebar"}),i("section",{class:"text-left px-1 pt-0 sheet-body"},i("p",{class:"font-medium-1"},`${M.entries.Lcz_Booking}#`," ",this.bookingNumber),this.initialLoading?i("p",{class:"mt-2 text-secondary"},M.entries["Lcz_CheckingRoomAvailability "]):i(o,null,i("p",{class:"font-weight-bold font-medium-1"},`${u(_(this.dates.from_date).format("YYYY-MM-DD"),"YYYY-MM-DD")} - ${u(_(this.dates.to_date).format("YYYY-MM-DD"),"YYYY-MM-DD")}`),i("p",{class:"font-medium-1 mb-0"},`${this.selectedRoom.rateplan.name}`," ",this.selectedRoom.rateplan.is_non_refundable&&i("span",{class:"irfontgreen"},M.entries.Lcz_NonRefundable)),(this.inventory===0||this.inventory===null)&&i("p",{class:"font-medium-1 text danger"},M.entries.Lcz_NoAvailabilityForAdditionalNights),this.selectedRoom.rateplan.custom_text&&i("p",{class:"text-secondary mt-0"},this.selectedRoom.rateplan.custom_text),this.renderDates())),i("section",{class:"sheet-footer"},i("ir-button",{btn_color:"secondary",btn_disabled:this.isLoading,text:M?.entries.Lcz_Cancel,class:"full-width",btn_styles:"justify-content-center",onClickHandler:()=>this.closeRoomNightsDialog.emit({type:"cancel",pool:this.pool})}),this.inventory>0&&this.inventory!==null&&i("ir-button",{isLoading:this.isLoading,text:M?.entries.Lcz_Confirm,btn_disabled:this.isButtonDisabled(),class:"full-width",btn_styles:"justify-content-center",onClickHandler:this.handleRoomConfirmation.bind(this)})))}};it.style=Qe+tt;const st=":host{display:block}.spinner{transform-origin:center;animation:spinner_svv2 0.75s infinite linear}@keyframes spinner_svv2{100%{transform:rotate(360deg)}}";const ot=st;const at=class{constructor(i){e(this,i);this.loaderComplete=t(this,"loaderComplete",7)}spinnerDuration=1500;successDuration=1e3;autoStart=true;active=true;loaderComplete;phase="spinner";spinnerTimer;successTimer;componentWillLoad(){if(this.autoStart&&this.active){this.startCycle()}}disconnectedCallback(){this.clearTimers()}onActiveChange(e){if(e){if(this.autoStart){this.startCycle()}}else{this.resetCycle()}}onDurationChange(){if(this.active&&this.autoStart){this.startCycle()}}startCycle(){this.clearTimers();this.phase="spinner";const e=Math.max(0,Number(this.spinnerDuration)||0);if(e===0){this.showSuccess();return}this.spinnerTimer=window.setTimeout((()=>this.showSuccess()),e)}showSuccess(){this.phase="success";const e=Math.max(0,Number(this.successDuration)||0);if(e===0){this.handleCompletion();return}this.successTimer=window.setTimeout((()=>this.handleCompletion()),e)}handleCompletion(){this.loaderComplete.emit();this.active=false}resetCycle(){this.clearTimers();this.phase="spinner"}clearTimers(){if(this.spinnerTimer){clearTimeout(this.spinnerTimer);this.spinnerTimer=undefined}if(this.successTimer){clearTimeout(this.successTimer);this.successTimer=undefined}}render(){return i(a,{key:"8d9b3636a148d9810399219a673ca289e43dd508"},this.phase==="spinner"?i("wa-spinner",null):i("wa-icon",{part:"check",name:"check",style:{color:"var(--wa-color-success-fill-loud,#45b16d)"}}))}static get watchers(){return{active:["onActiveChange"],spinnerDuration:["onDurationChange"],successDuration:["onDurationChange"]}}};at.style=ot;const nt=".sc-ir-tabs-h{display:flex;align-items:center;position:relative;overflow-x:auto;gap:1rem;padding:0 1rem}.tab.sc-ir-tabs{font-size:0.95rem;font-weight:400;cursor:pointer;position:relative;margin:0;padding:0rem;padding-bottom:1rem;transition:color 0.3s ease;user-select:none;background-color:transparent;border:none;outline:none;flex:1 1 0%;text-align:center;white-space:nowrap}.tab[data-disabled].sc-ir-tabs{cursor:auto}.tab.sc-ir-tabs:hover{opacity:80%}.tab[data-state='selected'].sc-ir-tabs,.tab[data-state='selected'].sc-ir-tabs:hover{color:var(--blue, #1e9ff2);opacity:100%}.active-indicator.sc-ir-tabs{padding:0;bottom:0px;position:absolute;height:3px;border-radius:4px;transition:transform 0.3s ease, width 0.3s ease;background:var(--blue, #1e9ff2)}";const rt=nt;const lt=class{constructor(i){e(this,i);this.tabChanged=t(this,"tabChanged",7)}get el(){return s(this)}tabs=[];initialTab;disabled=false;ariaLabel="Tabs";_selectedTab;tabChanged;activeIndicator;animationFrameId;componentWillLoad(){const e=this.tabs?.find((e=>e.id===this.initialTab));if(e){this.selectTab(e)}else if(this.tabs?.length>0){this.selectTab(this.tabs[0])}}disconnectedCallback(){if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}}updateActiveIndicator(){if(this.animationFrameId){cancelAnimationFrame(this.animationFrameId)}requestAnimationFrame((()=>{const e=this.el.querySelector(`.tab[data-state="selected"]`);if(e){const{left:t,width:i}=e.getBoundingClientRect();const s=this.el.getBoundingClientRect().left;const o=t-s-this.remSize;this.activeIndicator.style.width=`${i-this.remSize}px`;this.activeIndicator.style.transform=`translateX(${o}px)`}}))}remSize=(()=>{const e=getComputedStyle(document.documentElement).fontSize;return parseFloat(e)})();selectTab(e){if(this.disabled)return;this._selectedTab=e;this.updateActiveIndicator();this.tabChanged.emit(e)}handleKeyDown(e,t){if(this.disabled)return;const i=this.tabs.findIndex((e=>e.id===t.id));let s=i;switch(e.key){case"ArrowRight":e.preventDefault();s=(i+1)%this.tabs.length;break;case"ArrowLeft":e.preventDefault();s=i===0?this.tabs.length-1:i-1;break;case"Home":e.preventDefault();s=0;break;case"End":e.preventDefault();s=this.tabs.length-1;break;case"Enter":case" ":e.preventDefault();this.selectTab(t);return;default:return}const o=this.tabs[s];if(o){this.selectTab(o);requestAnimationFrame((()=>{const e=this.el.querySelector(`button.tab[data-tab-id="${o.id}"]`);if(e){e.focus()}}))}}render(){return i(a,{key:"9baa2b584d9d12af86e297a27d2053f7f0ffe957",role:"tablist","aria-label":this.ariaLabel,"aria-orientation":"horizontal"},this.tabs.map((e=>i("button",{class:"tab",key:e.id,type:"button","data-tab-id":e.id,role:"tab",tabindex:this._selectedTab?.id===e.id?0:-1,"aria-selected":this._selectedTab?.id===e.id?"true":"false","aria-controls":`tabpanel-${e.id}`,id:`tab-${e.id}`,disabled:this.disabled,"data-state":this._selectedTab?.id===e.id?"selected":undefined,onClick:()=>this.selectTab(e),onKeyDown:t=>this.handleKeyDown(t,e)},e.label))),i("span",{key:"f70d84046260d2a9c3580bafa2a263dc78495343",class:"active-indicator",ref:e=>this.activeIndicator=e}))}};lt.style=rt;export{H as igl_blocked_date_drawer,j as igl_booking_event,X as igl_bulk_block,te as igl_bulk_operations,ne as igl_bulk_stop_sale,ce as igl_cal_body,ge as igl_cal_footer,pe as igl_cal_header,ke as igl_housekeeping_dialog,we as igl_legends,_e as igl_reallocation_dialog,Se as igl_split_booking,Le as igl_tba_category_view,Ae as igl_to_be_assigned,ze as ir_interactive_title,Ue as ir_new_badge,Ve as ir_price_input,Ge as ir_reallocation_drawer,Ze as ir_reallocation_form,it as ir_room_nights,at as ir_success_loader,lt as ir_tabs};
//# sourceMappingURL=p-aeef03e8.entry.js.map