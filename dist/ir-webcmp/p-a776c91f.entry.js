import{r as t,h as e,H as s,g as i}from"./p-61950c14.js";import{T as a}from"./p-59b1956e.js";import{H as l,u as n,h}from"./p-f70a2972.js";import{R as r}from"./p-d1997bc9.js";import{l as c}from"./p-e19fbf2a.js";import"./p-bf44a732.js";import"./p-0db2e55e.js";import"./p-7b1e39e2.js";const o=".sc-ir-hk-tasks-h{display:block}.checkbox-container.sc-ir-hk-tasks{display:flex;align-items:center;justify-content:center}.table-container.sc-ir-hk-tasks{overflow-x:auto;max-width:100%;width:max-content}.table.sc-ir-hk-tasks,th.sc-ir-hk-tasks,td.sc-ir-hk-tasks{border-color:white !important}.select-container.sc-ir-hk-tasks{max-width:500px}@media only screen and (min-width: 900px){td.sc-ir-hk-tasks{min-width:140px !important;width:max-content !important}}@media only screen and (max-width: 900px){td.sc-ir-hk-tasks{min-width:100px !important}.table-container.sc-ir-hk-tasks{width:max-content !important}}";const d=o;const m=class{constructor(e){t(this,e);this.language="";this.ticket="";this.isLoading=false;this.selectedDuration="";this.selectedHouseKeeper="0";this.selectedRoom=null;this.archiveOpened=false;this.roomService=new r;this.houseKeepingService=new l;this.token=new a}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}async handleResetData(t){t.stopImmediatePropagation();t.stopPropagation();const{arrival:e,arrival_time:s,housekeeper:i,unit:a,status:l}=this.selectedRoom;this.houseKeepingService.executeHKAction({property_id:this.propertyid,arrival:e,arrival_time:s,housekeeper:{id:i.id},status:{code:l.code},unit:{id:a.id}});await this.houseKeepingService.getExposedHKSetup(this.property_id)}ticketChanged(t,e){if(t===e){return}this.token.setToken(this.ticket);this.initializeApp()}handleCheckChange(t,e){if(t.detail){this.selectedRoom=e;this.modalOpenTimeOut=setTimeout((()=>{const t=this.el.querySelector("ir-modal");if(t){t.openModal()}}),50)}}handleCloseSidebar(t){t.stopImmediatePropagation();t.stopPropagation();this.archiveOpened=false}disconnectedCallback(){if(this.modalOpenTimeOut){clearTimeout(this.modalOpenTimeOut)}}async getPendingActions(){await this.houseKeepingService.getHKPendingActions({property_id:this.property_id,bracket:{code:this.selectedDuration},housekeeper:{id:+this.selectedHouseKeeper}})}async initializeApp(){try{this.isLoading=true;let t=this.propertyid;if(!t){const e=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true});t=e.My_Result.id}this.property_id=t;n("default_properties",{token:this.ticket,property_id:t,language:this.language});const e=[this.houseKeepingService.getExposedHKStatusCriteria(t),this.roomService.fetchLanguage(this.language,["_HK_FRONT"])];if(this.propertyid){e.unshift(this.roomService.getExposedProperty({id:t,language:this.language,is_backend:true}))}await Promise.all(e);this.selectedDuration=h.hk_tasks.brackets[0].code;await this.getPendingActions()}catch(t){console.error(t)}finally{this.isLoading=false}}async handleConfirm(t){t.preventDefault();t.stopImmediatePropagation();t.stopPropagation();try{await this.getPendingActions()}catch(t){console.error(t)}finally{this.selectedRoom=null}}render(){var t;if(this.isLoading){return e("ir-loading-screen",null)}return e(s,null,e("ir-toast",null),e("ir-interceptor",null),e("section",{class:"p-2"},e("ir-title",{class:"d-none d-md-flex",label:c.entries.Lcz_HousekeepingTasks,justifyContent:"space-between"},e("ir-button",{slot:"title-body",text:c.entries.Lcz_Archive,size:"sm"})),e("div",{class:"d-flex align-items-center mb-2 justify-content-between d-md-none"},e("ir-title",{class:"mb-0",label:c.entries.Lcz_HousekeepingTasks,justifyContent:"space-between"}),e("ir-button",{slot:"title-body",text:c.entries.Lcz_Archive,size:"sm",onClickHandler:()=>this.archiveOpened=true})),e("div",{class:"d-flex flex-column flex-sm-row align-items-center mb-1  select-container"},e("ir-select",{selectedValue:this.selectedDuration,onSelectChange:t=>{this.selectedDuration=t.detail;this.getPendingActions()},data:h.hk_tasks.brackets.map((t=>({text:t.description,value:t.code}))),class:"mb-1 w-100 mb-sm-0",showFirstOption:false,LabelAvailable:false}),e("ir-select",{onSelectChange:t=>{this.selectedHouseKeeper=t.detail;this.getPendingActions()},selectedValue:this.selectedHouseKeeper,data:[{text:"All housekeepers",value:"0"},...h.hk_tasks.housekeepers.map((t=>({text:t.name,value:t.id.toString()})))],showFirstOption:false,LabelAvailable:false,class:"ml-sm-2 w-100"})),e("div",{class:"card p-1"},e("div",{class:"table-container"},e("table",{class:"table"},e("thead",null,e("tr",null,e("th",{class:"text-left"},c.entries.Lcz_Unit),e("th",{class:"text-left"},c.entries.Lcz_Status),e("th",{class:"text-left"},c.entries.Lcz_Arrivaldate),e("th",{class:"text-left"},c.entries.Lcz_ArrivalTime),e("th",{class:"text-left"},c.entries.Lcz_Housekeeper),e("th",{class:"text-center"},c.entries.Lcz_Done))),e("tbody",null,(t=h.pending_housekeepers)===null||t===void 0?void 0:t.map((t=>{var s;return e("tr",{key:t.housekeeper.id},e("td",{class:"text-left"},t.unit.name),e("td",{class:"text-left"},t.status.description),e("td",{class:"text-left"},t.arrival),e("td",{class:"text-left"},t.arrival_time),e("td",{class:"text-left"},t.housekeeper.name),e("td",null,e("div",{class:"checkbox-container"},e("ir-checkbox",{onCheckChange:e=>this.handleCheckChange(e,t),checked:((s=this.selectedRoom)===null||s===void 0?void 0:s.unit.id)===t.unit.id}))))}))))))),this.selectedRoom&&e("ir-modal",{leftBtnText:c.entries.Lcz_No,rightBtnText:c.entries.Lcz_Yes,onConfirmModal:this.handleConfirm.bind(this),onCancelModal:()=>this.selectedRoom=null,modalBody:`Is ${this.selectedRoom.unit.name} cleaned?`}))}get el(){return i(this)}static get watchers(){return{ticket:["ticketChanged"]}}};m.style=d;export{m as ir_hk_tasks};
//# sourceMappingURL=p-a776c91f.entry.js.map