import{r as t,c as i,h as e,H as s,F as o,g as n}from"./p-53d64953.js";import{a as r}from"./p-bf44a732.js";import{a}from"./p-2e94af0d.js";import{I as h}from"./p-657198cf.js";import{T as d}from"./p-a93581f3.js";import{R as l}from"./p-fe80aa7c.js";import{S as c}from"./p-0e0f732a.js";import{l as p}from"./p-71768c2d.js";import{z as f}from"./p-b859bcd5.js";import"./p-a973aec7.js";import"./p-c226aa13.js";const m=".page-loader.sc-ir-interceptor{width:1.25rem;height:1.25rem;border:2.5px solid #3f3f3f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}.loaderContainer.sc-ir-interceptor{padding:20px;display:flex;align-items:center;justify-content:center;border-radius:5px;background:white}.loadingScreenContainer.sc-ir-interceptor{position:fixed;top:0;left:0;height:100vh;width:100vw;z-index:100000;background:rgba(0, 0, 0, 0.2);pointer-events:all;display:flex;align-items:center;justify-content:center}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}";const u=m;const g=class{constructor(e){t(this,e);this.toast=i(this,"toast",7);this.handledEndpoints=["/Get_Exposed_Calendar","/ReAllocate_Exposed_Room","/Get_Exposed_Bookings","/UnBlock_Exposed_Unit"];this.suppressToastEndpoints=[];this.isShown=false;this.isLoading=false;this.isUnassignedUnit=false;this.endpointsCount=0;this.isPageLoadingStopped=null}handleStopPageLoading(t){this.isLoading=false;this.isPageLoadingStopped=t.detail}componentWillLoad(){this.setupAxiosInterceptors()}setupAxiosInterceptors(){r.interceptors.request.use(this.handleRequest.bind(this),this.handleError.bind(this));r.interceptors.response.use(this.handleResponse.bind(this),this.handleError.bind(this))}extractEndpoint(t){return t.split("?")[0]}isHandledEndpoint(t){return this.handledEndpoints.includes(t)}handleRequest(t){const i=this.extractEndpoint(t.url);a[i]="pending";t.params=t.params||{};if(this.isHandledEndpoint(i)&&this.isPageLoadingStopped!==i){if(i!=="/Get_Exposed_Calendar"){this.isLoading=true}else{if(this.endpointsCount>0){this.isLoading=true}}}if(i==="/Get_Exposed_Calendar"){this.endpointsCount=this.endpointsCount+1}return t}async handleResponse(t){var i;const e=this.extractEndpoint(t.config.url);if(this.isHandledEndpoint(e)){this.isLoading=false;this.isPageLoadingStopped=null}a[e]="done";if(e==="/Validate_Exposed_OTP"){return t}if(t.data.ExceptionCode==="OTP"){return this.handleOtpResponse({response:t,extractedUrl:e})}if((i=t.data.ExceptionMsg)===null||i===void 0?void 0:i.trim()){this.handleResponseExceptions({response:t,extractedUrl:e})}return t}handleResponseExceptions({response:t,extractedUrl:i}){this.handleError(t.data.ExceptionMsg,i,t.data.ExceptionCode);throw new h(t.data.ExceptionMsg,t.data.ExceptionCode)}handleOtpResponse({extractedUrl:t,response:i}){this.showModal=true;this.email=i.data.ExceptionMsg;const e=t.slice(1);this.baseOTPUrl=e;if(e==="Check_OTP_Necessity"){let t;try{const e=typeof i.config.data==="string"?JSON.parse(i.config.data):i.config.data;t=e.METHOD_NAME}catch(i){console.error("Failed to parse request body for METHOD_NAME",i);t=e}this.requestUrl=t}else{this.requestUrl=e}this.pendingConfig=i.config;this.response=i;return new Promise(((t,i)=>{this.pendingResolve=t;this.pendingReject=i;setTimeout((()=>{var t;(t=this.otpModal)===null||t===void 0?void 0:t.openModal()}),10)}))}handleError(t,i,e){const s=this.suppressToastEndpoints.includes(i);if(!s||s&&!e){this.toast.emit({type:"error",title:t,description:"",position:"top-right"})}return Promise.reject(t)}async handleOtpFinished(t){if(!this.pendingConfig||!this.pendingResolve||!this.pendingReject){return}const{otp:i,type:e}=t.detail;if(e==="cancel"){const t={config:this.pendingConfig,data:{cancelled:true,baseOTPUrl:this.baseOTPUrl},status:0,statusText:"OTP Cancelled",headers:{},request:{}};this.pendingResolve(t)}else if(e==="success"){if(!i){this.pendingReject(new Error("OTP cancelled by user"))}else if(this.baseOTPUrl==="Check_OTP_Necessity"){this.pendingResolve(this.response)}else{try{const t=Object.assign(Object.assign({},this.pendingConfig),{data:typeof this.pendingConfig.data==="string"?JSON.parse(this.pendingConfig.data):this.pendingConfig.data||{}});const i=await r.request(t);this.pendingResolve(i)}catch(t){this.pendingReject(t)}}}this.pendingConfig=undefined;this.pendingResolve=undefined;this.pendingReject=undefined;this.showModal=false;this.baseOTPUrl=null}render(){return e(s,{key:"af6e09d4301878f300576dbef4fa39d9937a215e"},this.isLoading&&!this.isPageLoadingStopped&&e("div",{key:"e48ee56a273e33f4d691b38e335da7492d742083",class:"loadingScreenContainer"},e("div",{key:"540afe46a391a703f1eabd735c2aafab30adc541",class:"loaderContainer"},e("span",{key:"606ec2ab7d7771495bdfd80d8b00fdddb5d911b1",class:"page-loader"}))),this.showModal&&e("ir-otp-modal",{key:"73781adc5727c9211c98ec0b785602e110dc5cf0",email:this.email,baseOTPUrl:this.baseOTPUrl,requestUrl:this.requestUrl,ref:t=>this.otpModal=t,onOtpFinished:this.handleOtpFinished.bind(this)}))}};g.style=u;const b=".otp-input-wrapper.sc-ir-otp{display:flex;gap:0.5rem;justify-content:space-evenly}.otp-digit.sc-ir-otp{--otp-size:3rem;width:var(--otp-size) !important;height:var(--otp-size) !important;padding:0;font-size:24px;font-weight:500;text-align:center;background-color:#fff;padding:0 !important}.otp-digit.sc-ir-otp:disabled{background-color:#e9ecef;cursor:not-allowed}input[type='number'].sc-ir-otp::-webkit-inner-spin-button,input[type='number'].sc-ir-otp::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type='number'].sc-ir-otp{-moz-appearance:textfield}@media (max-width: 480px){.otp-digit.sc-ir-otp{width:35px;height:45px;font-size:20px}.otp-input-wrapper.sc-ir-otp{gap:6px}}@media (max-width: 360px){.otp-digit.sc-ir-otp{width:30px;height:40px;font-size:18px}.otp-input-wrapper.sc-ir-otp{gap:4px}}";const x=b;const y=class{constructor(e){t(this,e);this.otpChange=i(this,"otpChange",7);this.otpComplete=i(this,"otpComplete",7);this.length=6;this.disabled=false;this.placeholder="";this.type="number";this.autoFocus=true;this.secure=false;this.numbersOnly=false;this.otpValues=[];this.inputRefs=[];this.handleInput=(t,i)=>{const e=t.target;let s=e.value;if(this.numbersOnly){s=s.replace(/[^0-9]/g,"")}if(s.length>1){s=s.slice(-1);e.value=s}this.otpValues[i]=s;this.emitChanges();if(s&&i<this.length-1){this.inputRefs[i+1].focus()}};this.handleKeyDown=(t,i)=>{switch(t.key){case"Backspace":if(!this.otpValues[i]&&i>0){this.inputRefs[i-1].focus();t.preventDefault()}break;case"Delete":this.otpValues[i]="";this.emitChanges();break;case"ArrowLeft":if(i>0){this.inputRefs[i-1].focus();t.preventDefault()}break;case"ArrowRight":if(i<this.length-1){this.inputRefs[i+1].focus();t.preventDefault()}break;case"Home":this.inputRefs[0].focus();t.preventDefault();break;case"End":this.inputRefs[this.length-1].focus();t.preventDefault();break}};this.handlePaste=(t,i)=>{var e;t.preventDefault();const s=((e=t.clipboardData)===null||e===void 0?void 0:e.getData("text"))||"";const o=this.numbersOnly?s.replace(/[^0-9]/g,""):s;for(let t=0;t<Math.min(o.length,this.length-i);t++){this.otpValues[i+t]=o[t]}this.inputRefs.forEach(((t,i)=>{t.value=this.otpValues[i]||""}));const n=this.otpValues.findIndex((t=>!t));if(n!==-1&&n<this.length){this.inputRefs[n].focus()}else{this.inputRefs[this.length-1].focus()}this.emitChanges()};this.handleFocus=t=>{const i=t.target;if(i.value){setTimeout((()=>i.select()),0)}}}componentWillLoad(){this.otpValues=Array(this.length).fill("");if(this.defaultValue){this.setValue(this.defaultValue)}}componentDidLoad(){if(this.autoFocus&&this.inputRefs[0]){setTimeout((()=>{this.inputRefs[0].focus()}),0)}}handleLengthChange(t){if(t<1)return;const i=this.otpValues.length;if(t>i){this.otpValues=[...this.otpValues,...Array(t-i).fill("")]}else if(t<i){this.otpValues=this.otpValues.slice(0,t)}this.emitChanges()}emitChanges(){const t=this.otpValues.join("");this.otpChange.emit(t);if(this.otpValues.every((t=>t!==""))&&this.otpValues.length===this.length){this.otpComplete.emit(t)}}clear(){this.otpValues=Array(this.length).fill("");this.inputRefs.forEach((t=>{t.value=""}));this.emitChanges();if(this.inputRefs[0]){this.inputRefs[0].focus()}}setValue(t){const i=t.split("");for(let t=0;t<this.length;t++){this.otpValues[t]=t<i.length?i[t]:""}this.inputRefs.forEach(((t,i)=>{t.value=this.otpValues[i]||""}));this.emitChanges()}render(){return e(s,{key:"b96396af7e84458a51dc709ffac2e599b62f0de4",class:"otp-input-container"},e("div",{key:"5d9d50444825a80024ee78909b59e0af5c9cc916",class:"otp-input-wrapper"},Array(this.length).fill(null).map(((t,i)=>e("input",{ref:t=>this.inputRefs[i]=t,type:this.type,inputmode:this.numbersOnly?"numeric":"text",class:"otp-digit form-control input-sm",maxlength:"1",placeholder:this.placeholder,disabled:this.disabled,autocomplete:"one-time-code",value:this.otpValues[i],onInput:t=>this.handleInput(t,i),onKeyDown:t=>this.handleKeyDown(t,i),onPaste:t=>this.handlePaste(t,i),onFocus:this.handleFocus,"aria-label":`Digit ${i+1} of ${this.length}`})))))}static get watchers(){return{length:["handleLengthChange"]}}};y.style=x;const w=":host{display:block}:root{--otp-modal-padding:1.5rem}.modal-backdrop{background-color:rgba(0, 0, 0, 0.5) !important}.otp-modal-header{border-bottom:0px !important}.otp-modal{z-index:9999999 !important;border:none;padding:0 !important;box-sizing:border-box;border:1px solid rgba(0, 0, 0, 0.2);border-radius:0.35rem;outline:0}.otp-modal-content{background-color:white;border:none;border-radius:0.35rem;outline:0}.otp-modal-title{margin-bottom:0;line-height:1.45}.otp-modal-body{max-height:100% !important;padding:0 var(--otp-modal-padding)}.otp-modal-header{display:flex;justify-content:space-between;padding:var(--otp-modal-padding);padding-bottom:1rem;border-top-left-radius:0.35rem;border-top-right-radius:0.35rem}.otp-modal-dialog{z-index:9999999 !important}.otp-modal-footer{border-top:0 !important;display:flex;gap:0.5rem;flex-direction:column;padding:var(--otp-modal-padding);padding-top:0.5rem !important}.verification-message{max-width:90%}.modal-loading-container{height:250px;width:80vw}@media (min-width: 768px){.otp-modal-dialog,.otp-modal-content{width:fit-content !important}.otp-modal-footer{flex-direction:row;align-items:center}.modal-loading-container{width:380px !important}.verification-message{max-width:350px !important}}";const k=w;const v=class{constructor(e){t(this,e);this.otpFinished=i(this,"otpFinished",7);this.language="en";this.resendTimer=60;this.showResend=true;this.otpLength=6;this.otp="";this.error="";this.isLoading=false;this.timer=60;this.systemService=new c;this.roomService=new l;this.tokenService=new d;this.otpVerificationSchema=f.object({email:f.string().nonempty(),requestUrl:f.string().nonempty(),otp:f.string().length(this.otpLength)});this.handleOtpComplete=t=>{this.error="";this.otp=t.detail}}componentWillLoad(){if(this.ticket){this.tokenService.setToken(this.ticket)}this.fetchLocale()}handleTicketChange(t,i){if(t!==i){this.tokenService.setToken(t);this.fetchLocale()}}handleKeyDownChange(t){var i;if(t.key==="Escape"&&((i=this.dialogRef)===null||i===void 0?void 0:i.open)){t.preventDefault()}}async openModal(){this.resetState();if(typeof this.dialogRef.showModal==="function"){this.dialogRef.showModal()}else{this.dialogRef.setAttribute("open","")}if(this.showResend)this.startTimer();await this.focusFirstInput()}async closeModal(){if(typeof this.dialogRef.close==="function"){this.dialogRef.close()}else{this.dialogRef.removeAttribute("open")}this.otp=null;this.clearTimer()}async fetchLocale(){if(!this.tokenService.getToken()){return}this.isInitializing=true;await this.roomService.fetchLanguage(this.language,["_USER_MGT"]);this.isInitializing=false}resetState(){this.otp="";this.error="";this.isLoading=false;this.timer=60;this.clearTimer()}startTimer(){this.clearTimer();this.timerInterval=window.setInterval((()=>{if(this.timer>0){this.timer--}else{this.clearTimer()}}),1e3)}clearTimer(){if(this.timerInterval){clearInterval(this.timerInterval);this.timerInterval=null}}async focusFirstInput(){await new Promise((t=>setTimeout(t,50)));const t=this.dialogRef.querySelector("input");t&&t.focus()}async verifyOtp(){if(this.otp.length<this.otpLength)return;this.isLoading=true;this.otpVerificationSchema.parse({otp:this.otp,requestUrl:this.requestUrl,email:this.email});try{await this.systemService.validateOTP({METHOD_NAME:this.requestUrl,OTP:this.otp});this.otpFinished.emit({otp:this.otp,type:"success"});this.closeModal()}catch(t){this.error="Verification failed. Please try again."}finally{this.isLoading=false}}async resendOtp(){if(this.timer>0)return;try{await this.systemService.resendOTP({METHOD_NAME:this.requestUrl});this.timer=60;this.startTimer()}catch(t){console.log(t)}}handleCancelClicked(){if(this.baseOTPUrl==="Check_OTP_Necessity"){this.closeModal();this.otpFinished.emit({otp:null,type:"cancelled"});return}window.location.reload()}disconnectedCallback(){this.clearTimer()}render(){var t;return e(s,{key:"92bceb4183b19ef511867530f18dddb41f6f32fa"},e("dialog",{key:"b4e7f085026c07ccd7ced8c3ec6412fef6412cf8",ref:t=>this.dialogRef=t,class:"otp-modal","aria-modal":"true"},e("form",{key:"2e0c0e52eb7983e94562c15ee77c69581847c623",method:"dialog",class:"otp-modal-content"},this.isInitializing||!p.entries?e("div",{class:"d-flex align-items-center justify-content-center modal-loading-container"},e("ir-spinner",null)):e(o,null,e("header",{class:"otp-modal-header"},e("h5",{class:"otp-modal-title"},p.entries.Lcz_VerifyYourIdentity)),e("section",{class:"otp-modal-body d-flex align-items-center flex-column"},e("p",{class:"verification-message text-truncate"},p.entries.Lcz_WeSentYuoVerificationCode," ",this.email),e("ir-otp",{autoFocus:true,length:this.otpLength,defaultValue:this.otp,onOtpComplete:this.handleOtpComplete}),this.error&&e("p",{class:"text-danger small mt-1 p-0 mb-0"},this.error),this.showResend&&e(o,null,this.timer>0?e("p",{class:"small mt-1"},p.entries.Lcz_ResendCode," 00:",String(this.timer).padStart(2,"0")):e("ir-button",{class:"mt-1",btn_color:"link",onClickHandler:t=>{t.stopImmediatePropagation();t.stopPropagation();this.resendOtp()},size:"sm",text:"Didnâ€™t receive code? Resend"}))),e("footer",{class:"otp-modal-footer justify-content-auto"},e("ir-button",{class:"w-100",btn_styles:"flex-fill",text:p.entries.Lcz_Cancel,btn_color:"secondary",onClick:this.handleCancelClicked.bind(this)}),e("ir-button",{class:"w-100",btn_styles:"flex-fill",text:p.entries.Lcz_VerifyNow,isLoading:this.isLoading,btn_disabled:((t=this.otp)===null||t===void 0?void 0:t.length)<this.otpLength||this.isLoading,onClick:()=>this.verifyOtp()}))))))}static get watchers(){return{ticket:["handleTicketChange"]}}};v.style=k;const C=":host{width:var(--ir-spinner-size, 1.25rem);height:var(--ir-spinner-size, 1.25rem);border:var(--ir-spinner-border-width, 2.5px) solid var(--ir-spinner-color, #3f3f3f);border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}";const _=C;const T=class{constructor(i){t(this,i);this.unit="rem"}componentWillLoad(){this.initStyles()}handleSpinnerSizeChange(){this.initStyles()}handleSpinnerBorderWidthChange(){this.initStyles()}handleSpinnerUnitChange(){this.initStyles()}handleSpinnerColorChange(){this.initStyles()}initStyles(){if(this.size){this.applyCssElement(`${this.size}${this.unit}`,"--ir-spinner-size")}if(this.borderWidth){this.applyCssElement(`${this.borderWidth}${this.unit}`,"--ir-spinner-size")}if(this.color){this.applyCssElement(`${this.color}`,"--ir-spinner-color")}}applyCssElement(t,i){this.el.style.setProperty(i,t)}render(){return e(s,{key:"c8d69ca05f8f5bc25b80b466ee2098618b8316d3"})}get el(){return n(this)}static get watchers(){return{size:["handleSpinnerSizeChange"],borderWidth:["handleSpinnerBorderWidthChange"],unit:["handleSpinnerUnitChange"],color:["handleSpinnerColorChange"]}}};T.style=_;export{g as ir_interceptor,y as ir_otp,v as ir_otp_modal,T as ir_spinner};
//# sourceMappingURL=p-594cb04f.entry.js.map