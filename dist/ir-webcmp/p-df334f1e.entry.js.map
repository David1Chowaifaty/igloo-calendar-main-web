{"version":3,"names":["irComboboxCss","IrComboboxStyle0","IrCombobox","constructor","hostRef","this","data","duration","disabled","autoFocus","input_id","v4","selectedIndex","actualIndex","isComboBoxVisible","isLoading","inputValue","filteredData","componentShouldAutoFocus","componentWillLoad","componentDidLoad","focusInput","watchHandler","newValue","oldValue","handleKeyDown","event","dataSize","length","key","preventDefault","adjustScrollPosition","_a","inputRef","blur","requestAnimationFrame","focus","selectedItem","el","querySelector","scrollIntoView","block","selectItem","index","isItemSelected","comboboxValueChange","emit","id","resetCombobox","debounceFetchData","clearTimeout","debounceTimer","setTimeout","fetchData","handleFocus","clearInput","inputCleared","withblur","filter","d","name","toLowerCase","startsWith","error","console","log","handleInputChange","target","value","handleDocumentClick","contains","handleBlur","blurTimout","isDropdownItem","element","closest","disconnectedCallback","removeEventListener","_b","_c","_d","handleItemKeyDown","renderDropdown","h","occupancy","map","onMouseEnter","role","onKeyDown","e","tabIndex","onClick","image","src","class","Fragment","xmlns","height","width","viewBox","fill","locales","entries","Lcz_NoResultsFound","handleSubmit","stopPropagation","render","onSubmit","bind","type","ref","placeholder","onBlur","onInput","onFocus"],"sources":["src/components/ui/ir-combobox/ir-combobox.css?tag=ir-combobox&encapsulation=scoped","src/components/ui/ir-combobox/ir-combobox.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n  position: relative;\r\n  padding: 0;\r\n  margin: 0;\r\n  box-sizing: border-box;\r\n}\r\nul {\r\n  position: absolute;\r\n  box-sizing: border-box;\r\n  margin: 0;\r\n  margin-top: 2px;\r\n  width: max-content;\r\n  max-height: 80px;\r\n  border-radius: 0.21rem;\r\n  z-index: 10000;\r\n  padding: 1px;\r\n  background: white;\r\n  box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);\r\n  padding: 5px 0;\r\n  max-height: 250px;\r\n  overflow-y: auto;\r\n  min-width: 100%;\r\n}\r\nul[data-position='bottom-right'] {\r\n  right: 0;\r\n}\r\n.list-item-image {\r\n  height: 1rem;\r\n  aspect-ratio: 4/3;\r\n  border-radius: 4px;\r\n  margin-right: 10px;\r\n}\r\n.dropdown-item {\r\n  cursor: pointer;\r\n}\r\nul li,\r\nspan,\r\nloader-container {\r\n  padding: 0px 16px;\r\n  margin: 0px;\r\n  margin-top: 2px;\r\n  width: 100%;\r\n  border-radius: 2px;\r\n}\r\nul li {\r\n  cursor: pointer;\r\n}\r\nul li {\r\n  display: flex;\r\n  align-items: center;\r\n  flex-wrap: wrap;\r\n  gap: 3px;\r\n}\r\nul li p {\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\nul li:hover {\r\n  background: #f4f5fa;\r\n}\r\n\r\nul li[data-selected],\r\nul li[data-selected]:hover {\r\n  color: #fff;\r\n  text-decoration: none;\r\n  background-color: #666ee8;\r\n}\r\n","import { IToast } from '@/components';\r\nimport locales from '@/stores/locales.store';\r\nimport { Component, Prop, State, h, Element, Event, EventEmitter, Listen, Watch, Fragment } from '@stencil/core';\r\nimport { v4 } from 'uuid';\r\n\r\nexport type ComboboxItem = { id: string; name: string; image?: string; occupancy?: number };\r\n@Component({\r\n  tag: 'ir-combobox',\r\n  styleUrl: 'ir-combobox.css',\r\n  scoped: true,\r\n})\r\nexport class IrCombobox {\r\n  @Prop({ mutable: true }) data: ComboboxItem[] = [];\r\n  @Prop() duration: number = 300;\r\n  @Prop() placeholder: string;\r\n  @Prop() value: string;\r\n  @Prop() disabled: boolean = false;\r\n  @Prop() autoFocus: boolean = false;\r\n  @Prop() input_id: string = v4();\r\n\r\n  @State() selectedIndex: number = -1;\r\n  @State() actualIndex: number = -1;\r\n  @State() isComboBoxVisible: boolean = false;\r\n  @State() isLoading: boolean = true;\r\n  @State() isItemSelected: boolean;\r\n  @State() inputValue: string = '';\r\n  @State() filteredData: ComboboxItem[] = [];\r\n\r\n  @Element() el: HTMLElement;\r\n  @Event({ bubbles: true, composed: true }) comboboxValueChange: EventEmitter<{ key: string; data: unknown }>;\r\n  @Event() inputCleared: EventEmitter<null>;\r\n  @Event({ bubbles: true, composed: true }) toast: EventEmitter<IToast>;\r\n  @State() componentShouldAutoFocus: boolean = false;\r\n  private inputRef: HTMLInputElement;\r\n  private debounceTimer: any;\r\n  private blurTimout: NodeJS.Timeout;\r\n  componentWillLoad() {\r\n    this.filteredData = this.data;\r\n  }\r\n  componentDidLoad() {\r\n    if (this.autoFocus) {\r\n      this.focusInput();\r\n    }\r\n  }\r\n\r\n  @Watch('isComboBoxVisible')\r\n  watchHandler(newValue: boolean, oldValue: boolean) {\r\n    if (newValue !== oldValue && newValue === true) {\r\n      this.focusInput();\r\n    }\r\n  }\r\n  handleKeyDown(event: KeyboardEvent) {\r\n    const dataSize = this.filteredData.length;\r\n    if (dataSize > 0) {\r\n      switch (event.key) {\r\n        case 'ArrowUp':\r\n          event.preventDefault();\r\n          this.selectedIndex = (this.selectedIndex - 1 + dataSize) % dataSize;\r\n          this.adjustScrollPosition();\r\n          break;\r\n        case 'ArrowDown':\r\n          event.preventDefault();\r\n          this.selectedIndex = (this.selectedIndex + 1) % dataSize;\r\n          this.adjustScrollPosition();\r\n          break;\r\n        // case 'Enter':\r\n        // case ' ':\r\n        // case 'ArrowRight':\r\n        //   event.preventDefault();\r\n        //   this.selectItem(this.selectedIndex);\r\n        //   break;\r\n        case 'Escape':\r\n          this.inputRef?.blur();\r\n          this.isComboBoxVisible = false;\r\n          break;\r\n      }\r\n    }\r\n  }\r\n\r\n  focusInput() {\r\n    requestAnimationFrame(() => {\r\n      this.inputRef?.focus();\r\n    });\r\n  }\r\n\r\n  adjustScrollPosition() {\r\n    const selectedItem = this.el?.querySelector(`[data-selected]`);\r\n    if (!selectedItem) return;\r\n    selectedItem.scrollIntoView({\r\n      block: 'center',\r\n    });\r\n  }\r\n\r\n  selectItem(index) {\r\n    if (this.filteredData[index]) {\r\n      this.isItemSelected = true;\r\n      this.comboboxValueChange.emit({ key: 'select', data: this.filteredData[index].id });\r\n      this.inputValue = '';\r\n      this.resetCombobox();\r\n      if (this.autoFocus) {\r\n        this.focusInput();\r\n      }\r\n    }\r\n  }\r\n\r\n  debounceFetchData() {\r\n    clearTimeout(this.debounceTimer);\r\n    this.debounceTimer = setTimeout(() => {\r\n      this.fetchData();\r\n    }, this.duration);\r\n  }\r\n  handleFocus() {\r\n    this.isComboBoxVisible = true;\r\n  }\r\n  clearInput() {\r\n    this.inputValue = '';\r\n    this.resetCombobox();\r\n    this.inputCleared.emit(null);\r\n  }\r\n  resetCombobox(withblur: boolean = true) {\r\n    if (withblur) {\r\n      this.inputRef?.blur();\r\n    }\r\n    this.selectedIndex = -1;\r\n    this.isComboBoxVisible = false;\r\n  }\r\n  async fetchData() {\r\n    try {\r\n      this.isLoading = true;\r\n      this.filteredData = this.data.filter(d => d.name.toLowerCase().startsWith(this.inputValue));\r\n      this.selectedIndex = -1;\r\n    } catch (error) {\r\n      console.log('error', error);\r\n    } finally {\r\n      this.isLoading = false;\r\n    }\r\n  }\r\n\r\n  handleInputChange(event: Event) {\r\n    this.inputValue = (event.target as HTMLInputElement).value;\r\n    if (this.inputValue) {\r\n      this.debounceFetchData();\r\n    } else {\r\n      this.filteredData = this.data;\r\n    }\r\n  }\r\n\r\n  @Listen('click', { target: 'document' })\r\n  handleDocumentClick(event: MouseEvent) {\r\n    const target = event.target as HTMLElement;\r\n    if (!this.el.contains(target)) {\r\n      this.isComboBoxVisible = false;\r\n    }\r\n  }\r\n\r\n  handleBlur() {\r\n    this.blurTimout = setTimeout(() => {\r\n      if (!this.isItemSelected) {\r\n        this.inputValue = '';\r\n        this.resetCombobox();\r\n      } else {\r\n        this.isItemSelected = false;\r\n      }\r\n    }, 300);\r\n  }\r\n  isDropdownItem(element) {\r\n    return element && element.closest('.combobox');\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    clearTimeout(this.debounceTimer);\r\n    clearTimeout(this.blurTimout);\r\n    this.inputRef?.removeEventListener('blur', this.handleBlur);\r\n    this.inputRef?.removeEventListener('click', this.selectItem);\r\n    this.inputRef?.removeEventListener('keydown', this.handleKeyDown);\r\n    this.inputRef?.removeEventListener('focus', this.handleFocus);\r\n  }\r\n  handleItemKeyDown(event: KeyboardEvent, index: number) {\r\n    if (event.key === 'Enter' || event.key === ' ' || event.key === 'ArrowRight') {\r\n      this.selectItem(index);\r\n      event.preventDefault();\r\n    } else if (event.key === 'Escape') {\r\n      this.isComboBoxVisible = false;\r\n      this.inputRef?.blur();\r\n      event.preventDefault();\r\n    }\r\n  }\r\n  renderDropdown() {\r\n    if (!this.isComboBoxVisible) {\r\n      return null;\r\n    }\r\n    return (\r\n      <ul data-position={this.filteredData.length > 0 && this.filteredData[0].occupancy ? 'bottom-right' : 'bottom-left'}>\r\n        {this.filteredData?.map((d, index) => (\r\n          <li\r\n            onMouseEnter={() => (this.selectedIndex = index)}\r\n            role=\"button\"\r\n            key={d.id}\r\n            onKeyDown={e => this.handleItemKeyDown(e, index)}\r\n            data-selected={this.selectedIndex === index}\r\n            tabIndex={0}\r\n            onClick={() => this.selectItem(index)}\r\n          >\r\n            {d.image && <img src={d.image} class={'list-item-image'}></img>}\r\n            <p>{d.name}</p>\r\n            {d.occupancy && (\r\n              <Fragment>\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"14\" width=\"12.25\" viewBox=\"0 0 448 512\">\r\n                  <path\r\n                    fill={'currentColor'}\r\n                    d=\"M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z\"\r\n                  />\r\n                </svg>\r\n                <p>{d.occupancy}</p>\r\n              </Fragment>\r\n            )}\r\n          </li>\r\n        ))}\r\n\r\n        {this.filteredData.length === 0 && !this.isLoading && <span class={'text-center'}>{locales.entries.Lcz_NoResultsFound}</span>}\r\n      </ul>\r\n    );\r\n  }\r\n  handleSubmit(e: Event) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    console.log('object');\r\n    if (!this.filteredData.length) {\r\n      return;\r\n    }\r\n    this.selectItem(this.selectedIndex === -1 ? 0 : this.selectedIndex);\r\n  }\r\n  render() {\r\n    return (\r\n      <form onSubmit={this.handleSubmit.bind(this)} class=\"m-0 p-0\">\r\n        <input\r\n          type=\"text\"\r\n          class=\"form-control bg-white\"\r\n          id={this.input_id}\r\n          ref={el => (this.inputRef = el)}\r\n          disabled={this.disabled}\r\n          value={this.value}\r\n          placeholder={this.placeholder}\r\n          onKeyDown={this.handleKeyDown.bind(this)}\r\n          onBlur={this.handleBlur.bind(this)}\r\n          onInput={this.handleInputChange.bind(this)}\r\n          onFocus={this.handleFocus.bind(this)}\r\n          autoFocus={this.autoFocus}\r\n        />\r\n\r\n        {this.renderDropdown()}\r\n      </form>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}