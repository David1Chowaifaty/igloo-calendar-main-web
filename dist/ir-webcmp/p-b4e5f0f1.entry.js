import{r as t,c as i,h as s,H as e,g as a}from"./p-c3b5e9c5.js";import{T as n}from"./p-f809ad08.js";import{H as h,h as r,u as l}from"./p-46111aed.js";import{R as o}from"./p-a6de11cc.js";import{i as c}from"./p-5d0014cb.js";import{l as d}from"./p-c8c28d39.js";import{h as u}from"./p-6c4ba7c0.js";import{v as p}from"./p-4ed69de7.js";import{c as f}from"./p-57fee81d.js";import"./p-d90a6658.js";import"./p-00204f5a.js";const m=".sc-ir-hk-tasks-h{display:block}@media only screen and (max-width: 900px){.table-container.sc-ir-hk-tasks{width:max-content !important}}";const k=m;const g=class{constructor(s){t(this,s);this.clearSelectedHkTasks=i(this,"clearSelectedHkTasks",7);this.hkNameCache={};this.roomService=new o;this.houseKeepingService=new h;this.token=new n;this.language="";this.ticket="";this.propertyid=undefined;this.p=undefined;this.isLoading=false;this.selectedDuration="";this.selectedHouseKeeper="0";this.selectedRoom=null;this.archiveOpened=false;this.property_id=undefined;this.tasks=[];this.selectedTasks=[];this.isSidebarOpen=undefined;this.isApplyFiltersLoading=undefined;this.filters=undefined}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.init()}}ticketChanged(t,i){if(t===i){return}this.token.setToken(this.ticket);this.init()}handleCloseSidebar(t){t.stopImmediatePropagation();t.stopPropagation();this.isSidebarOpen=false}async init(){try{this.isLoading=true;let t=this.propertyid;if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}if(!t){console.log(t);const i=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true,include_units_hk_status:true});t=i.My_Result.id}this.property_id=t;const i=[this.houseKeepingService.getHkTasks({property_id:this.property_id,from_date:u().format("YYYY-MM-DD"),to_date:u().format("YYYY-MM-DD")}),this.houseKeepingService.getExposedHKSetup(this.property_id),this.roomService.fetchLanguage(this.language)];if(this.propertyid){i.push(this.roomService.getExposedProperty({id:this.propertyid,language:this.language,is_backend:true,include_units_hk_status:true}))}const s=await Promise.all(i);const e=s[0];if(e){this.updateTasks(e)}}catch(t){console.log(t)}finally{this.isLoading=false}}buildHousekeeperNameCache(){var t,i;this.hkNameCache={};(i=(t=r.hk_criteria)===null||t===void 0?void 0:t.housekeepers)===null||i===void 0?void 0:i.forEach((t=>{if(t.id!=null&&t.name!=null){this.hkNameCache[t.id]=t.name}}))}updateTasks(t){this.buildHousekeeperNameCache();this.tasks=t.map((t=>Object.assign(Object.assign({},t),{id:p(),housekeeper:(()=>{var i,s,e;const a=this.hkNameCache[t.hkm_id];if(a){return a}const n=(e=(s=(i=r.hk_criteria)===null||i===void 0?void 0:i.housekeepers)===null||s===void 0?void 0:s.find((i=>i.id===t.hkm_id)))===null||e===void 0?void 0:e.name;this.hkNameCache[t.hkm_id]=n;return n})()})))}handleHeaderButtonPress(t){var i;t.stopImmediatePropagation();t.stopPropagation();const{name:s}=t.detail;switch(s){case"cleaned":(i=this.modal)===null||i===void 0?void 0:i.openModal();break;case"export":break;case"archive":this.isSidebarOpen=true;break}}async handleModalConfirmation(t){try{t.stopImmediatePropagation();t.stopPropagation();if(this.selectedTasks.length===0){return}await this.houseKeepingService.executeHKAction({actions:this.selectedTasks.map((t=>({description:"Cleaned",hkm_id:t.hkm_id===0?null:t.hkm_id,unit_id:t.unit.id,booking_nbr:t.booking_nbr})))});await this.fetchTasksWithFilters()}finally{this.selectedTasks=[];this.clearSelectedHkTasks.emit();this.modal.closeModal()}}async applyFilters(t){try{this.isApplyFiltersLoading=true;t.stopImmediatePropagation();t.stopPropagation();this.filters=Object.assign({},t.detail);await this.fetchTasksWithFilters()}catch(t){console.log(t)}finally{this.isApplyFiltersLoading=false}}async fetchTasksWithFilters(){var t;const{cleaning_periods:i,housekeepers:s,cleaning_frequencies:e,dusty_units:a,highlight_check_ins:n}=(t=this.filters)!==null&&t!==void 0?t:{};const h=await this.houseKeepingService.getHkTasks({housekeepers:s,cleaning_frequencies:e===null||e===void 0?void 0:e.code,dusty_units:a===null||a===void 0?void 0:a.code,highlight_window:n===null||n===void 0?void 0:n.code,property_id:this.property_id,from_date:u().format("YYYY-MM-DD"),to_date:(i===null||i===void 0?void 0:i.code)||u().format("YYYY-MM-DD")});if(h){this.updateTasks(h)}}render(){if(this.isLoading){return s("ir-loading-screen",null)}return s(e,{"data-testid":"hk_tasks_base"},s("ir-toast",null),s("ir-interceptor",null),s("section",{class:"p-2 d-flex flex-column",style:{gap:"1rem"}},s("ir-tasks-header",{onHeaderButtonPress:this.handleHeaderButtonPress.bind(this),isCleanedEnabled:this.selectedTasks.length>0}),s("div",{class:"d-flex flex-column flex-md-row mt-1 ",style:{gap:"1rem"}},s("ir-tasks-filters",{isLoading:this.isApplyFiltersLoading,onApplyFilters:t=>{this.applyFilters(t)}}),s("ir-tasks-table",{onRowSelectChange:t=>{t.stopImmediatePropagation();t.stopPropagation();this.selectedTasks=t.detail},class:"flex-grow-1 w-100",tasks:this.tasks}))),s("ir-modal",{autoClose:false,ref:t=>this.modal=t,isLoading:c("/Execute_HK_Action"),onConfirmModal:this.handleModalConfirmation.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:d.entries.Lcz_NO,rightBtnText:d.entries.Lcz_Yes,leftBtnColor:"secondary",rightBtnColor:"primary",modalTitle:d.entries.Lcz_Confirmation,modalBody:"Update selected unit(s) to Clean"}),s("ir-sidebar",{open:this.isSidebarOpen,side:"right",id:"editGuestInfo",onIrSidebarToggle:t=>{t.stopImmediatePropagation();t.stopPropagation();this.isSidebarOpen=false},showCloseButton:false},this.isSidebarOpen&&s("ir-hk-archive",{propertyId:this.property_id,slot:"sidebar-body"})))}get el(){return a(this)}static get watchers(){return{ticket:["ticketChanged"]}}};g.style=k;const _=".sc-ir-housekeeping-h{display:block}";const y=_;const v=class{constructor(s){t(this,s);this.toast=i(this,"toast",7);this.roomService=new o;this.houseKeepingService=new h;this.token=new n;this.language="";this.ticket="";this.propertyid=undefined;this.p=undefined;this.isLoading=false}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}async handleResetData(t){t.stopImmediatePropagation();t.stopPropagation();await this.houseKeepingService.getExposedHKSetup(this.propertyid)}ticketChanged(t,i){if(t===i){return}this.token.setToken(this.ticket);this.initializeApp()}async initializeApp(){try{this.isLoading=true;let t=this.propertyid;if(!t){const i=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true,include_sales_rate_plans:true});t=i.My_Result.id}l("default_properties",{token:this.ticket,property_id:t,language:this.language});const i=[this.houseKeepingService.getExposedHKSetup(t),this.roomService.fetchLanguage(this.language,["_HK_FRONT"])];if(this.propertyid){i.unshift(this.roomService.getExposedProperty({id:t,language:this.language,is_backend:true,include_sales_rate_plans:true}))}await Promise.all(i)}catch(t){console.error(t)}finally{this.isLoading=false}}saveAutomaticCheckInCheckout(t){t.stopImmediatePropagation();t.stopPropagation();try{this.roomService.SetAutomaticCheckInOut({property_id:this.propertyid,flag:t.detail==="auto"});this.toast.emit({position:"top-right",title:"Saved Successfully",description:"",type:"success"})}catch(t){console.log(t)}}render(){if(this.isLoading){return s("ir-loading-screen",null)}return s(e,null,s("ir-interceptor",null),s("ir-toast",null),s("section",{class:"p-1"},s("h3",{class:"mb-2"},"Housekeeping & Check-In Setup"),s("div",{class:"card p-1"},s("ir-title",{borderShown:true,label:"Check-In Mode"}),s("div",{class:"d-flex align-items-center"},s("p",{class:"my-0 py-0 mr-1  "},"Check in & Check out guests automatically:"),s("ir-select",{LabelAvailable:false,showFirstOption:false,selectedValue:f.is_automatic_check_in_out?"auto":"manual",onSelectChange:t=>this.saveAutomaticCheckInCheckout(t),data:[{text:`Yes, as per the property's policy.`,value:"auto"},{text:"No, I will do it manually. ",value:"manual"}]}))),s("ir-hk-team",{class:"mb-1"})))}static get watchers(){return{ticket:["ticketChanged"]}}};v.style=y;export{g as ir_hk_tasks,v as ir_housekeeping};
//# sourceMappingURL=p-b4e5f0f1.entry.js.map