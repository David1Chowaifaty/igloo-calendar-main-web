import{r as t,c as e,h as i,F as o,H as s}from"./p-d239357b.js";import{b as a,B as n,m as r,s as c,e as l,j as h,c as d,f as p,r as u}from"./p-1e87ee18.js";import{e as f,v as g,g as m,h as _}from"./p-3664f526.js";import{V as b}from"./p-d4c223f8.js";import{h as k}from"./p-6c4ba7c0.js";import{l as y}from"./p-4e493fea.js";import{i as w}from"./p-6fec77c0.js";import{R as D,B as I}from"./p-c65723d4.js";import"./p-bf44a732.js";import"./p-e7d273da.js";import"./p-2d4a05d6.js";import"./p-c5894a47.js";import"./p-99cb260a.js";class O{hasUnderscore(t){return/_+/.test(t)}variationService;setBookingInfoFromAutoComplete(t,e){t.bookedByInfoData={id:e.guest.id,email:e.guest.email,firstName:e.guest.first_name,lastName:e.guest.last_name,countryId:e.guest.country_id,isdCode:e.guest?.country_phone_prefix??e.guest?.country_id.toString(),contactNumber:e.guest.mobile,selectedArrivalTime:e.arrival,emailGuest:e.guest.subscribe_to_news_letter,message:e.remark,cardNumber:"",cardHolderName:"",expiryMonth:"",expiryYear:"",bookingNumber:e.booking_nbr,rooms:e.rooms,from_date:e.from_date,to_date:e.to_date}}resetRoomsInfoAndMessage(t){t.defaultData.roomsInfo=[];t.message=""}onDataRoomUpdate(t,e,i,o,s){let a=e;const{data:n,key:r,changedKey:c}=t.detail;const l=`c_${n.roomCategoryId}`;const h=`p_${n.ratePlanId}`;if(this.shouldClearData(r)){a=new Map}this.initializeRoomCategoryIfNeeded(l,a);if(o){if(c==="rate"){if(a.has(l)&&a.get(l).has(h)){this.applyBookingEditToSelectedRoom(l,h,n,a,s,i)}}else{if(c!=="rateType"){if(c==="adult_child_offering"){if(a.has(l)&&e.get(l).has(h)){this.applyBookingEditToSelectedRoom(l,h,n,a,s,i)}}else{this.applyBookingEditToSelectedRoom(l,h,n,a,s,i)}}}}else{this.setSelectedRoomData(l,h,n,a)}this.cleanupEmptyData(l,a);return a}shouldClearData(t){return t==="clearData"||t==="EDIT_BOOKING"}initializeRoomCategoryIfNeeded(t,e){if(!e.has(t)){e.set(t,new Map)}}setSelectedRoomData(t,e,i,o){let s=o.get(t);if(i.totalRooms===0||i.inventory===0){s.delete(e)}else{o.set(t,s.set(e,{...i,selectedUnits:Array(i.totalRooms).fill(-1)}))}}cleanupEmptyData(t,e){if(e.has(t)){let i=e.get(t);if(i.size===0){e.delete(t)}}}applyBookingEditToSelectedRoom(t,e,i,o,s,a){o.clear();let n={};if(a){n={...i,guestName:s||"",roomId:""}}else{n={...i}}o.set(t,(new Map).set(e,n))}calculateAmount({is_amount_modified:t,selected_variation:e,view_mode:i,rp_amount:o}){const s=e.nights.length;if(t){return i==="002"?o:o/s}}generateDailyRates(t,e){let i=t.selected_variation;const o=t.is_amount_modified?this.calculateAmount(t):null;if(t.guest[e].infant_nbr>0&&!t.is_amount_modified){if(!this.variationService){this.variationService=new b}i=this.variationService.getVariationBasedOnInfants({variations:t.ratePlan.variations,baseVariation:t.selected_variation,infants:t.guest[e].infant_nbr})}return i.nights.map((t=>({date:t.night,amount:o??t.discounted_amount,cost:null})))}getBookedRooms({check_in:t,check_out:e,notes:i,identifier:o,override_unit:s,unit:n,auto_check_in:r}){const c=[];for(const l in a.ratePlanSelections){const h=a.ratePlanSelections[l];for(const a in h){const l=h[a];if(l.reserved>0){for(let a=0;a<l.reserved;a++){const{first_name:h,last_name:d}=l.guest[a];c.push({identifier:o,roomtype:l.roomtype,rateplan:l.ratePlan,prepayment_amount_gross:0,unit:s?{id:n}:l.guest[a].unit?{id:l.guest[a].unit}:null,occupancy:{adult_nbr:l.selected_variation.adult_nbr,children_nbr:Number(l.selected_variation.child_nbr??0)-Math.max(Number(l.guest[a].infant_nbr??0),0),infant_nbr:l.guest[a].infant_nbr},bed_preference:l.guest[a].bed_preference,from_date:k(t).format("YYYY-MM-DD"),to_date:k(e).format("YYYY-MM-DD"),notes:i,check_in:r,days:this.generateDailyRates(l,a),guest:{email:null,first_name:h,last_name:d,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null,cci:null}})}}}}return c}async prepareBookUserServiceParams({context:t,check_in:e}){try{if(!t||!t.dateRangeData){throw new Error("Invalid context: Missing date range data.")}const i=new Date(t.dateRangeData.fromDate);const o=new Date(t.dateRangeData.toDate);const s=(e=null,s=false)=>this.getBookedRooms({check_in:i,check_out:o,identifier:e,notes:"",override_unit:t.isEventType("BAR_BOOKING")?true:false,unit:t.isEventType("BAR_BOOKING")?t.bookingData.PR_ID:null,auto_check_in:s});const n=({pickup_info:t,extra_services:e,is_direct:i,is_in_loyalty_mode:o,promo_key:s,extras:a,...n},r)=>({assign_units:true,is_pms:true,is_direct:i,is_backend:true,is_in_loyalty_mode:o,promo_key:s,extras:a,booking:{...n,rooms:r},extra_services:e,pickup_info:t});let r=null;const c=a.bookingDraft.source;console.log({sourceOption:c});console.log({event_type:t.defaultData.event_type,defaultData:t.defaultData});switch(t.defaultData.event_type){case"EDIT_BOOKING":{const{booking:e,currentRoomType:i}=t.defaultData;const o=e.rooms.filter((t=>t.identifier!==i.identifier));console.log("currentRoomType",i);const a=s(i.identifier,i.in_out?.code==="001");r=n(e,[...o,...a]);break}case"ADD_ROOM":case"SPLIT_BOOKING":{const{booking:e}=t.defaultData;if(!e){throw new Error("Missing booking")}const i=s();const o=e.rooms;r=n(e,[...o,...i]);break}default:{const n=s(null,e);const{bookedByInfoData:l}=t;const h=c.type==="TRAVEL_AGENCY";r={assign_units:true,is_pms:true,is_direct:true,is_backend:true,is_in_loyalty_mode:false,promo_key:null,extras:[...f.filter((t=>t.key!=="payment_code")),{key:"payment_code",value:a.selectedPaymentMethod?.code}],agent:h?{id:c.tag}:null,booking:{from_date:k(i).format("YYYY-MM-DD"),to_date:k(o).format("YYYY-MM-DD"),remark:l.message||null,booking_nbr:"",property:{id:t.propertyid},booked_on:{date:k().format("YYYY-MM-DD"),hour:(new Date).getHours(),minute:(new Date).getMinutes()},source:h?"":c,rooms:n,currency:t.currency,arrival:{code:l.selectedArrivalTime},guest:{email:l.email===""?null:l.email||null,first_name:l.firstName,last_name:l.lastName,country_id:l.countryId===""?null:l.countryId,city:null,mobile:l.contactNumber===null?"":this.hasUnderscore(l.contactNumber)?"":l.contactNumber,country_phone_prefix:l?.isdCode??null,address:"",dob:null,subscribe_to_news_letter:l.emailGuest||false,cci:l.cardNumber?{nbr:l.cardNumber,holder_name:l.cardHolderName,expiry_month:l.expiryMonth,expiry_year:l.expiryYear}:null}},pickup_info:null};break}}return r}catch(t){console.error(t)}}getRoomCategoryByRoomId(t){return t.roomsInfo?.find((e=>e.id===t.RATE_TYPE))}setEditingRoomInfo(t,e){const i=this.getRoomCategoryByRoomId(t);const o=!i?"":`c_${i?.id}`;const s=`p_${t.RATE_PLAN_ID}`;const a={adultCount:t.ADULTS_COUNT,rate:t.RATE,rateType:t.RATE_TYPE,ratePlanId:t.RATE_PLAN_ID,roomCategoryId:i?i.id:"",roomCategoryName:i?i.name:"",totalRooms:1,ratePlanName:t.RATE_PLAN,roomId:t.PR_ID,guestName:t.NAME,cancelation:t.cancelation,guarantee:t.guarantee,adult_child_offering:t.adult_child_offering};e.set(o,(new Map).set(s,a))}}const B=".sc-igl-book-property-h{position:fixed;top:0;right:0;width:100vw;min-height:100vh;z-index:99;overflow:hidden}.card-title.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%}.card-header-container.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%;display:flex;align-items:center;box-sizing:border-box;padding:1rem 0;justify-content:space-between}.fd-book-property__title.sc-igl-book-property{margin:0;padding:0;font-family:var(--wa-font-family-heading);font-weight:var(--wa-font-weight-heading);line-height:var(--wa-line-height-condensed);text-wrap:balance;font-size:var(--wa-font-size-l)}.loading-container.sc-igl-book-property{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.card-header-container.sc-igl-book-property h3.sc-igl-book-property{padding:0;margin:0}.background-overlay.sc-igl-book-property{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.25)}.formContainer.sc-igl-book-property{height:calc(100% - 79px);overflow:auto}.gap-30.sc-igl-book-property{gap:30px}.block-date.sc-igl-book-property{width:100%}.sideWindow.sc-igl-book-property{position:absolute;inset:0;left:unset;background-color:#ffffff;width:100%;overflow:auto;animation:slideInFromRight 0.5s}.card.sc-igl-book-property{top:0;z-index:1000}.close.sc-igl-book-property{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.close-icon.sc-igl-book-property{position:absolute;top:18px;right:33px;outline:none}button.sc-igl-book-property:not(:disabled),[type='button'].sc-igl-book-property:not(:disabled){cursor:pointer}.sheet-footer.sc-igl-book-property{width:100%}.card-header-container.sc-igl-book-property{--spacing:var(--wa-space-l);padding:0;display:flex;flex-wrap:nowrap;padding-inline-start:var(--spacing);padding-block-end:0;padding-inline-end:calc(var(--spacing) - var(--wa-form-control-padding-block));padding-block-start:calc(var(--spacing) - var(--wa-form-control-padding-block));border-bottom:1px solid var(--wa-color-surface-border);padding-bottom:calc(var(--spacing) / 2);background-color:var(--wa-color-surface-default)}@media only screen and (min-width: 1200px){.sideWindow.sc-igl-book-property{max-width:70%}}@media only screen and (min-width: 2000px){.sideWindow.sc-igl-book-property{max-width:40%}}@media only screen and (min-width: 768px) and (max-width: 1200px){.sideWindow.sc-igl-book-property{max-width:90%}}@media only screen and (min-width: 600px) and (max-width: 768px){.sideWindow.sc-igl-book-property{max-width:75%}}@media only screen and (min-width: 641px){.block-date.sc-igl-book-property{max-width:450px;padding-bottom:0 !important}}@keyframes slideInFromRight{from{transform:translateX(120%)}to{transform:translateX(0)}}@keyframes slideOutToRight{from{transform:translateX(0)}to{transform:translateX(120%)}}.sideWindow--exit.sc-igl-book-property{animation:slideOutToRight 0.5s forwards}";const v=B;const x=".sc-igl-book-property-h{height:100%}.sheet-container.sc-igl-book-property{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-book-property{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-book-property{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-book-property{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-book-property{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-book-property{flex-direction:row;align-items:center}}";const Y=x;const R=class{constructor(i){t(this,i);this.closeBookingWindow=e(this,"closeBookingWindow",7);this.blockedCreated=e(this,"blockedCreated",7);this.resetBookingEvt=e(this,"resetBookingEvt",7);this.animateIrButton=e(this,"animateIrButton",7);this.animateIrSelect=e(this,"animateIrSelect",7);this.toast=e(this,"toast",7)}propertyid;allowedBookingSources;language;countries;showPaymentDetails=false;currency;bookingData;adultChildConstraints;renderAgain=false;dateRangeData;defaultData;isLoading;bookingHistory=[];closeBookingWindow;blockedCreated;resetBookingEvt;animateIrButton;animateIrSelect;toast;initialRoomIds=null;page;showSplitBookingOption=false;guestData=[];bookedByInfoData={};blockDatesData={};ratePricingMode=[];selectedUnits=new Map;bedPreferenceType=[];bookingService=new n;bookPropertyService=new O;defaultDateRange;updatedBooking=false;MAX_HISTORY_LENGTH=2;didReservation;wasBlockedUnit;async componentWillLoad(){if(a.roomTypes){r("roomTypes",[]);r("ratePlanSelections",{})}this.handleKeyDown=this.handleKeyDown.bind(this);this.initializeDefaultDateRange();if(!this.bookingData.defaultDateRange){return}this.initializeDefaultData();this.wasBlockedUnit=this.defaultData.hasOwnProperty("block_exposed_unit_props");r("event_type",{type:this.defaultData.event_type});this.fetchSetupEntriesAndInitialize()}componentDidLoad(){document.addEventListener("keydown",this.handleKeyDown);g(true)}disconnectedCallback(){document.removeEventListener("keydown",this.handleKeyDown)}clearBooking(t){if(this.isEventType("SPLIT_BOOKING")){t.stopImmediatePropagation();t.stopPropagation();this.bookedByInfoData={};this.bookPropertyService.resetRoomsInfoAndMessage(this);this.renderPage()}}async handleSpiltBookingSelected(t){t.stopImmediatePropagation();t.stopPropagation();const{key:e,data:i}=t.detail;if(e==="select"||e==="blur"&&i!==""){const t=await this.bookingService.getExposedBooking(i.booking_nbr||i,this.language);this.defaultData={...this.defaultData,booking:t};this.bookPropertyService.setBookingInfoFromAutoComplete(this,t);const e=a.selects.sources.find((e=>e.code===t.source.code));c({source:e});this.renderPage()}}onDateRangeSelect(t){t.stopImmediatePropagation();t.stopPropagation();l(false);const e=t.detail;this.updateBookingHistory({dates:{checkIn:new Date(this.dateRangeData.fromDate),checkOut:new Date(new Date(e.data.toDate))}});if(e.key==="selectedDateRange"){this.dateRangeData=e.data;if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){this.defaultData.roomsInfo=[]}}}gotoSplitPageTwo(){this.gotoPage("page_two")}handleButtonClicked(t){switch(t.detail.key){case"save":this.bookUser(false);break;case"cancel":t.stopImmediatePropagation();t.stopPropagation();this.closeWindow();break;case"back":t.stopImmediatePropagation();t.stopPropagation();if(this.isEventType("BAR_BOOKING")){d()}this.gotoPage("page_one");break;case"book":this.bookUser(false);break;case"bookAndCheckIn":this.bookUser(true);break;case"next":t.stopImmediatePropagation();t.stopPropagation();if(!a.bookingDraft.occupancy?.adults){this.animateIrSelect.emit("adult_child_select");break}if(h()>0){this.gotoPage("page_two");break}else if(this.defaultData?.roomsInfo.length===0){this.animateIrButton.emit("check_availability");break}this.toast.emit({type:"error",description:y.entries.Lcz_SelectRatePlan,title:y.entries.Lcz_SelectRatePlan});break;case"check":this.checkBookingAvailability();break}}updateBookingHistory(t){const e=this.bookingHistory[this.bookingHistory.length-1];const i={dates:{checkIn:t.dates?.checkIn||e?.dates?.checkIn||new Date(this.dateRangeData.fromDate),checkOut:t.dates?.checkOut||e?.dates?.checkOut||new Date(this.dateRangeData.toDate)},adults:t.adults??e?.adults??a.bookingDraft.occupancy?.adults,children:t.children??e?.children??a.bookingDraft.occupancy.children};this.bookingHistory.push(i);if(this.bookingHistory.length>this.MAX_HISTORY_LENGTH){this.bookingHistory.shift()}}handleKeyDown(t){if(t.key==="Escape"){this.closeWindow()}}initializeDefaultDateRange(){this.defaultDateRange={from_date:this.bookingData.FROM_DATE,to_date:this.bookingData.TO_DATE}}initializeDefaultData(){this.defaultData=this.bookingData;this.dateRangeData={...this.defaultData.defaultDateRange};c({dates:{checkIn:k(this.defaultData.defaultDateRange.fromDate),checkOut:k(this.defaultData.defaultDateRange.toDate)}})}async fetchSetupEntriesAndInitialize(){try{const t=await this.fetchSetupEntries();this.setSourceOptions(this.allowedBookingSources);this.setOtherProperties(t);this.initializeEventData()}catch(t){console.error("Error fetching setup entries:",t)}}initializeEventData(){if(this.isEventType("EDIT_BOOKING")){this.initializeEditBookingData()}if(!this.isEventType("BAR_BOOKING")){this.bookPropertyService.resetRoomsInfoAndMessage(this)}this.initializePage()}initializeEditBookingData(){c({occupancy:{adults:Number(this.defaultData.ADULTS_COUNT),children:Number(this.defaultData.CHILDREN_COUNT)}});this.initialRoomIds={roomName:this.defaultData.roomName,ratePlanId:this.defaultData.RATE_PLAN_ID,roomId:this.defaultData.PR_ID,roomTypeId:this.defaultData.RATE_TYPE};const{currentRoomType:t,GUEST:e}=this.defaultData;r("guest",{bed_preference:t.bed_preference?.toString(),infant_nbr:t.occupancy.infant_nbr,first_name:e.first_name??"",last_name:e.last_name??"",unit:t.unit?.id?.toString()});this.checkBookingAvailability();this.bookPropertyService.setEditingRoomInfo(this.defaultData,this.selectedUnits)}initializePage(){switch(this.defaultData.event_type){case"SPLIT_BOOKING":this.showSplitBookingOption=true;this.page="page_one";break;case"BLOCK_DATES":this.page="page_block_date";break;default:this.page="page_one";break}}async fetchSetupEntries(){return await this.bookingService.fetchSetupEntries()}isGuestDataIncomplete(){for(const t in a.ratePlanSelections){const e=a.ratePlanSelections[t];for(const t in e){const i=e[t];if(i.reserved>0){for(const t of i.guest){D.parse({...t,requires_bed_preference:i.roomtype.is_bed_configuration_enabled})}}}}return false}setSourceOptions(t){const e=this.isEventType("BAR_BOOKING")?this.getFilteredSourceOptions(t):t;p({sources:e});let i;if(this.isEventType("EDIT_BOOKING")){const e=t.find((t=>this.defaultData.SOURCE?.code===t.code));i=e}else{i=e.find((t=>t.type!=="LABEL"))}c({source:i})}getFilteredSourceOptions(t){const e=new Set;const i=this.bookingData?.roomsInfo?.some((t=>{const i=t?.rateplans??[];if(i.length===0)return false;const o=i.every((t=>(t?.agents?.length??0)>0));if(o){i.forEach((t=>{(t?.agents??[]).forEach((t=>e.add(t?.id?.toString())))}))}return o}))??false;if(!i){return t}return t.filter((t=>{if(t?.type==="LABEL")return true;const i=t?.tag;const o=i!=null&&e.has(i);return o}))}setOtherProperties(t){this.ratePricingMode=t?.ratePricingMode;this.bookedByInfoData.arrivalTime=t.arrivalTime;this.bedPreferenceType=t.bedPreferenceType}async checkBookingAvailability(){l(false);const{source:t,occupancy:e}=a.bookingDraft;const i=k(this.dateRangeData.fromDate).format("YYYY-MM-DD");const o=k(this.dateRangeData.toDate).format("YYYY-MM-DD");const s=t?.type==="TRAVEL_AGENCY";try{const a=this.isEventType("EDIT_BOOKING")?[this.defaultData.RATE_TYPE]:[];const n=this.isEventType("BAR_BOOKING")?this.defaultData.roomsInfo.map((t=>t.id)):[];const r=await this.bookingService.getBookingAvailability({from_date:i,to_date:o,propertyid:this.propertyid,adultChildCount:{adult:e.adults,child:e.children},language:this.language,room_type_ids:n,currency:this.currency,agent_id:s?t?.tag:null,is_in_agent_mode:s,room_type_ids_to_update:a});if(!this.isEventType("EDIT_BOOKING")){this.defaultData.defaultDateRange.fromDate=new Date(this.dateRangeData.fromDate);this.defaultData.defaultDateRange.toDate=new Date(this.dateRangeData.toDate)}this.defaultData={...this.defaultData,roomsInfo:r};if(this.isEventType("EDIT_BOOKING")&&!this.updatedBooking){this.updateBooking()}}catch(t){console.error("Error initializing booking availability:",t)}}updateBooking(){try{const{currentRoomType:t,GUEST:e}=this.defaultData;const i=t.roomtype.id;const o=t.rateplan.id;const s={bed_preference:t.bed_preference?.toString(),infant_nbr:t.occupancy.infant_nbr,last_name:e.last_name,first_name:e.first_name,unit:t.unit?.id?.toString(),roomtype_id:t.roomtype.id};r("guest",s);u({roomTypeId:i,ratePlanId:o,rooms:1,guest:[s]})}catch(t){console.error(t)}}async checkAndBlockDate(){try{const{block_exposed_unit_props:t}=this.defaultData;await this.bookingService.getBookingAvailability({from_date:t.from_date,to_date:t.to_date,propertyid:this.propertyid,adultChildCount:{adult:2,child:0},language:this.language,room_type_ids:this.defaultData.roomsInfo.map((t=>t.id)),currency:this.currency});const e=a.roomTypes.every((t=>{if(t.is_available_to_book){return true}return t.inventory>0&&t["not_available_reason"]==="ALL-RATES-PLAN-NOT-BOOKABLE"}));if(e){await this.handleBlockDate(false)}else{console.warn("Blocked date is unavailable. Continuing...")}}catch(t){console.error("Error checking and blocking date:",t)}}async closeWindow(){l(true);g(false);if(this.wasBlockedUnit&&!this.didReservation){await this.checkAndBlockDate()}const t=document.querySelector(".sideWindow");if(!t)return;t.classList.add("sideWindow--exit");setTimeout((()=>{this.closeBookingWindow.emit();document.removeEventListener("keydown",this.handleKeyDown)}),300)}isEventType(t){return this.defaultData.event_type===t}handleBlockDateUpdate(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.blockDatesData=e.data}handleGuestInfoUpdate(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;if(e.guestRefKey){if(this.isEventType("BAR_BOOKING")||this.wasBlockedUnit||this.isEventType("SPLIT_BOOKING")){this.guestData[e.guestRefKey]={...e.data,roomId:this.defaultData.PR_ID}}else this.guestData[e.guestRefKey]=e.data}}handleBookedByInfoUpdate(t){t.stopImmediatePropagation();t.stopPropagation();const e=t.detail;this.bookedByInfoData=e.value.data}renderPage(){this.renderAgain=!this.renderAgain}gotoPage(t){this.page=t;this.renderPage()}getPageBlockDatesView(){return i(o,null,i("igl-block-dates-view",{fromDate:this.defaultData.FROM_DATE,toDate:this.defaultData.TO_DATE,entryDate:this.defaultData.ENTRY_DATE,onDataUpdateEvent:t=>this.handleBlockDateUpdate(t)}))}handlePageTwoDataUpdateEvent(t){t.stopImmediatePropagation();t.stopPropagation();if(t.detail.key==="propertyBookedBy"){this.handleBookedByInfoUpdate(t)}else{this.handleGuestInfoUpdate(t)}}async handleBlockDate(t=true){const e=this.wasBlockedUnit?this.defaultData.block_exposed_unit_props:(()=>{const t=m(+this.blockDatesData.RELEASE_AFTER_HOURS);return{from_date:_(this.defaultData.defaultDateRange.fromDate),to_date:_(this.defaultData.defaultDateRange.toDate),NOTES:this.blockDatesData.OPTIONAL_REASON||"",pr_id:this.defaultData.PR_ID.toString(),STAY_STATUS_CODE:this.blockDatesData.OUT_OF_SERVICE?"004":this.blockDatesData.RELEASE_AFTER_HOURS===0?"002":"003",DESCRIPTION:this.blockDatesData.RELEASE_AFTER_HOURS||"",...t}})();await this.bookingService.blockUnit(e);if(t)this.closeWindow()}async bookUser(t){try{this.setLoadingState(t);if(!this.isEventType("EDIT_BOOKING")&&!this.isEventType("ADD_ROOM")){I.parse({first_name:this.bookedByInfoData?.firstName,last_name:this.bookedByInfoData?.lastName})}this.isGuestDataIncomplete();const e=this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM");if(e){this.bookedByInfoData.message=this.defaultData.NOTES}this.didReservation=true;const i=await this.bookPropertyService.prepareBookUserServiceParams({context:this,check_in:t});await this.bookingService.doReservation(i);await this.adjustBlockedDatesAfterReservation(i);this.resetBookingEvt.emit(null);this.resetLoadingState()}catch(t){console.error("Error booking user:",t);this.isLoading=null}}async adjustBlockedDatesAfterReservation(t){if(!this.wasBlockedUnit){return}const e=k(this.defaultData.block_exposed_unit_props.from_date,"YYYY-MM-DD");const i=k(t.booking.from_date,"YYYY-MM-DD");const o=k(this.defaultData.block_exposed_unit_props.to_date,"YYYY-MM-DD");const s=k(t.booking.to_date,"YYYY-MM-DD");if(s.isBefore(o,"days")){const t={...this.defaultData.block_exposed_unit_props,from_date:s.format("YYYY-MM-DD")};await this.bookingService.blockUnit(t)}if(i.isAfter(e,"days")){const t={...this.defaultData.block_exposed_unit_props,to_date:i.format("YYYY-MM-DD")};await this.bookingService.blockUnit(t)}return}setLoadingState(t){if(this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")){this.isLoading="save"}else{this.isLoading=t?"bookAndCheckIn":"book"}}resetLoadingState(){this.isLoading="";setTimeout((()=>{this.closeWindow()}),100)}getCurrentPage(t){return this.page===t}render(){return i(s,{key:"b8926da2b05ddfeab7641fa9d1ff46468bda4e9c","data-testid":"book_property_sheet h-100"},i("div",{key:"91a8444b29bec79b20b18c989a03879abdffcc9b",class:"background-overlay",onClick:()=>this.closeWindow()}),i("div",{key:"1779bde40bf9a263dc2f4a0585c108578999412b",class:"sideWindow sheet-container "+(this.getCurrentPage("page_block_date")?"block-date":"")},w("/Get_Setup_Entries_By_TBL_NAME_MULTI")?i("div",{class:"loading-container"},i("ir-spinner",null)):i(o,null,i("div",{class:"sheet-header"},i("div",{class:"card-header-container"},i("h2",{class:"fd-book-property__title"},this.getCurrentPage("page_block_date")?this.defaultData.BLOCK_DATES_TITLE:this.defaultData.TITLE),i("ir-custom-button",{appearance:"plain",variant:"neutral",size:"medium",onClickHandler:()=>this.closeWindow()},i("wa-icon",{name:"xmark",library:"system",variant:"solid",label:"Close","aria-label":"Close"})))),i("div",{class:"px-2 sheet-body"},this.getCurrentPage("page_one")&&i("igl-booking-overview-page",{wasBlockedUnit:this.wasBlockedUnit,initialRoomIds:this.initialRoomIds,defaultDaterange:this.defaultDateRange,eventType:this.defaultData.event_type,selectedRooms:this.selectedUnits,currency:this.currency,showSplitBookingOption:this.showSplitBookingOption,ratePricingMode:this.ratePricingMode,dateRangeData:this.dateRangeData,bookingData:this.defaultData,bookedByInfoData:this.bookedByInfoData,adultChildConstraints:this.adultChildConstraints,propertyId:this.propertyid}),this.getCurrentPage("page_two")&&i("igl-booking-form",{currency:this.currency,propertyId:this.propertyid,showPaymentDetails:this.showPaymentDetails,selectedGuestData:this.guestData,countries:this.countries,isLoading:this.isLoading,selectedRooms:this.selectedUnits,bedPreferenceType:this.bedPreferenceType,dateRangeData:this.dateRangeData,bookingData:this.defaultData,showSplitBookingOption:this.showSplitBookingOption,language:this.language,bookedByInfoData:this.bookedByInfoData,defaultGuestData:this.defaultData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),onDataUpdateEvent:t=>this.handlePageTwoDataUpdateEvent(t)}),this.getCurrentPage("page_block_date")?this.getPageBlockDatesView():null),this.getCurrentPage("page_block_date")?i("div",{class:"sheet-footer"},i("ir-button",{text:y.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClick:()=>this.closeWindow()}),i("ir-button",{text:y.entries.Lcz_Blockdates,isLoading:w("/Block_Exposed_Unit"),class:"flex-fill",onClick:()=>this.handleBlockDate()})):i("igl-book-property-footer",{page:this.page,dateRangeData:this.dateRangeData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),isLoading:this.isLoading,class:"sheet-footer",eventType:this.bookingData.event_type}))))}};R.style=v+Y;export{R as igl_book_property};
//# sourceMappingURL=p-8a4c52b6.entry.js.map