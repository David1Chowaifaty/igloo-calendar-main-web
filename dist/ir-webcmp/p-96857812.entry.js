import{r as t,c as i,h as e,F as s,g as a,H as n}from"./p-ee49d535.js";import{h as l}from"./p-6c4ba7c0.js";import{b as o,_ as r,a as c,c as h}from"./p-24a9dafe.js";import{a as d}from"./p-06203439.js";import{B as u}from"./p-bb37d715.js";import{R as m}from"./p-f6f26236.js";import{l as f}from"./p-806fad31.js";import{c as b}from"./p-6bab2172.js";import{c as p}from"./p-ac6e77ff.js";import{g,f as v}from"./p-d49ed902.js";import{P as y}from"./p-e9f5563a.js";import{a as k}from"./p-bd53d1f9.js";import{u as x}from"./p-551d64ea.js";import"./p-dfa14c12.js";import"./p-4eb12235.js";const _=".sc-ir-booking-details-h{overflow-x:hidden;--ir-dialog-max-width:20rem}.confirmed.sc-ir-booking-details{color:#fff;display:flex;align-items:center}.bg-ir-green.sc-ir-booking-details{background:#629a4c;padding:0.2rem 0.3rem}.h-28.sc-ir-booking-details{height:2rem}.mx-01.sc-ir-booking-details{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}.bg-ir-red.sc-ir-booking-details{background:#ff4961;padding:0.2rem 0.3rem}.bg-ir-orange.sc-ir-booking-details{background:#ff9149;padding:0.2rem 0.3rem}.date-margin.sc-ir-booking-details{margin-right:5px}.pickup-margin.sc-ir-booking-details{margin-bottom:7px !important}.header-date.sc-ir-booking-details{padding-left:5px !important}.pointer.sc-ir-booking-details{cursor:pointer}.sc-ir-booking-details:root{--sidebar-width:50rem}.sm-padding-right.sc-ir-booking-details{padding-right:0.2rem}.sm-padding-left.sc-ir-booking-details{padding-left:0.2rem}.sm-padding-top.sc-ir-booking-details{padding-top:0.2rem}.sm-padding-bottom.sc-ir-booking-details{padding-bottom:0.2rem}.info-notes.sc-ir-booking-details{list-style:none;padding-left:0}.light-blue-bg.sc-ir-booking-details{background-color:#acecff;padding:0.2rem 0.3rem}.iframeHeight.sc-ir-booking-details{height:17.5rem}.btn-outline.sc-ir-booking-details{background:transparent;border:1px solid #104064;color:#104064}.btn-outline.sc-ir-booking-details:hover,.btn-outline.sc-ir-booking-details:active{background:#104064;color:white}.dialog-title.sc-ir-booking-details{width:fit-content}.list-title.sc-ir-booking-details{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-booking-details{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-booking-details{color:#629a4c;font-weight:600}.list-item.red.sc-ir-booking-details{color:#ff4961;font-weight:600}";const w=_;const C=class{constructor(e){t(this,e);this.toast=i(this,"toast",7);this.bookingChanged=i(this,"bookingChanged",7);this.closeSidebar=i(this,"closeSidebar",7);this.bookingService=new u;this.roomService=new m;this.paymentService=new y;this.language="";this.ticket="";this.bookingNumber="";this.baseurl="";this.propertyid=undefined;this.is_from_front_desk=false;this.hasPrint=false;this.hasReceipt=false;this.hasDelete=false;this.hasMenu=false;this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.hasCloseButton=false;this.bookingItem=null;this.statusData=[];this.tempStatus=null;this.showPaymentDetails=undefined;this.bookingData=undefined;this.countryNodeList=undefined;this.calendarData={};this.guestData=null;this.defaultTexts=undefined;this.rerenderFlag=false;this.sidebarState=null;this.isUpdateClicked=false;this.pms_status=undefined;this.isPMSLogLoading=false;this.userCountry=null;this.paymentActions=undefined}componentDidLoad(){if(this.baseurl){d.defaults.baseURL=this.baseurl}if(this.ticket!==""){b.token=this.ticket;this.bookingService.setToken(this.ticket);this.roomService.setToken(this.ticket);this.initializeApp()}}async ticketChanged(){b.token=this.ticket;this.paymentService.setToken(this.ticket);this.bookingService.setToken(this.ticket);this.roomService.setToken(this.ticket);this.initializeApp()}setRoomsData(t){var i,e;let s=new Array;if((e=(i=t.My_Result)===null||i===void 0?void 0:i.roomtypes)===null||e===void 0?void 0:e.length){s=t.My_Result.roomtypes;t.My_Result.roomtypes.forEach((t=>{t.expanded=true}))}this.calendarData.roomsInfo=s}async initializeApp(){var t;try{const[i,e,s,a]=await Promise.all([this.roomService.fetchData(this.propertyid,this.language),this.roomService.fetchLanguage(this.language),this.bookingService.getCountries(this.language),this.bookingService.getExposedBooking(this.bookingNumber,this.language)]);if(!f.entries){f.entries=e.entries;f.direction=e.direction}this.defaultTexts=e;this.countryNodeList=s;if((t=a.guest)===null||t===void 0?void 0:t.country_id){this.userCountry=this.countryNodeList.find((t=>t.id===a.guest.country_id))||null}const{allowed_payment_methods:n,currency:l,allowed_booking_sources:o,adult_child_constraints:r,calendar_legends:c}=i["My_Result"];this.calendarData={currency:l,allowed_booking_sources:o,adult_child_constraints:r,legendData:c};this.setRoomsData(i);const h=["001","004"];this.showPaymentDetails=n.some((t=>h.includes(t.code)));this.guestData=a.guest;this.bookingData=a;this.rerenderFlag=!this.rerenderFlag}catch(t){console.error("Error initializing app:",t)}}handleIconClick(t){const i=t.target;switch(i.id){case"pickup":this.sidebarState="pickup";return;case"close":this.closeSidebar.emit(null);return;case"print":window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.bookingData.system_id}&&PM=B&TK=${this.ticket}`);return;case"receipt":window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.bookingData.system_id}&&PM=I&TK=${this.ticket}`);return;case"book-delete":return;case"menu":window.location.href="https://x.igloorooms.com/manage/acbookinglist.aspx";return;case"room-add":this.bookingItem={ID:"",NAME:this.bookingData.guest.last_name,EMAIL:this.bookingData.guest.email,PHONE:this.bookingData.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.bookingData.from_date,ARRIVAL:this.bookingData.arrival,TO_DATE:this.bookingData.to_date,TITLE:`${f.entries.Lcz_AddingUnitToBooking}# ${this.bookingData.booking_nbr}`,defaultDateRange:{fromDate:new Date(this.bookingData.from_date),fromDateStr:"",toDate:new Date(this.bookingData.to_date),toDateStr:"",dateDifference:0,message:""},event_type:"ADD_ROOM",BOOKING_NUMBER:this.bookingData.booking_nbr,ADD_ROOM_TO_BOOKING:this.bookingData.booking_nbr,GUEST:this.bookingData.guest,message:this.bookingData.remark,SOURCE:this.bookingData.source,ROOMS:this.bookingData.rooms};return;case"add-payment":return}}handleEditSidebar(){this.sidebarState="guest"}async handleResetExposedCancelationDueAmount(t){t.stopImmediatePropagation();t.stopPropagation()}handleSelectChange(t){t.stopPropagation();t.stopImmediatePropagation();const i=t.target;this.tempStatus=i.selectedValue}openEditSidebar(){const t=document.querySelector("ir-sidebar#editGuestInfo");t.open=true}async updateStatus(){if(this.tempStatus!==""&&this.tempStatus!==null){try{this.isUpdateClicked=true;await d.post(`/Change_Exposed_Booking_Status?Ticket=${this.ticket}`,{book_nbr:this.bookingNumber,status:this.tempStatus});this.toast.emit({type:"success",description:"",title:f.entries.Lcz_StatusUpdatedSuccessfully,position:"top-right"});await this.resetBookingData()}catch(t){console.log(t)}finally{this.isUpdateClicked=false}}else{this.toast.emit({type:"error",description:"",title:f.entries.Lcz_SelectStatus,position:"top-right"})}}async openPMSLogsDialog(){var t;try{(t=this.dialogRef)===null||t===void 0?void 0:t.openModal();if(!this.pms_status){this.isPMSLogLoading=true;this.pms_status=await this.bookingService.fetchPMSLogs(this.bookingData.booking_nbr)}}catch(t){console.log(t)}finally{if(this.isPMSLogLoading){this.isPMSLogLoading=false}}}handleEditInitiated(t){this.bookingItem=t.detail}handleCloseBookingWindow(){this.bookingItem=null}handleDeleteFinish(t){this.bookingData=Object.assign(Object.assign({},this.bookingData),{rooms:this.bookingData.rooms.filter((i=>i.identifier!==t.detail))})}async resetBookingData(){try{const t=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);this.bookingData=Object.assign({},t);this.bookingChanged.emit(this.bookingData)}catch(t){console.log(t)}}async handleResetBookingData(t){t.stopPropagation();t.stopImmediatePropagation();if(t.detail){return this.bookingData=t.detail}await this.resetBookingData()}renderPhoneNumber(){const{mobile:t,country_phone_prefix:i,country_id:e}=this.bookingData.guest;if(!t){return null}if(this.bookingData.is_direct){if(i){return i+" "+t}if(e){const i=this.countryNodeList.find((t=>t.id===e));if(!i){throw new Error("Invalid country id")}return i.phone_prefix+" "+t}}return t}render(){var t,i,a,n,c,h,d,u,m,v,y,k;if(!this.bookingData){return null}let x="";switch(this.bookingData.status.code){case"001":x="bg-ir-orange";break;case"002":x="bg-ir-green";break;case"003":x="bg-ir-red";break;case"004":x="bg-ir-red";break}return[e(s,null,!this.is_from_front_desk&&e(s,null,e("ir-toast",null),e("ir-interceptor",null))),e("div",{class:"fluid-container p-1"},e("div",{class:"d-flex flex-column p-0 mx-0 flex-lg-row align-items-md-center justify-content-between mt-1"},e("div",{class:"m-0 p-0 mb-1 mb-lg-0 mt-md-0  d-flex justify-content-start align-items-center"},e("p",{class:"font-size-large m-0 p-0"},`${this.defaultTexts.entries.Lcz_Booking}#${this.bookingNumber}`),e("p",{class:"m-0 p-0 ml-1"},!this.bookingData.is_direct&&e("span",{class:"mr-1 m-0"},this.bookingData.channel_booking_nbr," "),e("span",{class:"date-margin"},o(this.bookingData.booked_on.date)),r(this.bookingData.booked_on.hour.toString(),this.bookingData.booked_on.minute.toString()))),e("div",{class:"d-flex justify-content-end align-items-center"},e("span",{class:`confirmed btn-sm m-0 mr-2 ${x}`},this.bookingData.status.description),this.bookingData.allowed_actions.length>0&&this.bookingData.is_editable&&e(s,null,e("ir-select",{selectContainerStyle:"h-28",selectStyles:"d-flex status-select align-items-center h-28",firstOption:f.entries.Lcz_Select,id:"update-status",size:"sm","label-available":"false",data:this.bookingData.allowed_actions.map((t=>({text:t.description,value:t.code}))),textSize:"sm",class:"sm-padding-right m-0 "}),e("ir-button",{onClickHanlder:this.updateStatus.bind(this),btn_styles:"h-28",isLoading:this.isUpdateClicked,btn_disabled:this.isUpdateClicked,id:"update-status-btn",size:"sm",text:"Update"})),b.is_pms_enabled&&e("button",{type:"button",class:"btn btn-outline btn-sm ml-1",onClick:this.openPMSLogsDialog.bind(this)},f.entries.Lcz_pms),this.hasReceipt&&e("ir-button",{variant:"icon",id:"receipt",icon_name:"reciept",class:"mx-1",style:{"--icon-size":"1.65rem"}}),this.hasPrint&&e("ir-button",{variant:"icon",id:"print",icon_name:"print",class:"mr-1",style:{"--icon-size":"1.65rem"}}),this.hasDelete&&e("ir-button",{variant:"icon",id:"book-delete",icon_name:"trash",class:"mr-1",style:Object.assign(Object.assign({},p.danger),{"--icon-size":"1.65rem"})}),this.hasMenu&&e("ir-button",{variant:"icon",class:"mr-1",id:"menu",icon_name:"menu_list",style:{"--icon-size":"1.65rem"}}),this.hasCloseButton&&e("ir-button",{id:"close",variant:"icon",style:{"--icon-size":"1.65rem"},icon_name:"xmark",class:"ml-2",onClickHanlder:t=>{t.stopPropagation();t.stopImmediatePropagation();this.closeSidebar.emit(null)}})))),e("div",{class:"fluid-container p-1 text-left mx-0"},e("div",{class:"row m-0"},e("div",{class:"col-12 p-0 mx-0 pr-lg-1 col-lg-6"},e("div",{class:"card"},e("div",{class:"p-1"},e("p",null,this.bookingData.property.name||""),e("ir-label",{label:`${this.defaultTexts.entries.Lcz_Source}:`,value:this.bookingData.origin.Label,image:{src:this.bookingData.origin.Icon,alt:this.bookingData.origin.Label}}),e("ir-label",{label:`${this.defaultTexts.entries.Lcz_BookedBy}:`,value:`${this.bookingData.guest.first_name} ${this.bookingData.guest.last_name}`,iconShown:true}),this.bookingData.guest.mobile&&e("ir-label",{label:`${this.defaultTexts.entries.Lcz_Phone}:`,value:this.renderPhoneNumber()}),e("ir-label",{label:`${this.defaultTexts.entries.Lcz_Email}:`,value:this.bookingData.guest.email}),this.bookingData.guest.alternative_email&&e("ir-label",{label:`${this.defaultTexts.entries.Lcz_AlternativeEmail}:`,value:this.bookingData.guest.alternative_email}),((i=(t=this.bookingData)===null||t===void 0?void 0:t.guest)===null||i===void 0?void 0:i.address)&&e("ir-label",{label:`${this.defaultTexts.entries.Lcz_Address}:`,value:this.bookingData.guest.address}),this.userCountry&&e("ir-label",{label:`${this.defaultTexts.entries.Lcz_Country}:`,value:this.userCountry.name,country:true,image:{src:this.userCountry.flag,alt:this.userCountry.name}}),this.bookingData.is_direct&&e("ir-label",{label:`${this.defaultTexts.entries.Lcz_ArrivalTime}:`,value:this.bookingData.arrival.description}),this.bookingData.promo_key&&e("ir-label",{label:`${this.defaultTexts.entries.Lcz_Coupon}:`,value:this.bookingData.promo_key}),this.bookingData.agent&&e("ir-label",{label:`${(a=this.defaultTexts.entries.Lcz_AgentCode)===null||a===void 0?void 0:a.split(":")[0]}:`,value:this.bookingData.agent.name}),this.bookingData.is_in_loyalty_mode&&!this.bookingData.promo_key&&e("div",{class:"d-flex align-items-center"},e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},e("path",{fill:"#fc6c85",d:"M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"})),e("p",{class:"m-0 p-0 ml-1"},this.defaultTexts.entries.Lcz_LoyaltyDiscountApplied)),this.bookingData.is_direct?e("ir-label",{class:"m-0 p-0",label:`${this.defaultTexts.entries.Lcz_Note}:`,value:this.bookingData.remark}):e("ota-label",{class:"m-0 p-0",label:`${this.defaultTexts.entries.Lcz_Note}:`,remarks:this.bookingData.ota_notes,maxVisibleItems:(n=this.bookingData.ota_notes)===null||n===void 0?void 0:n.length}),e("div",{class:"d-flex align-items-center justify-content-between"},e("ir-label",{label:`${f.entries.Lcz_PrivateNote}:`,placeholder:f.entries.Lcz_VisibleToHotelOnly,value:g(this.bookingData.extras),ignore_value:true}),e("ir-button",{variant:"icon",icon_name:"edit",style:p.secondary,onClickHanlder:t=>{t.stopImmediatePropagation();t.stopPropagation();this.sidebarState="extra_note"}})))),e("div",{class:"font-size-large d-flex justify-content-between align-items-center mb-1"},e("ir-date-view",{from_date:this.bookingData.from_date,to_date:this.bookingData.to_date}),this.hasRoomAdd&&this.bookingData.is_direct&&this.bookingData.is_editable&&e("ir-button",{id:"room-add",icon_name:"square_plus",variant:"icon",style:{"--icon-size":"1.5rem"}})),e("div",{class:"card p-0 mx-0"},this.bookingData.rooms.map(((t,i)=>{const s=t.rateplan.name;const a=t.roomtype.name;return[e("ir-room",{isEditable:this.bookingData.is_editable,defaultTexts:this.defaultTexts,legendData:this.calendarData.legendData,roomsInfo:this.calendarData.roomsInfo,myRoomTypeFoodCat:a,mealCodeName:s,currency:this.bookingData.currency.code,hasRoomEdit:this.hasRoomEdit&&this.bookingData.status.code!=="003"&&this.bookingData.is_direct,hasRoomDelete:this.hasRoomDelete&&this.bookingData.status.code!=="003"&&this.bookingData.is_direct,hasCheckIn:this.hasCheckIn,hasCheckOut:this.hasCheckOut,bookingEvent:this.bookingData,bookingIndex:i,ticket:this.ticket,onDeleteFinished:this.handleDeleteFinish.bind(this)}),i!==this.bookingData.rooms.length-1&&e("hr",{class:"mr-2 ml-2 my-0 p-0"})]}))),b.pickup_service.is_enabled&&this.bookingData.is_direct&&this.bookingData.is_editable&&e("div",{class:"mb-1"},e("div",{class:"d-flex w-100 mb-1 align-items-center justify-content-between"},e("p",{class:"font-size-large p-0 m-0 "},f.entries.Lcz_Pickup),e("ir-button",{id:"pickup",variant:"icon",icon_name:"edit",style:Object.assign(Object.assign({},p.secondary),{"--icon-size":"1.5rem"})})),this.bookingData.pickup_info&&e("div",{class:"card"},e("div",{class:"p-1"},e("div",{class:"d-flex align-items-center py-0 my-0 pickup-margin"},e("p",{class:"font-weight-bold mr-1 py-0 my-0"},f.entries.Lcz_Date,": ",e("span",{class:"font-weight-normal"},l(this.bookingData.pickup_info.date,"YYYY-MM-DD").format("MMM DD, YYYY"))),this.bookingData.pickup_info.hour&&this.bookingData.pickup_info.minute&&e("p",{class:"font-weight-bold flex-fill py-0 my-0"},f.entries.Lcz_Time,":",e("span",{class:"font-weight-normal"}," ",r(this.bookingData.pickup_info.hour.toString(),this.bookingData.pickup_info.minute.toString()))),e("p",{class:"font-weight-bold py-0 my-0"},f.entries.Lcz_DueUponBooking,":"," ",e("span",{class:"font-weight-normal"},this.bookingData.pickup_info.currency.symbol,this.bookingData.pickup_info.total))),e("p",{class:"font-weight-bold py-0 my-0"},f.entries.Lcz_FlightDetails,":",e("span",{class:"font-weight-normal"}," ",`${this.bookingData.pickup_info.details}`)),e("p",{class:"py-0 my-0 pickup-margin"},`${this.bookingData.pickup_info.selected_option.vehicle.description}`),e("p",{class:"font-weight-bold py-0 my-0 pickup-margin"},f.entries.Lcz_NbrOfVehicles,":",e("span",{class:"font-weight-normal"}," ",`${this.bookingData.pickup_info.nbr_of_units}`)),e("p",{class:"small py-0 my-0 pickup-margin"},b.pickup_service.pickup_instruction.description,b.pickup_service.pickup_cancelation_prepayment.description))))),e("div",{class:"col-12 p-0 m-0 pl-lg-1 col-lg-6"},e("ir-payment-details",{paymentActions:this.paymentActions,defaultTexts:this.defaultTexts,bookingDetails:this.bookingData})))),e("ir-sidebar",{open:this.sidebarState!==null,side:"right",id:"editGuestInfo",onIrSidebarToggle:t=>{t.stopImmediatePropagation();t.stopPropagation();this.sidebarState=null},showCloseButton:false},this.renderSidbarContent()),e(s,null,this.bookingItem&&e("igl-book-property",{allowedBookingSources:this.calendarData.allowed_booking_sources,adultChildConstraints:this.calendarData.adult_child_constraints,showPaymentDetails:this.showPaymentDetails,countryNodeList:this.countryNodeList,currency:this.calendarData.currency,language:this.language,propertyid:this.propertyid,bookingData:this.bookingItem,onCloseBookingWindow:()=>this.handleCloseBookingWindow()})),e(s,null,e("ir-dialog",{ref:t=>this.dialogRef=t},e("div",{slot:"modal-body",class:"p-1"},e("h3",{class:" text-left mb-1 dialog-title "},f.entries.Lcz_PMS_Logs),!this.isPMSLogLoading&&e(s,null,e("div",{class:"d-flex align-items-center"},e("p",{class:"list-title"},f.entries.Lcz_SentAt),((c=this.pms_status)===null||c===void 0?void 0:c.sent_date)?e("p",{class:"list-item"},(h=this.pms_status)===null||h===void 0?void 0:h.sent_date," ",r((d=this.pms_status)===null||d===void 0?void 0:d.sent_hour.toString(),(u=this.pms_status)===null||u===void 0?void 0:u.sent_minute.toString())):e("p",{class:`list-item ${((m=this.pms_status)===null||m===void 0?void 0:m.sent_date)?"green":"red"}`},((v=this.pms_status)===null||v===void 0?void 0:v.is_acknowledged)?f.entries.Lcz_YES:f.entries.Lcz_NO)),e("div",{class:"d-flex align-items-center"},e("h4",{class:"list-title"},f.entries.Lcz_Acknowledged),e("p",{class:`list-item ${((y=this.pms_status)===null||y===void 0?void 0:y.is_acknowledged)?"green":"red"}`},((k=this.pms_status)===null||k===void 0?void 0:k.is_acknowledged)?f.entries.Lcz_YES:f.entries.Lcz_NO))))))]}renderSidbarContent(){var t;switch(this.sidebarState){case"guest":return e("ir-guest-info",{slot:"sidebar-body",booking_nbr:this.bookingNumber,defaultTexts:this.defaultTexts,email:(t=this.bookingData)===null||t===void 0?void 0:t.guest.email,language:this.language,onCloseSideBar:()=>this.sidebarState=null});case"pickup":return e("ir-pickup",{slot:"sidebar-body",defaultPickupData:this.bookingData.pickup_info,bookingNumber:this.bookingData.booking_nbr,numberOfPersons:this.bookingData.occupancy.adult_nbr+this.bookingData.occupancy.children_nbr,onCloseModal:()=>this.sidebarState=null});case"extra_note":return e("ir-booking-extra-note",{slot:"sidebar-body",booking:this.bookingData,onCloseModal:()=>this.sidebarState=null});default:return null}}get element(){return a(this)}static get watchers(){return{ticket:["ticketChanged"]}}};C.style=w;const D=".sc-ir-booking-extra-note-h{display:block}";const O=D;const T=class{constructor(e){t(this,e);this.closeModal=i(this,"closeModal",7);this.resetBookingData=i(this,"resetBookingData",7);this.bookingService=new u;this.booking=undefined;this.isLoading=false;this.note=""}componentWillLoad(){this.bookingService.setToken(b.token);if(this.booking.extras){this.setNote(g(this.booking.extras))}}setNote(t){this.note=t}async savePrivateNote(){try{this.isLoading=true;let t=this.booking.extras||[];const i={key:"private_note",value:this.note};if(t.length===0){t.push(i)}else{const e=t.findIndex((t=>t.key==="private_note"));if(e===-1){t.push(i)}else{t[e]=i}}const e=await this.bookingService.doReservation({assign_units:true,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,booking:this.booking,Is_Non_Technical_Change:true,extras:t});this.resetBookingData.emit(e);this.closeModal.emit(null)}catch(t){console.error(t)}finally{this.isLoading=false}}render(){return e(n,{key:"8a99f30caa83cc305f12313414525a79ce00a9a9",class:"px-0"},e("ir-title",{key:"8610153955b8b6c028d3ea1e356c9b4759722404",class:"px-1",onCloseSideBar:()=>this.closeModal.emit(null),label:f.entries.Lcz_PrivateNote,displayContext:"sidebar"}),e("form",{key:"cc38235b6551d47ac46f1d0a6c557e56b099116d",class:"px-1",onSubmit:t=>{t.preventDefault();this.savePrivateNote()}},e("ir-textarea",{key:"e11897b1b0e74b1942b6774c7d2f351f0a130707",placeholder:f.entries.Lcz_PrivateNote_MaxChar,label:"",value:this.note,maxLength:150,onTextChange:t=>this.setNote(t.detail)}),e("div",{key:"608827c29b8c89bb71877bf6a57c95c1dc959ed7",class:"d-flex flex-column flex-sm-row mt-3"},e("ir-button",{key:"7a1fd52b3d09de83e94c816310f76f82c59922b3",onClickHanlder:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-sm-0 flex-fill  mr-sm-1'}`,icon:"",text:f.entries.Lcz_Cancel,btn_color:"secondary"}),e("ir-button",{key:"84c8e36f5e3dd035dfff316e5a64564a18e12a45",btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center ml-sm-1",icon:"",isLoading:this.isLoading,text:f.entries.Lcz_Save,btn_color:"primary",btn_type:"submit"}))))}};T.style=O;const E=":host{display:block;margin:0;padding:0;box-sizing:border-box}.backdrop{opacity:0;background:rgba(0, 0, 0, 0.2);position:fixed;inset:0;z-index:99999998}.backdrop[data-state='opened']{animation:overlayShow 150ms cubic-bezier(0.16, 1, 0.3, 1) forwards}.backdrop[data-state='closed']{opacity:0;pointer-events:none}.modal-container{box-sizing:border-box;margin:0;box-shadow:hsl(206 22% 7% / 35%) 0px 10px 38px -10px, hsl(206 22% 7% / 20%) 0px 10px 20px -15px;position:fixed;z-index:99999999;overflow-y:auto;top:50%;left:50%;background:white;transform:translate(-50%, -50%);width:90%;min-height:fit-content;height:fit-content;max-width:var(--ir-dialog-max-width, 40rem);max-height:85vh;border-radius:8px;padding:0;animation:contentShow 300ms cubic-bezier(0.16, 1, 0.3, 1)}.modal-footer ::slotted(*){flex-direction:row;align-items:center;justify-content:end;gap:8px;--ir-btn-width:inherit}.modal-footer{--ir-btn-width:100%}.modal-title ::slotted(*){font-size:18px;font-weight:600;color:#101828;margin-bottom:8px}.modal-body ::slotted(*){font-size:14px;font-weight:400;color:#475467;padding:0;margin:0}@keyframes overlayShow{from{opacity:0}to{opacity:1}}@keyframes contentShow{from{opacity:0;transform:translate(-50%, -48%) scale(0.96)}to{opacity:1;transform:translate(-50%, -50%) scale(1)}}.dialog-close-button{position:absolute;top:15px;right:15px}";const j=E;const S=class{constructor(e){t(this,e);this.openChange=i(this,"openChange",7);this.open=false;this.isOpen=false}componentWillLoad(){if(this.open){this.openModal()}}componentDidLoad(){this.prepareFocusTrap()}async openModal(){this.isOpen=true;document.body.style.overflow="hidden";setTimeout((()=>{this.prepareFocusTrap()}),10);this.openChange.emit(this.isOpen)}async closeModal(){console.log("close");if(!this.isOpen){return}document.body.style.overflow="visible";this.isOpen=false;this.openChange.emit(this.isOpen)}handleOpenChange(){if(this.open){this.openModal()}else{this.closeModal()}}prepareFocusTrap(){const t='button,ir-dropdown ,[href], input, select, textarea, [tabindex]:not([tabindex="-1"])';const i=this.el.shadowRoot.querySelectorAll(t);if(i.length===0)return;this.firstFocusableElement=i[0];this.lastFocusableElement=i[i.length-1];this.firstFocusableElement.focus()}handleKeyDown(t){if(!this.isOpen){return}let i=t.key==="Tab";if(t.key==="Escape"&&this.isOpen){this.closeModal()}if(!i){return}if(!t.shiftKey&&document.activeElement===this.lastFocusableElement){this.firstFocusableElement.focus();t.preventDefault()}if(t.shiftKey&&document.activeElement===this.firstFocusableElement){this.lastFocusableElement.focus();t.preventDefault()}}disconnectedCallback(){document.body.style.overflow="visible"}render(){return e(n,{key:"0cdeb16cdd11eeaffefd8ff437c69face19087f6"},e("div",{key:"fa60a10e1674c560d6fa25a43d13db61fe0dad26",class:"backdrop","data-state":this.isOpen?"opened":"closed",onClick:()=>this.closeModal()}),this.isOpen&&e("div",{key:"3428d20b6de9f3c08c0e947c98a7b03691ee4149",class:"modal-container",tabIndex:-1,role:"dialog","aria-labelledby":"dialog1Title","aria-describedby":"dialog1Desc"},e("ir-icon",{key:"99eac3a77d392ed08e1b4970fb6a8921835c76bf",id:"close",class:"dialog-close-button",onIconClickHandler:()=>this.closeModal()},e("svg",{key:"cc88e9126066c2ebfbf0e461f2406202a818a264",slot:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:18,width:18},e("path",{key:"e11272003f7d701ca030894409a8813d9faa9609",fill:"#104064",class:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))),e("div",{key:"a9c86ef922380740fc13c1ce7313cbcb70292719",class:"modal-title",id:"dialog1Title"},e("slot",{key:"1d75ed0dd402d6b430fbd2c2172e2405a18af714",name:"modal-title"})),e("div",{key:"1df1fbd471620c88ee5c10e69190cc62985be8c5",class:"modal-body",id:"dialog1Desc"},e("slot",{key:"46bb475129ab4ae9da2360a28f5e5f18427bf330",name:"modal-body"})),e("div",{key:"5f238d2252e9124060807af4306ba4b76577d05a",class:"modal-footer"},e("slot",{key:"21c56e8637ac8d321d79902e4e43c9b57901f0bc",name:"modal-footer"}))))}get el(){return a(this)}static get watchers(){return{open:["handleOpenChange"]}}};S.style=j;const I=".input-group-text.sc-ir-guest-info{min-width:10rem;text-align:left}.mobilePrefixSelect.sc-ir-guest-info{border-right-width:0;border-top-right-radius:0;border-bottom-right-radius:0}.mobilePrefixInput.sc-ir-guest-info{border-top-left-radius:0;border-bottom-left-radius:0}.check-container.sc-ir-guest-info{position:relative;cursor:pointer;font-size:14px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;align-items:center}.check-container.sc-ir-guest-info input.sc-ir-guest-info{position:relative;opacity:0;cursor:pointer;height:0;width:0}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info{position:relative;top:0;left:0;height:20px;width:20px;border:1px solid #cacfe7;border-radius:4px;transition:all 0.3s ease}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info{background-color:#1e9ff2;border-color:#1e9ff2}.checkmark.sc-ir-guest-info:after{content:'';position:absolute;display:none}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info:after{display:block}.check-label.sc-ir-guest-info{margin-left:10px !important}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info:after{left:6px;top:3px;width:6px;height:10px;border:solid white;border-width:0 2px 2px 0;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.ir-card-header.sc-ir-guest-info{width:100%;border-bottom:1px solid #e4e5ec}.close-icon.sc-ir-guest-info{margin:0}.border-theme.sc-ir-guest-info{border:1px solid #cacfe7}";const M=I;const $=class{constructor(e){t(this,e);this.closeSideBar=i(this,"closeSideBar",7);this.resetBookingData=i(this,"resetBookingData",7);this.bookingService=new u;this.setupDataCountries=null;this.setupDataCountriesCode=null;this.defaultTexts=undefined;this.language=undefined;this.email=undefined;this.booking_nbr=undefined;this.countries=undefined;this.submit=false;this.guest=null;this.isLoading=false}async componentWillLoad(){this.bookingService.setToken(b.token);await this.init()}async init(){try{const[t,i]=await Promise.all([this.bookingService.fetchGuest(this.email),this.bookingService.getCountries(this.language)]);this.countries=i;this.guest=t}catch(t){console.log(t)}}handleInputChange(t,i){this.guest=Object.assign(Object.assign({},this.guest),{[t]:i})}async editGuest(){try{this.isLoading=true;await this.bookingService.editExposedGuest(this.guest,this.booking_nbr);this.closeSideBar.emit(null);this.resetBookingData.emit(null)}catch(t){console.log(t)}finally{this.isLoading=false;console.log("done")}}render(){var t,i,s,a,n,l;if(!this.guest){return null}return[e("div",{class:"p-0"},e("div",{class:"position-sticky mb-1 shadow-none p-0"},e("div",{class:"d-flex align-items-center justify-content-between ir-card-header py-1 p-0"},e("h3",{class:"card-title text-left font-medium-2 px-1 my-0"},this.defaultTexts.entries.Lcz_GuestDetails),e("ir-icon",{class:"close close-icon px-1",onIconClickHandler:()=>{this.closeSideBar.emit(null)}},e("svg",{slot:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:20,width:20},e("path",{d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))))),e("div",{class:"card-content collapse show"},e("div",{class:"card-body pt-0 px-1"},e("ir-input-text",{placeholder:"",label:this.defaultTexts.entries.Lcz_FirstName,name:"firstName",submited:this.submit,value:(t=this.guest)===null||t===void 0?void 0:t.first_name,required:true,onTextChange:t=>this.handleInputChange("first_name",t.detail)}),e("ir-input-text",{placeholder:"",label:this.defaultTexts.entries.Lcz_LastName,name:"lastName",submited:this.submit,value:(i=this.guest)===null||i===void 0?void 0:i.last_name,required:true,onTextChange:t=>this.handleInputChange("last_name",t.detail)}),e("ir-input-text",{placeholder:"",label:this.defaultTexts.entries.Lcz_Email,name:"email",submited:this.submit,value:(s=this.guest)===null||s===void 0?void 0:s.email,required:true,onTextChange:t=>this.handleInputChange("email",t.detail)}),e("ir-input-text",{placeholder:"",label:this.defaultTexts.entries.Lcz_AlternativeEmail,name:"altEmail",value:(a=this.guest)===null||a===void 0?void 0:a.alternative_email,onTextChange:t=>this.handleInputChange("alternative_email",t.detail)}),e("ir-select",{selectContainerStyle:"mb-1",required:true,name:"country",submited:this.submit,label:this.defaultTexts.entries.Lcz_Country,selectedValue:(l=(n=this.guest.country_id)===null||n===void 0?void 0:n.toString())!==null&&l!==void 0?l:"",data:this.countries.map((t=>({value:t.id.toString(),text:t.name}))),firstOption:"...",onSelectChange:t=>this.handleInputChange("country_id",t.detail)}),e("div",{class:"form-group mr-0"},e("div",{class:"input-group row m-0 p-0"},e("div",{class:`input-group-prepend col-3 p-0 text-dark border-none`},e("label",{class:`input-group-text  border-theme flex-grow-1 text-dark  `},this.defaultTexts.entries.Lcz_MobilePhone,"*")),e("select",{class:` form-control text-md  col-2 py-0 mobilePrefixSelect`,onInput:t=>this.handleInputChange("country_phone_prefix",t.target.value),required:true},e("option",{value:null},"..."),this.countries.map((t=>{var i;return e("option",{selected:((i=this.guest.country_phone_prefix)===null||i===void 0?void 0:i.toString())===t.phone_prefix.toString(),value:t.phone_prefix},t.phone_prefix)}))),e("input",{type:"text",required:true,value:this.guest.mobile,class:"form-control flex-fill mobilePrefixInput",onInput:t=>this.handleInputChange("mobile",t.target.value)}))),e("div",{class:"p-0 m-0"},e("label",{class:`check-container m-0 p-0`},e("input",{class:"m-0 p-0",type:"checkbox",name:"newsletter",checked:this.guest.subscribe_to_news_letter,onInput:t=>this.handleInputChange("subscribe_to_news_letter",t.target.checked)}),e("span",{class:"checkmark m-0 p-0"}),e("span",{class:"m-0 p-0  check-label"},this.defaultTexts.entries.Lcz_Newsletter))),e("hr",null),e("ir-button",{isLoading:this.isLoading,btn_disabled:this.isLoading,btn_styles:"d-flex align-items-center justify-content-center",text:this.defaultTexts.entries.Lcz_Save,onClickHanlder:this.editGuest.bind(this),color:"btn-primary"}))))]}};$.style=M;const L=".logo.sc-ir-label{height:1.5rem;width:1.5rem}.sc-ir-label-h{display:flex;margin-bottom:5px;gap:5px;align-items:center}.icon.sc-ir-label{margin-left:3px;padding:0;margin-top:0;display:flex;align-items:center}.label_message.sc-ir-label{margin:0 3px;padding:0}.label_title.sc-ir-label{min-width:max-content}.label_placeholder.sc-ir-label{color:#cacfe7;padding:0 !important;margin:0 !important}.icon-container.sc-ir-label{margin:0;padding:0}.country.sc-ir-label{height:16px;width:23px;border-radius:3px}svg.sc-ir-label{margin:0;padding:0}";const B=L;const P=class{constructor(e){t(this,e);this.editSidebar=i(this,"editSidebar",7);this.label=undefined;this.value=undefined;this.iconShown=false;this.image=undefined;this.country=false;this.imageStyle="";this.icon_name="edit";this.icon_style=undefined;this.ignore_value=false;this.placeholder=undefined}openEditSidebar(){this.editSidebar.emit()}render(){if(!this.placeholder&&!this.value&&!this.ignore_value){return null}return e(n,{class:this.image?"align-items-center":""},e("strong",{class:"label_title"},this.label),this.image&&e("img",{src:this.image.src,class:`p-0 m-0 ${this.country?"country":"logo"} ${this.image.style}`,alt:this.image.src}),this.value?e("p",{class:"label_message"},this.value):e("p",{class:"label_placeholder"},this.placeholder),this.iconShown&&e("div",{class:"icon-container"},e("ir-button",{variant:"icon",icon_name:this.icon_name,style:Object.assign(Object.assign({},p.secondary),{"--icon-size":"1.1rem"}),onClickHanlder:t=>{t.stopImmediatePropagation();t.stopPropagation();this.openEditSidebar()}})))}};P.style=B;const R=".sm-margin-right.sc-ir-payment-details{margin-right:5px !important;background:#000}.action_icons.sc-ir-payment-details{width:60px}.w-60.sc-ir-payment-details{width:100px;padding:0 5px}.payments-height.sc-ir-payment-details{height:30px}.payment_date.sc-ir-payment-details{width:100px}.iframeHeight.sc-ir-payment-details{height:max-content;height:22.5rem}.designation.sc-ir-payment-details{width:120px}.total-cost-container.sc-ir-payment-details{background:#7cbebe;color:white;padding:0.5rem;border-radius:5px}.payment-actions.sc-ir-payment-details{display:flex;align-items:center;justify-content:center;height:100%;gap:0.5rem}";const A=R;const N=class{constructor(e){t(this,e);this.resetBookingData=i(this,"resetBookingData",7);this.resetExposedCancelationDueAmount=i(this,"resetExposedCancelationDueAmount",7);this.toast=i(this,"toast",7);this.paymentService=new y;this.bookingService=new u;this.paymentBackground="white";this.bookingDetails=undefined;this.defaultTexts=undefined;this.paymentActions=undefined;this.newTableRow=false;this.collapsedPayment=false;this.collapsedGuarantee=false;this.flag=false;this.confirmModal=false;this.toBeDeletedItem=undefined;this.paymentDetailsUrl="";this.paymentExceptionMessage="";this.modal_mode=null;this.itemToBeAdded=undefined}handlePaymentGeneration(t){const i=t.detail;this.newTableRow=true;this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{amount:i.amount,date:i.due_on});this.paymentBackground="rgba(250, 253, 174)"}async componentWillLoad(){try{this.paymentService.setToken(b.token);this.bookingService.setToken(b.token);this.initializeItemToBeAdded()}catch(t){if(this.bookingDetails.guest.cci){return}if(!this.bookingDetails.is_direct&&this.bookingDetails.channel_booking_nbr){this.paymentExceptionMessage=t}}}initializeItemToBeAdded(){this.itemToBeAdded={id:-1,date:l().format("YYYY-MM-DD"),amount:null,currency:this.bookingDetails.currency,designation:"",reference:""};this.paymentBackground="white"}async _processPaymentSave(){if(this.itemToBeAdded.amount===null){this.toast.emit({type:"error",title:this.defaultTexts.entries.Lcz_EnterAmount,description:"",position:"top-right"});return}if(Number(this.itemToBeAdded.amount)>Number(this.bookingDetails.financial.due_amount)){this.modal_mode="save";this.openModal();return}this._handleSave()}async _handleSave(){this.paymentBackground="white";try{await this.paymentService.AddPayment(this.itemToBeAdded,this.bookingDetails.booking_nbr);this.initializeItemToBeAdded();this.resetBookingData.emit(null);this.resetExposedCancelationDueAmount.emit(null)}catch(t){console.log(t)}}handlePaymentInputChange(t,i,e){this.paymentBackground="white";if(t==="amount"){if(!isNaN(i)||i===""){if(i===""){this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[t]:null})}else{this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[t]:parseFloat(i)})}}else if(e&&e.target){let t=e.target;let i=t.value;i=i.replace(/[^\d-]|(?<!^)-/g,"");t.value=i}}else{this.itemToBeAdded=Object.assign(Object.assign({},this.itemToBeAdded),{[t]:i})}}async cancelPayment(){try{await this.paymentService.CancelPayment(this.toBeDeletedItem.id);const t=this.bookingDetails.financial.payments.filter((t=>t.id!==this.toBeDeletedItem.id));this.bookingDetails=Object.assign(Object.assign({},this.bookingDetails),{financial:Object.assign(Object.assign({},this.bookingDetails.financial),{payments:t})});this.confirmModal=!this.confirmModal;this.resetBookingData.emit(null);this.resetExposedCancelationDueAmount.emit(null);this.toBeDeletedItem=null;this.modal_mode=null}catch(t){console.log(t)}}async handleConfirmModal(t){this.paymentBackground="white";t.stopImmediatePropagation();t.stopPropagation();if(this.modal_mode==="delete"){await this.cancelPayment()}else{await this._handleSave()}}openModal(){const t=document.querySelector(".delete-record-modal");t.openModal()}async handleCancelModal(t){t.stopImmediatePropagation();t.stopPropagation();try{this.paymentBackground="white";if(this.modal_mode==="save"){this.initializeItemToBeAdded()}}catch(t){console.log(t)}}handleBookingDetails(){if(this.newTableRow){this.newTableRow=false}}handleDateChange(t){this.handlePaymentInputChange("date",t.detail.end.format("YYYY-MM-DD"))}_renderTableRow(t,i="normal"){var a,n;return e(s,null,e("tr",null,e("td",{class:"border payments-height border-light border-bottom-0 text-center"},i==="normal"?e("span",{class:"sm-padding-left"},o(t.date)):e("ir-date-picker",{date:((a=this.itemToBeAdded)===null||a===void 0?void 0:a.date)?new Date(this.itemToBeAdded.date):new Date,minDate:l().add(-2,"months").startOf("month").format("YYYY-MM-DD"),singleDatePicker:true,autoApply:true,onDateChanged:this.handleDateChange.bind(this)})),e("td",{class:"border payments-height border-light border-bottom-0 text-center "},i==="normal"?e("span",{class:"sm-padding-right"},c(t.amount,this.bookingDetails.currency.code)):e("input",{type:"text",class:"border-0 text-center form-control py-0 m-0 w-100",value:this.itemToBeAdded.amount,onBlur:t=>{t.target.value=Number(this.itemToBeAdded.amount).toFixed(2)},onInput:t=>this.handlePaymentInputChange("amount",+t.target.value,t)})),e("td",{class:"border payments-height border-light border-bottom-0 text-center"},i==="normal"?e("span",{class:"sm-padding-left"},t.designation):e("input",{class:"border-0 w-100 form-control py-0 m-0",onInput:t=>this.handlePaymentInputChange("designation",t.target.value),type:"text"})),e("td",{rowSpan:2,class:"border payments-height border-light border-bottom-0 text-center"},e("div",{class:"payment-actions"},i==="add"&&e("ir-button",{variant:"icon",icon_name:"save",style:p.secondary,isLoading:i==="add"&&k("/Do_Payment"),class:"m-0",onClickHanlder:()=>{this._processPaymentSave()}}),e("ir-button",{variant:"icon",icon_name:"trash",style:p.danger,isLoading:((n=this.toBeDeletedItem)===null||n===void 0?void 0:n.id)===(t===null||t===void 0?void 0:t.id)&&k("/Cancel_Payment"),onClickHanlder:i==="add"?()=>{this.newTableRow=false;this.initializeItemToBeAdded()}:()=>{this.modal_mode="delete";this.toBeDeletedItem=t;this.openModal()}})))),e("tr",null,e("td",{colSpan:3,class:"border border-light payments-height border-bottom-0 text-center"},i==="normal"?e("span",{class:"sm-padding-left "},t.reference):e("input",{class:"border-0 w-100  form-control py-0 m-0",onKeyPress:t=>{if(t.key==="Enter"){this.newTableRow=false;this._handleSave()}},onInput:t=>this.handlePaymentInputChange("reference",t.target.value),type:"text"}))))}bookingGuarantee(){var t,i,s,a,n,l,o,r,c,h,d,u,m,f,b,p,g,v,y,k,x,_,w,C,D,O,T,E;if(this.bookingDetails.is_direct&&!this.bookingDetails.guest.cci){return null}return e("div",null,e("div",{class:"d-flex align-items-center"},e("strong",{class:"mr-1"},this.defaultTexts.entries.Lcz_BookingGuarantee),e("ir-button",{id:"drawer-icon","data-toggle":"collapse","data-target":`.guarrantee`,"aria-expanded":this.collapsedGuarantee?"true":"false","aria-controls":"myCollapse",class:"sm-padding-right pointer",variant:"icon",icon_name:"credit_card",onClickHanlder:async()=>{if(!this.bookingDetails.is_direct&&this.bookingDetails.channel_booking_nbr&&!this.bookingDetails.guest.cci){this.paymentDetailsUrl=await this.bookingService.getPCICardInfoURL(this.bookingDetails.booking_nbr)}this.collapsedGuarantee=!this.collapsedGuarantee}})),e("div",{class:"collapse guarrantee "},this.bookingDetails.guest.cci?[e("div",null,((i=(t=this.bookingDetails)===null||t===void 0?void 0:t.guest)===null||i===void 0?void 0:i.cci)&&"Card:"," ",e("span",null,((n=(a=(s=this.bookingDetails)===null||s===void 0?void 0:s.guest)===null||a===void 0?void 0:a.cci)===null||n===void 0?void 0:n.nbr)||"")," ",((r=(o=(l=this.bookingDetails)===null||l===void 0?void 0:l.guest)===null||o===void 0?void 0:o.cci)===null||r===void 0?void 0:r.expiry_month)&&"Expiry: ",e("span",null," ",((d=(h=(c=this.bookingDetails)===null||c===void 0?void 0:c.guest)===null||h===void 0?void 0:h.cci)===null||d===void 0?void 0:d.expiry_month)||""," ",((f=(m=(u=this.bookingDetails)===null||u===void 0?void 0:u.guest)===null||m===void 0?void 0:m.cci)===null||f===void 0?void 0:f.expiry_year)&&"/"+((g=(p=(b=this.bookingDetails)===null||b===void 0?void 0:b.guest)===null||p===void 0?void 0:p.cci)===null||g===void 0?void 0:g.expiry_year))),e("div",null,((y=(v=this.bookingDetails)===null||v===void 0?void 0:v.guest)===null||y===void 0?void 0:y.cci.holder_name)&&"Name:"," ",e("span",null,((_=(x=(k=this.bookingDetails)===null||k===void 0?void 0:k.guest)===null||x===void 0?void 0:x.cci)===null||_===void 0?void 0:_.holder_name)||"")," ",((D=(C=(w=this.bookingDetails)===null||w===void 0?void 0:w.guest)===null||C===void 0?void 0:C.cci)===null||D===void 0?void 0:D.cvc)&&"- CVC:"," ",e("span",null," ",((E=(T=(O=this.bookingDetails)===null||O===void 0?void 0:O.guest)===null||T===void 0?void 0:T.cci)===null||E===void 0?void 0:E.cvc)||""))]:this.paymentDetailsUrl?e("iframe",{src:this.paymentDetailsUrl,width:"100%",class:"iframeHeight",frameborder:"0",name:"payment"}):e("div",{class:"text-center"},this.paymentExceptionMessage)))}_renderDueDate(t){return e("tr",null,e("td",{class:"pr-1"},o(t.date)),e("td",{class:"pr-1"},c(t.amount,this.bookingDetails.currency.code)),e("td",{class:"pr-1"},t.description),e("td",{class:"collapse font-size-small roomName"},t.room))}render(){var t,i,a,n;if(!this.bookingDetails.financial){return null}return[e("div",{class:"card m-0"},e("div",{class:"p-1"},this.bookingDetails.financial.gross_cost>0&&this.bookingDetails.financial.gross_cost!==null&&e("div",{class:"mb-2 h4 total-cost-container"},this.defaultTexts.entries.Lcz_TotalCost,": ",e("span",null,c(this.bookingDetails.financial.gross_cost,this.bookingDetails.currency.code))),e("div",{class:" h4"},this.defaultTexts.entries.Lcz_DueBalance,":"," ",e("span",{class:"danger font-weight-bold"},c(this.bookingDetails.financial.due_amount,this.bookingDetails.currency.code))),this.bookingGuarantee(),e("div",{class:"mt-2"},e("div",null,((i=(t=this.bookingDetails.financial)===null||t===void 0?void 0:t.due_dates)===null||i===void 0?void 0:i.length)>0&&e(s,null,e("div",{class:"d-flex align-items-center"},e("strong",{class:"mr-1"},this.defaultTexts.entries.Lcz_PaymentDueDates),e("ir-button",{id:"drawer-icon","data-toggle":"collapse","data-target":`.roomName`,"aria-expanded":this.collapsedPayment?"true":"false","aria-controls":"myCollapse",variant:"icon",icon_name:this.collapsedPayment?"closed_eye":"open_eye",onClickHanlder:()=>{this.collapsedPayment=!this.collapsedPayment},style:{"--icon-size":"1.5rem"}})),e("table",null,(a=this.bookingDetails.financial.due_dates)===null||a===void 0?void 0:a.map((t=>this._renderDueDate(t))))))),e("div",{class:"mt-2 d-flex  flex-column rounded payment-container"},e("div",{class:"d-flex align-items-center justify-content-between"},e("strong",null,this.defaultTexts.entries.Lcz_Payments," history"),e("ir-button",{id:"add-payment",variant:"icon",icon_name:"square_plus",style:{"--icon-size":"1.5rem"},onClickHanlder:()=>{this.newTableRow=true}})),e("table",{class:"mt-1",style:{backgroundColor:this.paymentBackground}},e("thead",null,e("tr",null,e("th",{class:"border border-light border-bottom-0 text-center payment_date"},this.defaultTexts.entries.Lcz_Dates),e("th",{class:"border border-light border-bottom-0 text-center w-60"},this.defaultTexts.entries.Lcz_Amount),e("th",{class:"border border-light border-bottom-0 text-center designation"},this.defaultTexts.entries.Lcz_Designation),e("th",{class:"border border-light border-bottom-0 text-center action_icons"},e("span",{class:"sr-only"},"payment actions")))),e("tbody",null,(n=this.bookingDetails.financial.payments)===null||n===void 0?void 0:n.map((t=>this._renderTableRow(t))),this.newTableRow?this._renderTableRow(null,"add"):null))))),e("ir-modal",{item:this.toBeDeletedItem,class:"delete-record-modal",modalTitle:this.defaultTexts.entries.Lcz_Confirmation,modalBody:this.modal_mode==="delete"?this.defaultTexts.entries.Lcz_IfDeletedPermantlyLost:this.defaultTexts.entries.Lcz_EnteringAmountGreaterThanDue,iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:this.defaultTexts.entries.Lcz_Cancel,rightBtnText:this.modal_mode==="delete"?this.defaultTexts.entries.Lcz_Delete:this.defaultTexts.entries.Lcz_Confirm,leftBtnColor:"secondary",rightBtnColor:this.modal_mode==="delete"?"danger":"primary",onConfirmModal:this.handleConfirmModal.bind(this),onCancelModal:this.handleCancelModal.bind(this)})]}static get watchers(){return{bookingDetails:["handleBookingDetails"]}}};N.style=A;class z{async savePickup(t,i,e){try{const s=t.arrival_time.split(":");await d.post(`/Do_Pickup?Ticket=${b.token}`,{booking_nbr:i,is_remove:e,currency:t.currency,date:t.arrival_date,details:t.flight_details,hour:s[0],minute:s[1],nbr_of_units:t.number_of_vehicles,selected_option:t.selected_option,total:+t.due_upon_booking})}catch(t){console.log(t)}}transformDefaultPickupData(t){const i=t.hour&&t.minute?x(t.hour)+":"+x(t.minute):"";return{arrival_date:t.date,arrival_time:i,currency:t.currency,due_upon_booking:t.total.toFixed(2),flight_details:t.details,location:t.selected_option.location.id,number_of_vehicles:t.nbr_of_units,selected_option:t.selected_option,vehicle_type_code:t.selected_option.vehicle.code}}getAvailableLocations(t){let i=[];b.pickup_service.allowed_options.forEach((e=>{if(i.filter((t=>t.value===e.location.id)).length===0){i.push({text:t+" "+e.location.description,value:e.location.id})}}));return i}validateForm(t){if(t.arrival_time.split(":").length!==2){return{error:true,cause:"arrival_time"}}if(t.flight_details===""){return{error:true,cause:"flight_details"}}if(t.vehicle_type_code===""){return{error:true,cause:"vehicle_type_code"}}if(t.number_of_vehicles===0){return{error:true,cause:"number_of_vehicles"}}return{error:false}}getNumberOfVehicles(t,i){let e=Math.ceil(i/t);let s=e>1?e:1;let a=e>1?2:3;return Array.from({length:e+a},((t,i)=>s+i))}getPickUpPersonStatus(t){const i=b.pickup_service.allowed_pricing_models.find((i=>i.code===t));if(!i){return null}return i.description}updateDue(t){const i=this.getPickUpPersonStatus(t.code);if(!i){return}if(i==="Person"){return t.amount*t.numberOfPersons}else{return t.amount*t.number_of_vehicles}}}const Y=".sc-ir-pickup-h{display:block}.custom-card-container.sc-ir-pickup{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e4e5ec}.card-title.sc-ir-pickup{flex:1}.border-theme.sc-ir-pickup{border:1px solid #cacfe7}";const H=Y;const F=class{constructor(e){t(this,e);this.closeModal=i(this,"closeModal",7);this.resetBookingData=i(this,"resetBookingData",7);this.pickupService=new z;this.defaultPickupData=undefined;this.numberOfPersons=0;this.bookingNumber=undefined;this.isLoading=false;this.allowedOptionsByLocation=[];this.pickupData={location:-1,flight_details:"",due_upon_booking:"",number_of_vehicles:1,vehicle_type_code:"",currency:undefined,arrival_time:"",arrival_date:l().format("YYYY-MM-DD"),selected_option:undefined};this.vehicleCapacity=[];this.cause=null}componentWillLoad(){if(this.defaultPickupData){const t=this.pickupService.transformDefaultPickupData(this.defaultPickupData);this.vehicleCapacity=this.pickupService.getNumberOfVehicles(t.selected_option.vehicle.capacity,this.numberOfPersons);this.allowedOptionsByLocation=b.pickup_service.allowed_options.filter((i=>i.location.id===t.location));this.pickupData=Object.assign({},t)}}handleLocationChange(t){t.stopImmediatePropagation();t.stopPropagation();const i=t.detail;if(i===""){this.updatePickupData("location",-1)}if(i!==""){this.allowedOptionsByLocation=b.pickup_service.allowed_options.filter((t=>t.location.id.toString()===i));let t=this.allowedOptionsByLocation[0];if(!t){return}this.vehicleCapacity=this.pickupService.getNumberOfVehicles(t.vehicle.capacity,this.numberOfPersons);this.pickupData=Object.assign(Object.assign({},this.pickupData),{location:i,selected_option:t,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:t.amount,code:t.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:t.vehicle.code,currency:t.currency});const e=this.el.querySelector("#pickup-time");if(!e){setTimeout((()=>{this.initializeInputMask()}),100)}}}initializeInputMask(){const t=this.el.querySelector("#pickup-time");if(t){Inputmask("Hh:Mm",{placeholder:"HH:mm",definitions:{H:{validator:"[0-2]"},h:{validator:function(t,i,e){var s=i.buffer[e-1];if(s==="2"){return/[0-3]/.test(t)}else{return/[0-9]/.test(t)}}},M:{validator:"[0-5]"},m:{validator:"[0-9]"}},insertMode:true,showMaskOnHover:false,inputmode:"numeric",alias:"datetime",oncomplete:()=>{this.updatePickupData("arrival_time",t.value)},oncleared:()=>{this.updatePickupData("arrival_time","")},onincomplete:()=>{this.updatePickupData("arrival_time",t.value)}}).mask(t)}}handleVehicleQuantityChange(t){if(t.detail===""){return}const i=+t.detail;this.pickupData=Object.assign(Object.assign({},this.pickupData),{number_of_vehicles:i,due_upon_booking:this.pickupService.updateDue({amount:this.pickupData.selected_option.amount,code:this.pickupData.selected_option.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:i}).toFixed(2)})}componentDidLoad(){if(this.defaultPickupData){this.initializeInputMask()}}handleVehicleTypeChange(t){if(t.detail===""){this.pickupData=Object.assign(Object.assign({},this.pickupData),{due_upon_booking:"",vehicle_type_code:""});return}let i=b.pickup_service.allowed_options.find((i=>i.location.id===+this.pickupData.location&&i.vehicle.code===t.detail));if(!i){return}this.vehicleCapacity=[...this.pickupService.getNumberOfVehicles(i.vehicle.capacity,this.numberOfPersons)];this.pickupData=Object.assign(Object.assign({},this.pickupData),{selected_option:i,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:i.amount,code:i.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:i.vehicle.code})}updatePickupData(t,i){this.pickupData=Object.assign(Object.assign({},this.pickupData),{[t]:i})}async savePickup(){try{this.isLoading=true;const t=this.pickupService.validateForm(this.pickupData);if(t.error){this.cause=t.cause;return}if(this.cause){this.cause=null}await this.pickupService.savePickup(this.pickupData,this.bookingNumber,this.defaultPickupData!==null&&this.pickupData.location===-1);this.resetBookingData.emit(null);this.closeModal.emit(null)}catch(t){console.error(t)}finally{this.isLoading=false}}render(){return e(n,{key:"1a16cd01e1a53928198351fb8df42ab7eb48e151",class:"p-0"},e("ir-title",{key:"bc65f0f9840cc48ffd60bcf5fb97f8c88ec5aa0b",class:"px-1",onCloseSideBar:()=>this.closeModal.emit(null),label:f.entries.Lcz_Pickup,displayContext:"sidebar"}),e("section",{key:"0bd9a297725d16f2efd268e03cfdf28b1a464d4f",class:"px-1"},e("ir-select",{key:"6d12bee7ab4e6d1817d2dd4dc6eb72c59b069c47",selectedValue:this.pickupData.location,selectContainerStyle:"mb-1",onSelectChange:this.handleLocationChange.bind(this),firstOption:f.entries.Lcz_Pickup_NoThankYou,class:"m-0 mb-1",LabelAvailable:false,data:this.pickupService.getAvailableLocations(f.entries.Lcz_Pickup_YesFrom)}),this.pickupData.location>0&&e(s,{key:"66fd053fc91e9b1063525f4b4c3910caf5a9a047"},e("div",{key:"5b8bb91de330c28e1c37360fbb2de36c387238c1",class:"d-flex"},e("div",{key:"4d2463c71612ea0eaede7850123c0f85b0e106db",class:"form-group  mr-1"},e("div",{key:"e77482b75b762e9510a9dcdfe1e9a8907247e35b",class:"input-group row m-0"},e("div",{key:"360036ba36ddcd15367654168bfe1cd92ebf999d",class:`input-group-prepend col-5 p-0 text-dark border-0`},e("label",{key:"72a346a5955e35e0e2b4281c2721c3828dd714fe",class:`input-group-text  flex-grow-1 text-dark border-theme `},f.entries.Lcz_ArrivalDate)),e("div",{key:"ad3178048605b7cae379071cc12b71aef7dc5597",class:"form-control form-control-md col-7 d-flex align-items-center pl-0"},e("ir-date-picker",{key:"f96c523a4463f3494d0808eb673f7d25c89ace56",minDate:l().format("YYYY-MM-DD"),autoApply:true,singleDatePicker:true,onDateChanged:t=>{this.updatePickupData("arrival_date",t.detail.start.format("YYYY-MM-DD"))}})))),e("div",{key:"f1894927286f17060785c2ece3e8b2bc95373c91",class:"form-group"},e("div",{key:"2f5d4720db00d222495fecb53c8aea0fbd36c8e0",class:"input-group  row m-0"},e("div",{key:"d242b0363e7adcf67bdbc984a5fe88ee4e797c97",class:`input-group-prepend col-4 col-sm-3 p-0 text-dark border-0`},e("label",{key:"67ce35b9c0555e1d60fa6b757686bafdbcb74812",htmlFor:"pickup",class:`input-group-text flex-grow-1 text-dark border-theme`},f.entries.Lcz_Time)),e("input",{key:"93cd1de67b1deeda6383e9f54a6c6f822537dd2b",type:"text",value:this.pickupData.arrival_time,id:"pickup-time",class:`form-control col-8 col-sm-4 ${this.cause==="arrival_time"&&"border-danger"}`})))),e("ir-input-text",{key:"9990c6481707e709605dfc5e477f1ab516fbed94",value:this.pickupData.flight_details,label:f.entries.Lcz_FlightDetails,onTextChange:t=>this.updatePickupData("flight_details",t.detail),placeholder:"",inputStyles:this.cause==="flight_details"?"border-danger":""}),e("ir-select",{key:"0469049ab068038b196c1564f60c18f528eeedcd",selectContainerStyle:"mb-1",selectStyles:this.cause==="vehicle_type_code"?"border-danger":"",onSelectChange:this.handleVehicleTypeChange.bind(this),firstOption:f.entries.Lcz_Select,selectedValue:this.pickupData.vehicle_type_code,class:"m-0",LabelAvailable:false,data:this.allowedOptionsByLocation.map((t=>({text:t.vehicle.description,value:t.vehicle.code})))}),e("div",{key:"64cd045786dc033c8e54c58d89591fe5d7c4f6ac",class:"d-flex flex-column flex-md-row"},e("ir-select",{key:"b904dc1984a1d5ae540d7d399866cd7d3f2c9b29",labelBorder:"theme",selectContainerStyle:"mb-1",onSelectChange:this.handleVehicleQuantityChange.bind(this),selectStyles:this.cause==="number_of_vehicles"?"border-danger":"",selectedValue:this.pickupData.number_of_vehicles,labelWidth:7,class:"m-0  mb-md-0 mr-md-1 flex-fill",label:f.entries.Lcz_NbrOfVehicles,data:this.vehicleCapacity.map((t=>({text:t,value:t})))}),e("ir-input-text",{key:"873f2625b3c9a88e2ef5cd09772d08a3ecba7342",labelBorder:"theme",readonly:true,value:this.pickupData.due_upon_booking,labelWidth:7,label:`${f.entries.Lcz_DueUponBooking}  ${this.pickupData.currency.symbol}`,placeholder:"",class:""}))),e("div",{key:"4442b23bec54beda7adce3e0480835a497c7cfa6",class:"d-flex flex-column flex-sm-row mt-3"},e("ir-button",{key:"e3bb21067b6ba2f4e39c446d6371d45b04ced325",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-sm-0 flex-fill  ${this.defaultPickupData||this.pickupData.location!==-1?"mr-sm-1":""}`,icon:"",text:f.entries.Lcz_Cancel,btn_color:"secondary"}),(this.defaultPickupData||this.pickupData.location!==-1)&&e("ir-button",{key:"705f0329720a22275bbe9ffaed023e5e650fc23c",btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center",icon:"",isLoading:this.isLoading,text:f.entries.Lcz_Save,btn_color:"primary",onClick:this.savePickup.bind(this)}))))}get el(){return a(this)}};F.style=H;const U=".light-blue-bg.sc-ir-room{background:#acecff;padding:0.3rem 0.5rem;border-radius:5px}.payment-container.sc-ir-room{position:absolute;right:1rem;height:fit-content}.sc-ir-room-h{position:relative}.sm-mr.sc-ir-room{margin-right:3px}.subtotal_row.sc-ir-room{padding-top:8px}.room_actions_btns.sc-ir-room{gap:0.5rem}.night-cost.sc-ir-room{color:#7cbebe}.mx-0-5.sc-ir-room{margin-left:2px !important;margin-right:2px !important}.tax-width.sc-ir-room{font-size:10px}.sm-mb-1.sc-ir-room{margin-bottom:5px !important}.sm-mt-1.sc-ir-room{margin-top:5px !important}.mx-01.sc-ir-room{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}";const G=U;const V=class{constructor(e){t(this,e);this.deleteFinished=i(this,"deleteFinished",7);this.pressCheckIn=i(this,"pressCheckIn",7);this.pressCheckOut=i(this,"pressCheckOut",7);this.editInitiated=i(this,"editInitiated",7);this.bookingEvent=undefined;this.bookingIndex=undefined;this.isEditable=undefined;this.mealCodeName=undefined;this.myRoomTypeFoodCat=undefined;this.currency="USD";this.legendData=undefined;this.roomsInfo=undefined;this.collapsed=false;this.defaultTexts=undefined;this.ticket=undefined;this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.item=undefined;this.isLoading=false;this.isModelOpen=false}componentWillLoad(){if(this.bookingEvent){this.item=this.bookingEvent.rooms[this.bookingIndex]}}handleBookingEventChange(){this.item=this.bookingEvent.rooms[this.bookingIndex]}componentDidLoad(){this.modal=this.element.querySelector("ir-modal")}handleClick(t){let i=t.target;if(i.id=="checkin"){this.pressCheckIn.emit(this.item)}else if(i.id=="checkout"){this.pressCheckOut.emit(this.item)}}getDateStr(t,i="default"){return t.getDate()+" "+t.toLocaleString(i,{month:"short"})+" "+t.getFullYear()}handleEditClick(){var t,i,e,s,a,n;this.editInitiated.emit({event_type:"EDIT_BOOKING",ID:this.item["assigned_units_pool"],NAME:v(this.item.guest.first_name,this.item.guest.last_name),EMAIL:this.bookingEvent.guest.email,PHONE:this.bookingEvent.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.bookingEvent.from_date,TO_DATE:this.bookingEvent.to_date,TITLE:`${this.defaultTexts.entries.Lcz_EditBookingFor} ${(i=(t=this.item)===null||t===void 0?void 0:t.roomtype)===null||i===void 0?void 0:i.name} ${((s=(e=this.item)===null||e===void 0?void 0:e.unit)===null||s===void 0?void 0:s.name)||""}`,defaultDateRange:{dateDifference:this.item.days.length,fromDate:new Date(this.item.from_date+"T00:00:00"),fromDateStr:this.getDateStr(new Date(this.item.from_date+"T00:00:00")),toDate:new Date(this.item.to_date+"T00:00:00"),toDateStr:this.getDateStr(new Date(this.item.to_date+"T00:00:00")),message:""},bed_preference:this.item.bed_preference,adult_child_offering:this.item.rateplan.selected_variation.adult_child_offering,ADULTS_COUNT:this.item.rateplan.selected_variation.adult_nbr,ARRIVAL:this.bookingEvent.arrival,ARRIVAL_TIME:this.bookingEvent.arrival.description,BOOKING_NUMBER:this.bookingEvent.booking_nbr,cancelation:this.item.rateplan.cancelation,channel_booking_nbr:this.bookingEvent.channel_booking_nbr,CHILDREN_COUNT:this.item.rateplan.selected_variation.child_nbr,COUNTRY:this.bookingEvent.guest.country_id,ENTRY_DATE:this.bookingEvent.from_date,FROM_DATE_STR:this.bookingEvent.format.from_date,guarantee:this.item.rateplan.guarantee,GUEST:this.bookingEvent.guest,IDENTIFIER:this.item.identifier,is_direct:this.bookingEvent.is_direct,IS_EDITABLE:this.bookingEvent.is_editable,NO_OF_DAYS:this.item.days.length,NOTES:this.bookingEvent.remark,origin:this.bookingEvent.origin,POOL:this.item["assigned_units_pool"],PR_ID:(a=this.item.unit)===null||a===void 0?void 0:a.id,RATE:this.item.total,RATE_PLAN:this.item.rateplan.name,RATE_PLAN_ID:this.item.rateplan.id,RATE_TYPE:this.item.roomtype.id,ROOMS:this.bookingEvent.rooms,SOURCE:this.bookingEvent.source,SPLIT_BOOKING:false,STATUS:"IN-HOUSE",TO_DATE_STR:this.bookingEvent.format.to_date,TOTAL_PRICE:this.bookingEvent.total,legendData:this.legendData,roomsInfo:this.roomsInfo,roomName:((n=this.item.unit)===null||n===void 0?void 0:n.name)||"",PICKUP_INFO:this.bookingEvent.pickup_info})}handleDeleteClick(){this.modal.openModal()}async deleteRoom(){try{this.isLoading=true;let t=[...this.bookingEvent.rooms];t=t.filter((t=>t.identifier!==this.item.identifier));const i={assign_units:true,check_in:true,is_pms:true,is_direct:true,booking:{booking_nbr:this.bookingEvent.booking_nbr,from_date:this.bookingEvent.from_date,to_date:this.bookingEvent.to_date,remark:this.bookingEvent.remark,property:this.bookingEvent.property,source:this.bookingEvent.source,currency:this.bookingEvent.currency,arrival:this.bookingEvent.arrival,guest:this.bookingEvent.guest,rooms:t}};console.log("body:",i);const{data:e}=await d.post(`/DoReservation?Ticket=${this.ticket}`,i);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}this.irModalRef.closeModal();this.deleteFinished.emit(this.item.identifier)}catch(t){}finally{this.isLoading=false}}render(){var t,i;return e(n,{key:"6b0fe61cf393fa91e28e644f4ffb0b9957020c9e",class:"p-1 d-flex m-0"},e("ir-button",{key:"12ff78f144bbeea269ca4c9e83f494a8d15be4b4",variant:"icon",id:"drawer-icon","data-toggle":"collapse","data-target":`#roomCollapse-${(t=this.item.identifier)===null||t===void 0?void 0:t.split(" ").join("")}`,"aria-expanded":this.collapsed?"true":"false","aria-controls":"myCollapse",class:"mr-1",icon_name:this.collapsed?"closed_eye":"open_eye",onClickHanlder:()=>{this.collapsed=!this.collapsed},style:{"--icon-size":"1.6rem"}}),e("div",{key:"c09ce9d1865417b88286b575637f14a14846d00e",class:"flex-fill m-0 "},e("div",{key:"8d2f96ea2739e677374069c9091c22cfbb0925e8",class:"d-flex align-items-start justify-content-between sm-mb-1"},e("p",{key:"8b5b213e66feb51695955a52209cde4480e54064",class:"m-0 p-0"},e("strong",{key:"d24a61a06dbdc116f4870524d9f1538d0fb31912",class:"m-0 p-0"},this.myRoomTypeFoodCat||""," ")," ",this.mealCodeName," ",this.item.rateplan.is_non_refundable&&` - ${this.defaultTexts.entries.Lcz_NonRefundable}`," "),e("div",{key:"9f8589430b2665ca4836d0dd04d8dc4e8ea84134",class:"d-flex m-0 p-0 align-items-center room_actions_btns"},e("span",{key:"433ba3e52d85653e3d4012e4a9202d6ff2ebfddb",class:"p-0 m-0 font-weight-bold"},c(this.item["gross_total"],this.currency)),this.hasRoomEdit&&this.isEditable&&e("ir-button",{key:"23b248147a31fbdca347460e8e76c5ddc88e2630",id:`roomEdit-${this.item.identifier}`,variant:"icon",icon_name:"edit",style:p.secondary,onClickHanlder:this.handleEditClick.bind(this)}),this.hasRoomDelete&&this.isEditable&&e("ir-button",{key:"6149c5ff6e30f98adf0248009020f43df66f14d3",variant:"icon",onClickHanlder:this.handleDeleteClick.bind(this),id:`roomDelete-${this.item.identifier}`,icon_name:"trash",style:p.danger}))),e("div",{key:"992bc11a3ee87b0f2ef6880a270bc316b2481746",class:"d-flex align-items-center sm-mb-1"},e("ir-date-view",{key:"8b9d3b861911b37a0fe4cd3c35e75536fc6b6564",class:"mr-1",from_date:this.item.from_date,to_date:this.item.to_date,showDateDifference:false}),this.hasCheckIn&&e("ir-button",{key:"5bdcbc455ed4146b6135670d61ffed09b94b6bda",id:"checkin",icon:"",class:"mr-1",btn_color:"info",size:"sm",text:"Check in"}),this.hasCheckOut&&e("ir-button",{key:"7c5e07c153c95c57cbecf39a8ca8da737965fe24",id:"checkout",icon:"",btn_color:"info",size:"sm",text:"Check out"})),e("div",{key:"36ce446098693bfbe2d3e4094fc4b30159ec4825",class:"d-flex justify-content-end"},b.is_frontdesk_enabled&&this.item.unit&&e("span",{key:"c344a7ded359e09a6980a677e93a1e7dd938b29e",class:`light-blue-bg ${this.hasCheckIn||this.hasCheckOut?"mr-2":""} `},this.item.unit.name)),e("div",{key:"33dcb8ab473d5559f3d7111fdac61f1ef4d9a961"},e("span",{key:"5691f1363d52d0a5de5a8487eb8529a6390569b3",class:"mr-1"},`${this.item.guest.first_name||""} ${this.item.guest.last_name||""}`),this.item.rateplan.selected_variation.adult_nbr>0&&e("span",{key:"def0c8e1e72c8af9f543f05713ed587e7ae4cd75"}," ",this.item.rateplan.selected_variation.adult_child_offering)),e("div",{key:"f8ab047c6dadb07f5edab0cdfd5bb34452fb434c",class:"collapse",id:`roomCollapse-${(i=this.item.identifier)===null||i===void 0?void 0:i.split(" ").join("")}`},e("div",{key:"eb107af5e0ab0f2aff064941b8dabbba80ca10b1",class:"d-flex sm-mb-1 sm-mt-1"},e("div",{key:"b20e23f39e4a78cf22ed6dd42201e563de5d4c7d",class:" sm-padding-top"},e("strong",{key:"40f8920208dadd81202a97d7cfe125bc4f022905",class:"sm-padding-right"},`${this.defaultTexts.entries.Lcz_Breakdown}:`)),e("div",{key:"134c76e2edc1349326058cf7238e25c93cf29b68",class:"flex-fill"},e("table",{key:"9c22051b8eed88f94a7cf626fae88db3c9e7dda7"},this.item.days.length>0&&this.item.days.map((t=>e("tr",null,e("td",{class:"pr-2 text-right"},h(t.date)),e("td",{class:"text-right"},c(t.amount,this.currency)),t.cost>0&&t.cost!==null&&e("td",{class:"pl-2 text-left night-cost"},c(t.cost,this.currency))))),e("tr",{key:"f54a52c9cff71ce7271e72e0812dbec697df480c",class:""},e("th",{key:"555a5695533ead967c2420bb1fa8444818bce326",class:"text-right pr-2 subtotal_row"},this.defaultTexts.entries.Lcz_SubTotal),e("th",{key:"42071e46847e201b665ec25a635ba71c0305aa8c",class:"text-right subtotal_row"},c(this.item.total,this.currency)),this.item.gross_cost>0&&this.item.gross_cost!==null&&e("th",{key:"b67c68a2f10be7cac247f74875679844a75821f9",class:"pl-2 text-right night-cost"},c(this.item.cost,this.currency))),this.bookingEvent.is_direct?e(s,null,(()=>{const t=b.taxes.filter((t=>t.pct>0));return t.map((t=>e("tr",null,e("td",{class:"text-right pr-2"},t.is_exlusive?this.defaultTexts.entries.Lcz_Excluding:this.defaultTexts.entries.Lcz_Including," ",t.name," (",t.pct,"%)"),e("td",{class:"text-right"},c(this.item.total*t.pct/100,this.currency)),this.item.gross_cost>0&&this.item.gross_cost!==null&&e("td",{class:"pl-2 text-right night-cost"},c(this.item.cost*t.pct/100,this.currency)))))})()):e(s,null,(()=>{const t=this.item.ota_taxes.filter((t=>t.amount>0));return t.map((t=>e("tr",null,e("td",{class:"text-right pr-2"},t.is_exlusive?this.defaultTexts.entries.Lcz_Excluding:this.defaultTexts.entries.Lcz_Including," ",t.name),e("td",{class:"text-right"},t.currency.symbol,t.amount))))})())))),e("div",{key:"c6d286fac101ea23f61948f6165ac83fc3c8dcd3",class:"sm-mb-1",innerHTML:this.item.rateplan.cancelation||""}),e("div",{key:"f6e52be239914477d3f3aa73c77c9edc47eadc0c",class:"sm-mb-1",innerHTML:this.item.rateplan.guarantee||""}),this.bookingEvent.is_direct&&e("ir-label",{key:"b4aa8a75505630ee382fa8ee343c53be91012525",label:`${this.defaultTexts.entries.Lcz_MealPlan}:`,value:this.mealCodeName}))),e("ir-modal",{key:"31f3121c6f75c8c366720bc4960bcf474432189e",autoClose:false,ref:t=>this.irModalRef=t,isLoading:this.isLoading,onConfirmModal:this.deleteRoom.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:this.defaultTexts.entries.Lcz_Cancel,rightBtnText:this.defaultTexts.entries.Lcz_Delete,leftBtnColor:"secondary",rightBtnColor:"danger",modalTitle:this.defaultTexts.entries.Lcz_Confirmation,modalBody:`${this.defaultTexts.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${this.item.roomtype.name} ${this.item.unit?this.item.unit.name:""} ${this.defaultTexts.entries.Lcz_FromThisBooking}`}))}get element(){return a(this)}static get watchers(){return{bookingEvent:["handleBookingEventChange"]}}};V.style=G;export{C as ir_booking_details,T as ir_booking_extra_note,S as ir_dialog,$ as ir_guest_info,P as ir_label,N as ir_payment_details,F as ir_pickup,V as ir_room};
//# sourceMappingURL=p-96857812.entry.js.map