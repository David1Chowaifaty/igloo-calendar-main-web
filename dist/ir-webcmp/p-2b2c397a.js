import{a as t}from"./p-06203439.js";import{a as e,i as n,e as o,c as r,b as a,d as i}from"./p-4dc453f7.js";import{h as c}from"./p-6c4ba7c0.js";import{l as s}from"./p-806fad31.js";import{c as l}from"./p-4eb12235.js";import{c as u}from"./p-d3003ac0.js";const _={checkout_guest:null,guest:null,tax_statement:null,roomTypes:[],enableBooking:false,resetBooking:false,ratePlanSelections:{},isInFreeCancelationZone:false,bookingAvailabilityParams:{from_date:null,to_date:null,adult_nbr:0,child_nbr:0,infant_nbr:0},booking:null,fictus_booking_nbr:null,event_type:{type:"PLUS_BOOKING"}};let{state:d,onChange:E,reset:f}=l(_);function O(){f()}function T(t,e){var n;if(!t){return null}if(!e||d.resetBooking){return t[0]}return(n=t===null||t===void 0?void 0:t.find((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr)))!==null&&n!==void 0?n:null}E("roomTypes",(t=>{const e=d.ratePlanSelections;const n={};t.forEach((t=>{if(!t.is_active)return;n[t.id]=n[t.id]||{};t.rateplans.forEach((o=>{var r,a,i,c;if(!o.is_active||!((r=o===null||o===void 0?void 0:o.variations)===null||r===void 0?void 0:r.length))return;const s=(a=e[t.id])===null||a===void 0?void 0:a[o.id];n[t.id][o.id]=s&&Object.keys(s).length>0?Object.assign(Object.assign({},s),{ratePlan:o,selected_variation:(i=T(o.variations,s.selected_variation))!==null&&i!==void 0?i:null,visibleInventory:t.inventory,reserved:t.inventory===0?0:d.resetBooking?0:s.reserved,checkoutVariations:t.inventory===0?[]:s.checkoutVariations,checkoutBedSelection:t.inventory===0?[]:s.checkoutBedSelection,checkoutSmokingSelection:t.inventory===0?[]:s.checkoutSmokingSelection,guestName:t.inventory===0?[]:s.guestName,roomtype:Object.assign({},s.roomtype)}):{reserved:0,rp_amount:0,view_mode:"001",guest:null,visibleInventory:t.inventory,selected_variation:(c=o===null||o===void 0?void 0:o.variations[0])!==null&&c!==void 0?c:null,ratePlan:o,guestName:[],is_bed_configuration_enabled:t.is_bed_configuration_enabled,roomtype:Object.assign(Object.assign({},t),{physicalrooms:null,rateplans:null,availabilities:null}),checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[]}}))}));d.ratePlanSelections=n;d.resetBooking=false}));function b(t){const e=d.ratePlanSelections[t];const n=t=>Object.entries(e).reduce(((e,[n,o])=>Number(n)!==t?e+o.reserved:e),0);const o=Object.fromEntries(Object.entries(e).map((([e,o])=>{const r=n(Number(e));const a=d.roomTypes.find((e=>e.id===t));const i=a?a.inventory-r:0;return[e,Object.assign(Object.assign({},o),{visibleInventory:i>0?i:0})]})));if(JSON.stringify(e)!==JSON.stringify(o)){d.ratePlanSelections=Object.assign(Object.assign({},d.ratePlanSelections),{[t]:o})}}function v({ratePlanId:t,roomTypeId:e,params:n}){console.log(t,e,n);d.ratePlanSelections=Object.assign(Object.assign({},d.ratePlanSelections),{[Number(e)]:Object.assign(Object.assign({},d.ratePlanSelections[Number(e)]),{[t]:Object.assign(Object.assign({},d.ratePlanSelections[e][t]),n)})});console.log(d.ratePlanSelections)}function y({ratePlanId:t,roomTypeId:e,rooms:n,guest:o}){var r;if(!d.ratePlanSelections[e]){d.ratePlanSelections[e]={}}const a=(r=d.roomTypes)===null||r===void 0?void 0:r.find((t=>t.id===e));if(!a){throw new Error("Invalid room type id")}const i=a.rateplans.find((e=>e.id===t));if(!i){throw new Error("Invalid rate plan")}let c=Array.from({length:n},(()=>({name:"",unit:null,bed_preference:null,infant_nbr:null})));console.log("guest",o);if(o){c=o}console.log("newGuest",c);if(!d.ratePlanSelections[e][t]){console.log("new guest",c);d.ratePlanSelections[e][t]={guestName:null,reserved:0,view_mode:"001",rp_amount:0,guest:c,is_bed_configuration_enabled:a.is_bed_configuration_enabled,visibleInventory:0,selected_variation:null,ratePlan:i,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],roomtype:{id:a.id,name:a.name,physicalrooms:null,rateplans:null,availabilities:null,inventory:a.inventory,rate:a.rate,bedding_setup:a.bedding_setup,smoking_option:a.smoking_option,is_bed_configuration_enabled:a.is_bed_configuration_enabled}}}d.ratePlanSelections=Object.assign(Object.assign({},d.ratePlanSelections),{[Number(e)]:Object.assign(Object.assign({},d.ratePlanSelections[Number(e)]),{[t]:Object.assign(Object.assign({},d.ratePlanSelections[e][t]),{reserved:n,checkoutVariations:[],guest:c})})});b(e)}function h(t,e){if(!d.ratePlanSelections||!d.ratePlanSelections[t]){return{reserved:0,guest:null,visibleInventory:0,selected_variation:null,ratePlan:null,guestName:[],is_bed_configuration_enabled:false,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],rp_amount:0,view_mode:"001",roomtype:null}}return d.ratePlanSelections[t][e]}function m(t,e){d[t]=e}function w(){return Object.values(d.ratePlanSelections).reduce(((t,e)=>t+Object.values(e).reduce(((t,e)=>{if(e.reserved===0){return t}return t+e.reserved}),0)),0)}const D={days:[],months:[],fromDate:"",toDate:""};const{state:A,onChange:R}=l(D);async function p(t){const e=[];const n=await M();for(const o of t){for(const t of o.days){for(const o of t.room_types){g(o.physicalrooms,e,n)}}}return e}function g(t,e,n){for(const o of t){for(const t in o.calendar_cell){if(o.calendar_cell[t].Is_Available===false){B(o.calendar_cell[t],e,n)}}}}const N={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const I={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function S(t,e){if(t===null&&e===null)return"";if(e!==null&&e!==""){return`${t!==null&&t!==void 0?t:""} , ${e!==null&&e!==void 0?e:""}`}return t}async function M(){try{const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return e.My_Result.map((t=>({code:t.CODE_NAME,value:t.CODE_VALUE_EN})))}catch(t){console.log(t)}}function Y(t,e,n){const o=new Date(t);o.setHours(e);o.setMinutes(n);return`${s.entries.Lcz_BlockedTill} ${c(o).format("MMM DD, HH:mm")}`}function k(t,o){var r,a,i,s;if(n(t.STAY_STATUS_CODE)){const n=c(t.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.from_date:t.DATE;const r=c(t.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.to_date:t.DATE;return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.My_Block_Info.NOTES!==""?t.My_Block_Info.NOTES:t.STAY_STATUS_CODE==="003"?Y(t.My_Block_Info.BLOCKED_TILL_DATE,t.My_Block_Info.BLOCKED_TILL_HOUR,t.My_Block_Info.BLOCKED_TILL_MINUTE):o.find((e=>e.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.My_Block_Info.DESCRIPTION,PR_ID:t.My_Block_Info.pr_id,ENTRY_DATE:t.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:t.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.My_Block_Info.NOTES,FROM_DATE:n,TO_DATE:r,NO_OF_DAYS:e(n,r),STATUS:N[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.My_Block_Info.format.from_date,TO_DATE_STR:t.My_Block_Info.format.to_date,defaultDates:{from_date:t.My_Block_Info.from_date,to_date:t.My_Block_Info.to_date}}}if(t.booking.booking_nbr.toString()==="23080178267"){console.log("booking",t)}const l=c(t.room.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.from_date:t.DATE;const u=c(t.room.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.to_date:t.DATE;return{ID:t.POOL,FROM_DATE:l,TO_DATE:u,NO_OF_DAYS:e(l,u),STATUS:I[(r=t.booking)===null||r===void 0?void 0:r.status.code],NAME:S(t.room.guest.first_name,t.room.guest.last_name),IDENTIFIER:t.room.identifier,PR_ID:t.pr_id,POOL:t.POOL,BOOKING_NUMBER:t.booking.booking_nbr,NOTES:t.booking.is_direct?t.booking.remark:null,PRIVATE_NOTE:P(t.booking.extras),is_direct:t.booking.is_direct,BALANCE:(a=t.booking.financial)===null||a===void 0?void 0:a.due_amount,channel_booking_nbr:t.booking.channel_booking_nbr,ARRIVAL_TIME:t.booking.arrival.description,defaultDates:{from_date:t.room.from_date,to_date:t.room.to_date},ENTRY_DATE:t.booking.booked_on.date,PHONE_PREFIX:t.booking.guest.country_phone_prefix,IS_EDITABLE:t.booking.is_editable,ARRIVAL:t.booking.arrival,PHONE:(i=t.booking.guest.mobile)!==null&&i!==void 0?i:"",RATE:t.room.total,RATE_PLAN:t.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:t.room.rateplan.id,RATE_TYPE:1,ADULTS_COUNT:t.room.occupancy.adult_nbr,CHILDREN_COUNT:t.room.occupancy.children_nbr,origin:t.booking.origin,GUEST:t.booking.guest,ROOMS:t.booking.rooms,cancelation:t.room.rateplan.cancelation,guarantee:t.room.rateplan.guarantee,TOTAL_PRICE:(s=t.booking.financial)===null||s===void 0?void 0:s.gross_total,COUNTRY:t.booking.guest.country_id,FROM_DATE_STR:t.booking.format.from_date,TO_DATE_STR:t.booking.format.to_date,adult_child_offering:t.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:t.booking.source.code,description:t.booking.source.description,tag:t.booking.source.tag}}}function B(t,e,n){const o=e.findIndex((e=>e.POOL===t.POOL));if(o===-1){const o=k(t,n);e.push(o)}}function P(t){var e;if(!t){return null}return((e=t.find((t=>t.key==="private_note")))===null||e===void 0?void 0:e.value)||null}function C(t){let n=[];const o=e=>{const n=c();const o=c(e.to_date,"YYYY-MM-DD");const r=c(e.from_date,"YYYY-MM-DD");if(r.isSame(n,"day")&&n.hour()>=12){return I["000"]}else if(n.isAfter(r,"day")&&n.isBefore(o,"day")){return I["000"]}else if(o.isSame(n,"day")&&n.hour()<12){return I["000"]}else if(o.isSame(n,"day")&&n.hour()>=12||o.isBefore(n,"day")){return I["003"]}else{return I[(t===null||t===void 0?void 0:t.status.code)||"001"]}};const r=t.rooms.filter((t=>!!t["assigned_units_pool"]));r.forEach((r=>{var a,i,s;const l=c(r.from_date,"YYYY-MM-DD").isAfter(c(A.fromDate,"YYYY-MM-DD"))?r.from_date:A.fromDate;const u=r.to_date;console.log(`\n  bookingFromDate:${l},\n\n  roomFromDate:${r.from_date},\n\n  bookingToDate:${u},\n\n  roomToDate:${u}\n\n      `);if(c(r.to_date,"YYYY-MM-DD").isBefore(c(A.fromDate,"YYYY-MM-DD"))){return}n.push({ID:r["assigned_units_pool"],TO_DATE:u,FROM_DATE:l,PRIVATE_NOTE:P(t.extras),NO_OF_DAYS:e(l,u),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(a=t.financial)===null||a===void 0?void 0:a.due_amount,STATUS:o(r),NAME:S(r.guest.first_name,r.guest.last_name),PHONE:(i=t.guest.mobile)!==null&&i!==void 0?i:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:r.total,RATE_PLAN:r.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:r.rateplan.id,IDENTIFIER:r.identifier,RATE_TYPE:r.roomtype.id,ADULTS_COUNT:r.occupancy.adult_nbr,CHILDREN_COUNT:r.occupancy.children_nbr,PR_ID:+r.unit.id,POOL:r["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:r.rateplan.cancelation,guarantee:r.rateplan.guarantee,TOTAL_PRICE:(s=t.financial)===null||s===void 0?void 0:s.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:r.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:r.from_date,to_date:r.to_date}})}));return n}async function j(t){const e=await M();return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.NOTES!==""?t.NOTES:t.STAY_STATUS_CODE==="003"?Y(t.BLOCKED_TILL_DATE,t.BLOCKED_TILL_HOUR,t.BLOCKED_TILL_MINUTE):e.find((e=>e.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.DESCRIPTION,PR_ID:t.pr_id,ENTRY_DATE:t.BLOCKED_TILL_DATE,ENTRY_HOUR:t.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.NOTES,FROM_DATE:t.from_date,TO_DATE:t.to_date,NO_OF_DAYS:L(t.from_date,t.to_date),STATUS:N[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,defaultDates:{from_date:t.from_date,to_date:t.to_date}}}function L(t,e){const n=c(t,"YYYY-MM-DD");const o=c(e,"YYYY-MM-DD");const r=o.diff(n,"days");return r||1}var U=undefined&&undefined.__rest||function(t,e){var n={};for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0)n[o]=t[o];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++){if(e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r]))n[o[r]]=t[o[r]]}return n};class G{async getCalendarData(e,n,i){try{const{data:c}=await t.post(`/Get_Exposed_Calendar`,{propertyid:e,from_date:n,to_date:i,extras:o});if(c.ExceptionMsg!==""){throw new Error(c.ExceptionMsg)}const s=c.My_Result.months;const l=[];const u=await p(s);const _=s.map((t=>{l.push({daysCount:t.days.length,monthName:t.description});return t.days.map((e=>({day:r(e.description,t.description),currentDate:a(e.description,t.description),dayDisplayName:e.description,rate:e.room_types,unassigned_units_nbr:e.unassigned_units_nbr,occupancy:e.occupancy})))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:e,FROM:c.My_Params_Get_Exposed_Calendar.from_date,TO:c.My_Params_Get_Exposed_Calendar.to_date},days:_,months:l,myBookings:u,defaultMonths:s})}catch(t){console.error(t)}}async fetchGuest(e){try{const{data:n}=await t.post(`/Get_Exposed_Guest`,{email:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async changeExposedBookingStatus(e){try{const{data:n}=await t.post(`/Change_Exposed_Booking_Status`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){throw new Error(t)}}async fetchPMSLogs(e){try{const{data:n}=await t.post(`/Get_Exposed_PMS_Logs`,{booking_nbr:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async getExposedBookingEvents(e){try{const{data:n}=await t.post(`/Get_Exposed_Booking_Events`,{booking_nbr:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async editExposedGuest(e,n){try{const{data:o}=await t.post(`/Edit_Exposed_Guest`,Object.assign(Object.assign({},e),{book_nbr:n}));if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}catch(t){console.log(t);throw new Error(t)}}async getBookingAvailability(e){try{const{adultChildCount:n,currency:o}=e,r=U(e,["adultChildCount","currency"]);const{data:a}=await t.post(`/Check_Availability`,Object.assign(Object.assign({},r),{adult_nbr:n.adult,child_nbr:n.child,currency_ref:o.code,skip_getting_assignable_units:!u.is_frontdesk_enabled,is_backend:true}));if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}const i=this.modifyRateplans(this.sortRoomTypes(a["My_Result"],{adult_nbr:Number(n.adult),child_nbr:Number(n.child)}));d.roomTypes=[...i];d.tax_statement={message:a.My_Result.tax_statement};return i}catch(t){console.error(t);throw new Error(t)}}sortRoomTypes(t,e){return t.sort(((t,n)=>{var o,r,a,i;if(t.is_available_to_book&&!n.is_available_to_book)return-1;if(!t.is_available_to_book&&n.is_available_to_book)return 1;const c=(o=t.rateplans)===null||o===void 0?void 0:o.some((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.some((t=>t.discounted_amount===0||t.discounted_amount===null))}));const s=(r=n.rateplans)===null||r===void 0?void 0:r.some((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.some((t=>t.discounted_amount===0||t.discounted_amount===null))}));if(c&&!s)return 1;if(!c&&s)return-1;const l=(a=t.rateplans)===null||a===void 0?void 0:a.some((t=>{var n;return(n=t.variations)===null||n===void 0?void 0:n.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))}));const u=(i=n.rateplans)===null||i===void 0?void 0:i.some((t=>{var n;return(n=t.variations)===null||n===void 0?void 0:n.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))}));if(l&&!u)return-1;if(!l&&u)return 1;const _=Math.max(...t.rateplans.flatMap((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.map((t=>{var e;return(e=t.discounted_amount)!==null&&e!==void 0?e:0}))})));const d=Math.max(...n.rateplans.flatMap((t=>{var e;return(e=t.variations)===null||e===void 0?void 0:e.map((t=>{var e;return(e=t.discounted_amount)!==null&&e!==void 0?e:0}))})));if(_<d)return-1;if(_>d)return 1;return 0}))}modifyRateplans(t){return t===null||t===void 0?void 0:t.map((t=>{var e;return Object.assign(Object.assign({},t),{rateplans:(e=t.rateplans)===null||e===void 0?void 0:e.map((t=>{var e;return Object.assign(Object.assign({},t),{variations:this.sortVariations((e=t===null||t===void 0?void 0:t.variations)!==null&&e!==void 0?e:[])})}))})}))}sortVariations(t){return t.sort(((t,e)=>{if(t.adult_nbr!==e.adult_nbr){return e.adult_nbr-t.adult_nbr}return e.child_nbr-t.child_nbr}))}async getCountries(e){try{const{data:n}=await t.post(`/Get_Exposed_Countries`,{language:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.error(t);throw new Error(t)}}async getBedPreferences(){const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME`,{TBL_NAME:"_BED_PREFERENCE_TYPE"});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}const n=e.My_Result;return n}async fetchSetupEntries(){try{const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}const n=e.My_Result;return{arrivalTime:n.filter((t=>t.TBL_NAME==="_ARRIVAL_TIME")),ratePricingMode:n.filter((t=>t.TBL_NAME==="_RATE_PRICING_MODE")),bedPreferenceType:n.filter((t=>t.TBL_NAME==="_BED_PREFERENCE_TYPE"))}}catch(t){console.error(t);throw new Error(t)}}async doBookingExtraService({booking_nbr:e,service:n,is_remove:o}){const{data:r}=await t.post(`/Do_Booking_Extra_Service`,Object.assign(Object.assign({},n),{booking_nbr:e,is_remove:o}));if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}async getBlockedInfo(){try{const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:["_CALENDAR_BLOCKED_TILL"]});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}catch(t){console.error(t);throw new Error(t)}}async getUserDefaultCountry(){try{const{data:e}=await t.post(`/Get_Country_By_IP`,{IP:""});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async blockUnit(e){try{const{data:n}=await t.post(`/Block_Exposed_Unit`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}console.log(n);return n["My_Params_Block_Exposed_Unit"]}catch(t){console.error(t);throw new Error(t)}}async getUserInfo(e){try{const{data:n}=await t.post(`/GET_EXPOSED_GUEST`,{email:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.error(t);throw new Error(t)}}async getExposedBooking(e,n,r=true){try{const{data:a}=await t.post(`/Get_Exposed_Booking`,{booking_nbr:e,language:n,extras:r?o:null});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a.My_Result}catch(t){console.error(t)}}generateDays(t,e,n){const o=new Date(t);const r=new Date(e);const a=[];while(o<r){a.push({date:o.toISOString().split("T")[0],amount:n,cost:null});o.setDate(o.getDate()+1)}return a}calculateTotalRate(t,e,n,o){if(n&&o===2){return+t}return+t/+e}async fetchExposedGuest(e,n){try{const{data:o}=await t.post(`/Fetch_Exposed_Guests`,{email:e,property_id:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async fetchExposedBookings(e,n,o,r){try{const{data:a}=await t.post(`/Fetch_Exposed_Bookings`,{booking_nbr:e,property_id:n,from_date:o,to_date:r});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async getPCICardInfoURL(e){try{const{data:n}=await t.post(`/Get_PCI_Card_Info_URL`,{BOOK_NBR:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async doReservation(e){const{data:n}=await t.post(`/DoReservation`,Object.assign(Object.assign({},e),{extras:e.extras?e.extras:o}));if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}console.log(n["My_Result"]);return n["My_Result"]}async bookUser({bookedByInfoData:t,check_in:e,currency:n,extras:o=null,fromDate:r,guestData:a,pickup_info:c,propertyid:s,rooms:l,source:u,toDate:_,totalNights:d,arrivalTime:E,bookingNumber:f,defaultGuest:O,identifier:T,pr_id:b}){try{const v=i(r);const y=i(_);let h={email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.contactNumber===null?"":t.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:t.emailGuest||false,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null};if(O){h=Object.assign(Object.assign({},O),{email:O.email===""?null:O.email})}if(t.id){h=Object.assign(Object.assign({},h),{id:t.id})}const m={assign_units:true,check_in:e,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:o,booking:{booking_nbr:f||"",from_date:v,to_date:y,remark:t.message||null,property:{id:s},source:u,currency:n,arrival:{code:E?E:t.selectedArrivalTime},guest:h,rooms:[...a.map((t=>({identifier:T||null,roomtype:{id:t.roomCategoryId,name:t.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:t.inventory,rate:t.rate/d},rateplan:{id:t.ratePlanId,name:t.ratePlanName,rate_restrictions:null,variations:null,cancelation:t.cancelation,guarantee:t.guarantee},unit:typeof b==="undefined"&&t.roomId===""?null:{id:+b||+t.roomId},occupancy:{adult_nbr:t.adultCount,children_nbr:t.childrenCount,infant_nbr:null},bed_preference:t.preference,from_date:v,to_date:y,notes:null,days:this.generateDays(v,y,this.calculateTotalRate(t.rate,d,t.isRateModified,t.rateType)),guest:{email:null,first_name:t.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),...l]},pickup_info:c};console.log("book user payload",m)}catch(t){console.error(t);throw new Error(t)}}}export{G as B,w as a,d as b,L as c,O as d,P as e,S as f,h as g,A as h,j as i,I as j,m,y as r,C as t,v as u};
//# sourceMappingURL=p-2b2c397a.js.map