{"version":3,"names":["irFinancialActionsCss","IrFinancialActionsStyle0","IrFinancialActions","language","ticket","propertyid","p","isLoading","isPageLoading","property_id","sideBarEvent","tokenService","Token","roomService","RoomService","bookingService","BookingService","paymentEntries","componentWillLoad","this","setToken","initializeApp","ticketChanged","newValue","oldValue","handleSidebarClose","e","stopImmediatePropagation","stopPropagation","renderSidebarBody","type","h","slot","hasPrint","hasReceipt","hasCloseButton","onCloseSidebar","is_from_front_desk","hasRoomEdit","hasRoomDelete","bookingNumber","payload","toString","hasRoomAdd","payment","mode","onCloseModal","handleOpenSidebar","detail","getFinancialAction","isExportToExcel","console","log","propertyId","Error","propertyData","getExposedProperty","id","aname","is_backend","include_units_hk_status","My_Result","requests","getSetupEntriesByTableNameMulti","fetchLanguage","push","setupEntries","Promise","all","pay_type","pay_type_group","pay_method","groupEntryTablesResult","groups","methods","types","error","render","Host","class","style","gap","size","btn_color","text","locales","entries","Lcz_Export","onClickHandler","async","btnStyle","height","iconPosition","icon_name","icon_style","sidebarStyles","width","background","open","Boolean","showCloseButton","onIrSidebarToggle"],"sources":["src/components/ir-financial-actions/ir-financial-actions.css?tag=ir-financial-actions&encapsulation=scoped","src/components/ir-financial-actions/ir-financial-actions.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n.financial-actions__meta {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.daily-revenue__table {\n  flex: 1 1 0%;\n}\n\n/*sm*/\n@media (min-width: 768px) {\n  .financial-actions__meta {\n    flex-direction: row;\n  }\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { SidebarOpenEvent } from './types';\nimport locales from '@/stores/locales.store';\nimport { RoomService } from '@/services/room.service';\nimport { PaymentEntries } from '../ir-booking-details/types';\nimport { BookingService } from '@/services/booking-service/booking.service';\n\n@Component({\n  tag: 'ir-financial-actions',\n  styleUrl: 'ir-financial-actions.css',\n  scoped: true,\n})\nexport class IrFinancialActions {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isLoading: string;\n  @State() isPageLoading: boolean = true;\n  @State() property_id: number;\n  @State() sideBarEvent: SidebarOpenEvent | null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n  private paymentEntries: PaymentEntries;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.tokenService.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  private handleSidebarClose = (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = null;\n  };\n\n  private renderSidebarBody() {\n    if (!this.sideBarEvent) {\n      return;\n    }\n\n    switch (this.sideBarEvent.type) {\n      case 'booking':\n        return (\n          <ir-booking-details\n            slot=\"sidebar-body\"\n            hasPrint\n            hasReceipt\n            hasCloseButton\n            onCloseSidebar={this.handleSidebarClose}\n            is_from_front_desk\n            propertyid={this.property_id}\n            hasRoomEdit\n            hasRoomDelete\n            bookingNumber={this.sideBarEvent.payload.bookingNumber.toString()}\n            ticket={this.ticket}\n            language={this.language}\n            hasRoomAdd\n          ></ir-booking-details>\n        );\n      case 'payment':\n        return (\n          <ir-payment-folio\n            bookingNumber={this.sideBarEvent.payload?.bookingNumber?.toString()}\n            paymentEntries={this.paymentEntries}\n            slot=\"sidebar-body\"\n            payment={this.sideBarEvent.payload.payment}\n            mode={'new'}\n            onCloseModal={this.handleSidebarClose}\n          ></ir-payment-folio>\n        );\n      default:\n        return null;\n    }\n  }\n  @Listen('financialActionsOpenSidebar')\n  handleOpenSidebar(e: CustomEvent<SidebarOpenEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = e.detail;\n  }\n  private async getFinancialAction(isExportToExcel: boolean = false) {\n    console.log(isExportToExcel);\n  }\n  private async initializeApp() {\n    this.isPageLoading = true;\n\n    try {\n      let propertyId = this.propertyid;\n      if (!propertyId && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n\n      this.property_id = propertyId;\n\n      const requests: Promise<any>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getFinancialAction(),\n        this.roomService.fetchLanguage(this.language),\n      ];\n      if (propertyId) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [setupEntries] = await Promise.all(requests);\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Payment Actions</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getFinancialAction(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          {/* <ir-financial-summary\n          previousDateGroupedPayments={this.previousDateGroupedPayments}\n          groupedPayments={this.groupedPayment}\n          paymentEntries={this.paymentEntries}\n        ></ir-financial-summary> */}\n          <div class=\"financial-actions__meta\">\n            <ir-financial-filters isLoading={this.isLoading === 'filter'}></ir-financial-filters>\n            <ir-financial-table class={'financial-actions__table card  w-100'}></ir-financial-table>\n          </div>\n        </section>\n        <ir-sidebar\n          sidebarStyles={{\n            width: this.sideBarEvent?.type === 'booking' ? '80rem' : 'var(--sidebar-width,40rem)',\n            background: this.sideBarEvent?.type === 'booking' ? '#F2F3F8' : 'white',\n          }}\n          open={Boolean(this.sideBarEvent)}\n          showCloseButton={false}\n          onIrSidebarToggle={this.handleSidebarClose}\n        >\n          {this.renderSidebarBody()}\n        </ir-sidebar>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}