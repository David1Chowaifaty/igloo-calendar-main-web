{"version":3,"names":["ymdDate","z","string","regex","object","channel","property_id","number","int","nullable","balance_filter","filter_type","union","from","to","name","book_nbr","booking_status","userTypeCode","optional","affiliate_id","default","is_mpo_managed","boolean","is_mpo_used","is_for_mobile","is_combined_view","start_row","end_row","total_count","is_to_export","property_ids","array","initialState","channels","settlement_methods","statuses","types","token","rowCount","bookings","pagination","currentPage","totalPages","totalRecords","pageSize","showing","userSelection","moment","add","format","download_url","state","booking_listing","onChange","onBookingListingChange","createStore","initializeUserSelection","code","id","value","updateUserSelections","params","updateUserSelection","key","clamp","min","max","Math","calculateShowing","page","startRow","calculateTotalPages","ceil","getRowBounds","endRow","updatePaginationFromSelection","selection","nextPageSize","floor","setPaginationPage","nextPage","setPaginationPageSize","normalizedPageSize","BookingListingService","getExposedBookingsCriteria","data","axios","post","result","My_Result","getExposedBookings","options","rest","havePrivilege","isPrivilegedUser","extras","undefined","header","My_Params_Get_Exposed_Bookings","skipStore","append","exported_data_url","removeExposedBooking","booking_nbr","is_to_revover"],"sources":["src/stores/booking_listing.store.ts","src/services/booking_listing.service.ts"],"sourcesContent":["import { IExposedBookingsCriteria } from '@/models/IrBookingListing';\nimport { Booking } from '@/models/booking.dto';\nimport { createStore } from '@stencil/store';\nimport moment from 'moment';\nimport { z } from 'zod';\n\ninterface PaginationRange {\n  from: number;\n  to: number;\n}\n\nexport interface BookingListingPagination {\n  currentPage: number;\n  totalPages: number;\n  totalRecords: number;\n  pageSize: number;\n  showing: PaginationRange;\n}\n\nexport interface IBookingListingStore extends IExposedBookingsCriteria {\n  token: string;\n  userSelection: ExposedBookingsParams;\n  bookings: Booking[];\n  download_url: string | null;\n  rowCount: number;\n  balance_filter: { name: string; value: string }[];\n  pagination: BookingListingPagination;\n}\nconst ymdDate = z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, 'Expected date in YYYY-MM-DD format');\nexport const ExposedBookingsParamsSchema = z.object({\n  channel: z.string(),\n\n  // These are null in your initialState, so allow nulls\n  property_id: z.number().int().nullable(),\n  balance_filter: z.string().nullable(),\n  filter_type: z.union([z.number(), z.string()]).nullable(),\n\n  from: ymdDate,\n  to: ymdDate,\n\n  name: z.string(),\n  book_nbr: z.string(),\n  booking_status: z.string(),\n  userTypeCode: z.number().optional(),\n\n  // In the interface these were literal 0/false, but you treat them like values.\n  affiliate_id: z.number().int().default(0),\n  is_mpo_managed: z.boolean().default(false),\n  is_mpo_used: z.boolean().default(false),\n  is_for_mobile: z.boolean().default(false),\n  is_combined_view: z.boolean().default(false),\n\n  start_row: z.number().int(),\n  end_row: z.number().int(),\n  total_count: z.number().int(),\n\n  is_to_export: z.boolean(),\n\n  property_ids: z.array(z.number().int()).optional(),\n});\n\nexport type ExposedBookingsParams = z.infer<typeof ExposedBookingsParamsSchema>;\n\nconst initialState: IBookingListingStore = {\n  channels: [],\n  settlement_methods: [],\n  statuses: [],\n  types: [],\n  token: '',\n  rowCount: 10,\n  bookings: [],\n  balance_filter: [],\n  pagination: {\n    currentPage: 1,\n    totalPages: 0,\n    totalRecords: 0,\n    pageSize: 10,\n    showing: {\n      from: 0,\n      to: 0,\n    },\n  },\n  userSelection: {\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    to: moment().format('YYYY-MM-DD'),\n    channel: '',\n    balance_filter: null,\n    property_id: null,\n    start_row: 0,\n    end_row: 20,\n    total_count: 0,\n    filter_type: null,\n    name: '',\n    book_nbr: '',\n    booking_status: '',\n    affiliate_id: 0,\n    is_mpo_managed: false,\n    is_mpo_used: false,\n    is_for_mobile: false,\n    is_combined_view: false,\n    is_to_export: false,\n  },\n  download_url: null,\n};\n\nexport const { state: booking_listing, onChange: onBookingListingChange } = createStore<IBookingListingStore>(initialState);\nexport function initializeUserSelection() {\n  //booking_listing.channels[0].name\n  booking_listing.userSelection = {\n    ...booking_listing.userSelection,\n    channel: '',\n    booking_status: booking_listing.statuses[0].code,\n    filter_type: booking_listing.types[0].id,\n    book_nbr: '',\n    name: '',\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    to: moment().format('YYYY-MM-DD'),\n    start_row: 0,\n    end_row: booking_listing.rowCount,\n    balance_filter: booking_listing.balance_filter[0].value,\n  };\n}\nexport function updateUserSelections(params: Partial<ExposedBookingsParams>) {\n  booking_listing.userSelection = {\n    ...booking_listing.userSelection,\n    ...params,\n  };\n}\nexport function updateUserSelection(key: keyof ExposedBookingsParams, value: any) {\n  booking_listing.userSelection = {\n    ...booking_listing.userSelection,\n    [key]: value,\n  };\n}\n\nconst clamp = (value: number, min: number, max: number) => {\n  return Math.min(Math.max(value, min), max);\n};\n\nconst calculateShowing = (page: number, pageSize: number, totalRecords: number): PaginationRange => {\n  if (totalRecords === 0) {\n    return { from: 0, to: 0 };\n  }\n\n  const startRow = (page - 1) * pageSize;\n  return {\n    from: startRow + 1,\n    to: Math.min(startRow + pageSize, totalRecords),\n  };\n};\n\nconst calculateTotalPages = (totalRecords: number, pageSize: number) => {\n  if (totalRecords === 0) {\n    return 0;\n  }\n  return Math.ceil(totalRecords / pageSize);\n};\n\nconst getRowBounds = (page: number, pageSize: number) => {\n  const startRow = (page - 1) * pageSize;\n  return {\n    startRow,\n    endRow: startRow + pageSize,\n  };\n};\n\nexport function updatePaginationFromSelection(selection: ExposedBookingsParams) {\n  const nextPageSize = selection.end_row - selection.start_row || booking_listing.pagination.pageSize || booking_listing.rowCount;\n  const totalRecords = selection.total_count;\n  const totalPages = calculateTotalPages(totalRecords, nextPageSize);\n  const currentPage = totalPages === 0 ? 1 : Math.floor(selection.start_row / nextPageSize) + 1;\n\n  booking_listing.rowCount = nextPageSize;\n  booking_listing.pagination = {\n    ...booking_listing.pagination,\n    pageSize: nextPageSize,\n    currentPage,\n    totalPages,\n    totalRecords,\n    showing: calculateShowing(currentPage, nextPageSize, totalRecords),\n  };\n}\n\nexport function setPaginationPage(page: number) {\n  const pageSize = booking_listing.pagination.pageSize || booking_listing.rowCount;\n  const totalPages = booking_listing.pagination.totalPages || Math.max(calculateTotalPages(booking_listing.pagination.totalRecords, pageSize), 1);\n  const nextPage = clamp(page, 1, Math.max(totalPages, 1));\n  const { startRow, endRow } = getRowBounds(nextPage, pageSize);\n\n  updateUserSelections({\n    start_row: startRow,\n    end_row: endRow,\n  });\n\n  booking_listing.pagination = {\n    ...booking_listing.pagination,\n    currentPage: nextPage,\n    showing: calculateShowing(nextPage, pageSize, booking_listing.pagination.totalRecords),\n  };\n  return { startRow, endRow };\n}\n\nexport function setPaginationPageSize(pageSize: number) {\n  const normalizedPageSize = Math.max(pageSize, 1);\n  booking_listing.rowCount = normalizedPageSize;\n  const totalRecords = booking_listing.pagination.totalRecords;\n  const totalPages = calculateTotalPages(totalRecords, normalizedPageSize);\n  const nextPage = totalPages === 0 ? 1 : clamp(booking_listing.pagination.currentPage, 1, Math.max(totalPages, 1));\n  const { startRow, endRow } = getRowBounds(nextPage, normalizedPageSize);\n\n  booking_listing.pagination = {\n    ...booking_listing.pagination,\n    pageSize: normalizedPageSize,\n    currentPage: nextPage,\n    totalPages,\n    showing: calculateShowing(nextPage, normalizedPageSize, totalRecords),\n  };\n\n  updateUserSelections({\n    start_row: startRow,\n    end_row: endRow,\n  });\n  return { startRow, endRow };\n}\nexport default booking_listing;\n","import booking_listing, { ExposedBookingsParams, initializeUserSelection } from '@/stores/booking_listing.store';\nimport { extras, isPrivilegedUser } from '@/utils/utils';\nimport axios from 'axios';\n\nexport class BookingListingService {\n  public async getExposedBookingsCriteria(property_id: number) {\n    const { data } = await axios.post(`/Get_Exposed_Bookings_Criteria`, {\n      property_id,\n    });\n    const result = data.My_Result;\n    booking_listing.channels = result.channels;\n    booking_listing.settlement_methods = result.settlement_methods;\n    booking_listing.statuses = result.statuses;\n    booking_listing.types = result.types;\n    booking_listing.balance_filter = result.balance_filter;\n    initializeUserSelection();\n  }\n\n  public async getExposedBookings(params: ExposedBookingsParams, options?: { append?: boolean; skipStore?: boolean }) {\n    const { property_id, userTypeCode, channel, property_ids, ...rest } = params;\n    const havePrivilege = isPrivilegedUser(userTypeCode);\n    const { data } = await axios.post(`/Get_Exposed_Bookings`, {\n      ...rest,\n      extras,\n      property_id: havePrivilege ? undefined : property_id,\n      property_ids: havePrivilege ? property_ids : null,\n      channel: havePrivilege ? '' : channel,\n    });\n    const result = data.My_Result;\n    const header = data.My_Params_Get_Exposed_Bookings;\n    if (options?.skipStore) {\n      return result;\n    }\n    if (options?.append) {\n      booking_listing.bookings = [...booking_listing.bookings, ...result];\n    } else {\n      booking_listing.bookings = [...result];\n    }\n    booking_listing.userSelection = {\n      ...booking_listing.userSelection,\n      total_count: header.total_count,\n    };\n    booking_listing.download_url = header.exported_data_url;\n  }\n  public async removeExposedBooking(booking_nbr: string, is_to_revover: boolean) {\n    await axios.post(`/Remove_Exposed_Booking`, {\n      booking_nbr,\n      is_to_revover,\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]}