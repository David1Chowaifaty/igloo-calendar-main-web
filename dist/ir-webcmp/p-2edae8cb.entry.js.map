{"version":3,"names":["irGuestInfoCss","IrGuestInfoStyle0","sheetCss","IrGuestInfoStyle1","GuestInfo","language","headerShown","email","booking_nbr","ticket","isInSideBar","countries","guest","isLoading","autoValidate","closeSideBar","resetBookingEvt","toast","bookingService","BookingService","roomService","RoomService","token","Token","componentWillLoad","this","setToken","getToken","init","ticketChanged","newValue","oldValue","console","log","fetchedLocales","Promise","all","fetchGuest","getCountries","locales","entries","Object","keys","length","fetchLanguage","resolve","direction","mobile","mobile_without_prefix","error","handleInputChange","params","editGuest","editExposedGuest","emit","type","description","title","position","render","h","class","onSubmit","async","e","preventDefault","displayContext","label","Lcz_GuestDetails","Lcz_FirstName","name","value","first_name","required","onTextChange","detail","Lcz_LastName","last_name","Lcz_Email","Lcz_AlternativeEmail","alternative_email","country","find","c","id","country_id","Lcz_Country","onCountryChange","stopImmediatePropagation","stopPropagation","phone_prefix","country_phone_prefix","Lcz_MobilePhone","variant","notes","Lcz_PrivateNote","checked","subscribe_to_news_letter","onInput","target","Lcz_Newsletter","Fragment","btn_styles","text","Lcz_Save","onClickHandler","bind","isRequestPending","color","btn_color","Lcz_Cancel","btn_disabled","btn_type"],"sources":["src/components/ir-guest-info/ir-guest-info.css?tag=ir-guest-info&encapsulation=scoped","src/common/sheet.css?tag=ir-guest-info&encapsulation=scoped","src/components/ir-guest-info/ir-guest-info.tsx"],"sourcesContent":[".input-group-text {\n  min-width: 10rem;\n  text-align: left;\n}\n.mobilePrefixSelect {\n  border-right-width: 0;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n.mobilePrefixInput {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n\n/* custome checkbox */\n.check-container {\n  position: relative;\n  /* padding-left: 30px; */\n  cursor: pointer;\n  font-size: 14px;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  display: flex;\n  align-items: center;\n}\n.check-container input {\n  position: relative;\n  opacity: 0;\n  cursor: pointer;\n  height: 0;\n  width: 0;\n}\n.check-container .checkmark {\n  position: relative;\n  top: 0;\n  left: 0;\n  height: 20px;\n  width: 20px;\n  border: 1px solid #cacfe7;\n  border-radius: 4px;\n  transition: all 0.3s ease;\n}\n.check-container input:checked ~ .checkmark {\n  background-color: #1e9ff2;\n  border-color: #1e9ff2;\n}\n.checkmark:after {\n  content: '';\n  position: absolute;\n  display: none;\n}\n.check-container input:checked ~ .checkmark:after {\n  display: block;\n}\n.check-label {\n  margin-left: 10px !important;\n}\n.check-container .checkmark:after {\n  left: 6px;\n  top: 3px;\n  width: 6px;\n  height: 10px;\n  border: solid white;\n  border-width: 0 2px 2px 0;\n  -webkit-transform: rotate(45deg);\n  -ms-transform: rotate(45deg);\n  transform: rotate(45deg);\n}\n.ir-card-header {\n  width: 100%;\n  border-bottom: 1px solid #e4e5ec;\n}\n.close-icon {\n  margin: 0;\n}\n.border-theme {\n  border: 1px solid #cacfe7;\n}\n.loading-container {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 0;\n  padding: 0;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { Component, State, h, Prop, EventEmitter, Event, Watch, Fragment } from '@stencil/core';\nimport { Guest } from '@/models/booking.dto';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { ICountry } from '@/components';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport Token from '@/models/Token';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport { IToast } from '@components/ui/ir-toast/toast';\n\n@Component({\n  tag: 'ir-guest-info',\n  styleUrls: ['ir-guest-info.css', '../../common/sheet.css'],\n  scoped: true,\n})\nexport class GuestInfo {\n  @Prop() language: string;\n  @Prop() headerShown: boolean;\n  @Prop() email: string;\n  @Prop() booking_nbr: string;\n  @Prop() ticket: string;\n  @Prop() isInSideBar: boolean;\n\n  @State() countries: ICountry[];\n  // @State() submit: boolean = false;\n  @State() guest: Guest | null = null;\n  @State() isLoading: boolean = true;\n  @State() autoValidate = false;\n\n  @Event() closeSideBar: EventEmitter<null>;\n  @Event({ bubbles: true }) resetBookingEvt: EventEmitter<null>;\n  @Event() toast: EventEmitter<IToast>;\n\n  private bookingService = new BookingService();\n  private roomService = new RoomService();\n  private token: Token = new Token();\n\n  async componentWillLoad() {\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n    }\n    if (!!this.token.getToken()) this.init();\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.init();\n  }\n\n  async init() {\n    try {\n      console.log('first');\n      this.isLoading = true;\n      const [guest, countries, fetchedLocales] = await Promise.all([\n        this.bookingService.fetchGuest(this.email),\n        this.bookingService.getCountries(this.language),\n        !locales || !locales.entries || Object.keys(locales.entries).length === 0 ? this.roomService.fetchLanguage(this.language) : Promise.resolve(null), // Skip fetching if locales are already set\n      ]);\n\n      // Set the fetched locales if they were fetched\n      if (fetchedLocales) {\n        locales.entries = fetchedLocales.entries;\n        locales.direction = fetchedLocales.direction;\n      }\n\n      // Assign the fetched guest and countries\n      this.countries = countries;\n      this.guest = { ...guest, mobile: guest.mobile_without_prefix };\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  private handleInputChange(params: Partial<Guest>) {\n    this.guest = { ...this.guest, ...params };\n  }\n\n  private async editGuest() {\n    try {\n      this.autoValidate = true;\n\n      await this.bookingService.editExposedGuest(this.guest, this.booking_nbr ?? null);\n      this.toast.emit({\n        type: 'success',\n        description: '',\n        title: 'Saved Successfully',\n        position: 'top-right',\n      });\n      this.closeSideBar.emit(null);\n      this.resetBookingEvt.emit(null);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  render() {\n    if (this.isLoading && this.isInSideBar) {\n      <div class={'loading-container'}>\n        <ir-spinner></ir-spinner>\n      </div>;\n    }\n    if (this.isLoading) {\n      return null;\n    }\n    return (\n      <form\n        class={'p-0 sheet-container'}\n        onSubmit={async e => {\n          e.preventDefault();\n          await this.editGuest();\n        }}\n      >\n        {!this.isInSideBar && [<ir-toast></ir-toast>, <ir-interceptor></ir-interceptor>]}\n        {this.headerShown && <ir-title class=\"px-1 sheet-header\" displayContext=\"sidebar\" label={locales.entries.Lcz_GuestDetails}></ir-title>}\n        <div class={this.isInSideBar ? 'sheet-body' : 'card-content collapse show '}>\n          <div class={this.headerShown ? 'card-body px-1 pt-0' : 'pt-0'}>\n            <ir-input-text\n              autoValidate={this.autoValidate}\n              label={locales.entries?.Lcz_FirstName}\n              name=\"firstName\"\n              // submitted={this.submit}\n              value={this.guest?.first_name}\n              required\n              onTextChange={e => this.handleInputChange({ first_name: e.detail })}\n            ></ir-input-text>\n            <ir-input-text\n              autoValidate={this.autoValidate}\n              label={locales.entries?.Lcz_LastName}\n              name=\"lastName\"\n              // submitted={this.submit}\n              value={this.guest?.last_name}\n              required\n              onTextChange={e => this.handleInputChange({ last_name: e.detail })}\n            ></ir-input-text>\n            <ir-input-text\n              label={locales.entries?.Lcz_Email}\n              name=\"email\"\n              // submitted={this.submit}\n              value={this.guest?.email}\n              required\n              onTextChange={e => this.handleInputChange({ email: e.detail })}\n            ></ir-input-text>\n            <ir-input-text\n              label={locales.entries?.Lcz_AlternativeEmail}\n              name=\"altEmail\"\n              value={this.guest?.alternative_email}\n              onTextChange={e => this.handleInputChange({ alternative_email: e.detail })}\n            ></ir-input-text>\n            {/* <ir-input-text label=\"Password\" placeholder=\"\" name=\"password\" submited={this.submit} type=\"password\" value={this.Model.password} required></ir-input-text> */}\n            {/* <ir-select\n              selectContainerStyle=\"mb-1\"\n              required\n              name=\"country\"\n              submited={this.submit}\n              label={locales.entries.Lcz_Country}\n              selectedValue={this.guest?.country_id?.toString() ?? ''}\n              data={this.countries?.map(item => {\n                return {\n                  value: item.id.toString(),\n                  text: item.name,\n                };\n              })}\n              firstOption={'...'}\n              onSelectChange={e => this.handleInputChange({ country_id: e.detail })}\n            ></ir-select> */}\n            <ir-country-picker\n              // error={this.submit && !this.guest.country_id}\n              country={this.countries.find(c => c.id === this.guest.country_id)}\n              label={locales.entries?.Lcz_Country}\n              onCountryChange={e => this.handleInputChange({ country_id: e.detail.id })}\n              countries={this.countries}\n            ></ir-country-picker>\n\n            <ir-phone-input\n              onTextChange={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                const { mobile, phone_prefix } = e.detail;\n                if (mobile !== this.guest.mobile) {\n                  this.handleInputChange({ mobile });\n                }\n                if (phone_prefix !== this.guest.country_phone_prefix) this.handleInputChange({ country_phone_prefix: phone_prefix });\n              }}\n              phone_prefix={this.guest.country_phone_prefix}\n              value={this.guest.mobile}\n              language={this.language}\n              label={locales.entries?.Lcz_MobilePhone}\n              countries={this.countries}\n            />\n            <div class=\"mb-2\">\n              <ir-textarea\n                variant=\"prepend\"\n                onTextChange={e => this.handleInputChange({ notes: e.detail })}\n                value={this.guest?.notes}\n                label={locales.entries?.Lcz_PrivateNote}\n              ></ir-textarea>\n            </div>\n            <div class={'p-0 m-0'}>\n              <label class={`check-container m-0 p-0`}>\n                <input\n                  class={'m-0 p-0'}\n                  type=\"checkbox\"\n                  name=\"newsletter\"\n                  checked={this.guest.subscribe_to_news_letter}\n                  onInput={e => this.handleInputChange({ subscribe_to_news_letter: (e.target as HTMLInputElement).checked })}\n                />\n                <span class=\"checkmark m-0 p-0\"></span>\n                <span class={'m-0 p-0  check-label'}>{locales.entries.Lcz_Newsletter}</span>\n              </label>\n              {!this.isInSideBar && (\n                <Fragment>\n                  <hr />\n                  <ir-button\n                    btn_styles=\"d-flex align-items-center justify-content-center\"\n                    text={locales.entries.Lcz_Save}\n                    onClickHandler={this.editGuest.bind(this)}\n                    isLoading={isRequestPending('/Edit_Exposed_Guest')}\n                    color=\"btn-primary\"\n                  ></ir-button>\n                </Fragment>\n              )}\n            </div>\n          </div>\n        </div>\n        {this.isInSideBar && (\n          <div class={'sheet-footer'}>\n            <ir-button\n              data-testid=\"cancel\"\n              onClickHandler={() => this.closeSideBar.emit(null)}\n              class=\"flex-fill m-0 p-0\"\n              btn_styles=\"w-100 m-0  justify-content-center align-items-center\"\n              btn_color=\"secondary\"\n              text={locales.entries.Lcz_Cancel}\n            ></ir-button>\n            <ir-button\n              data-testid=\"save\"\n              isLoading={isRequestPending('/Edit_Exposed_Guest')}\n              btn_disabled={this.isLoading}\n              class=\"flex-fill m-0\"\n              btn_type=\"submit\"\n              btn_styles=\"w-100 m-0  justify-content-center align-items-center\"\n              text={locales.entries.Lcz_Save}\n            ></ir-button>\n          </div>\n        )}\n      </form>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}