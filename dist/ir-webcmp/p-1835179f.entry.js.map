{"version":3,"names":["irOptionDetailsCss","IrOptionDetailsStyle0","IrOptionDetails","this","paymentOptionService","PaymentOptionService","componentWillLoad","setToken","payment_option_store","token","languages","result","GetExposedLanguages","selectedLanguage","id","toString","localizationIdx","selectedOption","code","localizables","findIndex","l","language","saveOption","e","preventDefault","stopPropagation","stopImmediatePropagation","Object","assign","property_id","propertyId","is_active","mode","englishDescription","_a","find","toLowerCase","description","console","log","trim","invalid","is_payment_gateway","display_order","hasInvalidData","data","some","d","value","HandlePaymentMethod","toast","emit","type","title","locales","entries","Lcz_Saved","position","closeModal","handleSelectChange","detail","handleTextAreaChange","oldLocalizables","handlePaymentGatewayInfoChange","idx","prevData","render","h","Host","class","onSubmit","bind","selectedValue","LabelAvailable","showFirstOption","map","text","Lcz_YouMustFillEnglishField","placeholder","textareaClassname","label","onTextChange","_b","key","labelWidth","onClick","btn_styles","icon","Lcz_Cancel","btn_color","btn_type","isLoading","isRequestPending","Lcz_Save"],"sources":["src/components/ir-payment-option/ir-option-details/ir-option-details.css?tag=ir-option-details&encapsulation=scoped","src/components/ir-payment-option/ir-option-details/ir-option-details.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}\r\n.money-transfer-form {\r\n  min-height: 200px !important;\r\n}\r\n","import { PaymentOption } from '@/models/payment-options';\r\nimport { PaymentOptionService } from '@/services/payment_option.service';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport payment_option_store from '@/stores/payment-option.store';\r\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, h } from '@stencil/core';\r\nimport { IToast } from '../../ir-toast/toast';\r\nimport locales from '@/stores/locales.store';\r\n@Component({\r\n  tag: 'ir-option-details',\r\n  styleUrl: 'ir-option-details.css',\r\n  scoped: true,\r\n})\r\nexport class IrOptionDetails {\r\n  @Prop() propertyId: string;\r\n\r\n  @State() localizationIdx: number;\r\n  @State() selectedLanguage: string = null;\r\n  @State() invalid: boolean = false;\r\n\r\n  @Event() closeModal: EventEmitter<PaymentOption | null>;\r\n  @Event() toast: EventEmitter<IToast>;\r\n\r\n  private paymentOptionService = new PaymentOptionService();\r\n\r\n  async componentWillLoad() {\r\n    this.paymentOptionService.setToken(payment_option_store.token);\r\n    if (!payment_option_store.languages) {\r\n      const result = await this.paymentOptionService.GetExposedLanguages();\r\n      payment_option_store.languages = result;\r\n    }\r\n    this.selectedLanguage = payment_option_store.languages[0].id.toString();\r\n    this.localizationIdx =\r\n      payment_option_store.selectedOption.code === '005'\r\n        ? payment_option_store.selectedOption.localizables.findIndex(l => l.language.id.toString() === this.selectedLanguage)\r\n        : null;\r\n  }\r\n\r\n  async saveOption(e: Event) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n\r\n    let selectedOption: PaymentOption = {\r\n      ...payment_option_store.selectedOption,\r\n      property_id: this.propertyId,\r\n      is_active: payment_option_store.mode === 'create' ? true : payment_option_store.selectedOption.is_active,\r\n    };\r\n\r\n    if (selectedOption?.code === '005') {\r\n      const englishDescription = selectedOption.localizables.find(l => l.language.code.toLowerCase() === 'en')?.description;\r\n      console.log(englishDescription);\r\n      // Check if the description is null or empty\r\n      if (!englishDescription || englishDescription.trim() === '') {\r\n        this.selectedLanguage = payment_option_store.languages.find(l => l.code.toLowerCase() === 'en').id.toString();\r\n        this.localizationIdx = payment_option_store.selectedOption.localizables.findIndex(l => l.language.id.toString() === this.selectedLanguage);\r\n        this.invalid = true;\r\n        return;\r\n      }\r\n    }\r\n    if (selectedOption.is_payment_gateway) {\r\n      selectedOption.display_order = 0;\r\n      // Check if any value in selectedOption.data is null or empty\r\n      const hasInvalidData = selectedOption.data.some(d => !d.value || d.value === '');\r\n      if (hasInvalidData) {\r\n        this.invalid = true;\r\n        return;\r\n      }\r\n    }\r\n\r\n    await this.paymentOptionService.HandlePaymentMethod(selectedOption);\r\n    this.toast.emit({\r\n      type: 'success',\r\n      description: '',\r\n      title: locales.entries.Lcz_Saved,\r\n      position: 'top-right',\r\n    });\r\n    this.closeModal.emit(selectedOption);\r\n  }\r\n\r\n  @Listen('selectChange')\r\n  handleSelectChange(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    this.selectedLanguage = e.detail;\r\n    this.localizationIdx =\r\n      payment_option_store.selectedOption.code === '005'\r\n        ? payment_option_store.selectedOption.localizables.findIndex(l => l.language.id.toString() === this.selectedLanguage)\r\n        : null;\r\n  }\r\n\r\n  private handleTextAreaChange(e: CustomEvent) {\r\n    const value = e.detail;\r\n    if (value.trim() !== '' && this.invalid) {\r\n      this.invalid = false;\r\n    }\r\n    const oldLocalizables = [...payment_option_store.selectedOption.localizables];\r\n    oldLocalizables[this.localizationIdx] = {\r\n      ...oldLocalizables[this.localizationIdx],\r\n      description: value,\r\n    };\r\n    payment_option_store.selectedOption = {\r\n      ...payment_option_store.selectedOption,\r\n      localizables: oldLocalizables,\r\n    };\r\n  }\r\n  private handlePaymentGatewayInfoChange(e: CustomEvent, idx: number): void {\r\n    const value = e.detail;\r\n    const prevData = [...payment_option_store.selectedOption.data];\r\n    prevData[idx] = { ...prevData[idx], value };\r\n    payment_option_store.selectedOption = {\r\n      ...payment_option_store.selectedOption,\r\n      data: prevData,\r\n    };\r\n  }\r\n  render() {\r\n    if (!payment_option_store.selectedOption) {\r\n      return null;\r\n    }\r\n    return (\r\n      <Host>\r\n        <form class={'p-1 mt-2'} onSubmit={this.saveOption.bind(this)}>\r\n          {payment_option_store.selectedOption.code === '005' ? (\r\n            <div>\r\n              <div class=\"mb-1\">\r\n                <ir-select\r\n                  selectedValue={this.selectedLanguage}\r\n                  LabelAvailable={false}\r\n                  showFirstOption={false}\r\n                  data={payment_option_store.languages.map(l => ({\r\n                    text: l.description,\r\n                    value: l.id.toString(),\r\n                  }))}\r\n                ></ir-select>\r\n              </div>\r\n              <div>\r\n                {this.invalid && <p class=\"text-danger p-0 m-0\">{locales.entries.Lcz_YouMustFillEnglishField}</p>}\r\n                <ir-textarea\r\n                  placeholder=\"\"\r\n                  aria-invalid={this.invalid ? 'true' : 'false'}\r\n                  textareaClassname=\"money-transfer-form\"\r\n                  label=\"\"\r\n                  onTextChange={this.handleTextAreaChange.bind(this)}\r\n                  value={payment_option_store.selectedOption.localizables[this.localizationIdx].description ?? ''}\r\n                ></ir-textarea>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <div>\r\n              {payment_option_store.selectedOption.data?.map((d, idx) => {\r\n                return (\r\n                  <fieldset key={d.key}>\r\n                    <ir-input-text\r\n                      value={d.value}\r\n                      onTextChange={e => this.handlePaymentGatewayInfoChange(e, idx)}\r\n                      id={`input_${d.key}`}\r\n                      label={d.key}\r\n                      placeholder=\"\"\r\n                      labelWidth={4}\r\n                      aria-invalid={this.invalid && (d.value === null || (d.value ?? '')?.trim() === '') ? 'true' : 'false'}\r\n                    ></ir-input-text>\r\n                  </fieldset>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n          <div class={'d-flex flex-column flex-sm-row mt-3'}>\r\n            <ir-button\r\n              onClick={() => this.closeModal.emit(null)}\r\n              btn_styles=\"justify-content-center\"\r\n              class={`mb-1 mb-sm-0 flex-fill mr-sm-1`}\r\n              icon=\"\"\r\n              text={locales.entries.Lcz_Cancel}\r\n              btn_color=\"secondary\"\r\n              btn_type=\"button\"\r\n            ></ir-button>\r\n\r\n            <ir-button\r\n              btn_type=\"submit\"\r\n              btn_styles=\"justify-content-center align-items-center\"\r\n              class={'m-0 flex-fill text-center'}\r\n              icon=\"\"\r\n              isLoading={isRequestPending('/Handle_Payment_Method')}\r\n              text={locales.entries.Lcz_Save}\r\n              btn_color=\"primary\"\r\n            ></ir-button>\r\n          </div>\r\n        </form>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}