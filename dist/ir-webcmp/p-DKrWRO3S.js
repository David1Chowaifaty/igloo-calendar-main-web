import{h as n}from"./p-Mki5YqAR.js";import{l as t}from"./p-DeW5X45W.js";import{a as o}from"./p-BSI30sps.js";import{l as e}from"./p-DRfRlSCW.js";import{c as s}from"./p-vROPuQAY.js";import{c as i}from"./p-CT3GgrvE.js";function a(t,o){const e=`${t.split(" ")[1]} ${o}`;const s=n(e,"DD MMM YYYY");if(!s.isValid()){throw new Error("Invalid Date")}return s.format("D_M_YYYY")}function r(t,o){const e=n(t+" "+o,"ddd DD MMM YYYY").toDate();e.setHours(0,0,0,0);return e.getTime()}function c(n,t){const o=new Date(n);const e=new Date(t);return Math.ceil((e.getTime()-o.getTime())/(1e3*60*60*24))}function u(n){const t=n.getFullYear();const o=(n.getMonth()+1).toString().padStart(2,"0");const e=n.getDate().toString().padStart(2,"0");return`${t}-${o}-${e}`}function _(n){let t={};const o={"IN-HOUSE":{id:1,clsName:"IN_HOUSE"},CONFIRMED:{id:2,clsName:"CONFIRMED"},"PENDING-CONFIRMATION":{id:3,clsName:"PENDING_CONFIRMATION"},"SPLIT-UNIT":{id:4,clsName:"SPLIT_UNIT"},"CHECKED-IN":{id:5,clsName:"CHECKED_IN"},"CHECKED-OUT":{id:5,clsName:"CHECKED_OUT"},BLOCKED:{id:6,clsName:"BLOCKED"},"BLOCKED-WITH-DATES":{id:7,clsName:"BLOCKED_WITH_DATES"},NOTES:{id:8,clsName:"NOTES"},"OUTSTANDING-BALANCE":{id:9,clsName:"OUTSTANDING_BALANCE"},"TEMP-EVENT":{id:10,clsName:"PENDING_CONFIRMATION"}};n.forEach((n=>{t[n.id]=n;t.statusId=o}));return t}function E(n){return["003","002","004"].includes(n)}const D=(n,t)=>t.find((t=>t.id===n));function d(n){const t=new Date;const o=n;t.setHours(t.getHours()+o,t.getMinutes(),0,0);return{BLOCKED_TILL_DATE:u(t),BLOCKED_TILL_HOUR:t.getHours().toString(),BLOCKED_TILL_MINUTE:t.getMinutes().toString()}}function T(t,o){const e=n(t,"D_M_YYYY");e.add(o,"days");return e.format("YYYY-MM-DD")}function l(t){const o=n(t,"D_M_YYYY");return o.format("YYYY-MM-DD")}function O(t){return n(t).add(2,"months").format("YYYY-MM-DD")}function Y(t,o="DD MMM YYYY"){const e=n(t,o).format("ddd, DD MMM YYYY");return e}function N(t){return n(t).add(1,"days").format("YYYY-MM-DD")}function f(t){return n(t,"YYYY-MM-DD").format("DD/MM ddd")}function A(t,o){let e=[];let s=n.min(n(t).add(1,"days"),n(o));let i=n.max(n(t),n(o));while(s<i){e.push(s.format("YYYY-MM-DD"));s=s.clone().add(1,"days")}return e}function M(n){return n<10?n.toString().padStart(2,"0"):n.toString()}function R(n){if(n===""){return true}const o=t.z.string().email().safeParse(n);return!o.success}function I(n,t){return n+" "+t.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}const S=[{key:"private_note",value:""},{key:"is_backend",value:true},{key:"ERROR_EMAIL",value:""},{key:"agent_payment_mode",value:""},{key:"payment_code",value:""}];function v(n,t="add"){const o=JSON.parse(sessionStorage.getItem("backend_anchor"));if(o){if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify(Object.assign(Object.assign({},o),n)))}else if(t==="remove"){const t=Object.keys(n);t.forEach((n=>{if(n in o){delete o[n]}}));return sessionStorage.setItem("backend_anchor",JSON.stringify(o))}}else{if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify(Object.assign({},n)))}}}function C(){const n=JSON.parse(sessionStorage.getItem("backend_anchor"));if(n){return n.login||null}return null}function L({from_date:t,to_date:o,isCheckedIn:e}){var s,a;if(!i.checkin_enabled||i.is_automatic_check_in_out){return false}if(e){return false}const r=n();if(n().isSameOrAfter(new Date(t),"days")&&n().isBefore(new Date(o),"days")||n().isSame(new Date(o),"days")&&!$(r.toDate(),W((s=i.checkin_checkout_hours)===null||s===void 0?void 0:s.offset,(a=i.checkin_checkout_hours)===null||a===void 0?void 0:a.hour))){return true}return false}function m(n,t){const o=document.createElement("a");o.href=n;o.download=n;document.body.appendChild(o);o.click();document.body.removeChild(o)}const U={days:[],months:[],fromDate:"",toDate:""};const{state:P}=s(U);async function y(n){const t=[];const o=await g();for(const e of n){for(const n of e.days){for(const e of n.room_types){F(e.physicalrooms,t,o)}}}return t}function F(n,t,o){for(const e of n){for(const n in e.calendar_cell){if(e.calendar_cell[n].Is_Available===false){w(e.calendar_cell[n],t,o)}}}}const B={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const H={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function p(n,t){if(n===null&&t===null)return"";if(t!==null&&t!==""){return`${n!==null&&n!==void 0?n:""} , ${t!==null&&t!==void 0?t:""}`}return n}async function g(){try{const{data:n}=await o.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return n.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}catch(n){console.log(n)}}function K(t,o,s){const i=new Date(t);i.setHours(o);i.setMinutes(s);return`${e.entries.Lcz_BlockedTill} ${n(i).format("MMM DD, HH:mm")}`}function h(t,o){var e,s,i,a,r,u,_,D,d,T;if(E(t.STAY_STATUS_CODE)){const e=n(t.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.from_date:t.DATE;const s=n(t.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.to_date:t.DATE;return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.My_Block_Info.NOTES!==""?t.My_Block_Info.NOTES:t.STAY_STATUS_CODE==="003"?K(t.My_Block_Info.BLOCKED_TILL_DATE,t.My_Block_Info.BLOCKED_TILL_HOUR,t.My_Block_Info.BLOCKED_TILL_MINUTE):o.find((n=>n.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.My_Block_Info.DESCRIPTION,PR_ID:t.My_Block_Info.pr_id,ENTRY_DATE:t.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:t.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.My_Block_Info.NOTES,FROM_DATE:e,TO_DATE:s,NO_OF_DAYS:c(e,s),STATUS:B[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.My_Block_Info.format.from_date,TO_DATE_STR:t.My_Block_Info.format.to_date,defaultDates:{from_date:t.My_Block_Info.from_date,to_date:t.My_Block_Info.to_date}}}if(t.booking.booking_nbr.toString()==="77054273380"){console.log("booking",t)}const l=n(t.room.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.from_date:t.DATE;const O=n(t.room.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.to_date:t.DATE;const Y=(e=t.room.sharing_persons)===null||e===void 0?void 0:e.find((n=>n.is_main));return{ID:t.POOL,FROM_DATE:l,TO_DATE:O,NO_OF_DAYS:c(l,O),STATUS:H[(s=t.booking)===null||s===void 0?void 0:s.status.code],NAME:p(Y===null||Y===void 0?void 0:Y.first_name,Y.last_name),IDENTIFIER:t.room.identifier,PR_ID:t.pr_id,POOL:t.POOL,BOOKING_NUMBER:t.booking.booking_nbr,NOTES:t.booking.is_direct?t.booking.remark:null,PRIVATE_NOTE:b(t.booking.extras),is_direct:t.booking.is_direct,BALANCE:(i=t.booking.financial)===null||i===void 0?void 0:i.due_amount,channel_booking_nbr:t.booking.channel_booking_nbr,ARRIVAL_TIME:t.booking.arrival.description,defaultDates:{from_date:t.room.from_date,to_date:t.room.to_date},ENTRY_DATE:t.booking.booked_on.date,PHONE_PREFIX:t.booking.guest.country_phone_prefix,IS_EDITABLE:t.booking.is_editable,ARRIVAL:t.booking.arrival,PHONE:(a=t.booking.guest.mobile_without_prefix)!==null&&a!==void 0?a:"",RATE:t.room.total,RATE_PLAN:t.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:t.room.rateplan.id,RATE_TYPE:(u=(r=t.room)===null||r===void 0?void 0:r.roomtype)===null||u===void 0?void 0:u.id,ADULTS_COUNT:t.room.occupancy.adult_nbr,CHILDREN_COUNT:t.room.occupancy.children_nbr,origin:t.booking.origin,GUEST:t.booking.guest,ROOMS:t.booking.rooms,cancelation:t.room.rateplan.cancelation,guarantee:t.room.rateplan.guarantee,TOTAL_PRICE:(_=t.booking.financial)===null||_===void 0?void 0:_.gross_total,COUNTRY:t.booking.guest.country_id,FROM_DATE_STR:t.booking.format.from_date,TO_DATE_STR:t.booking.format.to_date,adult_child_offering:t.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:t.booking.source.code,description:t.booking.source.description,tag:t.booking.source.tag},CHECKIN:((D=t.room.in_out)===null||D===void 0?void 0:D.code)==="001",CHECKOUT:((d=t.room.in_out)===null||d===void 0?void 0:d.code)==="002",ROOM_INFO:{occupancy:t.room.occupancy,sharing_persons:t.room.sharing_persons,unit:t.room.unit,in_out:t.room.in_out},BASE_STATUS_CODE:(T=t.booking.status)===null||T===void 0?void 0:T.code}}function k(t){var o,e,s,a;const{in_out:r,status_code:c,from_date:u,to_date:_}=t;if(i.checkin_enabled){if((r===null||r===void 0?void 0:r.code)==="001"){return H["000"]}else if((r===null||r===void 0?void 0:r.code)==="002"){if(!i.is_automatic_check_in_out){const t=n();const s=n(_,"YYYY-MM-DD");const a=n(u,"YYYY-MM-DD");const r=$(t.toDate(),W((o=i.checkin_checkout_hours)===null||o===void 0?void 0:o.offset,(e=i.checkin_checkout_hours)===null||e===void 0?void 0:e.hour));if(t.isSame(s,"days")&&t.isAfter(a,"days")&&r||t.isAfter(s,"days")){return H["003"]}else{return H["002"]}}}return H[c||"001"]}else{const t=n();const o=n(_,"YYYY-MM-DD");const e=n(u,"YYYY-MM-DD");const r=$(t.toDate(),W((s=i.checkin_checkout_hours)===null||s===void 0?void 0:s.offset,(a=i.checkin_checkout_hours)===null||a===void 0?void 0:a.hour));if(e.isSame(t,"day")&&r){return H["000"]}else if(t.isAfter(e,"day")&&t.isBefore(o,"day")){return H["000"]}else if(o.isSame(t,"day")&&r){return H["000"]}else if(o.isSame(t,"day")&&r||o.isBefore(t,"day")){return H["003"]}else{return H[c||"001"]}}}function w(n,t,o){const e=t.findIndex((t=>t.POOL===n.POOL));if(e===-1){const e=h(n,o);t.push(e)}}function b(n){var t;if(!n){return null}return((t=n.find((n=>n.key==="private_note")))===null||t===void 0?void 0:t.value)||null}function G(t){let o=[];const e=t.rooms.filter((n=>!!n["assigned_units_pool"]));e.forEach((e=>{var s,i,a,r,u,_;const E=n(e.from_date,"YYYY-MM-DD").isAfter(n(P.fromDate,"YYYY-MM-DD"))?e.from_date:P.fromDate;const D=e.to_date;if(n(e.to_date,"YYYY-MM-DD").isBefore(n(P.fromDate,"YYYY-MM-DD"))){return}const d=(s=e.sharing_persons)===null||s===void 0?void 0:s.find((n=>n.is_main));o.push({CHECKIN:false,CHECKOUT:false,ID:e["assigned_units_pool"],TO_DATE:D,FROM_DATE:E,PRIVATE_NOTE:b(t.extras),NO_OF_DAYS:c(E,D),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(i=t.financial)===null||i===void 0?void 0:i.due_amount,STATUS:k({in_out:e.in_out,from_date:e.from_date,to_date:e.to_date,status_code:(a=t.status)===null||a===void 0?void 0:a.code}),NAME:p(d===null||d===void 0?void 0:d.first_name,d.last_name),PHONE:(r=t.guest.mobile_without_prefix)!==null&&r!==void 0?r:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:e.total,RATE_PLAN:e.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:e.rateplan.id,IDENTIFIER:e.identifier,RATE_TYPE:e.roomtype.id,ADULTS_COUNT:e.occupancy.adult_nbr,CHILDREN_COUNT:e.occupancy.children_nbr,PR_ID:+e.unit.id,POOL:e["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:e.rateplan.cancelation,guarantee:e.rateplan.guarantee,TOTAL_PRICE:(u=t.financial)===null||u===void 0?void 0:u.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:e.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:e.from_date,to_date:e.to_date},ROOM_INFO:{occupancy:e.occupancy,sharing_persons:e.sharing_persons,unit:e.unit,in_out:e.in_out},BASE_STATUS_CODE:(_=t.status)===null||_===void 0?void 0:_.code})}));return o}async function j(n){const t=await g();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""?n.NOTES:n.STAY_STATUS_CODE==="003"?K(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):t.find((t=>t.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:V(n.from_date,n.to_date),STATUS:B[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date,defaultDates:{from_date:n.from_date,to_date:n.to_date}}}function V(t,o){const e=n(t,"YYYY-MM-DD").startOf("day");const s=n(o,"YYYY-MM-DD").endOf("day");const i=s.diff(e,"days");return i||1}function $(n,t){return n.getHours()>=t.getHours()&&n.getMinutes()>=t.getMinutes()}function W(n,t){const o=new Date;const e=n*60*60*1e3;const s=new Date(o.getTime()+e);const i=s.getUTCFullYear();const a=s.getUTCMonth();const r=s.getUTCDate();const c=t-n;return new Date(Date.UTC(i,a,r,c))}export{j as A,H as B,N as C,O as D,T as E,l as F,M as G,m as H,c as a,b,C as c,u as d,S as e,I as f,d as g,y as h,r as i,a as j,V as k,L as l,v as m,E as n,D as o,$ as p,W as q,P as r,A as s,G as t,f as u,Y as v,R as w,_ as x,p as y,k as z};
//# sourceMappingURL=p-DKrWRO3S.js.map