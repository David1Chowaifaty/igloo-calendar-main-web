import{h as n}from"./p-6c4ba7c0.js";import{z as t}from"./p-e7d273da.js";import{c as e}from"./p-d6d6fb27.js";import{l as o}from"./p-e58470d9.js";import{a as r}from"./p-bf44a732.js";import{c as s}from"./p-2925ded6.js";const a={days:[],months:[],fromDate:"",toDate:"",disabled_cells:new Map,cleaningTasks:new Map};const{state:c,onChange:i}=s(a);function u(n){const t=new Map;for(const e of n){const n=new Map(t.get(e.unit.id)??new Map);n.set(e.date,e);t.set(e.unit.id,n)}c.cleaningTasks=new Map(t)}function l({unitId:n,date:t}){const e=new Map(c.cleaningTasks);if(!e.has(n)){return}const o=new Map(e.get(n));o.delete(t);e.set(n,o);c.cleaningTasks=new Map(e)}function f({unitId:n,date:t,task:e}){const o=new Map(c.cleaningTasks);const r=new Map(o.get(n)??new Map);r.set(t,e??t);o.set(n,r);c.cleaningTasks=new Map(o)}function _(n){if(!n){return}const t=new Map;const e=new Map;for(const o of n){if(!o?.identifier)continue;const n=o.identifier;const r=o.parent_room_identifier??null;t.set(n,r);if(r){if(!e.has(r))e.set(r,[]);e.get(r).push(n)}else{if(!e.has(n))e.set(n,[])}}const o=new Map(n.map((n=>[n.identifier,n])));for(const[n,t]of e){t.sort(((n,t)=>{const e=o.get(n)?.from_date??"";const r=o.get(t)?.from_date??"";if(e<r)return-1;if(e>r)return 1;return n.localeCompare(t)}))}const r=[];for(const n of t.keys()){const e=t.get(n);if(!e||!t.has(e))r.push(n)}const s=new Map;const a=new Map;const c=n=>{const t=[];const o=new Set;let r=n;while(r&&!o.has(r)){o.add(r);t.push(r);const n=e.get(r)??[];r=n[0]}for(let n=0;n<t.length;n++){const e=t[n];const o=n>0;const r=n<t.length-1;const c=o&&r?"fullSplit":o?"leftSplit":r?"rightSplit":null;s.set(e,c);a.set(e,t)}};for(const n of r)c(n);for(const n of t.keys()){if(!a.has(n))c(n)}return{parentOf:t,childrenOf:e,roleOf:s,chainOf:a,heads:r}}function E(n,t){return n.roleOf.get(t)??null}async function d(n){if(!n?.length){return[]}const t=await M();const e=new Map(t.map((n=>[n.code,n.value])));const o=new Map;for(const t of n){for(const n of t.days){for(const t of n.room_types){D(t.physicalrooms,o,e)}}}return Array.from(o.values())}function D(n,t,e){if(!n?.length){return}for(const o of n){const n=o?.calendar_cell?Object.values(o.calendar_cell):[];for(const o of n){if(o?.Is_Available===false){I(o,t,e)}}}}const T={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const O={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function Y(n,t){if(n===null&&t===null||!n)return"";if(!!t){return`${n??""} ${t??""}`}return n}async function M(){try{const{data:n}=await r.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return n.My_Result.map((n=>({code:n.CODE_NAME,value:n.CODE_VALUE_EN})))}catch(n){console.log(n);return[]}}function N(t,e,r){const s=new Date(t);s.setHours(e);s.setMinutes(r);return`${o.entries.Lcz_BlockedTill} ${n(s).format("MMM DD, HH:mm")}`}function A(t,e){if(F(t.STAY_STATUS_CODE)){const o=n(t.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.from_date:t.DATE;const r=n(t.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.to_date:t.DATE;return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.My_Block_Info.NOTES!==""&&t.My_Block_Info.NOTES!==null?t.My_Block_Info.NOTES:t.STAY_STATUS_CODE==="003"?N(t.My_Block_Info.BLOCKED_TILL_DATE,t.My_Block_Info.BLOCKED_TILL_HOUR,t.My_Block_Info.BLOCKED_TILL_MINUTE):e.get(t.STAY_STATUS_CODE)||"",RELEASE_AFTER_HOURS:t.My_Block_Info.DESCRIPTION,PR_ID:t.My_Block_Info.pr_id,ENTRY_DATE:t.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:t.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.My_Block_Info.NOTES,FROM_DATE:o,TO_DATE:r,NO_OF_DAYS:P(o,r),STATUS:T[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.My_Block_Info.format.from_date,TO_DATE_STR:t.My_Block_Info.format.to_date,defaultDates:{from_date:t.My_Block_Info.from_date,to_date:t.My_Block_Info.to_date}}}try{const e=n(t.room.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.from_date:t.DATE;const o=n(t.room.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.to_date:t.DATE;const r=t.room.sharing_persons?.find((n=>n.is_main));return{ID:t.POOL,FROM_DATE:e,TO_DATE:o,NO_OF_DAYS:P(e,o),STATUS:O[t.booking?.status.code],NAME:Y(r?.first_name,r?.last_name)||Y(t?.booking.guest?.first_name,t?.booking?.guest?.last_name),IDENTIFIER:t.room.identifier,PR_ID:t.pr_id,POOL:t.POOL,BOOKING_NUMBER:t.booking.booking_nbr,NOTES:t.booking.is_direct?t.booking.remark:null,PRIVATE_NOTE:S(t.booking.extras),is_direct:t.booking.is_direct,BALANCE:t.booking.financial?.due_amount,channel_booking_nbr:t.booking.channel_booking_nbr,ARRIVAL_TIME:t.booking.arrival.description,defaultDates:{from_date:t.room.from_date,to_date:t.room.to_date},DEPARTURE_TIME:t.room.departure_time,ENTRY_DATE:t.booking.booked_on.date,PHONE_PREFIX:t.booking.guest.country_phone_prefix,IS_EDITABLE:t.booking.is_editable,ARRIVAL:t.booking.arrival,PHONE:t.booking.guest.mobile_without_prefix??"",RATE:t.room.total,RATE_PLAN:t.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:t.room.rateplan.id,RATE_TYPE:t.room?.roomtype?.id,ADULTS_COUNT:t.room.occupancy.adult_nbr,CHILDREN_COUNT:t.room.occupancy.children_nbr,origin:t.booking.origin,GUEST:t.booking.guest,ROOMS:t.booking.rooms,cancelation:t.room.rateplan.cancelation,guarantee:t.room.rateplan.guarantee,TOTAL_PRICE:t.booking.financial?.gross_total,COUNTRY:t.booking.guest.country_id,FROM_DATE_STR:t.booking.format.from_date,TO_DATE_STR:t.booking.format.to_date,adult_child_offering:t.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:t.booking.source.code,description:t.booking.source.description,tag:t.booking.source.tag},CHECKIN:t.room.in_out?.code==="001",CHECKOUT:t.room.in_out?.code==="002",ROOM_INFO:{occupancy:t.room.occupancy,sharing_persons:t.room.sharing_persons,unit:t.room.unit,in_out:t.room.in_out,calendar_extra:t.room.calendar_extra?JSON.parse(t.room.calendar_extra):null,parent_room_identifier:t.room.parent_room_identifier},BASE_STATUS_CODE:t.booking.status?.code}}catch(n){console.error(`Something went wrong in cell`);console.log(t);console.error(n)}}function R(t){const{in_out:o,status_code:r,from_date:s,to_date:a}=t;if(e.checkin_enabled){if(o?.code==="001"){return O["000"]}else if(o?.code==="002"){if(!e.is_automatic_check_in_out){const t=n();const o=n(a,"YYYY-MM-DD");const r=n(s,"YYYY-MM-DD");const c=L(t.toDate(),y(e.checkin_checkout_hours?.offset,e.checkin_checkout_hours?.hour));if(t.isSame(o,"days")&&t.isAfter(r,"days")&&c||t.isAfter(o,"days")){return O["003"]}else{return O["002"]}}}return O[r||"001"]}else{const t=n();const e=n(a,"YYYY-MM-DD");const o=n(s,"YYYY-MM-DD");if(r!=="PENDING"){if(o.isSame(t,"day")&&t.hour()>=12){return O["000"]}else if(t.isAfter(o,"day")&&t.isBefore(e,"day")){return O["000"]}else if(e.isSame(t,"day")&&t.hour()<12){return O["000"]}else if(e.isSame(t,"day")&&t.hour()>=12||e.isBefore(t,"day")){return O["003"]}else{return O[r||"001"]}}}}function I(n,t,e){if(!n?.POOL||t.has(n.POOL)){return}const o=A(n,e);if(o){t.set(n.POOL,o)}}function S(n){if(!n){return null}return n.find((n=>n.key==="private_note"))?.value||null}function m(t){let e=[];const o=t.rooms.filter((n=>!!n["assigned_units_pool"]));o.forEach((o=>{const r=n(o.from_date,"YYYY-MM-DD").isAfter(n(c.fromDate,"YYYY-MM-DD"))?o.from_date:c.fromDate;const s=o.to_date;if(n(o.to_date,"YYYY-MM-DD").isBefore(n(c.fromDate,"YYYY-MM-DD"))){return}const a=o.sharing_persons?.find((n=>n.is_main));e.push({CHECKIN:false,CHECKOUT:false,ID:o["assigned_units_pool"],TO_DATE:s,FROM_DATE:r,PRIVATE_NOTE:S(t.extras),NO_OF_DAYS:P(r,s),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:t.financial?.due_amount,STATUS:R({in_out:o.in_out,from_date:o.from_date,to_date:o.to_date,status_code:t.status?.code}),NAME:Y(a?.first_name,a.last_name)||Y(o.guest.first_name,o.guest.last_name),PHONE:t.guest.mobile_without_prefix??"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:o.total,RATE_PLAN:o.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:o.rateplan.id,IDENTIFIER:o.identifier,RATE_TYPE:o.roomtype.id,ADULTS_COUNT:o.occupancy.adult_nbr,CHILDREN_COUNT:o.occupancy.children_nbr,PR_ID:+o.unit.id,POOL:o["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:o.rateplan.cancelation,guarantee:o.rateplan.guarantee,TOTAL_PRICE:t.financial?.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:o.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,DEPARTURE_TIME:o.departure_time,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:o.from_date,to_date:o.to_date},ROOM_INFO:{occupancy:o.occupancy,sharing_persons:o.sharing_persons,unit:o.unit,in_out:o.in_out,parent_room_identifier:o.parent_room_identifier,calendar_extra:o.calendar_extra?JSON.parse(o.calendar_extra):null},BASE_STATUS_CODE:t.status?.code})}));return e}async function p(n){const t=await M();return{ID:n.POOL,NOTES:"",BALANCE:"",NAME:n.NOTES!==""&&n.NOTES!==null?n.NOTES:n.STAY_STATUS_CODE==="003"?N(n.BLOCKED_TILL_DATE,n.BLOCKED_TILL_HOUR,n.BLOCKED_TILL_MINUTE):t.find((t=>t.code===n.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:n.DESCRIPTION,PR_ID:n.pr_id,ENTRY_DATE:n.BLOCKED_TILL_DATE,ENTRY_HOUR:n.BLOCKED_TILL_HOUR,ENTRY_MINUTE:n.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:n.NOTES,FROM_DATE:n.from_date,TO_DATE:n.to_date,NO_OF_DAYS:C(n.from_date,n.to_date),STATUS:T[n.STAY_STATUS_CODE],POOL:n.POOL,STATUS_CODE:n.STAY_STATUS_CODE,OUT_OF_SERVICE:n.STAY_STATUS_CODE==="004",FROM_DATE_STR:n.format.from_date,TO_DATE_STR:n.format.to_date,defaultDates:{from_date:n.from_date,to_date:n.to_date}}}function C(t,e){const o=n(t,"YYYY-MM-DD").startOf("day");const r=n(e,"YYYY-MM-DD").endOf("day");const s=r.diff(o,"days");return s||1}function L(n,t){return n.getHours()>=t.getHours()&&n.getMinutes()>=t.getMinutes()}function y(n,t){const e=new Date;const o=n*60*60*1e3;const r=new Date(e.getTime()+o);const s=r.getUTCFullYear();const a=r.getUTCMonth();const c=r.getUTCDate();const i=t-n;return new Date(Date.UTC(s,a,c,i))}function U(t,e,o="D_M_YYYY"){const r=`${t.split(" ")[1]} ${e}`;const s=n(r,"DD MMM YYYY");if(!s.isValid()){throw new Error("Invalid Date")}return s.format(o)}function w(t,e){const o=n(t+" "+e,"ddd DD MMM YYYY").toDate();o.setHours(0,0,0,0);return o.getTime()}function g({rateplan_id:n,roomTypes:t,roomTypeId:e}){if(!e||!Array.isArray(t)||t.length===0){return null}const r=t.find((n=>n?.id===e));if(!r||!Array.isArray(r.rateplans)||r.rateplans.length===0){return null}const s=(()=>{for(const e of t){const t=e.rateplans.find((t=>t.id.toString()===n.toString()));if(t){return t}}return null})();const a={mealPlanCode:s?.meal_plan?.code??null,customText:s?.custom_text??null,isNonRefundable:Boolean(s?.is_non_refundable)};const c=r.rateplans.some((n=>Boolean(n?.is_active)&&(n?.meal_plan?.code??null)===a.mealPlanCode&&(n?.custom_text??null)===a.customText&&Boolean(n?.is_non_refundable)===a.isNonRefundable));if(c){const n=r.rateplans.find((n=>Boolean(n?.is_active)&&(n?.meal_plan?.code??null)===a.mealPlanCode&&(n?.custom_text??null)===a.customText&&Boolean(n?.is_non_refundable)===a.isNonRefundable));return{custom_text:n.custom_text,text:n.short_name,value:n.id.toString()}}const i=o?.entries?.Lcz_NonRefundable??"Non-Refundable";const u=new Set;const l=[];for(const n of r.rateplans){if(!n||!n.is_active||u.has(n.id))continue;u.add(n.id);const t=n.is_non_refundable?` ${i}`:"";const e=`${n.short_name??""}${t}`.trim();if(!e)continue;l.push({text:e,custom_text:n.custom_text,value:String(n.id)})}return l}function P(n,t){const e=new Date(n);const o=new Date(t);return Math.ceil((o.getTime()-e.getTime())/(1e3*60*60*24))}function h(n){const t=n.getFullYear();const e=(n.getMonth()+1).toString().padStart(2,"0");const o=n.getDate().toString().padStart(2,"0");return`${t}-${e}-${o}`}function B(n){let t={};const e={"IN-HOUSE":{id:1,clsName:"IN_HOUSE"},CONFIRMED:{id:2,clsName:"CONFIRMED"},"PENDING-CONFIRMATION":{id:3,clsName:"PENDING_CONFIRMATION"},"SPLIT-UNIT":{id:4,clsName:"SPLIT_UNIT"},"CHECKED-IN":{id:5,clsName:"CHECKED_IN"},"CHECKED-OUT":{id:5,clsName:"CHECKED_OUT"},BLOCKED:{id:6,clsName:"BLOCKED"},"BLOCKED-WITH-DATES":{id:7,clsName:"BLOCKED_WITH_DATES"},NOTES:{id:8,clsName:"NOTES"},"OUTSTANDING-BALANCE":{id:10,clsName:"OUTSTANDING_BALANCE"},"TEMP-EVENT":{id:11,clsName:"PENDING_CONFIRMATION"}};n.forEach((n=>{t[n.id]=n;t.statusId=e}));return t}function F(n){return["003","002","004"].includes(n)}const H=(n,t)=>t.find((t=>t.id===n));function b(n){const t=new Date;const e=n;t.setHours(t.getHours()+e,t.getMinutes(),0,0);return{BLOCKED_TILL_DATE:h(t),BLOCKED_TILL_HOUR:t.getHours().toString(),BLOCKED_TILL_MINUTE:t.getMinutes().toString()}}function K(t,e){const o=n(t,"D_M_YYYY");o.add(e,"days");return o.format("YYYY-MM-DD")}function k(t){const e=n(t,"D_M_YYYY");return e.format("YYYY-MM-DD")}function v(t){return n(t).add(2,"months").format("YYYY-MM-DD")}function x(t,e="DD MMM YYYY"){const o=n(t,e).format("ddd, DD MMM YYYY");return o}function G(t){return n(t).add(1,"days").format("YYYY-MM-DD")}function $(t){return n(t,"YYYY-MM-DD").format("DD/MM ddd")}function j(t,e){let o=[];let r=n.min(n(t).add(1,"days"),n(e));let s=n.max(n(t),n(e));while(r<s){o.push(r.format("YYYY-MM-DD"));r=r.clone().add(1,"days")}return o}function V(n){return n<10?n.toString().padStart(2,"0"):n.toString()}function J(n){if(n===""){return true}const e=t.string().email().safeParse(n);return!e.success}function W(n,t){return n+" "+t.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})}const X=n=>{const t=[1,4];return t.includes(n)};const q=[{key:"private_note",value:""},{key:"is_backend",value:true},{key:"ERROR_EMAIL",value:""},{key:"agent_payment_mode",value:""},{key:"payment_code",value:""}];function z(n,t="add"){const e=JSON.parse(sessionStorage.getItem("backend_anchor"));if(e){if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify({...e,...n}))}else if(t==="remove"){const t=Object.keys(n);t.forEach((n=>{if(n in e){delete e[n]}}));return sessionStorage.setItem("backend_anchor",JSON.stringify(e))}}else{if(t==="add"){return sessionStorage.setItem("backend_anchor",JSON.stringify({...n}))}}}function Q(){const n=JSON.parse(sessionStorage.getItem("backend_anchor"));if(n){return n.login||null}return null}function Z({from_date:t,to_date:o,isCheckedIn:r}){if(!e.checkin_enabled||e.is_automatic_check_in_out){return false}if(r){return false}const s=n();if(n().isSameOrAfter(new Date(t),"days")&&n().isBefore(new Date(o),"days")||n().isSame(new Date(o),"days")&&!L(s.toDate(),y(e.checkin_checkout_hours?.offset,e.checkin_checkout_hours?.hour))){return true}return false}function nn({to_date:t,inOutCode:o}){if(!e.checkin_enabled||e.is_automatic_check_in_out){return false}if(o==="002"){return false}return n().startOf("day").isSameOrAfter(n(t,"YYYY-MM-DD").startOf("date"),"dates")}function tn(n,t){const e=document.createElement("a");e.href=n;e.download=t||n;document.body.appendChild(e);e.click();document.body.removeChild(e)}function en(n,t){const e=Math.pow(10,t);return n/e}async function on(n=200){return new Promise((t=>setTimeout((()=>t(null)),n)))}function rn(n){const t="data-ir-scroll-locked";let e=document.body.getAttribute(t);if(!document.getElementById("scroll-lock-style")){const n=document.createElement("style");n.id="scroll-lock-style";n.innerHTML=`\n      body:dir(ltr)[data-ir-scroll-locked] {\n        overflow: hidden !important;\n        overscroll-behavior: contain;\n        position: relative !important;\n        padding-left: 0px;\n        padding-top: 0px;\n        padding-right: 0px;\n        margin-left: 0;\n        margin-top: 0;\n        margin-right: 15px !important;\n      }\n      body:dir(rtl)[data-ir-scroll-locked] {\n        overflow: hidden !important;\n        overscroll-behavior: contain;\n        position: relative !important;\n        padding-left: 0px;\n        padding-top: 0px;\n        padding-right: 0px;\n        margin-right: 0;\n        margin-top: 0;\n        margin-left: 15px !important;\n      }\n    `;document.head.appendChild(n)}if(!e){document.body.setAttribute(t,"1")}else{const o=n?Number(e)+1:Number(e)-1;document.body.setAttribute(t,o.toString());if(o<=0){document.body.removeAttribute(t)}}}function sn(t,e="YYYY-MM-DD"){const o=n(t,e);return o.day()===0||o.day()===6}export{l as A,f as B,m as C,p as D,O as E,F,G,v as H,k as I,K as J,P as K,g as L,E as M,L as N,y as O,sn as P,j as Q,$ as R,x as S,H as T,S as a,_ as b,C as c,h as d,q as e,W as f,b as g,rn as h,X as i,tn as j,Y as k,d as l,U as m,w as n,Z as o,Q as p,z as q,V as r,nn as s,en as t,on as u,J as v,B as w,c as x,u as y,R as z};
//# sourceMappingURL=p-e69e949c.js.map