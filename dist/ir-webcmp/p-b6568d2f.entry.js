import{r as t,c as s,h as i,H as e,g as a}from"./p-61950c14.js";import{T as r}from"./p-59b1956e.js";import{H as n}from"./p-a3e9bda2.js";import{R as h}from"./p-d269008d.js";import{h as l,u as o}from"./p-365c9590.js";import{i as c}from"./p-2745a7f1.js";import{l as d}from"./p-e19fbf2a.js";import{h as u}from"./p-6c4ba7c0.js";import{v as p}from"./p-4ed69de7.js";import{c as f}from"./p-7f64bb6e.js";import"./p-bf44a732.js";import"./p-0db2e55e.js";const m=".sc-ir-hk-tasks-h{display:block}@media only screen and (max-width: 900px){.table-container.sc-ir-hk-tasks{width:max-content !important}}";const g=m;const k=class{constructor(i){t(this,i);this.clearSelectedHkTasks=s(this,"clearSelectedHkTasks",7);this.language="";this.ticket="";this.isLoading=false;this.selectedDuration="";this.selectedHouseKeeper="0";this.selectedRoom=null;this.archiveOpened=false;this.tasks=[];this.selectedTasks=[];this.hkNameCache={};this.roomService=new h;this.houseKeepingService=new n;this.token=new r}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.init()}}ticketChanged(t,s){if(t===s){return}this.token.setToken(this.ticket);this.init()}handleCloseSidebar(t){t.stopImmediatePropagation();t.stopPropagation();this.isSidebarOpen=false}async init(){try{this.isLoading=true;let t=this.propertyid;if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}if(!t){console.log(t);const s=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true,include_units_hk_status:true});t=s.My_Result.id}this.property_id=t;const s=[this.houseKeepingService.getHkTasks({property_id:this.property_id,from_date:u().format("YYYY-MM-DD"),to_date:u().format("YYYY-MM-DD")}),this.houseKeepingService.getExposedHKSetup(this.property_id),this.roomService.fetchLanguage(this.language)];if(this.propertyid){s.push(this.roomService.getExposedProperty({id:this.propertyid,language:this.language,is_backend:true,include_units_hk_status:true}))}const i=await Promise.all(s);const e=i[0];if(e){this.updateTasks(e)}}catch(t){console.log(t)}finally{this.isLoading=false}}buildHousekeeperNameCache(){var t,s;this.hkNameCache={};(s=(t=l.hk_criteria)===null||t===void 0?void 0:t.housekeepers)===null||s===void 0?void 0:s.forEach((t=>{if(t.id!=null&&t.name!=null){this.hkNameCache[t.id]=t.name}}))}updateTasks(t){this.buildHousekeeperNameCache();this.tasks=t.map((t=>Object.assign(Object.assign({},t),{id:p(),housekeeper:(()=>{var s,i,e;const a=this.hkNameCache[t.hkm_id];if(a){return a}const r=(e=(i=(s=l.hk_criteria)===null||s===void 0?void 0:s.housekeepers)===null||i===void 0?void 0:i.find((s=>s.id===t.hkm_id)))===null||e===void 0?void 0:e.name;this.hkNameCache[t.hkm_id]=r;return r})()})))}handleHeaderButtonPress(t){var s;t.stopImmediatePropagation();t.stopPropagation();const{name:i}=t.detail;switch(i){case"cleaned":(s=this.modal)===null||s===void 0?void 0:s.openModal();break;case"export":break;case"archive":this.isSidebarOpen=true;break}}async handleModalConfirmation(t){try{t.stopImmediatePropagation();t.stopPropagation();if(this.selectedTasks.length===0){return}await this.houseKeepingService.executeHKAction({actions:this.selectedTasks.map((t=>({description:"Cleaned",hkm_id:t.hkm_id===0?null:t.hkm_id,unit_id:t.unit.id})))});await this.fetchTasksWithFilters()}finally{this.selectedTasks=[];this.clearSelectedHkTasks.emit();this.modal.closeModal()}}async applyFilters(t){try{this.isApplyFiltersLoading=true;t.stopImmediatePropagation();t.stopPropagation();this.filters=Object.assign({},t.detail);await this.fetchTasksWithFilters()}catch(t){console.log(t)}finally{this.isApplyFiltersLoading=false}}async fetchTasksWithFilters(){console.log(this.filters);const{cleaning_periods:t,housekeepers:s,cleaning_frequencies:i,dusty_units:e,highlight_check_ins:a}=this.filters;const r=await this.houseKeepingService.getHkTasks({housekeepers:s,cleaning_frequencies:i.code,dusty_units:e.code,highlight_window:a.code,property_id:this.property_id,from_date:u().format("YYYY-MM-DD"),to_date:t.code});if(r){this.updateTasks(r)}}render(){if(this.isLoading){return i("ir-loading-screen",null)}return i(e,null,i("ir-toast",null),i("ir-interceptor",null),i("section",{class:"p-2 d-flex flex-column",style:{gap:"1rem"}},i("ir-tasks-header",{onHeaderButtonPress:this.handleHeaderButtonPress.bind(this),isCleanedEnabled:this.selectedTasks.length>0}),i("div",{class:"d-flex flex-column flex-md-row mt-1 ",style:{gap:"1rem"}},i("ir-tasks-filters",{isLoading:this.isApplyFiltersLoading,onApplyFilters:t=>{this.applyFilters(t)}}),i("ir-tasks-table",{onRowSelectChange:t=>{t.stopImmediatePropagation();t.stopPropagation();this.selectedTasks=t.detail},class:"flex-grow-1 w-100",tasks:this.tasks}))),i("ir-modal",{autoClose:false,ref:t=>this.modal=t,isLoading:c("/Execute_HK_Action"),onConfirmModal:this.handleModalConfirmation.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:d.entries.Lcz_NO,rightBtnText:d.entries.Lcz_Yes,leftBtnColor:"secondary",rightBtnColor:"primary",modalTitle:d.entries.Lcz_Confirmation,modalBody:"Update selected unit(s) to Clean"}),i("ir-sidebar",{open:this.isSidebarOpen,side:"right",id:"editGuestInfo",onIrSidebarToggle:t=>{t.stopImmediatePropagation();t.stopPropagation();this.isSidebarOpen=false},showCloseButton:false},i("ir-hk-archive",{slot:"sidebar-body"})))}get el(){return a(this)}static get watchers(){return{ticket:["ticketChanged"]}}};k.style=g;const y=".sc-ir-housekeeping-h{display:block}";const b=y;const _=class{constructor(s){t(this,s);this.language="";this.ticket="";this.isLoading=false;this.roomService=new h;this.houseKeepingService=new n;this.token=new r}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}async handleResetData(t){t.stopImmediatePropagation();t.stopPropagation();await this.houseKeepingService.getExposedHKSetup(this.propertyid)}ticketChanged(t,s){if(t===s){return}this.token.setToken(this.ticket);this.initializeApp()}async initializeApp(){try{this.isLoading=true;let t=this.propertyid;if(!t){const s=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language,is_backend:true});t=s.My_Result.id}o("default_properties",{token:this.ticket,property_id:t,language:this.language});const s=[this.houseKeepingService.getExposedHKSetup(t),this.roomService.fetchLanguage(this.language,["_HK_FRONT"])];if(this.propertyid){s.unshift(this.roomService.getExposedProperty({id:t,language:this.language,is_backend:true}))}await Promise.all(s)}catch(t){console.error(t)}finally{this.isLoading=false}}render(){if(this.isLoading){return i("ir-loading-screen",null)}return i(e,null,i("ir-interceptor",null),i("ir-toast",null),i("section",{class:"p-1"},i("h4",{class:"mb-2"},"Housekeeping & Check-In Setup"),i("div",{class:"card p-1"},i("ir-title",{borderShown:true,label:"Check-In Mode"}),i("div",{class:"d-flex align-items-center"},i("p",{class:"my-0 py-0 mr-1  "},"Check in & Check out guests automatically:"),i("ir-select",{LabelAvailable:false,showFirstOption:false,selectedValue:f.is_automatic_check_in_out?"auto":"manual",onSelectChange:t=>{t.stopImmediatePropagation();t.stopPropagation();this.roomService.SetAutomaticCheckInOut({property_id:this.propertyid,flag:t.detail==="auto"})},data:[{text:`Yes, as per the property's policy.`,value:"auto"},{text:"No, I will do it manually. ",value:"manual"}]}))),i("ir-hk-team",{class:"mb-1"})))}static get watchers(){return{ticket:["ticketChanged"]}}};_.style=b;export{k as ir_hk_tasks,_ as ir_housekeeping};
//# sourceMappingURL=p-b6568d2f.entry.js.map