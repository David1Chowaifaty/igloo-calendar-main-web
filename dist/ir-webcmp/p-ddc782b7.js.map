{"version":3,"names":["PaymentService","AddPayment","payment","book_nbr","data","axios","post","ExceptionMsg","Error","My_Result","error","console","log","CancelPayment","id","GetExposedCancellationDueAmount","params","ymdDate","z","string","regex","object","channel","property_id","number","int","nullable","balance_filter","filter_type","union","from","to","name","booking_status","userTypeCode","optional","affiliate_id","default","is_mpo_managed","boolean","is_mpo_used","is_for_mobile","is_combined_view","start_row","end_row","total_count","is_to_export","property_ids","array","initialState","channels","settlement_methods","statuses","types","token","rowCount","bookings","pagination","currentPage","totalPages","totalRecords","pageSize","showing","userSelection","moment","add","format","download_url","state","booking_listing","onChange","onBookingListingChange","createStore","initializeUserSelection","code","value","updateUserSelections","updateUserSelection","key","clamp","min","max","Math","calculateShowing","page","startRow","calculateTotalPages","ceil","getRowBounds","endRow","updatePaginationFromSelection","selection","nextPageSize","floor","setPaginationPage","nextPage","setPaginationPageSize","normalizedPageSize","BookingListingService","getExposedBookingsCriteria","result","getExposedBookings","rest","havePrivilege","isPrivilegedUser","extras","undefined","header","My_Params_Get_Exposed_Bookings","exported_data_url","removeExposedBooking","booking_nbr","is_to_revover"],"sources":["src/services/payment.service.ts","src/stores/booking_listing.store.ts","src/services/booking_listing.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { Payment } from '@/components/ir-booking-details/types';\nexport interface IPaymentAction {\n  amount: number;\n  currency: {\n    code: string;\n    id: number;\n    symbol: string;\n  };\n  due_on: string;\n  reason: string;\n  pay_type_code: string;\n  type: 'OVERDUE' | 'FUTURE';\n}\nexport class PaymentService {\n  public async AddPayment(payment: Payment, book_nbr: string): Promise<any> {\n    try {\n      const { data } = await axios.post(`/Do_Payment`, { payment: { ...payment, book_nbr } });\n      if (data.ExceptionMsg !== '') {\n        throw new Error(data.ExceptionMsg);\n      }\n      return data.My_Result;\n    } catch (error) {\n      console.log(error);\n      throw new Error(error);\n    }\n  }\n\n  public async CancelPayment(id: number): Promise<any> {\n    try {\n      const { data } = await axios.post(`/Cancel_Payment`, { id });\n      if (data.ExceptionMsg !== '') {\n        throw new Error(data.ExceptionMsg);\n      }\n      return data.My_Result;\n    } catch (error) {\n      console.log(error);\n      throw new Error(error);\n    }\n  }\n  public async GetExposedCancellationDueAmount(params: { booking_nbr: string; currency_id: number }): Promise<IPaymentAction[]> {\n    try {\n      const { data } = await axios.post(`/Get_Exposed_Cancelation_Due_Amount`, params);\n      if (data.ExceptionMsg !== '') {\n        throw new Error(data.ExceptionMsg);\n      }\n      return data.My_Result;\n    } catch (error) {\n      console.log(error);\n      throw new Error(error);\n    }\n  }\n}\n","import { IExposedBookingsCriteria } from '@/models/IrBookingListing';\nimport { Booking } from '@/models/booking.dto';\nimport { createStore } from '@stencil/store';\nimport moment from 'moment';\nimport { z } from 'zod';\n\ninterface PaginationRange {\n  from: number;\n  to: number;\n}\n\nexport interface BookingListingPagination {\n  currentPage: number;\n  totalPages: number;\n  totalRecords: number;\n  pageSize: number;\n  showing: PaginationRange;\n}\n\nexport interface IBookingListingStore extends IExposedBookingsCriteria {\n  token: string;\n  userSelection: ExposedBookingsParams;\n  bookings: Booking[];\n  download_url: string | null;\n  rowCount: number;\n  balance_filter: { name: string; value: string }[];\n  pagination: BookingListingPagination;\n}\nconst ymdDate = z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, 'Expected date in YYYY-MM-DD format');\nexport const ExposedBookingsParamsSchema = z.object({\n  channel: z.string(),\n\n  // These are null in your initialState, so allow nulls\n  property_id: z.number().int().nullable(),\n  balance_filter: z.string().nullable(),\n  filter_type: z.union([z.number(), z.string()]).nullable(),\n\n  from: ymdDate,\n  to: ymdDate,\n\n  name: z.string(),\n  book_nbr: z.string(),\n  booking_status: z.string(),\n  userTypeCode: z.number().optional(),\n\n  // In the interface these were literal 0/false, but you treat them like values.\n  affiliate_id: z.number().int().default(0),\n  is_mpo_managed: z.boolean().default(false),\n  is_mpo_used: z.boolean().default(false),\n  is_for_mobile: z.boolean().default(false),\n  is_combined_view: z.boolean().default(false),\n\n  start_row: z.number().int(),\n  end_row: z.number().int(),\n  total_count: z.number().int(),\n\n  is_to_export: z.boolean(),\n\n  property_ids: z.array(z.number().int()).optional(),\n});\n\nexport type ExposedBookingsParams = z.infer<typeof ExposedBookingsParamsSchema>;\n\nconst initialState: IBookingListingStore = {\n  channels: [],\n  settlement_methods: [],\n  statuses: [],\n  types: [],\n  token: '',\n  rowCount: 10,\n  bookings: [],\n  balance_filter: [],\n  pagination: {\n    currentPage: 1,\n    totalPages: 0,\n    totalRecords: 0,\n    pageSize: 10,\n    showing: {\n      from: 0,\n      to: 0,\n    },\n  },\n  userSelection: {\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    to: moment().format('YYYY-MM-DD'),\n    channel: '',\n    balance_filter: null,\n    property_id: null,\n    start_row: 0,\n    end_row: 20,\n    total_count: 0,\n    filter_type: null,\n    name: '',\n    book_nbr: '',\n    booking_status: '',\n    affiliate_id: 0,\n    is_mpo_managed: false,\n    is_mpo_used: false,\n    is_for_mobile: false,\n    is_combined_view: false,\n    is_to_export: false,\n  },\n  download_url: null,\n};\n\nexport const { state: booking_listing, onChange: onBookingListingChange } = createStore<IBookingListingStore>(initialState);\nexport function initializeUserSelection() {\n  //booking_listing.channels[0].name\n  booking_listing.userSelection = {\n    ...booking_listing.userSelection,\n    channel: '',\n    booking_status: booking_listing.statuses[0].code,\n    filter_type: booking_listing.types[0].id,\n    book_nbr: '',\n    name: '',\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    to: moment().format('YYYY-MM-DD'),\n    start_row: 0,\n    end_row: booking_listing.rowCount,\n    balance_filter: booking_listing.balance_filter[0].value,\n  };\n}\nexport function updateUserSelections(params: Partial<ExposedBookingsParams>) {\n  booking_listing.userSelection = {\n    ...booking_listing.userSelection,\n    ...params,\n  };\n}\nexport function updateUserSelection(key: keyof ExposedBookingsParams, value: any) {\n  booking_listing.userSelection = {\n    ...booking_listing.userSelection,\n    [key]: value,\n  };\n}\n\nconst clamp = (value: number, min: number, max: number) => {\n  return Math.min(Math.max(value, min), max);\n};\n\nconst calculateShowing = (page: number, pageSize: number, totalRecords: number): PaginationRange => {\n  if (totalRecords === 0) {\n    return { from: 0, to: 0 };\n  }\n\n  const startRow = (page - 1) * pageSize;\n  return {\n    from: startRow + 1,\n    to: Math.min(startRow + pageSize, totalRecords),\n  };\n};\n\nconst calculateTotalPages = (totalRecords: number, pageSize: number) => {\n  if (totalRecords === 0) {\n    return 0;\n  }\n  return Math.ceil(totalRecords / pageSize);\n};\n\nconst getRowBounds = (page: number, pageSize: number) => {\n  const startRow = (page - 1) * pageSize;\n  return {\n    startRow,\n    endRow: startRow + pageSize,\n  };\n};\n\nexport function updatePaginationFromSelection(selection: ExposedBookingsParams) {\n  const nextPageSize = selection.end_row - selection.start_row || booking_listing.pagination.pageSize || booking_listing.rowCount;\n  const totalRecords = selection.total_count;\n  const totalPages = calculateTotalPages(totalRecords, nextPageSize);\n  const currentPage = totalPages === 0 ? 1 : Math.floor(selection.start_row / nextPageSize) + 1;\n\n  booking_listing.rowCount = nextPageSize;\n  booking_listing.pagination = {\n    ...booking_listing.pagination,\n    pageSize: nextPageSize,\n    currentPage,\n    totalPages,\n    totalRecords,\n    showing: calculateShowing(currentPage, nextPageSize, totalRecords),\n  };\n}\n\nexport function setPaginationPage(page: number) {\n  const pageSize = booking_listing.pagination.pageSize || booking_listing.rowCount;\n  const totalPages = booking_listing.pagination.totalPages || Math.max(calculateTotalPages(booking_listing.pagination.totalRecords, pageSize), 1);\n  const nextPage = clamp(page, 1, Math.max(totalPages, 1));\n  const { startRow, endRow } = getRowBounds(nextPage, pageSize);\n\n  updateUserSelections({\n    start_row: startRow,\n    end_row: endRow,\n  });\n\n  booking_listing.pagination = {\n    ...booking_listing.pagination,\n    currentPage: nextPage,\n    showing: calculateShowing(nextPage, pageSize, booking_listing.pagination.totalRecords),\n  };\n  return { startRow, endRow };\n}\n\nexport function setPaginationPageSize(pageSize: number) {\n  const normalizedPageSize = Math.max(pageSize, 1);\n  booking_listing.rowCount = normalizedPageSize;\n  const totalRecords = booking_listing.pagination.totalRecords;\n  const totalPages = calculateTotalPages(totalRecords, normalizedPageSize);\n  const nextPage = totalPages === 0 ? 1 : clamp(booking_listing.pagination.currentPage, 1, Math.max(totalPages, 1));\n  const { startRow, endRow } = getRowBounds(nextPage, normalizedPageSize);\n\n  booking_listing.pagination = {\n    ...booking_listing.pagination,\n    pageSize: normalizedPageSize,\n    currentPage: nextPage,\n    totalPages,\n    showing: calculateShowing(nextPage, normalizedPageSize, totalRecords),\n  };\n\n  updateUserSelections({\n    start_row: startRow,\n    end_row: endRow,\n  });\n  return { startRow, endRow };\n}\nexport default booking_listing;\n","import booking_listing, { ExposedBookingsParams, initializeUserSelection } from '@/stores/booking_listing.store';\nimport { extras, isPrivilegedUser } from '@/utils/utils';\nimport axios from 'axios';\n\nexport class BookingListingService {\n  public async getExposedBookingsCriteria(property_id: number) {\n    const { data } = await axios.post(`/Get_Exposed_Bookings_Criteria`, {\n      property_id,\n    });\n    const result = data.My_Result;\n    booking_listing.channels = result.channels;\n    booking_listing.settlement_methods = result.settlement_methods;\n    booking_listing.statuses = result.statuses;\n    booking_listing.types = result.types;\n    booking_listing.balance_filter = result.balance_filter;\n    initializeUserSelection();\n  }\n\n  public async getExposedBookings(params: ExposedBookingsParams) {\n    const { property_id, userTypeCode, channel, property_ids, ...rest } = params;\n    const havePrivilege = isPrivilegedUser(userTypeCode);\n    const { data } = await axios.post(`/Get_Exposed_Bookings`, {\n      ...rest,\n      extras,\n      property_id: havePrivilege ? undefined : property_id,\n      property_ids: havePrivilege ? property_ids : null,\n      channel: havePrivilege ? '' : channel,\n    });\n    const result = data.My_Result;\n    const header = data.My_Params_Get_Exposed_Bookings;\n    booking_listing.bookings = [...result];\n    booking_listing.userSelection = {\n      ...booking_listing.userSelection,\n      total_count: header.total_count,\n    };\n    booking_listing.download_url = header.exported_data_url;\n  }\n  public async removeExposedBooking(booking_nbr: string, is_to_revover: boolean) {\n    await axios.post(`/Remove_Exposed_Booking`, {\n      booking_nbr,\n      is_to_revover,\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]}