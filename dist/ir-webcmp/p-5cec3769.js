import{z as t}from"./p-e7d273da.js";import{c as e}from"./p-d6d6fb27.js";import{G as s}from"./p-3bfcb0e8.js";import{a as i}from"./p-bf44a732.js";t.object({code:t.string(),id:t.number(),symbol:t.string()});const n=t.object({NIGHTS:t.number(),PCT:t.number(),REVENUE:t.number(),SOURCE:t.string(),PROPERTY_ID:t.number(),PROPERTY_NAME:t.string(),currency:t.string()});const r=n.extend({last_year:n.optional()});const o=t.array(r).nullable();const h=t.object({AC_ID:t.string().optional(),BOOK_CASE:t.string().min(1),FROM_DATE:t.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Use YYYY-MM-DD format"),TO_DATE:t.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Use YYYY-MM-DD format"),WINDOW:t.coerce.number().int().nonnegative(),is_export_to_excel:t.coerce.boolean().optional().default(false),LIST_AC_ID:t.array(t.number()).nullable()});h.extend({include_previous_year:t.boolean()});const c=t=>o.parse(t);const f=t=>h.parse(t);const a=t.object({property_id:t.number(),value:t.string()});const u=t.array(t.object({id:t.number(),name:t.string()})).nullable();const l=t.object({property_id:t.number(),room_identifier:t.string(),value:t.string()});class d{async getExposedProperty(t){try{const{data:s}=await i.post(`/Get_Exposed_Property`,t);if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}const n=s.My_Result;e.property={...n};e.adultChildConstraints=n.adult_child_constraints;e.allowedBookingSources=n.allowed_booking_sources;e.allowed_payment_methods=n.allowed_payment_methods;e.currency=n.currency;e.is_vacation_rental=n.is_vacation_rental;e.pickup_service=n.pickup_service;e.max_nights=n.max_nights;e.roomsInfo=n.roomtypes;e.taxes=n.taxes;e.id=n.id;e.country=n.country;e.name=n.name;e.is_automatic_check_in_out=n.is_automatic_check_in_out;e.tax_statement=n.tax_statement;e.is_frontdesk_enabled=n.is_frontdesk_enabled;e.is_pms_enabled=n.is_pms_enabled;const r=n?.time_constraints?.check_out_till?.split(":");e.checkin_checkout_hours={offset:n.city.gmt_offset,hour:Number(r[0]||0),minute:Number(r[1]||0)};return s}catch(t){console.log(t);throw new Error(t)}}async setPropertyCalendarExtra(t){const e=a.parse(t);const{data:s}=await i.post("/Set_Property_Calendar_Extra",e);if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}return s.My_Result}async setRoomCalendarExtra(t){const e=l.parse(t);const{data:s}=await i.post("/Set_Room_Calendar_Extra",e);if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}return s.My_Result}async getChannelSales(t){const e=f(t);const{data:n}=await i.post("/Get_Channel_Sales",e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}if(t.is_export_to_excel){s(n.My_Params_Get_Channel_Sales.Link_excel)}return c(n.My_Result)}async getExposedAllowedProperties(){const{data:t}=await i.post("/Get_Exposed_Allowed_Properties",{});if(t.ExceptionMsg!==""){throw new Error(t.ExceptionMsg)}return u.parse(t.My_Result)}async getCountrySales(t){const{data:e}=await i.post("/Get_Country_Sales",t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}if(t.is_export_to_excel){s(e.My_Params_Get_Country_Sales.Link_excel)}return e.My_Result}async getDailyRevenueReport(t){const{data:e}=await i.post("/Get_Daily_Revenue_Report",t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}if(t.is_export_to_excel){s(e.My_Params_Get_Daily_Revenue_Report.Link_excel)}return e.My_Result}async setExposedCleaningFrequency(t){const{data:e}=await i.post("/Set_Exposed_Cleaning_Frequency",t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}async getMonthlyStats(t){const{data:e}=await i.post("/Get_Monthly_Stats",t);if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}if(t.is_export_to_excel){s(e.My_Params_Get_Monthly_Stats.Link_excel)}return e.My_Result}}const p=Object.create(null);p["open"]="0";p["close"]="1";p["ping"]="2";p["pong"]="3";p["message"]="4";p["upgrade"]="5";p["noop"]="6";const y=Object.create(null);Object.keys(p).forEach((t=>{y[p[t]]=t}));const w={type:"error",data:"parser error"};const b=typeof Blob==="function"||typeof Blob!=="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]";const g=typeof ArrayBuffer==="function";const m=t=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer;const v=({type:t,data:e},s,i)=>{if(b&&e instanceof Blob){if(s){return i(e)}else{return _(e,i)}}else if(g&&(e instanceof ArrayBuffer||m(e))){if(s){return i(e)}else{return _(new Blob([e]),i)}}return i(p[t]+(e||""))};const _=(t,e)=>{const s=new FileReader;s.onload=function(){const t=s.result.split(",")[1];e("b"+(t||""))};return s.readAsDataURL(t)};function E(t){if(t instanceof Uint8Array){return t}else if(t instanceof ArrayBuffer){return new Uint8Array(t)}else{return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}}let k;function A(t,e){if(b&&t.data instanceof Blob){return t.data.arrayBuffer().then(E).then(e)}else if(g&&(t.data instanceof ArrayBuffer||m(t.data))){return e(E(t.data))}v(t,false,(t=>{if(!k){k=new TextEncoder}e(k.encode(t))}))}const O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";const x=typeof Uint8Array==="undefined"?[]:new Uint8Array(256);for(let t=0;t<O.length;t++){x[O.charCodeAt(t)]=t}const C=t=>{let e=t.length*.75,s=t.length,i,n=0,r,o,h,c;if(t[t.length-1]==="="){e--;if(t[t.length-2]==="="){e--}}const f=new ArrayBuffer(e),a=new Uint8Array(f);for(i=0;i<s;i+=4){r=x[t.charCodeAt(i)];o=x[t.charCodeAt(i+1)];h=x[t.charCodeAt(i+2)];c=x[t.charCodeAt(i+3)];a[n++]=r<<2|o>>4;a[n++]=(o&15)<<4|h>>2;a[n++]=(h&3)<<6|c&63}return f};const j=typeof ArrayBuffer==="function";const B=(t,e)=>{if(typeof t!=="string"){return{type:"message",data:P(t,e)}}const s=t.charAt(0);if(s==="b"){return{type:"message",data:D(t.substring(1),e)}}const i=y[s];if(!i){return w}return t.length>1?{type:y[s],data:t.substring(1)}:{type:y[s]}};const D=(t,e)=>{if(j){const s=C(t);return P(s,e)}else{return{base64:true,data:t}}};const P=(t,e)=>{switch(e){case"blob":if(t instanceof Blob){return t}else{return new Blob([t])}case"arraybuffer":default:if(t instanceof ArrayBuffer){return t}else{return t.buffer}}};const T=String.fromCharCode(30);const R=(t,e)=>{const s=t.length;const i=new Array(s);let n=0;t.forEach(((t,r)=>{v(t,false,(t=>{i[r]=t;if(++n===s){e(i.join(T))}}))}))};const S=(t,e)=>{const s=t.split(T);const i=[];for(let t=0;t<s.length;t++){const n=B(s[t],e);i.push(n);if(n.type==="error"){break}}return i};function N(){return new TransformStream({transform(t,e){A(t,(s=>{const i=s.length;let n;if(i<126){n=new Uint8Array(1);new DataView(n.buffer).setUint8(0,i)}else if(i<65536){n=new Uint8Array(3);const t=new DataView(n.buffer);t.setUint8(0,126);t.setUint16(1,i)}else{n=new Uint8Array(9);const t=new DataView(n.buffer);t.setUint8(0,127);t.setBigUint64(1,BigInt(i))}if(t.data&&typeof t.data!=="string"){n[0]|=128}e.enqueue(n);e.enqueue(s)}))}})}let U;function M(t){return t.reduce(((t,e)=>t+e.length),0)}function I(t,e){if(t[0].length===e){return t.shift()}const s=new Uint8Array(e);let i=0;for(let n=0;n<e;n++){s[n]=t[0][i++];if(i===t[0].length){t.shift();i=0}}if(t.length&&i<t[0].length){t[0]=t[0].slice(i)}return s}function L(t,e){if(!U){U=new TextDecoder}const s=[];let i=0;let n=-1;let r=false;return new TransformStream({transform(o,h){s.push(o);while(true){if(i===0){if(M(s)<1){break}const t=I(s,1);r=(t[0]&128)===128;n=t[0]&127;if(n<126){i=3}else if(n===126){i=1}else{i=2}}else if(i===1){if(M(s)<2){break}const t=I(s,2);n=new DataView(t.buffer,t.byteOffset,t.length).getUint16(0);i=3}else if(i===2){if(M(s)<8){break}const t=I(s,8);const e=new DataView(t.buffer,t.byteOffset,t.length);const r=e.getUint32(0);if(r>Math.pow(2,53-32)-1){h.enqueue(w);break}n=r*Math.pow(2,32)+e.getUint32(4);i=3}else{if(M(s)<n){break}const t=I(s,n);h.enqueue(B(r?t:U.decode(t),e));i=0}if(n===0||n>t){h.enqueue(w);break}}}})}const $=4;function F(t){if(t)return Y(t)}function Y(t){for(var e in F.prototype){t[e]=F.prototype[e]}return t}F.prototype.on=F.prototype.addEventListener=function(t,e){this._callbacks=this._callbacks||{};(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e);return this};F.prototype.once=function(t,e){function s(){this.off(t,s);e.apply(this,arguments)}s.fn=e;this.on(t,s);return this};F.prototype.off=F.prototype.removeListener=F.prototype.removeAllListeners=F.prototype.removeEventListener=function(t,e){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var s=this._callbacks["$"+t];if(!s)return this;if(1==arguments.length){delete this._callbacks["$"+t];return this}var i;for(var n=0;n<s.length;n++){i=s[n];if(i===e||i.fn===e){s.splice(n,1);break}}if(s.length===0){delete this._callbacks["$"+t]}return this};F.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=new Array(arguments.length-1),s=this._callbacks["$"+t];for(var i=1;i<arguments.length;i++){e[i-1]=arguments[i]}if(s){s=s.slice(0);for(var i=0,n=s.length;i<n;++i){s[i].apply(this,e)}}return this};F.prototype.emitReserved=F.prototype.emit;F.prototype.listeners=function(t){this._callbacks=this._callbacks||{};return this._callbacks["$"+t]||[]};F.prototype.hasListeners=function(t){return!!this.listeners(t).length};const q=(()=>{const t=typeof Promise==="function"&&typeof Promise.resolve==="function";if(t){return t=>Promise.resolve().then(t)}else{return(t,e)=>e(t,0)}})();const V=(()=>{if(typeof self!=="undefined"){return self}else if(typeof window!=="undefined"){return window}else{return Function("return this")()}})();const G="arraybuffer";function H(){}function W(t,...e){return e.reduce(((e,s)=>{if(t.hasOwnProperty(s)){e[s]=t[s]}return e}),{})}const X=V.setTimeout;const z=V.clearTimeout;function J(t,e){if(e.useNativeTimers){t.setTimeoutFn=X.bind(V);t.clearTimeoutFn=z.bind(V)}else{t.setTimeoutFn=V.setTimeout.bind(V);t.clearTimeoutFn=V.clearTimeout.bind(V)}}const K=1.33;function Q(t){if(typeof t==="string"){return Z(t)}return Math.ceil((t.byteLength||t.size)*K)}function Z(t){let e=0,s=0;for(let i=0,n=t.length;i<n;i++){e=t.charCodeAt(i);if(e<128){s+=1}else if(e<2048){s+=2}else if(e<55296||e>=57344){s+=3}else{i++;s+=4}}return s}function tt(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function et(t){let e="";for(let s in t){if(t.hasOwnProperty(s)){if(e.length)e+="&";e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s])}}return e}function st(t){let e={};let s=t.split("&");for(let t=0,i=s.length;t<i;t++){let i=s[t].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}class it extends Error{constructor(t,e,s){super(t);this.description=e;this.context=s;this.type="TransportError"}}class nt extends F{constructor(t){super();this.writable=false;J(this,t);this.opts=t;this.query=t.query;this.socket=t.socket;this.supportsBinary=!t.forceBase64}onError(t,e,s){super.emitReserved("error",new it(t,e,s));return this}open(){this.readyState="opening";this.doOpen();return this}close(){if(this.readyState==="opening"||this.readyState==="open"){this.doClose();this.onClose()}return this}send(t){if(this.readyState==="open"){this.write(t)}}onOpen(){this.readyState="open";this.writable=true;super.emitReserved("open")}onData(t){const e=B(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed";super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){if(this.opts.port&&(this.opts.secure&&Number(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)){return":"+this.opts.port}else{return""}}_query(t){const e=et(t);return e.length?"?"+e:""}}class rt extends nt{constructor(){super(...arguments);this._polling=false}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused";t()};if(this._polling||!this.writable){let t=0;if(this._polling){t++;this.once("pollComplete",(function(){--t||e()}))}if(!this.writable){t++;this.once("drain",(function(){--t||e()}))}}else{e()}}_poll(){this._polling=true;this.doPoll();this.emitReserved("poll")}onData(t){const e=t=>{if("opening"===this.readyState&&t.type==="open"){this.onOpen()}if("close"===t.type){this.onClose({description:"transport closed by the server"});return false}this.onPacket(t)};S(t,this.socket.binaryType).forEach(e);if("closed"!==this.readyState){this._polling=false;this.emitReserved("pollComplete");if("open"===this.readyState){this._poll()}}}doClose(){const t=()=>{this.write([{type:"close"}])};if("open"===this.readyState){t()}else{this.once("open",t)}}write(t){this.writable=false;R(t,(t=>{this.doWrite(t,(()=>{this.writable=true;this.emitReserved("drain")}))}))}uri(){const t=this.opts.secure?"https":"http";const e=this.query||{};if(false!==this.opts.timestampRequests){e[this.opts.timestampParam]=tt()}if(!this.supportsBinary&&!e.sid){e.b64=1}return this.createUri(t,e)}}let ot=false;try{ot=typeof XMLHttpRequest!=="undefined"&&"withCredentials"in new XMLHttpRequest}catch(t){}const ht=ot;function ct(){}class ft extends rt{constructor(t){super(t);if(typeof location!=="undefined"){const e="https:"===location.protocol;let s=location.port;if(!s){s=e?"443":"80"}this.xd=typeof location!=="undefined"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,e){const s=this.request({method:"POST",data:t});s.on("success",e);s.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this));t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)}));this.pollXhr=t}}class at extends F{constructor(t,e,s){super();this.createRequest=t;J(this,s);this._opts=s;this._method=s.method||"GET";this._uri=e;this._data=undefined!==s.data?s.data:null;this._create()}_create(){var t;const e=W(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(e);try{s.open(this._method,this._uri,true);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(true);for(let t in this._opts.extraHeaders){if(this._opts.extraHeaders.hasOwnProperty(t)){s.setRequestHeader(t,this._opts.extraHeaders[t])}}}}catch(t){}if("POST"===this._method){try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}}try{s.setRequestHeader("Accept","*/*")}catch(t){}(t=this._opts.cookieJar)===null||t===void 0?void 0:t.addCookies(s);if("withCredentials"in s){s.withCredentials=this._opts.withCredentials}if(this._opts.requestTimeout){s.timeout=this._opts.requestTimeout}s.onreadystatechange=()=>{var t;if(s.readyState===3){(t=this._opts.cookieJar)===null||t===void 0?void 0:t.parseCookies(s.getResponseHeader("set-cookie"))}if(4!==s.readyState)return;if(200===s.status||1223===s.status){this._onLoad()}else{this.setTimeoutFn((()=>{this._onError(typeof s.status==="number"?s.status:0)}),0)}};s.send(this._data)}catch(t){this.setTimeoutFn((()=>{this._onError(t)}),0);return}if(typeof document!=="undefined"){this._index=at.requestsCount++;at.requests[this._index]=this}}_onError(t){this.emitReserved("error",t,this._xhr);this._cleanup(true)}_cleanup(t){if("undefined"===typeof this._xhr||null===this._xhr){return}this._xhr.onreadystatechange=ct;if(t){try{this._xhr.abort()}catch(t){}}if(typeof document!=="undefined"){delete at.requests[this._index]}this._xhr=null}_onLoad(){const t=this._xhr.responseText;if(t!==null){this.emitReserved("data",t);this.emitReserved("success");this._cleanup()}}abort(){this._cleanup()}}at.requestsCount=0;at.requests={};if(typeof document!=="undefined"){if(typeof attachEvent==="function"){attachEvent("onunload",ut)}else if(typeof addEventListener==="function"){const t="onpagehide"in V?"pagehide":"unload";addEventListener(t,ut,false)}}function ut(){for(let t in at.requests){if(at.requests.hasOwnProperty(t)){at.requests[t].abort()}}}const lt=function(){const t=pt({xdomain:false});return t&&t.responseType!==null}();class dt extends ft{constructor(t){super(t);const e=t&&t.forceBase64;this.supportsBinary=lt&&!e}request(t={}){Object.assign(t,{xd:this.xd},this.opts);return new at(pt,this.uri(),t)}}function pt(t){const e=t.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!e||ht)){return new XMLHttpRequest}}catch(t){}if(!e){try{return new(V[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}}const yt=typeof navigator!=="undefined"&&typeof navigator.product==="string"&&navigator.product.toLowerCase()==="reactnative";class wt extends nt{get name(){return"websocket"}doOpen(){const t=this.uri();const e=this.opts.protocols;const s=yt?{}:W(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");if(this.opts.extraHeaders){s.headers=this.opts.extraHeaders}try{this.ws=this.createSocket(t,e,s)}catch(t){return this.emitReserved("error",t)}this.ws.binaryType=this.socket.binaryType;this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{if(this.opts.autoUnref){this.ws._socket.unref()}this.onOpen()};this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t});this.ws.onmessage=t=>this.onData(t.data);this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=false;for(let e=0;e<t.length;e++){const s=t[e];const i=e===t.length-1;v(s,this.supportsBinary,(t=>{try{this.doWrite(s,t)}catch(t){}if(i){q((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){if(typeof this.ws!=="undefined"){this.ws.onerror=()=>{};this.ws.close();this.ws=null}}uri(){const t=this.opts.secure?"wss":"ws";const e=this.query||{};if(this.opts.timestampRequests){e[this.opts.timestampParam]=tt()}if(!this.supportsBinary){e.b64=1}return this.createUri(t,e)}}const bt=V.WebSocket||V.MozWebSocket;class gt extends wt{createSocket(t,e,s){return!yt?e?new bt(t,e):new bt(t):new bt(t,e,s)}doWrite(t,e){this.ws.send(e)}}class mt extends nt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then((()=>{this.onClose()})).catch((t=>{this.onError("webtransport error",t)}));this._transport.ready.then((()=>{this._transport.createBidirectionalStream().then((t=>{const e=L(Number.MAX_SAFE_INTEGER,this.socket.binaryType);const s=t.readable.pipeThrough(e).getReader();const i=N();i.readable.pipeTo(t.writable);this._writer=i.writable.getWriter();const n=()=>{s.read().then((({done:t,value:e})=>{if(t){return}this.onPacket(e);n()})).catch((t=>{}))};n();const r={type:"open"};if(this.query.sid){r.data=`{"sid":"${this.query.sid}"}`}this._writer.write(r).then((()=>this.onOpen()))}))}))}write(t){this.writable=false;for(let e=0;e<t.length;e++){const s=t[e];const i=e===t.length-1;this._writer.write(s).then((()=>{if(i){q((()=>{this.writable=true;this.emitReserved("drain")}),this.setTimeoutFn)}}))}}doClose(){var t;(t=this._transport)===null||t===void 0?void 0:t.close()}}const vt={websocket:gt,webtransport:mt,polling:dt};const _t=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;const Et=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function kt(t){if(t.length>8e3){throw"URI too long"}const e=t,s=t.indexOf("["),i=t.indexOf("]");if(s!=-1&&i!=-1){t=t.substring(0,s)+t.substring(s,i).replace(/:/g,";")+t.substring(i,t.length)}let n=_t.exec(t||""),r={},o=14;while(o--){r[Et[o]]=n[o]||""}if(s!=-1&&i!=-1){r.source=e;r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":");r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":");r.ipv6uri=true}r.pathNames=At(r,r["path"]);r.queryKey=Ot(r,r["query"]);return r}function At(t,e){const s=/\/{2,9}/g,i=e.replace(s,"/").split("/");if(e.slice(0,1)=="/"||e.length===0){i.splice(0,1)}if(e.slice(-1)=="/"){i.splice(i.length-1,1)}return i}function Ot(t,e){const s={};e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,i){if(e){s[e]=i}}));return s}const xt=typeof addEventListener==="function"&&typeof removeEventListener==="function";const Ct=[];if(xt){addEventListener("offline",(()=>{Ct.forEach((t=>t()))}),false)}class jt extends F{constructor(t,e){super();this.binaryType=G;this.writeBuffer=[];this._prevBufferLen=0;this._pingInterval=-1;this._pingTimeout=-1;this._maxPayload=-1;this._pingTimeoutTime=Infinity;if(t&&"object"===typeof t){e=t;t=null}if(t){const s=kt(t);e.hostname=s.host;e.secure=s.protocol==="https"||s.protocol==="wss";e.port=s.port;if(s.query)e.query=s.query}else if(e.host){e.hostname=kt(e.host).host}J(this,e);this.secure=null!=e.secure?e.secure:typeof location!=="undefined"&&"https:"===location.protocol;if(e.hostname&&!e.port){e.port=this.secure?"443":"80"}this.hostname=e.hostname||(typeof location!=="undefined"?location.hostname:"localhost");this.port=e.port||(typeof location!=="undefined"&&location.port?location.port:this.secure?"443":"80");this.transports=[];this._transportsByName={};e.transports.forEach((t=>{const e=t.prototype.name;this.transports.push(e);this._transportsByName[e]=t}));this.opts=Object.assign({path:"/engine.io",agent:false,withCredentials:false,upgrade:true,timestampParam:"t",rememberUpgrade:false,addTrailingSlash:true,rejectUnauthorized:true,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:false},e);this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":"");if(typeof this.opts.query==="string"){this.opts.query=st(this.opts.query)}if(xt){if(this.opts.closeOnBeforeunload){this._beforeunloadEventListener=()=>{if(this.transport){this.transport.removeAllListeners();this.transport.close()}};addEventListener("beforeunload",this._beforeunloadEventListener,false)}if(this.hostname!=="localhost"){this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})};Ct.push(this._offlineEventListener)}}if(this.opts.withCredentials){this._cookieJar=H()}this._open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=$;e.transport=t;if(this.id)e.sid=this.id;const s=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);return}const t=this.opts.rememberUpgrade&&jt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(t);e.open();this.setTransport(e)}setTransport(t){if(this.transport){this.transport.removeAllListeners()}this.transport=t;t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",(t=>this._onClose("transport close",t)))}onOpen(){this.readyState="open";jt.priorWebsocketSuccess="websocket"===this.transport.name;this.emitReserved("open");this.flush()}_onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.emitReserved("packet",t);this.emitReserved("heartbeat");switch(t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong");this.emitReserved("ping");this.emitReserved("pong");this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=t.data;this._onError(e);break;case"message":this.emitReserved("data",t.data);this.emitReserved("message",t.data);break}}}onHandshake(t){this.emitReserved("handshake",t);this.id=t.sid;this.transport.query.sid=t.sid;this._pingInterval=t.pingInterval;this._pingTimeout=t.pingTimeout;this._maxPayload=t.maxPayload;this.onOpen();if("closed"===this.readyState)return;this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t;this._pingTimeoutTimer=this.setTimeoutFn((()=>{this._onClose("ping timeout")}),t);if(this.opts.autoUnref){this._pingTimeoutTimer.unref()}}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen);this._prevBufferLen=0;if(0===this.writeBuffer.length){this.emitReserved("drain")}else{this.flush()}}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t);this._prevBufferLen=t.length;this.emitReserved("flush")}}_getWritablePackets(){const t=this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1;if(!t){return this.writeBuffer}let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s){e+=Q(s)}if(t>0&&e>this._maxPayload){return this.writeBuffer.slice(0,t)}e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return true;const t=Date.now()>this._pingTimeoutTime;if(t){this._pingTimeoutTime=0;q((()=>{this._onClose("ping timeout")}),this.setTimeoutFn)}return t}write(t,e,s){this._sendPacket("message",t,e,s);return this}send(t,e,s){this._sendPacket("message",t,e,s);return this}_sendPacket(t,e,s,i){if("function"===typeof e){i=e;e=undefined}if("function"===typeof s){i=s;s=null}if("closing"===this.readyState||"closed"===this.readyState){return}s=s||{};s.compress=false!==s.compress;const n={type:t,data:e,options:s};this.emitReserved("packetCreate",n);this.writeBuffer.push(n);if(i)this.once("flush",i);this.flush()}close(){const t=()=>{this._onClose("forced close");this.transport.close()};const e=()=>{this.off("upgrade",e);this.off("upgradeError",e);t()};const s=()=>{this.once("upgrade",e);this.once("upgradeError",e)};if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";if(this.writeBuffer.length){this.once("drain",(()=>{if(this.upgrading){s()}else{t()}}))}else if(this.upgrading){s()}else{t()}}return this}_onError(t){jt.priorWebsocketSuccess=false;if(this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening"){this.transports.shift();return this._open()}this.emitReserved("error",t);this._onClose("transport error",t)}_onClose(t,e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){this.clearTimeoutFn(this._pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();if(xt){if(this._beforeunloadEventListener){removeEventListener("beforeunload",this._beforeunloadEventListener,false)}if(this._offlineEventListener){const t=Ct.indexOf(this._offlineEventListener);if(t!==-1){Ct.splice(t,1)}}}this.readyState="closed";this.id=null;this.emitReserved("close",t,e);this.writeBuffer=[];this._prevBufferLen=0}}}jt.protocol=$;class Bt extends jt{constructor(){super(...arguments);this._upgrades=[]}onOpen(){super.onOpen();if("open"===this.readyState&&this.opts.upgrade){for(let t=0;t<this._upgrades.length;t++){this._probe(this._upgrades[t])}}}_probe(t){let e=this.createTransport(t);let s=false;jt.priorWebsocketSuccess=false;const i=()=>{if(s)return;e.send([{type:"ping",data:"probe"}]);e.once("packet",(t=>{if(s)return;if("pong"===t.type&&"probe"===t.data){this.upgrading=true;this.emitReserved("upgrading",e);if(!e)return;jt.priorWebsocketSuccess="websocket"===e.name;this.transport.pause((()=>{if(s)return;if("closed"===this.readyState)return;f();this.setTransport(e);e.send([{type:"upgrade"}]);this.emitReserved("upgrade",e);e=null;this.upgrading=false;this.flush()}))}else{const t=new Error("probe error");t.transport=e.name;this.emitReserved("upgradeError",t)}}))};function n(){if(s)return;s=true;f();e.close();e=null}const r=t=>{const s=new Error("probe error: "+t);s.transport=e.name;n();this.emitReserved("upgradeError",s)};function o(){r("transport closed")}function h(){r("socket closed")}function c(t){if(e&&t.name!==e.name){n()}}const f=()=>{e.removeListener("open",i);e.removeListener("error",r);e.removeListener("close",o);this.off("close",h);this.off("upgrading",c)};e.once("open",i);e.once("error",r);e.once("close",o);this.once("close",h);this.once("upgrading",c);if(this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"){this.setTimeoutFn((()=>{if(!s){e.open()}}),200)}else{e.open()}}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades);super.onHandshake(t)}_filterUpgrades(t){const e=[];for(let s=0;s<t.length;s++){if(~this.transports.indexOf(t[s]))e.push(t[s])}return e}}class Dt extends Bt{constructor(t,e={}){const s=typeof t==="object"?t:e;if(!s.transports||s.transports&&typeof s.transports[0]==="string"){s.transports=(s.transports||["polling","websocket","webtransport"]).map((t=>vt[t])).filter((t=>!!t))}super(t,s)}}function Pt(t,e="",s){let i=t;s=s||typeof location!=="undefined"&&location;if(null==t)t=s.protocol+"//"+s.host;if(typeof t==="string"){if("/"===t.charAt(0)){if("/"===t.charAt(1)){t=s.protocol+t}else{t=s.host+t}}if(!/^(https?|wss?):\/\//.test(t)){if("undefined"!==typeof s){t=s.protocol+"//"+t}else{t="https://"+t}}i=kt(t)}if(!i.port){if(/^(http|ws)$/.test(i.protocol)){i.port="80"}else if(/^(http|ws)s$/.test(i.protocol)){i.port="443"}}i.path=i.path||"/";const n=i.host.indexOf(":")!==-1;const r=n?"["+i.host+"]":i.host;i.id=i.protocol+"://"+r+":"+i.port+e;i.href=i.protocol+"://"+r+(s&&s.port===i.port?"":":"+i.port);return i}const Tt=typeof ArrayBuffer==="function";const Rt=t=>typeof ArrayBuffer.isView==="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer;const St=Object.prototype.toString;const Nt=typeof Blob==="function"||typeof Blob!=="undefined"&&St.call(Blob)==="[object BlobConstructor]";const Ut=typeof File==="function"||typeof File!=="undefined"&&St.call(File)==="[object FileConstructor]";function Mt(t){return Tt&&(t instanceof ArrayBuffer||Rt(t))||Nt&&t instanceof Blob||Ut&&t instanceof File}function It(t,e){if(!t||typeof t!=="object"){return false}if(Array.isArray(t)){for(let e=0,s=t.length;e<s;e++){if(It(t[e])){return true}}return false}if(Mt(t)){return true}if(t.toJSON&&typeof t.toJSON==="function"&&arguments.length===1){return It(t.toJSON(),true)}for(const e in t){if(Object.prototype.hasOwnProperty.call(t,e)&&It(t[e])){return true}}return false}function Lt(t){const e=[];const s=t.data;const i=t;i.data=$t(s,e);i.attachments=e.length;return{packet:i,buffers:e}}function $t(t,e){if(!t)return t;if(Mt(t)){const s={_placeholder:true,num:e.length};e.push(t);return s}else if(Array.isArray(t)){const s=new Array(t.length);for(let i=0;i<t.length;i++){s[i]=$t(t[i],e)}return s}else if(typeof t==="object"&&!(t instanceof Date)){const s={};for(const i in t){if(Object.prototype.hasOwnProperty.call(t,i)){s[i]=$t(t[i],e)}}return s}return t}function Ft(t,e){t.data=Yt(t.data,e);delete t.attachments;return t}function Yt(t,e){if(!t)return t;if(t&&t._placeholder===true){const s=typeof t.num==="number"&&t.num>=0&&t.num<e.length;if(s){return e[t.num]}else{throw new Error("illegal attachments")}}else if(Array.isArray(t)){for(let s=0;s<t.length;s++){t[s]=Yt(t[s],e)}}else if(typeof t==="object"){for(const s in t){if(Object.prototype.hasOwnProperty.call(t,s)){t[s]=Yt(t[s],e)}}}return t}const qt=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"];const Vt=5;var Gt;(function(t){t[t["CONNECT"]=0]="CONNECT";t[t["DISCONNECT"]=1]="DISCONNECT";t[t["EVENT"]=2]="EVENT";t[t["ACK"]=3]="ACK";t[t["CONNECT_ERROR"]=4]="CONNECT_ERROR";t[t["BINARY_EVENT"]=5]="BINARY_EVENT";t[t["BINARY_ACK"]=6]="BINARY_ACK"})(Gt||(Gt={}));class Ht{constructor(t){this.replacer=t}encode(t){if(t.type===Gt.EVENT||t.type===Gt.ACK){if(It(t)){return this.encodeAsBinary({type:t.type===Gt.EVENT?Gt.BINARY_EVENT:Gt.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id})}}return[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;if(t.type===Gt.BINARY_EVENT||t.type===Gt.BINARY_ACK){e+=t.attachments+"-"}if(t.nsp&&"/"!==t.nsp){e+=t.nsp+","}if(null!=t.id){e+=t.id}if(null!=t.data){e+=JSON.stringify(t.data,this.replacer)}return e}encodeAsBinary(t){const e=Lt(t);const s=this.encodeAsString(e.packet);const i=e.buffers;i.unshift(s);return i}}function Wt(t){return Object.prototype.toString.call(t)==="[object Object]"}class Xt extends F{constructor(t){super();this.reviver=t}add(t){let e;if(typeof t==="string"){if(this.reconstructor){throw new Error("got plaintext data when reconstructing a packet")}e=this.decodeString(t);const s=e.type===Gt.BINARY_EVENT;if(s||e.type===Gt.BINARY_ACK){e.type=s?Gt.EVENT:Gt.ACK;this.reconstructor=new zt(e);if(e.attachments===0){super.emitReserved("decoded",e)}}else{super.emitReserved("decoded",e)}}else if(Mt(t)||t.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{e=this.reconstructor.takeBinaryData(t);if(e){this.reconstructor=null;super.emitReserved("decoded",e)}}}else{throw new Error("Unknown type: "+t)}}decodeString(t){let e=0;const s={type:Number(t.charAt(0))};if(Gt[s.type]===undefined){throw new Error("unknown packet type "+s.type)}if(s.type===Gt.BINARY_EVENT||s.type===Gt.BINARY_ACK){const i=e+1;while(t.charAt(++e)!=="-"&&e!=t.length){}const n=t.substring(i,e);if(n!=Number(n)||t.charAt(e)!=="-"){throw new Error("Illegal attachments")}s.attachments=Number(n)}if("/"===t.charAt(e+1)){const i=e+1;while(++e){const s=t.charAt(e);if(","===s)break;if(e===t.length)break}s.nsp=t.substring(i,e)}else{s.nsp="/"}const i=t.charAt(e+1);if(""!==i&&Number(i)==i){const i=e+1;while(++e){const s=t.charAt(e);if(null==s||Number(s)!=s){--e;break}if(e===t.length)break}s.id=Number(t.substring(i,e+1))}if(t.charAt(++e)){const i=this.tryParse(t.substr(e));if(Xt.isPayloadValid(s.type,i)){s.data=i}else{throw new Error("invalid payload")}}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(t){return false}}static isPayloadValid(t,e){switch(t){case Gt.CONNECT:return Wt(e);case Gt.DISCONNECT:return e===undefined;case Gt.CONNECT_ERROR:return typeof e==="string"||Wt(e);case Gt.EVENT:case Gt.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]==="number"||typeof e[0]==="string"&&qt.indexOf(e[0])===-1);case Gt.ACK:case Gt.BINARY_ACK:return Array.isArray(e)}}destroy(){if(this.reconstructor){this.reconstructor.finishedReconstruction();this.reconstructor=null}}}class zt{constructor(t){this.packet=t;this.buffers=[];this.reconPack=t}takeBinaryData(t){this.buffers.push(t);if(this.buffers.length===this.reconPack.attachments){const t=Ft(this.reconPack,this.buffers);this.finishedReconstruction();return t}return null}finishedReconstruction(){this.reconPack=null;this.buffers=[]}}const Jt=Object.freeze({__proto__:null,protocol:Vt,get PacketType(){return Gt},Encoder:Ht,Decoder:Xt});function Kt(t,e,s){t.on(e,s);return function i(){t.off(e,s)}}const Qt=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Zt extends F{constructor(t,e,s){super();this.connected=false;this.recovered=false;this.receiveBuffer=[];this.sendBuffer=[];this._queue=[];this._queueSeq=0;this.ids=0;this.acks={};this.flags={};this.io=t;this.nsp=e;if(s&&s.auth){this.auth=s.auth}this._opts=Object.assign({},s);if(this.io._autoConnect)this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[Kt(t,"open",this.onopen.bind(this)),Kt(t,"packet",this.onpacket.bind(this)),Kt(t,"error",this.onerror.bind(this)),Kt(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){if(this.connected)return this;this.subEvents();if(!this.io["_reconnecting"])this.io.open();if("open"===this.io._readyState)this.onopen();return this}open(){return this.connect()}send(...t){t.unshift("message");this.emit.apply(this,t);return this}emit(t,...e){var s,i,n;if(Qt.hasOwnProperty(t)){throw new Error('"'+t.toString()+'" is a reserved event name')}e.unshift(t);if(this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile){this._addToQueue(e);return this}const r={type:Gt.EVENT,data:e};r.options={};r.options.compress=this.flags.compress!==false;if("function"===typeof e[e.length-1]){const t=this.ids++;const s=e.pop();this._registerAckCallback(t,s);r.id=t}const o=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable;const h=this.connected&&!((n=this.io.engine)===null||n===void 0?void 0:n._hasPingExpired());const c=this.flags.volatile&&!o;if(c);else if(h){this.notifyOutgoingListeners(r);this.packet(r)}else{this.sendBuffer.push(r)}this.flags={};return this}_registerAckCallback(t,e){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===undefined){this.acks[t]=e;return}const n=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++){if(this.sendBuffer[e].id===t){this.sendBuffer.splice(e,1)}}e.call(this,new Error("operation has timed out"))}),i);const r=(...t)=>{this.io.clearTimeoutFn(n);e.apply(this,t)};r.withError=true;this.acks[t]=r}emitWithAck(t,...e){return new Promise(((s,i)=>{const n=(t,e)=>t?i(t):s(e);n.withError=true;e.push(n);this.emit(t,...e)}))}_addToQueue(t){let e;if(typeof t[t.length-1]==="function"){e=t.pop()}const s={id:this._queueSeq++,tryCount:0,pending:false,args:t,flags:Object.assign({fromQueue:true},this.flags)};t.push(((t,...i)=>{if(s!==this._queue[0]){return}const n=t!==null;if(n){if(s.tryCount>this._opts.retries){this._queue.shift();if(e){e(t)}}}else{this._queue.shift();if(e){e(null,...i)}}s.pending=false;return this._drainQueue()}));this._queue.push(s);this._drainQueue()}_drainQueue(t=false){if(!this.connected||this._queue.length===0){return}const e=this._queue[0];if(e.pending&&!t){return}e.pending=true;e.tryCount++;this.flags=e.flags;this.emit.apply(this,e.args)}packet(t){t.nsp=this.nsp;this.io._packet(t)}onopen(){if(typeof this.auth=="function"){this.auth((t=>{this._sendConnectPacket(t)}))}else{this._sendConnectPacket(this.auth)}}_sendConnectPacket(t){this.packet({type:Gt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){if(!this.connected){this.emitReserved("connect_error",t)}}onclose(t,e){this.connected=false;delete this.id;this.emitReserved("disconnect",t,e);this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach((t=>{const e=this.sendBuffer.some((e=>String(e.id)===t));if(!e){const e=this.acks[t];delete this.acks[t];if(e.withError){e.call(this,new Error("socket has been disconnected"))}}}))}onpacket(t){const e=t.nsp===this.nsp;if(!e)return;switch(t.type){case Gt.CONNECT:if(t.data&&t.data.sid){this.onconnect(t.data.sid,t.data.pid)}else{this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"))}break;case Gt.EVENT:case Gt.BINARY_EVENT:this.onevent(t);break;case Gt.ACK:case Gt.BINARY_ACK:this.onack(t);break;case Gt.DISCONNECT:this.ondisconnect();break;case Gt.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data;this.emitReserved("connect_error",e);break}}onevent(t){const e=t.data||[];if(null!=t.id){e.push(this.ack(t.id))}if(this.connected){this.emitEvent(e)}else{this.receiveBuffer.push(Object.freeze(e))}}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const s of e){s.apply(this,t)}}super.emit.apply(this,t);if(this._pid&&t.length&&typeof t[t.length-1]==="string"){this._lastOffset=t[t.length-1]}}ack(t){const e=this;let s=false;return function(...i){if(s)return;s=true;e.packet({type:Gt.ACK,id:t,data:i})}}onack(t){const e=this.acks[t.id];if(typeof e!=="function"){return}delete this.acks[t.id];if(e.withError){t.data.unshift(null)}e.apply(this,t.data)}onconnect(t,e){this.id=t;this.recovered=e&&this._pid===e;this._pid=e;this.connected=true;this.emitBuffered();this.emitReserved("connect");this._drainQueue(true)}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t)));this.receiveBuffer=[];this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t);this.packet(t)}));this.sendBuffer=[]}ondisconnect(){this.destroy();this.onclose("io server disconnect")}destroy(){if(this.subs){this.subs.forEach((t=>t()));this.subs=undefined}this.io["_destroy"](this)}disconnect(){if(this.connected){this.packet({type:Gt.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}close(){return this.disconnect()}compress(t){this.flags.compress=t;return this}get volatile(){this.flags.volatile=true;return this}timeout(t){this.flags.timeout=t;return this}onAny(t){this._anyListeners=this._anyListeners||[];this._anyListeners.push(t);return this}prependAny(t){this._anyListeners=this._anyListeners||[];this._anyListeners.unshift(t);return this}offAny(t){if(!this._anyListeners){return this}if(t){const e=this._anyListeners;for(let s=0;s<e.length;s++){if(t===e[s]){e.splice(s,1);return this}}}else{this._anyListeners=[]}return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.push(t);return this}prependAnyOutgoing(t){this._anyOutgoingListeners=this._anyOutgoingListeners||[];this._anyOutgoingListeners.unshift(t);return this}offAnyOutgoing(t){if(!this._anyOutgoingListeners){return this}if(t){const e=this._anyOutgoingListeners;for(let s=0;s<e.length;s++){if(t===e[s]){e.splice(s,1);return this}}}else{this._anyOutgoingListeners=[]}return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const s of e){s.apply(this,t.data)}}}}function te(t){t=t||{};this.ms=t.min||100;this.max=t.max||1e4;this.factor=t.factor||2;this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0;this.attempts=0}te.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random();var s=Math.floor(e*this.jitter*t);t=(Math.floor(e*10)&1)==0?t-s:t+s}return Math.min(t,this.max)|0};te.prototype.reset=function(){this.attempts=0};te.prototype.setMin=function(t){this.ms=t};te.prototype.setMax=function(t){this.max=t};te.prototype.setJitter=function(t){this.jitter=t};class ee extends F{constructor(t,e){var s;super();this.nsps={};this.subs=[];if(t&&"object"===typeof t){e=t;t=undefined}e=e||{};e.path=e.path||"/socket.io";this.opts=e;J(this,e);this.reconnection(e.reconnection!==false);this.reconnectionAttempts(e.reconnectionAttempts||Infinity);this.reconnectionDelay(e.reconnectionDelay||1e3);this.reconnectionDelayMax(e.reconnectionDelayMax||5e3);this.randomizationFactor((s=e.randomizationFactor)!==null&&s!==void 0?s:.5);this.backoff=new te({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==e.timeout?2e4:e.timeout);this._readyState="closed";this.uri=t;const i=e.parser||Jt;this.encoder=new i.Encoder;this.decoder=new i.Decoder;this._autoConnect=e.autoConnect!==false;if(this._autoConnect)this.open()}reconnection(t){if(!arguments.length)return this._reconnection;this._reconnection=!!t;if(!t){this.skipReconnect=true}return this}reconnectionAttempts(t){if(t===undefined)return this._reconnectionAttempts;this._reconnectionAttempts=t;return this}reconnectionDelay(t){var e;if(t===undefined)return this._reconnectionDelay;this._reconnectionDelay=t;(e=this.backoff)===null||e===void 0?void 0:e.setMin(t);return this}randomizationFactor(t){var e;if(t===undefined)return this._randomizationFactor;this._randomizationFactor=t;(e=this.backoff)===null||e===void 0?void 0:e.setJitter(t);return this}reconnectionDelayMax(t){var e;if(t===undefined)return this._reconnectionDelayMax;this._reconnectionDelayMax=t;(e=this.backoff)===null||e===void 0?void 0:e.setMax(t);return this}timeout(t){if(!arguments.length)return this._timeout;this._timeout=t;return this}maybeReconnectOnOpen(){if(!this._reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Dt(this.uri,this.opts);const e=this.engine;const s=this;this._readyState="opening";this.skipReconnect=false;const i=Kt(e,"open",(function(){s.onopen();t&&t()}));const n=e=>{this.cleanup();this._readyState="closed";this.emitReserved("error",e);if(t){t(e)}else{this.maybeReconnectOnOpen()}};const r=Kt(e,"error",n);if(false!==this._timeout){const t=this._timeout;const s=this.setTimeoutFn((()=>{i();n(new Error("timeout"));e.close()}),t);if(this.opts.autoUnref){s.unref()}this.subs.push((()=>{this.clearTimeoutFn(s)}))}this.subs.push(i);this.subs.push(r);return this}connect(t){return this.open(t)}onopen(){this.cleanup();this._readyState="open";this.emitReserved("open");const t=this.engine;this.subs.push(Kt(t,"ping",this.onping.bind(this)),Kt(t,"data",this.ondata.bind(this)),Kt(t,"error",this.onerror.bind(this)),Kt(t,"close",this.onclose.bind(this)),Kt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(t){this.onclose("parse error",t)}}ondecoded(t){q((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let s=this.nsps[t];if(!s){s=new Zt(this,t,e);this.nsps[t]=s}else if(this._autoConnect&&!s.active){s.connect()}return s}_destroy(t){const e=Object.keys(this.nsps);for(const t of e){const e=this.nsps[t];if(e.active){return}}this._close()}_packet(t){const e=this.encoder.encode(t);for(let s=0;s<e.length;s++){this.engine.write(e[s],t.options)}}cleanup(){this.subs.forEach((t=>t()));this.subs.length=0;this.decoder.destroy()}_close(){this.skipReconnect=true;this._reconnecting=false;this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var s;this.cleanup();(s=this.engine)===null||s===void 0?void 0:s.close();this.backoff.reset();this._readyState="closed";this.emitReserved("close",t,e);if(this._reconnection&&!this.skipReconnect){this.reconnect()}}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts){this.backoff.reset();this.emitReserved("reconnect_failed");this._reconnecting=false}else{const e=this.backoff.duration();this._reconnecting=true;const s=this.setTimeoutFn((()=>{if(t.skipReconnect)return;this.emitReserved("reconnect_attempt",t.backoff.attempts);if(t.skipReconnect)return;t.open((e=>{if(e){t._reconnecting=false;t.reconnect();this.emitReserved("reconnect_error",e)}else{t.onreconnect()}}))}),e);if(this.opts.autoUnref){s.unref()}this.subs.push((()=>{this.clearTimeoutFn(s)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=false;this.backoff.reset();this.emitReserved("reconnect",t)}}const se={};function ie(t,e){if(typeof t==="object"){e=t;t=undefined}e=e||{};const s=Pt(t,e.path||"/socket.io");const i=s.source;const n=s.id;const r=s.path;const o=se[n]&&r in se[n]["nsps"];const h=e.forceNew||e["force new connection"]||false===e.multiplex||o;let c;if(h){c=new ee(i,e)}else{if(!se[n]){se[n]=new ee(i,e)}c=se[n]}if(s.query&&!e.query){e.query=s.queryKey}return c.socket(s.path,e)}Object.assign(ie,{Manager:ee,Socket:Zt,io:ie,connect:ie});export{d as P,ie as l};
//# sourceMappingURL=p-5cec3769.js.map