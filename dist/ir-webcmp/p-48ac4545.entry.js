import{r as t,h as i,H as e}from"./p-ee49d535.js";import{P as s,p as n}from"./p-21a63648.js";import{R as a}from"./p-f6f26236.js";import{l as o}from"./p-806fad31.js";import{a as l}from"./p-06203439.js";import"./p-dfa14c12.js";import"./p-4eb12235.js";import"./p-6bab2172.js";const r=".sc-ir-payment-option-h{display:block}.payment-table-container.sc-ir-payment-option{display:flex;align-items:center;justify-content:center}.po-view.sc-ir-payment-option{padding:0;margin:0}.payment-img.sc-ir-payment-option{height:18px;display:none}@media (min-width: 768px){.po-view.sc-ir-payment-option{display:flex;align-items:center;justify-content:space-between;gap:0.5rem}.dataTable.sc-ir-payment-option{width:70%}.payment-img.sc-ir-payment-option{display:block}.actions-header.sc-ir-payment-option{width:max-content !important}.payment-table-container.sc-ir-payment-option{justify-content:flex-start}}@media (min-width: 1280px){.dataTable.sc-ir-payment-option{width:50%}}";const c=r;const h=class{constructor(i){t(this,i);this.paymentOptionService=new s;this.roomService=new a;this.baseurl=undefined;this.propertyid=undefined;this.ticket=undefined;this.language="en";this.paymentOptions=[];this.isLoading=false;this.selectedOption=null}componentWillLoad(){l.defaults.baseURL=this.baseurl;if(this.ticket){this.init()}}handleTokenChange(t,i){if(t!==i){this.init()}}init(){this.initServices();this.fetchData()}handleCloseModal(t){t.stopPropagation();t.stopImmediatePropagation();console.log(t.detail);this.closeModal(t.detail)}closeModal(t){var i,e;if(t){this.modifyPaymentList(t);if(t.is_payment_gateway){this.propertyOptionsById.set(t.id,t)}else{this.propertyOptionsByCode.set(t.code,t)}}else{if(!this.propertyOptionsByCode.has((i=n.selectedOption)===null||i===void 0?void 0:i.code)&&!this.propertyOptionsById.has((e=n.selectedOption)===null||e===void 0?void 0:e.id)){this.modifyPaymentList(Object.assign(Object.assign({},n.selectedOption),{is_active:false}))}}n.selectedOption=null;n.mode=null}async fetchData(){try{this.isLoading=true;const[t,i,e]=await Promise.all([this.paymentOptionService.GetExposedPaymentMethods(),this.paymentOptionService.GetPropertyPaymentMethods(this.propertyid),this.roomService.fetchLanguage(this.language,["_PAYMENT_BACK"])]);o.entries=e.entries;o.direction=e.direction;this.propertyOptionsById=new Map(i.map((t=>[t.id,t])));this.propertyOptionsByCode=new Map(i.map((t=>[t.code,t])));this.paymentOptions=t===null||t===void 0?void 0:t.map((t=>{if(t.is_payment_gateway){return this.propertyOptionsById.get(t.id)||t}return this.propertyOptionsByCode.get(t.code)||t}))}catch(t){console.log(t)}finally{this.isLoading=false}}initServices(){n.token=this.ticket;this.paymentOptionService.setToken(this.ticket);this.roomService.setToken(this.ticket)}modifyPaymentList(t){this.paymentOptions=[...this.paymentOptions.map((i=>{if(t.is_payment_gateway&&i.id===t.id||t.code==="005"&&i.code==="005"){return t}return i}))]}async handleCheckChange(t,i){var e;t.stopPropagation();t.stopImmediatePropagation();const s=t.detail;const a=Object.assign(Object.assign({},i),{is_active:s,property_id:this.propertyid});if(i.code!=="005"&&!i.is_payment_gateway){await this.paymentOptionService.HandlePaymentMethod(a);this.modifyPaymentList(a);return}if(!this.showEditButton(i)){this.modifyPaymentList(a);return}if(s&&((e=i.data)===null||e===void 0?void 0:e.some((t=>t.value===null)))){n.mode="create";n.selectedOption=a}else{await this.paymentOptionService.HandlePaymentMethod(a)}this.modifyPaymentList(a)}showEditButton(t){var i;if(!t.is_payment_gateway&&t.code!=="005"){return false}return t.code==="005"||t.is_payment_gateway&&((i=t.data)===null||i===void 0?void 0:i.length)>0}render(){var t,s;if(this.isLoading||this.paymentOptions.length==0){return i("div",{class:"h-screen bg-white d-flex flex-column align-items-center justify-content-center"},i("ir-loading-screen",null))}return i(e,{class:"p-2"},i("ir-toast",null),i("ir-interceptor",null),i("div",{class:"card p-1 flex-fill m-0"},i("div",{class:"d-flex align-items-center mb-2"},i("div",{class:"p-0 m-0 mr-1"},i("ir-icons",{name:"credit_card"})),i("h3",{class:"m-0 p-0"},o.entries.Lcz_PaymentOptions)),i("div",{class:"payment-table-container"},i("table",{class:"table table-striped table-bordered no-footer dataTable"},i("thead",null,i("tr",null,i("th",{scope:"col",class:"text-left"},o.entries.Lcz_PaymentMethod),i("th",{scope:"col"},o.entries.Lcz_Status),i("th",{scope:"col",class:"actions-header"},o.entries.Lcz_Action))),i("tbody",{class:""},(t=this.paymentOptions)===null||t===void 0?void 0:t.map((t=>{if(t.code==="004"){return null}return i("tr",{key:t.id},i("td",{class:"text-left po-description"},i("div",{class:"po-view"},i("span",{class:"p-0 m-0"},t.description))),i("td",null,i("ir-switch",{checked:t.is_active,onCheckChange:i=>this.handleCheckChange(i,t)})),i("td",{class:"payment-action"},this.showEditButton(t)&&i("ir-button",{title:o.entries.Lcz_Edit,variant:"icon",icon_name:"edit",onClickHanlder:()=>{n.selectedOption=t;n.mode="edit"}})))})))))),i("ir-sidebar",{onIrSidebarToggle:()=>{this.closeModal(null)},label:o.entries.Lcz_Information.replace("%1",(s=n.selectedOption)===null||s===void 0?void 0:s.description),open:n.selectedOption!==null},n.selectedOption&&i("ir-option-details",{propertyId:this.propertyid,slot:"sidebar-body"})))}static get watchers(){return{ticket:["handleTokenChange"]}}};h.style=c;export{h as ir_payment_option};
//# sourceMappingURL=p-48ac4545.entry.js.map