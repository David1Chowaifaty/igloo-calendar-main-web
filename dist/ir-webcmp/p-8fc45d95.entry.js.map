{"version":3,"names":["irListingModalCss","IrListingModalStyle0","IrListingModal","modalTitle","editBooking","paymentEntries","isOpen","deletionStage","selectedDesignation","loadingBtn","bookingListingsService","BookingListingService","paymentService","PaymentService","componentWillLoad","this","methods","modalClosed","resetData","closeModal","emit","openModal","filterBookings","booking_listing","bookings","filter","booking","booking_nbr","btnClickHandler","event","target","name","cause","paymentType","types","find","pt","CODE_NAME","financial","due_amount","AddPayment","amount","includes","status","code","Math","abs","cancelation_penality_as_if_today","currency","date","moment","format","designation","CODE_VALUE_EN","payment_method","description","operation","NOTES","payment_type","id","reference","removeExposedBooking","error","console","renderTitle","locales","entries","Lcz_MarkBookingAsPaid","replace","Lcz_SureYouWantToDeleteBookingNbr","renderConfirmationTitle","Lcz_Confirm","renderCancellationTitle","Lcz_Cancel","handleDropdownChange","e","stopImmediatePropagation","stopPropagation","value","detail","toString","log","warn","render","h","class","onClick","tabindex","style","cursor","slot","xmlns","height","width","viewBox","fill","d","selectedValue","onSelectChange","bind","showFirstOption","data","map","m","text","isLoading","btn_color","btn_block"],"sources":["src/components/ir-booking-listing/ir-listing-modal/ir-listing-modal.css?tag=ir-listing-modal&encapsulation=scoped","src/components/ir-booking-listing/ir-listing-modal/ir-listing-modal.tsx"],"sourcesContent":[".backdropModal {\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 1000;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100vh;\n  width: 100%;\n  opacity: 0;\n  transition: opacity 0.3s ease-in-out;\n  pointer-events: none;\n}\n.backdropModal.active {\n  cursor: pointer;\n  opacity: 1 !important;\n  pointer-events: all;\n}\n\n.ir-modal[data-state='opened'] {\n  opacity: 1;\n  /* transform: translate(-50%, 0); */\n  visibility: visible; /* Make modal visible */\n  pointer-events: all; /* Restore pointer events */\n  transition: all 0.3s ease-in-out;\n}\n.ir-alert-content {\n  padding: 10px;\n  background: white;\n  border-radius: 5px;\n}\n.modal {\n  z-index: 1001 !important;\n}\n\n.modal-dialog {\n  height: 100vh;\n  display: flex;\n  align-items: center;\n}\n.ir-alert-footer {\n  gap: 10px;\n}\n.exit-icon {\n  position: absolute;\n  right: 10px;\n  top: 5px;\n  margin: 0;\n}\n.ir-modal {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1050;\n  width: 90%;\n  max-width: 32rem;\n  overflow: hidden;\n  outline: 0;\n  opacity: 0;\n  transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;\n  visibility: hidden;\n  pointer-events: none;\n}\n\n.ir-modal.active {\n  opacity: 1;\n  transform: translate(-50%, 0);\n  visibility: visible; /* Make modal visible */\n  pointer-events: all; /* Restore pointer events */\n  transition: all 0.3s ease-in-out;\n}\n","import booking_listing from '@/stores/booking_listing.store';\nimport { Component, EventEmitter, Listen, Method, Prop, State, h, Event } from '@stencil/core';\nimport { Booking } from '@/models/booking.dto';\nimport locales from '@/stores/locales.store';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { PaymentService } from '@/services/payment.service';\nimport moment from 'moment';\nimport { IEntries } from '@/models/property';\nimport { PaymentEntries } from '@/components/ir-booking-details/types';\n\n@Component({\n  tag: 'ir-listing-modal',\n  styleUrl: 'ir-listing-modal.css',\n  scoped: true,\n})\nexport class IrListingModal {\n  @Prop() modalTitle: string = 'Modal Title';\n  @Prop() editBooking: { booking: Booking; cause: 'edit' | 'payment' | 'delete' | 'guest' };\n  @Prop() paymentEntries: PaymentEntries;\n\n  @State() isOpen: boolean = false;\n  @State() deletionStage = 2;\n  @State() selectedDesignation: IEntries;\n  @State() loadingBtn: 'confirm' | 'just_delete' | 'recover_and_delete' | null = null;\n\n  private bookingListingsService = new BookingListingService();\n  private paymentService = new PaymentService();\n\n  componentWillLoad() {\n    this.selectedDesignation = this.paymentEntries.methods[0];\n  }\n\n  @Event() modalClosed: EventEmitter<null>;\n  @Event() resetData: EventEmitter<string>;\n\n  @Method()\n  async closeModal() {\n    this.isOpen = false;\n    // this.deletionStage = 1;\n    this.selectedDesignation = this.paymentEntries.methods[0];\n    this.modalClosed.emit(null);\n  }\n  @Method()\n  async openModal() {\n    this.isOpen = true;\n  }\n  filterBookings() {\n    booking_listing.bookings = booking_listing.bookings.filter(booking => booking.booking_nbr !== this.editBooking.booking.booking_nbr);\n  }\n\n  @Listen('clickHandler')\n  async btnClickHandler(event: CustomEvent) {\n    let target = event.target as HTMLInputElement;\n    let name = target.name;\n    try {\n      if (name === 'confirm') {\n        this.loadingBtn = 'confirm';\n        if (this.editBooking.cause === 'payment') {\n          const paymentType = this.paymentEntries.types.find(pt => pt.CODE_NAME === (this.editBooking.booking.financial.due_amount < 0 ? '010' : '001'));\n          await this.paymentService.AddPayment(\n            {\n              amount: ['003', '004'].includes(this.editBooking.booking.status.code)\n                ? Math.abs(this.editBooking.booking.financial.cancelation_penality_as_if_today)\n                : this.editBooking.booking.financial.due_amount,\n              currency: this.editBooking.booking.currency,\n              date: moment().format('YYYY-MM-DD'),\n              designation: this.selectedDesignation.CODE_VALUE_EN,\n              payment_method: {\n                code: this.selectedDesignation.CODE_NAME,\n                description: this.selectedDesignation.CODE_VALUE_EN,\n                operation: this.selectedDesignation.NOTES,\n              },\n              payment_type: {\n                code: paymentType.CODE_NAME,\n                description: paymentType.CODE_VALUE_EN,\n                operation: paymentType.NOTES,\n              },\n              id: -1,\n              reference: '',\n            },\n            this.editBooking.booking.booking_nbr,\n          );\n          this.resetData.emit(this.editBooking.booking.booking_nbr);\n          // this.closeModal();\n        } else {\n          if (this.deletionStage === 2) {\n            // this.loadingBtn = 'recover_and_delete';\n            await this.bookingListingsService.removeExposedBooking(this.editBooking.booking.booking_nbr, true);\n            this.filterBookings();\n          }\n          // if (this.deletionStage === 1) {\n          //   this.deletionStage = 2;\n          // }\n        }\n      }\n      if (name === 'cancel') {\n        // if (this.deletionStage === 2) {\n        //   this.loadingBtn = 'just_delete';\n        //   await this.bookingListingsService.removeExposedBooking(this.editBooking.booking.booking_nbr, false);\n        //   this.filterBookings();\n        // } else {\n        //   this.closeModal();\n        // }\n        this.closeModal();\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      if (this.loadingBtn) {\n        this.loadingBtn = null;\n        this.closeModal();\n      }\n    }\n  }\n\n  renderTitle() {\n    if (this.editBooking.cause === 'payment') {\n      return locales.entries?.Lcz_MarkBookingAsPaid.replace('%1', this.editBooking.booking.booking_nbr);\n    } else {\n      // if (this.deletionStage === 1) {\n      //   return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\n      // }\n      // return locales.entries.Lcz_WantToRecoverAllotment;\n      return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\n    }\n  }\n  renderConfirmationTitle() {\n    // if (this.deletionStage === 2) {\n    //   return locales.entries.Lcz_RecoverAndDelete;\n    // }\n    return locales.entries.Lcz_Confirm;\n  }\n  renderCancellationTitle() {\n    // if (this.deletionStage === 2) {\n    //   return locales.entries.Lcz_JustDelete;\n    // }\n    return locales.entries.Lcz_Cancel;\n  }\n  private handleDropdownChange(e: CustomEvent<string | number>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const value = e.detail.toString();\n    console.log(value);\n\n    const payment_method = this.paymentEntries.methods.find(pt => pt.CODE_NAME === value);\n    if (!payment_method) {\n      console.warn(`Invalid payment method ${e.detail}`);\n\n      return;\n    }\n    this.selectedDesignation = payment_method;\n  }\n  render() {\n    if (!this.editBooking) {\n      return null;\n    }\n    return [\n      <div\n        class={`backdropModal ${this.isOpen ? 'active' : ''}`}\n        onClick={() => {\n          if (this.editBooking.cause === 'delete') {\n            return;\n          }\n          this.closeModal();\n        }}\n      ></div>,\n      <div data-state={this.isOpen ? 'opened' : 'closed'} class={`ir-modal`} tabindex=\"-1\">\n        {this.isOpen && (\n          <div class={`ir-alert-content p-2`}>\n            <div class={`ir-alert-header align-items-center border-0 py-0 m-0 `}>\n              <p class=\"p-0 my-0 mb-1\">{this.renderTitle()}</p>\n              <ir-icon\n                class=\"exit-icon\"\n                style={{ cursor: 'pointer' }}\n                onClick={() => {\n                  this.closeModal();\n                }}\n              >\n                <svg slot=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" height=\"14\" width=\"10.5\" viewBox=\"0 0 384 512\">\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"\n                  />\n                </svg>\n              </ir-icon>\n            </div>\n            <div class=\"modal-body text-left p-0 mb-2\">\n              {this.editBooking.cause === 'payment' ? (\n                <ir-select\n                  selectedValue={this.selectedDesignation?.CODE_NAME}\n                  onSelectChange={this.handleDropdownChange.bind(this)}\n                  showFirstOption={false}\n                  data={this.paymentEntries.methods?.map(m => ({\n                    value: m.CODE_NAME,\n                    text: m.CODE_VALUE_EN,\n                  }))}\n                ></ir-select>\n              ) : null}\n            </div>\n\n            <div class={`ir-alert-footer border-0 d-flex justify-content-end`}>\n              <ir-button isLoading={this.loadingBtn === 'just_delete'} btn_color={'secondary'} btn_block text={this.renderCancellationTitle()} name={'cancel'}></ir-button>\n              <ir-button\n                isLoading={this.loadingBtn === 'confirm'}\n                // isLoading={this.loadingBtn === 'recover_and_delete'}\n                btn_color={'primary'}\n                btn_block\n                text={this.renderConfirmationTitle()}\n                name={'confirm'}\n              ></ir-button>\n            </div>\n          </div>\n        )}\n      </div>,\n    ];\n  }\n}\n"],"mappings":"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","ignoreList":[]}