import{a as t}from"./p-bf44a732.js";import{z as e,u as n,n as o,s as r,o as a,b as s,c as i,e as c,d as _,f as l,g as u}from"./p-e7d273da.js";import{j as d,i as E,e as f,w as p,x as y,h as m}from"./p-34faae7c.js";import{h as w}from"./p-6c4ba7c0.js";import{l as b}from"./p-e58470d9.js";import{c as T}from"./p-2925ded6.js";import{c as h}from"./p-d6d6fb27.js";const g={days:[],months:[],fromDate:"",toDate:"",disabled_cells:new Map,cleaningTasks:new Map};const{state:D,onChange:O}=T(g);function A(t){const e=new Map;for(const n of t){const t=new Map(e.get(n.unit.id)??new Map);t.set(n.date,n);e.set(n.unit.id,t)}D.cleaningTasks=new Map(e)}function I({unitId:t,date:e}){const n=new Map(D.cleaningTasks);if(!n.has(t)){return}const o=new Map(n.get(t));o.delete(e);n.set(t,o);D.cleaningTasks=new Map(n)}function R({unitId:t,date:e,task:n}){const o=new Map(D.cleaningTasks);const r=new Map(o.get(t)??new Map);r.set(e,n??e);o.set(t,r);D.cleaningTasks=new Map(o)}function S(t){if(!t){return}const e=new Map;const n=new Map;for(const o of t){if(!o?.identifier)continue;const t=o.identifier;const r=o.parent_room_identifier??null;e.set(t,r);if(r){if(!n.has(r))n.set(r,[]);n.get(r).push(t)}else{if(!n.has(t))n.set(t,[])}}const o=new Map(t.map((t=>[t.identifier,t])));for(const[t,e]of n){e.sort(((t,e)=>{const n=o.get(t)?.from_date??"";const r=o.get(e)?.from_date??"";if(n<r)return-1;if(n>r)return 1;return t.localeCompare(e)}))}const r=[];for(const t of e.keys()){const n=e.get(t);if(!n||!e.has(n))r.push(t)}const a=new Map;const s=new Map;const i=t=>{const e=[];const o=new Set;let r=t;while(r&&!o.has(r)){o.add(r);e.push(r);const t=n.get(r)??[];r=t[0]}for(let t=0;t<e.length;t++){const n=e[t];const o=t>0;const r=t<e.length-1;const i=o&&r?"fullSplit":o?"leftSplit":r?"rightSplit":null;a.set(n,i);s.set(n,e)}};for(const t of r)i(t);for(const t of e.keys()){if(!s.has(t))i(t)}return{parentOf:e,childrenOf:n,roleOf:a,chainOf:s,heads:r}}function N(t,e){return t.roleOf.get(e)??null}async function k(t){if(!t?.length){return[]}const e=await C();const n=new Map(e.map((t=>[t.code,t.value])));const o=new Map;for(const e of t){for(const t of e.days){for(const e of t.room_types){M(e.physicalrooms,o,n)}}}return Array.from(o.values())}function M(t,e,n){if(!t?.length){return}for(const o of t){const t=o?.calendar_cell?Object.values(o.calendar_cell):[];for(const o of t){if(o?.Is_Available===false){x(o,e,n)}}}}const v={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const Y={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function B(t,e){if(t===null&&e===null||!t)return"";if(!!e){return`${t??""} ${e??""}`}return t}async function C(){try{const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_Multi`,{TBL_NAMES:["_STAY_STATUS"]});return e.My_Result.map((t=>({code:t.CODE_NAME,value:t.CODE_VALUE_EN})))}catch(t){console.log(t);return[]}}function P(t,e,n){const o=new Date(t);o.setHours(e);o.setMinutes(n);return`${b.entries.Lcz_BlockedTill} ${w(o).format("MMM DD, HH:mm")}`}function L(t,e){if(E(t.STAY_STATUS_CODE)){const n=w(t.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.from_date:t.DATE;const o=w(t.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.to_date:t.DATE;return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.My_Block_Info.NOTES!==""&&t.My_Block_Info.NOTES!==null?t.My_Block_Info.NOTES:t.STAY_STATUS_CODE==="003"?P(t.My_Block_Info.BLOCKED_TILL_DATE,t.My_Block_Info.BLOCKED_TILL_HOUR,t.My_Block_Info.BLOCKED_TILL_MINUTE):e.get(t.STAY_STATUS_CODE)||"",RELEASE_AFTER_HOURS:t.My_Block_Info.DESCRIPTION,PR_ID:t.My_Block_Info.pr_id,ENTRY_DATE:t.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:t.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.My_Block_Info.NOTES,FROM_DATE:n,TO_DATE:o,NO_OF_DAYS:d(n,o),STATUS:v[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.My_Block_Info.format.from_date,TO_DATE_STR:t.My_Block_Info.format.to_date,defaultDates:{from_date:t.My_Block_Info.from_date,to_date:t.My_Block_Info.to_date}}}try{const e=w(t.room.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.from_date:t.DATE;const n=w(t.room.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.to_date:t.DATE;const o=t.room.sharing_persons?.find((t=>t.is_main));return{ID:t.POOL,FROM_DATE:e,TO_DATE:n,NO_OF_DAYS:d(e,n),STATUS:Y[t.booking?.status.code],NAME:B(o?.first_name,o?.last_name)||B(t?.booking.guest?.first_name,t?.booking?.guest?.last_name),IDENTIFIER:t.room.identifier,PR_ID:t.pr_id,POOL:t.POOL,BOOKING_NUMBER:t.booking.booking_nbr,NOTES:t.booking.is_direct?t.booking.remark:null,PRIVATE_NOTE:G(t.booking.extras),is_direct:t.booking.is_direct,BALANCE:t.booking.financial?.due_amount,channel_booking_nbr:t.booking.channel_booking_nbr,ARRIVAL_TIME:t.booking.arrival.description,defaultDates:{from_date:t.room.from_date,to_date:t.room.to_date},DEPARTURE_TIME:t.room.departure_time,ENTRY_DATE:t.booking.booked_on.date,PHONE_PREFIX:t.booking.guest.country_phone_prefix,IS_EDITABLE:t.booking.is_editable,ARRIVAL:t.booking.arrival,PHONE:t.booking.guest.mobile_without_prefix??"",RATE:t.room.total,RATE_PLAN:t.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:t.room.rateplan.id,RATE_TYPE:t.room?.roomtype?.id,ADULTS_COUNT:t.room.occupancy.adult_nbr,CHILDREN_COUNT:t.room.occupancy.children_nbr,origin:t.booking.origin,GUEST:t.booking.guest,ROOMS:t.booking.rooms,cancelation:t.room.rateplan.cancelation,guarantee:t.room.rateplan.guarantee,TOTAL_PRICE:t.booking.financial?.gross_total,COUNTRY:t.booking.guest.country_id,FROM_DATE_STR:t.booking.format.from_date,TO_DATE_STR:t.booking.format.to_date,adult_child_offering:t.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:t.booking.source.code,description:t.booking.source.description,tag:t.booking.source.tag},CHECKIN:t.room.in_out?.code==="001",CHECKOUT:t.room.in_out?.code==="002",ROOM_INFO:{occupancy:t.room.occupancy,sharing_persons:t.room.sharing_persons,unit:t.room.unit,in_out:t.room.in_out,calendar_extra:t.room.calendar_extra?JSON.parse(t.room.calendar_extra):null,parent_room_identifier:t.room.parent_room_identifier},BASE_STATUS_CODE:t.booking.status?.code}}catch(e){console.error(`Something went wrong in cell`);console.log(t);console.error(e)}}function U(t){const{in_out:e,status_code:n,from_date:o,to_date:r}=t;if(h.checkin_enabled){if(e?.code==="001"){return Y["000"]}else if(e?.code==="002"){if(!h.is_automatic_check_in_out){const t=w();const e=w(r,"YYYY-MM-DD");const n=w(o,"YYYY-MM-DD");const a=j(t.toDate(),K(h.checkin_checkout_hours?.offset,h.checkin_checkout_hours?.hour));if(t.isSame(e,"days")&&t.isAfter(n,"days")&&a||t.isAfter(e,"days")){return Y["003"]}else{return Y["002"]}}}return Y[n||"001"]}else{const t=w();const e=w(r,"YYYY-MM-DD");const a=w(o,"YYYY-MM-DD");if(n!=="PENDING"){if(a.isSame(t,"day")&&t.hour()>=12){return Y["000"]}else if(t.isAfter(a,"day")&&t.isBefore(e,"day")){return Y["000"]}else if(e.isSame(t,"day")&&t.hour()<12){return Y["000"]}else if(e.isSame(t,"day")&&t.hour()>=12||e.isBefore(t,"day")){return Y["003"]}else{return Y[n||"001"]}}}}function x(t,e,n){if(!t?.POOL||e.has(t.POOL)){return}const o=L(t,n);if(o){e.set(t.POOL,o)}}function G(t){if(!t){return null}return t.find((t=>t.key==="private_note"))?.value||null}function F(t){let e=[];const n=t.rooms.filter((t=>!!t["assigned_units_pool"]));n.forEach((n=>{const o=w(n.from_date,"YYYY-MM-DD").isAfter(w(D.fromDate,"YYYY-MM-DD"))?n.from_date:D.fromDate;const r=n.to_date;if(w(n.to_date,"YYYY-MM-DD").isBefore(w(D.fromDate,"YYYY-MM-DD"))){return}const a=n.sharing_persons?.find((t=>t.is_main));e.push({CHECKIN:false,CHECKOUT:false,ID:n["assigned_units_pool"],TO_DATE:r,FROM_DATE:o,PRIVATE_NOTE:G(t.extras),NO_OF_DAYS:d(o,r),ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:t.financial?.due_amount,STATUS:U({in_out:n.in_out,from_date:n.from_date,to_date:n.to_date,status_code:t.status?.code}),NAME:B(a?.first_name,a.last_name)||B(n.guest.first_name,n.guest.last_name),PHONE:t.guest.mobile_without_prefix??"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:n.total,RATE_PLAN:n.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:n.rateplan.id,IDENTIFIER:n.identifier,RATE_TYPE:n.roomtype.id,ADULTS_COUNT:n.occupancy.adult_nbr,CHILDREN_COUNT:n.occupancy.children_nbr,PR_ID:+n.unit.id,POOL:n["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:n.rateplan.cancelation,guarantee:n.rateplan.guarantee,TOTAL_PRICE:t.financial?.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:n.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,DEPARTURE_TIME:n.departure_time,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:n.from_date,to_date:n.to_date},ROOM_INFO:{occupancy:n.occupancy,sharing_persons:n.sharing_persons,unit:n.unit,in_out:n.in_out,parent_room_identifier:n.parent_room_identifier,calendar_extra:n.calendar_extra?JSON.parse(n.calendar_extra):null},BASE_STATUS_CODE:t.status?.code})}));return e}async function V(t){const e=await C();return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.NOTES!==""&&t.NOTES!==null?t.NOTES:t.STAY_STATUS_CODE==="003"?P(t.BLOCKED_TILL_DATE,t.BLOCKED_TILL_HOUR,t.BLOCKED_TILL_MINUTE):e.find((e=>e.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.DESCRIPTION,PR_ID:t.pr_id,ENTRY_DATE:t.BLOCKED_TILL_DATE,ENTRY_HOUR:t.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.NOTES,FROM_DATE:t.from_date,TO_DATE:t.to_date,NO_OF_DAYS:H(t.from_date,t.to_date),STATUS:v[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,defaultDates:{from_date:t.from_date,to_date:t.to_date}}}function H(t,e){const n=w(t,"YYYY-MM-DD").startOf("day");const o=w(e,"YYYY-MM-DD").endOf("day");const r=o.diff(n,"days");return r||1}function j(t,e){return t.getHours()>=e.getHours()&&t.getMinutes()>=e.getMinutes()}function K(t,e){const n=new Date;const o=t*60*60*1e3;const r=new Date(n.getTime()+o);const a=r.getUTCFullYear();const s=r.getUTCMonth();const i=r.getUTCDate();const c=e-t;return new Date(Date.UTC(a,s,i,c))}const $={id:-1,email:"",firstName:"",lastName:"",countryId:"",phone_prefix:"",mobile:"",selectedArrivalTime:"",emailGuest:false,note:"",cardNumber:"",cardHolderName:"",expiryMonth:"",expiryYear:""};const z={bookedByGuest:$,bookedByGuestManuallyEdited:false,bookingDraft:{dates:{checkIn:w().startOf("day"),checkOut:w().add(1,"day")},occupancy:{adults:null,children:null},source:null},selects:{sources:[],ratePricingMode:[],arrivalTime:[],bedPreferences:[],countries:[]},checkout_guest:null,guest:null,tax_statement:null,roomTypes:[],enableBooking:false,resetBooking:false,ratePlanSelections:{},selectedPaymentMethod:null,isInFreeCancelationZone:false,bookingAvailabilityParams:{from_date:null,to_date:null,adult_nbr:0,child_nbr:0,infant_nbr:0},booking:null,fictus_booking_nbr:null,event_type:{type:"PLUS_BOOKING"}};let{state:X,onChange:J,reset:W}=T(z);function Z(t){const{bookingDraft:e,selects:n,bookedByGuest:o}=X;W();if(!t){Q(e);nt(o);tt(n)}}function q(){Z(false)}function Q(t){X.bookingDraft={...X.bookingDraft,...t,dates:{...X.bookingDraft.dates,...t.dates},occupancy:{...X.bookingDraft.occupancy,...t.occupancy}}}function tt(t){X.selects={...X.selects,...t}}function et(t,e){if(!t){return null}if(!e||X.resetBooking){return t[0]}return t?.find((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))??null}J("roomTypes",(t=>{const e=X.ratePlanSelections;const n={};t.forEach((t=>{if(!t.is_active)return;n[t.id]=n[t.id]||{};t.rateplans.forEach((o=>{if(!o.is_active||!o?.variations?.length)return;const r=e[t.id]?.[o.id];n[t.id][o.id]=r&&Object.keys(r).length>0?{...r,ratePlan:o,selected_variation:et(o.variations,r.selected_variation)??null,visibleInventory:t.inventory,reserved:t.inventory===0?0:X.resetBooking?0:r.reserved,checkoutVariations:t.inventory===0?[]:r.checkoutVariations,checkoutBedSelection:t.inventory===0?[]:r.checkoutBedSelection,checkoutSmokingSelection:t.inventory===0?[]:r.checkoutSmokingSelection,guestName:t.inventory===0?[]:r.guestName,roomtype:{...r.roomtype}}:{reserved:0,rp_amount:0,view_mode:"001",guest:null,visibleInventory:t.inventory,selected_variation:o?.variations[0]??null,ratePlan:o,guestName:[],is_bed_configuration_enabled:t.is_bed_configuration_enabled,roomtype:{...t,physicalrooms:null,rateplans:null,availabilities:null},checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[]}}))}));X.ratePlanSelections=n;X.resetBooking=false}));function nt(t){X.bookedByGuest={...X.bookedByGuest,...t}}function ot({guest:t,ratePlanId:e,roomTypeId:n,ratePlanSelection:o}){X.ratePlanSelections={...X.ratePlanSelections,[n]:{...X.ratePlanSelections[n],[e]:{...o,guest:[...t]}}}}function rt(t){const e=X.ratePlanSelections[t];if(!e){return}const n=X.roomTypes.find((e=>e.id===t));if(!n){return}const o=Object.values(e).reduce(((t,e)=>t+e.reserved),0);let r=false;const a=Object.entries(e).reduce(((t,[e,a])=>{const s=o-a.reserved;const i=Math.max(n.inventory-s,0);if(a.visibleInventory!==i){r=true;t[e]={...a,visibleInventory:i}}else{t[e]=a}return t}),{});if(r){X.ratePlanSelections={...X.ratePlanSelections,[t]:a}}}function at(){return Object.values(X.ratePlanSelections).some((t=>Object.values(t).some((t=>t.reserved>0))))}function st({ratePlanId:t,roomTypeId:e,params:n}){X.ratePlanSelections={...X.ratePlanSelections,[Number(e)]:{...X.ratePlanSelections[Number(e)],[t]:{...X.ratePlanSelections[e][t],...n}}}}function it({ratePlanId:t,roomTypeId:e,rooms:n,guest:o}){if(!X.ratePlanSelections[e]){X.ratePlanSelections[e]={}}const r=X.roomTypes?.find((t=>t.id===e));if(!r){throw new Error("Invalid room type id")}const a=r.rateplans.find((e=>e.id===t));if(!a){throw new Error("Invalid rate plan")}let s=Array.from({length:n},(()=>({first_name:"",last_name:"",unit:null,bed_preference:null,infant_nbr:null})));if(o){s=o}if(!X.ratePlanSelections[e][t]){X.ratePlanSelections[e][t]={guestName:[],reserved:0,view_mode:"001",rp_amount:0,guest:s,is_bed_configuration_enabled:r.is_bed_configuration_enabled,visibleInventory:0,selected_variation:null,ratePlan:a,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],roomtype:{id:r.id,name:r.name,physicalrooms:null,rateplans:null,availabilities:null,inventory:r.inventory,rate:r.rate,bedding_setup:r.bedding_setup,smoking_option:r.smoking_option,is_bed_configuration_enabled:r.is_bed_configuration_enabled}}}X.ratePlanSelections={...X.ratePlanSelections,[Number(e)]:{...X.ratePlanSelections[Number(e)],[t]:{...X.ratePlanSelections[e][t],reserved:n,checkoutVariations:[],guest:s}}};rt(e)}function ct(t,e){if(!X.ratePlanSelections||!X.ratePlanSelections[t]){return{reserved:0,guest:null,visibleInventory:0,selected_variation:null,ratePlan:null,guestName:[],is_bed_configuration_enabled:false,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],rp_amount:0,view_mode:"001",roomtype:null}}return X.ratePlanSelections[t][e]}function _t(t,e){X[t]=e}function lt(t,e){if(t.is_amount_modified){return t.view_mode==="001"?t.rp_amount:t.rp_amount*e}return t.selected_variation?.discounted_gross_amount??0}function ut(){const t=H(X.bookingDraft.dates.checkIn.format("YYYY-MM-DD"),X.bookingDraft.dates.checkOut.format("YYYY-MM-DD"));let e=0;Object.values(X.ratePlanSelections).forEach((n=>{Object.values(n).forEach((n=>{if(n.reserved===0){return}const o=lt(n,t);e+=o}))}));return e}function dt(){return Object.values(X.ratePlanSelections).reduce(((t,e)=>t+Object.values(e).reduce(((t,e)=>{if(e.reserved===0){return t}return t+e.reserved}),0)),0)}function Et(){const t=Object.entries(X.ratePlanSelections).reduce(((t,[e,n])=>{const o=X.roomTypes.find((t=>t.id.toString()===e.toString()));t[e]=Object.entries(n).reduce(((t,[e,n])=>{const r=o?.inventory??n.roomtype?.inventory??n.visibleInventory;t[e]={...n,reserved:0,guest:null,guestName:[],checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],visibleInventory:r??0};return t}),{});return t}),{});X.ratePlanSelections={...t}}function ft(t){X.bookedByGuestManuallyEdited=t}function pt(){const t=[];Object.entries(X.ratePlanSelections).forEach((([e,n])=>{Object.entries(n).forEach((([n,o])=>{if(!o.reserved){return}const r=o.guest??[];for(let a=0;a<o.reserved;a++){t.push({roomTypeId:Number(e),ratePlanId:Number(n),reservationIndex:a,guest:r[a]??null,ratePlanSelection:o})}}))}));return t}const yt=e.object({CODE_NAME:e.string(),CODE_VALUE_AR:e.string().nullable(),CODE_VALUE_DE:e.string().nullable(),CODE_VALUE_EL:e.string().nullable(),CODE_VALUE_EN:e.string().nullable(),CODE_VALUE_FR:e.string().nullable(),CODE_VALUE_HE:e.string().nullable(),CODE_VALUE_PL:e.string().nullable(),CODE_VALUE_RU:e.string().nullable(),CODE_VALUE_UA:e.string().nullable(),DISPLAY_ORDER:e.number().nullable(),ENTRY_DATE:e.string().nullable(),ENTRY_USER_ID:e.number().nullable(),INVARIANT_VALUE:e.string().nullable(),ISDELETEABLE:e.boolean(),ISDELETED:e.boolean(),ISSYSTEM:e.boolean(),ISUPDATEABLE:e.boolean(),ISVISIBLE:e.boolean(),NOTES:e.string().nullable(),OWNER_ID:e.number().nullable(),TBL_NAME:e.string()});var mt;(function(t){t["Room"]="room"})(mt||(mt={}));var wt;(function(t){t["Penthouse"]="Penthouse";t["PremiumSuites"]="Premium Suites";t["StandardRooms"]="Standard Rooms"})(wt||(wt={}));var bt;(function(t){t["Empty"]="";t["The001"]="001";t["The002"]="002"})(bt||(bt={}));const Tt=n([o(),r().optional()]);const ht=a({id:o()});const gt=ht.extend({code:r().optional()});const Dt=a({amount:o(),type:r().optional(),key:n([o(),r().optional()]),description:r().optional().optional().default("")});const Ot=a({code:r().optional(),description:r().optional()});a({unit_id:o(),from_date:r().optional(),to_date:r().optional()});a({starter:r().optional()});a({booking_nbr:r().optional(),currency_id:o(),language:r().optional().optional(),rate_plan_id:o(),room_type_id:o(),property_id:o(),is_preserve_history:s().optional(),room_identifier:r().optional().optional()});a({booking_nbr:r().optional(),room_identifier:r().optional(),status:r().optional()});a({booking_nbr:r().optional(),currency_id:o(),language:r().optional()});const At=a({room_type_id:Tt,night:r().optional()});a({is_closed:s(),restrictions:i(At),operation_type:r().optional().optional()});a({book_nbr:r().optional(),status:r().optional()});const It=a({adult:o(),child:o()});a({from_date:r().optional(),to_date:r().optional(),propertyid:o(),adultChildCount:It,language:r().optional(),room_type_ids:i(o()),room_type_ids_to_update:i(o()).optional(),rate_plan_ids:i(o()).optional(),currency:gt,is_in_agent_mode:s().optional(),agent_id:Tt.optional()});const Rt=a({from_date:r().optional(),to_date:r().optional()});a({unit_id:o(),block_status_code:c(["003","004","002"]).optional(),description:r().optional().optional(),property_id:o(),brackets:i(Rt)});a({property_id:o(),room_identifier:r().optional(),code:r().optional()});a({service:_(),booking_nbr:Tt,is_remove:s()});const St=a({property_id:r(),check_in_date:r(),page_index:o().default(1),page_size:o().default(10)});const Nt=a({property_id:r(),check_out_date:r(),page_index:o().default(1),page_size:o().default(10)});const kt=a({booking_nbr:r().optional()});const Mt=a({invoice_nbr:r().optional(),reason:r().optional(),property_id:o()});const vt=a({booking_nbr:r().optional(),currency:ht,target:Ot,Date:r().optional(),nbr:r().optional(),remark:r().optional(),billed_to_name:r().optional(),billed_to_tax:r().optional(),items:i(Dt)});const Yt=a({is_proforma:s().optional().default(false),property_id:o(),invoice:vt});const Bt=a({invoice_nbr:r().optional(),property_id:o(),mode:c(["invoice","creditnote","proforma"]),invoice:vt.optional()});const Ct=a({address:l(),alternative_email:l(),cci:l(),city:l(),country:l(),country_id:o(),country_phone_prefix:r(),dob:l(),email:r(),first_name:r(),id:o(),id_info:l(),is_main:s(),last_name:r(),mobile:r(),mobile_without_prefix:r(),nbr_confirmed_bookings:o(),notes:l(),password:l(),subscribe_to_news_letter:l()});i(Ct);const Pt=a({code:r(),id:o(),symbol:r()});const Lt=a({code:r(),description:u()});const Ut=a({amount:o(),booking_nbr:r(),currency:Pt,description:u(),invoice_nbr:r(),is_invoiceable:s(),key:o(),status:Lt,system_id:o(),type:r()});const xt=a({date:r(),nbr:r(),reason:r(),system_id:r().nullable(),user:r().nullable()});const Gt=a({billed_to_name:u(),billed_to_tax:u(),booking_nbr:r(),credit_note:xt.nullable(),currency:Pt,date:r(),items:i(Ut),nbr:r(),pdf_url:u(),remark:r(),status:Lt,system_id:o(),target:u(),user:r().nullable(),total_amount:u()});const Ft=a({code:c(["001","002","003"]),description:r().nullable()});const Vt=a({amount:o(),booking_nbr:r(),currency:Pt,invoice_nbr:r().nullable(),is_invoiceable:s(),key:o(),status:u(),system_id:u(),reason:Ft.nullable(),type:c(["BSA","BSP","BSE","PAYMENT"])});const Ht=a({invoiceable_items:i(Vt),invoices:i(Gt).nullable()});class jt{async unBlockUnitByPeriod(e){const{data:n}=await t.post(`/Unblock_Unit_By_Period`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}async getNextValue(e){const{data:n}=await t.post(`/Get_Next_Value`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}async getExposedApplicablePolicies(e){const{data:n}=await t.post(`/Get_Exposed_Applicable_Policies`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result??[]}async handleExposedRoomInOut(e){const{data:n}=await t.post(`/Handle_Exposed_Room_InOut`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}async GetPenaltyStatement(e){const{data:n}=await t.post("/Get_Penalty_Statement",e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}async setExposedRestrictionPerRoomType(e){const{data:n}=await t.post(`https://gateway.igloorooms.com/IRBE/Set_Exposed_Restriction_Per_Room_Type`,{operation_type:e.operation_type??"close_open",...e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}async getLov(){const{data:e}=await t.post(`/Get_LOV`,{});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e}async sendBookingConfirmationEmail(e,n){const{data:o}=await t.post(`/Send_Booking_Confirmation_Email`,{booking_nbr:e,language:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}async getCalendarData(e,n,o){try{const{data:r}=await t.post(`/Get_Exposed_Calendar`,{propertyid:e,from_date:n,to_date:o,extras:f,include_sales_rate_plans:true});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}const a=r.My_Result.months;const s=[];const i=await k(a);const c=a.map((t=>{s.push({daysCount:t.days.length,monthName:t.description});return t.days.map((e=>{if(e["value"]==="2025-05-30"){console.log(e)}return{day:p(e.description,t.description),value:e.value,currentDate:y(e.description,t.description),dayDisplayName:e.description,rate:e.room_types,unassigned_units_nbr:e.unassigned_units_nbr,occupancy:e.occupancy}}))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:e,FROM:r.My_Params_Get_Exposed_Calendar.from_date,TO:r.My_Params_Get_Exposed_Calendar.to_date},days:c,months:s,myBookings:i,defaultMonths:a})}catch(t){console.error(t)}}async handleExposedRoomGuests(e){const{data:n}=await t.post("/Handle_Exposed_Room_Guests",e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}async fetchGuest(e){try{const{data:n}=await t.post(`/Get_Exposed_Guest`,{email:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async changeExposedBookingStatus(e){try{const{data:n}=await t.post(`/Change_Exposed_Booking_Status`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){throw new Error(t)}}async fetchPMSLogs(e){try{const{data:n}=await t.post(`/Get_Exposed_PMS_Logs`,{booking_nbr:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async getExposedBookingEvents(e){try{const{data:n}=await t.post(`/Get_Exposed_Booking_Events`,{booking_nbr:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async editExposedGuest(e,n){try{const{data:o}=await t.post(`/Edit_Exposed_Guest`,{...e,book_nbr:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}catch(t){console.log(t);throw new Error(t)}}async getBookingAvailability(e){try{const{adultChildCount:n,currency:o,...r}=e;const{data:a}=await t.post(`/Check_Availability`,{...r,adult_nbr:n.adult,child_nbr:n.child,currency_ref:o.code,skip_getting_assignable_units:!h.is_frontdesk_enabled,is_backend:true});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}const s=this.modifyRateplans(this.sortRoomTypes(a["My_Result"],{adult_nbr:Number(n.adult),child_nbr:Number(n.child)}));X.roomTypes=[...s];X.tax_statement={message:a.My_Result.tax_statement};return s}catch(t){console.error(t);throw new Error(t)}}sortRoomTypes(t,e){return t.sort(((t,n)=>{if(t.is_available_to_book&&!n.is_available_to_book)return-1;if(!t.is_available_to_book&&n.is_available_to_book)return 1;const o=t.rateplans?.some((t=>t.variations?.some((t=>t.discounted_amount===0||t.discounted_amount===null))));const r=n.rateplans?.some((t=>t.variations?.some((t=>t.discounted_amount===0||t.discounted_amount===null))));if(o&&!r)return 1;if(!o&&r)return-1;const a=t.rateplans?.some((t=>t.variations?.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))));const s=n.rateplans?.some((t=>t.variations?.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))));if(a&&!s)return-1;if(!a&&s)return 1;const i=Math.max(...t.rateplans.flatMap((t=>t.variations?.map((t=>t.discounted_amount??0)))));const c=Math.max(...n.rateplans.flatMap((t=>t.variations?.map((t=>t.discounted_amount??0)))));if(i<c)return-1;if(i>c)return 1;return 0}))}modifyRateplans(t){return t?.map((t=>({...t,rateplans:t.rateplans?.map((t=>({...t,variations:this.sortVariations(t?.variations??[])})))})))}sortVariations(t){return t.sort(((t,e)=>{if(t.adult_nbr!==e.adult_nbr){return e.adult_nbr-t.adult_nbr}return e.child_nbr-t.child_nbr}))}async getCountries(e){try{const{data:n}=await t.post(`/Get_Exposed_Countries`,{language:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.error(t);throw new Error(t)}}async getSetupEntriesByTableName(e){const{data:n}=await t.post(`/Get_Setup_Entries_By_TBL_NAME`,{TBL_NAME:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}const o=n.My_Result??[];return o}async fetchSetupEntries(){try{const t=await this.getSetupEntriesByTableNameMulti(["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]);const{arrival_time:e,rate_pricing_mode:n,bed_preference_type:o}=this.groupEntryTablesResult(t);return{arrivalTime:e,ratePricingMode:n,bedPreferenceType:o}}catch(t){console.error(t);throw new Error(t)}}async doBookingExtraService({booking_nbr:e,service:n,is_remove:o}){const{data:r}=await t.post(`/Do_Booking_Extra_Service`,{...n,booking_nbr:e,is_remove:o});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}groupEntryTablesResult(t){let e={};for(const n of t){const t=n.TBL_NAME.substring(1,n.TBL_NAME.length).toLowerCase();if(!e[t]){e[t]=[]}e[t]=[...e[t],n]}return e}async getSetupEntriesByTableNameMulti(e){const{data:n}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}async getBlockedInfo(){return await this.getSetupEntriesByTableNameMulti(["_CALENDAR_BLOCKED_TILL"])}async getUserDefaultCountry(){try{let e={IP:""};if(h?.property?.id){e={...e,id:h.property.id}}const{data:n}=await t.post(`/Get_Country_By_IP`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async blockUnit(e){try{const{data:n}=await t.post(`/Block_Exposed_Unit`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}console.log(n);return n["My_Params_Block_Exposed_Unit"]}catch(t){console.error(t);throw new Error(t)}}async blockAvailabilityForBrackets(e){try{const{data:n}=await t.post(`/Block_Availability_For_Brackets`,e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}catch(t){console.error(t);throw new Error(t)}}async setDepartureTime(e){const{data:n}=await t.post("/Set_Departure_Time",e);if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n}async getUserInfo(e){try{const{data:n}=await t.post(`/GET_EXPOSED_GUEST`,{email:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.error(t);throw new Error(t)}}async getExposedBooking(e,n,o=true){try{const{data:r}=await t.post(`/Get_Exposed_Booking`,{booking_nbr:e,language:n,extras:o?f:null});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.error(t)}}generateDays(t,e,n){const o=new Date(t);const r=new Date(e);const a=[];while(o<r){a.push({date:o.toISOString().split("T")[0],amount:n,cost:null});o.setDate(o.getDate()+1)}return a}calculateTotalRate(t,e,n,o){if(n&&o===2){return+t}return+t/+e}async fetchExposedGuest(e,n){try{const{data:o}=await t.post(`/Fetch_Exposed_Guests`,{email:e,property_id:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async fetchExposedBookings(e,n,o,r){try{const{data:a}=await t.post(`/Fetch_Exposed_Bookings`,{booking_nbr:e,property_id:n,from_date:o,to_date:r});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async getPCICardInfoURL(e){try{const{data:n}=await t.post(`/Get_PCI_Card_Info_URL`,{BOOK_NBR:e});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async doReservation(e){const{data:n}=await t.post(`/DoReservation`,{...e,extras:e.extras?e.extras:f});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}console.log(n["My_Result"]);return n["My_Result"]}async bookUser({bookedByInfoData:t,check_in:e,currency:n,extras:o=null,fromDate:r,guestData:a,pickup_info:s,propertyid:i,rooms:c,source:_,toDate:l,totalNights:u,arrivalTime:d,bookingNumber:E,defaultGuest:f,identifier:p,pr_id:y}){try{const w=m(r);const b=m(l);let T={email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.contactNumber===null?"":t.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:t.emailGuest||false,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null};if(f){T={...f,email:f.email===""?null:f.email}}if(t.id){T={...T,id:t.id}}const h={assign_units:true,check_in:e,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:o,booking:{booking_nbr:E||"",from_date:w,to_date:b,remark:t.message||null,property:{id:i},source:_,currency:n,arrival:{code:d?d:t.selectedArrivalTime},guest:T,rooms:[...a.map((t=>({identifier:p||null,roomtype:{id:t.roomCategoryId,name:t.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:t.inventory,rate:t.rate/u},rateplan:{id:t.ratePlanId,name:t.ratePlanName,rate_restrictions:null,variations:null,cancelation:t.cancelation,guarantee:t.guarantee},unit:typeof y==="undefined"&&t.roomId===""?null:{id:+y||+t.roomId},occupancy:{adult_nbr:t.adultCount,children_nbr:t.childrenCount,infant_nbr:null},bed_preference:t.preference,from_date:w,to_date:b,notes:null,days:this.generateDays(w,b,this.calculateTotalRate(t.rate,u,t.isRateModified,t.rateType)),guest:{email:null,first_name:t.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),...c]},pickup_info:s};console.log("book user payload",h)}catch(t){console.error(t);throw new Error(t)}}async getRoomsToCheckIn(e){const n=St.parse(e);const{data:o}=await t.post("https://gateway.igloorooms.com/IRBE/Get_Rooms_To_Check_In",n);return{bookings:o.My_Result,total_count:o.My_Params_Get_Rooms_To_Check_In?.total_count}}async getRoomsToCheckout(e){const n=Nt.parse(e);const{data:o}=await t.post("https://gateway.igloorooms.com/IRBE/Get_Rooms_To_Check_Out",n);return{bookings:o.My_Result,total_count:o.My_Params_Get_Rooms_To_Check_Out?.total_count}}async getBookingInvoiceInfo(e){const n=kt.parse(e);const{data:o}=await t.post("/Get_Booking_Invoice_Info",n);return Ht.parse(o.My_Result)}async issueInvoice(e){const n=Yt.parse(e);const{data:o}=await t.post("/Issue_Invoice",n);return o}async voidInvoice(e){const n=Mt.parse(e);const{data:o}=await t.post("/Void_Invoice",n);return o}async printInvoice(e){const n=Bt.parse(e);const{data:o}=await t.post("/Print_Invoice",n);return o}}export{pt as A,jt as B,at as C,dt as D,ut as E,$ as F,q as G,ft as H,yt as Z,nt as a,X as b,S as c,D as d,H as e,j as f,N as g,K as h,Et as i,st as j,ct as k,Z as l,_t as m,A as n,B as o,U as p,I as q,it as r,R as s,F as t,ot as u,V as v,Y as w,G as x,Q as y,tt as z};
//# sourceMappingURL=p-807bfca4.js.map