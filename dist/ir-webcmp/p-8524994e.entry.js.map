{"version":3,"names":["irArrivalsCss","IrArrivalsStyle0","IrArrivals","ticket","propertyid","language","p","pageSize","bookingNumber","booking","paymentEntries","isPageLoading","payment","roomGuestState","countries","tokenService","Token","roomService","RoomService","bookingService","BookingService","paymentFolioRef","componentWillLoad","this","setToken","init","setArrivalsPageSize","onArrivalsStoreChange","_","getBookings","handlePageSizeChange","newValue","oldValue","handleTicketChange","handleBookingPayment","e","stopImmediatePropagation","stopPropagation","booking_nbr","detail","arrivalsStore","bookings","find","b","paymentType","types","CODE_NAME","payment_type","code","description","CODE_VALUE_EN","operation","NOTES","openFolio","handleOpen","Error","propertyId","getExposedProperty","id","aname","is_backend","__","setupEntries","Promise","all","calendar_data","property","resolve","fetchLanguage","getCountries","getSetupEntriesByTableNameMulti","pay_type","pay_type_group","pay_method","groupEntryTablesResult","groups","methods","error","total_count","getRoomsToCheckIn","property_id","toString","check_in_date","today","page_index","pagination","currentPage","page_size","setArrivalsTotal","initializeArrivalsStore","handlePaginationChange","event","nextPage","setArrivalsPage","handlePaginationPageSizeChange","nextPageSize","Number","isFinite","normalizedPageSize","Math","floor","handleCheckingRoom","render","h","Host","handledEndpoints","class","onCheckInRoom","onRequestPageChange","onRequestPageSizeChange","onDrawerHide","withoutHeader","open","style","hasPrint","hasReceipt","hasCloseButton","onCloseSidebar","is_from_front_desk","hasRoomEdit","hasRoomDelete","hasRoomAdd","height","mode","ref","el","onCloseModal","identifier","roomName","totalGuests","sharedPersons","sharing_persons","checkIn","checkin","irBookingEmailLogsCss","IrBookingEmailLogsStyle0","IrBookingEmailLogs","data","token","key","gap","inputContainerStyle","margin","value","onTextChange","placeholder","size","text","onClickHandler","async","axios","post","BOOK_NBR","ExceptionMsg","My_Result","JSON","stringify","getAllParams","params","URLSearchParams","window","location","search","out","entries","irBookingListingCss","IrBookingListingStyle0","IrBookingListing","rowCount","baseUrl","userType","isLoading","editBookingItem","showCost","bookingListingService","BookingListingService","propertyService","PropertyService","listingModal","listingModalTimeout","allowedProperties","havePrivilege","setBaseUrl","updateUserSelection","booking_listing","setPaginationPageSize","initializeApp","onBookingListingChange","updatePaginationFromSelection","some","financial","gross_cost","ticketChanged","fetchBookings","getExposedBookings","userSelection","is_to_export","isPrivilegedUser","propertyData","parallelRequests","getExposedBookingsCriteria","allowedPropertiesIndex","push","length","getExposedAllowedProperties","results","map","updateUserSelections","property_ids","userTypeCode","console","handleSideBarToggle","geSearchFiltersFromParams","log","obj","s","status","filter","from","to","openModal","setTimeout","querySelector","editBooking","disconnectedCallback","clearTimeout","setPaginationPage","handleResetData","handleResetStoreData","handleBookingChanged","findBooking","handleSelectGuestEvent","cause","onGuestInfoDrawerClosed","email","guest","irDailyRevenueCss","IrDailyRevenueStyle0","IrDailyRevenue","groupedPayment","previousDateGroupedPayments","filters","date","moment","format","users","sideBarEvent","preventPageLoad","handleOpenSidebar","handleFetchNewReports","getPaymentReports","handleResetBooking","handleSidebarClose","renderSidebarBody","type","slot","payload","include_units_hk_status","requests","groupPaymentsByName","payments","Map","payTypeCode","payMethodCode","get","set","sort","a","aNum","bNum","isNaN","localeCompare","isExportToExcel","excludeYesterday","getReportObj","report","method","METHOD","PAY_TYPE_CODE","PAY_METHOD_CODE","amount","AMOUNT","DATE","hour","HOUR","minute","MINUTE","user","USER","currency","CURRENCY","bookingNbr","BOOKING_NBR","v4","getDailyRevenueReport","is_export_to_excel","add","btn_color","locales","Lcz_Export","btnStyle","iconPosition","icon_name","icon_style","groupedPayments","sidebarStyles","width","background","Boolean","showCloseButton","onIrSidebarToggle","irDeparturesCss","IrDeparturesStyle0","IrDepartures","checkoutState","invoiceState","onDeparturesStoreChange","departuresStore","getRoomsToCheckout","check_out_date","setDepartureTotal","initializeDeparturesStore","handleCheckoutRoom","setDeparturesPage","handleCheckoutDialogClosed","state","reason","setDeparturesPageSize","handleInvoiceClose","onCheckoutRoom","onCheckoutDialogClosed","onInvoiceClose","roomIdentifier","irHkTasksCss","IrHkTasksStyle0","IrHkTasks","isCleaningLoading","selectedDuration","selectedHouseKeeper","selectedRoom","archiveOpened","isSidebarOpen","isApplyFiltersLoading","modalCauses","clearSelectedHkTasks","hkNameCache","houseKeepingService","HouseKeepingService","table_sorting","modal","handleCloseSidebar","handleSortingChanged","field","direction","handleSkipSelectedTask","task","setLoading","getExposedHKSetup","tasksResult","getHkTasks","from_date","to_date","housekeepers","cleaning_frequency","housekeeping_store","hk_criteria","cleaning_frequencies","dusty_window","dusty_periods","highlight_window","highlight_checkin_options","tasks","updateTasks","buildHousekeeperNameCache","forEach","hk","name","updateTasksStore","t","housekeeper","hkm_id","hkName","handleHeaderButtonPress","sortingArray","Array","url","fetchTasksWithFilters","downloadFile","handleSelectedTaskCleaningEvent","handleModalConfirmation","hkTasksStore","selectedTasks","unit","editHkSkip","COMMENT","HK_SKIP_ID","HK_SKIP_REASON_CODE","PR_ID","executeHKAction","actions","unit_id","clearSelectedTasks","closeModal","applyFilters","export_to_excel","cleaning_periods","dusty_units","highlight_check_ins","onApplyFilters","onRowSelectChange","updateSelectedTasks","autoClose","onConfirmModal","bind","onCancelModal","iconAvailable","icon","leftBtnText","Lcz_Cancel","rightBtnText","Lcz_Confirm","leftBtnColor","rightBtnColor","modalTitle","Lcz_Confirmation","modalBody","getToken","irHousekeepingCss","IrHousekeepingStyle0","IrHousekeeping","toast","selectedCleaningFrequency","include_sales_rate_plans","updateHKStore","housekeeping_enabled","saveAutomaticCheckInCheckout","SetAutomaticCheckInOut","default_properties","flag","emit","position","title","saveCleaningFrequency","setExposedCleaningFrequency","Lcz_HouseKeepingAndCheckInSetup","borderShown","label","Lcz_CheckInOutGuestsAutomatically","showFirstOption","selectedValue","is_automatic_check_in_out","onSelectChange","Lcz_YesAsPerPropertyPolicy","Lcz_NoIWillDoItManually","Lcz_CleaningFrequency","v","isRequestPending","irMonthlyBookingsReportCss","IrMonthlyBookingsReportStyle0","IrMonthlyBookingsReport","reports","stats","baseFilters","firstOfMonth","startOf","lastOfMonth","endOf","include_previous_year","handleApplyFiltersChange","getReports","day","Date","units_booked","Units_booked","occupancy_percent","Occupancy","adr","ADR","rooms_revenue","Rooms_Revenue","total_guests","Total_Guests","getMonthlyStats","currentReports","enrichedReports","DailyStats","rest","previousYearReports","formattedReports","current","previous","prev","last_year","alignItems","Occupancy_Difference_From_Previous_Month","cardTitle","AverageOccupancy","toFixed","subtitle","TotalUnitsBooked","PeakDays","pd","concat","join","max","OccupancyPercent","irSalesByChannelCss","IrSalesByChannelStyle0","IrSalesByChannel","salesData","channelSalesFilters","propertyID","FROM_DATE","TO_DATE","BOOK_CASE","WINDOW","unshift","properties","LIST_AC_ID","getChannelSales","filterParams","currentSales","AC_ID","undefined","shouldFetchPreviousYear","enrichedSales","previousYearSales","subtract","SOURCE","toLowerCase","record","groupSalesRecordsBySource","records","getCurrencyId","r","createKey","source","trim","currencyId","sumValues","mergeLastYear","base","incoming","NIGHTS","PCT","REVENUE","PROPERTY_ID","PROPERTY_NAME","grouped","existing","merged","result","values","totalRevenue","reduce","sum","lastYearTotal","irSalesByCountryCss","IrSalesByCountryStyle0","IrSalesByCountry","salesFilters","getCountrySales","mappedCountries","country","formatSalesData","COUNTRY","country_id","COUNTRY_ID","nights","percentage","revenue","number_of_guests","salesReports","irUserManagementCss","IrUserManagementStyle0","IrUserManagement","isSuperAdmin","baseUserTypeCode","userId","allowedUsersTypes","userService","UserService","userTypes","socket","superAdminId","fetchUsers","fetchUserTypes","io","on","msg","handleSocketMessage","msgAsObject","parse","REASON","KEY","PAYLOAD","reasonHandlers","EMAIL_VERIFIED","updateUserVerificationStatus","handler","call","warn","idx","findIndex","u","is_email_verified","getExposedPropertyUsers","u1","u2","priority","p1","p2","username","res","getSetupEntriesByTableName","getLov","allowedUsers","allowed_user_types","toUpperCase","f","disconnect","suppressToastEndpoints","Lcz_ExtranetUsers","haveAdminPrivileges","includes"],"sources":["src/components/ir-arrivals/ir-arrivals.css?tag=ir-arrivals&encapsulation=scoped","src/components/ir-arrivals/ir-arrivals.tsx","src/components/ir-booking-email-logs/ir-booking-email-logs.css?tag=ir-booking-email-logs&encapsulation=scoped","src/components/ir-booking-email-logs/ir-booking-email-logs.tsx","src/utils/browserHistory.ts","src/components/ir-booking-listing/ir-booking-listing.css?tag=ir-booking-listing&encapsulation=scoped","src/components/ir-booking-listing/ir-booking-listing.tsx","src/components/ir-daily-revenue/ir-daily-revenue.css?tag=ir-daily-revenue&encapsulation=scoped","src/components/ir-daily-revenue/ir-daily-revenue.tsx","src/components/ir-departures/ir-departures.css?tag=ir-departures&encapsulation=scoped","src/components/ir-departures/ir-departures.tsx","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.css?tag=ir-hk-tasks&encapsulation=scoped","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.tsx","src/components/ir-housekeeping/ir-housekeeping.css?tag=ir-housekeeping&encapsulation=scoped","src/components/ir-housekeeping/ir-housekeeping.tsx","src/components/ir-monthly-bookings-report/ir-monthly-bookings-report.css?tag=ir-monthly-bookings-report&encapsulation=scoped","src/components/ir-monthly-bookings-report/ir-monthly-bookings-report.tsx","src/components/ir-sales-by-channel/ir-sales-by-channel.css?tag=ir-sales-by-channel&encapsulation=scoped","src/components/ir-sales-by-channel/ir-sales-by-channel.tsx","src/components/ir-sales-by-country/ir-sales-by-country.css?tag=ir-sales-by-country&encapsulation=scoped","src/components/ir-sales-by-country/ir-sales-by-country.tsx","src/components/ir-user-management/ir-user-management.css?tag=ir-user-management&encapsulation=scoped","src/components/ir-user-management/ir-user-management.tsx"],"sourcesContent":[".page-title {\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-xl);\n}\n","import type { PaginationChangeEvent } from '@/components/ir-pagination/ir-pagination';\nimport { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { RoomService } from '@/services/room.service';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries, RoomGuestsPayload } from '../ir-booking-details/types';\nimport { arrivalsStore, initializeArrivalsStore, onArrivalsStoreChange, setArrivalsPage, setArrivalsPageSize, setArrivalsTotal } from '@/stores/arrivals.store';\nimport { ICountry } from '@/models/IBooking';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-arrivals',\n  styleUrls: ['ir-arrivals.css'],\n  scoped: true,\n})\nexport class IrArrivals {\n  /**\n   * Authentication token issued by the PMS backend.\n   * Required for initializing the component and making API calls.\n   */\n  @Prop() ticket: string;\n\n  /**\n   * ID of the property (hotel) for which arrivals should be displayed.\n   * Used in API calls related to rooms, bookings, and check-ins.\n   */\n  @Prop() propertyid: number;\n\n  /**\n   * Two-letter language code (ISO) used for translations and API locale.\n   * Defaults to `'en'`.\n   */\n  @Prop() language: string = 'en';\n\n  /**\n   * Property alias or short identifier used by backend endpoints (aname).\n   * Passed to `getExposedProperty` when initializing the component.\n   */\n  @Prop() p: string;\n\n  /**\n   * Number of arrivals to load per page in the arrivals table.\n   * Used to configure pagination via Arrivals Store.\n   * Defaults to `20`.\n   */\n  @Prop() pageSize: number = 20;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n  @State() roomGuestState: RoomGuestsPayload = null;\n  @State() countries: ICountry[];\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n    setArrivalsPageSize(this.pageSize);\n    onArrivalsStoreChange('today', _ => {\n      this.getBookings();\n    });\n  }\n\n  @Watch('pageSize')\n  handlePageSizeChange(newValue: number, oldValue: number) {\n    if (newValue !== oldValue) setArrivalsPageSize(newValue);\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = arrivalsStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n\n  private async init() {\n    try {\n      this.isPageLoading = true;\n\n      if (!this.propertyid && !this.p) {\n        throw new Error('Missing credentials');\n      }\n      let propertyId = this.propertyid;\n\n      if (!propertyId) {\n        await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n      }\n\n      const [_, __, countries, setupEntries] = await Promise.all([\n        calendar_data?.property ? Promise.resolve(null) : this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getCountries(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getBookings(),\n      ]);\n      this.countries = countries;\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getBookings() {\n    const { bookings, total_count } = await this.bookingService.getRoomsToCheckIn({\n      property_id: calendar_data.property.id?.toString() ?? this.propertyid?.toString(),\n      check_in_date: arrivalsStore.today,\n      page_index: arrivalsStore.pagination.currentPage,\n      page_size: arrivalsStore.pagination.pageSize,\n    });\n    setArrivalsTotal(total_count ?? 0);\n    initializeArrivalsStore(bookings);\n  }\n\n  private async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPage = event.detail?.currentPage ?? 1;\n    if (nextPage === arrivalsStore.pagination.currentPage) {\n      return;\n    }\n    setArrivalsPage(nextPage);\n    await this.getBookings();\n  }\n\n  private async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPageSize = event.detail?.pageSize;\n    if (!Number.isFinite(nextPageSize)) {\n      return;\n    }\n    const normalizedPageSize = Math.floor(Number(nextPageSize));\n    if (normalizedPageSize === arrivalsStore.pagination.pageSize) {\n      return;\n    }\n    setArrivalsPageSize(normalizedPageSize);\n    await this.getBookings();\n  }\n  private handleCheckingRoom(event: CustomEvent<RoomGuestsPayload>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.roomGuestState = event.detail;\n  }\n  // @Listen(\"resetBookingEvt\")\n  // handleResetBookings(e:CustomEvent){\n  //   e.stopImmediatePropagation();\n  //   e.stopPropagation();\n  //   this.\n  // }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor handledEndpoints={['/Get_Rooms_To_Check_in']}></ir-interceptor>\n        <div class=\"ir-page__container\">\n          <h3 class=\"page-title\">Arrivals</h3>\n          {/* <ir-arrivals-filters></ir-arrivals-filters> */}\n          <ir-arrivals-table\n            onCheckInRoom={event => this.handleCheckingRoom(event as CustomEvent<RoomGuestsPayload>)}\n            onRequestPageChange={event => this.handlePaginationChange(event as CustomEvent<PaginationChangeEvent>)}\n            onRequestPageSizeChange={event => this.handlePaginationPageSizeChange(event as CustomEvent<PaginationChangeEvent>)}\n          ></ir-arrivals-table>\n          <ir-drawer\n            onDrawerHide={e => {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              this.bookingNumber = null;\n            }}\n            withoutHeader\n            open={!!this.bookingNumber}\n            style={{\n              '--ir-drawer-width': '80rem',\n              '--ir-drawer-background-color': '#F2F3F8',\n              '--ir-drawer-padding-left': '0',\n              '--ir-drawer-padding-top': '0',\n              '--ir-drawer-padding-bottom': '0',\n              '--ir-drawer-padding-right': '0',\n            }}\n          >\n            {this.bookingNumber && (\n              <ir-booking-details\n                hasPrint\n                hasReceipt\n                hasCloseButton\n                onCloseSidebar={() => (this.bookingNumber = null)}\n                is_from_front_desk\n                propertyid={this.propertyid as any}\n                hasRoomEdit\n                hasRoomDelete\n                bookingNumber={this.bookingNumber.toString()}\n                ticket={this.ticket}\n                language={this.language}\n                hasRoomAdd\n              ></ir-booking-details>\n            )}\n          </ir-drawer>\n          <ir-payment-folio\n            style={{ height: 'auto' }}\n            bookingNumber={this.booking?.booking_nbr}\n            paymentEntries={this.paymentEntries}\n            payment={this.payment}\n            mode={'payment-action'}\n            ref={el => (this.paymentFolioRef = el)}\n            onCloseModal={() => {\n              this.booking = null;\n              this.payment = null;\n            }}\n          ></ir-payment-folio>\n          <ir-room-guests\n            open={this.roomGuestState !== null}\n            countries={this.countries}\n            language={this.language}\n            identifier={this.roomGuestState?.identifier}\n            bookingNumber={this.roomGuestState?.booking_nbr?.toString()}\n            roomName={this.roomGuestState?.roomName}\n            totalGuests={this.roomGuestState?.totalGuests}\n            sharedPersons={this.roomGuestState?.sharing_persons}\n            checkIn={this.roomGuestState?.checkin}\n            onCloseModal={() => (this.roomGuestState = null)}\n          ></ir-room-guests>\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-booking-email-logs',\n  styleUrl: 'ir-booking-email-logs.css',\n  scoped: true,\n})\nexport class IrBookingEmailLogs {\n  @Prop() ticket: string;\n\n  @State() data: any[];\n  @State() bookingNumber: string;\n\n  private token = new Token();\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n    }\n  }\n\n  @Watch('ticket')\n  handleTicketChange() {\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n    }\n  }\n\n  render() {\n    return (\n      <Host class=\"p-1\">\n        <ir-interceptor handledEndpoints={['/Get_Email_log_By_BOOK_NBR']}></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"d-flex align-items-center mb-1\" style={{ gap: '0.5rem' }}>\n          <ir-input-text\n            class=\"m-0\"\n            inputContainerStyle={{ margin: '0' }}\n            value={this.bookingNumber}\n            onTextChange={e => (this.bookingNumber = e.detail)}\n            placeholder=\"booking number\"\n          ></ir-input-text>\n          <ir-button\n            size=\"sm\"\n            text=\"search\"\n            onClickHandler={async () => {\n              const { data } = await axios.post('/Get_Email_log_By_BOOK_NBR', {\n                BOOK_NBR: this.bookingNumber,\n              });\n              if (data.ExceptionMsg) {\n                return;\n              }\n              this.data = data.My_Result;\n            }}\n          ></ir-button>\n        </div>\n        <p>{JSON.stringify(this.data, null, 2)}</p>\n      </Host>\n    );\n  }\n}\n","// src/utils/browserHistory.ts\n\n/**\n * A small utility for reading and writing browser history\n * and manipulating URL search params in a type-safe way.\n */\n\ntype Parser<T> = (value: string | null) => T;\n\n// Common parsers/serializers\nexport const ParamTypes = {\n  string: {\n    parse: (v: string | null): string => v ?? '',\n    serialize: (v: string): string => v,\n  },\n  number: {\n    parse: (v: string | null): number => {\n      if (v == null || v === '') return NaN;\n      const n = Number(v);\n      return isNaN(n) ? NaN : n;\n    },\n    serialize: (v: number): string => String(v),\n  },\n  boolean: {\n    parse: (v: string | null): boolean => v === 'true',\n    serialize: (v: boolean): string => (v ? 'true' : 'false'),\n  },\n} as const;\n\n/**\n * Read a single search‑param, parse it, and return a typed value.\n * Falls back to defaultValue if missing or parse fails.\n */\nexport function getParam<T>(key: string, { parse }: { parse: Parser<T> }, defaultValue: T): T {\n  const params = new URLSearchParams(window.location.search);\n  const raw = params.get(key);\n  try {\n    if (raw == null) return defaultValue;\n    return parse(raw);\n  } catch {\n    return defaultValue;\n  }\n}\n\n/** Helpers for the three built‑in types */\nexport function getStringParam(key: string, defaultValue = ''): string {\n  return getParam(key, ParamTypes.string, defaultValue);\n}\n\nexport function getNumberParam(key: string, defaultValue = NaN): number {\n  return getParam(key, ParamTypes.number, defaultValue);\n}\n\nexport function getBooleanParam(key: string, defaultValue = false): boolean {\n  return getParam(key, ParamTypes.boolean, defaultValue);\n}\n\n/**\n * Read all current search params into a Record<string, string>\n */\nexport function getAllParams(): Record<string, string> {\n  const params = new URLSearchParams(window.location.search);\n  const out: Record<string, string> = {};\n  for (const [key, value] of params.entries()) {\n    out[key] = value;\n  }\n  return out;\n}\n\ninterface SetParamsOptions {\n  /** if true, uses replaceState instead of pushState */\n  replace?: boolean;\n}\n\n/**\n * Update one or more search params.\n * Pass null to delete a param.\n * By default uses history.pushState; set replace: true to call replaceState.\n */\nexport function setParams(updates: Record<string, string | number | boolean | null>, options: SetParamsOptions = {}): void {\n  const params = new URLSearchParams(window.location.search);\n\n  for (const [key, value] of Object.entries(updates)) {\n    if (!value) {\n      params.delete(key);\n    } else {\n      params.set(key, String(value));\n    }\n  }\n\n  const newSearch = params.toString();\n  const newUrl = window.location.pathname + (newSearch ? `?${newSearch}` : '') + window.location.hash;\n\n  if (options.replace) {\n    window.history.replaceState(window.history.state, '', newUrl);\n  } else {\n    window.history.pushState(window.history.state, '', newUrl);\n  }\n}\n\n/**\n * Push a new history entry.\n * `path` may include search or hash.\n * `state` is the history state object.\n */\nexport function pushHistory(path: string, state: any = {}): void {\n  window.history.pushState(state, '', path);\n}\n\n/**\n * Replace the current history entry.\n * `path` may include search or hash.\n * `state` is the history state object.\n */\nexport function replaceHistory(path: string, state: any = {}): void {\n  window.history.replaceState(state, '', path);\n}\n",":host {\n  display: block;\n  padding: var(--wa-space-l);\n  position: relative;\n}\n","import { Booking } from '@/models/booking.dto';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { RoomService } from '@/services/room.service';\nimport booking_listing, {\n  updateUserSelection,\n  onBookingListingChange,\n  updateUserSelections,\n  ExposedBookingsParams,\n  setPaginationPage,\n  setPaginationPageSize,\n  updatePaginationFromSelection,\n} from '@/stores/booking_listing.store';\nimport { isPrivilegedUser } from '@/utils/utils';\nimport { Component, Host, Prop, State, Watch, h, Element, Listen } from '@stencil/core';\nimport Token from '@/models/Token';\nimport { getAllParams } from '@/utils/browserHistory';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { AllowedProperties, PropertyService } from '@/services/property.service';\nimport type { PaginationChangeEvent } from '@/components/ir-pagination/ir-pagination';\n\n@Component({\n  tag: 'ir-booking-listing',\n  styleUrls: ['ir-booking-listing.css'],\n  scoped: true,\n})\nexport class IrBookingListing {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() rowCount: number = 20;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n  @Prop() userType: number;\n\n  @State() isLoading = false;\n  @State() editBookingItem: { booking: Booking; cause: 'edit' | 'payment' | 'delete' | 'guest' } | null = null;\n  @State() showCost = false;\n  @State() paymentEntries: PaymentEntries;\n  @State() payment: Payment;\n  @State() booking: Booking;\n\n  private bookingListingService = new BookingListingService();\n  private bookingService = new BookingService();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private token = new Token();\n\n  private listingModal: HTMLIrListingModalElement;\n  private listingModalTimeout: NodeJS.Timeout;\n  private allowedProperties: number[];\n  private havePrivilege: boolean;\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    updateUserSelection('end_row', this.rowCount);\n    booking_listing.rowCount = this.rowCount;\n    setPaginationPageSize(this.rowCount);\n    if (this.ticket !== '') {\n      booking_listing.token = this.ticket;\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n    onBookingListingChange('userSelection', newValue => {\n      updatePaginationFromSelection(newValue);\n    });\n    onBookingListingChange('bookings', newValue => {\n      this.showCost = newValue.some(booking => booking.financial.gross_cost !== null && booking.financial.gross_cost > 0);\n    });\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    booking_listing.token = this.ticket;\n    this.initializeApp();\n  }\n\n  private async fetchBookings() {\n    await this.bookingListingService.getExposedBookings({\n      ...booking_listing.userSelection,\n      is_to_export: false,\n    });\n  }\n\n  private async initializeApp() {\n    try {\n      this.isLoading = true;\n      this.havePrivilege = isPrivilegedUser(this.userType);\n\n      let propertyId = this.propertyid;\n      if (!this.havePrivilege) {\n        if (!this.propertyid && !this.p) {\n          throw new Error('Property ID or username is required');\n        }\n\n        if (!propertyId) {\n          const propertyData = await this.roomService.getExposedProperty({\n            id: 0,\n            aname: this.p,\n            language: this.language,\n            is_backend: true,\n          });\n          propertyId = propertyData.My_Result.id;\n        }\n      }\n\n      const parallelRequests: Promise<unknown>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.bookingListingService.getExposedBookingsCriteria(this.havePrivilege ? null : propertyId),\n        this.roomService.fetchLanguage(this.language, ['_BOOKING_LIST_FRONT']),\n      ];\n\n      // let propertyDataIndex: number | null = null;\n      let allowedPropertiesIndex: number | null = null;\n\n      if (this.propertyid && !this.havePrivilege) {\n        // propertyDataIndex = parallelRequests.length;\n        parallelRequests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n          }),\n        );\n      }\n\n      if (this.havePrivilege) {\n        allowedPropertiesIndex = parallelRequests.length;\n        parallelRequests.push(this.propertyService.getExposedAllowedProperties());\n      }\n\n      const results = await Promise.all(parallelRequests);\n\n      const [setupEntries] = results;\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries as any);\n\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n\n      this.allowedProperties = allowedPropertiesIndex !== null ? (results[allowedPropertiesIndex] as AllowedProperties)?.map(p => p.id) : null;\n\n      updateUserSelection('property_id', propertyId);\n\n      updateUserSelections({\n        property_ids: this.allowedProperties,\n        userTypeCode: this.userType,\n      });\n\n      await this.fetchBookings();\n    } catch (error) {\n      console.error('Error initializing app:', error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  handleSideBarToggle(e: CustomEvent<boolean>) {\n    if (e.detail) {\n      this.editBookingItem = null;\n    }\n  }\n  geSearchFiltersFromParams() {\n    //e=10&status=002&from=2025-04-15&to=2025-04-22&filter=2&c=Alitalia+Cabin+Crew\n    const params = getAllParams();\n    if (params) {\n      console.log('update params');\n      let obj: Partial<ExposedBookingsParams> = {};\n      if (params.e) {\n        obj['end_row'] = Number(params.e);\n      }\n      if (params.s) {\n        obj['start_row'] = Number(params.s);\n      }\n      if (params.status) {\n        obj['booking_status'] = params.status;\n      }\n      if (params.filter) {\n        obj['filter_type'] = params.filter;\n      }\n      if (params.from) {\n        obj['from'] = params.from;\n      }\n      if (params.to) {\n        obj['to'] = params.to;\n      }\n      updateUserSelections(obj);\n    }\n    console.log('params=>', params);\n  }\n  openModal() {\n    this.listingModalTimeout = setTimeout(() => {\n      this.listingModal = this.el.querySelector('ir-listing-modal');\n      this.listingModal.editBooking = this.editBookingItem;\n      this.listingModal.openModal();\n    }, 100);\n  }\n  disconnectedCallback() {\n    clearTimeout(this.listingModalTimeout);\n  }\n\n  @Listen('requestPageChange')\n  async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    if (!event.detail) {\n      return;\n    }\n    setPaginationPage(event.detail.currentPage);\n    await this.fetchBookings();\n  }\n\n  @Listen('requestPageSizeChange')\n  async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    if (!event.detail || !event.detail.pageSize) {\n      return;\n    }\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    setPaginationPageSize(event.detail.pageSize);\n    await this.fetchBookings();\n  }\n\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchBookings();\n  }\n\n  @Listen('resetBookingData')\n  async handleResetStoreData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchBookings();\n  }\n\n  @Listen('bookingChanged')\n  handleBookingChanged(e: CustomEvent<Booking>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    booking_listing.bookings = [\n      ...booking_listing.bookings.map(b => {\n        if (b.booking_nbr === e.detail.booking_nbr) {\n          return e.detail;\n        }\n        return b;\n      }),\n    ];\n  }\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = this.findBooking(booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n  @Listen('guestSelected')\n  handleSelectGuestEvent(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const booking = this.findBooking(e.detail);\n    if (!booking) {\n      return;\n    }\n    this.editBookingItem = {\n      booking,\n      cause: 'guest',\n    };\n  }\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation;\n    const booking = this.findBooking(e.detail);\n    if (!booking) {\n      return;\n    }\n    this.editBookingItem = {\n      booking,\n      cause: 'edit',\n    };\n  }\n\n  private findBooking(bookingNumber: Booking['booking_nbr']) {\n    return booking_listing.bookings.find(b => b.booking_nbr === bookingNumber);\n  }\n  render() {\n    if (this.isLoading || this.ticket === '') {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"main-container\">\n          <ir-listing-header propertyId={this.propertyid} p={this.p} language={this.language}></ir-listing-header>\n          <section class=\"mt-2\">\n            <ir-booking-listing-table></ir-booking-listing-table>\n          </section>\n        </div>\n        <ir-drawer\n          style={{\n            '--ir-drawer-width': '80rem',\n            '--ir-drawer-background-color': '#F2F3F8',\n            '--ir-drawer-padding-left': '0',\n            '--ir-drawer-padding-top': '0',\n            '--ir-drawer-padding-bottom': '0',\n            '--ir-drawer-padding-right': '0',\n          }}\n          onDrawerHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.editBookingItem = null;\n          }}\n          withoutHeader\n          open={this.editBookingItem?.cause === 'edit'}\n        >\n          {this.editBookingItem?.booking && (\n            <ir-booking-details\n              hasPrint\n              hasReceipt\n              hasCloseButton\n              onCloseSidebar={() => (this.editBookingItem = null)}\n              is_from_front_desk\n              propertyid={this.propertyid as any}\n              hasRoomEdit\n              hasRoomDelete\n              bookingNumber={this.editBookingItem.booking?.booking_nbr.toString()}\n              ticket={this.ticket}\n              language={this.language}\n              hasRoomAdd\n            ></ir-booking-details>\n          )}\n        </ir-drawer>\n        <ir-guest-info-drawer\n          onGuestInfoDrawerClosed={() => {\n            this.editBookingItem = null;\n          }}\n          booking_nbr={this.editBookingItem?.booking?.booking_nbr}\n          email={this.editBookingItem?.booking?.guest.email}\n          language={this.language}\n          open={this.editBookingItem?.cause === 'guest'}\n        ></ir-guest-info-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n.daily-revenue__meta {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.daily-revenue__table {\n  flex: 1 1 0%;\n}\n\n/*sm*/\n@media (min-width: 768px) {\n  .daily-revenue__meta {\n    flex-direction: row;\n  }\n}\n","import Token from '@/models/Token';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { DailyPaymentFilter, FolioPayment, GroupedFolioPayment, SidebarOpenEvent } from './types';\nimport { v4 } from 'uuid';\nimport moment from 'moment';\nimport { PaymentEntries } from '../ir-booking-details/types';\n\n@Component({\n  tag: 'ir-daily-revenue',\n  styleUrl: 'ir-daily-revenue.css',\n  scoped: true,\n})\nexport class IrDailyRevenue {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isPageLoading: boolean;\n  @State() property_id: number;\n  @State() groupedPayment: GroupedFolioPayment;\n  @State() previousDateGroupedPayments: GroupedFolioPayment;\n  @State() isLoading: string;\n  @State() filters: DailyPaymentFilter = { date: moment().format('YYYY-MM-DD'), users: null };\n  @State() sideBarEvent: SidebarOpenEvent | null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private bookingService = new BookingService();\n  private paymentEntries: PaymentEntries;\n\n  @Event() preventPageLoad: EventEmitter<null>;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.tokenService.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  @Listen('revenueOpenSidebar')\n  handleOpenSidebar(e: CustomEvent<SidebarOpenEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = e.detail;\n  }\n  @Listen('fetchNewReports')\n  handleFetchNewReports(e: CustomEvent<DailyPaymentFilter>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.filters = { ...e.detail };\n    this.getPaymentReports();\n  }\n  @Listen('resetBookingEvt')\n  async handleResetBooking(e: CustomEvent) {\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    this.getPaymentReports(false, true);\n  }\n\n  private handleSidebarClose = (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = null;\n  };\n\n  private renderSidebarBody() {\n    if (!this.sideBarEvent) {\n      return;\n    }\n    switch (this.sideBarEvent.type) {\n      case 'booking':\n        return (\n          <ir-booking-details\n            slot=\"sidebar-body\"\n            hasPrint\n            hasReceipt\n            hasCloseButton\n            onCloseSidebar={this.handleSidebarClose}\n            is_from_front_desk\n            propertyid={this.property_id}\n            hasRoomEdit\n            hasRoomDelete\n            bookingNumber={this.sideBarEvent.payload.bookingNumber.toString()}\n            ticket={this.ticket}\n            language={this.language}\n            hasRoomAdd\n          ></ir-booking-details>\n        );\n      default:\n        return null;\n    }\n  }\n\n  private async initializeApp() {\n    this.isPageLoading = true;\n\n    try {\n      let propertyId = this.propertyid;\n      if (!propertyId && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n\n      this.property_id = propertyId;\n\n      const requests: Promise<any>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getPaymentReports(),\n        this.roomService.fetchLanguage(this.language),\n      ];\n      if (propertyId) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [setupEntries] = await Promise.all(requests);\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n  private groupPaymentsByName(payments: FolioPayment[]): GroupedFolioPayment {\n    const groupedPayment: GroupedFolioPayment = new Map();\n\n    for (const payment of payments) {\n      const key = `${payment.payTypeCode}_${payment.payMethodCode}`;\n      const p = groupedPayment.get(key) ?? [];\n      groupedPayment.set(key, [...p, payment]);\n    }\n    return new Map(\n      [...groupedPayment.entries()].sort(([a], [b]) => {\n        const aNum = Number(a);\n        const bNum = Number(b);\n        if (!isNaN(aNum) && !isNaN(bNum)) {\n          return aNum - bNum;\n        }\n        return a.localeCompare(b);\n      }),\n    );\n  }\n\n  private async getPaymentReports(isExportToExcel = false, excludeYesterday = false) {\n    try {\n      const getReportObj = (report): FolioPayment => {\n        return {\n          method: report.METHOD,\n          payTypeCode: report.PAY_TYPE_CODE,\n          payMethodCode: report.PAY_METHOD_CODE,\n          amount: report.AMOUNT,\n          date: report.DATE,\n          hour: report.HOUR,\n          minute: report.MINUTE,\n          user: report.USER,\n          currency: report.CURRENCY,\n          bookingNbr: report.BOOKING_NBR,\n          id: v4(),\n        };\n      };\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n\n      const requests = [\n        this.propertyService.getDailyRevenueReport({\n          date: this.filters.date,\n          property_id: this.property_id?.toString(),\n          is_export_to_excel: isExportToExcel,\n        }),\n      ];\n      if (!isExportToExcel && !excludeYesterday) {\n        requests.push(\n          this.propertyService.getDailyRevenueReport({\n            date: moment(this.filters.date, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD'),\n            property_id: this.property_id?.toString(),\n            is_export_to_excel: isExportToExcel,\n          }),\n        );\n      }\n\n      const results = await Promise.all(requests);\n      if (!isExportToExcel) {\n        if (results[0]) {\n          this.groupedPayment = this.groupPaymentsByName(results[0]?.map(getReportObj));\n        } else {\n          this.groupedPayment = new Map();\n        }\n        if (results[1]) this.previousDateGroupedPayments = this.groupPaymentsByName(results[1]?.map(getReportObj));\n      }\n    } catch (e) {\n      console.log(e);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Daily Revenue</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getPaymentReports(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <ir-revenue-summary\n            previousDateGroupedPayments={this.previousDateGroupedPayments}\n            groupedPayments={this.groupedPayment}\n            paymentEntries={this.paymentEntries}\n          ></ir-revenue-summary>\n          <div class=\"daily-revenue__meta\">\n            <ir-daily-revenue-filters isLoading={this.isLoading === 'filter'} payments={this.groupedPayment}></ir-daily-revenue-filters>\n            <ir-revenue-table filters={this.filters} class={'daily-revenue__table'} paymentEntries={this.paymentEntries} payments={this.groupedPayment}></ir-revenue-table>\n          </div>\n        </section>\n        <ir-sidebar\n          sidebarStyles={{\n            width: this.sideBarEvent?.type === 'booking' ? '80rem' : 'var(--sidebar-width,40rem)',\n            background: this.sideBarEvent?.type === 'booking' ? '#F2F3F8' : 'white',\n          }}\n          open={Boolean(this.sideBarEvent)}\n          showCloseButton={false}\n          onIrSidebarToggle={this.handleSidebarClose}\n        >\n          {this.renderSidebarBody()}\n        </ir-sidebar>\n      </Host>\n    );\n  }\n}\n",".page-title {\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-xl);\n  /* margin-bottom: 1rem; */\n}\n","import { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { departuresStore, initializeDeparturesStore, onDeparturesStoreChange, setDeparturesPage, setDeparturesPageSize, setDepartureTotal } from '@/stores/departures.store';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { RoomService } from '@/services/room.service';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { PaginationChangeEvent } from '../ir-pagination/ir-pagination';\nimport { CheckoutDialogCloseEvent, CheckoutRoomEvent } from '@/components';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-departures',\n  styleUrls: ['ir-departures.css'],\n  scoped: true,\n})\nexport class IrDepartures {\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() language: string = 'en';\n  @Prop() p: string;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n  @State() checkoutState: CheckoutRoomEvent = null;\n  @State() invoiceState: CheckoutRoomEvent = null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n    onDeparturesStoreChange('today', _ => {\n      this.getBookings();\n    });\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = departuresStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n\n  private async init() {\n    try {\n      this.isPageLoading = true;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Missing credentials');\n      }\n      let propertyId = this.propertyid;\n\n      if (!propertyId) {\n        await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n      }\n      const [_, __, setupEntries] = await Promise.all([\n        calendar_data?.property ? Promise.resolve(null) : this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getBookings(),\n      ]);\n\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getBookings() {\n    const { bookings, total_count } = await this.bookingService.getRoomsToCheckout({\n      property_id: calendar_data.property.id?.toString() ?? this.propertyid?.toString(),\n      check_out_date: departuresStore.today,\n      page_index: departuresStore.pagination.currentPage,\n      page_size: departuresStore.pagination.pageSize,\n    });\n    setDepartureTotal(total_count ?? 0);\n    initializeDeparturesStore(bookings);\n  }\n  private handleCheckoutRoom(event: CustomEvent<CheckoutRoomEvent>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.checkoutState = event.detail;\n  }\n  private async handlePaginationChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPage = event.detail?.currentPage ?? 1;\n    if (nextPage === departuresStore.pagination.currentPage) {\n      return;\n    }\n    setDeparturesPage(nextPage);\n    await this.getBookings();\n  }\n\n  private async handleCheckoutDialogClosed(event: CustomEvent<CheckoutDialogCloseEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const state = { ...this.checkoutState };\n    this.checkoutState = null;\n    switch (event.detail.reason) {\n      case 'checkout':\n        await this.getBookings();\n        break;\n      case 'openInvoice':\n        this.invoiceState = { ...state };\n        await this.getBookings();\n        break;\n    }\n  }\n\n  private async handlePaginationPageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const nextPageSize = event.detail?.pageSize;\n    if (!Number.isFinite(nextPageSize)) {\n      return;\n    }\n    const normalizedPageSize = Math.floor(Number(nextPageSize));\n    if (normalizedPageSize === departuresStore.pagination.pageSize) {\n      return;\n    }\n    setDeparturesPageSize(normalizedPageSize);\n    await this.getBookings();\n  }\n  private handleInvoiceClose(event: CustomEvent<void>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.invoiceState = null;\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor handledEndpoints={['/Get_Rooms_To_Check_Out']}></ir-interceptor>\n        <div class={'ir-page__container'}>\n          <h3 class=\"page-title\">Departures</h3>\n          {/* <ir-departures-filter></ir-departures-filter> */}\n          <ir-departures-table\n            onCheckoutRoom={event => this.handleCheckoutRoom(event as CustomEvent<CheckoutRoomEvent>)}\n            onRequestPageChange={event => this.handlePaginationChange(event as CustomEvent<PaginationChangeEvent>)}\n            onRequestPageSizeChange={event => this.handlePaginationPageSizeChange(event as CustomEvent<PaginationChangeEvent>)}\n          ></ir-departures-table>\n        </div>\n        <ir-drawer\n          onDrawerHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.bookingNumber = null;\n          }}\n          withoutHeader\n          open={!!this.bookingNumber}\n          style={{\n            '--ir-drawer-width': '80rem',\n            '--ir-drawer-background-color': '#F2F3F8',\n            '--ir-drawer-padding-left': '0',\n            '--ir-drawer-padding-right': '0',\n            '--ir-drawer-padding-top': '0',\n            '--ir-drawer-padding-bottom': '0',\n          }}\n        >\n          {this.bookingNumber && (\n            <ir-booking-details\n              hasPrint\n              hasReceipt\n              hasCloseButton\n              onCloseSidebar={() => (this.bookingNumber = null)}\n              is_from_front_desk\n              propertyid={this.propertyid as any}\n              hasRoomEdit\n              hasRoomDelete\n              bookingNumber={this.bookingNumber.toString()}\n              ticket={this.ticket}\n              language={this.language}\n              hasRoomAdd\n            ></ir-booking-details>\n          )}\n        </ir-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n        <ir-checkout-dialog\n          booking={this.checkoutState?.booking}\n          identifier={this.checkoutState?.identifier}\n          open={this.checkoutState !== null}\n          onCheckoutDialogClosed={event => this.handleCheckoutDialogClosed(event as CustomEvent<CheckoutDialogCloseEvent>)}\n        ></ir-checkout-dialog>\n        <ir-invoice\n          onInvoiceClose={event => this.handleInvoiceClose(event as CustomEvent<void>)}\n          booking={this.invoiceState?.booking}\n          roomIdentifier={this.invoiceState?.identifier}\n          open={this.invoiceState !== null}\n        ></ir-invoice>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  box-sizing: border-box;\n}\n:host * {\n  box-sizing: border-box;\n}\n\n@media only screen and (min-width: 900px) {\n  /* td {\n    min-width: 140px !important;\n    width: max-content !important;\n  } */\n}\n@media only screen and (max-width: 900px) {\n  /* td {\n    min-width: 100px !important;\n  } */\n  /* .table-container {\n    width: max-content !important;\n  } */\n}\n/*sm*/\n@media (min-width: 640px) {\n}\n\n/*md*/\n@media (min-width: 768px) {\n}\n\n.tasks-view {\n  display: flex;\n  flex-direction: column;\n}\n/*lg*/\n@media (min-width: 1024px) {\n  .tasks-view {\n    flex-direction: row;\n  }\n}\n\n/*xl*/\n@media (min-width: 1280px) {\n}\n\n/*2xl*/\n@media (min-width: 1536px) {\n}\n","import { CleanTaskEvent, IPendingActions } from '@/models/housekeeping';\nimport Token from '@/models/Token';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport housekeeping_store from '@/stores/housekeeping.store';\n// import { isRequestPending } from '@/stores/ir-interceptor.store';\nimport locales from '@/stores/locales.store';\nimport { Component, Host, Prop, State, h, Element, Watch, Event, EventEmitter, Listen } from '@stencil/core';\nimport moment from 'moment';\nimport { v4 } from 'uuid';\nimport { TaskFilters } from './types';\nimport { downloadFile } from '@/utils/utils';\nimport { updateTasks as updateTasksStore, updateSelectedTasks, clearSelectedTasks, hkTasksStore, setLoading } from '@/stores/hk-tasks.store';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-hk-tasks',\n  styleUrl: 'ir-hk-tasks.css',\n  scoped: true,\n})\nexport class IrHkTasks {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n\n  @State() isLoading = false;\n  @State() isCleaningLoading = false;\n  @State() selectedDuration = '';\n  @State() selectedHouseKeeper = '0';\n  @State() selectedRoom: IPendingActions | null = null;\n  @State() archiveOpened = false;\n  @State() property_id: number;\n  @State() isSidebarOpen: boolean;\n  @State() isApplyFiltersLoading: boolean;\n  @State() filters: TaskFilters;\n  @State() modalCauses: CleanTaskEvent & { cause: 'skip' | 'clean' };\n\n  @Event({ bubbles: true, composed: true }) clearSelectedHkTasks: EventEmitter<void>;\n\n  private hkNameCache: Record<number, string> = {};\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n  private token = new Token();\n  private table_sorting: Map<string, 'ASC' | 'DESC'> = new Map();\n  private modal: HTMLIrModalElement;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket !== '') {\n      this.token.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.init();\n  }\n\n  @Listen('closeSideBar')\n  handleCloseSidebar(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.isSidebarOpen = false;\n  }\n  @Listen('sortingChanged')\n  handleSortingChanged(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { field, direction } = e.detail;\n    console.log(e.detail);\n    if (field === 'date') {\n      return;\n    }\n    this.table_sorting.set(field, direction);\n  }\n  @Listen('skipSelectedTask')\n  handleSkipSelectedTask(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalCauses = { task: e.detail, cause: 'skip' };\n    this.modal?.openModal();\n  }\n\n  private async init() {\n    try {\n      this.isLoading = true;\n      setLoading(true);\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.houseKeepingService.getExposedHKSetup(this.property_id), this.roomService.fetchLanguage(this.language)];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      const tasksResult = await this.houseKeepingService.getHkTasks({\n        property_id: this.property_id,\n        from_date: moment().format('YYYY-MM-DD'),\n        to_date: moment().format('YYYY-MM-DD'),\n        housekeepers: [],\n        cleaning_frequency: (calendar_data.cleaning_frequency ?? housekeeping_store?.hk_criteria?.cleaning_frequencies[0])?.code,\n        dusty_window: housekeeping_store?.hk_criteria?.dusty_periods[0]?.code,\n        highlight_window: housekeeping_store?.hk_criteria?.highlight_checkin_options[0]?.code,\n      });\n\n      // updateTaskList();\n      if (tasksResult?.tasks) {\n        this.updateTasks(tasksResult.tasks);\n      }\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n      setLoading(false);\n    }\n  }\n\n  private buildHousekeeperNameCache() {\n    this.hkNameCache = {};\n    housekeeping_store.hk_criteria?.housekeepers?.forEach(hk => {\n      if (hk.id != null && hk.name != null) {\n        this.hkNameCache[hk.id] = hk.name;\n      }\n    });\n  }\n\n  private updateTasks(tasks: any[]) {\n    this.buildHousekeeperNameCache();\n    updateTasksStore(\n      tasks.map(t => ({\n        ...t,\n        id: v4(),\n        housekeeper: (() => {\n          const name = this.hkNameCache[t.hkm_id];\n          if (name) {\n            return name;\n          }\n          const hkName = housekeeping_store.hk_criteria?.housekeepers?.find(hk => hk.id === t.hkm_id)?.name;\n          this.hkNameCache[t.hkm_id] = hkName;\n          return hkName;\n        })(),\n      })),\n    );\n  }\n  @Listen('headerButtonPress')\n  async handleHeaderButtonPress(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { name } = e.detail;\n    switch (name) {\n      case 'cleaned':\n      case 'clean-inspect':\n        this.modal?.openModal();\n        this.modalCauses = {\n          task: null,\n          cause: 'clean',\n          status: name === 'clean-inspect' ? '004' : '001',\n        };\n        break;\n      case 'export':\n        const sortingArray: { key: string; value: string }[] = Array.from(this.table_sorting.entries()).map(([key, value]) => ({\n          key,\n          value,\n        }));\n        console.log(sortingArray);\n        const { url } = await this.fetchTasksWithFilters(true);\n        downloadFile(url);\n        break;\n      case 'archive':\n        this.isSidebarOpen = true;\n        break;\n    }\n  }\n  @Listen('cleanSelectedTask')\n  handleSelectedTaskCleaningEvent(e: CustomEvent<CleanTaskEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalCauses = { ...e.detail, cause: 'clean' };\n    this.modal?.openModal();\n  }\n\n  private async handleModalConfirmation(e: CustomEvent) {\n    try {\n      e.stopImmediatePropagation();\n      e.stopPropagation();\n      if (hkTasksStore.selectedTasks.length === 0) {\n        return;\n      }\n      this.isCleaningLoading = true;\n      if (this.modalCauses?.cause === 'skip') {\n        const { booking_nbr, date, unit } = this.modalCauses.task;\n        await this.houseKeepingService.editHkSkip({\n          BOOK_NBR: booking_nbr,\n          DATE: date,\n          COMMENT: '',\n          HK_SKIP_ID: -1,\n          HK_SKIP_REASON_CODE: '001',\n          PR_ID: unit.id,\n        });\n      } else {\n        await this.houseKeepingService.executeHKAction({\n          actions: hkTasksStore.selectedTasks.map(t => ({\n            description: 'Cleaned',\n            hkm_id: t.hkm_id === 0 ? null : t.hkm_id,\n            unit_id: t.unit.id,\n            booking_nbr: t.booking_nbr,\n            status: this.modalCauses?.status ?? '001',\n          })),\n        });\n      }\n      await this.fetchTasksWithFilters();\n    } finally {\n      clearSelectedTasks();\n      if (this.modalCauses) {\n        this.modalCauses = null;\n      }\n      this.isCleaningLoading = false;\n      // this.clearSelectedTasks.emit();\n      this.modal.closeModal();\n    }\n  }\n\n  private async applyFilters(e: CustomEvent) {\n    try {\n      this.isApplyFiltersLoading = true;\n      e.stopImmediatePropagation();\n      e.stopPropagation();\n      this.filters = { ...e.detail };\n      await this.fetchTasksWithFilters();\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isApplyFiltersLoading = false;\n    }\n  }\n\n  private async fetchTasksWithFilters(export_to_excel: boolean = false) {\n    const { cleaning_periods, housekeepers, cleaning_frequencies, dusty_units, highlight_check_ins } = this.filters ?? {};\n\n    const { tasks, url } = await this.houseKeepingService.getHkTasks({\n      housekeepers,\n      cleaning_frequency: cleaning_frequencies?.code,\n      dusty_window: dusty_units?.code,\n      highlight_window: highlight_check_ins?.code,\n      property_id: this.property_id,\n      from_date: moment().format('YYYY-MM-DD'),\n      to_date: cleaning_periods?.code || moment().format('YYYY-MM-DD'),\n      is_export_to_excel: export_to_excel,\n    });\n    console.log(tasks);\n    if (tasks) {\n      this.updateTasks(tasks);\n    }\n    return { tasks, url };\n  }\n\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host data-testid=\"hk_tasks_base\">\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-1 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <h3>Housekeeping Tasks</h3>\n          <div class=\"tasks-view \" style={{ gap: '1rem' }}>\n            <ir-tasks-filters\n              isLoading={this.isApplyFiltersLoading}\n              onApplyFilters={e => {\n                this.applyFilters(e);\n              }}\n            ></ir-tasks-filters>\n            <div class=\"d-flex w-100 flex-column\" style={{ gap: '1rem' }}>\n              <ir-tasks-table\n                onRowSelectChange={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  updateSelectedTasks(e.detail);\n                }}\n                class=\"flex-grow-1 w-100\"\n              ></ir-tasks-table>\n              {/* <ir-tasks-table-pagination></ir-tasks-table-pagination> */}\n            </div>\n          </div>\n        </section>\n        <ir-modal\n          autoClose={false}\n          ref={el => (this.modal = el)}\n          isLoading={this.isCleaningLoading}\n          onConfirmModal={this.handleModalConfirmation.bind(this)}\n          onCancelModal={() => {\n            if (this.modalCauses) {\n              clearSelectedTasks();\n              this.modalCauses = null;\n            }\n          }}\n          iconAvailable={true}\n          icon=\"ft-alert-triangle danger h1\"\n          leftBtnText={locales.entries.Lcz_Cancel}\n          rightBtnText={locales.entries.Lcz_Confirm}\n          leftBtnColor=\"secondary\"\n          rightBtnColor={'primary'}\n          modalTitle={locales.entries.Lcz_Confirmation}\n          modalBody={\n            this.modalCauses\n              ? this.modalCauses?.cause === 'clean'\n                ? this.modalCauses.task\n                  ? `Update ${this.modalCauses?.task?.unit?.name} to Clean`\n                  : 'Update selected unit(s) to Clean'\n                : 'Skip cleaning and reschedule for tomorrow.'\n              : 'Update selected unit(s) to Clean'\n          }\n        ></ir-modal>\n        <ir-sidebar\n          open={this.isSidebarOpen}\n          id=\"editGuestInfo\"\n          onIrSidebarToggle={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.isSidebarOpen = false;\n          }}\n          // sidebarStyles={{\n          //   width: '80vw',\n          // }}\n          showCloseButton={false}\n        >\n          {this.isSidebarOpen && <ir-hk-archive ticket={this.token.getToken()} propertyId={this.property_id} slot=\"sidebar-body\"></ir-hk-archive>}\n        </ir-sidebar>\n        {/* <ir-title class=\"d-none d-md-flex\" label={locales.entries.Lcz_HousekeepingTasks} justifyContent=\"space-between\">\n            <ir-button slot=\"title-body\" text={locales.entries.Lcz_Archive} size=\"sm\"></ir-button>\n          </ir-title> */}\n      </Host>\n    );\n  }\n}\n",":host {\r\n  display: block;\r\n}\r\n","import Token from '@/models/Token';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport calendar_data from '@/stores/calendar-data';\nimport housekeeping_store, { updateHKStore } from '@/stores/housekeeping.store';\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport locales from '@/stores/locales.store';\nimport { PropertyService } from '@/services/property.service';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n@Component({\n  tag: 'ir-housekeeping',\n  styleUrl: 'ir-housekeeping.css',\n  scoped: true,\n})\nexport class IrHousekeeping {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() baseUrl: string;\n\n  @State() isLoading = false;\n\n  @Event() toast: EventEmitter<IToast>;\n\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n  private propertyService = new PropertyService();\n  private token = new Token();\n  modal: HTMLIrModalElement;\n  selectedCleaningFrequency: any;\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket !== '') {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.houseKeepingService.getExposedHKSetup(this.propertyid);\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  async initializeApp() {\n    try {\n      this.isLoading = true;\n      let propertyId = this.propertyid;\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_sales_rate_plans: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n      updateHKStore('default_properties', { token: this.ticket, property_id: propertyId, language: this.language });\n      const requests: Array<Promise<any>> = [];\n      if (calendar_data.housekeeping_enabled) {\n        requests.push(this.houseKeepingService.getExposedHKSetup(propertyId));\n      }\n      requests.push(this.roomService.fetchLanguage(this.language, ['_HK_FRONT', '_PMS_FRONT']));\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_sales_rate_plans: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      this.selectedCleaningFrequency = calendar_data.cleaning_frequency?.code;\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  private async saveAutomaticCheckInCheckout(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.roomService.SetAutomaticCheckInOut({\n        property_id: housekeeping_store.default_properties.property_id,\n        flag: e.detail === 'auto',\n      });\n      this.toast.emit({\n        position: 'top-right',\n        title: 'Saved Successfully',\n        description: '',\n        type: 'success',\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  private async saveCleaningFrequency(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.propertyService.setExposedCleaningFrequency({\n        property_id: housekeeping_store.default_properties.property_id,\n        code: this.selectedCleaningFrequency,\n      });\n      calendar_data.cleaning_frequency = { code: this.selectedCleaningFrequency, description: '' };\n      this.toast.emit({\n        position: 'top-right',\n        title: 'Saved Successfully',\n        description: '',\n        type: 'success',\n      });\n      this.modal.closeModal();\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    console.log(calendar_data.cleaning_frequency);\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <section class=\"p-1\">\n          <h3 class=\"mb-2\">{locales.entries.Lcz_HouseKeepingAndCheckInSetup}</h3>\n          <div class=\"card p-1\">\n            <ir-title borderShown label=\"Operations Settings\"></ir-title>\n            <div class={'d-flex align-items-center mb-1'}>\n              <p class=\"my-0 py-0 mr-1\">{locales.entries.Lcz_CheckInOutGuestsAutomatically}</p>\n              <ir-select\n                showFirstOption={false}\n                selectedValue={calendar_data.is_automatic_check_in_out ? 'auto' : 'manual'}\n                onSelectChange={e => this.saveAutomaticCheckInCheckout(e)}\n                data={[\n                  { text: locales.entries.Lcz_YesAsPerPropertyPolicy, value: 'auto' },\n                  { text: locales.entries.Lcz_NoIWillDoItManually, value: 'manual' },\n                ]}\n              ></ir-select>\n            </div>\n            <div class={'d-flex align-items-center'}>\n              <p class=\"my-0 py-0 mr-1\">{locales.entries.Lcz_CleaningFrequency}:</p>\n              <ir-select\n                showFirstOption={false}\n                selectedValue={this.selectedCleaningFrequency}\n                onSelectChange={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  this.selectedCleaningFrequency = e.detail;\n                  this.modal.openModal();\n                }}\n                data={housekeeping_store?.hk_criteria?.cleaning_frequencies.map(v => ({\n                  text: v.description,\n                  value: v.code,\n                }))}\n              ></ir-select>\n            </div>\n          </div>\n          {/*<ir-unit-status class=\"mb-1\"></ir-unit-status>*/}\n          {calendar_data.housekeeping_enabled && <ir-hk-team class=\"mb-1\"></ir-hk-team>}\n          <ir-modal\n            autoClose={false}\n            ref={el => (this.modal = el)}\n            isLoading={isRequestPending('/Set_Exposed_Cleaning_Frequency')}\n            onConfirmModal={this.saveCleaningFrequency.bind(this)}\n            iconAvailable={true}\n            onCancelModal={() => {\n              this.selectedCleaningFrequency = calendar_data.cleaning_frequency?.code;\n            }}\n            icon=\"ft-alert-triangle danger h1\"\n            leftBtnText={locales.entries.Lcz_Cancel}\n            rightBtnText={locales.entries.Lcz_Confirm}\n            leftBtnColor=\"secondary\"\n            rightBtnColor={'primary'}\n            modalTitle={locales.entries.Lcz_Confirmation}\n            modalBody={'This action will reschedule all cleaning tasks. Do you want to continue?'}\n          ></ir-modal>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { DailyReport, DailyReportFilter } from './types';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { RoomService } from '@/services/room.service';\nimport { DailyStat, MonthlyStatsResults, PropertyService } from '@/services/property.service';\n\n@Component({\n  tag: 'ir-monthly-bookings-report',\n  styleUrl: 'ir-monthly-bookings-report.css',\n  scoped: true,\n})\nexport class IrMonthlyBookingsReport {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isPageLoading = true;\n  @State() isLoading: 'export' | 'filter' | null = null;\n\n  @State() reports: DailyReport[] = [];\n  @State() filters: DailyReportFilter;\n  @State() property_id: number;\n  @State() stats: Omit<MonthlyStatsResults, 'DailyStats'>;\n\n  private baseFilters: DailyReportFilter;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n\n  componentWillLoad() {\n    this.baseFilters = {\n      date: {\n        description: moment().format('MMMM YYYY'),\n        firstOfMonth: moment().startOf('month').format('YYYY-MM-DD'),\n        lastOfMonth: moment().endOf('month').format('YYYY-MM-DD'),\n      },\n      include_previous_year: false,\n    };\n    this.filters = this.baseFilters;\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Listen('applyFilters')\n  handleApplyFiltersChange(e: CustomEvent<DailyReportFilter>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.filters = e.detail;\n    this.getReports();\n  }\n\n  private async init() {\n    try {\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.roomService.fetchLanguage(this.language), this.getReports()];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getReports(isExportToExcel = false) {\n    try {\n      const getReportObj = (report: DailyStat): DailyReport => {\n        return {\n          day: report.Date,\n          units_booked: report.Units_booked,\n          occupancy_percent: report.Occupancy,\n          adr: report.ADR,\n          rooms_revenue: report.Rooms_Revenue,\n          total_guests: report?.Total_Guests,\n        };\n      };\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n      const { date, include_previous_year } = this.filters;\n\n      const requests = [\n        this.propertyService.getMonthlyStats({\n          from_date: date.firstOfMonth,\n          to_date: date.lastOfMonth,\n          property_id: this.property_id,\n          is_export_to_excel: isExportToExcel,\n        }),\n      ];\n\n      if (include_previous_year) {\n        requests.push(\n          this.propertyService.getMonthlyStats({\n            from_date: moment(date.firstOfMonth, 'YYYY-MM-DD').add(-1, 'year').format('YYYY-MM-DD'),\n            to_date: moment(date.lastOfMonth, 'YYYY-MM-DD').add(-1, 'years').format('YYYY-MM-DD'),\n            property_id: this.property_id,\n          }),\n        );\n      }\n\n      const results = await Promise.all(requests);\n      const currentReports = results[0];\n      let enrichedReports: DailyReport[] = [];\n      const { DailyStats, ...rest } = currentReports;\n\n      this.stats = { ...rest };\n\n      if (include_previous_year && results[isExportToExcel ? 0 : 1]) {\n        const previousYearReports = results[isExportToExcel ? 0 : 1];\n        let formattedReports = previousYearReports.DailyStats.map(getReportObj);\n        enrichedReports = DailyStats.map(getReportObj).map(current => {\n          const previous = formattedReports.find(prev => prev.day === moment(current.day, 'YYYY-MM-DD').add(-1, 'years').format('YYYY-MM-DD'));\n          return {\n            ...current,\n            last_year: previous ?? null,\n          };\n        });\n      } else {\n        enrichedReports = DailyStats.map(getReportObj);\n      }\n      this.reports = [...enrichedReports];\n    } catch (e) {\n      console.log(e);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Daily Occupancy</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getReports(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <section>\n            <div class=\"d-flex flex-column flex-md-row w-100\" style={{ gap: '1rem', alignItems: 'stretch' }}>\n              <ir-stats-card\n                icon={this.stats?.Occupancy_Difference_From_Previous_Month < 0 ? 'arrow-trend-down' : 'arrow-trend-up'}\n                cardTitle=\"Average Occupancy\"\n                value={this.stats.AverageOccupancy ? this.stats?.AverageOccupancy.toFixed(2) + '%' : null}\n                subtitle={`${this.stats?.Occupancy_Difference_From_Previous_Month < 0 ? '' : '+'}${this.stats?.Occupancy_Difference_From_Previous_Month.toFixed(\n                  2,\n                )}% from last month`}\n              ></ir-stats-card>\n\n              <ir-stats-card\n                icon=\"hotel\"\n                cardTitle=\"Total Units\"\n                value={this.stats?.TotalUnitsBooked ? this.stats?.TotalUnitsBooked.toString() : null}\n                subtitle=\"Booked\"\n              ></ir-stats-card>\n\n              <ir-stats-card icon=\"user_group\" cardTitle=\"Total Guests\" value={this.stats?.Total_Guests?.toString()} subtitle=\"Stayed\"></ir-stats-card>\n\n              <ir-stats-card\n                icon=\"calendar\"\n                cardTitle=\"Peak Days\"\n                value={this.stats?.PeakDays.length === 0 ? null : this.stats?.PeakDays?.map(pd => moment(pd.Date, 'YYYY-MM-DD').format('D').concat('th')).join(' - ')}\n                subtitle={`${Math.max(...(this.stats.PeakDays?.map(pd => pd.OccupancyPercent) || []))}% occupancy`}\n              ></ir-stats-card>\n            </div>\n            <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n              <ir-monthly-bookings-report-filter isLoading={this.isLoading === 'filter'} class=\"filters-card\" baseFilters={this.baseFilters}></ir-monthly-bookings-report-filter>\n              <ir-monthly-bookings-report-table reports={this.reports}></ir-monthly-bookings-report-table>\n            </div>\n          </section>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport Token from '@/models/Token';\nimport { AllowedProperties, PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport moment from 'moment';\nimport { ChannelReport, ChannelReportResult, ChannelSaleFilter, SalesByChannelMode } from './types';\n@Component({\n  tag: 'ir-sales-by-channel',\n  styleUrl: 'ir-sales-by-channel.css',\n  scoped: true,\n})\nexport class IrSalesByChannel {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: string;\n  @Prop() p: string;\n  @Prop() mode!: SalesByChannelMode;\n\n  @State() isLoading: 'filter' | 'export' | null = null;\n  @State() isPageLoading = true;\n\n  @State() salesData: ChannelReportResult;\n  @State() channelSalesFilters: ChannelSaleFilter;\n  @State() allowedProperties: AllowedProperties = [];\n  @State() propertyID: number;\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n\n  private baseFilters: ChannelSaleFilter = {\n    FROM_DATE: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    TO_DATE: moment().format('YYYY-MM-DD'),\n    BOOK_CASE: '001',\n    WINDOW: 7,\n    include_previous_year: false,\n    is_export_to_excel: false,\n  };\n\n  componentWillLoad() {\n    this.channelSalesFilters = this.baseFilters;\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  private async initializeApp() {\n    try {\n      if (!this.mode) {\n        throw new Error(\"Missing required 'mode'. Please set it to either 'property' or 'mpo'.\");\n      }\n      if (!this.propertyid && this.mode === 'property' && !this.p) {\n        throw new Error('Missing Property ID or aname');\n      }\n      if (this.mode === 'property') {\n        const property = await this.propertyService.getExposedProperty({\n          id: Number(this.propertyid ?? 0),\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n        });\n        this.propertyID = property.My_Result.id;\n      }\n      const requests: Promise<unknown>[] = [, this.roomService.fetchLanguage(this.language)];\n      if (this.mode === 'mpo') {\n        requests.unshift(this.propertyService.getExposedAllowedProperties());\n        const [properties] = await Promise.all(requests);\n        this.allowedProperties = [...(properties as any)];\n      }\n\n      this.baseFilters = { ...this.baseFilters, LIST_AC_ID: this.allowedProperties?.map(p => p.id) };\n      this.channelSalesFilters = { ...this.baseFilters };\n\n      await this.getChannelSales();\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getChannelSales(isExportToExcel = false) {\n    try {\n      const { include_previous_year, LIST_AC_ID, ...filterParams } = this.channelSalesFilters;\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n      const currentSales = await this.propertyService.getChannelSales({\n        is_export_to_excel: isExportToExcel,\n        ...filterParams,\n        AC_ID: this.propertyID ? this.propertyID.toString() : undefined,\n        ...filterParams,\n        LIST_AC_ID: this.propertyID ? null : LIST_AC_ID,\n      });\n      const shouldFetchPreviousYear = !isExportToExcel && include_previous_year;\n      let enrichedSales: ChannelReportResult = [];\n      if (shouldFetchPreviousYear) {\n        const previousYearSales = await this.propertyService.getChannelSales({\n          AC_ID: this.propertyID ? this.propertyID.toString() : undefined,\n          ...filterParams,\n          LIST_AC_ID: this.propertyID ? null : LIST_AC_ID,\n          FROM_DATE: moment(filterParams.FROM_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n          TO_DATE: moment(filterParams.TO_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n        });\n\n        enrichedSales = currentSales.map(current => {\n          const previous = previousYearSales.find(prev => prev.SOURCE.toLowerCase() === current.SOURCE.toLowerCase());\n          return {\n            ...current,\n            last_year: previous ? previous : null,\n          };\n        });\n      } else {\n        enrichedSales = currentSales.map(record => ({\n          ...record,\n          last_year: null,\n        }));\n      }\n      /**\n       * Groups sales records by SOURCE and currency.id, summing numeric fields\n       * and recalculating PCT based on the total REVENUE.\n       */\n      const groupSalesRecordsBySource = (records: ChannelReportResult): ChannelReportResult => {\n        if (!records || records.length === 0) return records;\n\n        // Helper to extract currency ID from various possible formats\n        const getCurrencyId = (r: ChannelReport): string | null => {\n          return r?.currency ?? null;\n        };\n\n        // Create unique key for grouping\n        const createKey = (r: ChannelReport): string => {\n          const source = r.SOURCE.toString().toLowerCase().trim();\n          const currencyId = getCurrencyId(r);\n          return `${source}__${currencyId ?? 'null'}`;\n        };\n\n        // Sum two values safely\n        const sumValues = (a: number | undefined, b: number | undefined): number => {\n          return (a ?? 0) + (b ?? 0);\n        };\n\n        // Merge numeric fields from last_year objects\n        const mergeLastYear = (base: ChannelReport['last_year'], incoming: ChannelReport['last_year']): ChannelReport['last_year'] => {\n          if (!incoming) return base;\n          if (!base) return { ...incoming };\n\n          return {\n            NIGHTS: sumValues(base.NIGHTS, incoming.NIGHTS),\n            PCT: sumValues(base.PCT, incoming.PCT), // Will recalculate later\n            REVENUE: sumValues(base.REVENUE, incoming.REVENUE),\n            SOURCE: base.SOURCE,\n            PROPERTY_ID: base.PROPERTY_ID,\n            PROPERTY_NAME: base.PROPERTY_NAME,\n            currency: base.currency,\n          };\n        };\n\n        // Group records by key\n        const grouped = new Map<string, ChannelReport>();\n\n        for (const record of records) {\n          const key = createKey(record);\n          const existing = grouped.get(key);\n\n          if (!existing) {\n            // First record for this key - clone it\n            grouped.set(key, { ...record });\n          } else {\n            // Merge with existing record\n            const merged: ChannelReport = {\n              ...existing,\n              NIGHTS: sumValues(existing.NIGHTS, record.NIGHTS),\n              PCT: 0, // Will recalculate after summing all REVENUE\n              REVENUE: sumValues(existing.REVENUE, record.REVENUE),\n              last_year: mergeLastYear(existing.last_year, record.last_year),\n            };\n            grouped.set(key, merged);\n          }\n        }\n\n        // Convert to array\n        const result = Array.from(grouped.values());\n\n        // Recalculate PCT based on total REVENUE\n        const totalRevenue = result.reduce((sum, r) => sum + (r.REVENUE ?? 0), 0);\n\n        if (totalRevenue > 0) {\n          for (const record of result) {\n            record.PCT = (record.REVENUE / totalRevenue) * 100;\n\n            // Also recalculate last_year PCT if it exists\n            if (record.last_year) {\n              const lastYearTotal = result.reduce((sum, r) => sum + (r.last_year?.REVENUE ?? 0), 0);\n              if (lastYearTotal > 0) {\n                record.last_year.PCT = (record.last_year.REVENUE / lastYearTotal) * 100;\n              }\n            }\n          }\n        }\n\n        return result;\n      };\n\n      this.salesData = [...groupSalesRecordsBySource(enrichedSales)];\n    } catch (error) {\n      console.error('Failed to fetch sales data:', error);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Sales by Channel</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getChannelSales(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          {/* <ir-sales-by-country-summary salesReports={this.salesData}></ir-sales-by-country-summary> */}\n          <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n            <ir-sales-by-channel-filters\n              isLoading={this.isLoading === 'filter'}\n              onApplyFilters={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.channelSalesFilters = { ...e.detail };\n                this.getChannelSales();\n              }}\n              allowedProperties={this.allowedProperties}\n              baseFilters={this.baseFilters}\n            ></ir-sales-by-channel-filters>\n            <ir-sales-by-channel-table mode={this.mode} allowedProperties={this.allowedProperties} class=\"card mb-0\" records={this.salesData}></ir-sales-by-channel-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import Token from '@/models/Token';\nimport { PropertyService } from '@/services/property.service';\nimport { RoomService } from '@/services/room.service';\nimport locales from '@/stores/locales.store';\nimport { Component, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { BaseSalesRecord, CountrySalesFilter, MappedCountries, SalesRecord } from './types';\nimport moment from 'moment';\nimport { v4 } from 'uuid';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { ICountry } from '@/models/IBooking';\n\n@Component({\n  tag: 'ir-sales-by-country',\n  styleUrl: 'ir-sales-by-country.css',\n  scoped: true,\n})\nexport class IrSalesByCountry {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isLoading: 'filter' | 'export' | null = null;\n  @State() isPageLoading = true;\n  @State() property_id: number;\n  @State() salesData: SalesRecord[];\n  @State() salesFilters: CountrySalesFilter;\n  @State() countries: MappedCountries = new Map();\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private propertyService = new PropertyService();\n  private bookingService = new BookingService();\n\n  private baseFilters = {\n    FROM_DATE: moment().add(-7, 'days').format('YYYY-MM-DD'),\n    TO_DATE: moment().format('YYYY-MM-DD'),\n    BOOK_CASE: '001',\n    WINDOW: 7,\n    include_previous_year: false,\n  };\n\n  componentWillLoad() {\n    this.salesFilters = this.baseFilters;\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n  private async initializeApp() {\n    try {\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.bookingService.getCountries(this.language), this.roomService.fetchLanguage(this.language), this.getCountrySales()];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [countries] = await Promise.all(requests);\n      const mappedCountries = new Map();\n      (countries as ICountry[]).map(country => {\n        mappedCountries.set(country.id, {\n          flag: country.flag,\n          name: country.name,\n        });\n      });\n      this.countries = mappedCountries;\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  private async getCountrySales(isExportToExcel = false) {\n    const formatSalesData = (data): Omit<BaseSalesRecord, 'id'> => {\n      return {\n        country: data.COUNTRY,\n        country_id: data.COUNTRY_ID,\n        nights: data.NIGHTS,\n        percentage: data.PCT,\n        revenue: data.REVENUE,\n        number_of_guests: data.Total_Guests,\n      };\n    };\n    try {\n      const { include_previous_year, ...filterParams } = this.salesFilters;\n      this.isLoading = isExportToExcel ? 'export' : 'filter';\n\n      const currentSales = await this.propertyService.getCountrySales({\n        AC_ID: this.property_id,\n        is_export_to_excel: isExportToExcel,\n        ...filterParams,\n      });\n\n      const shouldFetchPreviousYear = !isExportToExcel && include_previous_year;\n\n      let enrichedSales: SalesRecord[] = [];\n\n      if (shouldFetchPreviousYear) {\n        const previousYearSales = await this.propertyService.getCountrySales({\n          AC_ID: this.property_id,\n          is_export_to_excel: false,\n          ...filterParams,\n          FROM_DATE: moment(filterParams.FROM_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n          TO_DATE: moment(filterParams.TO_DATE).subtract(1, 'year').format('YYYY-MM-DD'),\n        });\n\n        enrichedSales = currentSales.map(current => {\n          const previous = previousYearSales.find(prev => prev.COUNTRY.toLowerCase() === current.COUNTRY.toLowerCase());\n          return {\n            id: v4(),\n            ...formatSalesData(current),\n            last_year: previous ? formatSalesData(previous) : null,\n          };\n        });\n      } else {\n        enrichedSales = currentSales.map(record => ({\n          id: v4(),\n          ...formatSalesData(record),\n          last_year: null,\n        }));\n      }\n\n      // this.salesData = enrichedSales.sort((a, b) => {\n      //   if (a.country_id === 0) return -1;\n      //   if (b.country_id === 0) return 1;\n      //   return 0;\n      // });\n      this.salesData = [...enrichedSales];\n    } catch (error) {\n      console.error('Failed to fetch sales data:', error);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Sales by Country</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getCountrySales(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          <ir-sales-by-country-summary salesReports={this.salesData}></ir-sales-by-country-summary>\n          <div class=\"d-flex flex-column flex-lg-row mt-1 \" style={{ gap: '1rem' }}>\n            <ir-sales-filters\n              isLoading={this.isLoading === 'filter'}\n              onApplyFilters={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.salesFilters = e.detail;\n                this.getCountrySales();\n              }}\n              class=\"filters-card\"\n              baseFilters={this.baseFilters}\n            ></ir-sales-filters>\n            <ir-sales-table mappedCountries={this.countries} class=\"card mb-0\" records={this.salesData}></ir-sales-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  height: 100%;\n}\n","import Token from '@/models/Token';\nimport { User } from '@/models/Users';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { RoomService } from '@/services/room.service';\nimport { UserService } from '@/services/user.service';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { AllowedUser } from './types';\nimport { bookingReasons } from '@/models/IBooking';\nimport { io, Socket } from 'socket.io-client';\nimport locales from '@/stores/locales.store';\n\n@Component({\n  tag: 'ir-user-management',\n  styleUrl: 'ir-user-management.css',\n  scoped: true,\n})\nexport class IrUserManagement {\n  @Prop() language: string = '';\n  @Prop() baseUrl: string;\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() p: string;\n  @Prop() isSuperAdmin: boolean = true;\n  @Prop() userTypeCode: string | number;\n  @Prop() baseUserTypeCode: string | number;\n  @Prop() userId: string | number;\n\n  @State() isLoading = true;\n  @State() users: User[] = [];\n  @State() property_id: number;\n  @State() allowedUsersTypes: AllowedUser[] = [];\n\n  private token = new Token();\n  private roomService = new RoomService();\n  private userService = new UserService();\n  private bookingService = new BookingService();\n\n  private userTypes: Map<number | string, string> = new Map();\n  private socket: Socket;\n\n  private superAdminId = '5';\n\n  componentWillLoad() {\n    if (this.baseUrl) {\n      this.token.setBaseUrl(this.baseUrl);\n    }\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.token.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.fetchUsers();\n  }\n\n  private async initializeApp() {\n    try {\n      if (this.baseUrl) {\n        this.token.setBaseUrl(this.baseUrl);\n      }\n      this.isLoading = true;\n      let propertyId = this.propertyid;\n      if (!this.propertyid && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      // let roomResp = null;\n      if (!propertyId) {\n        console.log(propertyId);\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        // roomResp = propertyData;\n        propertyId = propertyData.My_Result.id;\n      }\n      this.property_id = propertyId;\n      const requests = [this.fetchUserTypes(), this.fetchUsers(), this.roomService.fetchLanguage(this.language, ['_USER_MGT'])];\n      if (this.propertyid) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: this.propertyid,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      await Promise.all(requests);\n      this.socket = io('https://realtime.igloorooms.com/');\n      this.socket.on('MSG', async msg => {\n        await this.handleSocketMessage(msg);\n      });\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private async handleSocketMessage(msg: string) {\n    const msgAsObject = JSON.parse(msg);\n    if (!msgAsObject) {\n      return;\n    }\n\n    const { REASON, KEY, PAYLOAD }: { REASON: bookingReasons; KEY: any; PAYLOAD: any } = msgAsObject;\n\n    if (KEY.toString() !== this.property_id.toString()) {\n      return;\n    }\n\n    let result = JSON.parse(PAYLOAD);\n    console.log(KEY, result);\n    // const reasonHandlers: Partial<Record<bookingReasons, Function>> = {\n    //   DORESERVATION: this.updateUserVerificationStatus,\n    // };\n    const reasonHandlers: Partial<Record<bookingReasons, Function>> = {\n      EMAIL_VERIFIED: this.updateUserVerificationStatus,\n    };\n    const handler = reasonHandlers[REASON];\n    if (handler) {\n      await handler.call(this, result);\n    } else {\n      console.warn(`Unhandled REASON: ${REASON}`);\n    }\n  }\n\n  public updateUserVerificationStatus(result: { id: string | number }) {\n    const users = [...this.users];\n    const idx = users.findIndex(u => u.id === result.id);\n    if (idx === -1) {\n      console.warn(`User ${result.id} not found`);\n      return;\n    }\n    users[idx] = {\n      ...users[idx],\n      is_email_verified: true,\n    };\n    this.users = users;\n  }\n\n  private async fetchUsers() {\n    const users = await this.userService.getExposedPropertyUsers({ property_id: this.propertyid });\n    this.users = [...users].sort((u1: User, u2: User) => {\n      const priority = (u: User) => {\n        const t = u.type.toString();\n        if (t === this.superAdminId) return 0;\n        if (t === '17') return 1;\n        return 2;\n      };\n      //sort by priority\n      const p1 = priority(u1),\n        p2 = priority(u2);\n      if (p1 !== p2) {\n        return p1 - p2;\n      }\n      // //sort by user id\n      // if (p1 === 1) {\n      //   const id1 = u1.id.toString(),\n      //     id2 = u2.id.toString(),\n      //     me = this.userId.toString();\n      //   if (id1 === me) return -1; // u1 is me → goes before u2\n      //   if (id2 === me) return 1; // u2 is me → u1 goes after\n      // }\n\n      // 3) sort by username\n      return u1.username.localeCompare(u2.username);\n    });\n  }\n  private async fetchUserTypes() {\n    const res = await Promise.all([this.bookingService.getSetupEntriesByTableName('_USER_TYPE'), this.bookingService.getLov()]);\n    const allowedUsers = res[1]?.My_Result?.allowed_user_types;\n    for (const e of res[0]) {\n      const value = e[`CODE_VALUE_${this.language?.toUpperCase() ?? 'EN'}`];\n      if (allowedUsers.find(f => f.code === e.CODE_NAME)) {\n        this.allowedUsersTypes.push({ code: e.CODE_NAME, value });\n      }\n      this.userTypes.set(e.CODE_NAME.toString(), value);\n    }\n  }\n  disconnectedCallback() {\n    this.socket.disconnect();\n  }\n  render() {\n    if (this.isLoading) {\n      return (\n        <Host>\n          <ir-toast></ir-toast>\n          <ir-interceptor></ir-interceptor>\n          <ir-loading-screen></ir-loading-screen>\n        </Host>\n      );\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor suppressToastEndpoints={['/Change_User_Pwd', '/Handle_Exposed_User']}></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex  pb-2 align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">{locales.entries.Lcz_ExtranetUsers}</h3>\n          </div>\n\n          <div class=\"\" style={{ gap: '1rem' }}>\n            <ir-user-management-table\n              property_id={this.property_id}\n              baseUserTypeCode={this.baseUserTypeCode}\n              allowedUsersTypes={this.allowedUsersTypes}\n              userTypeCode={this.userTypeCode}\n              haveAdminPrivileges={[this.superAdminId, '17'].includes(this.userTypeCode?.toString())}\n              userTypes={this.userTypes}\n              class=\"card\"\n              isSuperAdmin={this.userTypeCode?.toString() === this.superAdminId}\n              users={this.users}\n            ></ir-user-management-table>\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}