import{a as t,T as n}from"./p-1296c4bd.js";import{h as e}from"./p-6c4ba7c0.js";import{l as o}from"./p-389c26bd.js";import{c as r}from"./p-bb593e1b.js";import{c as a}from"./p-80497476.js";function s(t,n){const o=`${t.split(" ")[1]} ${n}`;const r=e(o,"DD MMM YYYY");if(!r.isValid()){throw new Error("Invalid Date")}return r.format("D_M_YYYY")}function i(t,n){const o=e(t+" "+n,"ddd DD MMM YYYY").toDate();o.setHours(0,0,0,0);return o.getTime()}function c(t,n){const e=new Date(t);const o=new Date(n);return Math.ceil((o.getTime()-e.getTime())/(1e3*60*60*24))}function _(t){const n=t.getFullYear();const e=(t.getMonth()+1).toString().padStart(2,"0");const o=t.getDate().toString().padStart(2,"0");return`${n}-${e}-${o}`}function l(t){let n={};const e={"IN-HOUSE":{id:1,clsName:"IN_HOUSE"},CONFIRMED:{id:2,clsName:"CONFIRMED"},"PENDING-CONFIRMATION":{id:3,clsName:"PENDING_CONFIRMATION"},"SPLIT-UNIT":{id:4,clsName:"SPLIT_UNIT"},"CHECKED-IN":{id:5,clsName:"CHECKED_IN"},"CHECKED-OUT":{id:5,clsName:"CHECKED_OUT"},BLOCKED:{id:6,clsName:"BLOCKED"},"BLOCKED-WITH-DATES":{id:7,clsName:"BLOCKED_WITH_DATES"},NOTES:{id:8,clsName:"NOTES"},"OUTSTANDING-BALANCE":{id:9,clsName:"OUTSTANDING_BALANCE"},"TEMP-EVENT":{id:10,clsName:"PENDING_CONFIRMATION"}};t.forEach((t=>{n[t.id]=t;n.statusId=e}));return n}function E(t){return["003","002","004"].includes(t)}function u(t){const n=new Intl.NumberFormat(undefined,{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0});return n.format(0).replace(/[0-9]/g,"").trim()}const d=(t,n)=>n.find((n=>n.id===t));function T(t){const n=new Date;const e=t;n.setHours(n.getHours()+e,n.getMinutes(),0,0);return{BLOCKED_TILL_DATE:_(n),BLOCKED_TILL_HOUR:n.getHours().toString(),BLOCKED_TILL_MINUTE:n.getMinutes().toString()}}function D(t,n){const o=e(t,"D_M_YYYY");o.add(n,"days");return o.format("YYYY-MM-DD")}function f(t){const n=e(t,"D_M_YYYY");return n.format("YYYY-MM-DD")}function O(t){return e(t).add(2,"months").format("YYYY-MM-DD")}function N(t,n="DD MMM YYYY"){const o=e(t,n).format("ddd, DD MMM YYYY");return o}function Y(t){return e(t).add(1,"days").format("YYYY-MM-DD")}function w(t){return e(t,"YYYY-MM-DD").format("DD/MM ddd")}function A(t,n){let o=[];let r=e.min(e(t).add(1,"days"),e(n));let a=e.max(e(t),e(n));while(r<a){o.push(r.format("YYYY-MM-DD"));r=r.clone().add(1,"days")}return o}const h=[{key:"private_note",value:""}];async function M(t){const n=[];const e=await S();for(const o of t){for(const t of o.days){for(const o of t.room_types){I(o.physicalrooms,n,e)}}}return n}function I(t,n,e){for(const o of t){for(const t in o.calendar_cell){if(o.calendar_cell[t].Is_Available===false){L(o.calendar_cell[t],n,e)}}}}const R={"004":"BLOCKED","003":"BLOCKED-WITH-DATES","002":"BLOCKED"};const y={"000":"IN-HOUSE","001":"PENDING-CONFIRMATION","002":"CONFIRMED","003":"CHECKED-OUT"};function m(t,n){if(t===null&&n===null)return"";if(n!==null&&n!==""){return`${t!==null&&t!==void 0?t:""} , ${n!==null&&n!==void 0?n:""}`}return t}async function S(){try{const n=r.token;if(n){const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_Multi?Ticket=${n}`,{TBL_NAMES:["_STAY_STATUS"]});return e.My_Result.map((t=>({code:t.CODE_NAME,value:t.CODE_VALUE_EN})))}else{throw new Error("Invalid Token")}}catch(t){console.log(t)}}function C(t,n,r){const a=new Date(t);a.setHours(n);a.setMinutes(r);return`${o.entries.Lcz_BlockedTill} ${e(a).format("MMM DD, HH:mm")}`}function p(t,n){var o,r,a,s;if(E(t.STAY_STATUS_CODE)){const o=e(t.My_Block_Info.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.from_date:t.DATE;const r=e(t.My_Block_Info.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.My_Block_Info.to_date:t.DATE;return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.My_Block_Info.NOTES!==""?t.My_Block_Info.NOTES:t.STAY_STATUS_CODE==="003"?C(t.My_Block_Info.BLOCKED_TILL_DATE,t.My_Block_Info.BLOCKED_TILL_HOUR,t.My_Block_Info.BLOCKED_TILL_MINUTE):n.find((n=>n.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.My_Block_Info.DESCRIPTION,PR_ID:t.My_Block_Info.pr_id,ENTRY_DATE:t.My_Block_Info.BLOCKED_TILL_DATE,ENTRY_HOUR:t.My_Block_Info.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.My_Block_Info.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.My_Block_Info.NOTES,FROM_DATE:o,TO_DATE:r,NO_OF_DAYS:c(o,r),STATUS:R[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.My_Block_Info.format.from_date,TO_DATE_STR:t.My_Block_Info.format.to_date,defaultDates:{from_date:t.My_Block_Info.from_date,to_date:t.My_Block_Info.to_date}}}if(t.booking.booking_nbr.toString()==="23080178267"){console.log("booking",t)}const i=e(t.room.from_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.from_date:t.DATE;const _=e(t.room.to_date,"YYYY-MM-DD").isAfter(t.DATE)?t.room.to_date:t.DATE;return{ID:t.POOL,FROM_DATE:i,TO_DATE:_,NO_OF_DAYS:c(i,_),STATUS:y[(o=t.booking)===null||o===void 0?void 0:o.status.code],NAME:m(t.room.guest.first_name,t.room.guest.last_name),IDENTIFIER:t.room.identifier,PR_ID:t.pr_id,POOL:t.POOL,BOOKING_NUMBER:t.booking.booking_nbr,NOTES:t.booking.is_direct?t.booking.remark:null,PRIVATE_NOTE:b(t.booking.extras),is_direct:t.booking.is_direct,BALANCE:(r=t.booking.financial)===null||r===void 0?void 0:r.due_amount,channel_booking_nbr:t.booking.channel_booking_nbr,ARRIVAL_TIME:t.booking.arrival.description,defaultDates:{from_date:t.room.from_date,to_date:t.room.to_date},ENTRY_DATE:t.booking.booked_on.date,PHONE_PREFIX:t.booking.guest.country_phone_prefix,IS_EDITABLE:t.booking.is_editable,ARRIVAL:t.booking.arrival,PHONE:(a=t.booking.guest.mobile)!==null&&a!==void 0?a:"",RATE:t.room.total,RATE_PLAN:t.room.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:t.room.rateplan.id,RATE_TYPE:1,ADULTS_COUNT:t.room.occupancy.adult_nbr,CHILDREN_COUNT:t.room.occupancy.children_nbr,origin:t.booking.origin,GUEST:t.booking.guest,ROOMS:t.booking.rooms,cancelation:t.room.rateplan.cancelation,guarantee:t.room.rateplan.guarantee,TOTAL_PRICE:(s=t.booking.financial)===null||s===void 0?void 0:s.gross_total,COUNTRY:t.booking.guest.country_id,FROM_DATE_STR:t.booking.format.from_date,TO_DATE_STR:t.booking.format.to_date,adult_child_offering:t.room.rateplan.selected_variation.adult_child_offering,SOURCE:{code:t.booking.source.code,description:t.booking.source.description,tag:t.booking.source.tag}}}function L(t,n,e){const o=n.findIndex((n=>n.POOL===t.POOL));if(o===-1){const o=p(t,e);n.push(o)}}function b(t){var n;if(!t){return null}return((n=t.find((t=>t.key==="private_note")))===null||n===void 0?void 0:n.value)||null}function k(t){let n=[];const o=n=>{const o=e();const r=e(n.to_date,"YYYY-MM-DD");const a=e(n.from_date,"YYYY-MM-DD");if(a.isSame(o,"day")&&o.hour()>=12){return y["000"]}else if(o.isAfter(a,"day")&&o.isBefore(r,"day")){return y["000"]}else if(r.isSame(o,"day")&&o.hour()<12){return y["000"]}else if(r.isSame(o,"day")&&o.hour()>=12||r.isBefore(o,"day")){return y["003"]}else{return y[(t===null||t===void 0?void 0:t.status.code)||"001"]}};const r=t.rooms.filter((t=>!!t["assigned_units_pool"]));r.forEach((r=>{var s,i,c;const _=e(r.from_date,"YYYY-MM-DD").isAfter(e(a.fromDate,"YYYY-MM-DD"))?r.from_date:a.fromDate;const l=e(r.to_date,"YYYY-MM-DD").isAfter(e(a.toDate,"YYYY-MM-DD"))?r.to_date:a.toDate;console.log(l,_,r.from_date,r.to_date);n.push({ID:r["assigned_units_pool"],TO_DATE:r.to_date,FROM_DATE:r.from_date,PRIVATE_NOTE:b(t.extras),NO_OF_DAYS:r.days.length,ARRIVAL:t.arrival,IS_EDITABLE:true,BALANCE:(s=t.financial)===null||s===void 0?void 0:s.due_amount,STATUS:o(r),NAME:m(r.guest.first_name,r.guest.last_name),PHONE:(i=t.guest.mobile)!==null&&i!==void 0?i:"",ENTRY_DATE:"12-12-2023",PHONE_PREFIX:t.guest.country_phone_prefix,RATE:r.total,RATE_PLAN:r.rateplan.name,SPLIT_BOOKING:false,RATE_PLAN_ID:r.rateplan.id,IDENTIFIER:r.identifier,RATE_TYPE:r.roomtype.id,ADULTS_COUNT:r.occupancy.adult_nbr,CHILDREN_COUNT:r.occupancy.children_nbr,PR_ID:+r.unit.id,POOL:r["assigned_units_pool"],GUEST:t.guest,ROOMS:t.rooms,BOOKING_NUMBER:t.booking_nbr,cancelation:r.rateplan.cancelation,guarantee:r.rateplan.guarantee,TOTAL_PRICE:(c=t.financial)===null||c===void 0?void 0:c.gross_total,COUNTRY:t.guest.country_id,FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,adult_child_offering:r.rateplan.selected_variation.adult_child_offering,ARRIVAL_TIME:t.arrival.description,origin:t.origin,channel_booking_nbr:t.channel_booking_nbr,is_direct:t.is_direct,NOTES:t.is_direct?t.remark:null,SOURCE:{code:t.source.code,description:t.source.description,tag:t.source.tag},ota_notes:t.ota_notes,defaultDates:{from_date:r.from_date,to_date:r.to_date}})}));return n}async function g(t){const n=await S();return{ID:t.POOL,NOTES:"",BALANCE:"",NAME:t.NOTES!==""?t.NOTES:t.STAY_STATUS_CODE==="003"?C(t.BLOCKED_TILL_DATE,t.BLOCKED_TILL_HOUR,t.BLOCKED_TILL_MINUTE):n.find((n=>n.code===t.STAY_STATUS_CODE)).value||"",RELEASE_AFTER_HOURS:t.DESCRIPTION,PR_ID:t.pr_id,ENTRY_DATE:t.BLOCKED_TILL_DATE,ENTRY_HOUR:t.BLOCKED_TILL_HOUR,ENTRY_MINUTE:t.BLOCKED_TILL_MINUTE,OPTIONAL_REASON:t.NOTES,FROM_DATE:t.from_date,TO_DATE:t.to_date,NO_OF_DAYS:P(t.from_date,t.to_date),STATUS:R[t.STAY_STATUS_CODE],POOL:t.POOL,STATUS_CODE:t.STAY_STATUS_CODE,OUT_OF_SERVICE:t.STAY_STATUS_CODE==="004",FROM_DATE_STR:t.format.from_date,TO_DATE_STR:t.format.to_date,defaultDates:{from_date:t.from_date,to_date:t.to_date}}}function P(t,n){const o=e(t,"YYYY-MM-DD");const r=e(n,"YYYY-MM-DD");const a=r.diff(o,"days");return a||1}var U=undefined&&undefined.__rest||function(t,n){var e={};for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&n.indexOf(o)<0)e[o]=t[o];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,o=Object.getOwnPropertySymbols(t);r<o.length;r++){if(n.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r]))e[o[r]]=t[o[r]]}return e};class B extends n{async getCalendarData(n,e,o){try{const r=this.getToken();if(r!==null){const{data:a}=await t.post(`/Get_Exposed_Calendar?Ticket=${r}`,{propertyid:n,from_date:e,to_date:o,extras:h});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}const c=a.My_Result.months;const _=[];const l=await M(c);const E=c.map((t=>{_.push({daysCount:t.days.length,monthName:t.description});return t.days.map((n=>({day:s(n.description,t.description),currentDate:i(n.description,t.description),dayDisplayName:n.description,rate:n.room_types,unassigned_units_nbr:n.unassigned_units_nbr,occupancy:n.occupancy})))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:n,FROM:a.My_Params_Get_Exposed_Calendar.from_date,TO:a.My_Params_Get_Exposed_Calendar.to_date},days:E,months:_,myBookings:l,defaultMonths:c})}}catch(t){console.error(t)}}async fetchGuest(n){try{const e=this.getToken();if(e!==null){const{data:o}=await t.post(`/Get_Exposed_Guest?Ticket=${e}`,{email:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}}catch(t){console.log(t);throw new Error(t)}}async fetchPMSLogs(n){try{const e=this.getToken();if(e!==null){const{data:o}=await t.post(`/Get_Exposed_PMS_Logs?Ticket=${e}`,{booking_nbr:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}}catch(t){console.log(t);throw new Error(t)}}async editExposedGuest(n,e){try{const o=this.getToken();if(o!==null){const{data:r}=await t.post(`/Edit_Exposed_Guest?Ticket=${o}`,Object.assign(Object.assign({},n),{book_nbr:e}));if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}}catch(t){console.log(t);throw new Error(t)}}async getBookingAvailability(n){try{const e=this.getToken();if(e){const{adultChildCount:o,currency:r}=n,a=U(n,["adultChildCount","currency"]);const{data:s}=await t.post(`/Get_Exposed_Booking_Availability?Ticket=${e}`,Object.assign(Object.assign({},a),{adult_nbr:o.adult,child_nbr:o.child,currency_ref:r.code,is_backend:true}));if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}return s["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async getCountries(n){try{const e=this.getToken();if(e){const{data:o}=await t.post(`/Get_Exposed_Countries?Ticket=${e}`,{language:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}}catch(t){console.error(t);throw new Error(t)}}async fetchSetupEntries(){try{const n=this.getToken();if(n){const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI?Ticket=${n}`,{TBL_NAMES:["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}const o=e.My_Result;return{arrivalTime:o.filter((t=>t.TBL_NAME==="_ARRIVAL_TIME")),ratePricingMode:o.filter((t=>t.TBL_NAME==="_RATE_PRICING_MODE")),bedPreferenceType:o.filter((t=>t.TBL_NAME==="_BED_PREFERENCE_TYPE"))}}}catch(t){console.error(t);throw new Error(t)}}async getBlockedInfo(){try{const n=this.getToken();if(n){const{data:e}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI?Ticket=${n}`,{TBL_NAMES:["_CALENDAR_BLOCKED_TILL"]});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e.My_Result}}catch(t){console.error(t);throw new Error(t)}}async getUserDefaultCountry(){try{const n=this.getToken();if(n){const{data:e}=await t.post(`/Get_Country_By_IP?Ticket=${n}`,{IP:""});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e["My_Result"]}}catch(t){console.error(t);throw new Error(t)}}async blockUnit(n){try{const e=this.getToken();if(e){const{data:o}=await t.post(`/Block_Exposed_Unit?Ticket=${e}`,n);if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}console.log(o);return o["My_Params_Block_Exposed_Unit"]}}catch(t){console.error(t);throw new Error(t)}}async getUserInfo(n){try{const e=this.getToken();if(e){const{data:o}=await t.post(`/GET_EXPOSED_GUEST?Ticket=${e}`,{email:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}else{throw new Error("Invalid Token")}}catch(t){console.error(t);throw new Error(t)}}async getExposedBooking(n,e,o=true){try{const r=this.getToken();if(r){const{data:a}=await t.post(`/Get_Exposed_Booking?Ticket=${r}`,{booking_nbr:n,language:e,extras:o?h:null});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a.My_Result}else{throw new Error("Invalid Token")}}catch(t){console.error(t)}}generateDays(t,n,e){const o=new Date(t);const r=new Date(n);const a=[];while(o<r){a.push({date:o.toISOString().split("T")[0],amount:e,cost:null});o.setDate(o.getDate()+1)}return a}calculateTotalRate(t,n,e,o){if(e&&o===2){return+t}return+t/+n}async fetchExposedGuest(n,e){try{const o=this.getToken();if(o){const{data:r}=await t.post(`/Fetch_Exposed_Guests?Ticket=${o}`,{email:n,property_id:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async fetchExposedBookings(n,e,o,r){try{const a=this.getToken();if(a){const{data:s}=await t.post(`/Fetch_Exposed_Bookings?Ticket=${a}`,{booking_nbr:n,property_id:e,from_date:o,to_date:r});if(s.ExceptionMsg!==""){throw new Error(s.ExceptionMsg)}return s["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async getPCICardInfoURL(n){try{const e=this.getToken();if(e){const{data:o}=await t.post(`/Get_PCI_Card_Info_URL?Ticket=${e}`,{BOOK_NBR:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o["My_Result"]}else{throw new Error("Token doesn't exist")}}catch(t){console.error(t);throw new Error(t)}}async doReservation(n){const e=this.getToken();if(!e){throw new Error("Missing token")}const{data:o}=await t.post(`/DoReservation?Ticket=${e}`,Object.assign(Object.assign({},n),{extras:n.extras?n.extras:h}));if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}console.log(o["My_Result"]);return o["My_Result"]}async bookUser({bookedByInfoData:t,check_in:n,currency:e,extras:o=null,fromDate:r,guestData:a,pickup_info:s,propertyid:i,rooms:c,source:l,toDate:E,totalNights:u,arrivalTime:d,bookingNumber:T,defaultGuest:D,identifier:f,pr_id:O}){try{const N=this.getToken();if(N){const N=_(r);const Y=_(E);let w={email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.contactNumber===null?"":t.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:t.emailGuest||false,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null};if(D){w=Object.assign(Object.assign({},D),{email:D.email===""?null:D.email})}if(t.id){w=Object.assign(Object.assign({},w),{id:t.id})}const A={assign_units:true,check_in:n,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:o,booking:{booking_nbr:T||"",from_date:N,to_date:Y,remark:t.message||null,property:{id:i},source:l,currency:e,arrival:{code:d?d:t.selectedArrivalTime},guest:w,rooms:[...a.map((t=>({identifier:f||null,roomtype:{id:t.roomCategoryId,name:t.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:t.inventory,rate:t.rate/u},rateplan:{id:t.ratePlanId,name:t.ratePlanName,rate_restrictions:null,variations:null,cancelation:t.cancelation,guarantee:t.guarantee},unit:typeof O==="undefined"&&t.roomId===""?null:{id:+O||+t.roomId},occupancy:{adult_nbr:t.adultCount,children_nbr:t.childrenCount,infant_nbr:null},bed_preference:t.preference,from_date:N,to_date:Y,notes:null,days:this.generateDays(N,Y,this.calculateTotalRate(t.rate,u,t.isRateModified,t.rateType)),guest:{email:null,first_name:t.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),...c]},pickup_info:s};console.log("book user payload",A);const h=await this.doReservation(A);return h}else{throw new Error("Invalid token")}}catch(t){console.error(t);throw new Error(t)}}}export{B,M as a,i as b,s as c,_ as d,h as e,T as f,u as g,d as h,c as i,l as j,k,y as l,b as m,E as n,P as o,Y as p,O as q,f as r,D as s,g as t,m as u,A as v,w,N as x};
//# sourceMappingURL=p-ebbef25e.js.map