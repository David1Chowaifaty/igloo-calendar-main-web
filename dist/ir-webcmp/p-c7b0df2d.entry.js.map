{"version":3,"names":["irQueueManagerCss","IrQueueManagerStyle0","IrQueueManager","ticket","isLoading","tokenService","Token","data","componentWillLoad","this","setToken","init","handleTicketChange","newValue","oldValue","fetchData","axios","post","ExceptionMsg","My_Result","map","r","pendingRequests","properties","formatResults","q_name","total_pending","parsed","split","item","property","pending","v","trim","pendingNumber","Number","isNaN","filter","sort","a","b","p","render","h","Host","class","onClickHandler","appearance","loading","isRequestPending","name","length","style","marginTop","d","slot","index","percentage","value","toFixed"],"sources":["src/components/ir-queue-manager/ir-queue-manager.css?tag=ir-queue-manager&encapsulation=scoped","src/components/ir-queue-manager/ir-queue-manager.tsx"],"sourcesContent":[":host {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n\n/* Page */\n.queue-page {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n/* Grid of queue cards */\n.queue-grid {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n.queue-grid wa-card {\n  width: 100%;\n}\n\n/* Single property row */\n.queue-item {\n  display: grid;\n  align-items: center;\n  gap: 0.75rem;\n  margin-bottom: 0.5rem;\n}\n.queue-page__header {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  margin-bottom: 1rem;\n}\n.page-title {\n  margin-bottom: 0;\n}\n/* Property name */\n.queue-item__property {\n  font-size: 0.9rem;\n  line-height: 1.3;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n/* Progress + number container */\n.queue-item__status {\n  display: grid;\n  grid-template-columns: repeat(4, 1fr);\n  align-items: center;\n}\n\n/* Progress bar wrapper */\n.queue-item__progress {\n  grid-column: span 3;\n}\n\n/* Pending count */\n.queue-item__count {\n  text-align: right;\n  font-size: 0.85rem;\n}\n\n/* md */\n@media (min-width: 768px) {\n  .queue-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n  }\n}\n\n/* lg */\n@media (min-width: 1024px) {\n  .queue-item {\n    grid-template-columns: 300px 1fr;\n  }\n}\n","import Token from '@/models/Token';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport { Component, Element, Host, Prop, State, Watch, h } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-queue-manager',\n  styleUrl: 'ir-queue-manager.css',\n  scoped: true,\n})\nexport class IrQueueManager {\n  @Element() el: HTMLElement;\n\n  @Prop() ticket: string = '';\n\n  @State() isLoading: boolean = true;\n\n  private tokenService = new Token();\n  @State() data: {\n    pendingRequests: number[];\n    properties: string[];\n    q_name: string;\n    total_pending: number;\n  }[];\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  private async init() {\n    await this.fetchData();\n    this.isLoading = false;\n  }\n  private async fetchData() {\n    const { data } = await axios.post('/Get_Q_Summary', {});\n    if (data.ExceptionMsg) {\n      return;\n    }\n    this.data = data.My_Result.map(r => {\n      const { pendingRequests, properties } = this.formatResults(r.properties);\n      return {\n        pendingRequests,\n        properties,\n        q_name: r.q_name,\n        total_pending: r.total_pending,\n      };\n    });\n  }\n  private formatResults(data: string): {\n    properties: string[];\n    pendingRequests: number[];\n  } {\n    if (!data) {\n      return { properties: [], pendingRequests: [] };\n    }\n\n    const parsed = data\n      .split(',')\n      .map(item => {\n        const [property, pending] = item.split('|').map(v => v.trim());\n        const pendingNumber = Number(pending);\n\n        if (!property || Number.isNaN(pendingNumber)) {\n          return null;\n        }\n\n        return {\n          property,\n          pending: pendingNumber,\n        };\n      })\n      .filter((v): v is { property: string; pending: number } => v !== null);\n\n    // ðŸ”½ Sort by pending requests (highest first)\n    parsed.sort((a, b) => b.pending - a.pending);\n\n    return {\n      properties: parsed.map(p => p.property),\n      pendingRequests: parsed.map(p => p.pending),\n    };\n  }\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"ir-page__container\">\n          <div class=\"queue-page__header\">\n            <h3 class=\"page-title\">Pending Queues</h3>\n            <ir-custom-button\n              onClickHandler={() => {\n                this.fetchData();\n              }}\n              appearance=\"filled\"\n              loading={isRequestPending('/Get_Q_Summary')}\n            >\n              <wa-icon name=\"refresh\"></wa-icon>\n            </ir-custom-button>\n          </div>\n\n          {this.data.length === 0 && <ir-empty-state style={{ marginTop: '20vh' }}></ir-empty-state>}\n\n          <div class=\"queue-grid\">\n            {this.data.map(d => (\n              <wa-card>\n                <p slot=\"header\">\n                  {d.q_name} ({d.total_pending} total pending)\n                </p>\n\n                {d.properties.map((property, index) => {\n                  const pending = d.pendingRequests[index];\n                  const percentage = d.total_pending > 0 ? (pending / d.total_pending) * 100 : 0;\n\n                  return (\n                    <div class=\"queue-item\">\n                      <span class=\"queue-item__property\">{property}</span>\n\n                      <div class=\"queue-item__status\">\n                        <wa-progress-bar class=\"queue-item__progress\" value={percentage}></wa-progress-bar>\n\n                        <span class=\"queue-item__count\">\n                          {pending} ({percentage.toFixed(2)}%)\n                        </span>\n                      </div>\n                    </div>\n                  );\n                })}\n              </wa-card>\n            ))}\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n"],"mappings":"6LAAA,MAAMA,EAAoB,+lCAC1B,MAAAC,EAAeD,E,MCSFE,EAAc,M,iDAGjBC,OAAiB,GAEhBC,UAAqB,KAEtBC,aAAe,IAAIC,EAClBC,KAMT,iBAAAC,GACE,GAAIC,KAAKN,OAAQ,CACfM,KAAKJ,aAAaK,SAASD,KAAKN,QAChCM,KAAKE,M,EAIT,kBAAAC,CAAmBC,EAAkBC,GACnC,GAAID,IAAaC,GAAYD,EAAU,CACrCJ,KAAKJ,aAAaK,SAASD,KAAKN,QAChCM,KAAKE,M,EAID,UAAMA,SACNF,KAAKM,YACXN,KAAKL,UAAY,K,CAEX,eAAMW,GACZ,MAAMR,KAAEA,SAAeS,EAAMC,KAAK,iBAAkB,IACpD,GAAIV,EAAKW,aAAc,CACrB,M,CAEFT,KAAKF,KAAOA,EAAKY,UAAUC,KAAIC,IAC7B,MAAMC,gBAAEA,EAAeC,WAAEA,GAAed,KAAKe,cAAcH,EAAEE,YAC7D,MAAO,CACLD,kBACAC,aACAE,OAAQJ,EAAEI,OACVC,cAAeL,EAAEK,cAClB,G,CAGG,aAAAF,CAAcjB,GAIpB,IAAKA,EAAM,CACT,MAAO,CAAEgB,WAAY,GAAID,gBAAiB,G,CAG5C,MAAMK,EAASpB,EACZqB,MAAM,KACNR,KAAIS,IACH,MAAOC,EAAUC,GAAWF,EAAKD,MAAM,KAAKR,KAAIY,GAAKA,EAAEC,SACvD,MAAMC,EAAgBC,OAAOJ,GAE7B,IAAKD,GAAYK,OAAOC,MAAMF,GAAgB,CAC5C,OAAO,I,CAGT,MAAO,CACLJ,WACAC,QAASG,EACV,IAEFG,QAAQL,GAAkDA,IAAM,OAGnEL,EAAOW,MAAK,CAACC,EAAGC,IAAMA,EAAET,QAAUQ,EAAER,UAEpC,MAAO,CACLR,WAAYI,EAAOP,KAAIqB,GAAKA,EAAEX,WAC9BR,gBAAiBK,EAAOP,KAAIqB,GAAKA,EAAEV,U,CAGvC,MAAAW,GACE,GAAIjC,KAAKL,UAAW,CAClB,OAAOuC,EAAA,yB,CAGT,OACEA,EAACC,EAAI,KACHD,EAAA,uBACAA,EAAA,iBACAA,EAAA,OAAKE,MAAM,sBACTF,EAAA,OAAKE,MAAM,sBACTF,EAAA,MAAIE,MAAM,cAAY,kBACtBF,EAAA,oBACEG,eAAgB,KACdrC,KAAKM,WAAW,EAElBgC,WAAW,SACXC,QAASC,EAAiB,mBAE1BN,EAAA,WAASO,KAAK,cAIjBzC,KAAKF,KAAK4C,SAAW,GAAKR,EAAA,kBAAgBS,MAAO,CAAEC,UAAW,UAE/DV,EAAA,OAAKE,MAAM,cACRpC,KAAKF,KAAKa,KAAIkC,GACbX,EAAA,eACEA,EAAA,KAAGY,KAAK,UACLD,EAAE7B,OAAM,KAAI6B,EAAE5B,cAAa,mBAG7B4B,EAAE/B,WAAWH,KAAI,CAACU,EAAU0B,KAC3B,MAAMzB,EAAUuB,EAAEhC,gBAAgBkC,GAClC,MAAMC,EAAaH,EAAE5B,cAAgB,EAAKK,EAAUuB,EAAE5B,cAAiB,IAAM,EAE7E,OACEiB,EAAA,OAAKE,MAAM,cACTF,EAAA,QAAME,MAAM,wBAAwBf,GAEpCa,EAAA,OAAKE,MAAM,sBACTF,EAAA,mBAAiBE,MAAM,uBAAuBa,MAAOD,IAErDd,EAAA,QAAME,MAAM,qBACTd,EAAO,KAAI0B,EAAWE,QAAQ,GAAE,OAGjC,S","ignoreList":[]}