{"version":3,"names":["irOptionDetailsCss","IrOptionDetailsStyle0","sheetCss","IrOptionDetailsStyle1","IrOptionDetails","propertyId","localizationIdx","selectedLanguage","invalid","closeModal","toast","paymentOptionService","PaymentOptionService","componentWillLoad","payment_option_store","selectedOption","code","languages","result","this","GetExposedLanguages","localizables","id","toString","length","push","createBankTransferInfoObject","findIndex","l","language","description","saveOption","e","preventDefault","stopPropagation","stopImmediatePropagation","property_id","is_active","mode","englishDescription","find","toLowerCase","trim","isEditorEmpty","is_payment_gateway","display_order","hasInvalidData","data","some","d","value","HandlePaymentMethod","emit","type","title","locales","entries","Lcz_Saved","position","htmlString","text","replace","handleSelectChange","detail","idx","handleTextAreaChange","oldLocalizables","handlePaymentGatewayInfoChange","prevData","render","h","Host","class","onSubmit","bind","onCloseSideBar","label","Lcz_Information","displayContext","selectedValue","showFirstOption","map","Lcz_YouMustFillEnglishField","maxLength","placeholder","style","error","onTextChange","key","labelWidth","onClick","btn_styles","Lcz_Cancel","btn_color","btn_type","isLoading","isRequestPending","Lcz_Save"],"sources":["src/components/ir-payment-option/ir-option-details/ir-option-details.css?tag=ir-option-details&encapsulation=scoped","src/common/sheet.css?tag=ir-option-details&encapsulation=scoped","src/components/ir-payment-option/ir-option-details/ir-option-details.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { ILanguages, PaymentOption } from '@/models/payment-options';\nimport { PaymentOptionService } from '@/services/payment_option.service';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport payment_option_store from '@/stores/payment-option.store';\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, h } from '@stencil/core';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport locales from '@/stores/locales.store';\n@Component({\n  tag: 'ir-option-details',\n  styleUrls: ['ir-option-details.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IrOptionDetails {\n  @Prop() propertyId: string;\n\n  @State() localizationIdx: number;\n  @State() selectedLanguage: string = null;\n  @State() invalid: boolean = false;\n\n  @Event() closeModal: EventEmitter<PaymentOption | null>;\n  @Event() toast: EventEmitter<IToast>;\n\n  private paymentOptionService = new PaymentOptionService();\n\n  async componentWillLoad() {\n    if (payment_option_store.selectedOption.code !== '005') {\n      return;\n    }\n    if (!payment_option_store.languages) {\n      const result = await this.paymentOptionService.GetExposedLanguages();\n      payment_option_store.languages = result;\n    }\n    const localizables = payment_option_store.selectedOption.localizables ?? [];\n    this.selectedLanguage = payment_option_store.languages[0].id.toString();\n    if (localizables.length === 0) {\n      localizables.push(this.createBankTransferInfoObject(payment_option_store.languages[0]));\n    }\n    this.localizationIdx = payment_option_store.selectedOption.code === '005' ? localizables?.findIndex(l => l.language.id.toString() === this.selectedLanguage) : null;\n    payment_option_store.selectedOption = {\n      ...payment_option_store.selectedOption,\n      localizables: localizables,\n    };\n  }\n  private createBankTransferInfoObject(l: ILanguages): any {\n    return {\n      code: 'BANK_TRANSFER_INFO',\n      description: '',\n      id: null,\n      language: l,\n    };\n  }\n\n  async saveOption(e: Event) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n\n    let selectedOption: PaymentOption = {\n      ...payment_option_store.selectedOption,\n      property_id: this.propertyId,\n      is_active: payment_option_store.mode === 'create' ? true : payment_option_store.selectedOption.is_active ?? false,\n    };\n\n    if (selectedOption?.code === '005') {\n      const englishDescription = selectedOption.localizables.find(l => l.language.code.toLowerCase() === 'en')?.description;\n      if (!englishDescription || englishDescription.trim() === '' || this.isEditorEmpty(englishDescription.trim())) {\n        this.selectedLanguage = payment_option_store.languages.find(l => l.code.toLowerCase() === 'en').id.toString();\n        this.localizationIdx = payment_option_store.selectedOption.localizables.findIndex(l => l.language.id.toString() === this.selectedLanguage);\n        this.invalid = true;\n        return;\n      }\n    }\n    if (selectedOption.is_payment_gateway) {\n      selectedOption.display_order = 0;\n      const hasInvalidData = selectedOption.data.some(d => !d.value || d.value === '');\n      if (hasInvalidData) {\n        this.invalid = true;\n        return;\n      }\n    }\n    await this.paymentOptionService.HandlePaymentMethod(selectedOption);\n    this.toast.emit({\n      type: 'success',\n      description: '',\n      title: locales.entries.Lcz_Saved,\n      position: 'top-right',\n    });\n    this.closeModal.emit(selectedOption);\n  }\n  private isEditorEmpty(htmlString: string): boolean {\n    const text = htmlString\n      .replace(/<\\/?[^>]+(>|$)/g, '')\n      .replace(/&nbsp;/g, '')\n      .trim();\n    return text.length === 0;\n  }\n\n  @Listen('selectChange')\n  handleSelectChange(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    if (payment_option_store.selectedOption.code !== '005') {\n      return;\n    }\n    this.selectedLanguage = e.detail;\n    let idx = payment_option_store.selectedOption.localizables.findIndex(l => l.language.id.toString() === this.selectedLanguage);\n    const localizables = payment_option_store.selectedOption.localizables ?? [];\n    if (idx === -1) {\n      localizables.push(this.createBankTransferInfoObject(payment_option_store.languages.find(l => l.id.toString() === this.selectedLanguage)));\n      payment_option_store.selectedOption = {\n        ...payment_option_store.selectedOption,\n        localizables: localizables,\n      };\n      idx = localizables.length - 1;\n    }\n    this.localizationIdx = idx;\n  }\n\n  private handleTextAreaChange(e: CustomEvent) {\n    const value = e.detail;\n    if (value.trim() !== '' && this.invalid) {\n      this.invalid = false;\n    }\n    const oldLocalizables = [...payment_option_store.selectedOption.localizables];\n    oldLocalizables[this.localizationIdx] = {\n      ...oldLocalizables[this.localizationIdx],\n      description: value,\n    };\n    payment_option_store.selectedOption = {\n      ...payment_option_store.selectedOption,\n      localizables: oldLocalizables,\n    };\n  }\n  private handlePaymentGatewayInfoChange(e: CustomEvent, idx: number): void {\n    const value = e.detail;\n    const prevData = [...payment_option_store.selectedOption.data];\n    prevData[idx] = { ...prevData[idx], value };\n    payment_option_store.selectedOption = {\n      ...payment_option_store.selectedOption,\n      data: prevData,\n    };\n  }\n  render() {\n    if (!payment_option_store.selectedOption) {\n      return null;\n    }\n    return (\n      <Host>\n        <form class={'sheet-container'} onSubmit={this.saveOption.bind(this)}>\n          <ir-title\n            class=\"px-1 sheet-header\"\n            onCloseSideBar={() => this.closeModal.emit(null)}\n            label={locales?.entries.Lcz_Information?.replace('%1', payment_option_store.selectedOption?.description)}\n            displayContext=\"sidebar\"\n          ></ir-title>\n\n          <div class=\"sheet-body px-1\">\n            {payment_option_store.selectedOption.code === '005' ? (\n              <div>\n                <div class=\"mb-1\">\n                  <ir-select\n                    selectedValue={this.selectedLanguage}\n                    showFirstOption={false}\n                    data={payment_option_store.languages.map(l => ({\n                      text: l.description,\n                      value: l.id.toString(),\n                    }))}\n                  ></ir-select>\n                </div>\n                <div>\n                  {this.invalid && <p class=\"text-danger p-0 m-0\">{locales.entries.Lcz_YouMustFillEnglishField}</p>}\n                  {/* <ir-textarea\n                  placeholder=\"\"\n                  aria-invalid={this.invalid ? 'true' : 'false'}\n                  textareaClassname=\"money-transfer-form\"\n                  label=\"\"\n                  styles={{ height: '200px', maxHeight: '250px' }}\n                  onTextChange={this.handleTextAreaChange.bind(this)}\n                  value={this.localizationIdx !== null ? payment_option_store.selectedOption?.localizables[this.localizationIdx]?.description ?? '' : ''}\n                ></ir-textarea> */}\n                  <ir-text-editor\n                    // plugins={[Link]}\n                    // pluginsMode=\"add\"\n                    // toolbarItemsMode=\"add\"\n                    // toolbarItems={['|', 'link']}\n                    maxLength={450}\n                    placeholder=\"\"\n                    style={{ '--ir-editor-height': '250px' }}\n                    error={this.invalid}\n                    value={this.localizationIdx !== null ? payment_option_store.selectedOption?.localizables[this.localizationIdx]?.description ?? '' : ''}\n                    onTextChange={this.handleTextAreaChange.bind(this)}\n                  ></ir-text-editor>\n                </div>\n              </div>\n            ) : (\n              <div>\n                {payment_option_store.selectedOption.data?.map((d, idx) => {\n                  return (\n                    <fieldset key={d.key}>\n                      <ir-input-text\n                        value={d.value}\n                        onTextChange={e => this.handlePaymentGatewayInfoChange(e, idx)}\n                        id={`input_${d.key}`}\n                        label={d.key.replace(/_/g, ' ')}\n                        placeholder=\"\"\n                        labelWidth={4}\n                        aria-invalid={this.invalid && (d.value === null || (d.value ?? '')?.trim() === '') ? 'true' : 'false'}\n                      ></ir-input-text>\n                    </fieldset>\n                  );\n                })}\n              </div>\n            )}\n          </div>\n          <div class={'sheet-footer'}>\n            <ir-button\n              onClick={() => this.closeModal.emit(null)}\n              btn_styles=\"justify-content-center\"\n              class={`flex-fill`}\n              text={locales.entries.Lcz_Cancel}\n              btn_color=\"secondary\"\n              btn_type=\"button\"\n            ></ir-button>\n\n            <ir-button\n              btn_type=\"submit\"\n              btn_styles=\"justify-content-center align-items-center\"\n              class={'flex-fill'}\n              isLoading={isRequestPending('/Handle_Payment_Method')}\n              text={locales.entries.Lcz_Save}\n              btn_color=\"primary\"\n            ></ir-button>\n          </div>\n        </form>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}