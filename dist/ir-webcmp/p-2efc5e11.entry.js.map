{"version":3,"names":["irFinancialActionsCss","IrFinancialActionsStyle0","IrFinancialActions","constructor","hostRef","this","language","ticket","isPageLoading","tokenService","Token","roomService","RoomService","bookingService","BookingService","handleSidebarClose","e","stopImmediatePropagation","stopPropagation","sideBarEvent","componentWillLoad","setToken","initializeApp","ticketChanged","newValue","oldValue","renderSidebarBody","type","h","slot","hasPrint","hasReceipt","hasCloseButton","onCloseSidebar","is_from_front_desk","propertyid","property_id","hasRoomEdit","hasRoomDelete","bookingNumber","payload","toString","hasRoomAdd","_b","_a","paymentEntries","payment","mode","onCloseModal","handleOpenSidebar","detail","getFinancialAction","isExportToExcel","console","log","propertyId","p","Error","propertyData","getExposedProperty","id","aname","is_backend","include_units_hk_status","My_Result","requests","getSetupEntriesByTableNameMulti","fetchLanguage","push","setupEntries","Promise","all","pay_type","pay_type_group","pay_method","groupEntryTablesResult","groups","methods","types","error","render","Host","class","style","gap","size","btn_color","isLoading","text","locales","entries","Lcz_Export","onClickHandler","async","btnStyle","height","iconPosition","icon_name","icon_style","sidebarStyles","width","background","_c","open","Boolean","showCloseButton","onIrSidebarToggle"],"sources":["src/components/ir-financial-actions/ir-financial-actions.css?tag=ir-financial-actions&encapsulation=scoped","src/components/ir-financial-actions/ir-financial-actions.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n.financial-actions__meta {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.daily-revenue__table {\n  flex: 1 1 0%;\n}\n\n/*sm*/\n@media (min-width: 768px) {\n  .financial-actions__meta {\n    flex-direction: row;\n  }\n}\n","import Token from '@/models/Token';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { SidebarOpenEvent } from './types';\nimport locales from '@/stores/locales.store';\nimport { RoomService } from '@/services/room.service';\nimport { PaymentEntries } from '../ir-booking-details/types';\nimport { BookingService } from '@/services/booking.service';\n\n@Component({\n  tag: 'ir-financial-actions',\n  styleUrl: 'ir-financial-actions.css',\n  scoped: true,\n})\nexport class IrFinancialActions {\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() propertyid: number;\n  @Prop() p: string;\n\n  @State() isLoading: string;\n  @State() isPageLoading: boolean = true;\n  @State() property_id: number;\n  @State() sideBarEvent: SidebarOpenEvent | null;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n  private paymentEntries: PaymentEntries;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.initializeApp();\n    }\n  }\n\n  @Watch('ticket')\n  ticketChanged(newValue: string, oldValue: string) {\n    if (newValue === oldValue) {\n      return;\n    }\n    this.tokenService.setToken(this.ticket);\n    this.initializeApp();\n  }\n\n  private handleSidebarClose = (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = null;\n  };\n\n  private renderSidebarBody() {\n    if (!this.sideBarEvent) {\n      return;\n    }\n\n    switch (this.sideBarEvent.type) {\n      case 'booking':\n        return (\n          <ir-booking-details\n            slot=\"sidebar-body\"\n            hasPrint\n            hasReceipt\n            hasCloseButton\n            onCloseSidebar={this.handleSidebarClose}\n            is_from_front_desk\n            propertyid={this.property_id}\n            hasRoomEdit\n            hasRoomDelete\n            bookingNumber={this.sideBarEvent.payload.bookingNumber.toString()}\n            ticket={this.ticket}\n            language={this.language}\n            hasRoomAdd\n          ></ir-booking-details>\n        );\n      case 'payment':\n        return (\n          <ir-payment-folio\n            bookingNumber={this.sideBarEvent.payload?.bookingNumber?.toString()}\n            paymentEntries={this.paymentEntries}\n            slot=\"sidebar-body\"\n            payment={this.sideBarEvent.payload.payment}\n            mode={'new'}\n            onCloseModal={this.handleSidebarClose}\n          ></ir-payment-folio>\n        );\n      default:\n        return null;\n    }\n  }\n  @Listen('financialActionsOpenSidebar')\n  handleOpenSidebar(e: CustomEvent<SidebarOpenEvent>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.sideBarEvent = e.detail;\n  }\n  private async getFinancialAction(isExportToExcel: boolean = false) {\n    console.log(isExportToExcel);\n  }\n  private async initializeApp() {\n    this.isPageLoading = true;\n\n    try {\n      let propertyId = this.propertyid;\n      if (!propertyId && !this.p) {\n        throw new Error('Property ID or username is required');\n      }\n      if (!propertyId) {\n        const propertyData = await this.roomService.getExposedProperty({\n          id: 0,\n          aname: this.p,\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n        });\n        propertyId = propertyData.My_Result.id;\n      }\n\n      this.property_id = propertyId;\n\n      const requests: Promise<any>[] = [\n        this.bookingService.getSetupEntriesByTableNameMulti(['_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n        this.getFinancialAction(),\n        this.roomService.fetchLanguage(this.language),\n      ];\n      if (propertyId) {\n        requests.push(\n          this.roomService.getExposedProperty({\n            id: propertyId,\n            language: this.language,\n            is_backend: true,\n            include_units_hk_status: true,\n          }),\n        );\n      }\n\n      const [setupEntries] = await Promise.all(requests);\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n      this.paymentEntries = {\n        groups: pay_type_group,\n        methods: pay_method,\n        types: pay_type,\n      };\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2 d-flex flex-column\" style={{ gap: '1rem' }}>\n          <div class=\"d-flex align-items-center justify-content-between\">\n            <h3 class=\"mb-1 mb-md-0\">Payment Actions</h3>\n            <ir-button\n              size=\"sm\"\n              btn_color=\"outline\"\n              isLoading={this.isLoading === 'export'}\n              text={locales.entries?.Lcz_Export}\n              onClickHandler={async e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                await this.getFinancialAction(true);\n              }}\n              btnStyle={{ height: '100%' }}\n              iconPosition=\"right\"\n              icon_name=\"file\"\n              icon_style={{ '--icon-size': '14px' }}\n            ></ir-button>\n          </div>\n          {/* <ir-financial-summary\n          previousDateGroupedPayments={this.previousDateGroupedPayments}\n          groupedPayments={this.groupedPayment}\n          paymentEntries={this.paymentEntries}\n        ></ir-financial-summary> */}\n          <div class=\"financial-actions__meta\">\n            <ir-financial-filters isLoading={this.isLoading === 'filter'}></ir-financial-filters>\n            <ir-financial-table class={'financial-actions__table card  w-100'}></ir-financial-table>\n          </div>\n        </section>\n        <ir-sidebar\n          sidebarStyles={{\n            width: this.sideBarEvent?.type === 'booking' ? '80rem' : 'var(--sidebar-width,40rem)',\n            background: this.sideBarEvent?.type === 'booking' ? '#F2F3F8' : 'white',\n          }}\n          open={Boolean(this.sideBarEvent)}\n          showCloseButton={false}\n          onIrSidebarToggle={this.handleSidebarClose}\n        >\n          {this.renderSidebarBody()}\n        </ir-sidebar>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}