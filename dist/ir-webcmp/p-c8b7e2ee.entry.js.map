{"version":3,"names":["irOptionDetailsCss","IrOptionDetailsStyle0","sheetCss","IrOptionDetailsStyle1","IrOptionDetails","constructor","hostRef","this","selectedLanguage","invalid","paymentOptionService","PaymentOptionService","componentWillLoad","payment_option_store","selectedOption","code","languages","result","GetExposedLanguages","localizables","_a","id","toString","length","push","createBankTransferInfoObject","localizationIdx","findIndex","l","language","Object","assign","description","saveOption","e","preventDefault","stopPropagation","stopImmediatePropagation","property_id","propertyId","is_active","mode","englishDescription","_b","find","toLowerCase","trim","isEditorEmpty","is_payment_gateway","display_order","hasInvalidData","data","some","d","value","HandlePaymentMethod","toast","emit","type","title","locales","entries","Lcz_Saved","position","closeModal","htmlString","text","replace","handleSelectChange","detail","idx","handleTextAreaChange","oldLocalizables","handlePaymentGatewayInfoChange","prevData","render","h","Host","class","onSubmit","bind","onCloseSideBar","label","Lcz_Information","displayContext","selectedValue","LabelAvailable","showFirstOption","map","Lcz_YouMustFillEnglishField","maxLength","placeholder","style","error","_e","_d","_c","onTextChange","_f","key","labelWidth","onClick","btn_styles","icon","Lcz_Cancel","btn_color","btn_type","isLoading","isRequestPending","Lcz_Save"],"sources":["src/components/ir-payment-option/ir-option-details/ir-option-details.css?tag=ir-option-details&encapsulation=scoped","src/common/sheet.css?tag=ir-option-details&encapsulation=scoped","src/components/ir-payment-option/ir-option-details/ir-option-details.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}\r\n",":host {\r\n  height: 100%;\r\n}\r\n.sheet-container {\r\n  display: flex !important;\r\n  flex-direction: column !important;\r\n  background: white;\r\n  height: 100% !important;\r\n  gap: 1rem;\r\n}\r\n.sheet-footer {\r\n  position: sticky;\r\n  bottom: 0;\r\n  z-index: 20;\r\n  background: white;\r\n  border-top: 1px solid #e4e5ec;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 1rem;\r\n  gap: 0.5rem;\r\n}\r\n.sheet-header {\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 10;\r\n  background: white;\r\n}\r\n.sheet-body {\r\n  flex: 1 1 0%;\r\n}\r\n@media (min-width: 768px) {\r\n  .sheet-footer {\r\n    flex-direction: row;\r\n    align-items: center;\r\n  }\r\n}\r\n","import { ILanguages, PaymentOption } from '@/models/payment-options';\r\nimport { PaymentOptionService } from '@/services/payment_option.service';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport payment_option_store from '@/stores/payment-option.store';\r\nimport { Component, Event, EventEmitter, Host, Listen, Prop, State, h } from '@stencil/core';\r\nimport { IToast } from '@components/ui/ir-toast/toast';\r\nimport locales from '@/stores/locales.store';\r\n@Component({\r\n  tag: 'ir-option-details',\r\n  styleUrls: ['ir-option-details.css', '../../../common/sheet.css'],\r\n  scoped: true,\r\n})\r\nexport class IrOptionDetails {\r\n  @Prop() propertyId: string;\r\n\r\n  @State() localizationIdx: number;\r\n  @State() selectedLanguage: string = null;\r\n  @State() invalid: boolean = false;\r\n\r\n  @Event() closeModal: EventEmitter<PaymentOption | null>;\r\n  @Event() toast: EventEmitter<IToast>;\r\n\r\n  private paymentOptionService = new PaymentOptionService();\r\n\r\n  async componentWillLoad() {\r\n    if (payment_option_store.selectedOption.code !== '005') {\r\n      return;\r\n    }\r\n    if (!payment_option_store.languages) {\r\n      const result = await this.paymentOptionService.GetExposedLanguages();\r\n      payment_option_store.languages = result;\r\n    }\r\n    const localizables = payment_option_store.selectedOption.localizables ?? [];\r\n    this.selectedLanguage = payment_option_store.languages[0].id.toString();\r\n    if (localizables.length === 0) {\r\n      localizables.push(this.createBankTransferInfoObject(payment_option_store.languages[0]));\r\n    }\r\n    this.localizationIdx = payment_option_store.selectedOption.code === '005' ? localizables?.findIndex(l => l.language.id.toString() === this.selectedLanguage) : null;\r\n    payment_option_store.selectedOption = {\r\n      ...payment_option_store.selectedOption,\r\n      localizables: localizables,\r\n    };\r\n  }\r\n  private createBankTransferInfoObject(l: ILanguages): any {\r\n    return {\r\n      code: 'BANK_TRANSFER_INFO',\r\n      description: '',\r\n      id: null,\r\n      language: l,\r\n    };\r\n  }\r\n\r\n  async saveOption(e: Event) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    e.stopImmediatePropagation();\r\n\r\n    let selectedOption: PaymentOption = {\r\n      ...payment_option_store.selectedOption,\r\n      property_id: this.propertyId,\r\n      is_active: payment_option_store.mode === 'create' ? true : payment_option_store.selectedOption.is_active ?? false,\r\n    };\r\n\r\n    if (selectedOption?.code === '005') {\r\n      const englishDescription = selectedOption.localizables.find(l => l.language.code.toLowerCase() === 'en')?.description;\r\n      if (!englishDescription || englishDescription.trim() === '' || this.isEditorEmpty(englishDescription.trim())) {\r\n        this.selectedLanguage = payment_option_store.languages.find(l => l.code.toLowerCase() === 'en').id.toString();\r\n        this.localizationIdx = payment_option_store.selectedOption.localizables.findIndex(l => l.language.id.toString() === this.selectedLanguage);\r\n        this.invalid = true;\r\n        return;\r\n      }\r\n    }\r\n    if (selectedOption.is_payment_gateway) {\r\n      selectedOption.display_order = 0;\r\n      const hasInvalidData = selectedOption.data.some(d => !d.value || d.value === '');\r\n      if (hasInvalidData) {\r\n        this.invalid = true;\r\n        return;\r\n      }\r\n    }\r\n    await this.paymentOptionService.HandlePaymentMethod(selectedOption);\r\n    this.toast.emit({\r\n      type: 'success',\r\n      description: '',\r\n      title: locales.entries.Lcz_Saved,\r\n      position: 'top-right',\r\n    });\r\n    this.closeModal.emit(selectedOption);\r\n  }\r\n  private isEditorEmpty(htmlString: string): boolean {\r\n    const text = htmlString\r\n      .replace(/<\\/?[^>]+(>|$)/g, '')\r\n      .replace(/&nbsp;/g, '')\r\n      .trim();\r\n    return text.length === 0;\r\n  }\r\n\r\n  @Listen('selectChange')\r\n  handleSelectChange(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    if (payment_option_store.selectedOption.code !== '005') {\r\n      return;\r\n    }\r\n    this.selectedLanguage = e.detail;\r\n    let idx = payment_option_store.selectedOption.localizables.findIndex(l => l.language.id.toString() === this.selectedLanguage);\r\n    const localizables = payment_option_store.selectedOption.localizables ?? [];\r\n    if (idx === -1) {\r\n      localizables.push(this.createBankTransferInfoObject(payment_option_store.languages.find(l => l.id.toString() === this.selectedLanguage)));\r\n      payment_option_store.selectedOption = {\r\n        ...payment_option_store.selectedOption,\r\n        localizables: localizables,\r\n      };\r\n      idx = localizables.length - 1;\r\n    }\r\n    this.localizationIdx = idx;\r\n  }\r\n\r\n  private handleTextAreaChange(e: CustomEvent) {\r\n    const value = e.detail;\r\n    if (value.trim() !== '' && this.invalid) {\r\n      this.invalid = false;\r\n    }\r\n    const oldLocalizables = [...payment_option_store.selectedOption.localizables];\r\n    oldLocalizables[this.localizationIdx] = {\r\n      ...oldLocalizables[this.localizationIdx],\r\n      description: value,\r\n    };\r\n    payment_option_store.selectedOption = {\r\n      ...payment_option_store.selectedOption,\r\n      localizables: oldLocalizables,\r\n    };\r\n  }\r\n  private handlePaymentGatewayInfoChange(e: CustomEvent, idx: number): void {\r\n    const value = e.detail;\r\n    const prevData = [...payment_option_store.selectedOption.data];\r\n    prevData[idx] = { ...prevData[idx], value };\r\n    payment_option_store.selectedOption = {\r\n      ...payment_option_store.selectedOption,\r\n      data: prevData,\r\n    };\r\n  }\r\n  render() {\r\n    if (!payment_option_store.selectedOption) {\r\n      return null;\r\n    }\r\n    return (\r\n      <Host>\r\n        <form class={'sheet-container'} onSubmit={this.saveOption.bind(this)}>\r\n          <ir-title\r\n            class=\"px-1 sheet-header\"\r\n            onCloseSideBar={() => this.closeModal.emit(null)}\r\n            label={locales?.entries.Lcz_Information?.replace('%1', payment_option_store.selectedOption?.description)}\r\n            displayContext=\"sidebar\"\r\n          ></ir-title>\r\n\r\n          <div class=\"sheet-body px-1\">\r\n            {payment_option_store.selectedOption.code === '005' ? (\r\n              <div>\r\n                <div class=\"mb-1\">\r\n                  <ir-select\r\n                    selectedValue={this.selectedLanguage}\r\n                    LabelAvailable={false}\r\n                    showFirstOption={false}\r\n                    data={payment_option_store.languages.map(l => ({\r\n                      text: l.description,\r\n                      value: l.id.toString(),\r\n                    }))}\r\n                  ></ir-select>\r\n                </div>\r\n                <div>\r\n                  {this.invalid && <p class=\"text-danger p-0 m-0\">{locales.entries.Lcz_YouMustFillEnglishField}</p>}\r\n                  {/* <ir-textarea\r\n                  placeholder=\"\"\r\n                  aria-invalid={this.invalid ? 'true' : 'false'}\r\n                  textareaClassname=\"money-transfer-form\"\r\n                  label=\"\"\r\n                  styles={{ height: '200px', maxHeight: '250px' }}\r\n                  onTextChange={this.handleTextAreaChange.bind(this)}\r\n                  value={this.localizationIdx !== null ? payment_option_store.selectedOption?.localizables[this.localizationIdx]?.description ?? '' : ''}\r\n                ></ir-textarea> */}\r\n                  <ir-text-editor\r\n                    // plugins={[Link]}\r\n                    // pluginsMode=\"add\"\r\n                    // toolbarItemsMode=\"add\"\r\n                    // toolbarItems={['|', 'link']}\r\n                    maxLength={450}\r\n                    placeholder=\"\"\r\n                    style={{ '--ir-editor-height': '250px' }}\r\n                    error={this.invalid}\r\n                    value={this.localizationIdx !== null ? payment_option_store.selectedOption?.localizables[this.localizationIdx]?.description ?? '' : ''}\r\n                    onTextChange={this.handleTextAreaChange.bind(this)}\r\n                  ></ir-text-editor>\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              <div>\r\n                {payment_option_store.selectedOption.data?.map((d, idx) => {\r\n                  return (\r\n                    <fieldset key={d.key}>\r\n                      <ir-input-text\r\n                        value={d.value}\r\n                        onTextChange={e => this.handlePaymentGatewayInfoChange(e, idx)}\r\n                        id={`input_${d.key}`}\r\n                        label={d.key.replace(/_/g, ' ')}\r\n                        placeholder=\"\"\r\n                        labelWidth={4}\r\n                        aria-invalid={this.invalid && (d.value === null || (d.value ?? '')?.trim() === '') ? 'true' : 'false'}\r\n                      ></ir-input-text>\r\n                    </fieldset>\r\n                  );\r\n                })}\r\n              </div>\r\n            )}\r\n          </div>\r\n          <div class={'sheet-footer'}>\r\n            <ir-button\r\n              onClick={() => this.closeModal.emit(null)}\r\n              btn_styles=\"justify-content-center\"\r\n              class={`flex-fill`}\r\n              icon=\"\"\r\n              text={locales.entries.Lcz_Cancel}\r\n              btn_color=\"secondary\"\r\n              btn_type=\"button\"\r\n            ></ir-button>\r\n\r\n            <ir-button\r\n              btn_type=\"submit\"\r\n              btn_styles=\"justify-content-center align-items-center\"\r\n              class={'flex-fill'}\r\n              icon=\"\"\r\n              isLoading={isRequestPending('/Handle_Payment_Method')}\r\n              text={locales.entries.Lcz_Save}\r\n              btn_color=\"primary\"\r\n            ></ir-button>\r\n          </div>\r\n        </form>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]}