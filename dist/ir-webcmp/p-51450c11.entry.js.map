{"version":3,"names":["hostCss","IrArrivalsStyle0","irArrivalsCss","IrArrivalsStyle1","IrArrivals","ticket","propertyid","language","p","bookingNumber","booking","paymentEntries","isPageLoading","payment","tokenService","Token","roomService","RoomService","bookingService","BookingService","paymentFolioRef","componentWillLoad","this","setToken","init","handleTicketChange","newValue","oldValue","handleBookingPayment","e","stopImmediatePropagation","stopPropagation","booking_nbr","detail","arrivalsStore","bookings","find","b","paymentType","types","CODE_NAME","payment_type","code","description","CODE_VALUE_EN","operation","NOTES","openFolio","handleOpen","_","__","setupEntries","Promise","all","getExposedProperty","id","aname","fetchLanguage","getSetupEntriesByTableNameMulti","pay_type","pay_type_group","pay_method","groupEntryTablesResult","groups","methods","error","render","h","Host","style","display","class","onDrawerHide","withoutHeader","open","hasPrint","hasReceipt","hasCloseButton","onCloseSidebar","is_from_front_desk","hasRoomEdit","hasRoomDelete","toString","hasRoomAdd","height","mode","ref","el","onCloseModal"],"sources":["src/assets/webawesome/component/host.css?tag=ir-arrivals&encapsulation=scoped","src/components/ir-arrivals/ir-arrivals.css?tag=ir-arrivals&encapsulation=scoped","src/components/ir-arrivals/ir-arrivals.tsx"],"sourcesContent":[":host {\n  box-sizing: border-box !important;\n}\n\n:host *,\n:host *::before,\n:host *::after {\n  box-sizing: inherit !important;\n  padding: 0;\n  margin: 0;\n}\n\n[hidden] {\n  display: none !important;\n}\n",":host {\n  display: flex;\n  flex-direction: column;\n  gap: var(--wa-space-l, 1.5rem);\n  min-height: 100vh;\n}\n.page-title {\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-xl);\n}\n","import { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { RoomService } from '@/services/room.service';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { arrivalsStore } from '@/stores/arrivals.store';\n\n@Component({\n  tag: 'ir-arrivals',\n  styleUrls: ['../../assets/webawesome/component/host.css', 'ir-arrivals.css'],\n  scoped: true,\n})\nexport class IrArrivals {\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() language: string = 'en';\n  @Prop() p: string;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = arrivalsStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n\n  private async init() {\n    try {\n      this.isPageLoading = true;\n      const [_, __, setupEntries] = await Promise.all([\n        this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n      ]);\n\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast style={{ display: 'none' }}></ir-toast>\n        <ir-interceptor style={{ display: 'none' }}></ir-interceptor>\n        <h3 class=\"page-title\">Arrivals</h3>\n        <ir-arrivals-filters></ir-arrivals-filters>\n        <ir-arrivals-table></ir-arrivals-table>\n        <ir-drawer\n          onDrawerHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.bookingNumber = null;\n          }}\n          withoutHeader\n          open={!!this.bookingNumber}\n          style={{\n            '--ir-drawer-width': '80rem',\n            '--ir-drawer-background-color': '#F2F3F8',\n            '--ir-drawer-padding-left': '0',\n            '--ir-drawer-padding-right': '0',\n            '--ir-drawer-padding-top': '0',\n            '--ir-drawer-padding-bottom': '0',\n          }}\n        >\n          {this.bookingNumber && (\n            <ir-booking-details\n              hasPrint\n              hasReceipt\n              hasCloseButton\n              onCloseSidebar={() => (this.bookingNumber = null)}\n              is_from_front_desk\n              propertyid={this.propertyid as any}\n              hasRoomEdit\n              hasRoomDelete\n              bookingNumber={this.bookingNumber.toString()}\n              ticket={this.ticket}\n              language={this.language}\n              hasRoomAdd\n            ></ir-booking-details>\n          )}\n        </ir-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}