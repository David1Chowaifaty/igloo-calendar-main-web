import{r as e,h as t,H as i,c as s,F as a,g as o}from"./p-53d64953.js";import{b as n,m as r,B as l,c,a as d,r as h,d as p,g as f,e as b}from"./p-086b1a65.js";import{l as u}from"./p-71768c2d.js";import{i as m,c as g}from"./p-c226aa13.js";import{f as y,e as v,O as k,C as _,h as x,P as w,E as D,u as O,Q as C,R as Y,l as M}from"./p-6b5d6ebe.js";import{v as I}from"./p-4ed69de7.js";import{h as B}from"./p-6c4ba7c0.js";import{i as T}from"./p-2e94af0d.js";import{z as E,Z as S,a as j}from"./p-b859bcd5.js";import{a as A}from"./p-bf44a732.js";import{R as N}from"./p-fe80aa7c.js";import{P as L}from"./p-9592e7ee.js";import{T as R}from"./p-a93581f3.js";import{c as $}from"./p-834ed596.js";import{a as P,_ as z,b as G}from"./p-b2679b77.js";import{P as K}from"./p-64aa23d3.js";import{M as U}from"./p-518eace5.js";import"./p-a973aec7.js";class H{formatVariationBasedOnInfants(e){const t=this.getVariationBasedOnInfants(e);return this.formatVariation(t,e.infants)}calculateVariationAmount(e){var t;return((t=this.getVariationBasedOnInfants(e))===null||t===void 0?void 0:t.discounted_amount)||0}getVariationBasedOnInfants({variations:e,baseVariation:t,infants:i}){const{adult_nbr:s,child_nbr:a}=t;return e.find((e=>e.adult_nbr===s&&e.child_nbr===Math.max(0,a-Math.max(0,i))))||t}formatVariation({child_nbr:e,adult_nbr:t},i){var s,a,o,n;const r=Number(t)||0;const l=Math.max(Number(i)||0,0);const c=r>1?u.entries.Lcz_Adults.toLowerCase():u.entries.Lcz_Adult.toLowerCase();const d=e>1?u.entries.Lcz_Children.toLowerCase():u.entries.Lcz_Child.toLowerCase();const h=l>1?(a=(s=u.entries["Lcz_Infants"])!==null&&s!==void 0?s:"infants")===null||a===void 0?void 0:a.toLowerCase():(n=(o=u===null||u===void 0?void 0:u.entries["Lcz_Infant"])!==null&&o!==void 0?o:"infant")===null||n===void 0?void 0:n.toLowerCase();const p=[`${r} ${c}`,e?`${e} ${d}`:"",l?`${l} ${h}`:""];return p.filter(Boolean).join("&nbsp&nbsp&nbsp&nbsp")}}const F=".sc-igl-application-info-h{display:block}.rate_amount.sc-igl-application-info{display:none;padding:0;margin:0}.booking-header.sc-igl-application-info{display:flex;align-items:center;justify-content:space-between;margin-bottom:0.5rem;gap:0.5rem}.non-ref-span.sc-igl-application-info{font-size:12px;color:var(--green)}.booking-roomtype-title.sc-igl-application-info{font-size:1.25rem;margin-right:0.5rem;margin:0;padding:0}.booking-details-container.sc-igl-application-info{display:flex;align-items:center;justify-content:space-between;padding:0;margin:0}.booking-rateplan.sc-igl-application-info{display:flex;align-items:center;gap:0.5rem;margin:0;padding:0}.booking-rateplan-name.sc-igl-application-info{font-weight:bold;margin:0;padding:0}.booking-tooltip.sc-igl-application-info{margin-right:0.5rem;margin:0;padding:0}.booking-variation.sc-igl-application-info{margin:0;padding:0}.booking-price.sc-igl-application-info{margin:0;padding:0}.booking-footer.sc-igl-application-info{display:flex;align-items:center;justify-content:space-between;padding:0;margin-bottom:0.5rem}.booking-details-container.sc-igl-application-info{display:none}@media (min-width: 768px){.booking-header.sc-igl-application-info{justify-content:flex-start}.booking-footer.sc-igl-application-info,.booking-price.sc-igl-application-info{display:none}.booking-details-container.sc-igl-application-info,.rate_amount.sc-igl-application-info{display:inline-flex;gap:0.5rem}}@media only screen and (min-width: 908px){.aplicationInfoContainer.sc-igl-application-info{max-width:100%}.guest-info-container.sc-igl-application-info,.bed-preference-container.sc-igl-application-info,.unit-select-container.sc-igl-application-info{max-width:250px}}";const V=F;const W=class{constructor(t){e(this,t);this.bedPreferenceType=[];this.bookingType="PLUS_BOOKING";this.totalNights=1;this.isButtonPressed=false;this.variationService=new H}componentWillLoad(){var e,t;if(m(this.rateplanSelection.roomtype.id)){const i=this.filterRooms();if(i.length>0)this.updateGuest({unit:(t=(e=i[0])===null||e===void 0?void 0:e.id)===null||t===void 0?void 0:t.toString()})}}updateGuest(e){const t=this.rateplanSelection.roomtype.id;const i=this.rateplanSelection.ratePlan.id;let s=[...this.rateplanSelection.guest];s[this.roomIndex]=Object.assign(Object.assign({},s[this.roomIndex]),e);n.ratePlanSelections=Object.assign(Object.assign({},n.ratePlanSelections),{[t]:Object.assign(Object.assign({},n.ratePlanSelections[t]),{[i]:Object.assign(Object.assign({},this.rateplanSelection),{guest:[...s]})})})}handleButtonClicked(e){switch(e.detail.key){case"book":case"bookAndCheckIn":case"save":this.isButtonPressed=true;break}}getTooltipMessages(){var e,t,i,s,a,o,n;const{ratePlan:r,selected_variation:l}=this.rateplanSelection;let c=l;if((e=this.guestInfo)===null||e===void 0?void 0:e.infant_nbr){c=this.variationService.getVariationBasedOnInfants({variations:r.variations,baseVariation:l,infants:(t=this.guestInfo)===null||t===void 0?void 0:t.infant_nbr})}if(!c)return;const d=(i=r.variations)===null||i===void 0?void 0:i.find((e=>e.adult_nbr===c.adult_nbr&&e.child_nbr===c.child_nbr));if(!d)return;const h=(a=(s=d.applicable_policies)===null||s===void 0?void 0:s.find((e=>e.type==="cancelation")))===null||a===void 0?void 0:a.combined_statement;const p=(n=(o=d.applicable_policies)===null||o===void 0?void 0:o.find((e=>e.type==="guarantee")))===null||n===void 0?void 0:n.combined_statement;let f="";if(h){f+=`<b><u>Cancellation:</u></b> ${h}<br/>`}if(p){f+=`<b><u>Guarantee:</u></b> ${p}`}return f||undefined}getAmount(){var e,t;if(this.rateplanSelection.is_amount_modified){return this.rateplanSelection.view_mode==="001"?this.rateplanSelection.rp_amount:this.rateplanSelection.rp_amount*this.totalNights}let i=this.rateplanSelection.selected_variation;if((e=this.guestInfo)===null||e===void 0?void 0:e.infant_nbr){i=this.variationService.getVariationBasedOnInfants({variations:this.rateplanSelection.ratePlan.variations,baseVariation:this.rateplanSelection.selected_variation,infants:(t=this.guestInfo)===null||t===void 0?void 0:t.infant_nbr})}return i.discounted_gross_amount}filterRooms(){var e,t,i,s;const a=[];if(!g.is_frontdesk_enabled){return a}(t=(e=this.rateplanSelection.ratePlan)===null||e===void 0?void 0:e.assignable_units)===null||t===void 0?void 0:t.forEach((e=>{if(e.Is_Fully_Available){a.push({name:e.name,id:e.pr_id})}}));const o=this.rateplanSelection.guest.filter(((e,t)=>t!==this.roomIndex)).map((e=>e.unit));const n=a.filter((e=>!o.includes(e.id.toString())));return this.bookingType==="EDIT_BOOKING"?[...n,this.rateplanSelection.roomtype.id===((i=this.baseData)===null||i===void 0?void 0:i.roomtypeId)?(s=this.baseData)===null||s===void 0?void 0:s.unit:null].filter((e=>!!e)).sort(((e,t)=>e.name.localeCompare(t.name))):n}render(){var e,s,a,o,l,c,d,h,p,f,b,v,k;const _=this.filterRooms();const x=this.variationService.formatVariationBasedOnInfants({baseVariation:this.rateplanSelection.selected_variation,infants:this.guestInfo.infant_nbr,variations:this.rateplanSelection.ratePlan.variations});return t(i,{key:"33b26b1529ea3cbf4fc6b65191e2742f11212415",class:"my-2","data-testid":`room_info_${this.rateplanSelection.ratePlan.id}`},t("div",{key:"4cc64afbc858e25a54c06eec95925a24b9d19784",class:"booking-header"},(this.bookingType==="PLUS_BOOKING"||this.bookingType==="ADD_ROOM"||this.bookingType==="EDIT_BOOKING")&&t("span",{key:"bdac2d519ce67c3a9d8e1ff97870ca13f9a2cf9b",class:"booking-roomtype-title"},this.rateplanSelection.roomtype.name),t("div",{key:"5ff6eab4c89c27387c5f357fdb93b5640c0a1c49",class:"booking-details-container"},t("div",{key:"6e8993c746dc57258313c0a75697d09fdc9dea67",class:"booking-rateplan"},t("p",{key:"f4d87dc43a8bc62b432b20036e245775248c9ba9",class:"booking-rateplan-name"},this.rateplanSelection.ratePlan.short_name," ",this.rateplanSelection.ratePlan.is_non_refundable&&t("span",{key:"35512b9b2840d3aeef5823bf0d6b4c7fadc40915",class:"non-ref-span"},"Non Refundable")),t("ir-tooltip",{key:"58299f89bbd8dce463c74623c0c7976289da5eb2",class:"booking-tooltip",message:this.getTooltipMessages()})),t("p",{key:"accacb41deeca089b14e7db1df62e35324d085b4",class:"booking-variation",innerHTML:x})),t("p",{key:"bf75513468216f605f113596e4ffc7de2caeff29",class:"booking-price"},y((e=this.currency)===null||e===void 0?void 0:e.symbol,this.getAmount()),"/",u.entries.Lcz_Stay)),t("div",{key:"e8b7df7b851a366db42ae2fdd8cea056fcc233e9",class:"booking-footer"},t("div",{key:"eaee51622e555bebdc44530e8272d102c357d10f",class:"booking-rateplan"},t("p",{key:"f077a706fbbb42201ffe2ec2ce46785b04ac5f38",class:"booking-rateplan-name"},this.rateplanSelection.ratePlan.short_name),t("ir-tooltip",{key:"be5b565211e048a8fecddc20b9a79cd49502dd32",class:"booking-tooltip",message:this.getTooltipMessages()})),t("p",{key:"70f3d46fd091be4bd84a9c008d94963e7649ce2a",class:"booking-variation",innerHTML:x})),t("div",{key:"bd4c68ba80cfb35d730248605245db1b75b94475",class:"d-flex flex-column flex-md-row  p-0 align-items-md-center aplicationInfoContainer"},t("div",{key:"58881c6591a4d303f54d9a1a9ebec37c31c31a63",class:"mr-md-1 mb-1 mb-md-0 flex-fill guest-info-container"},t("input",{key:"c4ce91476cf6ac325d5a6e0060d8eb5d13d24495",id:I(),type:"text","data-testid":"guest_first_name",class:`form-control ${this.isButtonPressed&&((s=this.guestInfo)===null||s===void 0?void 0:s.first_name)===""&&"border-danger"}`,placeholder:(a=u.entries["Lcz_GuestFirstname"])!==null&&a!==void 0?a:"Guest first name",name:"guestFirstName",onInput:e=>{const t=e.target.value;this.updateGuest({first_name:t});if(n.event_type.type==="EDIT_BOOKING"){r("guest",Object.assign(Object.assign({},n.guest),{name:t}))}},required:true,value:(o=this.guestInfo)===null||o===void 0?void 0:o.first_name})),t("div",{key:"a361a25f760d1534ecf6b1a489d5e5f2ef3246e0",class:"mr-md-1 flex-fill guest-info-container"},t("input",{key:"5ae85c2ecbcb25c8ec373c63f5f439c66078fae3",id:I(),type:"text",class:`form-control ${this.isButtonPressed&&((l=this.guestInfo)===null||l===void 0?void 0:l.last_name)===""&&"border-danger"}`,placeholder:(c=u.entries["Lcz_GuestLastname"])!==null&&c!==void 0?c:"Guest last name",name:"guestLastName","data-testid":"guest_last_name",onInput:e=>{const t=e.target.value;this.updateGuest({last_name:t});if(n.event_type.type==="EDIT_BOOKING"){r("guest",Object.assign(Object.assign({},n.guest),{name:t}))}},required:true,value:(d=this.guestInfo)===null||d===void 0?void 0:d.last_name})),g.is_frontdesk_enabled&&!m(this.rateplanSelection.roomtype.id)&&(this.bookingType==="PLUS_BOOKING"||this.bookingType==="ADD_ROOM"||this.bookingType==="EDIT_BOOKING")&&t("div",{key:"8de697036d0e99433b91d7c4ff50bb1846184d39",class:"mt-1 mt-md-0 d-flex align-items-center flex-fill"},t("div",{key:"94a3f4f8ff274bda8dc88e3057b253ca264fdda0",class:"mr-md-1 p-0 flex-fill preference-select-container"},t("select",{key:"4b75df8caeef77b3c7edce481bda3dba96f18b77","data-testid":"unit",class:"form-control input-sm pr-0",id:I(),onChange:e=>this.updateGuest({unit:e.target.value})},t("option",{key:"90c54dd4f05ccf4a1c2ebb737f1c2dfef7a85baf",value:"",selected:((h=this.guestInfo)===null||h===void 0?void 0:h.unit)===""},u.entries.Lcz_Assignunits),_===null||_===void 0?void 0:_.map((e=>{var i;return t("option",{value:e.id,selected:((i=this.guestInfo)===null||i===void 0?void 0:i.unit)===e.id.toString()},e.name)}))))),this.rateplanSelection.roomtype.is_bed_configuration_enabled&&t("div",{key:"7178088a7621dba00d4512b72f1247465430692b",class:"mt-1 mt-md-0 mr-md-1 flex-fill"},t("select",{key:"87f5a3ccf6be9ab44b825d932323565633f7fbea","data-testid":"bed_configuration",class:`form-control input-sm ${this.isButtonPressed&&((p=this.guestInfo)===null||p===void 0?void 0:p.bed_preference)===""&&"border-danger"}`,id:I(),onChange:e=>this.updateGuest({bed_preference:e.target.value})},t("option",{key:"64904e38c80d04cf53f993df1962d566e3088866",value:"",selected:((f=this.guestInfo)===null||f===void 0?void 0:f.bed_preference)===""},u.entries.Lcz_BedConfiguration),this.bedPreferenceType.map((e=>{var i;return t("option",{value:e.CODE_NAME,selected:((i=this.guestInfo)===null||i===void 0?void 0:i.bed_preference)===e.CODE_NAME},e.CODE_VALUE_EN)})))),t("p",{key:"73bab90508dda8ebc46d18c9f342023e6e029ee0",class:"rate_amount"},y((b=this.currency)===null||b===void 0?void 0:b.symbol,this.getAmount()),"/",u.entries.Lcz_Stay)),this.rateplanSelection.selected_variation.child_nbr>0&&t("div",{key:"5bea987bc5e426ae68d57c69b3d7f0546c9ad3a6",style:{gap:"0.5rem",marginTop:"0.5rem"},class:"d-flex  flex-row  p-0 align-items-center aplicationInfoContainer"},t("p",{key:"5c5adc22f855c48b072ab81765d1cf2a9bffdb05",class:"m-0 p-0 text-danger"},"Any of the children below 3 years?"),t("div",{key:"7462ab3f64516caeb515fe1f83c5b2d2b0368be5",class:"mr-1 flex-fill"},t("select",{key:"9c2c9332867c531faee525e38a6496d8319c0482",class:`form-control input-sm ${this.isButtonPressed&&((v=this.guestInfo)===null||v===void 0?void 0:v.bed_preference)===""&&"border-danger"}`,id:I(),style:{width:"max-content"},onChange:e=>this.updateGuest({infant_nbr:Number(e.target.value)})},t("option",{key:"a5881f1684da3f79011616bf26d0f46136dc8739",value:"",selected:Number((k=this.guestInfo)===null||k===void 0?void 0:k.infant_nbr)===0},u.entries["No"]||"No"),Array.from({length:this.rateplanSelection.selected_variation.child_nbr},((e,t)=>t+1)).map((e=>{var i;return t("option",{value:e,selected:((i=this.guestInfo)===null||i===void 0?void 0:i.infant_nbr)===e},e)}))))))}};W.style=V;var q=undefined&&undefined.__rest||function(e,t){var i={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0)i[s]=e[s];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++){if(t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a]))i[s[a]]=e[s[a]]}return i};class X{setBookingInfoFromAutoComplete(e,t){var i,s,a;e.bookedByInfoData={id:t.guest.id,email:t.guest.email,firstName:t.guest.first_name,lastName:t.guest.last_name,countryId:t.guest.country_id,isdCode:(s=(i=t.guest)===null||i===void 0?void 0:i.country_phone_prefix)!==null&&s!==void 0?s:(a=t.guest)===null||a===void 0?void 0:a.country_id.toString(),contactNumber:t.guest.mobile,selectedArrivalTime:t.arrival,emailGuest:t.guest.subscribe_to_news_letter,message:t.remark,cardNumber:"",cardHolderName:"",expiryMonth:"",expiryYear:"",bookingNumber:t.booking_nbr,rooms:t.rooms,from_date:t.from_date,to_date:t.to_date}}resetRoomsInfoAndMessage(e){e.defaultData.roomsInfo=[];e.message=""}onDataRoomUpdate(e,t,i,s,a){let o=t;const{data:n,key:r,changedKey:l}=e.detail;const c=`c_${n.roomCategoryId}`;const d=`p_${n.ratePlanId}`;if(this.shouldClearData(r)){o=new Map}this.initializeRoomCategoryIfNeeded(c,o);if(s){if(l==="rate"){if(o.has(c)&&o.get(c).has(d)){this.applyBookingEditToSelectedRoom(c,d,n,o,a,i)}}else{if(l!=="rateType"){if(l==="adult_child_offering"){if(o.has(c)&&t.get(c).has(d)){this.applyBookingEditToSelectedRoom(c,d,n,o,a,i)}}else{this.applyBookingEditToSelectedRoom(c,d,n,o,a,i)}}}}else{this.setSelectedRoomData(c,d,n,o)}this.cleanupEmptyData(c,o);return o}shouldClearData(e){return e==="clearData"||e==="EDIT_BOOKING"}initializeRoomCategoryIfNeeded(e,t){if(!t.has(e)){t.set(e,new Map)}}setSelectedRoomData(e,t,i,s){let a=s.get(e);if(i.totalRooms===0||i.inventory===0){a.delete(t)}else{s.set(e,a.set(t,Object.assign(Object.assign({},i),{selectedUnits:Array(i.totalRooms).fill(-1)})))}}cleanupEmptyData(e,t){if(t.has(e)){let i=t.get(e);if(i.size===0){t.delete(e)}}}applyBookingEditToSelectedRoom(e,t,i,s,a,o){s.clear();let n={};if(o){n=Object.assign(Object.assign({},i),{guestName:a||"",roomId:""})}else{n=Object.assign({},i)}s.set(e,(new Map).set(t,n))}calculateAmount({is_amount_modified:e,selected_variation:t,view_mode:i,rp_amount:s}){const a=t.nights.length;if(e){return i==="002"?s:s/a}}generateDailyRates(e,t){let i=e.selected_variation;const s=e.is_amount_modified?this.calculateAmount(e):null;if(e.guest[t].infant_nbr>0&&!e.is_amount_modified){if(!this.variationService){this.variationService=new H}i=this.variationService.getVariationBasedOnInfants({variations:e.ratePlan.variations,baseVariation:e.selected_variation,infants:e.guest[t].infant_nbr})}return i.nights.map((e=>({date:e.night,amount:s!==null&&s!==void 0?s:e.discounted_amount,cost:null})))}getBookedRooms({check_in:e,check_out:t,notes:i,identifier:s,override_unit:a,unit:o,auto_check_in:r}){var l,c;const d=[];for(const h in n.ratePlanSelections){const p=n.ratePlanSelections[h];for(const n in p){const h=p[n];if(h.reserved>0){for(let n=0;n<h.reserved;n++){const{first_name:p,last_name:f}=h.guest[n];d.push({identifier:s,roomtype:h.roomtype,rateplan:h.ratePlan,prepayment_amount_gross:0,unit:a?{id:o}:h.guest[n].unit?{id:h.guest[n].unit}:null,occupancy:{adult_nbr:h.selected_variation.adult_nbr,children_nbr:Number((l=h.selected_variation.child_nbr)!==null&&l!==void 0?l:0)-Math.max(Number((c=h.guest[n].infant_nbr)!==null&&c!==void 0?c:0),0),infant_nbr:h.guest[n].infant_nbr},bed_preference:h.guest[n].bed_preference,from_date:B(e).format("YYYY-MM-DD"),to_date:B(t).format("YYYY-MM-DD"),notes:i,check_in:r,days:this.generateDailyRates(h,n),guest:{email:null,first_name:p,last_name:f,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null,cci:null}})}}}}return d}async prepareBookUserServiceParams({context:e,sourceOption:t,check_in:i}){var s,a,o;try{if(!e||!e.dateRangeData){throw new Error("Invalid context: Missing date range data.")}const r=new Date(e.dateRangeData.fromDate);const l=new Date(e.dateRangeData.toDate);const c=(t=null,i=false)=>this.getBookedRooms({check_in:r,check_out:l,identifier:t,notes:"",override_unit:e.isEventType("BAR_BOOKING")?true:false,unit:e.isEventType("BAR_BOOKING")?e.bookingData.PR_ID:null,auto_check_in:i});const d=(e,t)=>{var{pickup_info:i,extra_services:s,is_direct:a,is_in_loyalty_mode:o,promo_key:n,extras:r}=e,l=q(e,["pickup_info","extra_services","is_direct","is_in_loyalty_mode","promo_key","extras"]);return{assign_units:true,is_pms:true,is_direct:a,is_backend:true,is_in_loyalty_mode:o,promo_key:n,extras:r,booking:Object.assign(Object.assign({},l),{rooms:t}),extra_services:s,pickup_info:i}};let h=null;console.log({event_type:e.defaultData.event_type,defaultData:e.defaultData});switch(e.defaultData.event_type){case"EDIT_BOOKING":{const{booking:t,currentRoomType:i}=e.defaultData;const a=t.rooms.filter((e=>e.identifier!==i.identifier));console.log("currentRoomType",i);const o=c(i.identifier,((s=i.in_out)===null||s===void 0?void 0:s.code)==="001");h=d(t,[...a,...o]);break}case"ADD_ROOM":case"SPLIT_BOOKING":{const{booking:t}=e.defaultData;if(!t){throw new Error("Missing booking")}const i=c();const s=t.rooms;h=d(t,[...s,...i]);break}default:{const s=c(null,i);const{bookedByInfoData:d}=e;const p=t.type==="TRAVEL_AGENCY";h={assign_units:true,is_pms:true,is_direct:true,is_backend:true,is_in_loyalty_mode:false,promo_key:null,extras:[...v.filter((e=>e.key!=="payment_code")),{key:"payment_code",value:(a=n.selectedPaymentMethod)===null||a===void 0?void 0:a.code}],agent:p?{id:t.tag}:null,booking:{from_date:B(r).format("YYYY-MM-DD"),to_date:B(l).format("YYYY-MM-DD"),remark:d.message||null,booking_nbr:"",property:{id:e.propertyid},booked_on:{date:B().format("YYYY-MM-DD"),hour:(new Date).getHours(),minute:(new Date).getMinutes()},source:p?"":t,rooms:s,currency:e.currency,arrival:{code:d.selectedArrivalTime},guest:{email:d.email===""?null:d.email||null,first_name:d.firstName,last_name:d.lastName,country_id:d.countryId===""?null:d.countryId,city:null,mobile:d.contactNumber===null?"":d.contactNumber,country_phone_prefix:(o=d===null||d===void 0?void 0:d.isdCode)!==null&&o!==void 0?o:null,address:"",dob:null,subscribe_to_news_letter:d.emailGuest||false,cci:d.cardNumber?{nbr:d.cardNumber,holder_name:d.cardHolderName,expiry_month:d.expiryMonth,expiry_year:d.expiryYear}:null}},pickup_info:null};break}}return h}catch(e){console.error(e)}}getRoomCategoryByRoomId(e){var t;return(t=e.roomsInfo)===null||t===void 0?void 0:t.find((t=>t.id===e.RATE_TYPE))}setEditingRoomInfo(e,t){const i=this.getRoomCategoryByRoomId(e);const s=!i?"":`c_${i===null||i===void 0?void 0:i.id}`;const a=`p_${e.RATE_PLAN_ID}`;const o={adultCount:e.ADULTS_COUNT,rate:e.RATE,rateType:e.RATE_TYPE,ratePlanId:e.RATE_PLAN_ID,roomCategoryId:i?i.id:"",roomCategoryName:i?i.name:"",totalRooms:1,ratePlanName:e.RATE_PLAN,roomId:e.PR_ID,guestName:e.NAME,cancelation:e.cancelation,guarantee:e.guarantee,adult_child_offering:e.adult_child_offering};t.set(s,(new Map).set(a,o))}}const Q=".sc-igl-book-property-h{position:fixed;top:0;right:0;width:100vw;min-height:100vh;z-index:99;overflow:hidden}.card-title.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%}.card-header-container.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%;display:flex;align-items:center;box-sizing:border-box;padding:1rem 0;justify-content:space-between}.loading-container.sc-igl-book-property{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.card-header-container.sc-igl-book-property h3.sc-igl-book-property{padding:0;margin:0}.background-overlay.sc-igl-book-property{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.25)}.formContainer.sc-igl-book-property{height:calc(100% - 79px);overflow:auto}.gap-30.sc-igl-book-property{gap:30px}.block-date.sc-igl-book-property{width:100%}.sideWindow.sc-igl-book-property{position:absolute;inset:0;left:unset;background-color:#ffffff;width:100%;overflow:auto;animation:slideInFromRight 0.5s}.card.sc-igl-book-property{top:0;z-index:1000}.close.sc-igl-book-property{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.close-icon.sc-igl-book-property{position:absolute;top:18px;right:33px;outline:none}button.sc-igl-book-property:not(:disabled),[type='button'].sc-igl-book-property:not(:disabled){cursor:pointer}.sheet-footer.sc-igl-book-property{width:100%}@media only screen and (min-width: 1200px){.sideWindow.sc-igl-book-property{max-width:70%}}@media only screen and (min-width: 2000px){.sideWindow.sc-igl-book-property{max-width:40%}}@media only screen and (min-width: 768px) and (max-width: 1200px){.sideWindow.sc-igl-book-property{max-width:90%}}@media only screen and (min-width: 600px) and (max-width: 768px){.sideWindow.sc-igl-book-property{max-width:75%}}@media only screen and (min-width: 641px){.block-date.sc-igl-book-property{max-width:450px;padding-bottom:0 !important}}@keyframes slideInFromRight{from{transform:translateX(120%)}to{transform:translateX(0)}}@keyframes slideOutToRight{from{transform:translateX(0)}to{transform:translateX(120%)}}.sideWindow--exit.sc-igl-book-property{animation:slideOutToRight 0.5s forwards}";const Z=Q;const J=".sc-igl-book-property-h{height:100%}.sheet-container.sc-igl-book-property{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-book-property{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-book-property{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-book-property{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-book-property{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-book-property{flex-direction:row;align-items:center}}";const ee=J;const te=class{constructor(t){e(this,t);this.closeBookingWindow=s(this,"closeBookingWindow",7);this.blockedCreated=s(this,"blockedCreated",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.animateIrButton=s(this,"animateIrButton",7);this.animateIrSelect=s(this,"animateIrSelect",7);this.toast=s(this,"toast",7);this.showPaymentDetails=false;this.adultChildCount={adult:0,child:0};this.renderAgain=false;this.bookingHistory=[];this.initialRoomIds=null;this.showSplitBookingOption=false;this.sourceOptions=[];this.guestData=[];this.bookedByInfoData={};this.blockDatesData={};this.ratePricingMode=[];this.selectedUnits=new Map;this.bedPreferenceType=[];this.bookingService=new l;this.bookPropertyService=new X;this.updatedBooking=false;this.MAX_HISTORY_LENGTH=2}async componentWillLoad(){console.log("<==>roomtypes<==>",n===null||n===void 0?void 0:n.roomTypes);if(n.roomTypes){r("roomTypes",[]);r("ratePlanSelections",{})}this.handleKeyDown=this.handleKeyDown.bind(this);this.initializeDefaultDateRange();if(!this.bookingData.defaultDateRange){return}this.initializeDefaultData();this.wasBlockedUnit=this.defaultData.hasOwnProperty("block_exposed_unit_props");r("event_type",{type:this.defaultData.event_type});this.fetchSetupEntriesAndInitialize()}componentDidLoad(){document.addEventListener("keydown",this.handleKeyDown);k(true)}disconnectedCallback(){document.removeEventListener("keydown",this.handleKeyDown)}clearBooking(e){if(this.isEventType("SPLIT_BOOKING")){e.stopImmediatePropagation();e.stopPropagation();this.bookedByInfoData={};this.bookPropertyService.resetRoomsInfoAndMessage(this);this.renderPage()}}async handleSpiltBookingSelected(e){e.stopImmediatePropagation();e.stopPropagation();const{key:t,data:i}=e.detail;if(t==="select"||t==="blur"&&i!==""){const e=await this.bookingService.getExposedBooking(i.booking_nbr||i,this.language);this.defaultData=Object.assign(Object.assign({},this.defaultData),{booking:e});this.bookPropertyService.setBookingInfoFromAutoComplete(this,e);this.sourceOption=e.source;this.renderPage()}}handleAdultChildChange(e){if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){this.bookPropertyService.resetRoomsInfoAndMessage(this)}const{adult:t,child:i}=e.detail;this.adultChildCount=Object.assign({},e.detail);this.updateBookingHistory({adults:Number(t),children:Number(i)})}onDateRangeSelect(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;this.updateBookingHistory({dates:{checkIn:new Date(this.dateRangeData.fromDate),checkOut:new Date(new Date(t.data.toDate))}});console.log("date changed",t);if(t.key==="selectedDateRange"){this.dateRangeData=t.data;if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){this.defaultData.roomsInfo=[]}else if(this.adultChildCount.adult!==0){this.checkBookingAvailability()}}}handleSourceDropDown(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;const i=this.sourceOptions.find((e=>e.id===t.toString()));this.sourceOption={code:t,description:i.value||"",tag:i.tag,id:i.id,type:i.type}}gotoSplitPageTwo(){this.gotoPage("page_two")}handleButtonClicked(e){var t,i;switch(e.detail.key){case"save":this.bookUser(false);break;case"cancel":e.stopImmediatePropagation();e.stopPropagation();this.closeWindow();break;case"back":e.stopImmediatePropagation();e.stopPropagation();if(this.isEventType("BAR_BOOKING")){d()}this.gotoPage("page_one");break;case"book":this.bookUser(false);break;case"bookAndCheckIn":this.bookUser(true);break;case"next":e.stopImmediatePropagation();e.stopPropagation();if(!((t=this.adultChildCount)===null||t===void 0?void 0:t.adult)){this.animateIrSelect.emit("adult_child_select");break}if(c()>0){this.gotoPage("page_two");break}else if(((i=this.defaultData)===null||i===void 0?void 0:i.roomsInfo.length)===0){this.animateIrButton.emit("check_availability");break}this.toast.emit({type:"error",description:u.entries.Lcz_SelectRatePlan,title:u.entries.Lcz_SelectRatePlan});break;case"check":this.checkBookingAvailability();break}}updateBookingHistory(e){var t,i,s,a,o,n,r,l;const c=this.bookingHistory[this.bookingHistory.length-1];const d={dates:{checkIn:((t=e.dates)===null||t===void 0?void 0:t.checkIn)||((i=c===null||c===void 0?void 0:c.dates)===null||i===void 0?void 0:i.checkIn)||new Date(this.dateRangeData.fromDate),checkOut:((s=e.dates)===null||s===void 0?void 0:s.checkOut)||((a=c===null||c===void 0?void 0:c.dates)===null||a===void 0?void 0:a.checkOut)||new Date(this.dateRangeData.toDate)},adults:(n=(o=e.adults)!==null&&o!==void 0?o:c===null||c===void 0?void 0:c.adults)!==null&&n!==void 0?n:this.adultChildCount.adult,children:(l=(r=e.children)!==null&&r!==void 0?r:c===null||c===void 0?void 0:c.children)!==null&&l!==void 0?l:this.adultChildCount.child};this.bookingHistory.push(d);if(this.bookingHistory.length>this.MAX_HISTORY_LENGTH){this.bookingHistory.shift()}}handleKeyDown(e){if(e.key==="Escape"){this.closeWindow()}}initializeDefaultDateRange(){this.defaultDateRange={from_date:this.bookingData.FROM_DATE,to_date:this.bookingData.TO_DATE}}initializeDefaultData(){this.defaultData=this.bookingData;this.dateRangeData=Object.assign({},this.defaultData.defaultDateRange)}async fetchSetupEntriesAndInitialize(){try{const e=await this.fetchSetupEntries();this.setSourceOptions(this.allowedBookingSources);this.setOtherProperties(e);this.initializeEventData()}catch(e){console.error("Error fetching setup entries:",e)}}initializeEventData(){if(this.isEventType("EDIT_BOOKING")){this.initializeEditBookingData()}if(!this.isEventType("BAR_BOOKING")){this.bookPropertyService.resetRoomsInfoAndMessage(this)}this.initializePage()}initializeEditBookingData(){var e,t,i,s,a;this.adultChildCount={adult:this.defaultData.ADULTS_COUNT,child:this.defaultData.CHILDREN_COUNT};this.initialRoomIds={roomName:this.defaultData.roomName,ratePlanId:this.defaultData.RATE_PLAN_ID,roomId:this.defaultData.PR_ID,roomTypeId:this.defaultData.RATE_TYPE};const{currentRoomType:o,GUEST:n}=this.defaultData;console.log(n);r("guest",{bed_preference:(e=o.bed_preference)===null||e===void 0?void 0:e.toString(),infant_nbr:o.occupancy.infant_nbr,first_name:(t=n.first_name)!==null&&t!==void 0?t:"",last_name:(i=n.last_name)!==null&&i!==void 0?i:"",unit:(a=(s=o.unit)===null||s===void 0?void 0:s.id)===null||a===void 0?void 0:a.toString()});this.checkBookingAvailability();this.bookPropertyService.setEditingRoomInfo(this.defaultData,this.selectedUnits)}initializePage(){switch(this.defaultData.event_type){case"SPLIT_BOOKING":this.showSplitBookingOption=true;this.page="page_one";break;case"BLOCK_DATES":this.page="page_block_date";break;default:this.page="page_one";break}}async fetchSetupEntries(){return await this.bookingService.fetchSetupEntries()}isGuestDataIncomplete(){for(const e in n.ratePlanSelections){const t=n.ratePlanSelections[e];for(const e in t){const i=t[e];if(i.reserved>0){for(const e of i.guest){if(e.first_name===""||e.last_name===""){return true}}}}}return false}isButtonDisabled(){const e=(e,t,i)=>{if(!e){return true}if(e===this.guestData){return this.isGuestDataIncomplete()}if(t==="selectedArrivalTime"){if(e[t]!==undefined){return e[t].code===""}else{return true}}return e[t]===i||e[t]===undefined};return e(this.guestData,"guestName","")||e(this.bookedByInfoData,"firstName","")||e(this.bookedByInfoData,"lastName","")||e(this.bookedByInfoData,"selectedArrivalTime","")}setSourceOptions(e){this.sourceOptions=e.map((e=>({id:e.id,value:e.description,tag:e.tag,type:e.type})));this._sourceOptions=this.isEventType("BAR_BOOKING")?this.getFilteredSourceOptions():this.sourceOptions;if(this.isEventType("EDIT_BOOKING")){this.sourceOption=Object.assign({},this.defaultData.SOURCE)}else{let e=this._sourceOptions.find((e=>e.type!=="LABEL"));console.log({option:e});this.sourceOption={code:e.code,description:e.description,tag:e.tag,type:e.type,id:e.id}}}getFilteredSourceOptions(){var e,t,i,s;const a=new Set;const o=(i=(t=(e=this.bookingData)===null||e===void 0?void 0:e.roomsInfo)===null||t===void 0?void 0:t.some((e=>{var t;const i=(t=e===null||e===void 0?void 0:e.rateplans)!==null&&t!==void 0?t:[];if(i.length===0)return false;const s=i.every((e=>{var t,i;return((i=(t=e===null||e===void 0?void 0:e.agents)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0)>0}));if(s){i.forEach((e=>{var t;((t=e===null||e===void 0?void 0:e.agents)!==null&&t!==void 0?t:[]).forEach((e=>{var t;return a.add((t=e===null||e===void 0?void 0:e.id)===null||t===void 0?void 0:t.toString())}))}))}return s})))!==null&&i!==void 0?i:false;if(!o){return this.sourceOptions}return((s=this.sourceOptions)!==null&&s!==void 0?s:[]).filter((e=>{if((e===null||e===void 0?void 0:e.type)==="LABEL")return true;const t=e===null||e===void 0?void 0:e.tag;const i=t!=null&&a.has(t);return i}))}setOtherProperties(e){this.ratePricingMode=e===null||e===void 0?void 0:e.ratePricingMode;this.bookedByInfoData.arrivalTime=e.arrivalTime;this.bedPreferenceType=e.bedPreferenceType}async checkBookingAvailability(){h();const e=B(this.dateRangeData.fromDate).format("YYYY-MM-DD");const t=B(this.dateRangeData.toDate).format("YYYY-MM-DD");console.log({sourceOption:this.sourceOption});const i=this.sourceOption["type"]==="TRAVEL_AGENCY";try{const s=this.isEventType("EDIT_BOOKING")?[this.defaultData.RATE_TYPE]:[];const a=this.isEventType("BAR_BOOKING")?this.defaultData.roomsInfo.map((e=>e.id)):[];const o=await this.bookingService.getBookingAvailability({from_date:e,to_date:t,propertyid:this.propertyid,adultChildCount:this.adultChildCount,language:this.language,room_type_ids:a,currency:this.currency,agent_id:i?this.sourceOption["tag"]:null,is_in_agent_mode:i,room_type_ids_to_update:s});if(!this.isEventType("EDIT_BOOKING")){this.defaultData.defaultDateRange.fromDate=new Date(this.dateRangeData.fromDate);this.defaultData.defaultDateRange.toDate=new Date(this.dateRangeData.toDate)}this.defaultData=Object.assign(Object.assign({},this.defaultData),{roomsInfo:o});if(this.isEventType("EDIT_BOOKING")&&!this.updatedBooking){this.updateBooking()}}catch(e){console.error("Error initializing booking availability:",e)}}updateBooking(){var e,t,i;try{const{currentRoomType:s,GUEST:a}=this.defaultData;const o=s.roomtype.id;const n=s.rateplan.id;const l={bed_preference:(e=s.bed_preference)===null||e===void 0?void 0:e.toString(),infant_nbr:s.occupancy.infant_nbr,last_name:a.last_name,first_name:a.first_name,unit:(i=(t=s.unit)===null||t===void 0?void 0:t.id)===null||i===void 0?void 0:i.toString(),roomtype_id:s.roomtype.id};r("guest",l);p({roomTypeId:o,ratePlanId:n,rooms:1,guest:[l]})}catch(e){console.error(e)}}async checkAndBlockDate(){try{const{block_exposed_unit_props:e}=this.defaultData;await this.bookingService.getBookingAvailability({from_date:e.from_date,to_date:e.to_date,propertyid:this.propertyid,adultChildCount:{adult:2,child:0},language:this.language,room_type_ids:this.defaultData.roomsInfo.map((e=>e.id)),currency:this.currency});const t=n.roomTypes.every((e=>{if(e.is_available_to_book){return true}return e.inventory>0&&e["not_available_reason"]==="ALL-RATES-PLAN-NOT-BOOKABLE"}));if(t){await this.handleBlockDate(false)}else{console.log("Blocked date is unavailable. Continuing...")}}catch(e){console.error("Error checking and blocking date:",e)}}async closeWindow(){h();k(false);if(this.wasBlockedUnit&&!this.didReservation){await this.checkAndBlockDate()}const e=document.querySelector(".sideWindow");if(!e)return;e.classList.add("sideWindow--exit");setTimeout((()=>{this.closeBookingWindow.emit();document.removeEventListener("keydown",this.handleKeyDown)}),300)}isEventType(e){return this.defaultData.event_type===e}handleBlockDateUpdate(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;this.blockDatesData=t.data}handleGuestInfoUpdate(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;if(t.guestRefKey){if(this.isEventType("BAR_BOOKING")||this.wasBlockedUnit||this.isEventType("SPLIT_BOOKING")){this.guestData[t.guestRefKey]=Object.assign(Object.assign({},t.data),{roomId:this.defaultData.PR_ID})}else this.guestData[t.guestRefKey]=t.data}}handleBookedByInfoUpdate(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;this.bookedByInfoData=t.value.data}renderPage(){this.renderAgain=!this.renderAgain}gotoPage(e){this.page=e;this.renderPage()}getPageBlockDatesView(){return t(a,null,t("igl-block-dates-view",{fromDate:this.defaultData.FROM_DATE,toDate:this.defaultData.TO_DATE,entryDate:this.defaultData.ENTRY_DATE,onDataUpdateEvent:e=>this.handleBlockDateUpdate(e)}))}handlePageTwoDataUpdateEvent(e){e.stopImmediatePropagation();e.stopPropagation();if(e.detail.key==="propertyBookedBy"){this.handleBookedByInfoUpdate(e)}else{this.handleGuestInfoUpdate(e)}}async handleBlockDate(e=true){const t=this.wasBlockedUnit?this.defaultData.block_exposed_unit_props:(()=>{const e=_(+this.blockDatesData.RELEASE_AFTER_HOURS);return Object.assign({from_date:x(this.defaultData.defaultDateRange.fromDate),to_date:x(this.defaultData.defaultDateRange.toDate),NOTES:this.blockDatesData.OPTIONAL_REASON||"",pr_id:this.defaultData.PR_ID.toString(),STAY_STATUS_CODE:this.blockDatesData.OUT_OF_SERVICE?"004":this.blockDatesData.RELEASE_AFTER_HOURS===0?"002":"003",DESCRIPTION:this.blockDatesData.RELEASE_AFTER_HOURS||""},e)})();await this.bookingService.blockUnit(t);if(e)this.closeWindow()}async bookUser(e){this.setLoadingState(e);if(this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")){if(this.isGuestDataIncomplete()){this.isLoading="";return}}else if(this.isButtonDisabled()){this.isLoading="";return}try{const t=this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM");if(t){this.bookedByInfoData.message=this.defaultData.NOTES}this.didReservation=true;let i=g.property.allowed_booking_sources.find((e=>e.id===this.sourceOption.id))||this.sourceOption;const s=await this.bookPropertyService.prepareBookUserServiceParams({context:this,sourceOption:i,check_in:e});await this.bookingService.doReservation(s);await this.adjustBlockedDatesAfterReservation(s);this.resetBookingEvt.emit(null)}catch(e){console.error("Error booking user:",e)}finally{this.resetLoadingState()}}async adjustBlockedDatesAfterReservation(e){if(!this.wasBlockedUnit){return}const t=B(this.defaultData.block_exposed_unit_props.from_date,"YYYY-MM-DD");const i=B(e.booking.from_date,"YYYY-MM-DD");const s=B(this.defaultData.block_exposed_unit_props.to_date,"YYYY-MM-DD");const a=B(e.booking.to_date,"YYYY-MM-DD");if(a.isBefore(s,"days")){const e=Object.assign(Object.assign({},this.defaultData.block_exposed_unit_props),{from_date:a.format("YYYY-MM-DD")});await this.bookingService.blockUnit(e)}if(i.isAfter(t,"days")){const e=Object.assign(Object.assign({},this.defaultData.block_exposed_unit_props),{to_date:i.format("YYYY-MM-DD")});await this.bookingService.blockUnit(e)}return}setLoadingState(e){if(this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")){this.isLoading="save"}else{this.isLoading=e?"bookAndCheckIn":"book"}}resetLoadingState(){this.isLoading="";setTimeout((()=>{this.closeWindow()}),100)}getCurrentPage(e){return this.page===e}render(){return t(i,{key:"b2592a9632d31c343b81cabb133b48b084c34e68","data-testid":"book_property_sheet h-100"},t("div",{key:"bec1c605bf76827abf838c9288b9f9982959d38e",class:"background-overlay",onClick:()=>this.closeWindow()}),t("div",{key:"48f8543f7a37b79921d7c58eeffdb19cbcc0105d",class:"sideWindow sheet-container "+(this.getCurrentPage("page_block_date")?"block-date":"")},T("/Get_Setup_Entries_By_TBL_NAME_MULTI")?t("div",{class:"loading-container"},t("ir-spinner",null)):t(a,null,t("div",{class:"sheet-header"},t("div",{class:"card-header-container mb-2"},t("h3",{class:"text-left font-medium-2 px-2"},this.getCurrentPage("page_block_date")?this.defaultData.BLOCK_DATES_TITLE:this.defaultData.TITLE),t("ir-icon",{class:"px-2",onIconClickHandler:()=>{this.closeWindow()}},t("svg",{slot:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:20,width:20},t("path",{fill:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))))),t("div",{class:"px-2 sheet-body"},this.getCurrentPage("page_one")&&t("igl-booking-overview-page",{wasBlockedUnit:this.wasBlockedUnit,initialRoomIds:this.initialRoomIds,defaultDaterange:this.defaultDateRange,eventType:this.defaultData.event_type,selectedRooms:this.selectedUnits,currency:this.currency,showSplitBookingOption:this.showSplitBookingOption,ratePricingMode:this.ratePricingMode,dateRangeData:this.dateRangeData,bookingData:this.defaultData,adultChildCount:this.adultChildCount,bookedByInfoData:this.bookedByInfoData,adultChildConstraints:this.adultChildConstraints,sourceOptions:this._sourceOptions,propertyId:this.propertyid}),this.getCurrentPage("page_two")&&t("igl-booking-form",{currency:this.currency,propertyId:this.propertyid,showPaymentDetails:this.showPaymentDetails,selectedGuestData:this.guestData,countries:this.countries,isLoading:this.isLoading,selectedRooms:this.selectedUnits,bedPreferenceType:this.bedPreferenceType,dateRangeData:this.dateRangeData,bookingData:this.defaultData,showSplitBookingOption:this.showSplitBookingOption,language:this.language,bookedByInfoData:this.bookedByInfoData,defaultGuestData:this.defaultData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),onDataUpdateEvent:e=>this.handlePageTwoDataUpdateEvent(e)}),this.getCurrentPage("page_block_date")?this.getPageBlockDatesView():null),this.getCurrentPage("page_block_date")?t("div",{class:"sheet-footer"},t("ir-button",{text:u.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClick:()=>this.closeWindow()}),t("ir-button",{text:u.entries.Lcz_Blockdates,isLoading:T("/Block_Exposed_Unit"),class:"flex-fill",onClick:()=>this.handleBlockDate()})):t("igl-book-property-footer",{page:this.page,dateRangeData:this.dateRangeData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),isLoading:this.isLoading,class:"sheet-footer",eventType:this.bookingData.event_type}))))}};te.style=Z+ee;const ie=".sc-igl-book-property-footer-h{width:100% !important;background:#000}";const se=ie;const ae=class{constructor(t){e(this,t);this.buttonClicked=s(this,"buttonClicked",7);this.disabled=true}isEventType(e){return e===this.eventType}editNext(e){if(this.isEventType("EDIT_BOOKING")){if(e==="Cancel"){return"flex-fill"}else{return"d-none d-md-block  flex-fill"}}return"flex-fill"}renderButton({label:e,type:i,disabled:s,icon_name:a,isLoading:o,icon_position:n="right"}){return t("div",{class:this.shouldRenderTwoButtons()?` ${this.editNext(e)}`:"flex-fill"},t("ir-button",{isLoading:o,btn_color:i==="cancel"||i==="back"?"secondary":"primary",text:e,btn_disabled:s,onClickHandler:()=>{this.buttonClicked.emit({key:i})},class:"full-width",btn_styles:"justify-content-center",icon_name:a,iconPosition:n,style:{"--icon-size":"1rem"},icon_style:{paddingBottom:"1.9px"}}))}shouldRenderTwoButtons(){return this.isEventType("PLUS_BOOKING")||this.isEventType("ADD_ROOM")||this.isEventType("EDIT_BOOKING")}render(){var e;if(this.page==="page_one"){return t(i,null,this.isEventType("EDIT_BOOKING")?t(a,null,this.renderButton({type:"cancel",label:u.entries.Lcz_Cancel}),this.shouldRenderTwoButtons()&&this.renderButton({type:"next",label:`${u.entries.Lcz_Next}`,disabled:T("/Get_Exposed_Booking_Availability"),icon_name:"angles_right"})):t(a,null,this.renderButton({type:"cancel",label:u.entries.Lcz_Cancel}),this.shouldRenderTwoButtons()&&this.renderButton({type:"next",label:`${u.entries.Lcz_Next}`,icon_name:"angles_right"})))}const s=g.checkin_enabled&&B(new Date((e=this.dateRangeData)===null||e===void 0?void 0:e.fromDate)).isSame(new Date,"day");return t(a,null,this.isEditOrAddRoomEvent?t(a,null,this.renderButton({type:"back",icon_position:"left",label:u.entries.Lcz_Back,icon_name:"angles_left"}),this.renderButton({type:"save",label:u.entries.Lcz_Save,isLoading:this.isLoading==="save"})):t(a,null,this.renderButton({type:"back",icon_position:"left",label:u.entries.Lcz_Back,icon_name:"angles_left"}),this.renderButton({type:"book",label:u.entries.Lcz_Book,isLoading:this.isLoading==="book"}),s&&this.renderButton({type:"bookAndCheckIn",label:u.entries.Lcz_BookAndChekcIn,isLoading:this.isLoading==="bookAndCheckIn"})))}};ae.style=se;const oe=".sc-igl-book-property-header-h{display:block}.sourceContainer.sc-igl-book-property-header{max-width:350px}.message-label.sc-igl-book-property-header{font-size:80%}";const ne=oe;const re=class{constructor(t){e(this,t);this.splitBookingDropDownChange=s(this,"splitBookingDropDownChange",7);this.sourceDropDownChange=s(this,"sourceDropDownChange",7);this.adultChild=s(this,"adultChild",7);this.checkClicked=s(this,"checkClicked",7);this.buttonClicked=s(this,"buttonClicked",7);this.toast=s(this,"toast",7);this.spiltBookingSelected=s(this,"spiltBookingSelected",7);this.animateIrButton=s(this,"animateIrButton",7);this.animateIrSelect=s(this,"animateIrSelect",7);this.splitBookingId="";this.bookingData="";this.sourceOptions=[];this.showSplitBookingOption=false;this.sourceOption={code:"",description:"",tag:"",id:"",type:""}}getSplitBookingList(){return t("fieldset",{class:"d-flex flex-column text-left mb-1  flex-lg-row align-items-lg-center"},t("label",{class:"mr-lg-1"},u.entries.Lcz_Tobooking,"# "),t("div",{class:"btn-group mt-1 mt-lg-0 sourceContainer"},t("ir-autocomplete",{value:Object.keys(this.bookedByInfoData).length>1?`${this.bookedByInfoData.bookingNumber} ${this.bookedByInfoData.firstName} ${this.bookedByInfoData.lastName}`:"",from_date:B(this.bookingDataDefaultDateRange.fromDate).format("YYYY-MM-DD"),to_date:B(this.bookingDataDefaultDateRange.toDate).format("YYYY-MM-DD"),propertyId:this.propertyId,placeholder:u.entries.Lcz_BookingNumber,onComboboxValue:e=>{e.stopImmediatePropagation();this.spiltBookingSelected.emit(e.detail)},isSplitBooking:true})))}getSourceNode(){return t("fieldset",{class:"d-flex text-left  align-items-center"},t("label",{class:"mr-1"},u.entries.Lcz_Source," "),t("div",{class:"btn-group mt-0 flex-fill sourceContainer"},t("select",{class:"form-control input-sm",id:"xSmallSelect",onChange:e=>this.sourceDropDownChange.emit(e.target.value)},this.sourceOptions.map((e=>{if(e.type==="LABEL"){return t("optgroup",{label:e.value})}return t("option",{value:e.id,selected:this.sourceOption.code===e.id},e.value)})))))}handleAdultChildChange(e,t){var i,s;let a={};if(t===""){a=Object.assign(Object.assign({},this.adultChildCount),{[e]:0})}else{a=Object.assign(Object.assign({},this.adultChildCount),{[e]:t})}r("bookingAvailabilityParams",{from_date:this.bookingDataDefaultDateRange.fromDate,to_date:this.bookingDataDefaultDateRange.toDate,adult_nbr:(i=a===null||a===void 0?void 0:a["adult"])!==null&&i!==void 0?i:0,child_nbr:(s=a===null||a===void 0?void 0:a["child"])!==null&&s!==void 0?s:0});this.adultChild.emit(a)}getAdultChildConstraints(){var e,i,s,a;return t("div",{class:"mt-1 mt-lg-0 d-flex flex-column text-left"},t("div",{class:"form-group  my-lg-0 text-left d-flex align-items-center justify-content-between justify-content-sm-start"},t("fieldset",null,t("div",{class:"btn-group ml-0"},t("ir-select",{testId:"adult_number",class:"m-0",selectedValue:(i=(e=this.adultChildCount)===null||e===void 0?void 0:e.adult)===null||i===void 0?void 0:i.toString(),onSelectChange:e=>this.handleAdultChildChange("adult",e.detail),selectId:"adult_select",firstOption:u.entries.Lcz_AdultsCaption,data:Array.from(Array(this.adultChildConstraints.adult_max_nbr),((e,t)=>t+1)).map((e=>({text:e.toString(),value:e.toString()})))}))),this.adultChildConstraints.child_max_nbr>0&&t("fieldset",null,t("div",{class:"btn-group ml-1 p-0"},t("ir-select",{selectedValue:(a=(s=this.adultChildCount)===null||s===void 0?void 0:s.child)===null||a===void 0?void 0:a.toString(),testId:"child_number",onSelectChange:e=>this.handleAdultChildChange("child",e.detail),selectId:"child_select",firstOption:this.renderChildCaption(),data:Array.from(Array(this.adultChildConstraints.child_max_nbr),((e,t)=>t+1)).map((e=>({text:e.toString(),value:e.toString()})))}))),t("ir-button",{btn_id:"check_availability",isLoading:T("/Check_Availability"),size:"sm",class:"ml-2",text:u.entries.Lcz_Check,onClickHandler:()=>this.handleButtonClicked()})))}renderChildCaption(){const e=this.adultChildConstraints.child_max_age;let t=u.entries.Lcz_Years;if(e===1){t=u.entries.Lcz_Year}return`${u.entries.Lcz_ChildCaption} 0 - ${this.adultChildConstraints.child_max_age} ${t}`}handleButtonClicked(){if(this.isEventType("SPLIT_BOOKING")&&Object.keys(this.bookedByInfoData).length<=1){this.toast.emit({type:"error",title:u.entries.Lcz_ChooseBookingNumber,description:"",position:"top-right"})}else if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){const e=B(new Date(this.bookedByInfoData.to_date||this.defaultDaterange.to_date));const t=B(new Date(this.bookedByInfoData.from_date||this.defaultDaterange.from_date));const i=B(new Date(this.dateRangeData.fromDate));const s=B(new Date(this.dateRangeData.toDate));if(s.isBefore(t)||i.isAfter(e)){this.toast.emit({type:"error",title:`${u.entries.Lcz_CheckInDateShouldBeMAx.replace("%1",B(new Date(this.bookedByInfoData.from_date||this.defaultDaterange.from_date)).format("ddd, DD MMM YYYY")).replace("%2",B(new Date(this.bookedByInfoData.to_date||this.defaultDaterange.to_date)).format("ddd, DD MMM YYYY"))}  `,description:"",position:"top-right"});return}else if(this.adultChildCount.adult===0){this.toast.emit({type:"error",title:u.entries.Lcz_PlzSelectNumberOfGuests,description:"",position:"top-right"});this.animateIrSelect.emit("adult_child_select")}else{this.buttonClicked.emit({key:"check"})}}else if(this.minDate&&new Date(this.dateRangeData.fromDate).getTime()>new Date(this.bookedByInfoData.to_date||this.defaultDaterange.to_date).getTime()){this.toast.emit({type:"error",title:`${u.entries.Lcz_CheckInDateShouldBeMAx.replace("%1",B(new Date(this.bookedByInfoData.from_date||this.defaultDaterange.from_date)).format("ddd, DD MMM YYYY")).replace("%2",B(new Date(this.bookedByInfoData.to_date||this.defaultDaterange.to_date)).format("ddd, DD MMM YYYY"))}  `,description:"",position:"top-right"})}else if(this.adultChildCount.adult===0){this.animateIrSelect.emit("adult_child_select");this.toast.emit({type:"error",title:u.entries.Lcz_PlzSelectNumberOfGuests,description:"",position:"top-right"})}else{this.buttonClicked.emit({key:"check"})}}isEventType(e){return this.bookingData.event_type===e}getMinDate(){var e;if(this.isEventType("PLUS_BOOKING")){return B().add(-1,"months").startOf("month").format("YYYY-MM-DD")}if(this.wasBlockedUnit){return(e=this.bookingData)===null||e===void 0?void 0:e.block_exposed_unit_props.from_date}return this.minDate}getMaxDate(){var e,t;if(!((e=this.bookingData)===null||e===void 0?void 0:e.block_exposed_unit_props)){return undefined}return(t=this.bookingData)===null||t===void 0?void 0:t.block_exposed_unit_props.to_date}render(){const e=this.showSplitBookingOption?this.getSplitBookingList():this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")?false:true;return t(i,{key:"cdf7d392f00e73d5b8d2f61c8bb90128d282944a"},this.isEventType("SPLIT_BOOKING")&&this.getSplitBookingList(),e&&this.getSourceNode(),t("div",{key:"e7c87655d34b39f7a7184741c2bc71ef049886ba",class:`d-flex flex-column flex-lg-row align-items-lg-center ${e?"mt-1":""}`},t("fieldset",{key:"b17bac8bf63d62a7e1f331fcbc88cc32905efc73",class:"mt-lg-0 mr-1 "},t("igl-date-range",{key:"cecdf93e5a5f2ce936b1fc7f4bed3891495d5f3c","data-testid":"date_picker",variant:"booking",dateLabel:u.entries.Lcz_Dates,maxDate:this.getMaxDate(),minDate:this.getMinDate(),disabled:this.isEventType("BAR_BOOKING")&&!this.wasBlockedUnit||this.isEventType("SPLIT_BOOKING"),defaultData:this.bookingDataDefaultDateRange})),!this.isEventType("EDIT_BOOKING")&&this.getAdultChildConstraints()),t("p",{key:"60e589c43a4807731bf2c12130601dd981d2b21d",class:"text-right mt-1 message-label"},g.tax_statement))}};re.style=ne;const le=".sc-igl-booking-form-h{display:flex;flex-direction:column}";const ce=le;const de=class{constructor(t){e(this,t);this.dataUpdateEvent=s(this,"dataUpdateEvent",7);this.buttonClicked=s(this,"buttonClicked",7);this.selectedUnits={}}componentWillLoad(){this.initializeGuestData();this.selectedBookedByData=this.bookedByInfoData}initializeGuestData(){let e=0;const t=Object.assign({},this.selectedUnits);const i=(e,t,i,s)=>{if(i&&s===2){return e*t}return e};this.selectedUnits=t;this.guestData=[];this.selectedRooms.forEach(((s,a)=>{s.forEach((s=>{t[a]=s.selectedUnits;e+=s.totalRooms*i(s.rate,this.dateRangeData.dateDifference,s.isRateModified,s.rateType);for(let e=1;e<=s.totalRooms;e++){this.guestData.push(Object.assign({guestName:"",roomId:"",preference:""},s))}}))}));this.bookingData.TOTAL_PRICE=e}handleOnApplicationInfoDataUpdateEvent(e,t){const i=e.detail;const s=`c_${i.data.roomCategoryId}`;const a=[...this.selectedUnits[s]||[]];a[t]=i.data.roomId;this.selectedUnits=Object.assign(Object.assign({},this.selectedUnits),{[s]:a});this.dataUpdateEvent.emit({key:"applicationInfoUpdateEvent",value:e.detail})}handleEventData(e,t,i){if(t==="application-info"){this.handleOnApplicationInfoDataUpdateEvent(e,i)}else{this.selectedBookedByData=e.detail.data;this.dataUpdateEvent.emit({key:"propertyBookedBy",value:e.detail})}}isGuestDataIncomplete(){if(this.selectedGuestData.length!==this.guestData.length){return true}for(const e of this.selectedGuestData){if(e.guestName===""||e.preference===""||e.roomId===""){return true}}return false}isButtonDisabled(e){const t=(e,t,i)=>{if(!e){return true}if(e===this.selectedGuestData){return this.isGuestDataIncomplete()}if(t==="selectedArrivalTime"){if(e[t]!==undefined){return e[t].code===""}else{return true}}return e[t]===i||e[t]===undefined};return this.isLoading===e||t(this.selectedGuestData,"guestName","")||t(this.selectedBookedByData,"isdCode","")||t(this.selectedBookedByData,"contactNumber","")||t(this.selectedBookedByData,"firstName","")||t(this.selectedBookedByData,"lastName","")||t(this.selectedBookedByData,"countryId",-1)||t(this.selectedBookedByData,"selectedArrivalTime","")||t(this.selectedBookedByData,"email","")}render(){return t("div",{key:"faa5c62adb02164a255992ec498748321cd766d2",class:"d-flex flex-column h-100"},t("div",{key:"6007b9d921af66a7a6f8983d276af2d6e9ed8553",class:"d-flex flex-wrap"},t("ir-date-view",{key:"e85b346855b561e4971ab2b9f27a59363b2ff48f",class:"mr-1 flex-fill font-weight-bold font-medium-1",from_date:new Date(this.dateRangeData.fromDate),to_date:new Date(this.dateRangeData.toDate),dateOption:"DD MMM YYYY"}),this.guestData.length>1&&t("div",{key:"7cd33af9946e889a01c8d9f3519aa58b1b74ff7d",class:"mt-1 mt-md-0 text-right"},u.entries.Lcz_TotalPrice," ",t("span",{key:"630867b9f5e32096f57230dd82ad40dca6f8a2e3",class:"font-weight-bold font-medium-1"},y(this.currency.symbol,this.bookingData.TOTAL_PRICE||"0")))),Object.values(n.ratePlanSelections).map((e=>Object.values(e).map((e=>{const i=e;if(i.reserved===0){return null}return[...new Array(i.reserved)].map(((e,s)=>t("igl-application-info",{totalNights:Number(this.dateRangeData.dateDifference),bedPreferenceType:this.bedPreferenceType,currency:this.currency,guestInfo:i.guest?i.guest[s]:null,bookingType:this.bookingData.event_type,rateplanSelection:i,key:`${i.ratePlan.id}_${s}`,roomIndex:s,baseData:this.bookingData.event_type==="EDIT_BOOKING"?{roomtypeId:this.bookingData.currentRoomType.roomtype.id,unit:this.bookingData.currentRoomType.unit}:undefined})))})))),this.isEditOrAddRoomEvent||this.showSplitBookingOption?null:t("igl-property-booked-by",{propertyId:this.propertyId,countries:this.countries,language:this.language,showPaymentDetails:this.showPaymentDetails,defaultData:this.bookedByInfoData,onDataUpdateEvent:e=>{this.handleEventData(e,"propertyBookedBy",0)}}))}};de.style=ce;const he=".sc-igl-booking-overview-page-h{display:block}.sc-igl-booking-overview-page-h>*.sc-igl-booking-overview-page{margin:0;padding:auto}.scrollContent.sc-igl-booking-overview-page{height:calc(100% - 79px);overflow:auto;position:relative}.loading-container.sc-igl-booking-overview-page{display:flex;align-items:center;justify-content:center;height:100%;background:white;position:absolute;inset:0;z-index:100}.loader.sc-igl-booking-overview-page{width:1.25rem;height:1.25rem;border:2.5px solid #3f3f3f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}";const pe=he;const fe=class{constructor(t){e(this,t);this.roomsDataUpdate=s(this,"roomsDataUpdate",7)}getSplitBookings(){return this.bookingData.hasOwnProperty("splitBookingEvents")&&this.bookingData.splitBookingEvents||[]}isEventType(e){return e===this.eventType}setMinDate(){if(!this.isEventType("EDIT_BOOKING")){return}const e=B(this.bookingData.FROM_DATE,"YYYY-MM-DD");const t=B();if(e.isAfter(t)){return t.add(-2,"weeks").format("YYYY-MM-DD")}return e.add(-2,"weeks").format("YYYY-MM-DD")}render(){var e;return t(i,{key:"4c73973cee85df6056f8803e021a24f73627822b"},t("igl-book-property-header",{key:"1b105e08a75ce982fcc3a99f7c1682f3f10b74d5",wasBlockedUnit:this.wasBlockedUnit,bookedByInfoData:this.bookedByInfoData,defaultDaterange:this.defaultDaterange,dateRangeData:this.dateRangeData,minDate:this.setMinDate(),adultChildCount:this.adultChildCount,splitBookingId:this.showSplitBookingOption,bookingData:this.bookingData,sourceOptions:this.sourceOptions,message:this.message,bookingDataDefaultDateRange:this.bookingData.defaultDateRange,showSplitBookingOption:this.showSplitBookingOption,adultChildConstraints:this.adultChildConstraints,splitBookings:this.getSplitBookings(),propertyId:this.propertyId}),t("div",{key:"3b0aeb2a24f6117cf5e4374a00c39d272a53579e",class:" text-left"},T("/Check_Availability")&&this.isEventType("EDIT_BOOKING")?t("div",{class:"loading-container"},t("div",{class:"loader"})):t(a,null,(e=n.roomTypes)===null||e===void 0?void 0:e.map((e=>t("igl-room-type",{initialRoomIds:this.initialRoomIds,isBookDisabled:Object.keys(this.bookedByInfoData).length<=1,key:`room-type-${e.id}`,currency:this.currency,ratePricingMode:this.ratePricingMode,dateDifference:this.dateRangeData.dateDifference,bookingType:this.bookingData.event_type,roomType:e,class:"mt-2 mb-1 p-0","data-testid":`room_type_${e.id}`,id:e.id.toString(),roomInfoId:this.selectedRooms.has(`c_${e.id}`)?e.id:null,onDataUpdateEvent:e=>this.roomsDataUpdate.emit(e.detail)}))))))}};fe.style=pe;const be=".sc-igl-property-booked-by-h{display:block}.bookedByEmailContainer.sc-igl-property-booked-by{flex:auto;max-width:350px}.bookedDetailsForm.sc-igl-property-booked-by label.sc-igl-property-booked-by{min-width:125px;max-width:125px}.row.sc-igl-booking-form.sc-igl-property-booked-by{padding:0 !important}.bookedDetailsForm.sc-igl-property-booked-by .form-group.sc-igl-property-booked-by{margin-bottom:10px !important}.bookedDetailsForm.sc-igl-property-booked-by .checkBoxContainer.sc-igl-property-booked-by input.sc-igl-property-booked-by{height:1.2rem !important;width:30px}.property-booked-by__money-transfer-description.sc-igl-property-booked-by *.sc-igl-property-booked-by{margin:0 !important;margin-bottom:0 !important;margin-top:0 !important}.property-booked-by__money-transfer-description.sc-igl-property-booked-by,.property-booked-by__money-transfer-description.sc-igl-property-booked-by .sc-igl-property-booked-by:where(*,*.sc-igl-property-booked-by::before,*.sc-igl-property-booked-by::after){margin:0.5rem !important}.controlContainer.sc-igl-property-booked-by textarea.sc-igl-property-booked-by{height:60px !important}.margin3.sc-igl-property-booked-by{margin-bottom:5px !important}@media (min-width: 768px){.bookedByEmailContainer.sc-igl-property-booked-by{margin-left:37px}}";const ue=be;const me=class{constructor(t){e(this,t);this.dataUpdateEvent=s(this,"dataUpdateEvent",7);this.showPaymentDetails=false;this.countries=[];this.isButtonPressed=false;this.bookedByData={id:undefined,email:"",firstName:"",lastName:"",countryId:"",isdCode:"",contactNumber:"",selectedArrivalTime:"",emailGuest:false,message:"",cardNumber:"",cardHolderName:"",expiryMonth:"",expiryYear:""};this.bookingService=new l;this.arrivalTimeList=[];this.expiryMonths=["01","02","03","04","05","06","07","08","09","10","11","12"];this.expiryYears=[];this.currentMonth="01";this.paymentMethods=[]}componentWillLoad(){this.assignCountryCode();this.initializeExpiryYears();this.initializeDateData();this.populateBookedByData();this.paymentMethods=g.property.allowed_payment_methods.filter((e=>e.is_active&&!e.is_payment_gateway));if(this.paymentMethods.length>0){r("selectedPaymentMethod",{code:this.paymentMethods[0].code})}}handleButtonClicked(e){switch(e.detail.key){case"book":case"bookAndCheckIn":this.isButtonPressed=true;break}}initializeExpiryYears(){const e=(new Date).getFullYear();this.expiryYears=Array.from({length:12},((t,i)=>(e+i).toString()))}async assignCountryCode(){const e=await this.bookingService.getUserDefaultCountry();const t=e["COUNTRY_ID"];this.country=t;this.bookedByData=Object.assign(Object.assign({},this.bookedByData),{isdCode:t.toString(),countryId:t})}initializeDateData(){const e=new Date;const t=e.getMonth()+1;this.currentMonth=t<10?`0${t}`:t.toString()}populateBookedByData(){var e;this.bookedByData=this.defaultData?Object.assign(Object.assign({},this.bookedByData),this.defaultData):{};this.arrivalTimeList=((e=this.defaultData)===null||e===void 0?void 0:e.arrivalTime)||[];this.bookedByData=Object.assign(Object.assign({},this.bookedByData),{selectedArrivalTime:this.arrivalTimeList[0].CODE_NAME});if(!this.bookedByData.expiryMonth){this.bookedByData.expiryMonth=this.currentMonth}if(!this.bookedByData.expiryYear){this.bookedByData.expiryYear=(new Date).getFullYear()}}handleDataChange(e,t){this.bookedByData[e]=e==="emailGuest"?t.target.checked:t.target.value;this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:Object.assign({},this.bookedByData)});if(e==="countryId"){this.bookedByData=Object.assign(Object.assign({},this.bookedByData),{isdCode:t.target.value})}}handleCountryChange(e){this.bookedByData=Object.assign(Object.assign({},this.bookedByData),{isdCode:e,countryId:e});this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:Object.assign({},this.bookedByData)})}handleNumberInput(e,t){const i=t.target;const s=i.value;const a=/^[0-9]+$/;if(!a.test(s)){i.value=s.replace(/[^0-9]/g,"")}if(s===i.value){this.handleDataChange(e,t)}}async checkUser(){var e;try{const t=this.bookedByData.email;if(E.string().email().safeParse(t).success){const i=await this.bookingService.getUserInfo(t);if(i!==null){this.bookedByData=Object.assign(Object.assign({},this.bookedByData),{id:i.id,firstName:i.first_name,lastName:i.last_name,contactNumber:i.mobile_without_prefix,countryId:i.country_id,isdCode:(e=i===null||i===void 0?void 0:i.country_phone_prefix)!==null&&e!==void 0?e:i.isdCode.toString()});console.log(this.bookedByData)}else{let e=Object.assign({},this.bookedByData);e=Object.assign(Object.assign({},e),{email:t});this.bookedByData=Object.assign({},e)}}else{let e=Object.assign({},this.bookedByData);e=Object.assign(Object.assign({},e),{email:""});this.bookedByData=Object.assign({},e)}this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:Object.assign({},this.bookedByData)})}catch(e){}}updateGuest(e){var t;r("checkout_guest",Object.assign(Object.assign({},(t=n.checkout_guest)!==null&&t!==void 0?t:{}),e))}handleComboboxChange(e){var t;e.stopImmediatePropagation();e.stopPropagation();const{key:i,data:s}=e.detail;console.log(i,s);if(i==="blur"){if(E.string().email().safeParse(s).success){this.bookedByData.email=s;this.checkUser()}else if(this.bookedByData.email!==""&&s==""){this.bookedByData.email=""}this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:this.bookedByData})}if(i==="select"){this.bookedByData.email=s.email;this.bookedByData=Object.assign(Object.assign({},this.bookedByData),{id:s.id,firstName:s.first_name,lastName:s.last_name,contactNumber:s.mobile_without_prefix,countryId:s.country_id,isdCode:(t=s["country_phone_prefix"])!==null&&t!==void 0?t:s===null||s===void 0?void 0:s.country_id});this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:this.bookedByData})}}clearEvent(){this.bookedByData=Object.assign(Object.assign({},this.bookedByData),{id:"",firstName:"",lastName:"",contactNumber:"",isdCode:this.country.toString(),countryId:this.country});this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:Object.assign({},this.bookedByData)})}render(){var e,s,o,l,c;return t(i,{key:"3023453cec52724a0d1f215fd5c6cc1c469d1f53"},t("div",{key:"d927507eb5a7a2fc6684d1ea513e213afd81a27d",class:"text-left mt-3"},t("div",{key:"07a93d9548924185701169d15dfbede6586a053c",class:"form-group d-flex flex-column flex-md-row align-items-md-center text-left "},t("label",{key:"7b00a27319fada8422abe6a9eef8a22bb9626df5",class:"p-0 m-0 label-control mr-1 font-weight-bold"},u.entries.Lcz_BookedBy),t("div",{key:"936c73b4c59f0e2d3fc576ba912b26617a5fa2de",class:"bookedByEmailContainer mt-1 mt-md-0 d-flex align-items-center"},t("ir-autocomplete",{key:"ed997ee333ca968872dba6a2c0998fe7f64925df",testId:"main_guest_email",onComboboxValue:this.handleComboboxChange.bind(this),propertyId:this.propertyId,type:"text",value:this.bookedByData.email,required:true,class:"flex-fill",placeholder:u.entries.Lcz_FindEmailAddress,onInputCleared:()=>this.clearEvent(),danger_border:this.isButtonPressed&&this.bookedByData.email!==""&&w(this.bookedByData.email)}),t("ir-tooltip",{key:"c3b7e88b995378216d8e477f636804528516d8c5",class:"ml-1",message:"Leave empty if email is unavailable"})))),t("div",{key:"2347e839c01d34d36460a4b785b184301f842994",class:"bookedDetailsForm text-left mt-2 font-small-3 "},t("div",{key:"0aa1125aa6d2c11fe9320c94e1b79705c7abb2ab",class:"d-flex flex-column flex-md-row  justify-content-md-between "},t("div",{key:"f49e125f4ff29112a9bc6e5cfc56bc92d42b75d6",class:"p-0 flex-fill "},t("div",{key:"881cffb5c24b5e022ac102b11945b4774945cc3e",class:"form-group d-flex flex-column flex-md-row align-items-md-center p-0 flex-fill "},t("label",{key:"6b0083753b0c727f5a3c6b0ee212eb98b389e369",class:"p-0 m-0 margin3"},u.entries.Lcz_FirstName),t("div",{key:"dfac79f83b5212e15a45da62b1f07fb0b62d433d",class:"p-0 m-0  controlContainer flex-fill  "},t("input",{key:"755bf206224128f69888b4ca508fef71ee6092f9","data-testid":"main_guest_first_name",class:`form-control flex-fill ${this.isButtonPressed&&this.bookedByData.firstName===""&&"border-danger"}`,type:"text",placeholder:u.entries.Lcz_FirstName,id:I(),value:this.bookedByData.firstName,onInput:e=>{this.updateGuest({first_name:e.target.value});this.handleDataChange("firstName",e)},required:true}))),t("div",{key:"967dee46d299da623d35099ee977177d633b5b28",class:"form-group  p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"c039d95845a772206556c14d12c06fc42310e6bd",class:"p-0 m-0 margin3"},u.entries.Lcz_LastName),t("div",{key:"d9f89089879761e13637274e4c6de3121629a1c4",class:"p-0 m-0  controlContainer flex-fill"},t("input",{key:"56b021f67cacbca9207a2bdfc481103157eddcfb","data-testid":"main_guest_last_name",class:`form-control ${this.isButtonPressed&&this.bookedByData.lastName===""&&"border-danger"}`,type:"text",placeholder:u.entries.Lcz_LastName,id:I(),value:this.bookedByData.lastName,onInput:e=>this.handleDataChange("lastName",e)}))),t("div",{key:"85f51aff99f7f610291f977666c4bdb2269cb0f0",class:"form-group  p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"d2f29f8cfb22f6e7f23a3dc69271098a9a8523f4",class:"p-0 m-0 margin3"},u.entries.Lcz_Country),t("ir-country-picker",{key:"08618bad10cd2682b187ca1666aaa8d60ae4f600",testId:"main_guest_country",class:"flex-grow-1 m-0",onCountryChange:e=>this.handleCountryChange(e.detail.id),countries:this.countries,country:this.countries.find((e=>e.id===this.bookedByData.countryId))})),t("div",{key:"d7f3968534c31f723ffa636f0b79acde8bbc54b0",class:"form-group p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"b8dfb87569af53bbe4bf8a89b6739f759f8b6646",class:"p-0 m-0 margin3"},u.entries.Lcz_MobilePhone),t("div",{key:"22f46926c50cc7529f7846670400d82910a7d52c",class:"p-0 m-0 controlContainer flex-fill"},t("ir-phone-input",{key:"8d28bc81971a4f08ddc6ffbbb25e319a19e23bcd",testId:"main_guest_phone",language:this.language,value:this.bookedByData.contactNumber,phone_prefix:this.bookedByData.isdCode,default_country:this.bookedByData.countryId,onTextChange:e=>{this.handleDataChange("isdCode",{target:{value:e.detail.phone_prefix}});this.handleDataChange("contactNumber",{target:{value:e.detail.mobile}})}}))),t("div",{key:"b0eb78b0351d32d8e899fc3e76fcce7e7d59e800",class:"form-group  p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"363d337a90b62e7387b92aa321e2c42493d745f6",class:"p-0 m-0 margin3"},u.entries.Lcz_YourArrivalTime),t("div",{key:"6c5a05ec7b8e9c69902ee04ace7f5f868b63d4dc",class:"p-0 m-0  controlContainer flex-fill"},t("select",{key:"f8b1bd5bbf32d2034e7aae83fe36e929b18dd5bb","data-testid":"arrival_time",class:`form-control input-sm pr-0 ${this.isButtonPressed&&this.bookedByData.selectedArrivalTime.code===""&&"border-danger"}`,id:I(),onChange:e=>this.handleDataChange("selectedArrivalTime",e)},this.arrivalTimeList.map((e=>t("option",{value:e.CODE_NAME,selected:this.bookedByData.selectedArrivalTime.code===e.CODE_NAME},e.CODE_VALUE_EN))))))),t("div",{key:"636b881f139ca6a57b1e040a200b0dc933cbd8d0",class:"p-0 flex-fill  ml-md-3"},t("div",{key:"9ffe48828a14f45610d774a4df748a8898acb660",class:"  p-0 d-flex flex-column flex-md-row align-items-md-center "},t("label",{key:"3847b56cded2cdfc3d9ed3a02af30a11e7f416ca",class:"p-0 m-0 margin3"},u.entries.Lcz_AnyMessageForUs),t("div",{key:"ed35c8b5f2418d796bd9247c1b7d83ae69c7c32c",class:"p-0 m-0  controlContainer flex-fill "},t("textarea",{key:"44799891b4ce5cddea5a0ffbd00717ce60e5929e","data-testid":"note",id:I(),rows:4,class:"form-control ",name:"message",value:this.bookedByData.message,onInput:e=>this.handleDataChange("message",e)}))),this.paymentMethods.length>1&&t("div",{key:"50b0990d2aead1b1300e36e4579581e136aeab17",class:"form-group mt-md-1 mt-1 p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"74b6112b3c4ca5a0b23cc0e9fe7bdfc0801ea016",class:"p-0 m-0 margin3"},"Payment Method"),t("div",{key:"b0e412a57510e9342bc62f1bb72895f43e656d2a",class:"p-0 m-0  controlContainer flex-fill"},t("ir-select",{key:"84e3834a7eba3f53172bfb8162c1f260386fa6db",showFirstOption:false,selectedValue:(e=n===null||n===void 0?void 0:n.selectedPaymentMethod)===null||e===void 0?void 0:e.code,data:this.paymentMethods.map((e=>({text:e.description,value:e.code}))),onSelectChange:e=>r("selectedPaymentMethod",{code:e.detail})}))),((s=n.selectedPaymentMethod)===null||s===void 0?void 0:s.code)==="001"&&t(a,{key:"068c2bd09ab8480ef571f5ca93773f25df9daac4"},t("div",{key:"d3f7e469e9828d306291865923d10c65c1e7685b",class:"form-group mt-md-1  p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"d88bf2272dc1adc73bad307e5c3f1f197221a255",class:"p-0 m-0 margin3"},u.entries.Lcz_CardNumber),t("div",{key:"540f03b5b07cbfbccde1e5c079c96715a8d1bd34",class:"p-0 m-0  controlContainer flex-fill"},t("input",{key:"b9b6b9a98a876dbf3020be5c4ff415343582bd26",class:"form-control",type:"text",placeholder:"",pattern:"0-9 ",id:I(),value:this.bookedByData.cardNumber,onInput:e=>this.handleNumberInput("cardNumber",e)}))),t("div",{key:"9aec0a57b38daebe4409b2a9d3713de6b084107f",class:"form-group  p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"5fd6661acc7878780e5be6e5bd67c3b25e032c3f",class:"p-0 m-0 margin3"},u.entries.Lcz_CardHolderName),t("div",{key:"f67184571842a01403b9770d7631594006bdf2a4",class:"p-0 m-0  controlContainer flex-fill"},t("input",{key:"fb7a68ea9169ee6b07e08820daa0f8dd5d596e96",class:"form-control",type:"text",placeholder:"",pattern:"0-9 ",id:I(),value:this.bookedByData.cardHolderName,onInput:e=>this.handleDataChange("cardHolderName",e)}))),t("div",{key:"61e2501a8a56a1911e037000a43f0d9669c541e4",class:"form-group  p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"ae0dfe05a7bc586c88fe3e9237fd1189b40ddf05",class:"p-0 m-0 margin3"},u.entries.Lcz_ExpiryDate),t("div",{key:"6d37faf88b7b8fdd341b13e943915b8322f88883",class:"p-0 m-0 row  controlContainer flex-fill"},t("div",{key:"e0f50583868af37eee0f42d5449b82d40ecc61dc",class:"p-0 m-0"},t("select",{key:"094131cf8c03677dffd30244d7bfeb55d3db535e",class:"form-control input-sm pr-0",id:I(),onChange:e=>this.handleDataChange("expiryMonth",e)},this.expiryMonths.map((e=>t("option",{value:e,selected:e===this.bookedByData.expiryMonth},e))))),t("div",{key:"a6e31e73b9f635cf06f31a6d8dcaa55ec605d681",class:"p-0 m-0 ml-1"},t("select",{key:"ffc59a4686fe9217cce6a6a683361610df854ee0",class:"form-control input-sm pr-0",id:I(),onChange:e=>this.handleDataChange("expiryYear",e)},this.expiryYears.map(((e,i)=>t("option",{value:e,selected:i===this.bookedByData.expiryYear},e)))))))),((o=n.selectedPaymentMethod)===null||o===void 0?void 0:o.code)==="005"&&t("div",{key:"f6c5889206b390582e70ca4e0f1cafeb2790d8f6",class:"form-group mt-md-1 mt-1 p-0 d-flex flex-column flex-md-row align-items-md-center"},t("label",{key:"8ea0962bef2549a1ad84920c8ff16dc43f92efb1",class:"p-0 m-0 margin3"}),t("div",{key:"bebddf090036dbe299f120a3525f145fcda40c3f",class:"p-0 m-0  controlContainer flex-fill"},t("div",{key:"aff3e5a27be155e9fda307f8a71b1da91d8cba1a",class:"property-booked-by__money-transfer-description",innerHTML:(c=(l=this.paymentMethods.find((e=>e.code==="005")))===null||l===void 0?void 0:l.localizables.find((e=>e.language.code.toLowerCase()==="en")))===null||c===void 0?void 0:c.description}))),t("div",{key:"4e6381af85d8cfef51ce3ee300f7c4964ad4ab45",class:"form-group mt-1 p-0 d-flex flex-row align-items-center"},t("label",{key:"83dd3c277d435b08caaa13a75c962519c8009732",class:"p-0 m-0",htmlFor:"emailTheGuestId"},u.entries.Lcz_EmailTheGuest),t("div",{key:"74000b233691bd2ff872b0036d202dc81c7231fe",class:"p-0 m-0  controlContainer flex-fill checkBoxContainer"},t("input",{key:"a6ddfca43c9a42572d8d5e8b77690a55c79b292e",class:"form-control",type:"checkbox",checked:this.bookedByData.emailGuest,id:"emailTheGuestId",onChange:e=>this.handleDataChange("emailGuest",e)})))))))}};me.style=ue;const ge=".sc-igl-room-type-h{display:block}.margin-bottom-8.sc-igl-room-type{margin-bottom:8px !important}";const ye=ge;const ve=class{constructor(t){e(this,t);this.dataUpdateEvent=s(this,"dataUpdateEvent",7);this.bookingType="PLUS_BOOKING";this.ratePricingMode=[];this.roomInfoId=null;this.selectedRooms=[];this.roomsDistributions=[];this.validBookingTypes=["PLUS_BOOKING","ADD_ROOM","EDIT_BOOKING","SPLIT_BOOKING"]}render(){var e,s;const a=this.validBookingTypes.includes(this.bookingType);return t(i,{key:"4a38bfe8ff3647405325f8f610f70d3c871ad93a"},a&&((e=this.roomType.rateplans)===null||e===void 0?void 0:e.length)>0&&t("div",{key:"7346c07f5f6db619489ea01a7e223c3b6666d0dc",class:"font-weight-bold font-medium-1 margin-bottom-8 "},this.roomType.name),(s=this.roomType.rateplans)===null||s===void 0?void 0:s.map((e=>{if(!!e.variations){let i=this.roomInfoId&&this.roomInfoId===this.roomType.id;const s=f(this.roomType.id,e.id);return t("igl-rate-plan",{isBookDisabled:this.isBookDisabled,visibleInventory:s,key:`rate-plan-${e.id}`,ratePricingMode:this.ratePricingMode,class:a?"":"",currency:this.currency,ratePlan:e,roomTypeId:this.roomType.id,bookingType:this.bookingType,shouldBeDisabled:i})}return null})))}};ve.style=ye;const ke=({message:e,href:i,class:s})=>t("div",{class:s},t("style",null,`.documentation-btn{\n          display:flex;\n          align-items:center;\n          justify-content:center;\n          height:1rem;\n          width:1rem;\n          border:1px solid #6b6f82;\n          color:#6b6f82;\n          padding:0.1rem;\n          border-radius:0.5rem;\n          background:transparent;\n        }\n        .documentation-btn:hover{\n          border-color:#104064;\n          background:transparent;\n          color:#104064 !important;\n        }`),t("ir-tooltip",{customSlot:true,message:e},t("a",{slot:"tooltip-trigger",class:"documentation-btn",target:"_blank",rel:"noopener",href:i,"aria-label":e},t("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 640 640"},t("path",{fill:"currentColor",d:"M224 224C224 171 267 128 320 128C373 128 416 171 416 224C416 266.7 388.1 302.9 349.5 315.4C321.1 324.6 288 350.7 288 392L288 416C288 433.7 302.3 448 320 448C337.7 448 352 433.7 352 416L352 392C352 390.3 352.6 387.9 355.5 384.7C358.5 381.4 363.4 378.2 369.2 376.3C433.5 355.6 480 295.3 480 224C480 135.6 408.4 64 320 64C231.6 64 160 135.6 160 224C160 241.7 174.3 256 192 256C209.7 256 224 241.7 224 224zM320 576C342.1 576 360 558.1 360 536C360 513.9 342.1 496 320 496C297.9 496 280 513.9 280 536C280 558.1 297.9 576 320 576z"})))));class _e{constructor(e){this.bookingService=e;this._booking=null}get booking(){return this._booking}set booking(e){this._booking=e}async fetchGroupedApplicablePolicies(e){if(!this._booking){throw new Error("Booking must be defined before fetching applicable policies.")}if(["003","004"].includes(this._booking.status.code)||!this._booking.is_direct){return}const{rooms:t,booking_nbr:i,currency:s,property:a}=this._booking;const o=this.groupRoomsForRequest(t!==null&&t!==void 0?t:[]);try{const n=[];o.forEach((o=>{const r={booking_nbr:i,currency_id:s.id,language:e.language,property_id:a.id,rate_plan_id:o.ratePlanId,room_type_id:o.roomTypeId,is_preserve_history:true};if(o.identifiers.length>1){o.identifiers.forEach((e=>{n.push(this.bookingService.getExposedApplicablePolicies(Object.assign(Object.assign({},r),{room_identifier:e})).then((i=>({grouping:Object.assign(Object.assign({},o),{rooms:t.filter((t=>t.identifier===e))}),policies:i}))))}))}else{n.push(this.bookingService.getExposedApplicablePolicies(r).then((e=>({grouping:o,policies:e}))))}}));const r=await Promise.all(n);const l=this.buildPoliciesByType(r);const c=this.buildCancellationStatements(r);const d=this.calculateGuaranteeAmount(r);return{policiesByType:l,cancellationStatements:c,guaranteeAmount:d}}catch(e){const t=e instanceof Error?e.message:String(e);throw new Error(`Failed to fetch applicable policies: ${t}`)}}groupRoomsForRequest(e){if(!e.length){throw new Error("Cannot request applicable policies without booking rooms.")}const t=new Map;e.forEach((e=>{var i,s;if(!((i=e.rateplan)===null||i===void 0?void 0:i.id)||!((s=e.roomtype)===null||s===void 0?void 0:s.id)){throw new Error("Room is missing rate plan or room type information.")}const a=`${e.roomtype.id}-${e.rateplan.id}`;const o=typeof e.identifier==="string"?e.identifier:null;if(!t.has(a)){t.set(a,{ratePlanId:e.rateplan.id,roomTypeId:e.roomtype.id,identifiers:o?[o]:[],rooms:[e]});return}const n=t.get(a);n.rooms.push(e);if(o&&!n.identifiers.includes(o)){n.identifiers.push(o)}}));return[...t.values()]}buildPoliciesByType(e){const t=e.flatMap((e=>{var t;return(t=e.policies)!==null&&t!==void 0?t:[]}));return this.groupPoliciesByType(t)}groupPoliciesByType(e){return e.reduce(((e,t)=>{e[t.type]=e[t.type]?[...e[t.type],t]:[t];return e}),{})}buildCancellationStatements(e){if(!this._booking){return[]}const t=[];e.forEach((({grouping:e,policies:i})=>{if(!(i===null||i===void 0?void 0:i.length)){return}const s=i.find((e=>e.type==="cancelation"));if(!s){return}e.rooms.forEach((e=>{const i=B(e.from_date,"YYYY-MM-DD",true);if(!i.isValid()){return}const a=s.brackets.filter((e=>{const t=B(e.due_on,"YYYY-MM-DD",true);return t.isValid()&&t.isBefore(i,"day")}));const o=a.some((e=>e.amount>0));let n;if(o){n=a.map(((e,t)=>{if(e.amount>0){return e}const i=a[t+1];if((i===null||i===void 0?void 0:i.amount)&&i.amount>0){return e}return undefined})).filter((e=>Boolean(e)))}else{n=[...a]}n=[...this.mergeBracketsByAmount(n)];if(!e.rateplan.is_non_refundable){const t=B(e.from_date,"YYYY-MM-DD",true);const i=B(e.to_date,"YYYY-MM-DD",true);const s=i.isValid()&&t.isValid()?i.diff(t,"days"):0;const a=s>1?t.clone().add(1,"day").format("YYYY-MM-DD"):t.format("YYYY-MM-DD");n.push({amount:e.total,amount_formatted:"",code:"",currency_id:this._booking.currency.id,due_on:a,due_on_formatted:"",gross_amount:e.gross_total,gross_amount_formatted:"",statement:"100% of total price"});n.sort(((e,t)=>{const i=B(e.due_on,"YYYY-MM-DD",true);const s=B(t.due_on,"YYYY-MM-DD",true);return i.valueOf()-s.valueOf()}))}t.push(Object.assign(Object.assign({},s),{brackets:n,roomType:e.roomtype,ratePlan:e.rateplan,checkInDate:e.from_date,grossTotal:e.gross_total}))}))}));return t}calculateGuaranteeAmount(e){return e.reduce(((e,{grouping:t,policies:i})=>{var s;if(!(i===null||i===void 0?void 0:i.length)){return e}const a=i.find((e=>e.type==="guarantee"));if(!a){return e}const o=this.selectCurrentBracket(a.brackets);if(!o){return e}const n=t.rooms.length*((s=o.gross_amount)!==null&&s!==void 0?s:0);return e+n}),0)}selectCurrentBracket(e){const t=B().startOf("day");for(const i of e){const e=B(i.due_on,"YYYY-MM-DD",true);if(!e.isValid()){continue}if(t.isSameOrAfter(e,"day")){return i}}return null}mergeBracketsByAmount(e){if(e.length<=1){return[...e]}return e.reduce(((e,t)=>{const i=e[e.length-1];if(!i||i.gross_amount!==t.gross_amount){e.push(t)}return e}),[])}}const xe=".sc-ir-applicable-policies-h{display:flex;flex-direction:column;gap:1rem}.applicable-policies__container.sc-ir-applicable-policies{display:flex;align-items:center;gap:1rem;flex-wrap:wrap;margin-bottom:1rem}.applicable-policies__title.sc-ir-applicable-policies{font-size:1rem;font-weight:700;padding:0;margin:0}.applicable-policies__no-penalty.sc-ir-applicable-policies{padding:0;margin:0;font-size:0.875rem}.applicable-policies__statements.sc-ir-applicable-policies{display:flex;flex-direction:column;gap:0.5rem;background:rgb(30, 159, 242, 5%);padding:0.5rem 1rem;border:1px solid rgba(30, 159, 242, 40%);border-radius:0.25rem;max-height:200px;overflow-y:auto}.applicable-policies__highlighted-bracket.sc-ir-applicable-policies{color:rgba(30, 159, 242, 100%)}.applicable-policies__statement.sc-ir-applicable-policies{display:flex;flex-direction:column;border-bottom:1px solid #e5e7eb;padding-bottom:0.5rem}.applicable-policies__statement.sc-ir-applicable-policies:last-child{border-bottom:0;padding-bottom:0}.applicable-policies__room.sc-ir-applicable-policies{padding:0;margin:0;padding-bottom:0.5rem}.applicable-policies__bracket.sc-ir-applicable-policies{display:grid;grid-template-columns:repeat(2, 1fr);gap:0.25rem;font-size:0.875rem;padding-bottom:0.5rem}.applicable-policies__bracket-dates.sc-ir-applicable-policies{display:flex;align-items:center;gap:0.5rem;padding:0;margin:0}.applicable-policies__amount.sc-ir-applicable-policies{text-align:right;padding:0;margin:0;font-weight:600}.applicable-policies__statement-text.sc-ir-applicable-policies{padding:0;margin:0}.applicable-policies__brackets-table.sc-ir-applicable-policies{display:none}.applicable-policies__guarantee.sc-ir-applicable-policies{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 1rem;border:1px solid rgba(255, 73, 97, 40%);border-radius:6px;background-color:rgba(255, 73, 97, 10%);margin-bottom:0.5rem;font-size:0.875rem}.applicable-policies__guarantee-info.sc-ir-applicable-policies{display:flex;align-items:center;gap:0.5rem}.applicable-policies__guarantee-date.sc-ir-applicable-policies{color:var(--text-muted, #666);padding:0;margin:0}.applicable-policies__guarantee-amount.sc-ir-applicable-policies{font-weight:600;color:var(--text-strong, #222);padding:0;margin:0}.applicable-policies__guarantee-label.sc-ir-applicable-policies{color:red;font-weight:700;padding:0;margin:0}.applicable-policies__guarantee-action.sc-ir-applicable-policies{width:fit-content}@media (min-width: 768px){.applicable-policies__brackets.sc-ir-applicable-policies{display:none}.applicable-policies__brackets-table.sc-ir-applicable-policies{display:block;width:100%;font-size:0.875rem}.applicable-policies__brackets-table.sc-ir-applicable-policies table.sc-ir-applicable-policies{width:100%}.applicable-policies__amount.sc-ir-applicable-policies,.applicable-policies__bracket-dates.sc-ir-applicable-policies{white-space:nowrap}.applicable-policies__statement-text.sc-ir-applicable-policies{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}";const we=xe;const De=class{constructor(t){e(this,t);this.generatePayment=s(this,"generatePayment",7);this.language="en";this.cancellationStatements=[];this.isLoading=false;this.shouldShowCancellationBrackets=true;this.applicablePoliciesService=new _e(new l)}componentWillLoad(){this.loadApplicablePolicies()}handleBookingChange(){this.loadApplicablePolicies()}async loadApplicablePolicies(){this.isLoading=true;try{this.applicablePoliciesService.booking=this.booking;const{cancellationStatements:e,guaranteeAmount:t}=await this.applicablePoliciesService.fetchGroupedApplicablePolicies({language:this.language});this.guaranteeAmount=t;this.cancellationStatements=[...e]}catch(e){console.error(e)}finally{this.isLoading=false}}formatPreviousBracketDueOn(e,t){if(e.isSame(t,"year")){return e.format("MMM DD")}return e.format("MMM DD, YYYY")}getBracketLabelsAndArrowState({bracket:e,index:t,brackets:i,checkInDate:s}){if(!e||!i||t<0||t>=i.length){return{leftLabel:null,rightLabel:null,showArrow:false}}const a=B(this.booking.booked_on.date,"YYYY-MM-DD");const o=B(e.due_on,"YYYY-MM-DD");if(!a.isValid()||!o.isValid()){console.warn("Invalid date encountered in getBracketLabelsAndArrowState");return{leftLabel:null,rightLabel:null,showArrow:false}}if(i.length===1){return this.handleSingleBracket(o,s)}const n=this.handleMultipleBrackets(e,t,i,s);return n}handleSingleBracket(e,t){const i=B(t,"YYYY-MM-DD");if(e.isSame(i,"days")){return{leftLabel:`${i.format("MMM DD")} onwards`,showArrow:false,rightLabel:""}}return{leftLabel:e.format("MMM DD"),showArrow:true,rightLabel:B(t,"YYYY-MM-DD").format("MMM DD, YYYY")}}handleMultipleBrackets(e,t,i,s){const a=B(e.due_on,"YYYY-MM-DD");const o=B(s,"YYYY-MM-DD");if(t===0){const s=i[t+1];if(!s){return{leftLabel:null,rightLabel:null,showArrow:false}}let a=B(s.due_on,"YYYY-MM-DD");if(!a.isValid()){return{leftLabel:null,rightLabel:null,showArrow:false}}if(e.amount===0){a=a.clone().add(-1,"days")}return{leftLabel:"Until",showArrow:false,rightLabel:a.isSame(o,"dates")?a.clone().add(-1,"days").format("MMM DD, YYYY"):a.format("MMM DD, YYYY")}}if(B(e.due_on,"YYYY-MM-DD").isSameOrAfter(o,"days")){return{leftLabel:`${o.format("MMM DD")} onwards`,showArrow:false,rightLabel:""}}if(t===i.length-1){return{leftLabel:a.clone().format("MMM DD"),showArrow:true,rightLabel:B(s).format("MMM DD, YYYY")}}const n=i[t+1];if(!n){return{leftLabel:null,rightLabel:null,showArrow:false}}const r=B(n.due_on,"YYYY-MM-DD");if(!r.isValid()){return{leftLabel:null,rightLabel:null,showArrow:false}}const l=r.isAfter(o,"days")?o:r.clone();const c=a.isSame(l.clone().add(-1,"days"),"days");return{leftLabel:this.formatPreviousBracketDueOn(a,l),showArrow:!c,rightLabel:c?"":l.add(-1,"days").format("MMM DD, YYYY")}}generateCancellationStatement(){const e="if cancelled today";const{cancelation_penality_as_if_today:t}=this.booking.financial;if(t===0){if(this.booking.financial.collected>0){return`No refund ${e}`}return`No payment required ${e}`}return`${t<0?"Refund":"Charge"} ${y(g.currency.symbol,Math.abs(t))} ${e}`}_getCurrentBracket(e){if(!Array.isArray(e)||e.length===0)return null;const t=B().startOf("day");const i=e.map((e=>({b:e,date:B(e.due_on,"YYYY-MM-DD",true).startOf("day")}))).filter((e=>e.date.isValid())).sort(((e,t)=>e.date.valueOf()-t.date.valueOf()));if(i.length===0)return null;if(t.isBefore(i[0].date,"day")){return i[0].date}for(let e=0;e<i.length-1;e++){const s=i[e].date;const a=i[e+1].date;if(t.isSameOrAfter(s,"day")&&t.isBefore(a,"day")){return s}}return i[i.length-1].date}render(){var e,s;if(this.isLoading){return null}const a=this.booking.financial.collected-this.guaranteeAmount;return t(i,null,this.guaranteeAmount!==0&&t("section",null,t("div",{class:"applicable-policies__guarantee"},t("div",{class:"applicable-policies__guarantee-info"},t("p",{class:"applicable-policies__guarantee-date"},B(this.booking.booked_on.date,"YYYY-MM-DD").format("MMM DD, YYYY")),t("p",{class:"applicable-policies__guarantee-amount"},t("span",{class:"px-1"},y(g.currency.symbol,a<0?Math.abs(a):this.guaranteeAmount))),t("p",{class:"applicable-policies__guarantee-label"},"Guarantee ",a<0?"balance":"")),a<0&&t("div",{class:"applicable-policies__guarantee-action"},t("ir-button",{btn_color:"dark",text:"Pay",size:"sm",onClickHandler:()=>{this.generatePayment.emit({amount:Math.abs(a),currency:g.currency,due_on:B().format("YYYY-MM-DD"),pay_type_code:null,reason:"",type:"OVERDUE"})}})))),t("section",null,t("div",{class:"applicable-policies__container"},t("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},t("p",{class:"applicable-policies__title font-size-large p-0 m-0"},"Cancellation Schedule"),t(ke,{message:"Help",href:"https://help.igloorooms.com/extranet/booking-details/guarantee-and-cancellation"})),t("p",{class:"applicable-policies__no-penalty"},this.generateCancellationStatement())),((e=this.cancellationStatements)===null||e===void 0?void 0:e.length)>0&&this.cancellationStatements.every((e=>e.brackets.length>0))&&this.shouldShowCancellationBrackets&&t("div",{class:"applicable-policies__statements"},(s=this.cancellationStatements)===null||s===void 0?void 0:s.map((e=>{const i=this._getCurrentBracket(e.brackets);return t("div",{class:"applicable-policies__statement"},this.cancellationStatements.length>1&&t("p",{class:"applicable-policies__room"},t("b",null,e.roomType.name)," ",e.ratePlan["short_name"]," ",e.ratePlan.is_non_refundable?` - ${u.entries.Lcz_NonRefundable}`:""),t("div",{class:"applicable-policies__brackets"},e.brackets.map(((s,a)=>{const{leftLabel:o,rightLabel:n,showArrow:r}=this.getBracketLabelsAndArrowState({index:a,bracket:s,brackets:e.brackets,checkInDate:e.checkInDate});const l=B(s.due_on,"YYYY-MM-DD").isSame(i,"date");return t("div",{class:{"applicable-policies__bracket":true,"applicable-policies__highlighted-bracket":l}},t("p",{class:"applicable-policies__bracket-dates"},o," ",r&&t("ir-icons",{name:"arrow_right",class:"applicable-policies__icon",style:{"--icon-size":"0.875rem"}})," ",n),t("p",{class:"applicable-policies__amount"},y(g.currency.symbol,s.gross_amount)),t("p",{class:"applicable-policies__statement-text"},s.amount===0?"No penalty":s.statement))}))),t("div",{class:"applicable-policies__brackets-table"},t("table",null,t("tbody",null,e.brackets.map(((s,a)=>{const{leftLabel:o,rightLabel:n,showArrow:r}=this.getBracketLabelsAndArrowState({index:a,bracket:s,brackets:e.brackets,checkInDate:e.checkInDate});const l=B(s.due_on,"YYYY-MM-DD").isSame(i,"date");return t("tr",{class:{"applicable-policies__highlighted-bracket":l}},t("td",{class:"applicable-policies__bracket-dates"},o," ",r&&t("ir-icons",{name:"arrow_right",class:"applicable-policies__icon",style:{"--icon-size":"0.875rem"}})," ",n),t("td",{class:"applicable-policies__amount px-1"},y(g.currency.symbol,s.gross_amount)),t("td",{class:"applicable-policies__statement-text"},s.amount===0?"No penalty":s.statement))}))))))})))))}static get watchers(){return{booking:["handleBookingChange"]}}};De.style=we;const Oe=".sc-ir-booking-details-h{overflow-x:hidden;--ir-dialog-max-width:20rem;font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-booking-details-h *.sc-ir-booking-details{font-family:inherit !important;font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.font-medium.sc-ir-booking-details{font-weight:600}.sc-ir-booking-details-h th.sc-ir-booking-details{font-weight:600}.card.room-group.sc-ir-booking-details{margin-bottom:1rem !important}.card.room-group.sc-ir-booking-details:last-child{margin-bottom:1.81rem !important}.h-28.sc-ir-booking-details{height:2rem}.mx-01.sc-ir-booking-details{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}.date-margin.sc-ir-booking-details{margin-right:5px}.pickup-margin.sc-ir-booking-details{margin-bottom:7px !important}.header-date.sc-ir-booking-details{padding-left:5px !important}.pointer.sc-ir-booking-details{cursor:pointer}.sc-ir-booking-details:root{--sidebar-width:50rem}.loading-container.sc-ir-booking-details{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.sm-padding-right.sc-ir-booking-details{padding-right:0.2rem}.sm-padding-left.sc-ir-booking-details{padding-left:0.2rem}.sm-padding-top.sc-ir-booking-details{padding-top:0.2rem}.sm-padding-bottom.sc-ir-booking-details{padding-bottom:0.2rem}.info-notes.sc-ir-booking-details{list-style:none;padding-left:0}.light-blue-bg.sc-ir-booking-details{background-color:#acecff;padding:0.2rem 0.3rem}.iframeHeight.sc-ir-booking-details{height:17.5rem}.dialog-title.sc-ir-booking-details{width:fit-content}";const Ce=Oe;const Ye=class{constructor(t){e(this,t);this.toast=s(this,"toast",7);this.bookingChanged=s(this,"bookingChanged",7);this.closeSidebar=s(this,"closeSidebar",7);this.language="en";this.ticket="";this.bookingNumber="";this.is_from_front_desk=false;this.hasPrint=false;this.hasReceipt=false;this.hasDelete=false;this.hasMenu=false;this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.hasCloseButton=false;this.bookingItem=null;this.statusData=[];this.calendarData={};this.guestData=null;this.rerenderFlag=false;this.sidebarState=null;this.isUpdateClicked=false;this.isPMSLogLoading=false;this.modalState=null;this.bookingService=new l;this.roomService=new N;this.paymentService=new L;this.token=new R;this.printingBaseUrl="https://gateway.igloorooms.com/PrintBooking/%1/printing?id=%2";this.handleDeleteFinish=e=>{this.booking=Object.assign(Object.assign({},this.booking),{rooms:this.booking.rooms.filter((t=>t.identifier!==e.detail))});this.splitIndex=D(this.booking.rooms)}}componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}ticketChanged(e,t){if(e===t){return}this.token.setToken(this.ticket);this.initializeApp()}handleSideBarEvents(e){this.sidebarState=e.detail.type;this.sidebarPayload=e.detail.payload}handleIconClick(e){const t=e.target;switch(t.id){case"pickup":this.sidebarState="pickup";return;case"close":this.closeSidebar.emit(null);return;case"email":this.modalState={type:"email",message:u.entries.Lcz_EmailBookingto.replace("%1",this.booking.guest.email),loading:T("/Send_Booking_Confirmation_Email")};this.modalRef.openModal();return;case"print":this.openPrintingScreen();return;case"receipt":this.openPrintingScreen("invoice");return;case"book-delete":return;case"menu":window.location.href="https://x.igloorooms.com/manage/acbookinglist.aspx";return;case"room-add":this.bookingItem={ID:"",NAME:this.booking.guest.last_name,EMAIL:this.booking.guest.email,PHONE:this.booking.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.booking.from_date,ARRIVAL:this.booking.arrival,TO_DATE:this.booking.to_date,TITLE:`${u.entries.Lcz_AddingUnitToBooking}# ${this.booking.booking_nbr}`,defaultDateRange:{fromDate:new Date(this.booking.from_date),fromDateStr:"",toDate:new Date(this.booking.to_date),toDateStr:"",dateDifference:0,message:""},event_type:"ADD_ROOM",booking:this.booking,BOOKING_NUMBER:this.booking.booking_nbr,ADD_ROOM_TO_BOOKING:this.booking.booking_nbr,GUEST:this.booking.guest,message:this.booking.remark,SOURCE:this.booking.source,ROOMS:this.booking.rooms};return;case"extra_service_btn":this.sidebarState="extra_service";return;case"add-payment":return}}async handleResetExposedCancellationDueAmount(e){e.stopImmediatePropagation();e.stopPropagation();const t=await this.paymentService.GetExposedCancellationDueAmount({booking_nbr:this.booking.booking_nbr,currency_id:this.booking.currency.id});this.paymentActions=[...t]}handleEditInitiated(e){this.bookingItem=e.detail}handleRoomGuestsUpdate(e){const{identifier:t,guests:i}=e.detail;const s=[...this.booking.rooms];let a=s.findIndex((e=>e.identifier===t));if(a===-1){return}const o=s[a];const n=Object.assign(Object.assign({},o),{sharing_persons:i});s[a]=n;this.booking=Object.assign(Object.assign({},this.booking),{rooms:[...s]});this.splitIndex=D(this.booking.rooms)}async handleResetBooking(e){if(e.detail){this.booking=e.detail;this.splitIndex=D(this.booking.rooms);return}await this.resetBooking()}handleEditExtraService(e){this.selectedService=e.detail;this.sidebarState="extra_service"}setRoomsData(e){var t,i;let s=new Array;if((i=(t=e.My_Result)===null||t===void 0?void 0:t.roomtypes)===null||i===void 0?void 0:i.length){s=e.My_Result.roomtypes;e.My_Result.roomtypes.forEach((e=>{e.expanded=true}))}this.calendarData.roomsInfo=s}async initializeApp(){var e;try{const[t,i,s,a,o]=await Promise.all([this.roomService.getExposedProperty({id:this.propertyid||0,language:this.language,aname:this.p}),this.roomService.fetchLanguage(this.language),this.bookingService.getCountries(this.language),this.bookingService.getExposedBooking(this.bookingNumber,this.language),this.bookingService.getSetupEntriesByTableNameMulti(["_BED_PREFERENCE_TYPE","_DEPARTURE_TIME","_PAY_TYPE","_PAY_TYPE_GROUP","_PAY_METHOD"])]);this.property_id=(e=t===null||t===void 0?void 0:t.My_Result)===null||e===void 0?void 0:e.id;const{bed_preference_type:n,departure_time:r,pay_type:l,pay_type_group:c,pay_method:d}=this.bookingService.groupEntryTablesResult(o);this.bedPreference=n;this.departureTime=r;this.paymentEntries={types:l,groups:c,methods:d};if(!(u===null||u===void 0?void 0:u.entries)){u.entries=i.entries;u.direction=i.direction}this.countries=s;const h=t===null||t===void 0?void 0:t.My_Result;if(h){const{allowed_payment_methods:e,currency:i,allowed_booking_sources:s,adult_child_constraints:a,calendar_legends:o,aname:n}=h;this.printingBaseUrl=this.printingBaseUrl.replace("%1",n).replace("%2",this.bookingNumber);this.calendarData={currency:i,allowed_booking_sources:s,adult_child_constraints:a,legendData:o};this.setRoomsData(t);const r=["001","004"];this.showPaymentDetails=e===null||e===void 0?void 0:e.some((e=>r.includes(e.code)))}else{console.warn("Room response is missing 'My_Result'.")}this.guestData=a.guest;this.booking=a;this.splitIndex=D(this.booking.rooms)}catch(e){console.error("Error initializing app:",e)}}async openPrintingScreen(e="print",t="new"){if(t==="old"){if(e==="invoice"){return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.booking.system_id}&&PM=I&TK=${this.ticket}`)}return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${this.booking.system_id}&&PM=B&TK=${this.ticket}`)}let i=this.printingBaseUrl;if(e==="invoice"){i=i+"&mode=invoice"}const{data:s}=await A.post(`Get_ShortLiving_Token`);if(!s.ExceptionMsg){i=i+`&token=${s.My_Result}`}window.open(i)}handleCloseBookingWindow(){this.bookingItem=null}async resetBooking(){try{const e=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);this.booking=Object.assign({},e);this.splitIndex=D(this.booking.rooms);this.bookingChanged.emit(this.booking)}catch(e){console.log(e)}}async handleModalConfirm(e){e.stopImmediatePropagation();e.stopPropagation();switch(this.modalState.type){case"email":await this.bookingService.sendBookingConfirmationEmail(this.booking.booking_nbr,this.language);break}this.modalState=null;this.modalRef.closeModal()}renderSidebarContent(){var e,i,s,a,o,n;const r=()=>{this.sidebarState=null};switch(this.sidebarState){case"guest":return t("ir-guest-info",{isInSideBar:true,headerShown:true,slot:"sidebar-body",booking_nbr:this.bookingNumber,email:(e=this.booking)===null||e===void 0?void 0:e.guest.email,language:this.language,onCloseSideBar:r});case"pickup":return t("ir-pickup",{bookingDates:{from:this.booking.from_date,to:this.booking.to_date},slot:"sidebar-body",defaultPickupData:this.booking.pickup_info,bookingNumber:this.booking.booking_nbr,numberOfPersons:this.booking.occupancy.adult_nbr+this.booking.occupancy.children_nbr,onCloseModal:r});case"extra_note":return t("ir-booking-extra-note",{slot:"sidebar-body",booking:this.booking,onCloseModal:()=>this.sidebarState=null});case"extra_service":return t("ir-extra-service-config",{service:this.selectedService,booking:{from_date:this.booking.from_date,to_date:this.booking.to_date,booking_nbr:this.booking.booking_nbr,currency:this.booking.currency},slot:"sidebar-body",onCloseModal:()=>{r();if(this.selectedService){this.selectedService=null}}});case"room-guest":return t("ir-room-guests",{countries:this.countries,language:this.language,identifier:(i=this.sidebarPayload)===null||i===void 0?void 0:i.identifier,bookingNumber:this.booking.booking_nbr,roomName:(s=this.sidebarPayload)===null||s===void 0?void 0:s.roomName,totalGuests:(a=this.sidebarPayload)===null||a===void 0?void 0:a.totalGuests,sharedPersons:(o=this.sidebarPayload)===null||o===void 0?void 0:o.sharing_persons,slot:"sidebar-body",checkIn:(n=this.sidebarPayload)===null||n===void 0?void 0:n.checkin,onCloseModal:r});case"payment-folio":return t("ir-payment-folio",{bookingNumber:this.booking.booking_nbr,paymentEntries:this.paymentEntries,slot:"sidebar-body",payment:this.sidebarPayload.payment,mode:this.sidebarPayload.mode,onCloseModal:r});default:return null}}computeRoomGroups(e){var t,i,s;const a=new Map;e.forEach(((e,t)=>a.set(e.identifier,t)));if(!e.length){return{groups:[],indexById:a,hasSplitGroups:false}}const o=e=>{var t;let i=Number.MAX_SAFE_INTEGER;for(const s of e){const e=Date.parse((t=s===null||s===void 0?void 0:s.from_date)!==null&&t!==void 0?t:"");if(!Number.isNaN(e)){i=Math.min(i,e)}}return i};const n=(t=this.splitIndex)!==null&&t!==void 0?t:D(e);if(!n){const t=[...e].sort(((e,t)=>{var i,s,o,n;const r=Date.parse((i=e===null||e===void 0?void 0:e.from_date)!==null&&i!==void 0?i:"")-Date.parse((s=t===null||t===void 0?void 0:t.from_date)!==null&&s!==void 0?s:"");if(!Number.isNaN(r)&&r!==0){return r}return((o=a.get(e.identifier))!==null&&o!==void 0?o:0)-((n=a.get(t.identifier))!==null&&n!==void 0?n:0)}));return{groups:[{rooms:t,order:0,isSplit:false,sortKey:o(t)}],indexById:a,hasSplitGroups:false}}const r=new Map(e.map((e=>[e.identifier,e])));const l=[];const c=new Set;for(const e of n.heads){const t=(i=n.chainOf.get(e))!==null&&i!==void 0?i:[e];const s=t.map((e=>r.get(e))).filter((e=>Boolean(e)));if(!s.length)continue;const d=t.some((e=>{var t;const i=n.parentOf.get(e);const s=(t=n.childrenOf.get(e))!==null&&t!==void 0?t:[];return Boolean(i)||s.length>0}))||s.some((e=>Boolean(e===null||e===void 0?void 0:e.is_split)));if(d){s.forEach((e=>c.add(e.identifier)));const e=Math.min(...s.map((e=>{var t;return(t=a.get(e.identifier))!==null&&t!==void 0?t:Number.MAX_SAFE_INTEGER})));l.push({rooms:s,order:e,sortKey:o(s),isSplit:true})}}for(const t of e){if(!c.has(t.identifier)){const e=(s=a.get(t.identifier))!==null&&s!==void 0?s:Number.MAX_SAFE_INTEGER;const i=[t];l.push({rooms:i,order:e,sortKey:o(i),isSplit:false})}}l.sort(((e,t)=>{if(e.sortKey!==t.sortKey){return e.sortKey-t.sortKey}return e.order-t.order}));const d=l.some((e=>e.isSplit));if(!d){const e=l.map((e=>e.rooms)).reduce(((e,t)=>e.concat(t)),[]).sort(((e,t)=>{var i,s,o,n;const r=Date.parse((i=e===null||e===void 0?void 0:e.from_date)!==null&&i!==void 0?i:"")-Date.parse((s=t===null||t===void 0?void 0:t.from_date)!==null&&s!==void 0?s:"");if(!Number.isNaN(r)&&r!==0){return r}return((o=a.get(e.identifier))!==null&&o!==void 0?o:0)-((n=a.get(t.identifier))!==null&&n!==void 0?n:0)}));return{groups:[{rooms:e,order:0,sortKey:o(e),isSplit:false}],indexById:a,hasSplitGroups:false}}return{groups:l,indexById:a,hasSplitGroups:true}}renderRoomItem(e,i,s=true){const a=this.handleRoomCheckin(e);const o=this.handleRoomCheckout(e);return t("ir-room",{key:e.identifier,room:e,property_id:this.property_id,language:this.language,departureTime:this.departureTime,bedPreferences:this.bedPreference,isEditable:this.booking.is_editable,legendData:this.calendarData.legendData,roomsInfo:this.calendarData.roomsInfo,myRoomTypeFoodCat:e.roomtype.name,mealCodeName:e.rateplan.short_name,includeDepartureTime:s,currency:this.booking.currency.symbol,hasRoomEdit:this.hasRoomEdit&&this.booking.status.code!=="003"&&this.booking.is_direct,hasRoomDelete:this.hasRoomDelete&&this.booking.status.code!=="003"&&this.booking.is_direct,hasCheckIn:a,hasCheckOut:o,booking:this.booking,bookingIndex:i,onDeleteFinished:this.handleDeleteFinish})}renderRooms(){var e,i;const s=(i=(e=this.booking)===null||e===void 0?void 0:e.rooms)!==null&&i!==void 0?i:[];if(!s.length){return null}const{groups:o,indexById:n,hasSplitGroups:r}=this.computeRoomGroups(s);if(!r){const e=o[0].rooms;return t("div",{class:"card p-0 mx-0"},e.map(((i,s)=>{var o;return t(a,null,this.renderRoomItem(i,(o=n.get(i.identifier))!==null&&o!==void 0?o:s),s<e.length-1?t("hr",{class:"mr-2 ml-2 my-0 p-0"}):null)})))}return t(a,null,o.map(((e,i)=>{const s=i===o.length-1;return t("div",{class:`card p-0 mx-0 ${s?"":"room-group"}`,key:`room-group-${e.order}-${i}`},e.rooms.map(((i,s)=>{var o;return t(a,null,this.renderRoomItem(i,(o=n.get(i.identifier))!==null&&o!==void 0?o:s,s===e.rooms.length-1),s<e.rooms.length-1?t("hr",{class:"mr-2 ml-2 my-0 p-0"}):null)})))})))}render(){var e,i,s;if(!this.booking){return t("div",{class:"loading-container"},t("ir-spinner",null))}const o=this.renderRooms();return[t(a,null,!this.is_from_front_desk&&t(a,null,t("ir-toast",null),t("ir-interceptor",null))),t("ir-booking-header",{booking:this.booking,hasCloseButton:this.hasCloseButton,hasDelete:this.hasDelete,hasMenu:this.hasMenu,hasPrint:this.hasPrint,hasReceipt:this.hasReceipt,hasEmail:["001","002"].includes((i=(e=this.booking)===null||e===void 0?void 0:e.status)===null||i===void 0?void 0:i.code)}),t("div",{class:"fluid-container p-1 text-left mx-0"},t("div",{class:"row m-0"},t("div",{class:"col-12 p-0 mx-0 pr-lg-1 col-lg-6"},t("ir-reservation-information",{countries:this.countries,booking:this.booking}),t("div",{class:"font-size-large d-flex justify-content-between align-items-center mb-1"},t("ir-date-view",{from_date:this.booking.from_date,to_date:this.booking.to_date}),this.hasRoomAdd&&this.booking.is_editable&&t("ir-button",{id:"room-add",icon_name:"square_plus",variant:"icon",style:{"--icon-size":"1.5rem"}})),o,t("ir-pickup-view",{booking:this.booking}),t("section",null,t("div",{class:"font-size-large d-flex justify-content-between align-items-center mb-1"},t("p",{class:"font-size-large p-0 m-0 "},u.entries.Lcz_ExtraServices),t("ir-button",{id:"extra_service_btn",icon_name:"square_plus",variant:"icon",style:{"--icon-size":"1.5rem"}})),t("ir-extra-services",{booking:{booking_nbr:this.booking.booking_nbr,currency:this.booking.currency,extra_services:this.booking.extra_services}}))),t("div",{class:"col-12 p-0 m-0 pl-lg-1 col-lg-6"},t("ir-payment-details",{propertyId:this.property_id,paymentEntries:this.paymentEntries,paymentActions:this.paymentActions,booking:this.booking})))),t("ir-modal",{modalBody:(s=this.modalState)===null||s===void 0?void 0:s.message,leftBtnText:u.entries.Lcz_Cancel,rightBtnText:u.entries.Lcz_Confirm,autoClose:false,isLoading:T("/Send_Booking_Confirmation_Email"),ref:e=>this.modalRef=e,onConfirmModal:e=>{this.handleModalConfirm(e)},onCancelModal:()=>{this.modalRef.closeModal()}}),t("ir-sidebar",{open:this.sidebarState!==null&&this.sidebarState!=="payment-folio",side:"right",id:"editGuestInfo",style:{"--sidebar-width":this.sidebarState==="room-guest"?"60rem":undefined},onIrSidebarToggle:e=>{e.stopImmediatePropagation();e.stopPropagation();this.sidebarState=null},showCloseButton:false},this.renderSidebarContent()),t("ir-sidebar",{open:this.sidebarState==="payment-folio",side:"left",id:"folioSidebar",onIrSidebarToggle:e=>{e.stopImmediatePropagation();e.stopPropagation();this.sidebarState=null},showCloseButton:false},this.renderSidebarContent()),t(a,null,this.bookingItem&&t("igl-book-property",{allowedBookingSources:this.calendarData.allowed_booking_sources,adultChildConstraints:this.calendarData.adult_child_constraints,showPaymentDetails:this.showPaymentDetails,countries:this.countries,currency:this.calendarData.currency,language:this.language,propertyid:this.property_id,bookingData:this.bookingItem,onCloseBookingWindow:()=>this.handleCloseBookingWindow()}))]}handleRoomCheckout(e){if(!g.checkin_enabled||g.is_automatic_check_in_out){return false}return e.in_out.code==="001"}handleRoomCheckin(e){if(!g.checkin_enabled||g.is_automatic_check_in_out){return false}if(!e.unit){return false}if(e.in_out&&e.in_out.code!=="000"){return false}if(B().isSameOrAfter(B(e.from_date,"YYYY-MM-DD"),"days")&&B().isBefore(B(e.to_date,"YYYY-MM-DD"),"days")){return true}return false}get element(){return o(this)}static get watchers(){return{ticket:["ticketChanged"]}}};Ye.style=Ce;const Me=".sc-ir-booking-extra-note-h{display:block}";const Ie=Me;const Be=".sc-ir-booking-extra-note-h{height:100%}.sheet-container.sc-ir-booking-extra-note{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-booking-extra-note{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-booking-extra-note{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-booking-extra-note{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-booking-extra-note{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-booking-extra-note{flex-direction:row;align-items:center}}";const Te=Be;const Ee=class{constructor(t){e(this,t);this.closeModal=s(this,"closeModal",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.isLoading=false;this.note="";this.bookingService=new l}componentWillLoad(){if(this.booking.extras){this.setNote(O(this.booking.extras))}}setNote(e){this.note=e}async savePrivateNote(){try{this.isLoading=true;let e=this.booking.extras||[];const t={key:"private_note",value:this.note};if(e.length===0){e.push(t)}else{const i=e.findIndex((e=>e.key==="private_note"));if(i===-1){e.push(t)}else{e[i]=t}}const i=await this.bookingService.doReservation({assign_units:true,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,booking:this.booking,Is_Non_Technical_Change:true,extras:e});this.resetBookingEvt.emit(i);this.closeModal.emit(null)}catch(e){console.error(e)}finally{this.isLoading=false}}render(){return t("form",{key:"e5d07af961e7d40c960561f9d85e3c492f1d0a4e",class:"sheet-container h-100",onSubmit:e=>{e.preventDefault();this.savePrivateNote()}},t("ir-title",{key:"0da0c91aee955e00ccb9ea8a49510afca92de0ee",class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:u.entries.Lcz_PrivateNote,displayContext:"sidebar"}),t("div",{key:"aecdcdcc14a75d4bb4c30212d854a55b1227acfc",class:"sheet-body px-1"},t("ir-textarea",{key:"6fd973ea31167d9a1ced6b2aa5a7cef5dd636c71",placeholder:u.entries.Lcz_PrivateNote_MaxChar,label:"",value:this.note,maxLength:150,onTextChange:e=>this.setNote(e.detail)})),t("div",{key:"2c98aa894a463d7d77a77f25756427354dbfe3f4",class:"sheet-footer"},t("ir-button",{key:"b35a85d27074d220ab7c21655e6481ace9010d62",onClickHandler:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`mb-1 mb-sm-0 flex-fill  mr-sm-1'}`,text:u.entries.Lcz_Cancel,btn_color:"secondary"}),t("ir-button",{key:"a84babb21e83c33f95b04362dedf23084b26809d",btn_styles:"justify-content-center align-items-center",class:"m-0 flex-fill text-center ml-sm-1",isLoading:this.isLoading,text:u.entries.Lcz_Save,btn_color:"primary",btn_type:"submit"})))}};Ee.style=Ie+Te;const Se=".sc-ir-booking-guarantee-h{display:block}.sc-ir-booking-guarantee-h{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-booking-guarantee-h *.sc-ir-booking-guarantee{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.iframeHeight.sc-ir-booking-guarantee{height:max-content;height:22.5rem}";const je=Se;const Ae=class{constructor(t){e(this,t);this.collapsed=false;this.paymentDetailsUrl="";this.paymentExceptionMessage=""}async componentWillLoad(){}formatCurrency(e,t,i="en-US"){if(!t||e<0){return""}return new Intl.NumberFormat(i,{style:"currency",currency:t,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}checkPaymentCode(e){var t,i,s;return(s=(i=(t=g.allowed_payment_methods)===null||t===void 0?void 0:t.find((t=>t.code===e)))===null||i===void 0?void 0:i.description)!==null&&s!==void 0?s:null}getPaymentMethod(){var e,t,i,s;let a=null;const o=(t=(e=this.booking)===null||e===void 0?void 0:e.extras)===null||t===void 0?void 0:t.find((e=>e.key==="payment_code"));if(this.booking.agent){const e=(s=(i=this.booking)===null||i===void 0?void 0:i.extras)===null||s===void 0?void 0:s.find((e=>e.key==="agent_payment_mode"));if(e){a=e.value==="001"?u.entries.Lcz_OnCredit:o?this.checkPaymentCode(o.value):null}}else if(o){a=o.value==="000"?"No card info required upon booking":this.checkPaymentCode(o.value)}return a}async handleToggleCollapse(){if(!this.booking.is_direct&&this.booking.channel_booking_nbr&&!this.booking.guest.cci&&!this.collapsed){this.paymentDetailsUrl=await this.bookingService.getPCICardInfoURL(this.booking.booking_nbr)}this.collapsed=!this.collapsed}shouldShowGuarantee(){const e=this.booking.is_direct?this.getPaymentMethod():null;return this.booking.is_direct?Boolean(e||this.booking.guest.cci):true}shouldShowToggleButton(){return!this.booking.is_direct||this.booking.is_direct&&this.booking.guest.cci}renderCreditCardInfo(){const{cci:e}=this.booking.guest;if(!e)return null;return[t("div",null,e&&"Card:"," ",t("span",null,e.nbr||""),e.expiry_month&&" Expiry: ",t("span",null,e.expiry_month||"",e.expiry_year&&"/"+e.expiry_year)),t("div",null,e.holder_name&&"Name:"," ",t("span",null,e.holder_name||""),e.cvc&&" - CVC:"," ",t("span",null,e.cvc||""))]}renderCollapsedContent(){if(this.booking.guest.cci){return this.renderCreditCardInfo()}if(this.paymentDetailsUrl){return t("iframe",{src:this.paymentDetailsUrl,width:"100%",class:"iframeHeight",frameborder:"0",name:"payment"})}return t("div",{class:"text-center"},this.paymentExceptionMessage)}renderOtaGuarantee(){var e,i,s;const{ota_guarante:a}=this.booking;if(!a||this.booking.is_direct)return null;return t("div",null,t("ir-label",{content:a.card_type+`${a.is_virtual?" (virtual)":""}`,labelText:`${u.entries.Lcz_CardType}:`}),t("ir-label",{content:a.cardholder_name,labelText:`${u.entries.Lcz_CardHolderName}:`}),t("ir-label",{content:a.card_number,labelText:`${u.entries.Lcz_CardNumber}:`}),t("ir-label",{content:this.formatCurrency(C(Number((e=a.meta)===null||e===void 0?void 0:e.virtual_card_current_balance),Number((i=a.meta)===null||i===void 0?void 0:i.virtual_card_decimal_places)),(s=a.meta)===null||s===void 0?void 0:s.virtual_card_currency_code),labelText:`${u.entries.Lcz_CardBalance}:`}))}render(){if(!this.shouldShowGuarantee()){return null}const e=this.booking.is_direct?this.getPaymentMethod():null;return t("div",{class:"mb-1"},t("div",{class:"d-flex align-items-center"},t("span",{class:"mr-1 font-medium"},u.entries.Lcz_BookingGuarantee,e&&t("span",null,": ",e)),this.shouldShowToggleButton()&&t("ir-button",{id:"drawer-icon","data-toggle":"collapse","data-target":".guarrantee","aria-expanded":this.collapsed?"true":"false","aria-controls":"myCollapse",class:"sm-padding-right pointer",variant:"icon",icon_name:"credit_card",onClickHandler:this.handleToggleCollapse.bind(this)})),t("div",{class:"collapse guarrantee"},this.renderCollapsedContent()),this.renderOtaGuarantee())}};Ae.style=je;const Ne=".sc-ir-booking-header-h{display:block}.confirmed.sc-ir-booking-header{color:#fff;display:flex;align-items:center}.bg-ir-green.sc-ir-booking-header{background:#629a4c;padding:0.2rem 0.3rem}.bg-ir-red.sc-ir-booking-header{background:#ff4961;padding:0.2rem 0.3rem}.bg-ir-orange.sc-ir-booking-header{background:#ff9149;padding:0.2rem 0.3rem}";const Le=Ne;const Re=class{constructor(t){e(this,t);this.toast=s(this,"toast",7);this.closeSidebar=s(this,"closeSidebar",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.openSidebar=s(this,"openSidebar",7);this.hasEmail=true;this.bookingStatus=null;this.confirmationBG={"001":"bg-ir-orange","002":"bg-ir-green","003":"bg-ir-red","004":"bg-ir-red"};this.bookingService=new l;this.alertMessage=`ALERT! Modifying an OTA booking will create a discrepancy between igloorooms and the source. Future guest modifications on the OTA may require manual adjustmentsofthebooking.`}handleSelectChange(e){e.stopPropagation();e.stopImmediatePropagation();const t=e.target;this.bookingStatus=t.selectedValue}async updateStatus(){if(!this.bookingStatus||this.bookingStatus==="-1"){this.toast.emit({type:"error",description:"",title:u.entries.Lcz_SelectStatus,position:"top-right"});return}try{await this.bookingService.changeExposedBookingStatus({book_nbr:this.booking.booking_nbr,status:this.bookingStatus});this.toast.emit({type:"success",description:"",title:u.entries.Lcz_StatusUpdatedSuccessfully,position:"top-right"});this.bookingStatus=null;this.resetBookingEvt.emit(null)}catch(e){console.log(e)}}openDialog(e){const{type:t}=e;this.currentDialogStatus=t;this.dialogRef.openModal()}renderDialogBody(){switch(this.currentDialogStatus){case"pms":return t("ir-pms-logs",{slot:"modal-body",bookingNumber:this.booking.booking_nbr});case"events-log":return t("ir-events-log",{booking:this.booking,slot:"modal-body",bookingNumber:this.booking.booking_nbr})}}render(){var e,i;const s=this.booking.ota_manipulations?this.booking.ota_manipulations[this.booking.ota_manipulations.length-1]:null;return t("div",{key:"a4028447a7f37539349ddd265b8193092294bf21",class:"fluid-container px-1"},t("div",{key:"fd61e65819d19ef113a38ef3ea7cf2a006af5e1c",class:"d-flex flex-column p-0 mx-0 flex-lg-row align-items-md-center justify-content-between mt-1"},t("div",{key:"feb9e31fa20741b45f230159f4d23c34d8313504",class:"m-0 p-0 mb-1 mb-lg-0 mt-md-0"},t("p",{key:"65cefb131403caf3ab516ac8d78b6facf315a6a0",class:"font-size-large m-0 p-0"},`${u.entries.Lcz_Booking}#${this.booking.booking_nbr}`),t("p",{key:"005a4761d677218d8f6e8d63e511bd82fb5b3273",class:"m-0 p-0"},!this.booking.is_direct&&t("span",{key:"52c4e5d4f9575e1348e156eea1df4c884f75e8cc",class:"mr-1 m-0"},this.booking.channel_booking_nbr))),t("div",{key:"7bc5c33a17b9366407e0a91c6ffc95f53cb854b5",class:"d-flex justify-content-end align-items-center",style:{gap:"1rem",flexWrap:"wrap"}},t("div",{key:"808d000f4f4045cadba07e03f1ad4044d2f9ca92",class:"d-flex flex-column align-items-center"},t("span",{key:"d8e090ee9ed864837bef09b3f412c59ecd4cfff0",class:`confirmed btn-sm m-0  ${this.confirmationBG[this.booking.is_requested_to_cancel?"003":this.booking.status.code]}`},this.booking.is_requested_to_cancel?u.entries.Lcz_CancellationRequested:this.booking.status.description),s&&t("ir-popover",{key:"da6b95cbdc18ebab84710dd767eb0b5e7974f7dc",trigger:"hover",renderContentAsHtml:true,content:`<div><p>Modified by ${s.user} at ${s.date} ${s.hour}:${s.minute}.</p>\n                <p>${this.alertMessage}</p></div>`},t("p",{key:"9d93ecfa329e53dc1b85f85492f7ea7a4f366f04",class:"mx-0 p-0 small text-danger",style:{marginTop:"0.25rem",marginBottom:"0"}},t("b",{key:"26398b0b80da91613ffad326b0d2df16cb69219e"},"Modified")))),this.booking.allowed_actions.length>0&&this.booking.is_editable&&t("div",{key:"1bf5055a73c87b809fc4ad224d209ac9285ce241",class:"m-0 p-0 d-flex align-items-center",style:{gap:"0.25rem"}},t("ir-select",{key:"5d6e5e92b2969f243182c6648c3c27fca583281c",selectContainerStyle:"h-28",selectStyles:"d-flex status-select align-items-center h-28",firstOption:u.entries.Lcz_Select,id:"update-status",size:"sm","label-available":"false",data:this.booking.allowed_actions.map((e=>({text:e.description,value:e.code}))),textSize:"sm",class:"sm-padding-right m-0 ",selectedValue:this.bookingStatus}),t("ir-button",{key:"37c1b0e28421c0e4da198a2e2afe286004021121",onClickHandler:()=>{if(!this.booking.is_direct){this.modalEl.openModal();return}this.updateStatus()},btn_styles:"h-28",isLoading:T("/Change_Exposed_Booking_Status"),btn_disabled:T("/Change_Exposed_Booking_Status"),id:"update-status-btn",size:"sm",text:"Update"})),t("ir-button",{key:"7a4629519c86dde026fec8f23eae0216a60bc7a4",size:"sm",btn_color:"outline",text:u.entries.Lcz_EventsLog,onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.openDialog({type:"events-log"})}}),g.is_pms_enabled&&t("ir-button",{key:"71caf4b169a72fe9d544876d79f579f37046f7a3",size:"sm",btn_color:"outline",text:u.entries.Lcz_pms,onClick:e=>{e.stopImmediatePropagation();e.stopPropagation();this.openDialog({type:"pms"})}}),this.hasReceipt&&t("ir-button",{key:"4478361d01213c807bf85dfbf68e167673c410b8",variant:"icon",id:"receipt",icon_name:"reciept",class:"",style:{"--icon-size":"1.65rem"}}),this.hasPrint&&t("ir-button",{key:"3ac59d9e5b977496c49f1ae244c45e29947fcc81",variant:"icon",id:"print",icon_name:"print",class:"",style:{"--icon-size":"1.65rem"}}),this.hasEmail&&t("ir-button",{key:"c503f17982ce336daaab27f6190417ad16fdbdeb",variant:"icon",id:"email",title:"Email this booking",icon_name:"email",class:"",style:{"--icon-size":"1.65rem"}}),this.hasDelete&&t("ir-button",{key:"566d8304f0c1cb04b91fa26258b92d1f8008a208",variant:"icon",id:"book-delete",icon_name:"trash",class:"",style:Object.assign(Object.assign({},$.danger),{"--icon-size":"1.65rem"})}),this.hasMenu&&t("ir-button",{key:"72f34ad5fb5feb981090449684511f548049cf02",variant:"icon",class:"mr-1",id:"menu",icon_name:"menu_list",style:{"--icon-size":"1.65rem"}}),this.hasCloseButton&&t("ir-button",{key:"4ef79bd0edd9b7f60246146d24c4ab68610eba37",id:"close",variant:"icon",style:{"--icon-size":"1.65rem"},icon_name:"xmark",class:"ml-2",onClickHandler:e=>{e.stopPropagation();e.stopImmediatePropagation();this.closeSidebar.emit(null)}}))),t("ir-dialog",{key:"d3c7195ede2e70fc63fbc4f4a8ea3a7e3e1c2f05",onOpenChange:e=>{if(!e.detail){this.currentDialogStatus=null}},style:this.currentDialogStatus==="events-log"&&{"--ir-dialog-max-width":"max-content"},ref:e=>this.dialogRef=e},this.renderDialogBody()),t("ir-modal",{key:"4b2495645764b004aadee17a7aa10ecb575e76a5",ref:e=>this.modalEl=e,modalTitle:"",leftBtnText:(e=u===null||u===void 0?void 0:u.entries)===null||e===void 0?void 0:e.Lcz_Cancel,rightBtnText:(i=u===null||u===void 0?void 0:u.entries)===null||i===void 0?void 0:i.Lcz_Confirm,modalBody:u.entries.Lcz_OTA_Modification_Alter,isLoading:T("/Change_Exposed_Booking_Status"),onConfirmModal:this.updateStatus.bind(this)}))}};Re.style=Le;const $e=":host{display:block;box-sizing:border-box;font:inherit;color:inherit}.dialog{border:none;margin:auto;padding:0;background:transparent;color:inherit;width:min(90vw, var(--ir-dialog-max-width, 40rem));max-width:var(--ir-dialog-max-width, 40rem);min-width:var(--ir-dialog-min-width, auto)}.dialog::backdrop{background:rgba(0, 0, 0, 0.35);backdrop-filter:blur(2px);animation:overlayShow 160ms cubic-bezier(0.16, 1, 0.3, 1)}.dialog__content{box-sizing:border-box;display:flex;flex-direction:column;background:#ffffff;border-radius:8px;box-shadow:hsl(206 22% 7% / 35%) 0px 10px 38px -10px, hsl(206 22% 7% / 20%) 0px 10px 20px -15px;max-height:min(85vh, 100%);overflow:hidden;padding:1rem}.dialog[open] .dialog__content{animation:contentShow 300ms cubic-bezier(0.16, 1, 0.3, 1)}.dialog__header,.dialog__body,.dialog__footer{padding:0}.dialog__header{display:flex;align-items:flex-start;gap:16px}.dialog__header slot[name='modal-title']::slotted(*){margin:0}.dialog__body{flex:1 1 auto;overflow:auto;padding-bottom:2rem}.dialog__body ::slotted(*){font-size:14px;font-weight:400;color:#475467;margin:0}.dialog__footer{display:flex;align-items:center;justify-content:flex-end;gap:12px}.dialog__footer ::slotted(*){--ir-btn-width:auto}.dialog__close-button{margin-left:auto;border:none;background:transparent;padding:4px;border-radius:999px;color:#104064;cursor:pointer;display:inline-flex;align-items:center;justify-content:center}.dialog__close-button:hover{background:rgba(16, 64, 100, 0.08)}.dialog__close-button:focus-visible{outline:2px solid #104064;outline-offset:2px}.dialog__close-button svg{display:block}.dialog__header slot[name='modal-title']::slotted(*){font-size:18px;font-weight:600;color:#101828}@keyframes overlayShow{from{opacity:0}to{opacity:1}}@keyframes contentShow{from{opacity:0;transform:translateY(-8px) scale(0.98)}to{opacity:1;transform:translateY(0) scale(1)}}";const Pe=$e;const ze=class{constructor(t){e(this,t);this.openChange=s(this,"openChange",7);this.open=false;this.hasTitleSlot=false;this.hasBodySlot=false;this.previouslyFocused=null;this.instanceId=++ze.dialogIds;this.handleCancel=e=>{e.preventDefault();this.closeModal()};this.handleNativeClose=()=>{if(this.open){this.open=false;return}this.hideDialog(false)};this.onTitleSlotChange=e=>{const t=e.target;this.hasTitleSlot=t.assignedNodes({flatten:true}).length>0};this.onBodySlotChange=e=>{const t=e.target;this.hasBodySlot=t.assignedNodes({flatten:true}).length>0};this.onCloseButtonClick=()=>{this.closeModal()}}get titleId(){return`ir-dialog-title-${this.instanceId}`}get descriptionId(){return`ir-dialog-description-${this.instanceId}`}componentDidLoad(){if(!this.dialogEl){return}this.dialogEl.addEventListener("cancel",this.handleCancel);this.dialogEl.addEventListener("close",this.handleNativeClose);this.syncSlotState();if(this.open){this.showDialog(false)}}disconnectedCallback(){if(this.dialogEl){this.dialogEl.removeEventListener("cancel",this.handleCancel);this.dialogEl.removeEventListener("close",this.handleNativeClose)}this.restoreFocus()}handleOpenChange(e){if(e){this.showDialog()}else{this.hideDialog()}}async openModal(){this.open=true}async closeModal(){this.open=false}showDialog(e=true){if(!this.dialogEl||this.dialogEl.open){return}this.previouslyFocused=document.activeElement;if(typeof this.dialogEl.showModal==="function"){this.dialogEl.showModal()}else{this.dialogEl.setAttribute("open","")}if(e){this.openChange.emit(true)}}hideDialog(e=true){if(!this.dialogEl){return}if(this.dialogEl.open){this.dialogEl.close()}this.restoreFocus();if(e){this.openChange.emit(false)}}restoreFocus(){if(this.previouslyFocused&&typeof this.previouslyFocused.focus==="function"){this.previouslyFocused.focus({preventScroll:true})}this.previouslyFocused=null}syncSlotState(){if(!this.dialogEl){return}const e=this.dialogEl.querySelector('slot[name="modal-title"]');const t=this.dialogEl.querySelector('slot[name="modal-body"]');if(e){this.hasTitleSlot=e.assignedNodes({flatten:true}).length>0}if(t){this.hasBodySlot=t.assignedNodes({flatten:true}).length>0}}render(){const e=this.hasTitleSlot?this.titleId:undefined;const s=this.hasBodySlot?this.descriptionId:undefined;return t(i,{key:"8c9e890a165bd82bd200fa418df400db7ab57924"},t("dialog",{key:"f2cd6446cfc09c2934f627161ef3285913b58fac",ref:e=>this.dialogEl=e,class:"dialog",role:"dialog","aria-modal":"true","aria-labelledby":e,"aria-describedby":s},t("div",{key:"36499ec862c53ad7cb4290c73664d22260146ddf",class:"dialog__content",role:"document"},t("header",{key:"ded3f793ec54679ec0c26ec97290b923003b6487",class:"dialog__header",id:e},t("slot",{key:"3bdcbbd1c4ebf66de0fe72b6d08062ab9c37bf85",name:"modal-title",onSlotchange:this.onTitleSlotChange}),t("button",{key:"eedef8bb46caf8d1aea0d06530504957db0a4ffd",type:"button",class:"dialog__close-button",onClick:this.onCloseButtonClick,"aria-label":"Close dialog"},t("slot",{key:"c5f4e53e6e8975fce0b452d4f678b633d1c7a65e",name:"close-icon"},t("svg",{key:"8a3ebab9d2c3d59100de911a75b08f67a5bafa74",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",height:18,width:18,"aria-hidden":"true",focusable:"false"},t("path",{key:"b1e4b54641c7ba476fce9189a6336b36183d48a4",fill:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"}))))),t("section",{key:"3e24aff29a96ad0cb07f7ba769edb65aa7256e2e",class:"dialog__body",id:s},t("slot",{key:"36965856da300bfd457c063cae8b65054a9abbf4",name:"modal-body",onSlotchange:this.onBodySlotChange})),t("footer",{key:"c5ffe8fe50d1fe55bd23e195ea485a0420d5df51",class:"dialog__footer"},t("slot",{key:"a1efabe10a4c08e23fd027877cb9fdb0c9453b3f",name:"modal-footer"})))))}get hostEl(){return o(this)}static get watchers(){return{open:["handleOpenChange"]}}};ze.dialogIds=0;ze.style=Pe;const Ge=".dropdown-menu.sc-ir-dropdown{z-index:1000;width:100%;max-height:300px;min-width:var(--ir-dropdown-menu-min-width, 11rem) !important;overflow-y:auto}.dropdown.nav-item.show.sc-ir-dropdown .dropdown-menu.sc-ir-dropdown{display:block}.caret-icon.sc-ir-dropdown{position:absolute;top:50%;transform:translateY(-55%);right:0.25rem;z-index:99999}.dropdown-trigger.sc-ir-dropdown{position:relative}.caret-icon.disabled.sc-ir-dropdown{opacity:0.5 !important;pointer-events:none !important;cursor:not-allowed !important}";const Ke=Ge;const Ue=class{constructor(t){e(this,t);this.optionChange=s(this,"optionChange",7);this.disabled=false;this.caret=true;this.isOpen=false;this.focusedIndex=-1;this.itemChildren=[];this.mo=null;this.isComponentConnected=true;this.updateQueued=false;this.handleDocumentClick=e=>{if(!this.isComponentConnected||!this.el.contains(e.target)){this.closeDropdown()}};this.handleKeyDown=e=>{if(!this.isComponentConnected||this.disabled)return;const t=this.itemChildren.length-1;switch(e.key){case"ArrowDown":e.preventDefault();if(!this.isOpen){this.openDropdown();if(this.focusedIndex>=0&&this.focusedIndex<t){this.focusedIndex++;this.focusItemElement(this.focusedIndex)}else if(this.focusedIndex===-1){this.focusedIndex=0;this.focusItemElement(this.focusedIndex)}else if(this.focusedIndex===t){this.focusedIndex=0;this.focusItemElement(this.focusedIndex)}}else if(t>=0){this.focusedIndex=this.focusedIndex<t?this.focusedIndex+1:0;this.focusItemElement(this.focusedIndex)}break;case"ArrowUp":e.preventDefault();if(!this.isOpen){this.openDropdown();if(this.focusedIndex>0){this.focusedIndex--;this.focusItemElement(this.focusedIndex)}else if(this.focusedIndex===-1){this.focusedIndex=t;this.focusItemElement(this.focusedIndex)}else if(this.focusedIndex===0){this.focusedIndex=t;this.focusItemElement(this.focusedIndex)}}else if(t>=0){this.focusedIndex=this.focusedIndex>0?this.focusedIndex-1:t;this.focusItemElement(this.focusedIndex)}break;case"Enter":e.preventDefault();if(this.isOpen&&this.focusedIndex>=0){this.selectItemElement(this.focusedIndex)}else if(!this.isOpen){this.openDropdown()}break;case"Escape":e.preventDefault();this.closeDropdown();break;case"Tab":if(this.isOpen){this.closeDropdown()}break}}}componentWillLoad(){this.selectedOption=this.value;this.documentClickHandler=this.handleDocumentClick.bind(this);this.collectItemChildren();this.mo=new MutationObserver((()=>{if(!this.updateQueued){this.updateQueued=true;requestAnimationFrame((()=>{if(this.isComponentConnected){this.collectItemChildren();this.updateQueued=false}}))}}));this.mo.observe(this.el,{childList:true,subtree:true})}componentDidLoad(){document.addEventListener("click",this.documentClickHandler,{passive:true});requestAnimationFrame((()=>{if(this.isComponentConnected){this.updateItemElements();if(this.value){this.updateDropdownItemValue(this.value)}}}))}disconnectedCallback(){var e;this.isComponentConnected=false;document.removeEventListener("click",this.documentClickHandler);(e=this.mo)===null||e===void 0?void 0:e.disconnect();this.mo=null}handleDocumentKeyDown(e){if(!this.isOpen||!this.isComponentConnected)return;if(e.key==="Escape"){this.closeDropdown()}}handleDropdownItemSelect(e){if(!this.isComponentConnected)return;e.stopPropagation();this.selectOption(e.detail);e.target.setAttribute("aria-selected","true")}handleDropdownItemRegister(){if(!this.isComponentConnected)return;this.collectItemChildren()}handleDropdownItemUnregister(){if(!this.isComponentConnected)return;this.collectItemChildren()}handleValueChange(e,t){if(e!==t&&this.isComponentConnected){this.updateDropdownItemValue(e)}}updateDropdownItemValue(e){this.itemChildren.forEach((e=>e.removeAttribute("aria-selected")));const t=this.itemChildren.find((t=>t.value===e));if(t){t.setAttribute("aria-selected","true")}}getSelectedItemIndex(){if(!this.value)return-1;return this.itemChildren.findIndex((e=>e.value===this.value))}openDropdown(){try{this.isOpen=true;this.focusedIndex=this.getSelectedItemIndex();this.updateItemElements();if(this.focusedIndex>=0){requestAnimationFrame((()=>{this.scrollToSelectedItem()}))}}catch(e){console.log(e)}}closeDropdown(){this.isOpen=false;this.focusedIndex=-1;this.removeItemFocus()}collectItemChildren(){if(!this.isComponentConnected)return;const e=Array.from(this.el.querySelectorAll("ir-dropdown-item"));this.itemChildren=e;this.updateItemElements()}updateItemElements(){if(!this.isComponentConnected)return;this.itemChildren.forEach(((e,t)=>{e.setAttribute("data-slot-index",String(t));e.setAttribute("role","option");e.setAttribute("tabindex","-1")}))}removeItemFocus(){this.itemChildren.forEach((e=>{e.classList.remove("focused","active")}))}focusItemElement(e){this.removeItemFocus();if(e>=0&&e<this.itemChildren.length){const t=this.itemChildren[e];t.classList.add("focused");t.scrollIntoView({block:"nearest",behavior:"smooth"})}}selectItemElement(e){if(e>=0&&e<this.itemChildren.length){const t=this.itemChildren[e];t.click()}}scrollToSelectedItem(){if(this.focusedIndex>=0&&this.focusedIndex<this.itemChildren.length){const e=this.itemChildren[this.focusedIndex];if(e){e.scrollIntoView({block:"nearest",behavior:"smooth",inline:"nearest"})}}}selectOption(e){this.selectedOption=e;this.value=e;this.optionChange.emit(e);this.closeDropdown()}render(){return t(i,{key:"03285e9e15d52a363a41e6efd7566b68dfeb4669",class:`dropdown ${this.isOpen?"show":""}`},t("div",{key:"411b295e64da8bcce3ed3ee1fb8693bbaf91b353",onClick:()=>{if(this.disabled)return;if(this.isOpen){this.closeDropdown()}else{this.openDropdown()}},"aria-disabled":String(this.disabled),class:`dropdown-trigger ${this.disabled?"disabled":""}`,onKeyDown:this.handleKeyDown,tabindex:"0"},t("slot",{key:"1b38a5ebc724742ecc9d96bc02c4b4489b9ca013",name:"trigger"}),this.caret&&t("div",{key:"7cb10236d632742c013136f83ec2dd120626d7cb",class:`caret-icon ${this.disabled?"disabled":""}`},t("ir-icons",{key:"26786fd483b561f37b48bf1eb7b1875605669228",name:!this.isOpen?"angle-down":"angle-up"}))),t("div",{key:"579d921048bb242540690af17c55a03e404ac7f4",class:"dropdown-menu",role:"listbox","aria-expanded":this.isOpen.toString()},t("slot",{key:"3d64b2c0ccc3fd9eb90a66882fdec8b256363e24"})))}get el(){return o(this)}static get watchers(){return{value:["handleValueChange"]}}};Ue.style=Ke;const He=".sc-ir-dropdown-item-h{display:block;cursor:pointer}[hidden].sc-ir-dropdown-item-h{display:none !important}.focused.sc-ir-dropdown-item-h{background:#f4f5fa !important}.active.sc-ir-dropdown-item-h,[aria-selected='true'].sc-ir-dropdown-item-h,.sc-ir-dropdown-item-h:active{outline:none;background-color:var(--blue, #1e9ff2) !important;color:white !important}.dropdown-item.sc-ir-dropdown-item-h{padding:0.25rem 1rem !important;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}";const Fe=He;const Ve=class{constructor(t){e(this,t);this.dropdownItemSelect=s(this,"dropdownItemSelect",7);this.dropdownItemRegister=s(this,"dropdownItemRegister",7);this.dropdownItemUnregister=s(this,"dropdownItemUnregister",7);this.isComponentConnected=true;this.hasRegistered=false;this.hidden=false;this.handleClick=e=>{e.stopPropagation();if(!this.isComponentConnected)return;this.dropdownItemSelect.emit(this.value)}}componentDidLoad(){if(this.isComponentConnected&&!this.hasRegistered){this.hasRegistered=true;requestAnimationFrame((()=>{if(this.isComponentConnected){this.dropdownItemRegister.emit()}}))}}disconnectedCallback(){this.isComponentConnected=false;if(this.hasRegistered&&this.el.parentElement){const e=this.el.closest("ir-dropdown");if(e&&document.contains(e)){this.dropdownItemUnregister.emit()}}this.hasRegistered=false}async matchesQuery(e){var t,i;if(!this.isComponentConnected)return false;const s=e.toLowerCase();const a=((i=(t=this.label)!==null&&t!==void 0?t:this.el.textContent)!==null&&i!==void 0?i:"").toLowerCase();return a.includes(s)}async setHidden(e){if(this.isComponentConnected){this.hidden=e}}render(){return t(i,{key:"a64681de1caa9ed02048b91f234a66b6e5f01cb3",role:"option",tabindex:"-1","aria-selected":"false",class:{"dropdown-item":true,hidden:this.hidden},onClick:this.handleClick,"data-value":this.value},this.html_content?t("span",{innerHTML:this.html_content}):t("slot",null))}get el(){return o(this)}};Ve.style=Fe;const We=".sc-ir-events-log-h{display:block}.beta.sc-ir-events-log{background:var(--red);color:white;padding:0.2rem 0.3rem;font-size:12px;border-radius:4px;margin:0}.event-row.sc-ir-events-log{padding-bottom:0.5rem}.list-title.sc-ir-events-log{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-events-log{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-events-log{color:#629a4c;font-weight:600}.list-item.red.sc-ir-events-log{color:#ff4961;font-weight:600}.dates-row.sc-ir-events-log{display:flex;align-items:center;gap:0.875rem}";const qe=We;const Xe=class{constructor(t){e(this,t)}componentWillLoad(){this.init()}async init(){try{this.bookingEvents=this.booking.events}catch(e){console.error(e)}}render(){var e;return t("div",{key:"400e2744008b613a63ffe3cb74c42ecc211c05d9",class:"p-1"},t("div",{key:"7ba79717ef93ddbda463738448b4bb41b3376a30",class:"d-flex  align-items-center",style:{gap:"0.5rem"}},t("h3",{key:"903eb5f40afc164ef10a14243c0c1a89ed94845e",class:" text-left p-0 m-0  dialog-title "},u.entries.Lcz_EventsLog)),T("/Get_Exposed_Booking_Events")?t("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},t("ir-spinner",null)):t(a,null,t("table",{class:" dialog-container-height"},t("thead",{style:{opacity:"0"}},t("tr",null,t("th",null,"date"),t("th",null,"user"),t("th",null,"status"))),t("tbody",null,(e=this.bookingEvents)===null||e===void 0?void 0:e.map((e=>t("tr",{key:e.id,class:"pb-1"},t("td",{class:"event-row dates-row"},t("span",null,e.date),t("span",null,String(e.hour).padStart(2,"0"),":",String(e.minute).padStart(2,"0"),":",String(e.second).padStart(2,"0"))),t("td",{class:"pl-3 event-row "},e.type),t("td",{class:"pl-1 event-row "},e.user))))))))}};Xe.style=qe;const Qe=".sc-ir-extra-service-h{display:block}.extra-service-container.sc-ir-extra-service{display:flex;align-items:start;justify-content:space-between;gap:0.5rem}.extra-service-container.sc-ir-extra-service *.sc-ir-extra-service{padding:0;margin:0;box-sizing:border-box}.extra-service-actions.sc-ir-extra-service{display:flex;align-items:center;gap:0.5rem}.extra-service-conditional-date.sc-ir-extra-service{margin-top:0.5rem}.extra-service-price.sc-ir-extra-service{white-space:nowrap}.extra-service-description.sc-ir-extra-service{word-break:break-all}";const Ze=Qe;const Je=class{constructor(t){e(this,t);this.editExtraService=s(this,"editExtraService",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.bookingService=new l}async deleteService(){try{await this.bookingService.doBookingExtraService({service:this.service,is_remove:true,booking_nbr:this.bookingNumber});this.resetBookingEvt.emit(null)}catch(e){console.log(e)}}render(){return t(i,{key:"36e952da1186ff05a3531da6fe6528786a02f84f"},t("div",{key:"205afa704f6e4b1b4f5b190c5df1d881955fb5f0",class:"p-1"},t("div",{key:"6f8d6a6760a4ac996a03cb12587bee88de1eeb04",class:"extra-service-container"},t("p",{key:"e15cd0ea93dcda671e79c84986089ec077fc793c",class:"extra-service-description"},this.service.description),t("div",{key:"ac14737749822048a201589165df3f33e2bc6540",class:"extra-service-actions"},!!this.service.price&&this.service.price>0&&t("p",{key:"0e17299c0073c902f0c29312317f98ba4d81332c",class:"extra-service-price p-0 m-0 font-weight-bold"},y(this.currencySymbol,this.service.price)),t("ir-button",{key:"c74ec2b53e0a3a13e5d803aed988dbaec0c949cc",id:`serviceEdit-${this.service.booking_system_id}`,class:"extra-service-edit-btn m-0 p-0",variant:"icon",icon_name:"edit",style:$.secondary,onClickHandler:()=>this.editExtraService.emit(this.service)}),t("ir-button",{key:"3a31bbf412d9ad402b0821ad2d535cfa35949063",class:"extra-service-delete-btn m-0 p-0",variant:"icon",onClickHandler:()=>this.irModalRef.openModal(),id:`roomDelete-${this.service.booking_system_id}`,icon_name:"trash",style:$.danger}))),t("div",{key:"559600086b061595b3dc11c900028db652aab154",class:"extra-service-conditional-date"},this.service.start_date&&this.service.end_date?t("ir-date-view",{class:"extra-service-date-view mr-1",from_date:this.service.start_date,to_date:this.service.end_date,showDateDifference:false}):this.service.start_date&&t("p",{class:"extra-service-date-view"},B(new Date(this.service.start_date)).format("MMM DD, YYYY")))),t("ir-modal",{key:"ec5414e8edc5385325d8a7ff8900caf958d6ad51",autoClose:false,ref:e=>this.irModalRef=e,isLoading:T("/Do_Booking_Extra_Service"),onConfirmModal:this.deleteService.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:u.entries.Lcz_Cancel,rightBtnText:u.entries.Lcz_Delete,leftBtnColor:"secondary",rightBtnColor:"danger",modalTitle:u.entries.Lcz_Confirmation,modalBody:`${u.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${u.entries.Lcz_ThisService} ${u.entries.Lcz_FromThisBooking}`}))}};Je.style=Ze;const et=E.object({type:E.object({code:E.union([E.string().min(3),E.literal("")]).optional(),description:E.union([E.string(),E.literal("")]).optional()}),number:E.union([E.string().min(2),E.literal("")]).optional().nullable()});const tt=E.object({id:E.number().optional(),first_name:E.union([E.string().min(2),E.literal("")]).optional(),last_name:E.union([E.string().min(2),E.literal("")]).optional(),country_id:E.coerce.number().min(0).optional(),dob:E.string().nullable().optional().refine((e=>e===undefined||B(e,"DD/MM/YYYY",true).isValid()||e===""||e===null),"Invalid date format").transform((e=>{if(e===undefined||e===""||e===null)return null;const t=B(e,"DD/MM/YYYY",true).isValid();return t?null:B(e,"DD/MM/YYYY").format("YYYY-MM-DD")})),id_info:et.optional(),is_main:E.boolean().default(false)});function it(e){var t;tt.parse(e);const i=e=>e!==null&&e!==undefined&&e.trim()!=="";const s=[];if(e.is_main){if(!i(e.first_name)){s.push({path:["first_name"],code:j.custom,message:"First name is required for main guest"})}if(!i(e.last_name)){s.push({path:["last_name"],code:j.custom,message:"Last name is required for main guest"})}}const a=i(e.first_name)||i(e.last_name)||i(e.dob)||e.country_id!==null&&e.country_id!==undefined&&e.country_id>0||i((t=e.id_info)===null||t===void 0?void 0:t.number);if(a){if(!i(e.first_name)){s.push({path:["first_name"],code:j.custom,message:"First name is required when other guest information is provided"})}if(!i(e.last_name)){s.push({path:["last_name"],code:j.custom,message:"Last name is required when other guest information is provided"})}}if(s.length>=1){throw new S(s)}}const st=E.object({booking_system_id:E.number().optional(),cost:E.coerce.number().nullable(),currency_id:E.number().min(1),description:E.string().min(1),end_date:E.string().nullable(),price:E.coerce.number(),start_date:E.string().nullable(),system_id:E.number().optional()});const at=".sc-ir-extra-service-config-h{display:block;--ir-input-border-color:#cacfe7}.sc-ir-extra-service-config-h .input-group-text.sc-ir-extra-service-config{border-color:var(--ir-input-border-color)}.currency-ph.sc-ir-extra-service-config{padding:0;margin:0;color:#3b4781;display:flex;align-items:center;justify-content:center;padding:0 0 0 0.25rem;border-top:1px solid var(--ir-input-border-color);border-bottom:1px solid var(--ir-input-border-color);border-left:1px solid transparent;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.service-description-input.sc-ir-extra-service-config{height:70px !important}.service-description.sc-ir-extra-service-config .input-group-prepend.sc-ir-extra-service-config{background-color:#f4f5fa;border:1px solid var(--ir-input-border-color);border-top-left-radius:0.25rem;border-bottom-left-radius:0.25rem}.service-date-container.sc-ir-extra-service-config{padding:0;margin:0;display:flex;align-items:center;position:relative;width:100%;justify-content:center}.service-date-container.sc-ir-extra-service-config .btn-container.sc-ir-extra-service-config{position:absolute;right:5px;margin:0;display:flex;align-items:center;justify-content:center;padding:0}.service-description.sc-ir-extra-service-config .input-group-text.sc-ir-extra-service-config{height:fit-content;border:0;padding-top:0.75rem !important}.price-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config,.cost-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config{border-top:1px solid #1e9ff2;border-bottom:1px solid #1e9ff2;border-left:1px solid #1e9ff2}.currency-ph[data-state='error'].sc-ir-extra-service-config{border-color:var(--red, #ff4961)}.price-input.sc-ir-extra-service-config:focus{border-right-width:1px !important}.is-invalid.sc-ir-extra-service-config{background-image:none !important}.price-input.sc-ir-extra-service-config,.cost-input.sc-ir-extra-service-config{border-left:0}.row-group.sc-ir-extra-service-config{display:flex;flex-direction:column;gap:0.5rem}@media (min-width: 640px){.row-group.sc-ir-extra-service-config{flex-direction:row;align-items:center;gap:0}.cost-label.sc-ir-extra-service-config{border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.until-prepend.sc-ir-extra-service-config,.cost-input-placeholder.sc-ir-extra-service-config{border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}.date-from.sc-ir-extra-service-config,.price-input.sc-ir-extra-service-config{border-right-width:0 !important;border-top-right-radius:0 !important;border-bottom-right-radius:0 !important}}.date-focused.sc-ir-extra-service-config{border-color:#1e9ff2}";const ot=at;const nt=".sc-ir-extra-service-config-h{height:100%}.sheet-container.sc-ir-extra-service-config{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-extra-service-config{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-extra-service-config{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-extra-service-config{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-extra-service-config{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-extra-service-config{flex-direction:row;align-items:center}}";const rt=nt;const lt=class{constructor(t){e(this,t);this.closeModal=s(this,"closeModal",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.bookingService=new l}componentWillLoad(){if(this.service){this.s_service=Object.assign({},this.service)}}async saveAmenity(){try{st.parse(this.s_service);await this.bookingService.doBookingExtraService({service:this.s_service,booking_nbr:this.booking.booking_nbr,is_remove:false});this.resetBookingEvt.emit(null);this.closeModal.emit(null)}catch(e){if(e instanceof S){this.error=true}console.error(e)}}updateService(e){let t=this.s_service;if(!t){t={cost:null,description:null,end_date:null,start_date:null,price:null,currency_id:this.booking.currency.id}}this.s_service=Object.assign(Object.assign({},t),e)}validatePrice(){var e,t,i,s;if(((e=this.s_service)===null||e===void 0?void 0:e.price)===undefined||((i=(t=this.s_service)===null||t===void 0?void 0:t.price)===null||i===void 0?void 0:i.toString())===""){return false}const a=st.pick({price:true});const o=a.safeParse({price:(s=this.s_service)===null||s===void 0?void 0:s.price});return o.success}render(){var e,i,s,a,o,n,r,l,c,d,h,p,f,b;return t("form",{key:"3362c4d8befe14e37e67a1c238e6398f42a7b25b",class:"sheet-container",onSubmit:async e=>{e.preventDefault();await this.saveAmenity()}},t("ir-title",{key:"bb266a88b9d335cc4820c2e82f7b5262164cacc1",class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:u.entries.Lcz_ExtraServices,displayContext:"sidebar"}),t("section",{key:"5a635083487888f10ce3ca9a5f014d64c2b9ab0a",class:"px-1 sheet-body"},t("fieldset",{key:"cafa71dc4f2c4c35bd789d483880efa98cbb5e40",class:"input-group mb-1 service-description"},t("div",{key:"548e77df0ee8320754a49ac31d9cd912f57a0ff6",class:"input-group-prepend"},t("span",{key:"1e7d269e7c464c782b7a3a65c8ebc2d9a96aa805",class:"input-group-text"},u.entries.Lcz_Description)),t("textarea",{key:"36a807fe405f7668e1ac0415803ac9af624c207e",value:(e=this.s_service)===null||e===void 0?void 0:e.description,class:`form-control service-description-input ${this.error&&!((i=this.s_service)===null||i===void 0?void 0:i.description)?"is-invalid":""}`,style:{height:"7rem"},maxLength:250,onChange:e=>this.updateService({description:e.target.value}),"aria-label":"Amenity description"})),t("div",{key:"7d4318f65fd4c3c3e7d8c91bee5cea6c55ef90f3",class:"row-group mb-1"},t("div",{key:"1ba4c0855563408bfc70ac97a3dba171da4f8ee6",class:"input-group"},t("div",{key:"3f9c9ca1806f8fafb70146fd4ed9cc7c0268ef3d",class:"input-group-prepend"},t("span",{key:"3e1a8f2a4d15bb6dfc834df16e48e81b034f6702",class:"input-group-text",id:"basic-addon1"},u.entries.Lcz_DatesOn)),t("div",{key:"079e2fea681660ecfef782a55344f9891184951f",class:"form-control p-0 m-0 d-flex align-items-center justify-content-center date-from"},t("div",{key:"7770c74b0ed91717b9e9aae182d500a4df509e48",class:"service-date-container"},t("ir-date-picker",{key:"af4afc84e3345a852df3b6ad8a2f2350af235139",emitEmptyDate:true,date:(s=this.s_service)===null||s===void 0?void 0:s.start_date,minDate:this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:e=>{var t;return this.updateService({start_date:(t=e.detail.start)===null||t===void 0?void 0:t.format("YYYY-MM-DD")})}},t("input",{key:"e7da66a9266f67a9bd8a28554bf7c670f8d9cb4f",type:"text",slot:"trigger",value:((a=this.s_service)===null||a===void 0?void 0:a.start_date)?P(this.s_service.start_date):null,style:{borderLeftWidth:"0",borderRightWidth:"0",width:"100%",borderRadius:"0"},class:"text-center w-100 form-control input-sm"})),((o=this.s_service)===null||o===void 0?void 0:o.start_date)&&t("div",{key:"d8832261ad8fe8c53057c2f28e2444d5822e5f26",class:"btn-container"},t("ir-button",{key:"f2af93b6b53e1b5ed5665b39c314d762424dac53",title:"clear",id:"close",variant:"icon",style:{"--icon-size":"0.875rem"},icon_name:"xmark-fill",class:"ml-2",onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.updateService({start_date:null})}}))))),t("div",{key:"01dffa85f109d63c48be011d8d65aa305e2f23dd",class:"input-group"},t("div",{key:"7cc37ab4912eb724f790c5c1fac49f0020f76fe1",class:"input-group-prepend "},t("span",{key:"27aa18290701271cbad9e7c3293e55f23fc7c86c",class:"input-group-text until-prepend",id:"basic-addon1"},u.entries.Lcz_TillAndIncluding)),t("div",{key:"a2b198c28f279a0e83c0b6cf48e0db2564546f84",class:"form-control p-0 m-0 d-flex align-items-center justify-content-center"},t("div",{key:"17f99c159e7a71b4d2d7db8ff84ebc444c8922dd",class:"service-date-container"},t("ir-date-picker",{key:"f9a44c5aa0003f8fd8bd45d863d5ea2c51a1c873",emitEmptyDate:true,date:(n=this.s_service)===null||n===void 0?void 0:n.end_date,minDate:(l=(r=this.s_service)===null||r===void 0?void 0:r.start_date)!==null&&l!==void 0?l:this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:e=>{var t;e.stopImmediatePropagation();e.stopPropagation();this.updateService({end_date:(t=e.detail.start)===null||t===void 0?void 0:t.format("YYYY-MM-DD")})}},t("input",{key:"7adc89ba6f50863027e9d0b4827105edebd1bc29",slot:"trigger",value:((c=this.s_service)===null||c===void 0?void 0:c.end_date)?P(this.s_service.end_date):null,style:{borderLeftWidth:"0",borderRightWidth:"0",width:"100%"},class:"text-center form-control input-sm"})),((d=this.s_service)===null||d===void 0?void 0:d.end_date)&&t("div",{key:"7d90be3c86239cdb553dcfede7e72e51de3c9cba",class:"btn-container"},t("ir-button",{key:"efaceb653039ed320004799e1f684dd2c6a9ff53",title:"clear",id:"close",variant:"icon",style:{"--icon-size":"0.875rem"},icon_name:"xmark-fill",class:"ml-2",onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.updateService({end_date:null})}})))))),t("div",{key:"7cce23be70134a24833f9af2aa507b44d8f26f4a",class:"row-group"},t("ir-price-input",{key:"f13e1974f932a0f35df6060722feb0be105a5df6",label:"Price",currency:this.booking.currency.symbol,class:"ir-br-input-none",value:(p=(h=this.s_service)===null||h===void 0?void 0:h.price)===null||p===void 0?void 0:p.toString(),zod:st.pick({price:true}),"aria-label":u.entries.Lcz_Price,wrapKey:"price","aria-describedby":"service price",autoValidate:false,"data-state":this.error&&!this.validatePrice()?"error":"",onTextChange:e=>this.updateService({price:parseFloat(e.detail)})}),t("ir-price-input",{key:"a85ed39eef337d99a04c15bd2314bc7c0591d44f",autoValidate:false,label:u.entries.Lcz_Cost,labelStyle:"rounded-0 border-left-0",currency:this.booking.currency.symbol,value:(b=(f=this.s_service)===null||f===void 0?void 0:f.cost)===null||b===void 0?void 0:b.toString(),zod:st.pick({cost:true}),onTextChange:e=>this.updateService({cost:parseFloat(e.detail)}),wrapKey:"cost","aria-label":"Cost","aria-describedby":"service cost"}))),t("div",{key:"b2532397fc50f1155d4978154f502c99df7309ed",class:"sheet-footer"},t("ir-button",{key:"e93f2d06038e7868a2980797f6636685491d2fd0",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`flex-fill`,text:u.entries.Lcz_Cancel,btn_color:"secondary"}),t("ir-button",{key:"ddcdfb3b75c75cfcd3c3f355c054d374b1fcbcd2",btn_styles:"justify-content-center align-items-center",class:"flex-fill",btn_type:"submit",isLoading:T("/Do_Booking_Extra_Service"),text:u.entries.Lcz_Save,btn_color:"primary"})))}};lt.style=ot+rt;const ct=".sc-ir-extra-services-h{display:block}";const dt=ct;const ht=class{constructor(t){e(this,t)}render(){var e;return t(i,{key:"fa144d0489a637a426bd900e30a7a349767df220",class:"card p-0 "},(e=this.booking.extra_services)===null||e===void 0?void 0:e.map(((e,i)=>t(a,null,t("ir-extra-service",{bookingNumber:this.booking.booking_nbr,currencySymbol:this.booking.currency.symbol,key:e.booking_system_id,service:e}),i!==this.booking.extra_services.length-1&&t("hr",{class:"mr-2 ml-2 my-0 p-0"})))))}};ht.style=dt;const pt=".input-group-text.sc-ir-guest-info{min-width:10rem;text-align:left}.mobilePrefixSelect.sc-ir-guest-info{border-right-width:0;border-top-right-radius:0;border-bottom-right-radius:0}.mobilePrefixInput.sc-ir-guest-info{border-top-left-radius:0;border-bottom-left-radius:0}.check-container.sc-ir-guest-info{position:relative;cursor:pointer;font-size:14px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;align-items:center}.check-container.sc-ir-guest-info input.sc-ir-guest-info{position:relative;opacity:0;cursor:pointer;height:0;width:0}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info{position:relative;top:0;left:0;height:20px;width:20px;border:1px solid #cacfe7;border-radius:4px;transition:all 0.3s ease}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info{background-color:#1e9ff2;border-color:#1e9ff2}.checkmark.sc-ir-guest-info:after{content:'';position:absolute;display:none}.check-container.sc-ir-guest-info input.sc-ir-guest-info:checked~.checkmark.sc-ir-guest-info:after{display:block}.check-label.sc-ir-guest-info{margin-left:10px !important}.check-container.sc-ir-guest-info .checkmark.sc-ir-guest-info:after{left:6px;top:3px;width:6px;height:10px;border:solid white;border-width:0 2px 2px 0;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}.ir-card-header.sc-ir-guest-info{width:100%;border-bottom:1px solid #e4e5ec}.close-icon.sc-ir-guest-info{margin:0}.border-theme.sc-ir-guest-info{border:1px solid #cacfe7}.loading-container.sc-ir-guest-info{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}";const ft=pt;const bt=".sc-ir-guest-info-h{height:100%}.sheet-container.sc-ir-guest-info{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-guest-info{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-guest-info{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-guest-info{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-guest-info{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-guest-info{flex-direction:row;align-items:center}}";const ut=bt;const mt=class{constructor(t){e(this,t);this.closeSideBar=s(this,"closeSideBar",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.toast=s(this,"toast",7);this.guest=null;this.isLoading=true;this.autoValidate=false;this.bookingService=new l;this.roomService=new N;this.token=new R}async componentWillLoad(){if(this.ticket){this.token.setToken(this.ticket)}if(!!this.token.getToken())this.init()}ticketChanged(e,t){if(e===t){return}this.token.setToken(this.ticket);this.init()}async init(){try{console.log("first");this.isLoading=true;const[e,t,i]=await Promise.all([this.bookingService.fetchGuest(this.email),this.bookingService.getCountries(this.language),!u||!u.entries||Object.keys(u.entries).length===0?this.roomService.fetchLanguage(this.language):Promise.resolve(null)]);if(i){u.entries=i.entries;u.direction=i.direction}this.countries=t;this.guest=Object.assign(Object.assign({},e),{mobile:e.mobile_without_prefix})}catch(e){console.log(e)}finally{this.isLoading=false}}handleInputChange(e){this.guest=Object.assign(Object.assign({},this.guest),e)}async editGuest(){var e;try{this.autoValidate=true;await this.bookingService.editExposedGuest(this.guest,(e=this.booking_nbr)!==null&&e!==void 0?e:null);this.toast.emit({type:"success",description:"",title:"Saved Successfully",position:"top-right"});this.closeSideBar.emit(null);this.resetBookingEvt.emit(null)}catch(e){console.log(e)}}render(){var e,i,s,o,n,r,l,c,d,h,p,f;if(this.isLoading&&this.isInSideBar){t("div",{class:"loading-container"},t("ir-spinner",null))}if(this.isLoading){return null}return t("form",{class:"p-0 sheet-container",onSubmit:async e=>{e.preventDefault();await this.editGuest()}},!this.isInSideBar&&[t("ir-toast",null),t("ir-interceptor",null)],this.headerShown&&t("ir-title",{class:"px-1 sheet-header",displayContext:"sidebar",label:u.entries.Lcz_GuestDetails}),t("div",{class:this.isInSideBar?"sheet-body":"card-content collapse show "},t("div",{class:this.headerShown?"card-body px-1 pt-0":"pt-0"},t("ir-input-text",{autoValidate:this.autoValidate,label:(e=u.entries)===null||e===void 0?void 0:e.Lcz_FirstName,name:"firstName",value:(i=this.guest)===null||i===void 0?void 0:i.first_name,required:true,onTextChange:e=>this.handleInputChange({first_name:e.detail})}),t("ir-input-text",{autoValidate:this.autoValidate,label:(s=u.entries)===null||s===void 0?void 0:s.Lcz_LastName,name:"lastName",value:(o=this.guest)===null||o===void 0?void 0:o.last_name,required:true,onTextChange:e=>this.handleInputChange({last_name:e.detail})}),t("ir-input-text",{label:(n=u.entries)===null||n===void 0?void 0:n.Lcz_Email,name:"email",value:(r=this.guest)===null||r===void 0?void 0:r.email,required:true,onTextChange:e=>this.handleInputChange({email:e.detail})}),t("ir-input-text",{label:(l=u.entries)===null||l===void 0?void 0:l.Lcz_AlternativeEmail,name:"altEmail",value:(c=this.guest)===null||c===void 0?void 0:c.alternative_email,onTextChange:e=>this.handleInputChange({alternative_email:e.detail})}),t("ir-country-picker",{country:this.countries.find((e=>e.id===this.guest.country_id)),label:(d=u.entries)===null||d===void 0?void 0:d.Lcz_Country,onCountryChange:e=>this.handleInputChange({country_id:e.detail.id}),countries:this.countries}),t("ir-phone-input",{onTextChange:e=>{e.stopImmediatePropagation();e.stopPropagation();const{mobile:t,phone_prefix:i}=e.detail;if(t!==this.guest.mobile){this.handleInputChange({mobile:t})}if(i!==this.guest.country_phone_prefix)this.handleInputChange({country_phone_prefix:i})},phone_prefix:this.guest.country_phone_prefix,value:this.guest.mobile,language:this.language,label:(h=u.entries)===null||h===void 0?void 0:h.Lcz_MobilePhone,countries:this.countries}),t("div",{class:"mb-2"},t("ir-textarea",{variant:"prepend",onTextChange:e=>this.handleInputChange({notes:e.detail}),value:(p=this.guest)===null||p===void 0?void 0:p.notes,label:(f=u.entries)===null||f===void 0?void 0:f.Lcz_PrivateNote})),t("div",{class:"p-0 m-0"},t("label",{class:`check-container m-0 p-0`},t("input",{class:"m-0 p-0",type:"checkbox",name:"newsletter",checked:this.guest.subscribe_to_news_letter,onInput:e=>this.handleInputChange({subscribe_to_news_letter:e.target.checked})}),t("span",{class:"checkmark m-0 p-0"}),t("span",{class:"m-0 p-0  check-label"},u.entries.Lcz_Newsletter)),!this.isInSideBar&&t(a,null,t("hr",null),t("ir-button",{btn_styles:"d-flex align-items-center justify-content-center",text:u.entries.Lcz_Save,onClickHandler:this.editGuest.bind(this),isLoading:T("/Edit_Exposed_Guest"),color:"btn-primary"}))))),this.isInSideBar&&t("div",{class:"sheet-footer"},t("ir-button",{"data-testid":"cancel",onClickHandler:()=>this.closeSideBar.emit(null),class:"flex-fill m-0 p-0",btn_styles:"w-100 m-0  justify-content-center align-items-center",btn_color:"secondary",text:u.entries.Lcz_Cancel}),t("ir-button",{"data-testid":"save",isLoading:T("/Edit_Exposed_Guest"),btn_disabled:this.isLoading,class:"flex-fill m-0",btn_type:"submit",btn_styles:"w-100 m-0  justify-content-center align-items-center",text:u.entries.Lcz_Save})))}static get watchers(){return{ticket:["ticketChanged"]}}};mt.style=ft+ut;const gt=".sc-ir-payment-details-h{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-payment-details-h *.sc-ir-payment-details{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sm-margin-right.sc-ir-payment-details{margin-right:5px !important;background:#000}.action_icons.sc-ir-payment-details{width:60px}.w-60.sc-ir-payment-details{width:100px;padding:0 5px}.payments-height.sc-ir-payment-details{height:30px}.payment_date.sc-ir-payment-details{width:100px}.iframeHeight.sc-ir-payment-details{height:max-content;height:22.5rem}.designation.sc-ir-payment-details{width:120px}.total-cost-container.sc-ir-payment-details{background:#7cbebe;color:white;padding:0.5rem;border-radius:5px}";const yt=gt;const vt=class{constructor(t){e(this,t);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.resetExposedCancellationDueAmount=s(this,"resetExposedCancellationDueAmount",7);this.toast=s(this,"toast",7);this.openSidebar=s(this,"openSidebar",7);this.confirmModal=false;this.toBeDeletedItem=null;this.modalMode=null;this.paymentService=new L;this.bookingService=new l;this.handleAddPayment=e=>{let t={id:-1,date:B().format("YYYY-MM-DD"),amount:null,currency:g.currency,designation:null,reference:null};if(e){const{amount:i,type:s}=e;const a=this.paymentEntries.methods.find((e=>e.CODE_NAME==="001"));const o={code:a.CODE_NAME,description:a.CODE_VALUE_EN,operation:a.NOTES};const n=this.paymentEntries.types.find((e=>e.CODE_NAME===(s==="cancellation-penalty"?"001":"010")));t=Object.assign(Object.assign({},t),{amount:i,designation:n.CODE_VALUE_EN,payment_type:{code:n.CODE_NAME,description:n.CODE_VALUE_EN,operation:n.NOTES},payment_method:s==="refund"?undefined:o});this.openSidebar.emit({type:"payment-folio",payload:{payment:t,mode:"payment-action"}});return}this.openSidebar.emit({type:"payment-folio",payload:{payment:t,mode:"new"}})};this.handleEditPayment=e=>{this.openSidebar.emit({type:"payment-folio",payload:{payment:e,mode:"edit"}})};this.handleDeletePayment=e=>{this.modalMode="delete";this.toBeDeletedItem=e;this.openModal()};this.handleConfirmModal=async e=>{e.stopImmediatePropagation();e.stopPropagation();if(this.modalMode==="delete"){await this.cancelPayment()}};this.handleCancelModal=e=>{e.stopImmediatePropagation();e.stopPropagation();this.modalMode=null;this.toBeDeletedItem=null}}handlePaymentGeneration(e){var t,i,s;const a=e.detail;const o=(i=(t=this.paymentEntries)===null||t===void 0?void 0:t.types)===null||i===void 0?void 0:i.find((e=>e.CODE_NAME===(this.booking.status.code==="003"?a.pay_type_code:"001")));this.openSidebar.emit({type:"payment-folio",payload:{payment:Object.assign(Object.assign({},a),{date:B().format("YYYY-MM-DD"),id:-1,amount:a.amount,payment_type:o?{code:o.CODE_NAME,description:o.CODE_VALUE_EN,operation:o.NOTES}:null,designation:(s=o===null||o===void 0?void 0:o.CODE_VALUE_EN)!==null&&s!==void 0?s:null}),mode:"payment-action"}})}async cancelPayment(){try{await this.paymentService.CancelPayment(this.toBeDeletedItem.id);const e=this.booking.financial.payments.filter((e=>e.id!==this.toBeDeletedItem.id));this.booking=Object.assign(Object.assign({},this.booking),{financial:Object.assign(Object.assign({},this.booking.financial),{payments:e})});this.confirmModal=false;this.resetBookingEvt.emit(null);this.resetExposedCancellationDueAmount.emit(null);this.toBeDeletedItem=null;this.modalMode=null}catch(e){console.error("Error canceling payment:",e);this.toast.emit({type:"error",title:"Error",description:"Failed to cancel payment. Please try again.",position:"top-right"})}}openModal(){const e=document.querySelector(".delete-record-modal");e===null||e===void 0?void 0:e.openModal()}hasValidFinancialData(){var e;return Boolean((e=this.booking)===null||e===void 0?void 0:e.financial)}shouldShowRefundButton(){if(!this.booking.is_direct){return false}if(this.booking.financial.due_amount===0){return false}if(this.booking.financial.cancelation_penality_as_if_today===0){return false}if(this.booking.is_requested_to_cancel||["003","004"].includes(this.booking.status.code)){return this.booking.financial.cancelation_penality_as_if_today<0}return false}shouldCancellationButton(){if(!this.booking.is_direct){return false}if(this.booking.financial.due_amount===0){return false}if(this.booking.financial.cancelation_penality_as_if_today===0){return false}if(["003","004"].includes(this.booking.status.code)&&this.booking.financial.cancelation_penality_as_if_today>0){return true}return false}render(){if(!this.hasValidFinancialData()){return null}const{financial:e,currency:i}=this.booking;return[t("div",{class:"card p-1"},t("ir-payment-summary",{isBookingCancelled:["003","004"].includes(this.booking.status.code),totalCost:e.gross_cost,balance:e.due_amount,collected:this.booking.financial.collected+this.booking.financial.refunds,currency:i}),t("ir-booking-guarantee",{booking:this.booking,bookingService:this.bookingService}),!["003","004"].includes(this.booking.status.code)&&this.booking.is_direct&&t("ir-applicable-policies",{propertyId:this.propertyId,booking:this.booking}),this.shouldShowRefundButton()&&t("div",{class:"d-flex mt-1"},t("ir-button",{btn_color:"outline",text:`Refund ${y(i.symbol,Math.abs(this.booking.financial.cancelation_penality_as_if_today))}`,size:"sm",onClickHandler:()=>{this.handleAddPayment({type:"refund",amount:Math.abs(this.booking.financial.cancelation_penality_as_if_today)})}})),this.shouldCancellationButton()&&t("div",{class:"d-flex mt-1"},t("ir-button",{btn_color:"outline",text:`Charge cancellation penalty ${y(i.symbol,this.booking.financial.cancelation_penality_as_if_today)}`,size:"sm",onClickHandler:()=>{this.handleAddPayment({type:"cancellation-penalty",amount:Math.abs(this.booking.financial.cancelation_penality_as_if_today)})}}))),t("ir-payments-folio",{payments:e.payments||[],onAddPayment:()=>this.handleAddPayment(),onEditPayment:e=>this.handleEditPayment(e.detail),onDeletePayment:e=>this.handleDeletePayment(e.detail)}),t("ir-modal",{item:this.toBeDeletedItem,class:"delete-record-modal",modalTitle:u.entries.Lcz_Confirmation,modalBody:this.modalMode==="delete"?u.entries.Lcz_IfDeletedPermantlyLost:u.entries.Lcz_EnteringAmountGreaterThanDue,iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:u.entries.Lcz_Cancel,rightBtnText:this.modalMode==="delete"?u.entries.Lcz_Delete:u.entries.Lcz_Confirm,leftBtnColor:"secondary",rightBtnColor:this.modalMode==="delete"?"danger":"primary",onConfirmModal:this.handleConfirmModal,onCancelModal:this.handleCancelModal})]}};vt.style=yt;const kt=".sc-ir-payment-folio-h{display:block;--payment-type-badge-bg:#ff4961}.payment-type-badge.sc-ir-payment-folio{background:var(--payment-type-badge-bg);color:white;padding:0.2rem 0.3rem !important;font-size:12px;border-radius:4px;margin:0;text-transform:capitalize}.credit-badge.sc-ir-payment-folio{--payment-type-badge-bg:#629a4c}.debit-badge.sc-ir-payment-folio{--payment-type-badge-bg:#ff4961}.dropdown-item-payment.sc-ir-payment-folio{display:flex;align-items:center;gap:1rem;box-sizing:border-box;justify-content:space-between}.input-group-text.sc-ir-payment-folio{border-color:#cacfe7 !important}";const _t=kt;const xt=".sc-ir-payment-folio-h{height:100%}.sheet-container.sc-ir-payment-folio{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-payment-folio{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-payment-folio{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-payment-folio{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-payment-folio{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-payment-folio{flex-direction:row;align-items:center}}";const wt=xt;const Dt=class{constructor(t){e(this,t);this.closeModal=s(this,"closeModal",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.resetExposedCancellationDueAmount=s(this,"resetExposedCancellationDueAmount",7);this.payment={date:B().format("YYYY-MM-DD"),amount:0,designation:undefined,currency:null,reference:null,id:-1};this.autoValidate=false;this._paymentTypes={};this.paymentService=new L}componentWillLoad(){this.folioSchema=E.object({date:E.string().regex(/^\d{4}-\d{2}-\d{2}$/).refine((e=>{const t=B(e,"YYYY-MM-DD",true);return t.isValid()}),{message:`Invalid date`}),amount:E.coerce.number().refine((e=>e>=0)),reference:E.string().optional().nullable(),payment_type:E.object({code:E.string().min(3).max(4),description:E.string().min(1),operation:E.union([E.literal("CR"),E.literal("DB")])}),payment_method:E.object({code:E.string().min(3).max(4),description:E.string().min(1)})});if(this.payment){this.folioData=Object.assign({},this.payment)}this.getPaymentTypes()}handlePaymentChange(e,t){if(e!==t&&e){this.folioData=Object.assign({},e);this.getPaymentTypes()}}handlePaymentTypesChange(e,t){if(e!==t&&e){this.getPaymentTypes()}}updateFolioData(e){this.folioData=Object.assign(Object.assign({},this.folioData),e)}async savePayment(){var e,t,i;try{this.isLoading=true;this.autoValidate=true;if(this.errors){this.errors=null}this.folioSchema.parse((e=this.folioData)!==null&&e!==void 0?e:{});await this.paymentService.AddPayment(Object.assign(Object.assign({},this.folioData),{currency:g.currency,reference:(t=this.folioData.reference)!==null&&t!==void 0?t:"",designation:((i=this.folioData.payment_type)===null||i===void 0?void 0:i.description)||""}),this.bookingNumber);this.resetBookingEvt.emit(null);this.resetExposedCancellationDueAmount.emit(null);this.closeModal.emit(null)}catch(e){const t={};if(e instanceof S){e.issues.forEach((e=>{t[e.path[0]]=true}))}console.error(e);this.errors=t}finally{this.isLoading=false}}handleDropdownChange(e){var t;e.stopImmediatePropagation();e.stopPropagation();const i=e.detail.toString();console.log(i);this.updateFolioData({designation:i});if(!e.detail){this.updateFolioData({payment_type:null})}else{const s=(t=this.paymentEntries)===null||t===void 0?void 0:t.types.find((e=>e.CODE_NAME===i));if(!s){console.warn(`Invalid payment type ${e.detail}`);this.updateFolioData({payment_type:null});return}this.updateFolioData({payment_type:{code:s.CODE_NAME,description:s.CODE_VALUE_EN,operation:s.NOTES},payment_method:K.includes(s.CODE_NAME)?undefined:{code:this.paymentEntries.methods[0].CODE_NAME,description:this.paymentEntries.methods[0].CODE_VALUE_EN,operation:this.paymentEntries.methods[0].NOTES}})}}handlePaymentMethodDropdownChange(e){var t;e.stopImmediatePropagation();e.stopPropagation();const i=e.detail.toString();const s=(t=this.paymentEntries)===null||t===void 0?void 0:t.methods.find((e=>e.CODE_NAME===i));if(!s){console.warn(`Invalid payment method ${e.detail}`);this.updateFolioData({payment_type:null});return}this.updateFolioData({payment_method:{code:s.CODE_NAME,description:s.CODE_VALUE_EN,operation:s.NOTES}})}async getPaymentTypes(){var e;const t=b(this.paymentEntries);if(this.mode==="payment-action"&&((e=this.payment.payment_type)===null||e===void 0?void 0:e.code)==="001"){const{PAYMENTS:e,CANCELLATION:i}=t;return this._paymentTypes={PAYMENTS:e,CANCELLATION:i}}this._paymentTypes=t}renderDropdownItems(){return Object.values(this._paymentTypes).map(((e,i)=>t(a,null,e.map((e=>t("ir-dropdown-item",{value:e.CODE_NAME,class:"dropdown-item-payment"},t("span",null,e.CODE_VALUE_EN),t("span",{class:`payment-type-badge ${e.NOTES==="CR"?"credit-badge":"debit-badge"}`},e.NOTES==="CR"?"credit":"debit")))),i!==Object.values(this._paymentTypes).length-1&&t("div",{class:"dropdown-divider"}))))}render(){var e,i,s,a,o,n,r,l,c,d,h,p,f,b,u,m,y,v,k,_,x,w,D,O,C,Y,M,I,T,E,S,j,A,N;return t("form",{key:"f40884ae756ee33dec916e99f104a1e6581bb265",class:"sheet-container",onSubmit:async e=>{e.preventDefault();this.savePayment()}},t("ir-title",{key:"cfe0387d78be97832c75963e44e33529a4f428c9",class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:this.mode==="edit"?"Edit Folio Entry":"New Folio Entry",displayContext:"sidebar"}),t("section",{key:"c86458c4b0789c26bceb3b85cfcd66d361dffa81",class:"px-1 sheet-body d-flex flex-column",style:{gap:"1rem"}},t("div",{key:"73ca30a899d884dfcd3a6d09de7e5eb927816335",class:"d-flex w-fill",style:{gap:"0.5rem"}},t("div",{key:"9cef0e985725a89ea68219970ab029250f269b09",class:"form-group  mb-0 flex-grow-1"},t("div",{key:"6b7f60a2821a84a279c8f1089a83ef16659f9995",class:"input-group row m-0 flex-grow-1"},t("div",{key:"64f3711f78919f296d06937f850c9e92d935acc4",class:`input-group-prepend col-4 col-md-3 p-0 text-dark border-0`},t("label",{key:"702875a8e61b86596ea624bd0496d41ba25c3e58",class:`input-group-text flex-grow-1 text-dark border-theme `},"Date")),t("div",{key:"210375f148d0f3f426462f0df5c064d8c3de1e68",class:"form-control  form-control-md col-10 flex-grow-1 d-flex align-items-center px-0 mx-0",style:{border:"0"}},t("style",{key:"9c134b045b46dc3571b7c4b4e4dd79c1b2dfe172"},`.ir-date-picker-trigger{\n                    width:100%;}`),t("ir-date-picker",{key:"9db2bf8957502c1f7d125e1ec29df73be9c06bfd","data-testid":"pickup_date",date:(e=this.folioData)===null||e===void 0?void 0:e.date,class:"w-100",emitEmptyDate:true,maxDate:B().format("YYYY-MM-DD"),"aria-invalid":((i=this.errors)===null||i===void 0?void 0:i.date)&&!((s=this.folioData)===null||s===void 0?void 0:s.date)?"true":"false",onDateChanged:e=>{var t;this.updateFolioData({date:(t=e.detail.start)===null||t===void 0?void 0:t.format("YYYY-MM-DD")})}},t("input",{key:"71b3174a7729f4c75c38f492fb1508c1a00e841f",type:"text",slot:"trigger",value:((a=this.folioData)===null||a===void 0?void 0:a.date)?B((o=this.folioData)===null||o===void 0?void 0:o.date).format("MMM DD, YYYY"):null,class:`form-control w-100 input-sm ${((n=this.errors)===null||n===void 0?void 0:n.date)&&!((r=this.folioData)===null||r===void 0?void 0:r.date)?"border-danger":""} text-left`,style:{borderTopLeftRadius:"0",borderBottomLeftRadius:"0",width:"100%"}})))))),t("div",{key:"f33d4da51512d71d5ec8f934e00c645e20590448"},t("ir-dropdown",{key:"0ca034d414005bbb9a0a9f8735034d85eb54ca95",value:(c=(l=this.folioData)===null||l===void 0?void 0:l.payment_type)===null||c===void 0?void 0:c.code,disabled:this.mode==="payment-action",onOptionChange:this.handleDropdownChange.bind(this)},t("div",{key:"a6c212a8da36317301faa91d02aad64d68c57f67",slot:"trigger",class:"input-group row m-0 "},t("div",{key:"37623d01e63245133239addfe5ef6a90274a854d",class:`input-group-prepend col-4 col-md-3 p-0 text-dark border-0`},t("label",{key:"bf7729d16cfe258915232ba83f197ff96cde2c8d",class:`input-group-text flex-grow-1 text-dark  border-theme`},"Transaction type")),t("button",{key:"7af752b7119d86ed8ac8f08ed3a7ffd586b40fd1",type:"button",disabled:this.mode==="payment-action",class:`form-control  d-flex align-items-center cursor-pointer ${((d=this.errors)===null||d===void 0?void 0:d.payment_type)&&!((p=(h=this.folioData)===null||h===void 0?void 0:h.payment_type)===null||p===void 0?void 0:p.code)?"border-danger":""}`},((f=this.folioData)===null||f===void 0?void 0:f.payment_type)?t("span",null,(b=this.folioData.payment_type)===null||b===void 0?void 0:b.description):t("span",null,"Select..."))),t("ir-dropdown-item",{key:"2cb31eb525689404c544c0b3c6f8e2e678771bea",value:""},"Select..."),this.renderDropdownItems())),K.includes((m=(u=this.folioData)===null||u===void 0?void 0:u.payment_type)===null||m===void 0?void 0:m.code)&&t("div",{key:"f37145e31c684eccc5d3ac36add676a0e126bcb5"},t("ir-dropdown",{key:"8860e301f2163db3856de1d79b7e80dd2a3eee0f",value:(v=(y=this.folioData)===null||y===void 0?void 0:y.payment_method)===null||v===void 0?void 0:v.code,onOptionChange:this.handlePaymentMethodDropdownChange.bind(this)},t("button",{key:"e58e98bf1245b3e076849c958cf23b088d373ba4",slot:"trigger",type:"button",class:`form-control d-flex align-items-center cursor-pointer ${((k=this.errors)===null||k===void 0?void 0:k.payment_method)&&!((x=(_=this.folioData)===null||_===void 0?void 0:_.payment_method)===null||x===void 0?void 0:x.code)?"border-danger":""}`},((w=this.folioData)===null||w===void 0?void 0:w.payment_method)?t("span",null,(D=this.folioData.payment_method)===null||D===void 0?void 0:D.description):t("span",null,"Select ",((C=(O=this.folioData)===null||O===void 0?void 0:O.payment_type)===null||C===void 0?void 0:C.code)==="001"?"payment":"refund"," method...")),t("ir-dropdown-item",{key:"933ddf081d8c66ca244d4caf6d52e9fe9931a793",value:""},"Select ",((Y=this.folioData.payment_type)===null||Y===void 0?void 0:Y.code)==="001"?"payment":"refund"," method..."),(I=(M=this.paymentEntries)===null||M===void 0?void 0:M.methods)===null||I===void 0?void 0:I.map((e=>t("ir-dropdown-item",{value:e.CODE_NAME,class:"dropdown-item-payment"},t("span",null,e.CODE_VALUE_EN)))))),t("div",{key:"93d48e4c3583ba2325230bc76f7275db062e03f4"},t("ir-price-input",{key:"b691cb26af662f11d036745031a954e910a86aec",containerClassname:"row",labelContainerClassname:"col-4 col-md-3 p-0 text-dark border-0",minValue:0,autoValidate:this.autoValidate,zod:this.folioSchema.pick({amount:true}),wrapKey:"amount",label:"Amount",labelStyle:"flex-grow-1 text-dark  border-theme",error:((T=this.errors)===null||T===void 0?void 0:T.amount)&&!((E=this.folioData)===null||E===void 0?void 0:E.amount),value:(j=(S=this.folioData)===null||S===void 0?void 0:S.amount)===null||j===void 0?void 0:j.toString(),currency:g.currency.symbol,onTextChange:e=>this.updateFolioData({amount:Number(e.detail)})})),t("div",{key:"8fcbba7978c829e541ce4a9c689695bc25ca4212"},t("ir-input-text",{key:"164568ee59585699982305ad6491b2b5a467dab4",value:(A=this.folioData)===null||A===void 0?void 0:A.reference,error:(N=this.errors)===null||N===void 0?void 0:N.reference_number,autoValidate:this.autoValidate,zod:this.folioSchema.pick({reference:true}),label:"Reference",maxLength:50,inputContainerStyle:{margin:"0"},onTextChange:e=>this.updateFolioData({reference:e.detail}),labelWidth:3,labelContainerClassname:"col-4 col-md-3"}))),t("div",{key:"9eec15b16bd957a91da04ea94dd65f0cb6d03b3b",class:"sheet-footer"},t("ir-button",{key:"e62344641cf855a87461f77d5b647657c2561c35",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`flex-fill`,text:"Cancel",btn_color:"secondary"}),t("ir-button",{key:"d66611638b87449377e720f45083137ccdd641a6",btn_styles:"justify-content-center align-items-center",class:"flex-fill",isLoading:this.isLoading,text:"Save",btn_color:"primary",btn_type:"submit"})))}static get watchers(){return{payment:["handlePaymentChange"],paymentTypes:["handlePaymentTypesChange"]}}};Dt.style=_t+wt;const Ot=".payment-item__payment-item.sc-ir-payment-item{display:flex;flex-direction:column;padding:0.25rem 0.5rem;min-height:2.5rem}.payment-item__payment-item.sc-ir-payment-item p.sc-ir-payment-item{padding:0;margin:0;box-sizing:border-box}.payment-item__payment-body.sc-ir-payment-item{display:flex;flex-direction:column}.payment-item__payment-fields.sc-ir-payment-item{display:flex;align-items:center;justify-content:space-between}.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item,.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-description.sc-ir-payment-item{display:none}.payment-item__payment-toolbar.sc-ir-payment-item{display:flex;align-items:center;justify-content:space-between}.payment-item__payment-toolbar.sc-ir-payment-item .payment-item__payment-amount.sc-ir-payment-item{display:none}.payment-item__action-button.sc-ir-payment-item{cursor:pointer}.payment-item__payment-amount.sc-ir-payment-item{font-weight:700;white-space:nowrap}.payment-item__payment-amount.is-credit.sc-ir-payment-item{color:#629a4c}.payment-item__payment-amount.is-debit.sc-ir-payment-item{color:#ff4961}.payment-item__payment-reference.sc-ir-payment-item{font-size:12px}@media (min-width: 640px){.payment-item__payment-item.sc-ir-payment-item{flex-direction:row;align-items:center;gap:1rem}.payment-item__payment-item.sc-ir-payment-item:hover{background:#f4f5fa}.payment-item__payment-item.sc-ir-payment-item .payment-item__payment-actions.sc-ir-payment-item{display:inline-flex}.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item,.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-description.sc-ir-payment-item,.payment-item__payment-item.sc-ir-payment-item .payment-item__payment-amount.sc-ir-payment-item{display:inline-flex}.payment-item__payment-fields.sc-ir-payment-item .payment-item__payment-amount.sc-ir-payment-item,.payment-item__payment-toolbar.sc-ir-payment-item .payment-item__payment-description.sc-ir-payment-item,.payment-item__payment-item.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item,.payment-item__payment-actions.sc-ir-payment-item{display:none}.payment-item__payment-description.sc-ir-payment-item{padding:0 0.5rem !important}.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item{display:inline-flex;align-items:center}.payment-item__payment-body.sc-ir-payment-item{flex:1 1 0%;justify-content:flex-start}.payment-item__payment-fields.sc-ir-payment-item{justify-content:flex-start;gap:0.5rem}.payment-item__payment-toolbar.sc-ir-payment-item{gap:0.5rem;align-items:center}}";const Ct=Ot;const Yt=class{constructor(t){e(this,t);this.editPayment=s(this,"editPayment",7);this.deletePayment=s(this,"deletePayment",7)}render(){var e,i,s,a,o;const n=this.payment.payment_type.operation==="CR";const r=(s=K.includes((e=this.payment.payment_type)===null||e===void 0?void 0:e.code)?`${(i=this.payment.payment_type)===null||i===void 0?void 0:i.description}: ${this.payment.payment_method.description}`:this.payment.payment_type.description)!==null&&s!==void 0?s:this.payment.designation;return t("div",{key:"f14355cf2dc0a450ff358a2ffbb40447c9370251",class:"payment-item__payment-item"},t("div",{key:"e67a171cd81998f3a87ee6df91553d1d4d8d90cb",class:"payment-item__payment-body",part:"payment-body"},t("div",{key:"402a3b3c4bbfdadcced05afce0c44c629a0f6014",class:"payment-item__payment-fields",part:"payment-fields"},t("p",{key:"04cc09aba81b8e824a05c786fc147a5067b3b8b9",class:"payment-item__payment-date"},B(this.payment.date,"YYYY-MM-DD").format("MMM DD, YYYY")),t("p",{key:"77c58921a82379b8fdcc134a2b479fb7e493f955",class:`payment-item__payment-amount ${n?"is-credit":"is-debit"}`},y(this.payment.currency.symbol,this.payment.amount)),t("p",{key:"e2c7ce298811f79b68fe23541f212ef81c715e11",class:"payment-item__payment-description"},r)),this.payment.reference&&t("p",{key:"9c49e2fd4a5eef3efe2dafbfb34481c5d03c8fb3",class:"payment-item__payment-reference"},(a=this.payment)===null||a===void 0?void 0:a.reference)),t("div",{key:"72b37423c8bb74f66e45b890fdc9dafc4d8b35e7",class:"payment-item__payment-toolbar"},t("p",{key:"850c7e18f93e95a035a27f2e10c04f70525c7830",class:`payment-item__payment-amount ${n?"is-credit":"is-debit"}`},y(this.payment.currency.symbol,this.payment.amount)),t("p",{key:"6fa990450391433ecf42f6666f618cc44ed8fea1",class:"payment-item__payment-description"},r),t("div",{key:"767cb15872a631d5b88e5a5823419590c568ef81",class:"payment-item__payment-actions"},t("div",{key:"f1d7b83a8cb4ba317353ff5380fd23404eaf4227",class:"d-flex align-items-center"},t("ir-popover",{key:"aa1ee523b5e4767f3187885aaace44eb92889142",trigger:"hover",content:`User: ${this.payment.time_stamp.user}`},t("ir-button",{key:"b650d7adfb8caaf2c57a208a727dfe10ca8a20ab",variant:"icon",style:{color:$.secondary["--icon-button-color"],"--icon-size":"1.1rem"},icon_name:"user"}))),t("ir-button",{key:"6511152004da5abb02af4111144e8ee6cf3fac89",class:"payment-item__action-button",variant:"icon",onClickHandler:()=>{this.editPayment.emit(this.payment)},icon_name:"edit",style:$.secondary}),t("ir-button",{key:"6350e6aace9723d440f1089800f76d00fe798bd6",class:"payment-item__action-button",onClickHandler:()=>{this.deletePayment.emit(this.payment)},variant:"icon",style:$.danger,icon_name:"trash"}))),this.payment.reference&&t("p",{key:"995711139af04f74b386a0c33c4465fcdc2fe747",class:"payment-item__payment-reference"},(o=this.payment)===null||o===void 0?void 0:o.reference))}};Yt.style=Ct;const Mt=".sc-ir-payment-summary-h{display:block}.sc-ir-payment-summary-h{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-payment-summary-h *.sc-ir-payment-summary{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}";const It=Mt;const Bt=class{constructor(t){e(this,t)}shouldShowTotalCost(){return this.totalCost>0&&this.totalCost!==null}render(){return t("div",{key:"f7c68209a510c67eb97f28200b9bea21102444aa",class:" m-0"},this.shouldShowTotalCost()&&t("div",{key:"8e7415851f986eb87953a1a5b0cb1d2ea783aadd",class:"mb-2 h4 total-cost-container"},u.entries.Lcz_TotalCost,":",t("span",{key:"94f97fca594bdd42c5971e01fbd52a2bb8ef70c5"},y(this.currency.symbol,this.totalCost))),t("div",{key:"ff43179a881bea8258cbe145160eaa8b90c41f44",class:"h4 d-flex align-items-center justify-content-between"},t("span",{key:"261ca114009459578ef1e88139c6b89176e00700"},u.entries.Lcz_Balance,": "),t("span",{key:"66e9b5e9db82b05caa437f8040a0526102e4591e",class:"danger font-weight-bold"},y(this.currency.symbol,this.balance))),!this.isBookingCancelled&&t("div",{key:"dc093eb9b946b99745409402a282a797a6d1a5b1",class:"mb-2 h4 d-flex align-items-center justify-content-between"},t("span",{key:"136c5fbacaac4b20a82b1352f8bac91ee056b7c3"},u.entries.Lcz_Collected,": "),t("span",{key:"3899e9b67403142fa2a371d1ede647bd4ad5ee1c"},y(this.currency.symbol,this.collected))))}};Bt.style=It;const Tt=".sc-ir-payments-folio-h{display:block}";const Et=Tt;const St=class{constructor(t){e(this,t);this.addPayment=s(this,"addPayment",7);this.editPayment=s(this,"editPayment",7);this.deletePayment=s(this,"deletePayment",7);this.payments=[];this.handleAddPayment=()=>{this.addPayment.emit()};this.handleEditPayment=e=>{this.editPayment.emit(e)};this.handleDeletePayment=e=>{this.deletePayment.emit(e)}}hasPayments(){return this.payments&&this.payments.length>0}renderPaymentItem(e,i){return[t("ir-payment-item",{key:e.id,payment:e,onDeletePayment:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDeletePayment(e.detail)},onEditPayment:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleEditPayment(e.detail)}}),i<this.payments.length-1&&t("hr",{class:"p-0 m-0"})]}renderEmptyState(){return t("div",{class:"text-center p-3"},t("p",{class:"text-muted"},"No payments recorded yet"))}render(){return t("div",{key:"b6738d0956f6b7a1e7caffbcc3b31e2f6154394e",class:"mt-1"},t("div",{key:"b17323e25a520fa480228831f364f3ccf68ed592",class:"d-flex flex-column rounded payment-container"},t("div",{key:"51bad2e192a6817c563153239f3f8bb240f1fa09",class:"d-flex align-items-center justify-content-between"},t("div",{key:"59af5991c2820a04ca052a76f360af67e80803ac",class:"d-flex align-items-center",style:{gap:"0.5rem"}},t("p",{key:"d9cf623bcb19232550fa22372dd221e1aaae8cc7",class:"font-size-large p-0 m-0"},"Guest Folio"),t(ke,{key:"3ae7c6c9173312f5cae39e886bcd2b7c76bcb19e",message:"Help",href:"https://help.igloorooms.com/extranet/booking-details/guest-folio"})),t("ir-button",{key:"1f47cbfef19eeddb3a211b188632aa0d27bb85de",id:"add-payment",variant:"icon",icon_name:"square_plus",style:{"--icon-size":"1.5rem"},onClickHandler:this.handleAddPayment})),t("div",{key:"ff4561e9f7adece2ec21cd8df04db292d98d1749",class:"mt-1 card p-1 payments-container"},this.hasPayments()?this.payments.map(((e,t)=>this.renderPaymentItem(e,t))):this.renderEmptyState())))}};St.style=Et;class jt{async savePickup(e,t,i){try{const s=e.arrival_time.split(":");await A.post(`/Do_Pickup`,{booking_nbr:t,is_remove:i,currency:e.currency,date:e.arrival_date,details:e.flight_details,hour:s[0],minute:s[1],nbr_of_units:e.number_of_vehicles,selected_option:e.selected_option,total:+e.due_upon_booking})}catch(e){console.log(e)}}transformDefaultPickupData(e){const t=e.hour&&e.minute?Y(e.hour)+":"+Y(e.minute):"";return{arrival_date:e.date,arrival_time:t,currency:e.currency,due_upon_booking:e.total.toFixed(2),flight_details:e.details,location:e.selected_option.location.id,number_of_vehicles:e.nbr_of_units,selected_option:e.selected_option,vehicle_type_code:e.selected_option.vehicle.code}}getAvailableLocations(e){let t=[];g.pickup_service.allowed_options.forEach((i=>{if(t.filter((e=>e.value===i.location.id)).length===0){t.push({text:e+" "+i.location.description,value:i.location.id})}}));return t}createPickupSchema(e,t){return E.object({arrival_date:E.string().regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Invalid date format, expected YYYY-MM-DD"}).refine((i=>{const s=B(i,"YYYY-MM-DD",true);const a=B(e,"YYYY-MM-DD",true);const o=B(t,"YYYY-MM-DD",true);return s.isValid()&&a.isValid()&&o.isValid()&&s.isBetween(a,o,undefined,"[]")}),{message:`arrival_date must be between ${e} and ${t}`}),arrival_time:E.string().regex(/^\d{2}:\d{2}$/,{message:"Invalid time format. Expected HH:MM"}).refine((e=>{const[t,i]=e.split(":").map(Number);return t>=0&&t<=23&&i>=0&&i<=59}),{message:"Time values are out of range"}),flight_details:E.string().nonempty({message:"Flight details cannot be empty"}),vehicle_type_code:E.string().nonempty({message:"Vehicle type code cannot be empty"}),number_of_vehicles:E.coerce.number().min(1,{message:"At least one vehicle is required"})})}validateForm(e,t){try{t.parse(e);return null}catch(e){console.log(e);const t={};if(e instanceof S){e.issues.forEach((e=>{t[e.path[0]]=true}));return t}}}getNumberOfVehicles(e,t){let i=Math.ceil(t/e);let s=i>1?i:1;let a=i>1?2:3;return Array.from({length:i+a},((e,t)=>s+t))}getPickUpPersonStatus(e){const t=g.pickup_service.allowed_pricing_models.find((t=>t.code===e));if(!t){return null}return t.description}updateDue(e){const t=this.getPickUpPersonStatus(e.code);if(!t){return}if(t==="Person"){return e.amount*e.numberOfPersons}else{return e.amount*e.number_of_vehicles}}}const At=".sc-ir-pickup-h{display:block}.custom-card-container.sc-ir-pickup{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e4e5ec}.card-title.sc-ir-pickup{flex:1}.border-theme.sc-ir-pickup{border:1px solid #cacfe7}@media (min-width: 768px){.price-input-container.sc-ir-pickup{max-width:290px}}";const Nt=At;const Lt=".sc-ir-pickup-h{height:100%}.sheet-container.sc-ir-pickup{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-pickup{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-pickup{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-pickup{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-pickup{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-pickup{flex-direction:row;align-items:center}}";const Rt=Lt;const $t=class{constructor(t){e(this,t);this.closeModal=s(this,"closeModal",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.numberOfPersons=0;this.isLoading=false;this.allowedOptionsByLocation=[];this.pickupData={location:-1,flight_details:"",due_upon_booking:"",number_of_vehicles:1,vehicle_type_code:"",currency:undefined,arrival_time:"",arrival_date:null,selected_option:undefined};this.vehicleCapacity=[];this.cause=null;this.autoValidate=false;this.pickupService=new jt;this.arrival_time_mask={mask:"HH:mm",blocks:{HH:{mask:U,from:0,to:23,placeholderChar:"H"},mm:{mask:U,from:0,to:59,placeholderChar:"m"}},lazy:false,placeholderChar:"_"}}componentWillLoad(){if(this.defaultPickupData){const e=this.pickupService.transformDefaultPickupData(this.defaultPickupData);this.vehicleCapacity=this.pickupService.getNumberOfVehicles(e.selected_option.vehicle.capacity,this.numberOfPersons);this.allowedOptionsByLocation=g.pickup_service.allowed_options.filter((t=>t.location.id===e.location));this.pickupData=Object.assign({},e)}this.pickupSchema=this.pickupService.createPickupSchema(this.bookingDates.from,this.bookingDates.to)}handleLocationChange(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;if(t===""){this.updatePickupData("location",-1)}if(t!==""){this.allowedOptionsByLocation=g.pickup_service.allowed_options.filter((e=>e.location.id.toString()===t));let e=this.allowedOptionsByLocation[0];if(!e){return}this.vehicleCapacity=this.pickupService.getNumberOfVehicles(e.vehicle.capacity,this.numberOfPersons);this.pickupData=Object.assign(Object.assign({},this.pickupData),{location:t,selected_option:e,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:e.amount,code:e.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:e.vehicle.code,currency:e.currency})}}handleVehicleQuantityChange(e){if(e.detail===""){return}const t=+e.detail;this.pickupData=Object.assign(Object.assign({},this.pickupData),{number_of_vehicles:t,due_upon_booking:this.pickupService.updateDue({amount:this.pickupData.selected_option.amount,code:this.pickupData.selected_option.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:t}).toFixed(2)})}handleVehicleTypeChange(e){if(e.detail===""){this.pickupData=Object.assign(Object.assign({},this.pickupData),{due_upon_booking:"",vehicle_type_code:""});return}let t=g.pickup_service.allowed_options.find((t=>t.location.id===+this.pickupData.location&&t.vehicle.code===e.detail));if(!t){return}this.vehicleCapacity=[...this.pickupService.getNumberOfVehicles(t.vehicle.capacity,this.numberOfPersons)];this.pickupData=Object.assign(Object.assign({},this.pickupData),{selected_option:t,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:this.pickupService.updateDue({amount:t.amount,code:t.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:this.vehicleCapacity[0]}).toFixed(2),vehicle_type_code:t.vehicle.code})}updatePickupData(e,t){this.pickupData=Object.assign(Object.assign({},this.pickupData),{[e]:t})}async savePickup(){try{this.isLoading=true;this.autoValidate=true;if(this.errors){this.errors=null}this.errors=this.pickupService.validateForm(this.pickupData,this.pickupSchema);if(this.errors){return}await this.pickupService.savePickup(this.pickupData,this.bookingNumber,this.defaultPickupData!==null&&this.pickupData.location===-1);this.resetBookingEvt.emit(null);this.closeModal.emit(null)}catch(e){console.error(e)}finally{this.isLoading=false}}render(){var e,i,s,a,o;return t("form",{key:"59c03f89c7f80e55a9549d9705c608dba1698690",class:"sheet-container",onSubmit:async e=>{e.preventDefault();await this.savePickup()}},t("ir-title",{key:"084af4c6bbb2a7855aa9eaa8827374ae8644288c",class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:u.entries.Lcz_Pickup,displayContext:"sidebar"}),t("section",{key:"54a2a11313b73e847146cc3f70004e0f378a3c24",class:"px-1 sheet-body"},t("ir-select",{key:"e52b201b6e85deb85a67617762e737fdfd45acfd",testId:"pickup_location",selectedValue:this.pickupData.location,selectContainerStyle:"mb-1",onSelectChange:this.handleLocationChange.bind(this),firstOption:u.entries.Lcz_Pickup_NoThankYou,class:"m-0 mb-1",data:this.pickupService.getAvailableLocations(u.entries.Lcz_Pickup_YesFrom)}),this.pickupData.location>0&&t("div",{key:"a8c665ad7f7c827172dd0fec2d7bdc643e5daf8b",class:"m-0 p-0","data-testid":"pickup_body"},t("div",{key:"58b2a14bdf6e923d4fdbf81ae7722e978c52286a",class:"d-flex"},t("div",{key:"c352055c1501bde417c443b847e82a5ef23ea103",class:"form-group  mr-1"},t("div",{key:"f0ccb813d77dbd1234bb202574ba356bf84e3162",class:"input-group row m-0"},t("div",{key:"ff2d864aab02ded55de6672c338361defa9a337e",class:`input-group-prepend col-5 p-0 text-dark border-0`},t("label",{key:"7adc960bdf5ec6229fafe97e9732ef1ce2e8ac81",class:`input-group-text  flex-grow-1 text-dark border-theme `},u.entries.Lcz_ArrivalDate)),t("div",{key:"2f5a77bef7975f3bb364bca3251e3e3b8cd57a18",class:"form-control  form-control-md col-7 d-flex align-items-center px-0 mx-0",style:{border:"0"}},t("ir-date-picker",{key:"22bc1f3982062b2a0dd68c8313d4285df9696ee5","data-testid":"pickup_arrival_date",date:this.pickupData.arrival_date,minDate:this.bookingDates.from,maxDate:(e=this.bookingDates)===null||e===void 0?void 0:e.to,emitEmptyDate:true,"aria-invalid":((i=this.errors)===null||i===void 0?void 0:i.arrival_date)&&!this.pickupData.arrival_date?"true":"false",onDateChanged:e=>{var t;this.updatePickupData("arrival_date",(t=e.detail.start)===null||t===void 0?void 0:t.format("YYYY-MM-DD"))}},t("input",{key:"58d50f8cd2486699d9373a99028dcacb7ee9df42",type:"text",slot:"trigger",value:this.pickupData.arrival_date?B(this.pickupData.arrival_date).format("MMM DD, YYYY"):null,class:`form-control input-sm ${((s=this.errors)===null||s===void 0?void 0:s.arrival_date)&&!this.pickupData.arrival_date?"border-danger":""} text-center`,style:{borderTopLeftRadius:"0",borderBottomLeftRadius:"0",width:"100%"}}))))),t("ir-input-text",{key:"dcc1b301f3f3720d217ea8dc4263804da970ec2d",autoValidate:this.autoValidate,wrapKey:"arrival_time",testId:"pickup_arrival_time",error:(a=this.errors)===null||a===void 0?void 0:a.arrival_time,value:this.pickupData.arrival_time,zod:this.pickupSchema.pick({arrival_time:true}),label:u.entries.Lcz_Time,inputStyles:"col-sm-4","data-state":this.cause==="arrival_time"?"error":"",mask:this.arrival_time_mask,onTextChange:e=>this.updatePickupData("arrival_time",e.detail)})),t("ir-input-text",{key:"a837c00aa70bb761f62a74ea111ce6ccb071426d",wrapKey:"flight_details",zod:this.pickupSchema.pick({flight_details:true}),autoValidate:this.autoValidate,testId:"pickup_flight_details",value:this.pickupData.flight_details,label:u.entries.Lcz_FlightDetails,onTextChange:e=>this.updatePickupData("flight_details",e.detail),placeholder:"",error:(o=this.errors)===null||o===void 0?void 0:o.flight_details}),t("ir-select",{key:"a452ad0e84e058deac3117dc15b963ef048328b5",testId:"pickup_vehicle_type_code",selectContainerStyle:"mb-1",error:this.cause==="vehicle_type_code",onSelectChange:this.handleVehicleTypeChange.bind(this),firstOption:u.entries.Lcz_Select,selectedValue:this.pickupData.vehicle_type_code,class:"m-0",data:this.allowedOptionsByLocation.map((e=>({text:e.vehicle.description,value:e.vehicle.code})))}),t("div",{key:"7487d1b9c92f5fcd7b8b54c72833e1e6df8c2616",class:"d-flex flex-column flex-md-row"},t("ir-select",{key:"f74be95becc3599735ce37b9443e6248846cdb15",showFirstOption:false,testId:"pickup_number_of_vehicles",labelBorder:"theme",selectContainerStyle:"mb-1",onSelectChange:this.handleVehicleQuantityChange.bind(this),selectedValue:this.pickupData.number_of_vehicles,error:this.cause==="number_of_vehicles",labelWidth:7,class:"m-0  mb-md-0 mr-md-1 flex-fill",label:u.entries.Lcz_NbrOfVehicles,data:this.vehicleCapacity.map((e=>({text:e,value:e})))}),t("div",{key:"1ed45676b6c8992b170991a312a59fabdfa32b5a",class:"price-input-container"},t("ir-price-input",{key:"c8c684cf83dcc9707cb36dd18f85c7d5f0e47f5b",readOnly:true,label:`${u.entries.Lcz_DueUponBooking}`,value:this.pickupData.due_upon_booking,currency:this.pickupData.currency.symbol}))))),t("div",{key:"aac0a45eb1ceb416e4b0704ebd10393076b263d3",class:"sheet-footer"},t("ir-button",{key:"e857540cb05e0b7551d678f9880ae4c9b48dc7bc",onClick:()=>this.closeModal.emit(null),btn_styles:"justify-content-center",class:`flex-fill`,text:u.entries.Lcz_Cancel,btn_color:"secondary"}),(this.defaultPickupData||this.pickupData.location!==-1)&&t("ir-button",{key:"c366bed7d5afe774666b41ac4e0b3c51ba5e9963",btn_styles:"justify-content-center align-items-center",class:"flex-fill",isLoading:this.isLoading,text:u.entries.Lcz_Save,btn_color:"primary",btn_type:"submit"})))}get el(){return o(this)}};$t.style=Nt+Rt;const Pt=".sc-ir-pickup-view-h{display:block}";const zt=Pt;const Gt=class{constructor(t){e(this,t)}render(){if(!g.pickup_service.is_enabled||!this.booking.is_editable){return null}return t(i,null,t("div",{class:"mb-1"},t("div",{class:"d-flex w-100 mb-1 align-items-center justify-content-between"},t("p",{class:"font-size-large p-0 m-0 "},u.entries.Lcz_Pickup),t("ir-button",{id:"pickup","data-testid":"new_pickup_btn",variant:"icon",icon_name:"edit",style:Object.assign(Object.assign({},$.secondary),{"--icon-size":"1.5rem"})})),this.booking.pickup_info&&t("div",{class:"card"},t("div",{class:"p-1"},t("div",{class:"d-flex align-items-center py-0 my-0 pickup-margin"},t("p",{class:"font-weight-bold mr-1 py-0 my-0"},u.entries.Lcz_Date,": ",t("span",{class:"font-weight-normal"},B(this.booking.pickup_info.date,"YYYY-MM-DD").format("MMM DD, YYYY"))),this.booking.pickup_info.hour&&this.booking.pickup_info.minute&&t("p",{class:"font-weight-bold flex-fill py-0 my-0"},u.entries.Lcz_Time,":",t("span",{class:"font-weight-normal"}," ",z(this.booking.pickup_info.hour.toString(),this.booking.pickup_info.minute.toString()))),t("p",{class:"font-weight-bold py-0 my-0"},u.entries.Lcz_DueUponBooking,":"," ",t("span",{class:"font-weight-normal"},this.booking.pickup_info.currency.symbol,this.booking.pickup_info.total))),t("p",{class:"font-weight-bold py-0 my-0"},u.entries.Lcz_FlightDetails,":",t("span",{class:"font-weight-normal"}," ",`${this.booking.pickup_info.details}`)),t("p",{class:"py-0 my-0 pickup-margin"},`${this.booking.pickup_info.selected_option.vehicle.description}`),t("p",{class:"font-weight-bold py-0 my-0 pickup-margin"},u.entries.Lcz_NbrOfVehicles,":",t("span",{class:"font-weight-normal"}," ",`${this.booking.pickup_info.nbr_of_units}`)),t("p",{class:"small py-0 my-0 pickup-margin"},g.pickup_service.pickup_instruction.description,g.pickup_service.pickup_cancelation_prepayment.description)))))}};Gt.style=zt;const Kt=".sc-ir-pms-logs-h{display:block}.dialog-container-height.sc-ir-pms-logs{height:4rem}.list-title.sc-ir-pms-logs{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-pms-logs{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-pms-logs{color:#629a4c;font-weight:600}.list-item.red.sc-ir-pms-logs{color:#ff4961;font-weight:600}";const Ut=Kt;const Ht=class{constructor(t){e(this,t);this.bookingService=new l}componentWillLoad(){this.init()}async init(){try{this.pmsLogs=await this.bookingService.fetchPMSLogs(this.bookingNumber)}catch(e){console.error(e)}}render(){var e,i,s,a,o,n,r,l;return t("div",{key:"592767c53ab594e9a19f1260d4e01177c4dbdd60",class:"p-1"},t("h3",{key:"27b196b55e89af41abf88f5d1318e9647012ef42",class:" text-left mb-1 dialog-title "},u.entries.Lcz_PMS_Logs),T("/Get_Exposed_PMS_Logs")?t("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},t("ir-spinner",null)):t("div",{class:"dialog-container-height"},t("div",{class:"d-flex align-items-center ",style:{paddingBottom:"0.5rem"}},t("p",{class:"list-title p-0 m-0"},u.entries.Lcz_SentAt),((e=this.pmsLogs)===null||e===void 0?void 0:e.sent_date)?t("p",{class:"list-item"},(i=this.pmsLogs)===null||i===void 0?void 0:i.sent_date," ",z((s=this.pmsLogs)===null||s===void 0?void 0:s.sent_hour.toString(),(a=this.pmsLogs)===null||a===void 0?void 0:a.sent_minute.toString())):t("p",{class:`list-item ${((o=this.pmsLogs)===null||o===void 0?void 0:o.sent_date)?"green":"red"}`},((n=this.pmsLogs)===null||n===void 0?void 0:n.is_acknowledged)?u.entries.Lcz_YES:u.entries.Lcz_NO)),t("div",{class:"d-flex align-items-center p-0 m-0"},t("h4",{class:"list-title p-0 m-0"},u.entries.Lcz_Acknowledged),t("p",{class:`list-item  ${((r=this.pmsLogs)===null||r===void 0?void 0:r.is_acknowledged)?"green":"red"}`},((l=this.pmsLogs)===null||l===void 0?void 0:l.is_acknowledged)?u.entries.Lcz_YES:u.entries.Lcz_NO))))}};Ht.style=Ut;const Ft=".sc-ir-reservation-information-h{display:block}";const Vt=Ft;const Wt=class{constructor(t){e(this,t);this.openSidebar=s(this,"openSidebar",7);this.userCountry=null}componentWillLoad(){var e,t,i;const s=(t=(e=this.booking)===null||e===void 0?void 0:e.guest)===null||t===void 0?void 0:t.country_id;this.userCountry=s?((i=this.countries)===null||i===void 0?void 0:i.find((e=>e.id===s)))||null:null}handleEditClick(e,t){e.stopImmediatePropagation();e.stopPropagation();this.openSidebar.emit({type:t})}renderPhoneNumber(){const{mobile_without_prefix:e,country_phone_prefix:t,country_id:i}=this.booking.guest;if(!e){return null}if(t){return t+" "+e}if(i){const t=this.countries.find((e=>e.id===i));if(!t){throw new Error("Invalid country id")}return t.phone_prefix+" "+e}return e}render(){var e,i,s,a,o,n;const r=O(this.booking.extras);return t("div",{key:"07ac2f78e7d5b151f53885c06275e1eb7574e658",class:"card"},t("div",{key:"1fa6bae9e00889d180a5b7198cfa28b6ccce13ca",class:"p-1"},t("p",{key:"14d63ac38a8fa65374f5069613d770d3167a1ece"},this.booking.property.name||""),t("ir-label",{key:"a1c74885ac1b3ab6f3ca4ed2c5c01f618deb2192",labelText:`${u.entries.Lcz_Source}:`,content:this.booking.origin.Label,image:{src:this.booking.origin.Icon,alt:this.booking.origin.Label}}),t("ir-label",{key:"2fc94b1f57f20c5fc054ad69aa4201e2c056b263",renderContentAsHtml:true,labelText:`${u.entries.Lcz_BookedOn}:`,content:`${P(this.booking.booked_on.date)}&nbsp&nbsp&nbsp&nbsp${z(this.booking.booked_on.hour.toString(),this.booking.booked_on.minute.toString())}`}),t("ir-label",{key:"984523424cd1c3c372f797bc533caae65e72d943",labelText:`${u.entries.Lcz_BookedBy}:`,content:`${this.booking.guest.first_name} ${this.booking.guest.last_name}`},((e=this.booking.guest)===null||e===void 0?void 0:e.nbr_confirmed_bookings)>1&&!this.booking.agent&&t("div",{key:"40c7e66c314834363501de6f182a3602de4f2617",class:"m-0 p-0",slot:"prefix"},t("ir-tooltip",{key:"d6850e5bc4a31d3696a22291547fdc4368f242ad",message:`${u.entries.Lcz_BookingsNbr}`.replace("%1",this.booking.guest.nbr_confirmed_bookings.toString()),customSlot:true},t("div",{key:"0006d7c53bf9499808d7099d3da75e88ff0d0ced",class:"d-flex align-items-center m-0 p-0",slot:"tooltip-trigger",style:{gap:"0.25rem"}},t("p",{key:"0cf3c1501ec08d1bb74095d5bf67a53eb2c0b274",class:"p-0 m-0",style:{color:"#FB0AAD"}},this.booking.guest.nbr_confirmed_bookings),t("ir-icons",{key:"577d5a0fb793ba946689c7bf85faec61aabcecfc",style:{"--icon-size":"1rem"},color:"#FB0AAD",name:"heart-fill"})))),t("ir-button",{key:"1adca33a494c4a15cc11d865adf82b2cae03a1be",slot:"suffix",variant:"icon",icon_name:"edit",style:Object.assign(Object.assign({},$.secondary),{"--icon-size":"1.1rem"}),onClickHandler:e=>this.handleEditClick(e,"guest")})),this.booking.guest.mobile&&t("ir-label",{key:"4147fb2f9f7c6fb87719930dae9aa0a69aa9542f",labelText:`${u.entries.Lcz_Phone}:`,content:this.renderPhoneNumber()}),!this.booking.agent&&t("ir-label",{key:"52a7ec835c277ca98fcaab6c28a175d17df6bac7",labelText:`${u.entries.Lcz_Email}:`,content:this.booking.guest.email}),this.booking.guest.alternative_email&&t("ir-label",{key:"f4c9de62e2350d61a0d1b2b9f8edd761d1c495ff",labelText:`${u.entries.Lcz_AlternativeEmail}:`,content:this.booking.guest.alternative_email}),((s=(i=this.booking)===null||i===void 0?void 0:i.guest)===null||s===void 0?void 0:s.address)&&t("ir-label",{key:"8bc5955bd24ae80cf333bbd4d45054441b9076ec",labelText:`${u.entries.Lcz_Address}:`,content:this.booking.guest.address}),this.userCountry&&t("ir-label",{key:"36e753f901af1241262c252864600f97a665954d",labelText:`${u.entries.Lcz_Country}:`,isCountryImage:true,content:this.userCountry.name,image:{src:this.userCountry.flag,alt:this.userCountry.name}}),((a=this.booking.guest)===null||a===void 0?void 0:a.notes)&&t("ir-label",{key:"3e4b59758677f7a416cb0eae3e427b3fab81a2b5",display:"inline",labelText:`${u.entries.Lcz_GuestPrivateNote}:`,content:(o=this.booking.guest)===null||o===void 0?void 0:o.notes}),this.booking.is_direct&&t("ir-label",{key:"107de6632e2068de398865e5c9c704a8219f72f8",labelText:`${u.entries.Lcz_ArrivalTime}:`,content:this.booking.arrival.description}),this.booking.promo_key&&t("ir-label",{key:"853784df9f6cde30a22b99515623992f4be36b5f",labelText:`${u.entries.Lcz_Coupon}:`,content:this.booking.promo_key}),this.booking.is_in_loyalty_mode&&!this.booking.promo_key&&t("div",{key:"9f1b78dd5d65973066c2bbbc00eb5dffd0961083",class:"d-flex align-items-center"},t("svg",{key:"140b68bbfab15b3a82bd6baa781e52c65688c219",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},t("path",{key:"baae797cafd585c744713857c4aabd8961604a05",fill:"#fc6c85",d:"M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"})),t("p",{key:"f6934dde27086158d31c63e05226e3babc7b7f91",class:"m-0 p-0 ml-1"},u.entries.Lcz_LoyaltyDiscountApplied)),this.booking.is_direct?t("ir-label",{labelText:`${u.entries.Lcz_GuestRemark}:`,display:"inline",content:this.booking.remark}):t("ota-label",{class:"m-0 p-0",label:`${u.entries.Lcz_ChannelNotes||"Channel notes"}:`,remarks:this.booking.ota_notes,maxVisibleItems:(n=this.booking.ota_notes)===null||n===void 0?void 0:n.length}),t("div",{key:"0a39ae317ff4850710e4117be8424a83ef789c14",class:"d-flex align-items-center justify-content-between"},t("ir-label",{key:"7e421a18a777604f2f3f4a0097bb077abf1316cc",labelText:`${u.entries.Lcz_BookingPrivateNote}:`,placeholder:u.entries.Lcz_VisibleToHotelOnly,content:r,display:r?"inline":"flex"}),t("ir-button",{key:"9e1462be2cd271d1b1735019e3c3a8f3300975ca",variant:"icon",icon_name:"edit",style:$.secondary,onClickHandler:e=>this.handleEditClick(e,"extra_note")}))))}};Wt.style=Vt;const qt=".light-blue-bg.sc-ir-room{background:#acecff;padding:0.1rem 0.3rem;border-radius:5px;display:block;max-width:100px;box-sizing:border-box;display:inline-block;overflow:hidden;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:default}.room_statements.sc-ir-room{display:block;width:100%}.room_statements.sc-ir-room{display:block;width:100%}.room_statements.sc-ir-room span.sc-ir-room{display:inline;white-space:normal;line-height:1.5;word-break:break-word}.room_statements.sc-ir-room b.sc-ir-room{display:inline;margin-right:5px}.payment-container.sc-ir-room{position:absolute;right:1rem;height:fit-content}.sc-ir-room-h{position:relative}.sm-mr.sc-ir-room{margin-right:3px}.subtotal_row.sc-ir-room{padding-top:8px;font-weight:600}.room_actions_btns.sc-ir-room{gap:0.5rem}.night-cost.sc-ir-room{color:#7cbebe}.room_actions_btns.sc-ir-room{white-space:nowrap;width:max-content}.room_actions_btns.sc-ir-room{flex:1 1 0%;display:flex;justify-content:flex-end}.mx-0-5.sc-ir-room{margin-left:2px !important;margin-right:2px !important}.tax-width.sc-ir-room{font-size:10px}.sm-mb-1.sc-ir-room{margin-bottom:5px !important}.sm-mt-1.sc-ir-room{margin-top:5px !important}.mx-01.sc-ir-room{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}";const Xt=qt;const Qt=class{constructor(t){e(this,t);this.deleteFinished=s(this,"deleteFinished",7);this.toast=s(this,"toast",7);this.pressCheckIn=s(this,"pressCheckIn",7);this.pressCheckOut=s(this,"pressCheckOut",7);this.editInitiated=s(this,"editInitiated",7);this.resetbooking=s(this,"resetbooking",7);this.openSidebar=s(this,"openSidebar",7);this.currency="USD";this.language="en";this.hasRoomEdit=false;this.hasRoomDelete=false;this.hasRoomAdd=false;this.hasCheckIn=false;this.hasCheckOut=false;this.collapsed=false;this.isLoading=false;this.modalReason=null;this.isModelOpen=false;this.bookingService=new l}componentWillLoad(){this.mainGuest=this.getMainGuest()}handleClick(e){let t=e.target;if(t.id=="checkin"){this.pressCheckIn.emit(this.room)}else if(t.id=="checkout"){this.pressCheckOut.emit(this.room)}}handleRoomDataChange(){this.mainGuest=this.getMainGuest()}getDateStr(e,t="default"){return e.getDate()+" "+e.toLocaleString(t,{month:"short"})+" "+e.getFullYear()}handleEditClick(){var e,t,i,s,a,o,n,r;this.editInitiated.emit({event_type:"EDIT_BOOKING",ID:this.room["assigned_units_pool"],NAME:M((e=this.mainGuest)===null||e===void 0?void 0:e.first_name,(t=this.mainGuest)===null||t===void 0?void 0:t.last_name),EMAIL:this.booking.guest.email,PHONE:this.booking.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.booking.from_date,TO_DATE:this.booking.to_date,TITLE:`${u.entries.Lcz_EditBookingFor} ${(s=(i=this.room)===null||i===void 0?void 0:i.roomtype)===null||s===void 0?void 0:s.name} ${((o=(a=this.room)===null||a===void 0?void 0:a.unit)===null||o===void 0?void 0:o.name)||""}`,defaultDateRange:{dateDifference:this.room.days.length,fromDate:new Date(this.room.from_date+"T00:00:00"),fromDateStr:this.getDateStr(new Date(this.room.from_date+"T00:00:00")),toDate:new Date(this.room.to_date+"T00:00:00"),toDateStr:this.getDateStr(new Date(this.room.to_date+"T00:00:00")),message:""},bed_preference:this.room.bed_preference,adult_child_offering:this.room.rateplan.selected_variation.adult_child_offering,ADULTS_COUNT:this.room.rateplan.selected_variation.adult_nbr,ARRIVAL:this.booking.arrival,ARRIVAL_TIME:this.booking.arrival.description,BOOKING_NUMBER:this.booking.booking_nbr,cancelation:this.room.rateplan.cancelation,channel_booking_nbr:this.booking.channel_booking_nbr,CHILDREN_COUNT:this.room.rateplan.selected_variation.child_nbr,COUNTRY:this.booking.guest.country_id,ENTRY_DATE:this.booking.from_date,FROM_DATE_STR:this.booking.format.from_date,guarantee:this.room.rateplan.guarantee,GUEST:this.mainGuest,IDENTIFIER:this.room.identifier,is_direct:this.booking.is_direct,IS_EDITABLE:this.booking.is_editable,NO_OF_DAYS:this.room.days.length,NOTES:this.booking.remark,origin:this.booking.origin,POOL:this.room["assigned_units_pool"],PR_ID:(n=this.room.unit)===null||n===void 0?void 0:n.id,RATE:this.room.total,RATE_PLAN:this.room.rateplan.name,RATE_PLAN_ID:this.room.rateplan.id,RATE_TYPE:this.room.roomtype.id,ROOMS:this.booking.rooms,SOURCE:this.booking.source,SPLIT_BOOKING:false,STATUS:"IN-HOUSE",TO_DATE_STR:this.booking.format.to_date,TOTAL_PRICE:this.booking.total,legendData:this.legendData,roomsInfo:this.roomsInfo,roomName:((r=this.room.unit)===null||r===void 0?void 0:r.name)||"",PICKUP_INFO:this.booking.pickup_info,booking:this.booking,currentRoomType:this.room})}openModal(e){if(!e){return}this.modalReason=e;this.modal.openModal()}async handleModalConfirmation(e){try{e.stopImmediatePropagation();e.stopPropagation();if(!this.modalReason){return}this.isLoading=true;switch(this.modalReason){case"delete":await this.deleteRoom();break;case"checkin":case"checkout":await this.bookingService.handleExposedRoomInOut({booking_nbr:this.booking.booking_nbr,room_identifier:this.room.identifier,status:this.modalReason==="checkin"?"001":"002"});this.resetbooking.emit(null);break}}catch(e){console.log(e)}finally{this.isLoading=false;this.modalReason=null;this.modal.closeModal()}}async deleteRoom(){let e=[...this.booking.rooms];e=e.filter((e=>e.identifier!==this.room.identifier));const t={assign_units:true,check_in:true,is_pms:true,is_direct:true,booking:{booking_nbr:this.booking.booking_nbr,from_date:this.booking.from_date,to_date:this.booking.to_date,remark:this.booking.remark,property:this.booking.property,source:this.booking.source,currency:this.booking.currency,arrival:this.booking.arrival,guest:this.booking.guest,rooms:e},extras:this.booking.extras,pickup_info:this.booking.pickup_info};await this.bookingService.doReservation(t);this.deleteFinished.emit(this.room.identifier)}async updateDepartureTime(e){try{await this.bookingService.setDepartureTime({property_id:this.property_id,code:e,room_identifier:this.room.identifier});this.toast.emit({type:"success",description:"",title:"Saved Successfully",position:"top-right"})}catch(e){console.log(e)}}formatVariation({infant_nbr:e,adult_nbr:t,children_nbr:i}){const s=t>0?t:0;const a=i>0?i:0;const o=e>0?e:0;const n=s>1?u.entries.Lcz_Adults.toLowerCase():u.entries.Lcz_Adult.toLowerCase();const r=a>1?u.entries.Lcz_Children.toLowerCase():u.entries.Lcz_Child.toLowerCase();const l=o>1?u.entries.Lcz_Infants.toLowerCase():u.entries.Lcz_Infant.toLowerCase();const c=[];if(s>0){c.push(`${s} ${n}`)}if(a>0){c.push(`${a} ${r}`)}if(o>0){c.push(`${o} ${l}`)}return c.join("&nbsp&nbsp&nbsp&nbsp")}getSmokingLabel(){var e,t,i;if(this.booking.is_direct){if(!this.room.smoking_option){return null}const i=g.roomsInfo.find((e=>e.id===this.room.roomtype.id));if(i){const s=(e=i["smoking_option"])===null||e===void 0?void 0:e.allowed_smoking_options;if(s){return(t=s.find((e=>e.code===this.room.smoking_option)))===null||t===void 0?void 0:t.description}return null}return null}return(i=this.room.ota_meta)===null||i===void 0?void 0:i.smoking_preferences}getBedName(){var e,t;if(this.booking.is_direct){const t=this.bedPreferences.find((e=>{var t,i;return e.CODE_NAME===((i=(t=this.room)===null||t===void 0?void 0:t.bed_preference)===null||i===void 0?void 0:i.toString())}));if(!t){return}return(e=t[`CODE_VALUE_${this.language}`])!==null&&e!==void 0?e:t.CODE_VALUE_EN}return(t=this.room.ota_meta)===null||t===void 0?void 0:t.bed_preferences}renderModalMessage(){switch(this.modalReason){case"delete":return`${u.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${this.room.roomtype.name} ${this.room.unit?this.room.unit.name:""} ${u.entries.Lcz_FromThisBooking}`;case"checkin":return`Are you sure you want to Check In this unit?\n`;case"checkout":return`Are you sure you want to Check Out this unit?`;default:return""}}handleCheckIn(){const{adult_nbr:e,children_nbr:t,infant_nbr:i}=this.room.occupancy;if(this.room.sharing_persons.length<e+t+i){return this.showGuestModal()}return this.renderModalMessage()}getMainGuest(){var e;return(e=this.room.sharing_persons)===null||e===void 0?void 0:e.find((e=>e.is_main))}render(){var e,s,o,n;const r=this.getBedName();return t(i,{key:"1d6c4ba57e4728e2161677523d4bfa4d6eda733b",class:"p-1 d-flex m-0"},t("ir-button",{key:"27f4ad0137740fda63aee5819ffeb92a91d367a8",variant:"icon",id:"drawer-icon","data-toggle":"collapse","data-target":`#roomCollapse-${(e=this.room.identifier)===null||e===void 0?void 0:e.split(" ").join("")}`,"aria-expanded":this.collapsed?"true":"false","aria-controls":"myCollapse",class:"mr-1",icon_name:this.collapsed?"closed_eye":"open_eye",onClickHandler:()=>{this.collapsed=!this.collapsed},style:{"--icon-size":"1.6rem"}}),t("div",{key:"6341a299124a56d0be5d409d19022be810dca92d",class:"flex-fill m-0 "},t("div",{key:"8b0d3b521a64da08e89f5e4ee67f71869721525d",class:"d-flex align-items-start justify-content-between sm-mb-1"},t("p",{key:"f1230a595b180e769fd37812c11e0548bd348eaf",class:"m-0 p-0"},t("span",{key:"8cceb6e15aa89fe96886c8705fa5db1c0409476e",class:"m-0 p-0",style:{fontWeight:"600"}},this.myRoomTypeFoodCat||""," ")," ",this.mealCodeName," ",this.room.rateplan.is_non_refundable&&` - ${u.entries.Lcz_NonRefundable}`," "),t("div",{key:"452562d5b456ee0e7c2681a33de1d8d82b5de8fa",class:"d-flex m-0 p-0 align-items-center room_actions_btns"},t("span",{key:"91b52500225a64f235e247b3e04a0f0a783a4b1e",class:"p-0 m-0 font-weight-bold"},y(this.currency,this.room["gross_total"])),this.hasRoomEdit&&this.isEditable&&t("ir-button",{key:"380d24ad432aa616ac02eaa77fe4c7940f32f181",id:`roomEdit-${this.room.identifier}`,variant:"icon",icon_name:"edit",style:$.secondary,onClickHandler:this.handleEditClick.bind(this)}),this.hasRoomDelete&&this.isEditable&&t("ir-button",{key:"cdf07d0bbc8ae359d0c72bd0e7da57d8048f9462",variant:"icon",onClickHandler:this.openModal.bind(this,"delete"),id:`roomDelete-${this.room.identifier}`,icon_name:"trash",style:$.danger}))),t("div",{key:"1588c7c271a5820f88aa0f5613b4d36e1818f11b",class:"d-flex align-items-center sm-mb-1"},t("ir-date-view",{key:"6eb838abc06b760e281fd03cb51b537c37bea725",class:"mr-1  flex-grow-1",style:{width:"fit-content"},from_date:this.room.from_date,to_date:this.room.to_date,showDateDifference:false}),!m(this.room.roomtype.id)&&g.is_frontdesk_enabled&&this.room.unit&&t("div",{key:"a4ea706974c060b1e013989ba8bdec6fe35bd0a4",class:"d-flex justify-content-center align-items-center"},t("ir-tooltip",{key:"4db7cc9032f4b9071c61c1fa63233fa88dbf913c",message:this.room.unit.name,customSlot:true},t("span",{key:"f04e553ded277c940d1f48e6c1288fe6975b6c11",slot:"tooltip-trigger",class:`light-blue-bg  ${this.hasCheckIn||this.hasCheckOut?"mr-2":""} `},this.room.unit.name))),this.hasCheckIn&&t("ir-button",{key:"3c5b97182a4cecb2542b66068768de2e25f3c37d",onClickHandler:this.handleCheckIn.bind(this),id:"checkin",btn_color:"outline",size:"sm",text:u.entries.Lcz_CheckIn}),this.hasCheckOut&&t("ir-button",{key:"38f926f4a9245337f4a5735b801ab5127109fb87",onClickHandler:this.openModal.bind(this,"checkout"),id:"checkout",btn_color:"outline",size:"sm",text:u.entries.Lcz_CheckOut})),t("div",{key:"6f8590b9c902b55df0c9140024886bad77a6590b",class:"d-flex align-items-center",style:{gap:"0.5rem"}},t("p",{key:"6012b45a27ec1eff51e0a05ecb70b877d3cec78c",class:"m-0 p-0"},`${this.mainGuest.first_name||""} ${this.mainGuest.last_name||""}`),this.room.rateplan.selected_variation.adult_nbr>0&&(this.room.unit?t("ir-tooltip",{message:"View guests",class:"m-0 p-0",customSlot:true},t("ir-button",{class:"m-0 p-0",slot:"tooltip-trigger",btn_color:"link",renderContentAsHtml:true,onClickHandler:()=>this.showGuestModal(),size:"sm",btnStyle:{width:"fit-content",margin:"0",padding:"0",fontSize:"inherit",textAlign:"center",lineHeight:"1.2"},text:this.formatVariation(this.room.occupancy)})):t("span",{innerHTML:this.formatVariation(this.room.occupancy)})),r&&t("p",{key:"eaf4ca94d1812f8dfd41346f93fab06fd2e69b1c",class:"m-0 p-0"},"(",r,")")),this.includeDepartureTime&&t("div",{key:"76cf3a9cc5064e799ff69c639db15e66017adfa1",class:"d-flex align-items-center",style:{marginTop:"0.5rem",marginBottom:"0.875rem",gap:"0.5rem"}},t("p",{key:"6f1e9b115828fbc255775fcfe59113a5f98613d9",class:"m-0 p-0"},"Expected departure time:"),t("ir-select",{key:"223806b53c272aaa8a16b8e6e7704b531744a820",selectedValue:(s=this.room.departure_time)===null||s===void 0?void 0:s.code,showFirstOption:false,onSelectChange:e=>{this.updateDepartureTime(e.detail)},data:(o=this.departureTime)===null||o===void 0?void 0:o.map((e=>{var t,i;return{text:(i=e[`CODE_VALUE_${(t=this.language)===null||t===void 0?void 0:t.toUpperCase()}`])!==null&&i!==void 0?i:e[`CODE_VALUE_EN`],value:e.CODE_NAME}}))})),t("div",{key:"3f84ec9c0e91b3740d96962a0318d03de00de5ec",class:"collapse",id:`roomCollapse-${(n=this.room.identifier)===null||n===void 0?void 0:n.split(" ").join("")}`},t("div",{key:"9ab639e5f14a72a019202135599cdc9ba40332da",class:"d-flex sm-mb-1 sm-mt-1"},t("div",{key:"90ba978fbe4ee17d16b8c03f82ce9c20f7c6360b",class:" sm-padding-top"},t("p",{key:"4baf3d6681dbdb1c3166f877bb1dd465f3aea63f",class:"sm-padding-right",style:{fontWeight:"600"}},`${u.entries.Lcz_Breakdown}:`)),t("div",{key:"8fba992d7e9bb8439d5147fc983ab7781852e1b1",class:"flex-fill"},t("table",{key:"c4b2700152404805c3b60f3d1485ae518689da91"},this.room.days.length>0&&this.room.days.map((e=>t("tr",null,t("td",{class:"pr-2 text-right"},G(e.date)),t("td",{class:"text-right"},y(this.currency,e.amount)),e.cost>0&&e.cost!==null&&t("td",{class:"pl-2 text-left night-cost"},y(this.currency,e.cost))))),t("tr",{key:"385b090569e432abda8501ab7eeabea8304fa223",class:""},t("th",{key:"581c1cc45e15a99fe50bb38a30b7915c6131b79b",class:"text-right pr-2 subtotal_row"},u.entries.Lcz_SubTotal),t("th",{key:"cd2119154ce4a21dfa399d147e37d496653a2216",class:"text-right subtotal_row"},y(this.currency,this.room.total)),this.room.gross_cost>0&&this.room.gross_cost!==null&&t("th",{key:"cce65347060e430d20c36131a30e2b02f55a4468",class:"pl-2 text-right night-cost"},y(this.currency,this.room.cost))),this.booking.is_direct?t(a,null,(()=>{const e=g.taxes.filter((e=>e.pct>0));return e.map((e=>t("tr",null,t("td",{class:"text-right pr-2"},e.is_exlusive?u.entries.Lcz_Excluding:u.entries.Lcz_Including," ",e.name," (",e.pct,"%)"),t("td",{class:"text-right"},y(this.currency,this.room.total*e.pct/100)),this.room.gross_cost>0&&this.room.gross_cost!==null&&t("td",{class:"pl-2 text-right night-cost"},y(this.currency,this.room.cost*e.pct/100)))))})()):t(a,null,(()=>{const e=this.room.ota_taxes.filter((e=>e.amount>0));return e.map((e=>t("tr",null,t("td",{class:"text-right pr-2"},e.is_exlusive?u.entries.Lcz_Excluding:u.entries.Lcz_Including," ",e.name),t("td",{class:"text-right"},e.currency.symbol,e.amount))))})())))),t("ir-label",{key:"d910c723df1ec59b8602a3e5486394b34865cc36",labelText:`${u.entries.Lcz_SmokingOptions}:`,display:"inline",content:this.getSmokingLabel()}),this.booking.is_direct&&t(a,{key:"a056bf961baef73f19dc1b10a8819d6f74bc3e04"},this.room.rateplan.cancelation&&t("ir-label",{key:"5b04dba1efb6b15628cf4a82670cb2e6905bf37d",labelText:`${u.entries.Lcz_Cancellation}:`,display:"inline",content:this.room.rateplan.cancelation||"",renderContentAsHtml:true}),this.room.rateplan.guarantee&&t("ir-label",{key:"774c462f980c06e6a0e63616d93d4999913895e6",labelText:`${u.entries.Lcz_Guarantee}:`,display:"inline",content:this.room.rateplan.guarantee||"",renderContentAsHtml:true})),this.room.ota_meta&&t("div",{key:"28db4ac999f4b5b7eedf1983d2fd6cbf43508e9c"},t("ir-label",{key:"09f990cae675db1fa7a7637c4d2b81bdabaa97e0",labelText:`${u.entries.Lcz_MealPlan}:`,display:"inline",content:this.room.ota_meta.meal_plan}),t("ir-label",{key:"7983dd5ca7a4e27a431f2fb108691655def78acd",labelText:`${u.entries.Lcz_Policies}:`,display:"inline",content:this.room.ota_meta.policies})))),t("ir-modal",{key:"cc09a76dda30f82b2e51df3c59db09863bc2b234",autoClose:false,ref:e=>this.modal=e,isLoading:this.isLoading,onConfirmModal:this.handleModalConfirmation.bind(this),iconAvailable:true,icon:"ft-alert-triangle danger h1",leftBtnText:u.entries.Lcz_Cancel,rightBtnText:this.modalReason==="delete"?u.entries.Lcz_Delete:u.entries.Lcz_Confirm,leftBtnColor:"secondary",rightBtnColor:this.modalReason==="delete"?"danger":"primary",modalTitle:u.entries.Lcz_Confirmation,modalBody:this.renderModalMessage()}))}showGuestModal(){var e;const{adult_nbr:t,children_nbr:i,infant_nbr:s}=this.room.occupancy;this.openSidebar.emit({type:"room-guest",payload:{roomName:(e=this.room.unit)===null||e===void 0?void 0:e.name,sharing_persons:this.room.sharing_persons,totalGuests:t+i+s,checkin:this.hasCheckIn,identifier:this.room.identifier}})}get element(){return o(this)}static get watchers(){return{room:["handleRoomDataChange"]}}};Qt.style=Xt;const Zt={id:-1,full_name:"",country_id:null,dob:"",id_info:{type:{code:null,description:null},number:""},address:null,alternative_email:null,cci:null,city:null,country:undefined,country_phone_prefix:null,email:null,first_name:"",last_name:"",mobile:null,nbr_confirmed_bookings:0,notes:null,password:null,subscribe_to_news_letter:null};const Jt={mask:Date,pattern:"DD/MM/YYYY",lazy:false,min:B("1900-01-01","YYYY-MM-DD").toDate(),max:new Date,format:e=>B(e).format("DD/MM/YYYY"),parse:e=>B(e,"DD/MM/YYYY").toDate(),autofix:true,placeholderChar:"_",blocks:{YYYY:{mask:U,from:1900,to:(new Date).getFullYear(),placeholderChar:"Y"},MM:{mask:U,from:1,to:12,placeholderChar:"M"},DD:{mask:U,from:1,to:31,placeholderChar:"D"}}};const ei=".sc-ir-room-guests-h{display:block;height:100%;position:relative;text-align:start !important}.id-select.sc-ir-room-guests{border-top-right-radius:0;border-bottom-right-radius:0;border-right-width:0}.sc-ir-room-guests-h{display:block;width:100%}.guest-grid.sc-ir-room-guests>*.sc-ir-room-guests{height:100%}.guests-labels.sc-ir-room-guests{display:none}.guest_label.sc-ir-room-guests{width:100px;color:#6b6f82}.sharing_persons_label.sc-ir-room-guests{display:none}.loading-container.sc-ir-room-guests{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.guest_document.sc-ir-room-guests input.sc-ir-room-guests{border-top-left-radius:0;border-bottom-left-radius:0}.guests-labels.sc-ir-room-guests *.sc-ir-room-guests,.sharing_persons_label.sc-ir-room-guests{margin-bottom:0.5rem;padding-bottom:0}@media (min-width: 768px){.sharing_persons_label.sc-ir-room-guests{display:block}.guest_country_picker.sc-ir-room-guests{margin-bottom:3px}.guest-grid.sc-ir-room-guests{display:grid;grid-template-columns:2fr 2fr 2fr 2fr 5fr;gap:0.5rem;align-items:flex-start}.guest_label.sc-ir-room-guests,.sharing_persons_heading.sc-ir-room-guests,.main_guest_heading.sc-ir-room-guests{display:none}}";const ti=ei;const ii=".sc-ir-room-guests-h{height:100%}.sheet-container.sc-ir-room-guests{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-ir-room-guests{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-ir-room-guests{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-ir-room-guests{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-ir-room-guests{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-ir-room-guests{flex-direction:row;align-items:center}}";const si=ii;const ai=class{constructor(t){e(this,t);this.closeModal=s(this,"closeModal",7);this.resetBookingEvt=s(this,"resetBookingEvt",7);this.updateRoomGuests=s(this,"updateRoomGuests",7);this.sharedPersons=[];this.totalGuests=0;this.language="en";this.guests=[];this.idTypes=[];this.error={};this.autoValidate=false;this.bookingService=new l}componentWillLoad(){this.init();this.initializeGuests()}async init(){try{this.isLoading=true;const[e,t]=await Promise.all([this.bookingService.getUserDefaultCountry(),this.bookingService.getSetupEntriesByTableName("_ID_TYPE")]);this.idTypes=t;if(e){this.propertyCountry=this.countries.find((t=>t.id===e.COUNTRY_ID))}}catch(e){console.error(e)}finally{this.isLoading=false}}initializeGuests(){var e,t;let i=[];if(this.totalGuests>this.sharedPersons.length){const s=this.totalGuests-this.sharedPersons.length;i=[...this.sharedPersons,...Array(s).fill(Object.assign(Object.assign({},Zt),{id_info:Object.assign(Object.assign({},Zt.id_info),{type:{code:((e=this.idTypes[0])===null||e===void 0?void 0:e.CODE_NAME)||"001",description:((t=this.idTypes[0])===null||t===void 0?void 0:t.CODE_VALUE_EN)||""},number:""})}))]}else{i=[...this.sharedPersons]}i=i.map((e=>Object.assign(Object.assign({},e),{dob:new Date(e.dob).getFullYear()===1900?null:e.dob})));this.guests=i.map((e=>Object.assign(Object.assign({},e),{dob:e.dob?B(new Date(e.dob)).format("DD/MM/YYYY"):"",country_id:e.country?e.country.id:null})))}updateGuestInfo(e,t){const i=[...this.guests];let s=i[e];s=Object.assign(Object.assign({},s),t);i[e]=s;this.guests=[...i]}async saveGuests(){try{this.error={};this.autoValidate=true;console.log({sharedPersons:this.sharedPersons,guests:this.guests});for(const e of this.guests){it(e)}await this.bookingService.handleExposedRoomGuests({booking_nbr:this.bookingNumber,identifier:this.identifier,guests:this.guests.map((e=>{if(!e.first_name&&e.id===-1){return null}return Object.assign(Object.assign({},e),{dob:e.dob?B(e.dob,"DD/MM/YYYY").format("YYYY-MM-DD"):null})})).filter(Boolean)});if(this.checkIn){await this.bookingService.handleExposedRoomInOut({booking_nbr:this.bookingNumber,room_identifier:this.identifier,status:"001"})}this.closeModal.emit(null);this.updateRoomGuests.emit({identifier:this.identifier,guests:this.guests});this.resetBookingEvt.emit()}catch(e){console.log(e);if(e instanceof S){let t={};e.issues.forEach((e=>{t[e.path[e.path.length-1]]=true}));this.error=Object.assign({},t)}}}render(){if(this.isLoading){return t("div",{class:"loading-container"},t("ir-spinner",null))}return t("form",{class:"sheet-container",style:{minWidth:"300px"},onSubmit:e=>{e.preventDefault();this.saveGuests()}},t("ir-title",{class:"px-1 sheet-header",onCloseSideBar:()=>this.closeModal.emit(null),label:`Room ${this.roomName}`,displayContext:"sidebar"}),t("section",{class:"sheet-body px-1"},t("div",{class:""},t("div",{class:"guest-grid guests-labels"},t("p",{class:""},u.entries.Lcz_MainGuest),t("p",{class:""}),t("p",{class:" "},u.entries.Lcz_DOB),t("p",{class:""},u.entries.Lcz_Nationality),t("p",{class:" "},u.entries.Lcz_Documents)),t("h5",{class:"main_guest_heading"},u.entries.Lcz_MainGuest),this.guests.map(((e,i)=>{var s,o,n,r,l;let c=true;try{it(e)}catch(e){c=false}return t(a,null,i===1&&t("div",{class:"d-flex mx-0 px-0"},t("h5",{class:"mx-0 px-0 sharing_persons_heading"},u.entries.Lcz_PersonsSharingRoom),t("p",{class:"mx-0 px-0 sharing_persons_label"},u.entries.Lcz_PersonsSharingRoom)),t("div",{key:i,class:"guest-grid"},t("div",{class:"m-0 p-0 d-flex align-items-center h-100"},t("p",{class:"guest_label"},"First name"),t("ir-input-text",{class:"flex-grow-1 h-100",id:`first_name_${i}`,zod:tt.pick({first_name:true}),error:!!this.error["first_name"]&&!c,autoValidate:this.autoValidate,wrapKey:"first_name",placeholder:"First name",onTextChange:e=>this.updateGuestInfo(i,{first_name:e.detail}),value:e.first_name,maxLength:40})),t("div",{class:"m-0 p-0 d-flex align-items-center h-100"},t("p",{class:"guest_label"},"Last name"),t("ir-input-text",{maxLength:40,class:"flex-grow-1 h-100",id:`last_name_${i}`,zod:tt.pick({last_name:true}),error:!!this.error["last_name"]&&!c,autoValidate:this.autoValidate,wrapKey:"last_name",placeholder:"Last name",onTextChange:e=>this.updateGuestInfo(i,{last_name:e.detail}),value:e.last_name})),t("div",{class:"flex-grow-0 m-0 p-0 h-100 d-flex align-items-center"},t("p",{class:"guest_label"},u.entries.Lcz_DOB),t("ir-input-text",{class:"flex-grow-1 h-100",id:`dob_${i}`,zod:tt.pick({dob:true}),error:!!this.error["dob"]&&!c,autoValidate:this.autoValidate,wrapKey:"dob",mask:Jt,placeholder:"",onTextChange:e=>{this.updateGuestInfo(i,{dob:e.detail})},value:e.dob})),t("div",{class:" m-0 p-0 d-flex align-items-center"},t("p",{class:"guest_label"},u.entries.Lcz_Nationality),t("div",{class:"mx-0 flex-grow-1  h-100"},t("ir-country-picker",{class:"h-100",propertyCountry:this.propertyCountry,id:`{locales.entries.Lcz_Nationality}_${i}`,error:!!this.error["country_id"]&&!e.country_id,country:(s=this.countries)===null||s===void 0?void 0:s.find((t=>{var i,s,a;return((i=t.id)===null||i===void 0?void 0:i.toString())===((a=(s=e.country)===null||s===void 0?void 0:s.id)===null||a===void 0?void 0:a.toString())})),onCountryChange:e=>{var t,s,a;return this.updateGuestInfo(i,{country_id:(a=(s=(t=e.detail)===null||t===void 0?void 0:t.id)===null||s===void 0?void 0:s.toString())!==null&&a!==void 0?a:null,country:e.detail})},countries:this.countries}))),t("div",{class:"flex-grow-1 m-0 p-0 d-flex align-items-center"},t("p",{class:"guest_label"},u.entries.Lcz_Documents),t("div",{class:" d-flex m-0 flex-grow-1 h-100"},t("ir-select",{selectForcedStyles:{borderTopRightRadius:"0px",borderBottomRightRadius:"0px",borderRight:"0"},selectStyles:"rounded-top-0 rounded-bottom-0",onSelectChange:e=>{this.updateGuestInfo(i,{id_info:Object.assign(Object.assign({},this.guests[i].id_info),{type:{code:e.detail,description:""}})})},selectedValue:(n=(o=e.id_info)===null||o===void 0?void 0:o.type)===null||n===void 0?void 0:n.code,showFirstOption:false,data:(r=this.idTypes)===null||r===void 0?void 0:r.map((e=>{var t;return{text:(t=e[`CODE_VALUE_${this.language.toUpperCase()}`])!==null&&t!==void 0?t:e[`CODE_VALUE_EN`],value:e.CODE_NAME}}))}),t("ir-input-text",{autoValidate:this.autoValidate,maxLength:18,placeholder:"12345",class:"flex-grow-1 guest_document",type:"text",inputForcedStyle:{borderTopLeftRadius:"0px",borderBottomLeftRadius:"0px"},value:(l=e===null||e===void 0?void 0:e.id_info)===null||l===void 0?void 0:l.number,zod:et.pick({number:true}),error:!!this.error["number"]&&!c,wrapKey:"number",inputStyles:"form-control",onTextChange:e=>this.updateGuestInfo(i,{id_info:Object.assign(Object.assign({},this.guests[i].id_info),{number:e.detail})})})))))})))),t("div",{class:"sheet-footer"},t("ir-button",{onClick:()=>this.closeModal.emit(null),class:`flex-fill`,text:u.entries.Lcz_Cancel,btn_color:"secondary"}),t("ir-button",{btn_type:"submit",class:"flex-fill",isLoading:T("/Handle_Exposed_Room_Guests"),text:this.checkIn?u.entries.Lcz_CheckIn:u.entries.Lcz_Save,btn_color:"primary"})))}};ai.style=ti+si;const oi="*.sc-ota-label{margin:0;padding:0}.sc-ota-label-h{display:flex;margin-bottom:5px;gap:5px}.label_title.sc-ota-label{min-width:max-content;padding:0;margin:0;font-weight:600}.ota-message-list.sc-ota-label{margin:0 3px;padding:0;overflow:hidden;width:100%;word-wrap:break-word !important;overflow-wrap:break-word !important}.ota-message-item.sc-ota-label{width:100%;line-height:1.5;margin:0;padding:0;word-wrap:break-word !important;overflow-wrap:break-word !important}.ota-message-item.sc-ota-label::before{content:'- ';margin-right:0.25rem}.ota-visibility-toggle.sc-ota-label{background:white;color:var(--blue);padding:0;margin:0;margin-left:3px;font-size:12px;border:0}.ota-visibility-toggle.sc-ota-label:hover{color:#355270}.ota-message-list.sc-ota-label{margin:0 3px;padding:0;overflow:hidden;width:100%;word-wrap:break-word !important;overflow-wrap:break-word !important;white-space:normal;list-style:none}.ota-message-item.sc-ota-label{width:100%;line-height:1.5;margin:0 0 0 1.2em;padding:0;word-wrap:break-word !important;overflow-wrap:break-word !important;white-space:normal;position:relative}";const ni=oi;const ri=class{constructor(t){e(this,t);this.maxVisibleItems=3;this.showAll=false;this.toggleShowAll=()=>{this.showAll=!this.showAll}}render(){if(!this.remarks){return null}const e=this.showAll?this.remarks:this.remarks.slice(0,this.maxVisibleItems);return t(i,null,t("p",{class:"label_title"},this.label),t("ul",{class:"ota-message-list"},e.map(((i,s)=>t("li",{key:I(),class:"ota-message-item"},i.statement," ",this.remarks.length>this.maxVisibleItems&&s===e.length-1&&t("button",{class:"ota-visibility-toggle",onClick:this.toggleShowAll},this.showAll?u.entries.Lcz_ShowLess:u.entries.Lcz_ShowMore))))))}};ri.style=ni;export{W as igl_application_info,te as igl_book_property,ae as igl_book_property_footer,re as igl_book_property_header,de as igl_booking_form,fe as igl_booking_overview_page,me as igl_property_booked_by,ve as igl_room_type,De as ir_applicable_policies,Ye as ir_booking_details,Ee as ir_booking_extra_note,Ae as ir_booking_guarantee,Re as ir_booking_header,ze as ir_dialog,Ue as ir_dropdown,Ve as ir_dropdown_item,Xe as ir_events_log,Je as ir_extra_service,lt as ir_extra_service_config,ht as ir_extra_services,mt as ir_guest_info,vt as ir_payment_details,Dt as ir_payment_folio,Yt as ir_payment_item,Bt as ir_payment_summary,St as ir_payments_folio,$t as ir_pickup,Gt as ir_pickup_view,Ht as ir_pms_logs,Wt as ir_reservation_information,Qt as ir_room,ai as ir_room_guests,ri as ota_label};
//# sourceMappingURL=p-f0011a02.entry.js.map