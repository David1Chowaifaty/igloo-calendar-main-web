import{h as e,r as i,c as t,H as a,F as o,g as n}from"./p-d239357b.js";import{h as r}from"./p-6c4ba7c0.js";import{j as s,u as c,e as l,n as d,C as h,D as p}from"./p-ae2f332f.js";import{c as m,i as f}from"./p-99cb260a.js";import{l as b}from"./p-4e493fea.js";import{B as u,m as g,e as _,V as y,b as k,u as v,s as w,d as x,r as D,g as Y,a as M,h as C,c as I,i as S,j as E,k as z,Z as B}from"./p-ae6a57a8.js";import{i as O}from"./p-6fec77c0.js";import{v as A}from"./p-4ed69de7.js";import{a as T}from"./p-bf44a732.js";import{R as P}from"./p-34b319c3.js";import{P as N}from"./p-834c4250.js";import{T as R}from"./p-f8b7c0cd.js";import{l as L,c as G,k as H,f as j}from"./p-8af1cf5e.js";import{z as U,Z as K,g as V}from"./p-748cfd41.js";import{I as F,M as q}from"./p-518eace5.js";import{P as W}from"./p-64aa23d3.js";import{_ as Z,a as J,b as Q}from"./p-b2679b77.js";import"./p-c5894a47.js";const X=({message:i,href:t,class:a})=>e("div",{class:a},e("wa-tooltip",{for:"help-button"},i),e("wa-button",{id:"help-button",href:t,size:"small",target:"_blank","aria-label":i,appearance:"plain",variant:"neutral"},e("wa-icon",{name:"circle-info",style:{fontSize:"1rem"}})));class ee{bookingService;_booking=null;constructor(e){this.bookingService=e}get booking(){return this._booking}set booking(e){this._booking=e}async fetchGroupedApplicablePolicies(e){if(!this._booking){throw new Error("Booking must be defined before fetching applicable policies.")}if(["003","004"].includes(this._booking.status.code)||!this._booking.is_direct){return}const{rooms:i,booking_nbr:t,currency:a,property:o}=this._booking;const n=this.groupRoomsForRequest(i??[]);try{const r=[];n.forEach((n=>{const s={booking_nbr:t,currency_id:a.id,language:e.language,property_id:o.id,rate_plan_id:n.ratePlanId,room_type_id:n.roomTypeId,is_preserve_history:true};if(n.identifiers.length>1){n.identifiers.forEach((e=>{r.push(this.bookingService.getExposedApplicablePolicies({...s,room_identifier:e}).then((t=>({grouping:{...n,rooms:i.filter((i=>i.identifier===e))},policies:t}))))}))}else{r.push(this.bookingService.getExposedApplicablePolicies(s).then((e=>({grouping:n,policies:e}))))}}));const s=await Promise.all(r);const c=this.buildPoliciesByType(s);const l=this.buildCancellationStatements(s);const d=this.calculateGuaranteeAmount(s);return{policiesByType:c,cancellationStatements:l,guaranteeAmount:d}}catch(e){const i=e instanceof Error?e.message:String(e);throw new Error(`Failed to fetch applicable policies: ${i}`)}}groupRoomsForRequest(e){if(!e.length){throw new Error("Cannot request applicable policies without booking rooms.")}const i=new Map;e.forEach((e=>{if(!e.rateplan?.id||!e.roomtype?.id){throw new Error("Room is missing rate plan or room type information.")}const t=`${e.roomtype.id}-${e.rateplan.id}`;const a=typeof e.identifier==="string"?e.identifier:null;if(!i.has(t)){i.set(t,{ratePlanId:e.rateplan.id,roomTypeId:e.roomtype.id,identifiers:a?[a]:[],rooms:[e]});return}const o=i.get(t);o.rooms.push(e);if(a&&!o.identifiers.includes(a)){o.identifiers.push(a)}}));return[...i.values()]}buildPoliciesByType(e){const i=e.flatMap((e=>e.policies??[]));return this.groupPoliciesByType(i)}groupPoliciesByType(e){return e.reduce(((e,i)=>{e[i.type]=e[i.type]?[...e[i.type],i]:[i];return e}),{})}buildCancellationStatements(e){if(!this._booking){return[]}const i=[];e.forEach((({grouping:e,policies:t})=>{if(!t?.length){return}const a=t.find((e=>e.type==="cancelation"));if(!a){return}e.rooms.forEach((e=>{const t=r(e.from_date,"YYYY-MM-DD",true);if(!t.isValid()){return}const o=a.brackets.filter((e=>{const i=r(e.due_on,"YYYY-MM-DD",true);return i.isValid()&&i.isBefore(t,"day")}));const n=o.some((e=>e.amount>0));let s;if(n){s=o.map(((e,i)=>{if(e.amount>0){return e}const t=o[i+1];if(t?.amount&&t.amount>0){return e}return undefined})).filter((e=>Boolean(e)))}else{s=[...o]}s=[...this.mergeBracketsByAmount(s)];if(!e.rateplan.is_non_refundable){const i=r(e.from_date,"YYYY-MM-DD",true);const t=r(e.to_date,"YYYY-MM-DD",true);const a=t.isValid()&&i.isValid()?t.diff(i,"days"):0;const o=a>1?i.clone().add(1,"day").format("YYYY-MM-DD"):i.format("YYYY-MM-DD");s.push({amount:e.total,amount_formatted:"",code:"",currency_id:this._booking.currency.id,due_on:o,due_on_formatted:"",gross_amount:e.gross_total,gross_amount_formatted:"",statement:"100% of total price"});s.sort(((e,i)=>{const t=r(e.due_on,"YYYY-MM-DD",true);const a=r(i.due_on,"YYYY-MM-DD",true);return t.valueOf()-a.valueOf()}))}i.push({...a,brackets:s,roomType:e.roomtype,ratePlan:e.rateplan,checkInDate:e.from_date,grossTotal:e.gross_total})}))}));return i}calculateGuaranteeAmount(e){return e.reduce(((e,{grouping:i,policies:t})=>{if(!t?.length){return e}const a=t.find((e=>e.type==="guarantee"));if(!a){return e}const o=this.selectCurrentBracket(a.brackets);if(!o){return e}const n=i.rooms.length*(o.gross_amount??0);return e+n}),0)}selectCurrentBracket(e){const i=r().startOf("day");for(const t of e){const e=r(t.due_on,"YYYY-MM-DD",true);if(!e.isValid()){continue}if(i.isSameOrAfter(e,"day")){return t}}return null}mergeBracketsByAmount(e){if(e.length<=1){return[...e]}return e.reduce(((e,i)=>{const t=e[e.length-1];if(!t||t.gross_amount!==i.gross_amount){e.push(i)}return e}),[])}}const ie=".sc-ir-applicable-policies-h{display:flex;flex-direction:column;gap:1rem}.applicable-policies__container.sc-ir-applicable-policies{display:flex;align-items:center;gap:1rem;flex-wrap:wrap;margin-bottom:1rem}.applicable-policies__title.sc-ir-applicable-policies{font-size:1rem;font-weight:700;padding:0;margin:0}.applicable-policies__no-penalty.sc-ir-applicable-policies{padding:0;margin:0;font-size:0.875rem}.applicable-policies__statements.sc-ir-applicable-policies{box-sizing:border-box;padding:0}.applicable-policies__statements.sc-ir-applicable-policies::part(message){max-height:245px;overflow-y:auto;display:flex;flex-direction:column;padding:1em;gap:0.5rem}.applicable-policies__highlighted-bracket.sc-ir-applicable-policies{color:var(--wa-color-brand-50)}.applicable-policies__statement.sc-ir-applicable-policies{display:flex;flex-direction:column;border-bottom:1px solid var(--wa-color-neutral-70);padding-bottom:0.5rem}.applicable-policies__statement.sc-ir-applicable-policies:last-child{border-bottom:0;padding-bottom:0}.applicable-policies__room.sc-ir-applicable-policies{padding:0;margin:0;padding-bottom:0.5rem}.applicable-policies__bracket.sc-ir-applicable-policies{display:grid;grid-template-columns:repeat(2, 1fr);gap:0.25rem;font-size:0.875rem;padding-bottom:0.5rem}.applicable-policies__bracket-dates.sc-ir-applicable-policies{display:flex;align-items:center;gap:0.5rem;padding:0;margin:0}.applicable-policies__amount.sc-ir-applicable-policies{text-align:right;padding:0;margin:0;font-weight:600}.applicable-policies__statement-text.sc-ir-applicable-policies{padding:0;margin:0}.applicable-policies__brackets-table.sc-ir-applicable-policies{display:none}.applicable-policies__guarantee.sc-ir-applicable-policies{box-sizing:border-box;padding:0.5rem 1rem;margin-bottom:0.5rem;font-size:0.875rem}.applicable-policies__guarantee.sc-ir-applicable-policies::part(message){display:flex;align-items:center;justify-content:space-between}.applicable-policies__guarantee-info.sc-ir-applicable-policies{display:flex;align-items:center;gap:0.5rem}.applicable-policies__guarantee-date.sc-ir-applicable-policies{color:var(--text-muted, #666);padding:0;margin:0}.applicable-policies__guarantee-amount.sc-ir-applicable-policies{font-weight:600;color:var(--text-strong, #222);padding:0;margin:0}.applicable-policies__guarantee-label.sc-ir-applicable-policies{color:var(--wa-color-danger-50);font-weight:700;padding:0;margin:0}.applicable-policies__guarantee-action.sc-ir-applicable-policies{width:fit-content}@media (min-width: 768px){.applicable-policies__brackets.sc-ir-applicable-policies{display:none}.applicable-policies__brackets-table.sc-ir-applicable-policies{display:block;width:100%;font-size:0.875rem}.applicable-policies__brackets-table.sc-ir-applicable-policies table.sc-ir-applicable-policies{width:100%}.applicable-policies__amount.sc-ir-applicable-policies,.applicable-policies__bracket-dates.sc-ir-applicable-policies{white-space:nowrap}.applicable-policies__statement-text.sc-ir-applicable-policies{width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}}";const te=ie;const ae=class{constructor(e){i(this,e);this.generatePayment=t(this,"generatePayment",7)}booking;propertyId;language="en";cancellationStatements=[];isLoading=false;guaranteeAmount;generatePayment;shouldShowCancellationBrackets=true;applicablePoliciesService=new ee(new u);componentWillLoad(){this.loadApplicablePolicies()}handleBookingChange(){this.loadApplicablePolicies()}async loadApplicablePolicies(){this.isLoading=true;try{this.applicablePoliciesService.booking=this.booking;const{cancellationStatements:e,guaranteeAmount:i}=await this.applicablePoliciesService.fetchGroupedApplicablePolicies({language:this.language});this.guaranteeAmount=i;this.cancellationStatements=[...e]}catch(e){console.error(e)}finally{this.isLoading=false}}formatPreviousBracketDueOn(e,i){if(e.isSame(i,"year")){return e.format("MMM DD")}return e.format("MMM DD, YYYY")}getBracketLabelsAndArrowState({bracket:e,index:i,brackets:t,checkInDate:a}){if(!e||!t||i<0||i>=t.length){return{leftLabel:null,rightLabel:null,showArrow:false}}const o=r(this.booking.booked_on.date,"YYYY-MM-DD");const n=r(e.due_on,"YYYY-MM-DD");if(!o.isValid()||!n.isValid()){console.warn("Invalid date encountered in getBracketLabelsAndArrowState");return{leftLabel:null,rightLabel:null,showArrow:false}}if(t.length===1){return this.handleSingleBracket(n,a)}const s=this.handleMultipleBrackets(e,i,t,a);return s}handleSingleBracket(e,i){const t=r(i,"YYYY-MM-DD");if(e.isSame(t,"days")){return{leftLabel:`${t.format("MMM DD")} onwards`,showArrow:false,rightLabel:""}}return{leftLabel:e.format("MMM DD"),showArrow:true,rightLabel:r(i,"YYYY-MM-DD").format("MMM DD, YYYY")}}handleMultipleBrackets(e,i,t,a){const o=r(e.due_on,"YYYY-MM-DD");const n=r(a,"YYYY-MM-DD");if(i===0){const a=t[i+1];if(!a){return{leftLabel:null,rightLabel:null,showArrow:false}}let o=r(a.due_on,"YYYY-MM-DD");if(!o.isValid()){return{leftLabel:null,rightLabel:null,showArrow:false}}if(e.amount===0){o=o.clone().add(-1,"days")}return{leftLabel:"Until",showArrow:false,rightLabel:o.isSame(n,"dates")?o.clone().add(-1,"days").format("MMM DD, YYYY"):o.format("MMM DD, YYYY")}}if(r(e.due_on,"YYYY-MM-DD").isSameOrAfter(n,"days")){return{leftLabel:`${n.format("MMM DD")} onwards`,showArrow:false,rightLabel:""}}if(i===t.length-1){return{leftLabel:o.clone().format("MMM DD"),showArrow:true,rightLabel:r(a).format("MMM DD, YYYY")}}const s=t[i+1];if(!s){return{leftLabel:null,rightLabel:null,showArrow:false}}const c=r(s.due_on,"YYYY-MM-DD");if(!c.isValid()){return{leftLabel:null,rightLabel:null,showArrow:false}}const l=c.isAfter(n,"days")?n:c.clone();const d=o.isSame(l.clone().add(-1,"days"),"days");return{leftLabel:this.formatPreviousBracketDueOn(o,l),showArrow:!d,rightLabel:d?"":l.add(-1,"days").format("MMM DD, YYYY")}}generateCancellationStatement(){const e="if cancelled today";const{cancelation_penality_as_if_today:i}=this.booking.financial;if(i===0){if(this.booking.financial.collected>0){return`No refund ${e}`}return`No payment required ${e}`}return`${i<0?"Refund":"Charge"} ${s(m.currency.symbol,Math.abs(i))} ${e}`}_getCurrentBracket(e){if(!Array.isArray(e)||e.length===0)return null;const i=r().startOf("day");const t=e.map((e=>({b:e,date:r(e.due_on,"YYYY-MM-DD",true).startOf("day")}))).filter((e=>e.date.isValid())).sort(((e,i)=>e.date.valueOf()-i.date.valueOf()));if(t.length===0)return null;if(i.isBefore(t[0].date,"day")){return t[0].date}for(let e=0;e<t.length-1;e++){const a=t[e].date;const o=t[e+1].date;if(i.isSameOrAfter(a,"day")&&i.isBefore(o,"day")){return a}}return t[t.length-1].date}render(){if(this.isLoading){return null}const i=this.booking.financial.collected-this.guaranteeAmount;return e(a,null,this.guaranteeAmount!==0&&e("section",null,e("wa-callout",{variant:"danger",class:"applicable-policies__guarantee"},e("div",{class:"applicable-policies__guarantee-info"},e("p",{class:"applicable-policies__guarantee-date"},r(this.booking.booked_on.date,"YYYY-MM-DD").format("MMM DD, YYYY")),e("p",{class:"applicable-policies__guarantee-amount"},e("span",{class:"px-1"},s(m.currency.symbol,i<0?Math.abs(i):this.guaranteeAmount))),e("p",{class:"applicable-policies__guarantee-label"},"Guarantee ",i<0?"balance":"")),i<0&&e("div",{class:"applicable-policies__guarantee-action"},e("ir-custom-button",{onClickHandler:()=>{this.generatePayment.emit({amount:Math.abs(i),currency:m.currency,due_on:r().format("YYYY-MM-DD"),pay_type_code:null,reason:"",type:"OVERDUE"})},size:"small"},"Pay")))),e("section",null,e("div",{class:"applicable-policies__container"},e("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},e("p",{class:"applicable-policies__title font-size-large p-0 m-0"},"Cancellation Schedule"),e(X,{message:"Help",href:"https://help.igloorooms.com/extranet/booking-details/guarantee-and-cancellation"})),e("p",{class:"applicable-policies__no-penalty"},this.generateCancellationStatement())),this.cancellationStatements?.length>0&&this.cancellationStatements.every((e=>e.brackets.length>0))&&this.shouldShowCancellationBrackets&&e("wa-callout",{variant:"brand",class:"applicable-policies__statements"},this.cancellationStatements?.map((i=>{const t=this._getCurrentBracket(i.brackets);return e("div",{class:"applicable-policies__statement"},this.cancellationStatements.length>1&&e("p",{class:"applicable-policies__room"},e("b",null,i.roomType.name)," ",i.ratePlan["short_name"]," ",i.ratePlan.is_non_refundable?` - ${b.entries.Lcz_NonRefundable}`:""),e("div",{class:"applicable-policies__brackets"},i.brackets.map(((a,o)=>{const{leftLabel:n,rightLabel:c,showArrow:l}=this.getBracketLabelsAndArrowState({index:o,bracket:a,brackets:i.brackets,checkInDate:i.checkInDate});const d=r(a.due_on,"YYYY-MM-DD").isSame(t,"date");return e("div",{class:{"applicable-policies__bracket":true,"applicable-policies__highlighted-bracket":d}},e("p",{class:"applicable-policies__bracket-dates"},n," ",l&&e("ir-icons",{name:"arrow_right",class:"applicable-policies__icon",style:{"--icon-size":"0.875rem"}})," ",c),e("p",{class:"applicable-policies__amount"},s(m.currency.symbol,a.gross_amount)),e("p",{class:"applicable-policies__statement-text"},a.amount===0?"No penalty":a.statement))}))),e("div",{class:"applicable-policies__brackets-table"},e("table",null,e("tbody",null,i.brackets.map(((a,o)=>{const{leftLabel:n,rightLabel:c,showArrow:l}=this.getBracketLabelsAndArrowState({index:o,bracket:a,brackets:i.brackets,checkInDate:i.checkInDate});const d=r(a.due_on,"YYYY-MM-DD").isSame(t,"date");return e("tr",{class:{"applicable-policies__highlighted-bracket":d}},e("td",{class:"applicable-policies__bracket-dates"},n," ",l&&e("ir-icons",{name:"arrow_right",class:"applicable-policies__icon",style:{"--icon-size":"0.875rem"}})," ",c),e("td",{class:"applicable-policies__amount px-1"},s(m.currency.symbol,a.gross_amount)),e("td",{class:"applicable-policies__statement-text"},a.amount===0?"No penalty":a.statement))}))))))})))))}static get watchers(){return{booking:["handleBookingChange"]}}};ae.style=te;const oe=".sc-ir-billing-h{display:flex;flex-direction:column;height:100%}.billing__container.sc-ir-billing{display:flex;flex-direction:column;gap:var(--wa-space-l)}.billing__section-title-row.sc-ir-billing{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}.billing__section-title.sc-ir-billing{margin:0;padding:0;font-family:var(--wa-font-family-heading);font-weight:var(--wa-font-weight-heading);line-height:var(--wa-line-height-condensed);text-wrap:balance;font-size:var(--wa-font-size-m)}.billing__actions-row.sc-ir-billing{display:flex;align-items:center;justify-content:flex-end;gap:0.5rem}.billing__invoice-nbr.sc-ir-billing{margin:0;padding:0}.billing__invoice-nbr.--secondary.sc-ir-billing{font-size:0.75rem}.billing__price-col.sc-ir-billing{text-align:end !important}.billing__cards.sc-ir-billing{display:flex;flex-direction:column;gap:var(--wa-space-m);padding-bottom:var(--wa-space-l) !important}.billing__card.sc-ir-billing{display:block}.billing__card-header.sc-ir-billing{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem}.billing__card-header-info.sc-ir-billing{display:flex;flex-direction:column}.billing__card-number.sc-ir-billing{margin:0;font-weight:var(--wa-font-weight-heading);font-family:var(--wa-font-family-heading)}.billing__card-type.sc-ir-billing{margin:0;font-size:var(--wa-font-size-xs);color:var(--wa-color-text-secondary)}.billing__card-download-btn.sc-ir-billing{display:flex;align-items:center}.billing__card-details.sc-ir-billing{display:flex;gap:var(--wa-space-xs);justify-content:space-between}.billing__card-detail.sc-ir-billing{display:flex;flex-direction:column}.billing__card-detail-label.sc-ir-billing{margin:0;font-size:var(--wa-font-size-xs);color:var(--wa-color-text-quiet)}.billing__card-detail-label.--amount.sc-ir-billing{text-align:end !important}.billing__card-detail-value.sc-ir-billing{margin:0;font-weight:var(--wa-font-weight-regular);font-size:var(--wa-font-size-s)}.billing__card-void-btn.sc-ir-billing{flex:1 1 0%}.billing__card-footer.sc-ir-billing{display:flex}.table-container.sc-ir-billing{display:none}.billing__card.sc-ir-billing::part(footer){padding-top:1rem;padding-bottom:1rem}@media (min-width: 768px){.billing__cards.sc-ir-billing{display:none}.table-container.sc-ir-billing{display:block}}";const ne=oe;const re=".ir-table-row.sc-ir-billing td.sc-ir-billing{padding:0.5rem 1rem !important;text-align:left;z-index:2;background-color:var(--wa-color-surface-default);white-space:nowrap;color:var(--wa-color-text-normal);box-sizing:border-box}.table--container.sc-ir-billing{overflow-x:auto}.table.sc-ir-billing td.sc-ir-billing{border-top:0;border-bottom:1px solid var(--wa-color-neutral-border-quiet, #abaeb9);transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.table.sc-ir-billing tbody.sc-ir-billing tr.sc-ir-billing:last-child>td.sc-ir-billing{border-bottom:0 !important}.table.sc-ir-billing thead.sc-ir-billing th.sc-ir-billing{border:none !important;background:#ececec;background:color-mix(in oklab, var(--wa-color-neutral-fill-quiet, #f1f2f3) 60%, transparent);color:#374151;padding:0.5rem 1rem !important;text-align:left}.data-table.sc-ir-billing thead.sc-ir-billing th.sc-ir-billing{box-sizing:border-box;background:var(--wa-color-surface-default) !important;padding-top:0.5rem !important;padding-bottom:0.5rem !important;border-bottom:1px solid var(--wa-color-neutral-90) !important;color:var(--wa-color-text-normal)}.data-table.sc-ir-billing .empty-row.sc-ir-billing{height:50vh !important;text-align:center;color:var(--wa-color-gray-60)}.data-table--pagination.sc-ir-billing{padding:0.5rem 1rem;position:sticky;bottom:0;background:var(--wa-color-surface-default);border-top:1px solid var(--wa-color-neutral-90)}.selected.sc-ir-billing td.sc-ir-billing{background:#e3f3fa !important}.selected.sc-ir-billing td.sc-ir-billing{color:var(--gray-dark) !important;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.sortable.sc-ir-billing,.ir-table-row.sc-ir-billing{transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.sortable.sc-ir-billing{text-transform:capitalize}.sortable.sc-ir-billing:hover{color:#212529;background-color:#e2e8f0 !important;border-color:#dae0e5;cursor:pointer}.ir-table-row.sc-ir-billing:hover td.sc-ir-billing{background:#e2e6ea3f !important;background:var(--wa-color-neutral-fill-quiet, #f1f2f3) !important}.sortable.sc-ir-billing:active{color:#212529;background-color:#e2e8f0;border-color:#d3d9df}.sortable.sc-ir-billing svg.sc-ir-billing{color:var(--blue)}.sticky-column.sc-ir-billing{position:sticky !important;right:0;background-color:white}.table--container.sc-ir-billing,.data-table.sc-ir-billing{height:100%}";const se=re;const ce=class{constructor(e){i(this,e);this.billingClose=t(this,"billingClose",7)}booking;isOpen=null;isLoading="page";invoiceInfo;selectedInvoice=null;billingClose;bookingService=new u;_id=`issue_invoice__btn_${A()}`;componentWillLoad(){this.init()}async handleInvoiceCreation(e){e.stopImmediatePropagation();e.stopPropagation();this.invoiceInfo={...e.detail}}async init(){try{this.isLoading="page";this.invoiceInfo=await this.bookingService.getBookingInvoiceInfo({booking_nbr:this.booking.booking_nbr})}catch(e){console.error(e)}finally{this.isLoading=null}}async voidInvoice(e){this.isLoading="void";e.stopImmediatePropagation();e.stopPropagation();await this.bookingService.voidInvoice({invoice_nbr:this.selectedInvoice,property_id:m.property.id,reason:""});this.invoiceInfo=await this.bookingService.getBookingInvoiceInfo({booking_nbr:this.booking.booking_nbr});this.isLoading=null;this.selectedInvoice=null}get invoices(){const e=[];for(const i of this.invoiceInfo.invoices){if(i.status.code==="VALID"){e.push(i)}else{e.push({...i,status:{code:"VALID",description:""}});e.push({...i,date:i.credit_note.date})}}return e.sort(((e,i)=>{const t=r(e.date??e.credit_note?.date,"YYYY-MM-DD");const a=r(i.date??i.credit_note?.date,"YYYY-MM-DD");return t.diff(a)}))}async printInvoice({invoice:e,autoDownload:i,mode:t="invoice"}){try{const{My_Result:a}=await this.bookingService.printInvoice({property_id:m.property.id,invoice_nbr:e.nbr,mode:t});if(!a){return}if(i){c(a);return}window.open(a)}catch(e){console.error(e)}}render(){if(this.isLoading==="page"){return e("div",{class:"drawer__loader-container"},e("ir-spinner",null))}return e(o,null,e("div",{class:"billing__container"},e("section",null,e("div",{class:"billing__section-title-row"},e("h4",{class:"billing__section-title"},"Issued documents"),e("ir-custom-button",{variant:"brand",id:this._id,onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.isOpen="invoice"}},"Issue invoice")),e("div",{class:"table-container"},e("table",{class:"table"},e("thead",null,e("tr",null,e("th",null,"Date"),e("th",null,"Number"),e("th",{class:"billing__price-col"},"Amount"),e("th",null))),e("tbody",null,this.invoices?.map((i=>{const t=i.status.code==="VALID";return e("tr",{class:"ir-table-row"},e("td",null,i.status.code==="VALID"?r(i.date,"YYYY-MM-DD").format("MMM DD, YYYY"):r(i.credit_note.date,"YYYY-MM-DD").format("MMM DD, YYYY")),e("td",null,e("p",{class:"billing__invoice-nbr"},e("b",null,t?"Invoice":"Credit note",":")," ",t?i.nbr:i.credit_note.nbr),!t&&e("p",{class:"billing__invoice-nbr --secondary"},i.nbr)),e("td",{class:"billing__price-col"},e("span",{class:"ir-price",style:{fontWeight:"400"}},s(i.currency.symbol,i.total_amount))),e("td",null,e("div",{class:"billing__actions-row"},e("wa-dropdown",{"onwa-hide":e=>{e.stopImmediatePropagation();e.stopPropagation()},"onwa-select":async e=>{switch(e.detail.item.value){case"print":this.printInvoice({invoice:i,autoDownload:true,mode:t?"invoice":"creditnote"});break;case"view-print":this.printInvoice({invoice:i,mode:t?"invoice":"creditnote"});break;case"void":this.selectedInvoice=i.nbr;break}}},e("h3",null,"Issued by: ",i.credit_note?i.credit_note.user:i.user),e("wa-divider",null),e("wa-dropdown-item",{value:"view-print"},"Open PDF",O("/Print_Invoice")&&e("wa-spinner",{slot:"details"})),t&&!i.credit_note&&e("wa-dropdown-item",{variant:"danger",value:"void"},"Void with credit note"),e("ir-custom-button",{slot:"trigger",id:`pdf-${i.system_id}`,variant:"neutral",appearance:"plain"},e("wa-icon",{name:"ellipsis-vertical",style:{fontSize:"1rem"}}))))))}))))),e("div",{class:"billing__cards"},this.invoices?.map((i=>{const t=i.status.code==="VALID";return e("wa-card",{key:i.nbr,class:"billing__card"},e("div",{class:"billing__card-header"},e("div",{class:"billing__card-header-info"},e("p",{class:"billing__card-number"},t?"Invoice":"Credit note",":",t?i.nbr:i.credit_note.nbr),e("p",{class:"billing__card-type"},t?"":i.nbr)),e("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"}},e("wa-tooltip",{for:`mobile-download-pdf-${i.system_id}`},"Open PDF"),e("ir-custom-button",{onClickHandler:()=>this.printInvoice({invoice:i,mode:t?"invoice":"creditnote"}),loading:O("/Print_Invoice"),id:`mobile-download-pdf-${i.system_id}`,variant:"neutral",appearance:"plain",class:"billing__card-download-btn"},e("wa-icon",{name:"file-pdf",style:{fontSize:"1rem"}})))),e("div",{class:"billing__card-details"},e("div",{class:"billing__card-detail"},e("p",{class:"billing__card-detail-label"},"Date"),e("p",{class:"billing__card-detail-value"}," ",t?r(i.date,"YYYY-MM-DD").format("MMM DD, YYYY"):r(i.credit_note.date,"YYYY-MM-DD").format("MMM DD, YYYY"))),e("div",{class:"billing__card-detail"},e("p",{class:"billing__card-detail-label --amount"},"Amount"),e("p",{class:"billing__card-detail-value"},s(i.currency.symbol,i.total_amount??0)))),t&&!i.credit_note&&e("div",{slot:"footer",class:"billing__card-footer"},e("ir-custom-button",{onClickHandler:()=>{this.selectedInvoice=i.nbr},variant:"danger",appearance:"outlined",class:"billing__card-void-btn"},"Void with credit note")))}))),this.invoiceInfo.invoices?.length===0&&e("ir-empty-state",{style:{width:"100%",height:"40vh"}}))),e("ir-invoice",{invoiceInfo:this.invoiceInfo,onInvoiceClose:e=>{e.stopImmediatePropagation();e.stopPropagation();this.isOpen=null},open:this.isOpen==="invoice",booking:this.booking}),e("ir-dialog",{label:"Alert",open:this.selectedInvoice!==null,lightDismiss:false,onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation()},onIrDialogAfterHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.selectedInvoice=null}},e("p",null,"Void invoice ",this.selectedInvoice," by generating a credit note?"),e("div",{slot:"footer",class:"ir-dialog__footer"},e("ir-custom-button",{"data-dialog":"close",size:"medium",appearance:"filled",variant:"neutral"},"Cancel"),e("ir-custom-button",{loading:this.isLoading==="void",onClickHandler:this.voidInvoice.bind(this),size:"medium",variant:"danger"},"Confirm"))))}};ce.style=ne+se;const le=".sc-ir-billing-drawer-h{display:block}.billing__drawer.sc-ir-billing-drawer::part(footer){display:none}";const de=le;const he=class{constructor(e){i(this,e);this.billingClose=t(this,"billingClose",7)}open;booking;billingClose;render(){return e("ir-drawer",{key:"b550a3002eff6c791f7353ebf8b42b35410c076e",style:{"--ir-drawer-width":"50rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"},class:"billing__drawer",onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.billingClose.emit()},open:this.open,label:"Billing"},this.open&&e("ir-billing",{key:"7f6c2f49d7db838fdcc21ae84750ff1b282ccf01",booking:this.booking}))}};he.style=de;const pe=".sc-ir-booking-billing-recipient-h{display:block;padding:0 !important;box-sizing:border-box}.billing-recipient__room.sc-ir-booking-billing-recipient::part(label){display:flex;align-items:center;gap:var(--wa-space-xl);width:100%}.billing-recipient__guest-name.sc-ir-booking-billing-recipient{font-weight:500}.billing-recipient__room-details.sc-ir-booking-billing-recipient{display:flex;gap:6px;align-items:center;font-size:0.875rem;color:var(--wa-color-neutral-600)}.billing-recipient__roomtype.sc-ir-booking-billing-recipient{font-weight:600}";const me=pe;const fe=class{constructor(e){i(this,e);this.recipientChange=t(this,"recipientChange",7)}booking;selectedRecipient;rooms=[];recipientChange;initialValue;bookingCompanyFormRef;componentWillLoad(){this.initializeDefaultValue()}handleBookingChange(){this.initializeDefaultValue()}initializeDefaultValue(){this.initialValue="guest";this.selectedRecipient=this.initialValue;this.filterRoomGuests()}handleRecipientChange(e){this.selectedRecipient=e;switch(e){case"company":if(!this.booking.company_name){this.bookingCompanyFormRef.openCompanyForm();return}break}this.recipientChange.emit(this.selectedRecipient)}filterRoomGuests(){const e="|";const i=i=>i?.split(" ")?.join(e)?.toLocaleLowerCase().trim()||"";const t=[];const a=new Set;const o=this.booking?.guest;if(o){const t=`${i(o.first_name)}${o.last_name?e:""}${i(o.last_name)}`;a.add(t)}for(const o of this.booking.rooms||[]){const n=o?.guest;if(!n)continue;const r=`${i(n.first_name)}${n.last_name?e:""}${i(n.last_name)}`;if(a.has(r)||!r)continue;a.add(r);t.push(o)}this.rooms=t}render(){return e(a,{key:"6d33128065ff098fcb7f61b8d9a9b50a6b4e293b"},e("wa-radio-group",{key:"1a42bbcffb5683a860223318f6cf68fd4898ffab",defaultValue:this.initialValue,onchange:e=>this.handleRecipientChange(e.target.value),label:"Bill to",orientation:"vertical",name:`${this.booking?.booking_nbr}-bill-to`,value:this.selectedRecipient,size:"small"},e("wa-radio",{key:"ccc6432b2b922da929edd587e19bc4f2e10329eb",appearance:"button",value:"guest"},this.booking?.guest.first_name," ",this.booking.guest.last_name),this.rooms.map(((i,t)=>e("wa-radio",{appearance:"button",class:"billing-recipient__room",value:`room__${i.guest.first_name} ${i.guest.last_name}`,key:i.guest?.id??`guest_${t}`},e("span",{class:"billing-recipient__guest-name"},i.guest.first_name," ",i.guest.last_name)))),e("wa-radio",{key:"f4ff933c87ee7f141f2c15c0812be11846a22a38",appearance:"button",value:"company"},this.booking.company_name?this.booking.company_name:"Use company name")),e("ir-booking-company-dialog",{key:"45c9f2bd937b0971cb8e03b44c0316f6cc2c2771",onCompanyFormClosed:()=>{if(this.selectedRecipient==="company"&&!this.booking.company_name){this.handleRecipientChange(this.initialValue)}else{this.handleRecipientChange("company")}},onResetBookingEvt:e=>{this.booking={...e.detail};if(!this.booking.company_name){this.handleRecipientChange(this.initialValue)}else{this.handleRecipientChange("company")}},booking:this.booking,ref:e=>this.bookingCompanyFormRef=e}))}static get watchers(){return{booking:["handleBookingChange"]}}};fe.style=me;const be=".sc-ir-booking-details-h{overflow-x:hidden;--ir-dialog-max-width:20rem;text-align:start;padding:var(--wa-space-l);position:relative;height:100%}.sc-ir-booking-details-h *.sc-ir-booking-details{box-sizing:border-box}.font-medium.sc-ir-booking-details{font-weight:600}.sc-ir-booking-details-h th.sc-ir-booking-details{font-weight:600}.booking-details__date-view-header.sc-ir-booking-details{font-size:1.1rem !important}.booking-details__booking-info.sc-ir-booking-details{display:grid;padding:var(--wa-space-m);gap:var(--wa-space-l)}.booking-details__info-column.sc-ir-booking-details{display:flex;flex-direction:column;gap:var(--wa-space-l)}@media (min-width: 890px){.booking-details__booking-info.sc-ir-booking-details{grid-template-columns:repeat(2, 1fr)}}@media (min-width: 1024px){.booking-details__booking-info.sc-ir-booking-details{gap:var(--wa-space-xl)}}.card.room-group.sc-ir-booking-details{margin-bottom:1rem !important}.card.room-group.sc-ir-booking-details:last-child{margin-bottom:1.81rem !important}.h-28.sc-ir-booking-details{height:2rem}.mx-01.sc-ir-booking-details{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}.date-margin.sc-ir-booking-details{margin-right:5px}.pickup-margin.sc-ir-booking-details{margin-bottom:7px !important}.header-date.sc-ir-booking-details{padding-left:5px !important}.pointer.sc-ir-booking-details{cursor:pointer}.sc-ir-booking-details:root{--sidebar-width:50rem}.loading-container.sc-ir-booking-details{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.sm-padding-right.sc-ir-booking-details{padding-right:0.2rem}.sm-padding-left.sc-ir-booking-details{padding-left:0.2rem}.sm-padding-top.sc-ir-booking-details{padding-top:0.2rem}.sm-padding-bottom.sc-ir-booking-details{padding-bottom:0.2rem}.info-notes.sc-ir-booking-details{list-style:none;padding-left:0}.light-blue-bg.sc-ir-booking-details{background-color:#acecff;padding:0.2rem 0.3rem}.iframeHeight.sc-ir-booking-details{height:17.5rem}.dialog-title.sc-ir-booking-details{width:fit-content}";const ue=be;const ge=class{constructor(e){i(this,e);this.toast=t(this,"toast",7);this.bookingChanged=t(this,"bookingChanged",7);this.closeSidebar=t(this,"closeSidebar",7)}get element(){return n(this)}language="en";ticket="";bookingNumber="";propertyid;is_from_front_desk=false;p;hasPrint=false;hasReceipt=false;hasDelete=false;hasMenu=false;hasRoomEdit=false;hasRoomDelete=false;hasRoomAdd=false;hasCheckIn=false;hasCheckOut=false;hasCloseButton=false;bookingItem=null;statusData=[];showPaymentDetails;booking;countries;calendarData={};guestData=null;rerenderFlag=false;sidebarState=null;sidebarPayload;isUpdateClicked=false;pms_status;isPMSLogLoading=false;paymentActions;property_id;selectedService;bedPreference;roomGuest;modalState=null;departureTime;paymentEntries;splitIndex;toast;bookingChanged;closeSidebar;bookingService=new u;roomService=new P;paymentService=new N;token=new R;printingBaseUrl="https://gateway.igloorooms.com/PrintBooking/%1/printing?id=%2";modalRef;paymentFolioRef;componentWillLoad(){if(this.ticket!==""){this.token.setToken(this.ticket);this.initializeApp()}}ticketChanged(e,i){if(e===i){return}this.token.setToken(this.ticket);this.initializeApp()}handleSideBarEvents(e){this.sidebarState=e.detail.type;this.sidebarPayload=e.detail.payload;if(this.sidebarState==="payment-folio"){this.paymentFolioRef.openFolio()}}handleIconClick(e){const i=e.target;switch(i.id){case"pickup":this.sidebarState="pickup";return;case"close":this.closeSidebar.emit(null);return;case"email":this.modalState={type:"email",message:b.entries.Lcz_EmailBookingto.replace("%1",this.booking.guest.email),loading:O("/Send_Booking_Confirmation_Email")};this.modalRef.openModal();return;case"print":this.openPrintingScreen({mode:"printing"});return;case"invoice":this.sidebarState="invoice";return;case"book-delete":return;case"menu":window.location.href="https://x.igloorooms.com/manage/acbookinglist.aspx";return;case"room-add":this.bookingItem={ID:"",NAME:this.booking.guest.last_name,EMAIL:this.booking.guest.email,PHONE:this.booking.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.booking.from_date,ARRIVAL:this.booking.arrival,TO_DATE:this.booking.to_date,TITLE:`${b.entries.Lcz_AddingUnitToBooking}# ${this.booking.booking_nbr}`,defaultDateRange:{fromDate:new Date(this.booking.from_date),fromDateStr:"",toDate:new Date(this.booking.to_date),toDateStr:"",dateDifference:0,message:""},event_type:"ADD_ROOM",booking:this.booking,BOOKING_NUMBER:this.booking.booking_nbr,ADD_ROOM_TO_BOOKING:this.booking.booking_nbr,GUEST:this.booking.guest,message:this.booking.remark,SOURCE:this.booking.source,ROOMS:this.booking.rooms};return;case"extra_service_btn":this.sidebarState="extra_service";return;case"add-payment":return}}async handleResetExposedCancellationDueAmount(e){e.stopImmediatePropagation();e.stopPropagation();const i=await this.paymentService.GetExposedCancellationDueAmount({booking_nbr:this.booking.booking_nbr,currency_id:this.booking.currency.id});this.paymentActions=[...i]}handleEditInitiated(e){this.bookingItem=e.detail}handleRoomGuestsUpdate(e){const{identifier:i,guests:t}=e.detail;const a=[...this.booking.rooms];let o=a.findIndex((e=>e.identifier===i));if(o===-1){return}const n=a[o];const r={...n,sharing_persons:t};a[o]=r;this.booking={...this.booking,rooms:[...a]};this.splitIndex=L(this.booking.rooms)}async handleResetBooking(e){if(e.detail){this.booking=e.detail;this.splitIndex=L(this.booking.rooms);return}await this.resetBooking()}handleEditExtraService(e){this.selectedService=e.detail;console.log(this.selectedService);this.sidebarState="extra_service"}handleOpenPrintScreen(e){this.openPrintingScreen(e.detail)}setRoomsData(e){let i=new Array;if(e.My_Result?.roomtypes?.length){i=e.My_Result.roomtypes;e.My_Result.roomtypes.forEach((e=>{e.expanded=true}))}this.calendarData.roomsInfo=i}async initializeApp(){try{const[e,i,t,a,o]=await Promise.all([this.roomService.getExposedProperty({id:this.propertyid||0,language:this.language,aname:this.p}),this.roomService.fetchLanguage(this.language),this.bookingService.getCountries(this.language),this.bookingService.getExposedBooking(this.bookingNumber,this.language),this.bookingService.getSetupEntriesByTableNameMulti(["_BED_PREFERENCE_TYPE","_DEPARTURE_TIME","_PAY_TYPE","_PAY_TYPE_GROUP","_PAY_METHOD"])]);this.property_id=e?.My_Result?.id;const{bed_preference_type:n,departure_time:r,pay_type:s,pay_type_group:c,pay_method:l}=this.bookingService.groupEntryTablesResult(o);this.bedPreference=n;this.departureTime=r;this.paymentEntries={types:s,groups:c,methods:l};if(!b?.entries){b.entries=i.entries;b.direction=i.direction}this.countries=t;const d=e?.My_Result;if(d){const{allowed_payment_methods:i,currency:t,allowed_booking_sources:a,adult_child_constraints:o,calendar_legends:n,aname:r}=d;this.printingBaseUrl=this.printingBaseUrl.replace("%1",r).replace("%2",this.bookingNumber);this.calendarData={currency:t,allowed_booking_sources:a,adult_child_constraints:o,legendData:n};this.setRoomsData(e);const s=["001","004"];this.showPaymentDetails=i?.some((e=>s.includes(e.code)))}else{console.warn("Room response is missing 'My_Result'.")}this.guestData=a.guest;this.booking=a;this.splitIndex=L(this.booking.rooms)}catch(e){console.error("Error initializing app:",e)}}async openPrintingScreen(e,i="new"){const{mode:t}=e;if(i==="old"){if(t==="invoice"){return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${encodeURIComponent(this.booking.system_id)}&&PM=I&TK=${encodeURIComponent(this.ticket)}`)}return window.open(`https://x.igloorooms.com/manage/AcBookingEdit.aspx?IRID=${encodeURIComponent(this.booking.system_id)}&&PM=B&TK=${encodeURIComponent(this.ticket)}`)}let a=this.printingBaseUrl;a+=`&mode=${encodeURIComponent(t)}`;if("payload"in e&&e.payload){const i=e.payload;const t=Object.entries(i).map((([e,i])=>{const t=encodeURIComponent(e);const a=encodeURIComponent(String(i));return`${t}=${a}`})).join("&");a+=`&${t}`}const{data:o}=await T.post(`Get_ShortLiving_Token`);if(!o.ExceptionMsg){a+=`&token=${encodeURIComponent(o.My_Result)}`}window.open(a)}handleCloseBookingWindow(){this.bookingItem=null}handleDeleteFinish=e=>{this.booking={...this.booking,rooms:this.booking.rooms.filter((i=>i.identifier!==e.detail))};this.splitIndex=L(this.booking.rooms)};async resetBooking(){try{const e=await this.bookingService.getExposedBooking(this.bookingNumber,this.language);this.booking={...e};this.splitIndex=L(this.booking.rooms);this.bookingChanged.emit(this.booking)}catch(e){console.log(e)}}async handleModalConfirm(){switch(this.modalState.type){case"email":await this.bookingService.sendBookingConfirmationEmail(this.booking.booking_nbr,this.language);break}this.modalState=null;this.modalRef.closeModal()}computeRoomGroups(e){const i=new Map;e.forEach(((e,t)=>i.set(e.identifier,t)));if(!e.length){return{groups:[],indexById:i,hasSplitGroups:false}}const t=e=>{let i=Number.MAX_SAFE_INTEGER;for(const t of e){const e=Date.parse(t?.from_date??"");if(!Number.isNaN(e)){i=Math.min(i,e)}}return i};const a=this.splitIndex??L(e);if(!a){const a=[...e].sort(((e,t)=>{const a=Date.parse(e?.from_date??"")-Date.parse(t?.from_date??"");if(!Number.isNaN(a)&&a!==0){return a}return(i.get(e.identifier)??0)-(i.get(t.identifier)??0)}));return{groups:[{rooms:a,order:0,isSplit:false,sortKey:t(a)}],indexById:i,hasSplitGroups:false}}const o=new Map(e.map((e=>[e.identifier,e])));const n=[];const r=new Set;for(const e of a.heads){const s=a.chainOf.get(e)??[e];const c=s.map((e=>o.get(e))).filter((e=>Boolean(e)));if(!c.length)continue;const l=s.some((e=>{const i=a.parentOf.get(e);const t=a.childrenOf.get(e)??[];return Boolean(i)||t.length>0}))||c.some((e=>Boolean(e?.is_split)));if(l){c.forEach((e=>r.add(e.identifier)));const e=Math.min(...c.map((e=>i.get(e.identifier)??Number.MAX_SAFE_INTEGER)));n.push({rooms:c,order:e,sortKey:t(c),isSplit:true})}}for(const a of e){if(!r.has(a.identifier)){const e=i.get(a.identifier)??Number.MAX_SAFE_INTEGER;const o=[a];n.push({rooms:o,order:e,sortKey:t(o),isSplit:false})}}n.sort(((e,i)=>{if(e.sortKey!==i.sortKey){return e.sortKey-i.sortKey}return e.order-i.order}));const s=n.some((e=>e.isSplit));if(!s){const e=n.map((e=>e.rooms)).reduce(((e,i)=>e.concat(i)),[]).sort(((e,t)=>{const a=Date.parse(e?.from_date??"")-Date.parse(t?.from_date??"");if(!Number.isNaN(a)&&a!==0){return a}return(i.get(e.identifier)??0)-(i.get(t.identifier)??0)}));return{groups:[{rooms:e,order:0,sortKey:t(e),isSplit:false}],indexById:i,hasSplitGroups:false}}return{groups:n,indexById:i,hasSplitGroups:true}}renderRoomItem(i,t,a=true){const o=this.handleRoomCheckin(i);const n=this.handleRoomCheckout(i);return e("ir-room",{key:i.identifier,room:i,property_id:this.property_id,language:this.language,departureTime:this.departureTime,bedPreferences:this.bedPreference,isEditable:this.booking.is_editable,legendData:this.calendarData.legendData,roomsInfo:this.calendarData.roomsInfo,myRoomTypeFoodCat:i.roomtype.name,mealCodeName:i.rateplan.short_name,includeDepartureTime:a,currency:this.booking.currency.symbol,hasRoomEdit:this.hasRoomEdit&&this.booking.status.code!=="003"&&this.booking.is_direct,hasRoomDelete:this.hasRoomDelete&&this.booking.status.code!=="003"&&this.booking.is_direct,hasCheckIn:o,hasCheckOut:n,booking:this.booking,bookingIndex:t,onDeleteFinished:this.handleDeleteFinish})}renderRooms(){const i=this.booking?.rooms??[];if(!i.length){return null}const{groups:t,indexById:a,hasSplitGroups:n}=this.computeRoomGroups(i);if(!n){const i=t[0].rooms;return i.map(((t,n)=>e(o,null,this.renderRoomItem(t,a.get(t.identifier)??n),n<i.length-1?e("wa-divider",null):null)))}return e(o,null,e("div",{class:"d-flex flex-column",style:{gap:"1rem"}},t.map(((i,n)=>{const r=n===t.length-1;return e("div",{class:`${r?"":"room-group"}`,key:`room-group-${i.order}-${n}`},i.rooms.map(((t,n)=>e(o,null,this.renderRoomItem(t,a.get(t.identifier)??n,n===i.rooms.length-1),n<i.rooms.length-1?e("wa-divider",null):null))),!r&&e("wa-divider",{style:{"--width":"3px"}}))}))))}render(){if(!this.booking){return e("div",{class:"loading-container"},e("ir-spinner",null))}const i=this.renderRooms();return[e(o,null,!this.is_from_front_desk&&e(o,null,e("ir-toast",{style:{height:"0"}}),e("ir-interceptor",{style:{height:"0"}}))),e("ir-booking-header",{booking:this.booking,hasCloseButton:this.hasCloseButton,hasDelete:this.hasDelete,hasMenu:this.hasMenu,hasPrint:this.hasPrint,hasReceipt:m.property.is_frontdesk_enabled,hasEmail:["001","002"].includes(this.booking?.status?.code)}),e("div",{class:"booking-details__booking-info"},e("div",{class:"booking-details__info-column"},e("ir-reservation-information",{countries:this.countries,booking:this.booking}),e("wa-card",null,e("ir-date-view",{class:"booking-details__date-view-header",slot:"header",from_date:this.booking.from_date,to_date:this.booking.to_date}),this.hasRoomAdd&&this.booking.is_editable&&e(o,null,e("wa-tooltip",{for:"room-add"},"Add unit"),e("ir-custom-button",{slot:"header-actions",id:"room-add",appearance:"plain",size:"small",variant:"neutral"},e("wa-icon",{name:"plus",style:{fontSize:"1rem"},label:"Add unit"}))),i),e("ir-pickup-view",{booking:this.booking}),e("section",null,e("ir-extra-services",{booking:{booking_nbr:this.booking.booking_nbr,currency:this.booking.currency,extra_services:this.booking.extra_services}}))),e("ir-payment-details",{class:"booking-details__info-column",propertyId:this.property_id,paymentEntries:this.paymentEntries,paymentActions:this.paymentActions,booking:this.booking})),e("ir-dialog",{label:"Send Email",onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.modalRef.closeModal();this.modalState=null},ref:e=>this.modalRef=e},e("p",null,this.modalState?.message),e("div",{slot:"footer",class:"ir-dialog__footer"},e("ir-custom-button",{"data-dialog":"close",size:"medium",appearance:"filled",variant:"neutral"},b.entries.Lcz_Cancel),e("ir-custom-button",{loading:O("/Send_Booking_Confirmation_Email"),onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleModalConfirm()},size:"medium",variant:"brand"},b.entries.Lcz_Confirm))),e("ir-room-guests",{open:this.sidebarState==="room-guest",countries:this.countries,language:this.language,identifier:this.sidebarPayload?.identifier,bookingNumber:this.booking.booking_nbr,roomName:this.sidebarPayload?.roomName,totalGuests:this.sidebarPayload?.totalGuests,sharedPersons:this.sidebarPayload?.sharing_persons,slot:"sidebar-body",checkIn:this.sidebarPayload?.checkin,onCloseModal:()=>this.sidebarState=null}),e("ir-extra-service-config",{open:this.sidebarState==="extra_service",service:this.selectedService,booking:{from_date:this.booking.from_date,to_date:this.booking.to_date,booking_nbr:this.booking.booking_nbr,currency:this.booking.currency},slot:"sidebar-body",onCloseModal:e=>{e.stopImmediatePropagation();e.stopPropagation();this.sidebarState=null;if(this.selectedService){this.selectedService=null}}}),e("ir-pickup",{open:this.sidebarState==="pickup",bookingDates:{from:this.booking.from_date,to:this.booking.to_date},defaultPickupData:this.booking.pickup_info,bookingNumber:this.booking.booking_nbr,numberOfPersons:this.booking.occupancy.adult_nbr+this.booking.occupancy.children_nbr,onCloseModal:()=>{this.sidebarState=null}}),e("ir-billing-drawer",{open:this.sidebarState==="invoice",onBillingClose:e=>{e.stopImmediatePropagation();e.stopPropagation();this.sidebarState=null},booking:this.booking}),e("ir-guest-info-drawer",{onGuestInfoDrawerClosed:()=>{this.sidebarState=null},booking_nbr:this.bookingNumber,email:this.booking?.guest.email,language:this.language,open:this.sidebarState==="guest"}),e("ir-payment-folio",{style:{height:"auto"},bookingNumber:this.booking.booking_nbr,paymentEntries:this.paymentEntries,payment:this.sidebarPayload?.payment,mode:this.sidebarPayload?.mode,ref:e=>this.paymentFolioRef=e,onCloseModal:()=>this.sidebarState=null}),e(o,null,e("ir-booking-editor-drawer",{roomTypeIds:this.bookingItem?.roomsInfo?.map((e=>e.id)),onBookingEditorClosed:this.handleCloseBookingWindow.bind(this),unitId:this.bookingItem?.PR_ID,mode:this.bookingItem?.event_type,label:this.bookingItem?.TITLE,booking:this.booking,ticket:this.ticket,open:this.bookingItem!==null,roomIdentifier:this.bookingItem?.IDENTIFIER,language:this.language,propertyid:this.propertyid,checkIn:this.bookingItem?.FROM_DATE,checkOut:this.bookingItem?.TO_DATE}))]}handleRoomCheckout(e){if(!m.checkin_enabled||m.is_automatic_check_in_out){return false}return e.in_out.code==="001"}handleRoomCheckin(e){if(!m.checkin_enabled||m.is_automatic_check_in_out){return false}if(!e.unit){return false}if(e.in_out&&e.in_out.code!=="000"){return false}if(r().isSameOrAfter(r(e.from_date,"YYYY-MM-DD"),"days")&&r().isBefore(r(e.to_date,"YYYY-MM-DD"),"days")){return true}return false}static get watchers(){return{ticket:["ticketChanged"]}}};ge.style=ue;const _e=U.array(U.object({first_name:U.string().nonempty(),last_name:U.string().nonempty(),bed_preference:U.string().optional().nullable(),requires_bed_preference:U.boolean().nullable()}).superRefine(((e,i)=>{if(e.requires_bed_preference&&!e.bed_preference){i.addIssue({path:["bed_preference"],message:"Bed preference is required",code:U.ZodIssueCode.custom})}})));const ye=U.object({firstName:U.string().nonempty(),lastName:U.string().nonempty()});class ke{mode;variationService;constructor(e){this.mode=e}setMode(e){this.mode=e}updateBooking(e){if(!e)return;try{const i=e.roomtype?.id;const t=e.rateplan?.id;const a=e.guest;const o=e.occupancy;if(!i||!t||!a||!o){console.warn("[updateBooking] Missing required room data",e);return}const n=e.sharing_persons.find((e=>e.is_main));const r={bed_preference:e.bed_preference?.toString()??null,infant_nbr:o.infant_nbr??0,last_name:n?.last_name??e.guest.last_name??"",first_name:n?.first_name??e.guest.first_name??"",unit:e.unit?.id?.toString()??null,roomtype_id:i};g("guest",r);_({roomTypeId:i,ratePlanId:t,rooms:1,guest:[r]})}catch(e){console.error("[updateBooking] Failed",e)}}getRoom(e,i){if(!e||!i)return;const t=e.rooms?.find((e=>e.identifier===i));if(!t)return;g("guest",{bed_preference:t.bed_preference?.toString()??null,infant_nbr:t.occupancy?.infant_nbr??0,first_name:t.guest?.first_name??"",last_name:t.guest?.last_name??"",unit:t.unit?.id?.toString()??null});return t}hasUnderscore(e){return/_+/.test(e)}async calculateAmount({is_amount_modified:e,selected_variation:i,view_mode:t,rp_amount:a}){if(!e)return null;const o=i.nights.length;const n=t==="002"?a:a/o;return n}async generateDailyRates(e,i){let t=e.selected_variation;const a=e.is_amount_modified?await this.calculateAmount(e):null;if(e.guest[i].infant_nbr>0&&!e.is_amount_modified){if(!this.variationService){this.variationService=new y}t=this.variationService.getVariationBasedOnInfants({variations:e.ratePlan.variations,baseVariation:e.selected_variation,infants:e.guest[i].infant_nbr})}return t.nights.map((e=>({date:e.night,amount:a??e.discounted_amount,cost:null})))}async getBookedRooms({check_in:e,check_out:i,notes:t,identifier:a,override_unit:o,unit:n,auto_check_in:s}){const c=[];for(const l in k.ratePlanSelections){const d=k.ratePlanSelections[l];for(const l in d){const h=d[l];if(h.reserved>0){for(let l=0;l<h.reserved;l++){const{first_name:d,last_name:p}=h.guest[l];const m=await this.generateDailyRates(h,l);c.push({identifier:a,roomtype:h.roomtype,rateplan:h.ratePlan,prepayment_amount_gross:0,unit:o?{id:n}:h.guest[l].unit?{id:h.guest[l].unit}:null,occupancy:{adult_nbr:h.selected_variation.adult_nbr,children_nbr:Number(h.selected_variation.child_nbr??0)-Math.max(Number(h.guest[l].infant_nbr??0),0),infant_nbr:h.guest[l].infant_nbr},bed_preference:h.guest[l].bed_preference,from_date:r(e).format("YYYY-MM-DD"),to_date:r(i).format("YYYY-MM-DD"),notes:t,check_in:s,days:m,guest:{email:null,first_name:d,last_name:p,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null,cci:null}})}}}}return c}isEventType(e){if(Array.isArray(e)){return e.includes(this.mode)}return this.mode===e}async prepareBookUserServiceParams({check_in:e,booking:i,room:t,unitId:a}){try{const{dates:o}=k.bookingDraft;const n=o.checkIn;const s=o.checkOut;const c=async(e=null,i=false)=>await this.getBookedRooms({check_in:n,check_out:s,identifier:e,notes:"",override_unit:this.isEventType(["BAR_BOOKING","SPLIT_BOOKING"])?true:false,unit:this.isEventType(["BAR_BOOKING","SPLIT_BOOKING"])?a?.toString()??null:null,auto_check_in:i});const d=({pickup_info:e,extra_services:i,is_direct:t,is_in_loyalty_mode:a,promo_key:o,extras:n,...r},s)=>({assign_units:true,is_pms:true,is_direct:t,is_backend:true,is_in_loyalty_mode:a,promo_key:o,extras:n,booking:{...r,rooms:s},extra_services:i,pickup_info:e});let h=null;const p=k.bookingDraft.source;switch(this.mode){case"EDIT_BOOKING":{const e=i.rooms.filter((e=>e.identifier!==t.identifier));const a=await c(t.identifier,t.in_out?.code==="001");h=d(i,[...e,...a]);break}case"ADD_ROOM":case"SPLIT_BOOKING":{const e=await c();const t=i.rooms;h=d(i,[...t,...e]);break}default:{const i=await c(null,e);const{bookedByGuest:t}=k;const a=p.type==="TRAVEL_AGENCY";h={assign_units:true,is_pms:true,is_direct:true,is_backend:true,is_in_loyalty_mode:false,promo_key:null,extras:[...l.filter((e=>e.key!=="payment_code")),{key:"payment_code",value:k.selectedPaymentMethod?.code}],agent:a?{id:p.tag}:null,is_email_client:t.emailGuest,booking:{company_name:t.company??null,from_date:r(n).format("YYYY-MM-DD"),to_date:r(s).format("YYYY-MM-DD"),remark:t.note||null,booking_nbr:"",property:{id:m.property.id},booked_on:{date:r().format("YYYY-MM-DD"),hour:(new Date).getHours(),minute:(new Date).getMinutes()},source:a?"":p,rooms:i,currency:m.property.currency,arrival:{code:t.selectedArrivalTime},guest:{email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.mobile===null?"":this.hasUnderscore(t.mobile)?"":t.mobile,country_phone_prefix:t?.phone_prefix??null,address:"",dob:null,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null}},pickup_info:null};break}}return h}catch(e){console.error(e)}}}const ve=".sc-ir-booking-editor-h{display:block;height:100%}.booking-editor__roomtype-container.sc-ir-booking-editor{display:flex;flex-direction:column;gap:1rem;margin-top:1.5rem;padding-bottom:3rem}";const we=ve;const xe=class{constructor(e){i(this,e);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.loadingChanged=t(this,"loadingChanged",7);this.adjustBlockedUnit=t(this,"adjustBlockedUnit",7)}propertyId;language="en";roomTypeIds=[];identifier;booking;mode="PLUS_BOOKING";checkIn;checkOut;step;blockedUnit;unitId;isLoading=true;resetBookingEvt;loadingChanged;adjustBlockedUnit;roomService=new P;bookingService=new u;bookingEditorService=new ke(this.mode);room;get adjustedCheckout(){if(this.bookingEditorService.isEventType("PLUS_BOOKING")&&!this.blockedUnit){return undefined}return this.checkOut}componentWillLoad(){this.initializeApp()}handleModeChange(e,i){if(e!==i){this.bookingEditorService.setMode(e)}}handleGuestSelected(e){this.booking={...e.detail};v({firstName:this.booking.guest.first_name,lastName:this.booking.guest.last_name});const i=k.selects.sources.find((e=>e.code===this.booking.source.code));w({source:i})}async initializeApp(){try{this.isLoading=true;this.bookingEditorService.setMode(this.mode);const[e,i]=await Promise.all([this.roomService.fetchLanguage(this.language),this.bookingService.getCountries(this.language),this.roomService.getExposedProperty({id:Number(this.propertyId),language:this.language,is_backend:true,include_units_hk_status:true,include_sales_rate_plans:true})]);if(!b.entries){b.entries=e.entries;b.direction=e.direction}await this.fetchSetupEntriesAndInitialize();x({countries:i});this.initializeDraftFromBooking();if(this.bookingEditorService.isEventType("EDIT_BOOKING")){await this.checkBookingAvailability()}}catch(e){console.error("Error initializing app:",e)}finally{this.isLoading=false}}disconnectedCallback(){D(true)}handleCheckAvailability(e){e.stopImmediatePropagation();e.stopPropagation();this.checkBookingAvailability()}initializeDraftFromBooking(){if(this.bookingEditorService.isEventType(["EDIT_BOOKING","ADD_ROOM"])){if(!this.booking||!this.identifier&&this.bookingEditorService.isEventType("EDIT_BOOKING")){throw new Error("Missing booking or identifier")}}if(this.bookingEditorService.isEventType("EDIT_BOOKING")){this.room=this.bookingEditorService.getRoom(this.booking,this.identifier)}let e={dates:{checkIn:this.checkIn?r(this.checkIn,"YYYY-MM-DD"):r(),checkOut:this.checkOut?r(this.checkOut,"YYYY-MM-DD"):r().add(1,"day")}};if(this.bookingEditorService.isEventType(["EDIT_BOOKING","ADD_ROOM"])){const i=k.selects.sources.find((e=>e.code===this.booking.source.code));e={...e,source:i};if(this.bookingEditorService.isEventType("EDIT_BOOKING")){e={...e,occupancy:{adults:this.booking.occupancy.adult_nbr,children:this.booking.occupancy.children_nbr}}}v({firstName:this.booking.guest.first_name,lastName:this.booking.guest.last_name})}w(e)}async checkBookingAvailability(){const{source:e,occupancy:i,dates:t}=k.bookingDraft;const a=t.checkIn.format("YYYY-MM-DD");const o=t.checkOut.format("YYYY-MM-DD");const n=e?.type==="TRAVEL_AGENCY";try{const t=this.bookingEditorService.isEventType("EDIT_BOOKING")?[this.room.roomtype?.id]:[];const r=this.bookingEditorService.isEventType(["BAR_BOOKING","SPLIT_BOOKING"])?this.roomTypeIds.map((e=>Number(e))):[];await this.bookingService.getBookingAvailability({from_date:a,to_date:o,propertyid:m.property.id,adultChildCount:{adult:i.adults,child:i.children},language:this.language,room_type_ids:r,currency:m.property.currency,agent_id:n?e?.tag:null,is_in_agent_mode:n,room_type_ids_to_update:t});if(this.mode!=="EDIT_BOOKING"){await this.assignCountryCode()}if(this.bookingEditorService.isEventType("EDIT_BOOKING")){this.bookingEditorService.updateBooking(this.room)}}catch(e){console.error("Error initializing booking availability:",e)}}async doReservation(e){try{this.loadingChanged.emit({cause:e});const i=Y();_e.parse(i.map((e=>({...e.guest,requires_bed_preference:e.ratePlanSelection.roomtype.is_bed_configuration_enabled}))));ye.parse(k.bookedByGuest);const t=await this.bookingEditorService.prepareBookUserServiceParams({check_in:e==="book-checkin",booking:this.booking,room:this.room,unitId:this.unitId?.toString()});console.log({DoReservationPayload:t});await this.bookingService.doReservation(t);this.adjustBlockedUnit.emit(t);this.resetBookingEvt.emit(null)}catch(e){console.log(e)}finally{this.loadingChanged.emit({cause:null})}}async assignCountryCode(){const e=await this.bookingService.getUserDefaultCountry();const i=e["COUNTRY_ID"];const t=k.selects.countries.find((e=>e.id?.toString()===i?.toString()));v({countryId:i,phone_prefix:t?.phone_prefix})}async fetchSetupEntriesAndInitialize(){try{const e=await this.fetchSetupEntries();this.setSourceOptions(m.property.allowed_booking_sources);this.setOtherProperties(e)}catch(e){console.error("Error fetching setup entries:",e)}}setOtherProperties(e){x({arrivalTime:e.arrivalTime,bedPreferences:e.bedPreferenceType,ratePricingMode:e.ratePricingMode})}setSourceOptions(e){const i=this.bookingEditorService.isEventType("BAR_BOOKING")?this.getFilteredSourceOptions(e):e;x({sources:i});let t;if(this.bookingEditorService.isEventType("EDIT_BOOKING")&&this.booking){const i=e.find((e=>this.booking.source?.code===e.code));t=i}else{t=i.find((e=>e.type!=="LABEL"))}w({source:t})}getFilteredSourceOptions(e){const i=new Set;if(!Boolean(this.unitId)){return e}const t=m.roomsInfo.find((e=>e.physicalrooms.find((e=>e.id.toString()===this.unitId?.toString()))));const a=(()=>{const e=t?.rateplans??[];if(e.length===0)return false;const a=e.every((e=>(e?.agents?.length??0)>0));if(a){e.forEach((e=>{(e?.agents??[]).forEach((e=>i.add(e?.id?.toString())))}))}return a})()??false;if(!a){return e}return e.filter((e=>{if(e?.type==="LABEL")return true;const t=e?.tag;const a=t!=null&&i.has(t);return a}))}async fetchSetupEntries(){return await this.bookingService.fetchSetupEntries()}render(){if(this.isLoading){return e("div",{class:"drawer__loader-container"},e("ir-spinner",null))}return e(a,null,e("div",null,e("ir-interceptor",null),this.step==="details"&&e(o,null,e("ir-booking-editor-header",{isBlockConversion:!!this.blockedUnit?.STATUS_CODE,booking:this.booking,checkIn:this.checkIn,checkOut:this.adjustedCheckout,mode:this.mode}),e("div",{class:"booking-editor__roomtype-container"},k.roomTypes?.map((i=>e("igl-room-type",{key:`room-type-${i.id}`,id:i.id.toString(),roomType:i,bookingType:this.mode,ratePricingMode:k.selects?.ratePricingMode,roomTypeId:this.room?.roomtype?.id,currency:m.property.currency}))))),this.step==="confirm"&&e("ir-booking-editor-form",{onDoReservation:e=>{e.stopImmediatePropagation();e.stopPropagation();this.doReservation(e.detail)},room:this.room,mode:this.mode})))}static get watchers(){return{mode:["handleModeChange"]}}};xe.style=we;const De=".sc-ir-booking-editor-drawer-h{display:block}.booking-editor__drawer.sc-ir-booking-editor-drawer::part(dialog){overflow:hidden}";const Ye=De;const Me=class{constructor(e){i(this,e);this.bookingEditorClosed=t(this,"bookingEditorClosed",7)}open;ticket;propertyid;language="en";booking;mode="PLUS_BOOKING";label;checkIn;checkOut;unitId;blockedUnit;roomTypeIds=[];roomIdentifier;step="details";isLoading;bookingEditorClosed;token=new R;bookingService=new u;bookingEditorService=new ke;wasBlockedUnit=false;didAdjustBlockedUnit=false;originalBlockPayload;componentWillLoad(){if(this.token){this.token.setToken(this.ticket)}this.initializeBlockedUnitState(this.blockedUnit)}handleTicketChange(){if(this.token){this.token.setToken(this.ticket)}}handleBlockedUnitChange(e){this.initializeBlockedUnitState(e)}handleCheckInChange(){this.initializeBlockedUnitState(this.blockedUnit)}handleCheckOutChange(){this.initializeBlockedUnitState(this.blockedUnit)}handleUnitChange(){this.initializeBlockedUnitState(this.blockedUnit)}initializeBlockedUnitState(e){const i=["002","003","004"];if(!e){this.wasBlockedUnit=false;this.originalBlockPayload=undefined;return}const t=Boolean(e&&i.includes(e.STATUS_CODE));if(!t||!this.checkIn||!this.checkOut||!this.unitId){this.wasBlockedUnit=false;this.originalBlockPayload=undefined;this.didAdjustBlockedUnit=false;return}this.originalBlockPayload={from_date:this.checkIn,to_date:this.checkOut,NOTES:e.OPTIONAL_REASON||"",pr_id:this.unitId.toString(),STAY_STATUS_CODE:e.STATUS_CODE||(e.OUT_OF_SERVICE?"004":Number(e.RELEASE_AFTER_HOURS)===0?"002":"003"),DESCRIPTION:e.RELEASE_AFTER_HOURS||"",BLOCKED_TILL_DATE:e.ENTRY_DATE||undefined,BLOCKED_TILL_HOUR:e.ENTRY_HOUR!==undefined&&e.ENTRY_HOUR!==null?e.ENTRY_HOUR.toString():undefined,BLOCKED_TILL_MINUTE:e.ENTRY_MINUTE!==undefined&&e.ENTRY_MINUTE!==null?e.ENTRY_MINUTE.toString():undefined};this.wasBlockedUnit=true;this.didAdjustBlockedUnit=false}handleBookingStepChange(e){e.stopImmediatePropagation();e.stopPropagation();const{direction:i}=e.detail;switch(i){case"next":this.step="confirm";break;case"prev":this.step="details";break;default:console.warn("Direction not supported")}}get drawerLabel(){if(this.label){return this.label}switch(this.mode){case"SPLIT_BOOKING":case"BAR_BOOKING":case"ADD_ROOM":case"EDIT_BOOKING":case"PLUS_BOOKING":return"New Booking"}}goToConfirm=e=>{e?.stopPropagation();this.step="confirm"};goToDetails=()=>{if(this.mode==="BAR_BOOKING"){M()}if(this.mode==="EDIT_BOOKING"){M();this.bookingEditorService.updateBooking(this.bookingEditorService.getRoom(this.booking,this.roomIdentifier))}this.step="details"};renderFooter(){switch(this.step){case"details":return this.renderDetailsActions();case"confirm":return this.renderConfirmActions();default:return null}}renderConfirmActions(){const{checkIn:i}=k?.bookingDraft?.dates;const t=i?i?.isSame(r(),"date"):false;return e(o,null,e("ir-custom-button",{onClickHandler:this.goToDetails,size:"medium",appearance:"filled",variant:"neutral"},"Back"),e("ir-custom-button",{loading:this.isLoading==="book",value:"book",form:"new_booking_form",disabled:false,type:"submit",size:"medium",appearance:t?"outlined":"accent",variant:"brand"},"Book"),t&&e("ir-custom-button",{loading:this.isLoading==="book-checkin",value:"book-checkin",form:"new_booking_form",type:"submit",size:"medium",appearance:"accent",variant:"brand"},"Book and check-in"))}renderDetailsActions(){const i=C();return e(o,null,e("ir-custom-button",{"data-drawer":"close",size:"medium",appearance:"filled",variant:"neutral"},"Cancel"),["PLUS_BOOKING","ADD_ROOM"].includes(this.mode)&&e(o,null,!i&&e("wa-tooltip",{for:"booking_editor__next-button"},"Please select at least one unit to continue."),e("ir-custom-button",{id:"booking_editor__next-button",disabled:!i,onClickHandler:this.goToConfirm,size:"medium",appearance:"accent",variant:"brand"},"Next")))}async closeDrawer(){if(this.wasBlockedUnit&&!this.didAdjustBlockedUnit){await this.checkAndBlockDate()}else if(this.blockedUnit&&this.blockedUnit.STATUS_CODE){await this.handleBlockDate()}this.bookingEditorClosed.emit();this.step="details"}getBlockUnitPayload(){if(this.wasBlockedUnit&&this.originalBlockPayload){return this.originalBlockPayload}if(!this.blockedUnit||!this.checkIn||!this.checkOut||!this.unitId){return undefined}const e=d(this.blockedUnit.RELEASE_AFTER_HOURS!==null?Number(this.blockedUnit.RELEASE_AFTER_HOURS):null);return{from_date:this.checkIn,to_date:this.checkOut,NOTES:this.blockedUnit.OPTIONAL_REASON||"",pr_id:this.unitId.toString(),STAY_STATUS_CODE:this.blockedUnit.OUT_OF_SERVICE?"004":Number(this.blockedUnit.RELEASE_AFTER_HOURS)===0?"002":"003",DESCRIPTION:this.blockedUnit.RELEASE_AFTER_HOURS||"",...e}}async handleBlockDate(e=true,i){try{const t=i??this.getBlockUnitPayload();if(!t){return}await this.bookingService.blockUnit(t);if(e){this.blockedUnit=undefined;this.initializeBlockedUnitState(undefined)}}catch(e){}}async handleAdjustBlockedUnitEvent(e){e.stopImmediatePropagation();e.stopPropagation();try{await this.adjustBlockedDatesAfterReservation(e.detail);this.didAdjustBlockedUnit=true}catch(e){console.error("Error adjusting blocked unit:",e)}}async adjustBlockedDatesAfterReservation(e){if(!this.wasBlockedUnit||!this.originalBlockPayload){return}const i={...this.originalBlockPayload};const t=r(this.originalBlockPayload.from_date,"YYYY-MM-DD");const a=r(e.booking.from_date,"YYYY-MM-DD");const o=r(this.originalBlockPayload.to_date,"YYYY-MM-DD");const n=r(e.booking.to_date,"YYYY-MM-DD");if(n.isBefore(o,"days")){const e={...i,from_date:n.format("YYYY-MM-DD")};await this.bookingService.blockUnit(e)}if(a.isAfter(t,"days")){const e={...i,to_date:a.format("YYYY-MM-DD")};await this.bookingService.blockUnit(e)}return}async checkAndBlockDate(){try{if(!this.originalBlockPayload||!this.roomTypeIds||this.roomTypeIds.length===0){return}const e=this.roomTypeIds.map((e=>Number(e))).filter((e=>!Number.isNaN(e)));if(e.length===0){return}await this.bookingService.getBookingAvailability({from_date:this.originalBlockPayload.from_date,to_date:this.originalBlockPayload.to_date,propertyid:m.property.id,adultChildCount:{adult:2,child:0},language:this.language,room_type_ids:e,currency:m.property?.currency});const i=k.roomTypes.every((e=>{if(e.is_available_to_book){return true}return e.inventory>0&&e["not_available_reason"]==="ALL-RATES-PLAN-NOT-BOOKABLE"}));if(i){await this.handleBlockDate()}else{console.warn("Blocked date is unavailable. Continuing...")}}catch(e){console.error("Error checking and blocking date:",e)}}render(){return e("ir-drawer",{key:"16dd8a80a1cf23338a524c40e09934576242d94f",onDrawerHide:async e=>{e.stopImmediatePropagation();e.stopPropagation();await this.closeDrawer()},style:{"--ir-drawer-width":"70rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"},class:"booking-editor__drawer",label:this.drawerLabel,open:this.open},this.open&&this.ticket&&e("ir-booking-editor",{key:"9832806c85319acd04c19ec436ce0b8fc21e3f78",onLoadingChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.isLoading=e.detail.cause},onAdjustBlockedUnit:e=>this.handleAdjustBlockedUnitEvent(e),unitId:this.unitId,propertyId:this.propertyid,roomTypeIds:this.roomTypeIds,onResetBookingEvt:async()=>{this.blockedUnit=undefined;this.initializeBlockedUnitState(undefined);await this.closeDrawer()},step:this.step,blockedUnit:this.blockedUnit,language:this.language,booking:this.booking,mode:this.mode,checkIn:this.checkIn,checkOut:this.checkOut,identifier:this.roomIdentifier}),e("div",{key:"f5af43e275fe962692a14d8da482bfcfa8516257",slot:"footer",class:"ir__drawer-footer"},this.renderFooter()))}static get watchers(){return{ticket:["handleTicketChange"],blockedUnit:["handleBlockedUnitChange"],checkIn:["handleCheckInChange"],checkOut:["handleCheckOutChange"],unitId:["handleUnitChange"]}}};Me.style=Ye;const Ce=".sc-ir-booking-editor-form-h{display:flex;flex-direction:column;height:100%}.booking-editor__guest-form.sc-ir-booking-editor-form{display:flex;flex-direction:column;gap:1rem;height:100%}.booking-editor__header.sc-ir-booking-editor-form{width:100%;align-items:flex-center;display:flex}.booking-editor__dates.sc-ir-booking-editor-form{line-height:1.2}.booking-editor__total.sc-ir-booking-editor-form{display:flex;align-items:center;white-space:nowrap}.booking-editor__total-label.sc-ir-booking-editor-form{margin-right:4px}.booking-editor__total-amount.sc-ir-booking-editor-form{white-space:nowrap}.booking-editor__booked-by.sc-ir-booking-editor-form{display:flex;flex-direction:column;gap:1rem;margin-bottom:1.5rem}.booking-editor__heading.sc-ir-booking-editor-form{margin:0;font-family:var(--wa-font-family-heading);font-weight:var(--wa-font-weight-heading);line-height:var(--wa-line-height-condensed);text-wrap:balance;font-size:var(--wa-font-size-l)}@media (min-width: 768px){.booking-editor__booked-by.sc-ir-booking-editor-form{flex-direction:row;align-items:center}.booking-editor__booked-by-picker.sc-ir-booking-editor-form{max-width:40rem}}";const Ie=Ce;const Se=class{constructor(e){i(this,e);this.doReservation=t(this,"doReservation",7)}mode="PLUS_BOOKING";room;guests;totalCost=0;doReservation;bookingService=new u;totalRooms=0;pickerEl;async componentWillLoad(){this.totalRooms=I();this.totalCost=this.totalRooms>1?await S():0}async handleRecalculation(e){e.stopImmediatePropagation();e.stopPropagation();this.totalCost=this.totalRooms>1?await S():0}async fetchGuests(e){try{if(!e){return}this.guests=await this.bookingService.fetchExposedGuest(e,m.property.id)}catch(e){console.log(e)}}handleComboboxSelect(e){const i=this.guests?.find((i=>i.id?.toString()===e.detail.item.value));if(!i){console.warn(`guest not found with id ${e.detail.item.value}`);return}v({id:i.id,email:i.email,firstName:i.first_name,lastName:i.last_name,mobile:i.mobile_without_prefix,countryId:i.country_id?.toString(),phone_prefix:i["country_phone_prefix"]})}render(){const{dates:i}=k.bookingDraft;let t=false;return e("form",{key:"9fc94f01401b654e7df2e82cabd0c2c7443cc79e",class:"booking-editor__guest-form",id:"new_booking_form",autoComplete:"off",onSubmit:e=>{e.preventDefault();const i=e.submitter;this.doReservation.emit(i?.value)}},e("div",{key:"cb02858236ee06d03a3024fbd88bd81d35def074",class:"booking-editor__header"},e("ir-date-view",{key:"574fdbc8e0ffbcfa9bec4b970c95769ae0b0ca61",class:"booking-editor__dates mr-1 flex-fill font-weight-bold font-medium-1",from_date:i.checkIn,to_date:i.checkOut,dateOption:"DD MMM YYYY"}),this.totalRooms>1&&e("div",{key:"bed597907a604372a6088bbf7c9c6ef689942aa2",class:"booking-editor__total mt-1 mt-md-0 text-right"},e("span",{key:"c566882fe0317764b2ce1d80ed0ed129d7588e4c",class:"booking-editor__total-label"},b.entries.Lcz_TotalPrice)," ",e("span",{key:"53ccab7184db045abdcf70730d44c612f038f47b",class:"booking-editor__total-amount font-weight-bold font-medium-1"},s(m.property.currency.symbol,this.totalCost)))),Object.values(k.ratePlanSelections).map((a=>Object.values(a).map((a=>{const o=a;if(o.reserved===0){return null}return[...new Array(o.reserved)].map(((a,n)=>{const r=["BAR_BOOKING","PLUS_BOOKING"].includes(this.mode)&&k.bookedByGuest.id===-1&&!t&&!k.bookedByGuestManuallyEdited;if(r){t=true}return e("igl-application-info",{autoFillGuest:r,totalNights:G(i.checkIn.format("YYYY-MM-DD"),i.checkOut.format("YYYY-MM-DD")),bedPreferenceType:k.selects.bedPreferences,currency:m.property.currency,guestInfo:o.guest?o.guest[n]:null,bookingType:this.mode,rateplanSelection:o,key:`${o.ratePlan.id}_${n}`,roomIndex:n,baseData:this.mode==="EDIT_BOOKING"?{roomtypeId:this.room.roomtype.id,unit:this.room.unit}:undefined})}))})))),["BAR_BOOKING","PLUS_BOOKING"].includes(this.mode)&&e("section",{key:"15c14f77330f10f175724fdc87c202778568d2d6",class:"mt-2"},e("div",{key:"4e07a3b7ba1a2d1214b21e0373869da5a9d20ce3",class:"booking-editor__booked-by booking-editor__booked-by-header"},e("h4",{key:"142f08fad63836ef9b52102be09e4c16d5cab008",class:"booking-editor__heading booking-editor__booked-by-title"},"Booked by"),e("ir-picker",{key:"7714a4e961d7f77010bf0067c13a3404869281c0",class:"booking-editor__booked-by-picker",appearance:"filled",placeholder:"Search customer by email or name",withClear:true,"onText-change":e=>this.fetchGuests(e.detail),debounce:500,loading:O("/Fetch_Exposed_Guests"),mode:"select-async",ref:e=>this.pickerEl=e,"onCombobox-select":this.handleComboboxSelect.bind(this)},this.guests?.map((i=>{const t=`${i.email} - ${i.first_name} ${i.last_name}`;return e("ir-picker-item",{label:t,value:i.id?.toString(),key:i.id},t)}))),k.bookedByGuest.id!==-1&&e("ir-custom-button",{key:"191141dbfe27f4e98b04d63f4da929aeff91ca9d",onClickHandler:()=>{v(E);this.pickerEl.clearInput()},variant:"brand"},"Clear user")),e("ir-booking-editor-guest-form",{key:"1b85e7525108f73dec833154d330c5f7b301b6f0"})))}};Se.style=Ie;const Ee=".sc-ir-booking-editor-guest-form-h{padding-bottom:3rem}.sc-ir-booking-editor-guest-form-h{display:flex;flex-direction:column;gap:1rem}.booking-editor__guest-name-group.sc-ir-booking-editor-guest-form,.booking-editor__form-control.sc-ir-booking-editor-guest-form{display:flex;flex-direction:column;gap:1rem}.booking-editor__guest-input.sc-ir-booking-editor-guest-form,.booking-editor__guest-input-validator.sc-ir-booking-editor-guest-form{width:100%}.booking-editor__form-control.sc-ir-booking-editor-guest-form{width:100%;flex-grow:0;height:fit-content}.booking-editor__payment-info-description.sc-ir-booking-editor-guest-form{display:flex;height:fit-content;flex-direction:column}.booking-editor__guest-input-label.--first-name-pc-label.sc-ir-booking-editor-guest-form{display:none}@media (min-width: 768px){.booking-editor__guest-input-label.--first-name-pc-label.sc-ir-booking-editor-guest-form{display:block}.booking-editor__guest-name-group.sc-ir-booking-editor-guest-form{display:flex;flex-direction:row;align-items:flex-end}.booking-editor__guest-input-label.--first-name-mobile-label.sc-ir-booking-editor-guest-form,.booking-editor__guest-input.--last-name.sc-ir-booking-editor-guest-form::part(label){display:none}.sc-ir-booking-editor-guest-form-h{flex-direction:row;gap:4rem}}";const ze=Ee;const Be=class{constructor(e){i(this,e)}paymentMethods=[];expiryDateMask={mask:"MM/YY",placeholderChar:"_",blocks:{MM:{mask:F.MaskedRange,from:1,to:12,maxLength:2},YY:{mask:F.MaskedRange,from:(new Date).getFullYear()%100,to:(new Date).getFullYear()%100+20,maxLength:2}}};componentWillLoad(){this.paymentMethods=m.property.allowed_payment_methods.filter((e=>e.is_active&&!e.is_payment_gateway));if(this.paymentMethods.length>0){g("selectedPaymentMethod",{code:this.paymentMethods[0].code})}}updateCountry(e){e.stopImmediatePropagation();e.stopPropagation();const i=e.detail;let t={countryId:i.id.toString()};if(!k.bookedByGuest.mobile){t={...t,phone_prefix:i.phone_prefix}}v(t)}get expiryDate(){const{expiryMonth:e,expiryYear:i}=k.bookedByGuest;if(!e||!i){return""}const t=i.toString().length===4?i.toString().slice(-2):i.toString();return`${e}/${t}`}render(){const{bookedByGuest:i,selects:t}=k;return e(a,{key:"85bc00f2f9c3708317b4ca2d9d2e2a0691bf820d"},e("section",{key:"6c7732c9ee15b76babad7c17e773fb7bc8ba6c59",class:"booking-editor__form-control"},e("ir-input",{key:"74eb8b02c2aec6b2841118fb76dc7eb2f7272e50",label:"Email address","onText-change":e=>v({email:e.detail}),type:"email",value:i.email,defaultValue:i.email,placeholder:"Email (leave empty if not available)"}),e("div",{key:"40dfdf9b0d1f55e7cb014d2c647830867b3123e4",class:"booking-editor__guest-name-group",id:"booking-editor-guest-name-group"},e("ir-validator",{key:"866794b543cfdfe5ff85ff3c28c3ff5e990d97f6",class:"booking-editor__guest-input-validator",value:i.firstName,schema:ye.shape.firstName},e("ir-input",{key:"00728a289bfaea558de36a7fe8a4c64ce25a3f95",id:"booking-editor-guest-first-name",class:"booking-editor__guest-input --first-name",value:i.firstName,defaultValue:i.firstName,placeholder:"First name",autocomplete:"off","onText-change":e=>v({firstName:e.detail})},e("p",{key:"7a8d012df824e800ac1cf220ace0898173bdbd53",style:{margin:"0",marginBottom:"0.5rem"},slot:"label"},e("span",{key:"1d53dc5dbd2d24c5da963bf4c677a24d6b5fd0bf",class:"booking-editor__guest-input-label --first-name-pc-label"},"Name"),e("span",{key:"651779135825f040e9180193c5a69d9e671b6bd3",class:"booking-editor__guest-input-label --first-name-mobile-label"},"First name")))),e("ir-validator",{key:"c8b839084f6903b157550225ca8f4ddc383cdf8c",class:"booking-editor__guest-input-validator",value:i.lastName,schema:ye.shape.lastName},e("ir-input",{key:"df4dac8d02639d049e30ea5fbdcc72f503e282b6",id:"booking-editor-guest-last-name",class:"booking-editor__guest-input --last-name",label:"Last name","onText-change":e=>v({lastName:e.detail}),value:i.lastName,defaultValue:i.lastName,placeholder:"Last name",autocomplete:"off"}))),e("ir-input",{key:"893b9b94cffc36169180931304a0cafbca6d386e",label:"Company name",placeholder:"Company name",value:i.company,defaultValue:i.company,"onText-change":e=>v({company:e.detail})}),e("ir-country-picker",{key:"cd42aa9d53fbef8c5d9a7dd63d5dded9b3498b62",label:b.entries.Lcz_Country,variant:"modern",testId:"main_guest_country",class:"flex-grow-1 m-0",onCountryChange:e=>this.updateCountry(e),countries:t.countries,country:t.countries.find((e=>e.id.toString()===i.countryId?.toString()))}),e("ir-mobile-input",{key:"d0fe92c41c98d632c955d6358f211e65fb8cdec6",size:"small","onMobile-input-change":e=>{v({mobile:e.detail.formattedValue})},"onMobile-input-country-change":e=>v({phone_prefix:e.detail.phone_prefix}),value:i.mobile,countryCode:t.countries.find((e=>e.phone_prefix===i.phone_prefix))?.code,countries:t.countries}),e("wa-select",{key:"3c30b7765d3189483cc0b7a07839a25bec3a18f6",size:"small",label:b.entries.Lcz_YourArrivalTime,"data-testid":"arrival_time",id:A(),defaultValue:t.arrivalTime[0].CODE_NAME,value:i.selectedArrivalTime,onchange:e=>v({selectedArrivalTime:e.target.value})},t.arrivalTime.map((t=>e("wa-option",{value:t.CODE_NAME,selected:i.selectedArrivalTime===t.CODE_NAME},t.CODE_VALUE_EN))))),e("section",{key:"31b69481fa48842e5a230eb23d5518ca1297e647",class:"booking-editor__form-control"},e("wa-textarea",{key:"c242781d4ee08ef6f58d76a78aa068567863a7c8",onchange:e=>v({note:e.target.value}),size:"small",value:i.note,defaultValue:i.note,label:b.entries.Lcz_AnyMessageForUs,rows:3}),this.paymentMethods.length>1&&e("wa-select",{key:"f6b6a3a1ff22f5de130582f1a0ef15592ec3d6a1",label:"Payment Method",size:"small",defaultValue:k?.selectedPaymentMethod?.code??this.paymentMethods[0].code,value:k?.selectedPaymentMethod?.code,onchange:e=>g("selectedPaymentMethod",{code:e.target.value})},this.paymentMethods.map((i=>e("wa-option",{value:i.code},i.description)))),k.selectedPaymentMethod?.code==="001"&&e(o,{key:"e2ca098089ecf0d985a56404463bc6f984d74352"},e("ir-input",{key:"3f978d0def111d239dce249ea1085440683d47b7",value:i.cardNumber,defaultValue:i.cardNumber,"onText-change":e=>v({cardNumber:e.detail.trim()}),label:b.entries.Lcz_CardNumber}),e("ir-input",{key:"4a0f526a4f06a5e3d0cc8ea691dfb5b270b299ec",value:i.cardHolderName,defaultValue:i.cardHolderName,"onText-change":e=>v({cardHolderName:e.detail.trim()}),label:b.entries.Lcz_CardHolderName}),e("ir-input",{key:"b90b521a72b3f4220a5dee57c56be0620d32252f","onText-change":e=>{const[i,t]=e.detail.split("/");v({expiryMonth:i,expiryYear:t})},value:this.expiryDate,mask:this.expiryDateMask,label:b.entries.Lcz_ExpiryDate})),k.selectedPaymentMethod?.code==="005"&&e(o,{key:"a06656a3522b2da15b8f4f08476ad1f1a1042e8a"},e("style",{key:"97a306283cff7e28275f5d544bc51a612ba7d85d"},`p{\n              margin:0;\n              padding:0}`),e("div",{key:"c19ea164582bb8d1b4f4679d39f5f7dbd09831b8",class:"booking-editor__payment-info-description",innerHTML:this.paymentMethods.find((e=>e.code==="005"))?.localizables.find((e=>e.language.code.toLowerCase()==="en"))?.description})),e("wa-checkbox",{key:"2f699b314f5d6bbf2f7ad25a4f13ffbf6ab7564c",defaultChecked:i.emailGuest,checked:i.emailGuest,onchange:e=>v({emailGuest:e.target.checked})},b.entries.Lcz_EmailTheGuest)))}};Be.style=ze;const Oe=".sc-ir-booking-editor-header-h{display:flex;flex-direction:column;gap:var(--wa-space-m, 1rem)}.booking-editor-header__container.sc-ir-booking-editor-header{display:flex;flex-direction:column;gap:var(--wa-space-m, 1rem)}.booking-editor-header__booking-picker.sc-ir-booking-editor-header{max-width:350px}.booking-editor-header__booking-picker-validator.sc-ir-booking-editor-header{margin-bottom:1rem}.booking-editor-header__tax_statement.sc-ir-booking-editor-header{margin-top:1.5rem}@media (min-width: 768px){.booking-editor-header__container.sc-ir-booking-editor-header{flex-direction:row;align-items:flex-start;flex-wrap:wrap}.booking-editor-header__adults-select.sc-ir-booking-editor-header{width:100px}.booking-editor-header__children-select.sc-ir-booking-editor-header{width:170px}}@media (min-width: 1024px){.booking-editor__date-validator.sc-ir-booking-editor-header::part(error-message){position:absolute}}";const Ae=Oe;const Te=class{constructor(e){i(this,e);this.guestSelected=t(this,"guestSelected",7);this.checkAvailability=t(this,"checkAvailability",7)}booking;isBlockConversion;mode="PLUS_BOOKING";checkIn;checkOut;isLoading;bookings=[];datesSchema;guestSelected;checkAvailability;bookingService=new u;adultsSchema=U.coerce.number().min(1);bookingEditorService=new ke;BookedByGuestPickerSchema=U.object({firstName:U.string()}).superRefine(((e,i)=>{if(!e.firstName){i.addIssue({path:["firstName"],code:U.ZodIssueCode.custom,message:b.entries.Lcz_ChooseBookingNumber})}}));pickerRef;componentWillLoad(){this.createDatesSchema();this.bookingEditorService.setMode(this.mode)}handleBookingChange(e,i){if(e!==i){this.createDatesSchema()}}handleModeChange(e,i){if(e!==i){this.createDatesSchema();this.bookingEditorService.setMode(this.mode)}}createDatesSchema(){this.datesSchema=U.object({checkIn:U.any(),checkOut:U.any()}).superRefine(((e,i)=>{if(!r.isMoment(e.checkIn)){i.addIssue({path:["checkIn"],code:U.ZodIssueCode.custom,message:"Check-in date is required"})}if(r.isMoment(e.checkIn)&&this.bookingEditorService.isEventType(["SPLIT_BOOKING","ADD_ROOM"])&&!e.checkIn.isSameOrBefore(this.booking.to_date)){i.addIssue({path:["checkIn"],code:U.ZodIssueCode.custom,message:`${b.entries.Lcz_CheckInDateShouldBeMAx.replace("%1",r(this.booking.from_date,"YYYY-MM-DD").format("ddd, DD MMM YYYY")).replace("%2",r(this.booking.to_date,"YYYY-MM-DD").format("ddd, DD MMM YYYY"))}  `})}if(!r.isMoment(e.checkOut)){i.addIssue({path:["checkOut"],code:U.ZodIssueCode.custom,message:"Check-out date is required"})}}))}async handleBookingSearch(e){try{this.isLoading=true;if(!e){this.pickerRef.clearInput();return}this.bookings=await this.bookingService.fetchExposedBookings(e,m.property.id,this.checkIn,this.checkOut)}catch(e){console.error(e)}finally{this.isLoading=false}}handleSubmit(e){e.preventDefault();this.stopEvent(e);try{if(this.mode==="SPLIT_BOOKING"&&!k.bookedByGuest.firstName){ye.parse(k.bookedByGuest)}this.datesSchema.parse(k.bookingDraft.dates);this.adultsSchema.parse(k.bookingDraft?.occupancy?.adults);this.checkAvailability.emit()}catch(e){console.error(e)}}handleDateRangeChange(e){this.stopEvent(e);z();w({dates:e.detail})}handleSourceChange(e){this.stopEvent(e);const i=e.target.value;const t=k.selects.sources.find((e=>e.id===i));w({source:t})}handleAdultsChange(e){this.stopEvent(e);z();const i=Number(e.target.value);const{children:t}=k.bookingDraft.occupancy;w({occupancy:{adults:i,children:t}})}handleChildrenChange(e){this.stopEvent(e);z();const i=Number(e.target.value);const{adults:t}=k.bookingDraft.occupancy;w({occupancy:{adults:t,children:i}})}stopEvent(e){e.stopImmediatePropagation();e.stopPropagation()}get minDate(){const e=r();switch(this.mode){case"EDIT_BOOKING":return e.add(-2,"weeks").format("YYYY-MM-DD");case"ADD_ROOM":return this.booking?.from_date;case"SPLIT_BOOKING":default:if(this.checkIn&&this.isBlockConversion)return this.checkIn;return e.format("YYYY-MM-DD")}}get maxDate(){switch(this.mode){case"PLUS_BOOKING":if(this.checkOut&&this.isBlockConversion)return this.checkOut;return undefined;case"ADD_ROOM":case"SPLIT_BOOKING":default:return undefined}}get childrenSelectPlaceholder(){const{child_max_age:e}=m.property.adult_child_constraints;const i=e===1?b.entries.Lcz_Year:b.entries.Lcz_Years;return`${b.entries.Lcz_ChildCaption} 0 - ${e} ${i}`}async selectGuest(e){this.stopEvent(e);const i=e.detail?.item?.value;const t=await this.bookingService.getExposedBooking(i,"en",true);this.guestSelected.emit(t)}render(){const{sources:i}=k.selects;const{adults:t,children:n}=k.bookingDraft.occupancy;const{checkIn:r,checkOut:s}=k.bookingDraft.dates;return e(a,{key:"4f0e343b85259d5bbf214a51a4ab569c1165964b"},e("form",{key:"6d1400217692604be49e5a45b99cc7cc93b3723a",onSubmit:this.handleSubmit.bind(this)},this.bookingEditorService.isEventType("SPLIT_BOOKING")&&e("ir-validator",{key:"76a6b5820641b30d7fabe15f6b236e2ac08f96f9",value:k.bookedByGuest,class:"booking-editor-header__booking-picker-validator",showErrorMessage:true,schema:this.BookedByGuestPickerSchema},e("ir-picker",{key:"dc42c7205990d27fabbe4e2d7d7677436dfc9953",withClear:true,mode:"select-async",class:"booking-editor-header__booking-picker",debounce:300,ref:e=>this.pickerRef=e,label:`${b.entries.Lcz_Tobooking}#`,placeholder:b.entries.Lcz_BookingNumber,loading:this.isLoading,"onText-change":e=>this.handleBookingSearch(e.detail),"onCombobox-select":this.selectGuest.bind(this)},this.bookings.map((i=>{const t=`${i.booking_nbr} ${i.guest.first_name} ${i.guest.last_name}`;return e("ir-picker-item",{value:i.booking_nbr?.toString(),label:t},t)})))),e("div",{key:"4e85f6fc92bf13a6cd51c3133a481c87adaeec6d",class:"booking-editor-header__container"},!this.bookingEditorService.isEventType(["EDIT_BOOKING","ADD_ROOM","SPLIT_BOOKING"])&&e("wa-select",{key:"5b1a9320975f8a425d32ddacf096046070e723de",size:"small",placeholder:b.entries.Lcz_Source,value:k.bookingDraft.source?.id?.toString(),defaultValue:k.bookingDraft.source?.id,"onwa-hide":this.stopEvent.bind(this),onchange:this.handleSourceChange.bind(this)},i.map((i=>i.type==="LABEL"?e("small",null,i.description):e("wa-option",{value:i.id?.toString()},i.description)))),e("ir-validator",{key:"8882c2bee2ed77e1a62c76b1c3d17d7a0525f433",class:"booking-editor__date-validator",showErrorMessage:true,value:k.bookingDraft.dates,schema:this.datesSchema,style:{position:"relative"}},e("igl-date-range",{key:"2224f1a00efa87879951ae32824a5306750588d1",defaultData:{fromDate:r?.format("YYYY-MM-DD")??"",toDate:s?.format("YYYY-MM-DD")??""},variant:"booking",withDateDifference:true,minDate:this.minDate,maxDate:this.maxDate,onDateRangeChange:this.handleDateRangeChange.bind(this)})),!this.bookingEditorService.isEventType("EDIT_BOOKING")&&e(o,{key:"cdeb21ad9d1780499dd4d538cc2433f0dca9a7df"},e("ir-validator",{key:"33d769a03fa7fbd044f162a951204f524b2aec31",value:t,schema:this.adultsSchema},e("wa-select",{key:"ce3036fdb5e0487fc1784281499474584a26e972",class:"booking-editor-header__adults-select",size:"small",placeholder:b.entries.Lcz_AdultsCaption,value:t?.toString(),defaultValue:t?.toString(),"onwa-hide":this.stopEvent.bind(this),onchange:this.handleAdultsChange.bind(this)},Array.from({length:m.property.adult_child_constraints.adult_max_nbr},((e,i)=>i+1)).map((i=>e("wa-option",{value:i.toString()},i))))),m.property.adult_child_constraints.child_max_nbr>0&&e("wa-select",{key:"11bf350bfbb6a4fd1a7d654e30063c484057ff2c",class:"booking-editor-header__children-select",size:"small",placeholder:this.childrenSelectPlaceholder,value:n?.toString(),defaultValue:n?.toString(),"onwa-hide":this.stopEvent.bind(this),onchange:this.handleChildrenChange.bind(this)},Array.from({length:m.property.adult_child_constraints.child_max_nbr},((e,i)=>i+1)).map((i=>e("wa-option",{value:i.toString()},i))))),e("ir-custom-button",{key:"21122362657324dd98f6d10375a27f2465053ee1",loading:O("/Check_Availability"),type:"submit",variant:"brand"},"Check")),k.roomTypes?.length>0&&e("wa-callout",{key:"247dc878bf865ff41ea8e600c9deea155cdeb930",size:"small",variant:"neutral",appearance:"filled",class:"booking-editor-header__tax_statement"},m.tax_statement)))}static get watchers(){return{booking:["handleBookingChange"],mode:["handleModeChange"]}}};Te.style=Ae;const Pe=".sc-ir-booking-extra-note-h{display:block}";const Ne=Pe;const $e=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7);this.resetBookingEvt=t(this,"resetBookingEvt",7)}open;booking;isLoading=false;note="";closeModal;resetBookingEvt;bookingService=new u;componentWillLoad(){if(this.booking.extras){this.setNote(H(this.booking.extras))}}setNote(e){this.note=e}async savePrivateNote(){try{this.isLoading=true;let e=this.booking.extras||[];const i={key:"private_note",value:this.note};if(e.length===0){e.push(i)}else{const t=e.findIndex((e=>e.key==="private_note"));if(t===-1){e.push(i)}else{e[t]=i}}const t=await this.bookingService.doReservation({assign_units:true,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,booking:this.booking,Is_Non_Technical_Change:true,extras:e});this.resetBookingEvt.emit(t);this.closeDialog()}catch(e){console.error(e)}finally{this.isLoading=false}}async openDialog(){this.open=true}async closeDialog(){this.open=false}render(){return e("ir-dialog",{key:"36f1475d5ae206114d578bf47417138cac36960b",label:"Private note",open:this.open,onIrDialogHide:()=>{this.open=false}},e("wa-textarea",{key:"498bbb24db4375e9f5e7d556472a1365d0c99658",size:"small",placeholder:b.entries.Lcz_PrivateNote_MaxChar,defaultValue:this.note,onchange:e=>this.setNote(e.target.value),value:this.note}),e("div",{key:"0282fb45b5c82ec7612327307328ed1cb01e6d6b",slot:"footer",class:"ir-dialog__footer"},e("ir-custom-button",{key:"150f80ce5fedee070a70389e236ee38b73d020ac","data-dialog":"close",size:"medium",variant:"neutral",appearance:"filled",onClickHandler:()=>this.closeModal.emit(null),class:`flex-fill'}`},b.entries.Lcz_Cancel),e("ir-custom-button",{key:"804841db1526c3b3dd2fe5f92960d02761c611fe",size:"medium",onClickHandler:()=>this.savePrivateNote(),variant:"brand",loading:this.isLoading},b.entries.Lcz_Save)))}};$e.style=Ne;const Re=".sc-ir-booking-guarantee-h{display:block}.sc-ir-booking-guarantee-h{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-booking-guarantee-h *.sc-ir-booking-guarantee{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.iframeHeight.sc-ir-booking-guarantee{height:max-content;height:22.5rem}";const Le=Re;const Ge=class{constructor(e){i(this,e)}booking;bookingService;collapsed=false;paymentDetailsUrl="";paymentExceptionMessage="";async componentWillLoad(){}formatCurrency(e,i,t="en-US"){if(!i||e<0){return""}return new Intl.NumberFormat(t,{style:"currency",currency:i,minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}checkPaymentCode(e){return m.allowed_payment_methods?.find((i=>i.code===e))?.description??null}getPaymentMethod(){let e=null;const i=this.booking?.extras?.find((e=>e.key==="payment_code"));if(this.booking.agent){const t=this.booking?.extras?.find((e=>e.key==="agent_payment_mode"));if(t){e=t.value==="001"?b.entries.Lcz_OnCredit:i?this.checkPaymentCode(i.value):null}}else if(i){e=i.value==="000"?"No card info required upon booking":this.checkPaymentCode(i.value)}return e}async handleToggleCollapse(){if(!this.booking.is_direct&&this.booking.channel_booking_nbr&&!this.booking.guest.cci&&!this.collapsed){this.paymentDetailsUrl=await this.bookingService.getPCICardInfoURL(this.booking.booking_nbr)}this.collapsed=!this.collapsed}shouldShowGuarantee(){const e=this.booking.is_direct?this.getPaymentMethod():null;return this.booking.is_direct?Boolean(e||this.booking.guest.cci):true}shouldShowToggleButton(){return!this.booking.is_direct&&this.booking.ota_guarante||this.booking.is_direct&&this.booking.guest.cci}renderCreditCardInfo(){const{cci:i}=this.booking.guest;if(!i)return null;return[e("div",null,i&&"Card:"," ",e("span",null,i.nbr||""),i.expiry_month&&" Expiry: ",e("span",null,i.expiry_month||"",i.expiry_year&&"/"+i.expiry_year)),e("div",null,i.holder_name&&"Name:"," ",e("span",null,i.holder_name||""),i.cvc&&" - CVC:"," ",e("span",null,i.cvc||""))]}renderCollapsedContent(){if(this.booking.guest.cci){return this.renderCreditCardInfo()}if(this.paymentDetailsUrl){return e("iframe",{src:this.paymentDetailsUrl,width:"100%",class:"iframeHeight",frameborder:"0",name:"payment"})}return e("div",{class:"text-center"},this.paymentExceptionMessage)}renderOtaGuarantee(){const{ota_guarante:i}=this.booking;if(!i||this.booking.is_direct)return null;return e("div",null,e("ir-label",{content:i.card_type+`${i.is_virtual?" (virtual)":""}`,labelText:`${b.entries.Lcz_CardType}:`}),e("ir-label",{content:i.cardholder_name,labelText:`${b.entries.Lcz_CardHolderName}:`}),e("ir-label",{content:i.card_number,labelText:`${b.entries.Lcz_CardNumber}:`}),e("ir-label",{content:this.formatCurrency(h(Number(i.meta?.virtual_card_current_balance),Number(i.meta?.virtual_card_decimal_places)),i.meta?.virtual_card_currency_code),labelText:`${b.entries.Lcz_CardBalance}:`}))}render(){if(!this.shouldShowGuarantee()){return null}const i=this.booking.is_direct?this.getPaymentMethod():null;return e("div",{class:"mb-1"},e("div",{class:"d-flex align-items-center"},e("span",{class:"mr-1 font-medium"},b.entries.Lcz_BookingGuarantee,i&&e("span",null,": ",i)),this.shouldShowToggleButton()&&e("ir-button",{id:"drawer-icon","data-toggle":"collapse","data-target":".guarrantee","aria-expanded":this.collapsed?"true":"false","aria-controls":"myCollapse",class:"sm-padding-right pointer",variant:"icon",icon_name:"credit_card",onClickHandler:this.handleToggleCollapse.bind(this)})),e("div",{class:"collapse guarrantee"},this.renderCollapsedContent()),this.renderOtaGuarantee())}};Ge.style=Le;const He=".sc-ir-booking-header-h{display:block}.confirmed.sc-ir-booking-header{color:#fff;display:flex;align-items:center}.bg-ir-green.sc-ir-booking-header{background:#629a4c;padding:0.2rem 0.3rem}.bg-ir-red.sc-ir-booking-header{background:#ff4961;padding:0.2rem 0.3rem}.bg-ir-orange.sc-ir-booking-header{background:#ff9149;padding:0.2rem 0.3rem}";const je=He;const Ue=class{constructor(e){i(this,e);this.toast=t(this,"toast",7);this.closeSidebar=t(this,"closeSidebar",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.openSidebar=t(this,"openSidebar",7)}booking;hasReceipt;hasPrint;hasDelete;hasMenu;hasCloseButton;hasEmail=true;bookingStatus=null;currentDialogStatus;toast;closeSidebar;resetBookingEvt;openSidebar;dialogRef;bookingService=new u;alertMessage=`ALERT! Modifying an OTA booking will create a discrepancy between igloorooms and the source. Future guest modifications on the OTA may require manual adjustmentsofthebooking.`;modalEl;handleSelectChange(e){e.stopPropagation();e.stopImmediatePropagation();const i=e.target;this.bookingStatus=i.selectedValue}async updateStatus(){if(!this.bookingStatus||this.bookingStatus==="-1"){this.toast.emit({type:"error",description:"",title:b.entries.Lcz_SelectStatus,position:"top-right"});return}try{await this.bookingService.changeExposedBookingStatus({book_nbr:this.booking.booking_nbr,status:this.bookingStatus});this.toast.emit({type:"success",description:"",title:b.entries.Lcz_StatusUpdatedSuccessfully,position:"top-right"});this.bookingStatus=null;this.modalEl.closeModal();this.resetBookingEvt.emit(null)}catch(e){console.log(e)}}openDialog(e){const{type:i}=e;this.currentDialogStatus=i;this.dialogRef.openModal()}renderDialogBody(){switch(this.currentDialogStatus){case"pms":return e("ir-pms-logs",{bookingNumber:this.booking.booking_nbr});case"events-log":return e("ir-events-log",{booking:this.booking,bookingNumber:this.booking.booking_nbr})}}render(){const i=this.booking.ota_manipulations?this.booking.ota_manipulations[this.booking.ota_manipulations.length-1]:null;const t=m.property?.linked_pms?.findIndex((e=>e?.is_active&&e?.bookings_integration_mode?.code==="001"))!==-1;return e("div",{key:"bdd7e61896592b169726e09c8b2675de2d24be05",class:"fluid-container px-1"},e("div",{key:"814adb89e1933c3f58dbe7cb1dfdefaf4347184e",class:"d-flex flex-column p-0 mx-0 flex-lg-row align-items-md-center justify-content-between"},e("div",{key:"8063874491ba6fa3e32465575696671ad4721449",class:"m-0 p-0 mb-1 mb-lg-0 mt-md-0"},e("div",{key:"ca7e62cd3ae6e14b22b97c1c1990a7b386c72567",class:"d-flex align-items-center",style:{gap:"0.5rem"}},e("p",{key:"a3ca263162c6554f0f95297e0f5eaf1298ac3332",style:{color:"black"},class:"font-size-large m-0 p-0"},`${b.entries.Lcz_Booking}#${this.booking.booking_nbr}`),e("wa-dropdown",{key:"f4a622b72e460e264d840c6de4460ea0d8e7e63c","onwa-hide":e=>{e.stopImmediatePropagation();e.stopPropagation()},"onwa-select":e=>{this.bookingStatus=e.detail.item.value;this.modalEl.openModal()}},e("ir-custom-button",{key:"ff7f2099651053b62184a45f2bb28d9535104a9a",slot:"trigger",withCaret:true,appearance:"outlined",size:"small",variant:"brand"},e("ir-booking-status-tag",{key:"d691ab6754d9dcc97503bd47c02625012f284938",slot:"start",status:this.booking.status,isRequestToCancel:this.booking.is_requested_to_cancel}),e("span",{key:"8d893b641396e3086b693ba10da72915ce976dd8"},"Update status")),this.booking.allowed_actions.map((i=>e("wa-dropdown-item",{variant:["CANC_RA","NOSHOW_RA"].includes(i.code)?"danger":"default",value:i.code},i.description))))),e("p",{key:"ad47a9d83a931cd7a6f5292a45bcc574b0630dab",class:"m-0 p-0"},!this.booking.is_direct&&e("span",{key:"4b1434e0868ba3e4b16d54f0aaafa55506d7efb8",class:"mr-1 m-0"},this.booking.channel_booking_nbr))),e("div",{key:"3863f68fed4c030bd117d1699601271672968951",class:"d-flex justify-content-end align-items-center",style:{gap:"1rem",flexWrap:"wrap"}},e("div",{key:"0fb536ba3fbc56d6edbe2c712df4ec1657471a29",class:"d-flex flex-column align-items-center"},i&&e("ir-popover",{key:"76e48cd8112a6fea981fa322339f32c233b5705d",trigger:"hover",renderContentAsHtml:true,content:`<div><p>Modified by ${i.user} at ${i.date} ${i.hour}:${i.minute}.</p>\n                <p>${this.alertMessage}</p></div>`},e("p",{key:"5fc1637c291b29f0742fa25bd1bd6a180e877ca9",class:"mx-0 p-0 small text-danger",style:{marginTop:"0.25rem",marginBottom:"0"}},e("b",{key:"5cff4becc75428a451277a557d51b01eaae120d5"},"Modified")))),this.booking.allowed_actions.length>0&&this.booking.is_editable&&e("div",{key:"f2f1140f0507728261222a068f741dc74fb60e8f",class:"m-0 p-0 d-flex align-items-center",style:{gap:"0.25rem"}}),e("ir-custom-button",{key:"7de96424e4ed2ab85b1ad2a4237fb875067054c7",onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.openDialog({type:"events-log"})},appearance:"outlined",size:"small",variant:"brand"},"Events log"),t&&e("ir-custom-button",{key:"0350e2908cc0f5e24b199d8e7a5be68b9eb2890d",onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.openDialog({type:"pms"})},appearance:"outlined",size:"small",variant:"brand"},"PMS"),this.hasReceipt&&e(o,{key:"dd87bea6413561af9c4ca24438c1655339945dc5"},e("ir-custom-button",{key:"026b3e036470861661ef1a0126ec76125c61f392",id:"invoice",variant:"brand",size:"small",appearance:"outlined"},"Billing")),this.hasPrint&&e(o,{key:"23bc1df75a9c8d3e3abdcd07a8568713a2c0025c"},e("wa-tooltip",{key:"eeb07db767ebcafb5358c9ad59e5795381cc9a8d",for:"print"},"Print booking"),e("ir-custom-button",{key:"3489bc8b85b6730f593eb9d549a9090e0e1f107b",id:"print",variant:"brand",size:"small",appearance:"outlined"},e("wa-icon",{key:"18ef2f7de1aa6cf94bd597c7b75a63345d8aee1a",label:"Print",name:"print",style:{fontSize:"1.2rem"}}))),this.hasEmail&&e(o,{key:"6c73b725a05f555061e9aa6cbc984e98d70a38d2"},e("wa-tooltip",{key:"e47551d369744cc2c91c278d385b6f6b325a7bef",for:"email"},"Email this booking to guest"),e("ir-custom-button",{key:"5cffbb84a050a6983625773d462c019a8a6ff427",id:"email",variant:"brand",size:"small",appearance:"outlined"},e("wa-icon",{key:"efa1201469370f7ad031e433f2b0182ae7687ded",name:"envelope",style:{fontSize:"1.2rem"},label:"Email this booking"}))),this.hasDelete&&e(o,{key:"17b05916076737e840722871173d306f782b3f5a"},e("wa-tooltip",{key:"c4941c25d0bbd7731eec3023e4623691feea3249",for:"book-delete"},"Delete this booking"),e("ir-custom-button",{key:"54eab8282bc6d7d80eee6725f18a22be84456b83",id:"book-delete",variant:"danger",size:"small",appearance:"plain"},e("wa-icon",{key:"add299a029d255837634b9069356f2e9a6b011f4",name:"envelope",style:{fontSize:"1.2rem"},label:"Delete this booking"}))),this.hasMenu&&e(o,{key:"f695afa3728900dfff8b8d67704c8d0e6ddebc60"},e("wa-tooltip",{key:"a8185626d9fef1c55a91735af9041223d6e0b517",for:"menu"},"Go back"),e("ir-custom-button",{key:"b43bcc5cec1712684150c0c69acb80f7cf08cc08",id:"menu",variant:"neutral",size:"small",appearance:"plain"},e("wa-icon",{key:"3f48410b178dc6c82f5101d654a95ccd2284ace0",name:"list",style:{fontSize:"1.2rem"},label:"Go back"}))),this.hasCloseButton&&e("ir-custom-button",{key:"a005844d26bd2995f80db68b4b3505b65fdb4d99",onClickHandler:e=>{e.stopPropagation();e.stopImmediatePropagation();this.closeSidebar.emit(null)},id:"close",variant:"neutral",size:"small",appearance:"plain"},e("wa-icon",{key:"db8a72f3d8a13ef2404b8891b18d1ad2f07e282e",name:"xmark",style:{fontSize:"1.2rem"},label:"Go back"})))),e("ir-dialog",{key:"a09a8d3bb5bea9b26b90e7356214cb61c991f8d6",onIrDialogHide:e=>{this.currentDialogStatus=null},label:this.currentDialogStatus==="pms"?b.entries.Lcz_PMS_Logs:b.entries.Lcz_EventsLog,style:this.currentDialogStatus==="events-log"&&{"--ir-dialog-max-width":"max-content"},ref:e=>this.dialogRef=e},this.renderDialogBody()),e("ir-dialog",{key:"0d0562bdd8ef3378e2723ff9d4b197e1d88fd434",ref:e=>this.modalEl=e,label:"Alert",lightDismiss:false,onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation()},onIrDialogAfterHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.bookingStatus=null}},e("p",{key:"0895400ffaba2190713f6a0f89eb8eecd037e18c"},this.booking.is_direct?"Are you sure you want to update this booking status?":b.entries.Lcz_OTA_Modification_Alter),e("div",{key:"a8157a3378f1ca74d7604ab77646c508d6655aa5",class:"ir-dialog__footer",slot:"footer"},e("ir-custom-button",{key:"21b218b1024773366aa59b737a49a6b78dbb5dfc","data-dialog":"close",size:"medium",appearance:"filled",variant:"neutral"},b?.entries?.Lcz_Cancel),e("ir-custom-button",{key:"928e49104eeb7bab656adee442c942b0e2ab3ca5",onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.updateStatus()},size:"medium",variant:"brand",loading:O("/Change_Exposed_Booking_Status")},b?.entries?.Lcz_Confirm))))}};Ue.style=je;const Ke=".sc-ir-booking-status-tag-h{display:block}";const Ve=Ke;const Fe=class{constructor(e){i(this,e)}status;isRequestToCancel;badgeVariant={"001":"warning","002":"success","003":"danger","004":"danger"};render(){return e("wa-badge",{key:"3c29a1622b9420bf6caa818fa145da24db739616",style:{padding:"0.375em 0.625em",letterSpacing:"0.03rem"},variant:this.badgeVariant[this.isRequestToCancel?"003":this.status.code]},this.status.description.toUpperCase())}};Fe.style=Ve;const qe=".ir-dialog__footer{display:flex;align-items:center;gap:0.5rem;justify-content:flex-end;width:100%}.dialog__loader-container{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;width:100%;min-height:50px;min-width:31rem}:host{display:block}";const We=qe;const Ze=class{constructor(e){i(this,e);this.checkoutDialogClosed=t(this,"checkoutDialogClosed",7)}open;booking;identifier;isLoading="page";buttons=new Set;invoiceInfo;room;checkoutDialogClosed;bookingService=new u;async checkoutRoom({e,source:i}){try{e.stopImmediatePropagation();e.stopPropagation();this.isLoading=i;await this.bookingService.handleExposedRoomInOut({booking_nbr:this.booking.booking_nbr,room_identifier:this.identifier,status:"002"});this.isLoading=null;this.checkoutDialogClosed.emit({reason:i==="checkout&invoice"?"openInvoice":"checkout"})}catch(e){console.error(e)}}handleOpenChange(e,i){if(e!==i){this.init()}}async init(){if(!this.open){return}try{this.isLoading="page";this.invoiceInfo=await this.bookingService.getBookingInvoiceInfo({booking_nbr:this.booking.booking_nbr});this.setupButtons();this.room=this.booking.rooms.find((e=>e.identifier===this.identifier))}catch(e){}finally{this.isLoading=null}}setupButtons(){const e=this.invoiceInfo.invoiceable_items.filter((e=>e.type==="BSA"&&e.reason?.code!=="001"));const i=e.length===0;if(i){this.buttons.add("checkout");return}this.buttons.add("invoice_checkout");if(e.length>1){this.buttons.add("checkout_without_invoice")}}render(){return e("ir-dialog",{key:"dc8cfc2ff6bfba37c05c726f5da8b35416441dd0",open:this.open,label:"Alert",style:{"--ir-dialog-width":"fit-content"},onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.buttons.clear();this.checkoutDialogClosed.emit({reason:"cancel"})}},this.isLoading==="page"?e("div",{class:"dialog__loader-container"},e("ir-spinner",null)):e("p",{style:{width:"calc(31rem - var(--spacing))"}},"Are you sure you want to check out unit ",this.room?.unit?.name,"?"),e("div",{key:"5f9162c2e29f0884848d91ed3ede41c1c33afd61",slot:"footer",class:"ir-dialog__footer"},e(o,{key:"160a7bf506e54f872e1a3f009c94a44fe91a837f"},e("ir-custom-button",{key:"96fdc91646451e411d03de719141188197291b83",size:"medium","data-dialog":"close",appearance:"filled",variant:"neutral"},b?.entries?.Lcz_Cancel??"Cancel"),this.buttons.has("checkout")&&e("ir-custom-button",{key:"810c03fdb56dfd3e6e7800b16b85fde8905b047a",size:"medium",onClickHandler:e=>this.checkoutRoom({e,source:"checkout"}),variant:"brand",loading:this.isLoading==="checkout"},"Checkout"),this.buttons.has("checkout_without_invoice")&&e("ir-custom-button",{key:"e68a3a3c0498b19e535e209c608db49ee73a53ab",loading:this.isLoading==="skipCheckout",size:"medium",onClickHandler:e=>this.checkoutRoom({e,source:"skipCheckout"}),variant:"brand",appearance:this.buttons.has("invoice_checkout")?"outlined":"accent"},"Checkout without invoice"),this.buttons.has("invoice_checkout")&&e("ir-custom-button",{key:"25959e041399e0fed9d661595729206ff121179a",size:"medium",loading:this.isLoading==="checkout&invoice",onClickHandler:e=>{this.checkoutRoom({e,source:"checkout&invoice"})},variant:"brand",appearance:"accent"},"Checkout & invoice"))))}static get watchers(){return{open:["handleOpenChange"]}}};Ze.style=We;const Je=".sc-ir-events-log-h{display:block}.beta.sc-ir-events-log{background:var(--red);color:white;padding:0.2rem 0.3rem;font-size:12px;border-radius:4px;margin:0}.event-row.sc-ir-events-log{padding-bottom:0.5rem}.list-title.sc-ir-events-log{margin:0;padding:0;font-size:14px;font-weight:bold;width:fit-content}.list-item.sc-ir-events-log{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-events-log{color:#629a4c;font-weight:600}.list-item.red.sc-ir-events-log{color:#ff4961;font-weight:600}.dates-row.sc-ir-events-log{display:flex;align-items:center;gap:0.875rem}";const Qe=Je;const Xe=class{constructor(e){i(this,e)}bookingNumber;booking;bookingEvents;componentWillLoad(){this.init()}async init(){try{this.bookingEvents=this.booking.events}catch(e){console.error(e)}}render(){return e("div",{key:"ac1c15f7f52fde7f5fc7d9cef2ceddc105e86111",class:""},O("/Get_Exposed_Booking_Events")?e("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},e("ir-spinner",null)):e(o,null,e("table",{class:" dialog-container-height"},e("thead",{class:"sr-only"},e("tr",null,e("th",null,"date"),e("th",null,"user"),e("th",null,"status"))),e("tbody",null,this.bookingEvents?.map((i=>e("tr",{key:i.id,class:"pb-1"},e("td",{class:"event-row dates-row"},e("span",null,i.date),e("span",null,String(i.hour).padStart(2,"0"),":",String(i.minute).padStart(2,"0"),":",String(i.second).padStart(2,"0"))),e("td",{class:"pl-3 event-row "},i.type),e("td",{class:"pl-1 event-row "},i.user))))))))}};Xe.style=Qe;const ei=".sc-ir-extra-service-h{display:block}.extra-service-container.sc-ir-extra-service{display:flex;align-items:start;justify-content:space-between;gap:0.5rem}.extra-service-container.sc-ir-extra-service *.sc-ir-extra-service{padding:0;margin:0;box-sizing:border-box}.extra-service-actions.sc-ir-extra-service{display:flex;align-items:center;gap:0.5rem}.extra-service-conditional-date.sc-ir-extra-service{margin-top:0.5rem}.extra-service-price.sc-ir-extra-service{white-space:nowrap}.extra-service-description.sc-ir-extra-service{word-break:break-all}";const ii=ei;const ti=class{constructor(e){i(this,e);this.editExtraService=t(this,"editExtraService",7);this.resetBookingEvt=t(this,"resetBookingEvt",7)}service;bookingNumber;currencySymbol;editExtraService;resetBookingEvt;irModalRef;bookingService=new u;async deleteService(){try{await this.bookingService.doBookingExtraService({service:this.service,is_remove:true,booking_nbr:this.bookingNumber});this.irModalRef.closeModal();this.resetBookingEvt.emit(null)}catch(e){console.log(e)}}render(){return e(a,{key:"92d590666145f35d8c0223853432fd81ed184786"},e("div",{key:"7470d50398a8d4e65fe4f76cbe2cf968488b6670"},e("div",{key:"e835425580236b69718bd029bbd54e74eb0e60a4",class:"extra-service-container"},e("p",{key:"250a89da11a4bb58c6f132afe599769ee8c80f4c",class:"extra-service-description"},this.service.description),e("div",{key:"9a4fc610c96c117cb5812c32f6424102eee87f87",class:"extra-service-actions"},!!this.service.price&&this.service.price>0&&e("p",{key:"a4683f903e54f8eb72060067438bd124f389e697",class:"extra-service-price p-0 m-0 font-weight-bold"},s(this.currencySymbol,this.service.price)),e("div",{key:"a5b221083941d524bbcf164f9adeb91683aea53f",class:"d-flex align-items-center"},e("wa-tooltip",{key:"3eadbfa9f6575750599db6046f1ce0635aa71f3c",for:`edit-extra-service-${this.service.booking_system_id}`},"Edit service"),e("ir-custom-button",{key:"7fe9f3bc0a008e41887777ddbbe89c48b9f3ce9c",id:`edit-extra-service-${this.service.booking_system_id}`,onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.editExtraService.emit(this.service)},iconBtn:true,appearance:"plain",variant:"neutral"},e("wa-icon",{key:"e2dd9be81eaab9e497a6d419a67557ee08e771c8",name:"edit",label:"Edit",style:{fontSize:"1rem"}})),e("wa-tooltip",{key:"155bbc8d9a735ecd45d6bcb0fed913c51ec79999",for:`delete-extra-service-${this.service.booking_system_id}`},"Delete service"),e("ir-custom-button",{key:"ee3b46c21d26188dcf29fc044b4c10bc8774f58d",iconBtn:true,id:`delete-extra-service-${this.service.booking_system_id}`,onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.irModalRef.openModal()},appearance:"plain",variant:"danger"},e("wa-icon",{key:"f04a7ef035852b9fa4ff0aa436af86763ed0a8cb",name:"trash-can",label:"Edit",style:{fontSize:"1rem"}}))))),e("div",{key:"77936d1302eeb04e6a8f425b0fd9d1080ff9bb7f",class:"extra-service-conditional-date"},this.service.start_date&&this.service.end_date?e("ir-date-view",{class:"extra-service-date-view mr-1",from_date:this.service.start_date,to_date:this.service.end_date,showDateDifference:false}):this.service.start_date&&e("p",{class:"extra-service-date-view"},r(new Date(this.service.start_date)).format("MMM DD, YYYY")))),e("ir-dialog",{key:"38809e15c4c56734572c90eaad31a5742df2befd",onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation()},label:"Alert",ref:e=>this.irModalRef=e,lightDismiss:false},`${b.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${b.entries.Lcz_ThisService} ${b.entries.Lcz_FromThisBooking}`,e("div",{key:"36c6f5298a51d519ba5eb074c10c1cafe756c278",slot:"footer",class:"ir-dialog__footer"},e("ir-custom-button",{key:"0a30d71c01b93baa14189cdc28f3505d617cd340",appearance:"filled",variant:"neutral",size:"medium","data-dialog":"close"},b.entries.Lcz_Cancel),e("ir-custom-button",{key:"5a25d825977ec1fc70f6a5267b628e0c58faf41e",onClickHandler:()=>this.deleteService(),loading:O("/Do_Booking_Extra_Service"),variant:"danger",size:"medium"},b.entries.Lcz_Delete))))}};ti.style=ii;const ai=".sc-ir-extra-service-config-h{display:block;--ir-input-border-color:#cacfe7}.sc-ir-extra-service-config-h .input-group-text.sc-ir-extra-service-config{border-color:var(--ir-input-border-color)}.currency-ph.sc-ir-extra-service-config{padding:0;margin:0;color:#3b4781;display:flex;align-items:center;justify-content:center;padding:0 0 0 0.25rem;border-top:1px solid var(--ir-input-border-color);border-bottom:1px solid var(--ir-input-border-color);border-left:1px solid transparent;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.service-description-input.sc-ir-extra-service-config{height:70px !important}.service-description.sc-ir-extra-service-config .input-group-prepend.sc-ir-extra-service-config{background-color:#f4f5fa;border:1px solid var(--ir-input-border-color);border-top-left-radius:0.25rem;border-bottom-left-radius:0.25rem}.service-date-container.sc-ir-extra-service-config{padding:0;margin:0;display:flex;align-items:center;position:relative;width:100%;justify-content:center}.service-date-container.sc-ir-extra-service-config .btn-container.sc-ir-extra-service-config{position:absolute;right:5px;margin:0;display:flex;align-items:center;justify-content:center;padding:0}.service-description.sc-ir-extra-service-config .input-group-text.sc-ir-extra-service-config{height:fit-content;border:0;padding-top:0.75rem !important}.price-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config,.cost-input-group.sc-ir-extra-service-config:focus-within .currency-ph.sc-ir-extra-service-config{border-top:1px solid #1e9ff2;border-bottom:1px solid #1e9ff2;border-left:1px solid #1e9ff2}.currency-ph[data-state='error'].sc-ir-extra-service-config{border-color:var(--red, #ff4961)}.price-input.sc-ir-extra-service-config:focus{border-right-width:1px !important}.is-invalid.sc-ir-extra-service-config{background-image:none !important}.price-input.sc-ir-extra-service-config,.cost-input.sc-ir-extra-service-config{border-left:0}.row-group.sc-ir-extra-service-config{display:flex;flex-direction:column;gap:0.5rem}.extra-service-config__container.sc-ir-extra-service-config{display:flex;flex-direction:column;gap:1rem}@media (min-width: 640px){.row-group.sc-ir-extra-service-config{flex-direction:row;align-items:center;gap:0}.cost-label.sc-ir-extra-service-config{border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.until-prepend.sc-ir-extra-service-config,.cost-input-placeholder.sc-ir-extra-service-config{border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}.date-from.sc-ir-extra-service-config,.price-input.sc-ir-extra-service-config{border-right-width:0 !important;border-top-right-radius:0 !important;border-bottom-right-radius:0 !important}}.date-focused.sc-ir-extra-service-config{border-color:#1e9ff2}";const oi=ai;const ni=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7)}booking;service;open;closeModal;closeDialog(){this.closeModal.emit()}render(){return e("ir-drawer",{key:"aa3f623426bd01f7a4c40184eaa951f1a1e56f58",style:{"--ir-drawer-width":"40rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"},open:this.open,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeDialog()},label:b.entries.Lcz_ExtraServices},this.open&&e("ir-extra-service-config-form",{key:"da3cdc9cd0cdb2c95ee56041818f857fa57fc1a9",onCloseModal:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeDialog()},booking:this.booking,service:this.service}),e("div",{key:"79e2b742bfa87f17921a81e29bf036f77e6c0e4e",slot:"footer",class:"ir__drawer-footer"},e("ir-custom-button",{key:"042448a82a256a38f20da02c7cf789ad4b5e5437",class:`flex-fill`,size:"medium",appearance:"filled",variant:"neutral","data-drawer":"close"},b.entries.Lcz_Cancel),e("ir-custom-button",{key:"7bb452d00dd1b0fb610614110118204c341fd8ba",type:"submit",loading:O("/Do_Booking_Extra_Service"),form:"extra-service-config-form",size:"medium",class:`flex-fill`,variant:"brand"},b.entries.Lcz_Save)))}};ni.style=oi;const ri=U.object({type:U.object({code:U.union([U.string().min(3),U.literal("")]).optional(),description:U.union([U.string(),U.literal("")]).optional()}),number:U.union([U.string().min(2),U.literal("")]).optional().nullable()});const si=U.object({id:U.number().optional(),first_name:U.union([U.string().min(2),U.literal("")]).optional(),last_name:U.string().optional(),country_id:U.coerce.number().min(0).optional(),dob:U.string().nullable().optional().refine((e=>e===undefined||r(e,"DD/MM/YYYY",true).isValid()||e===""||e===null),"Invalid date format").transform((e=>{if(e===undefined||e===""||e===null)return null;const i=r(e,"DD/MM/YYYY",true).isValid();return i?null:r(e,"DD/MM/YYYY").format("YYYY-MM-DD")})),id_info:ri.optional(),is_main:U.boolean().default(false)});function ci(e){si.parse(e);const i=e=>e!==null&&e!==undefined&&e.trim()!=="";const t=[];if(e.is_main){if(!i(e.first_name)){t.push({path:["first_name"],code:V.custom,message:"First name is required for main guest"})}}const a=i(e.first_name)||i(e.dob)||e.country_id!==null&&e.country_id!==undefined&&e.country_id>0||i(e.id_info?.number);if(a){if(!i(e.first_name)){t.push({path:["first_name"],code:V.custom,message:"First name is required when other guest information is provided"})}}if(t.length>=1){throw new K(t)}}const li=U.object({booking_system_id:U.number().optional(),cost:U.coerce.number().nullable(),currency_id:U.number().min(1),description:U.string().min(1),end_date:U.string().nullable().optional().default(null),start_date:U.string().nonempty(),price:U.coerce.number().min(.01),system_id:U.number().optional()});const di=".sc-ir-extra-service-config-form-h{display:block;--ir-input-border-color:#cacfe7}.sc-ir-extra-service-config-form-h .input-group-text.sc-ir-extra-service-config-form{border-color:var(--ir-input-border-color)}.currency-ph.sc-ir-extra-service-config-form{padding:0;margin:0;color:#3b4781;display:flex;align-items:center;justify-content:center;padding:0 0 0 0.25rem;border-top:1px solid var(--ir-input-border-color);border-bottom:1px solid var(--ir-input-border-color);border-left:1px solid transparent;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;transition:border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out}.service-description-input.sc-ir-extra-service-config-form{height:70px !important}.service-description.sc-ir-extra-service-config-form .input-group-prepend.sc-ir-extra-service-config-form{background-color:#f4f5fa;border:1px solid var(--ir-input-border-color);border-top-left-radius:0.25rem;border-bottom-left-radius:0.25rem}.service-date-container.sc-ir-extra-service-config-form{padding:0;margin:0;display:flex;align-items:center;position:relative;width:100%;justify-content:center}.service-date-container.sc-ir-extra-service-config-form .btn-container.sc-ir-extra-service-config-form{position:absolute;right:5px;margin:0;display:flex;align-items:center;justify-content:center;padding:0}.service-description.sc-ir-extra-service-config-form .input-group-text.sc-ir-extra-service-config-form{height:fit-content;border:0;padding-top:0.75rem !important}.price-input-group.sc-ir-extra-service-config-form:focus-within .currency-ph.sc-ir-extra-service-config-form,.cost-input-group.sc-ir-extra-service-config-form:focus-within .currency-ph.sc-ir-extra-service-config-form{border-top:1px solid #1e9ff2;border-bottom:1px solid #1e9ff2;border-left:1px solid #1e9ff2}.currency-ph[data-state='error'].sc-ir-extra-service-config-form{border-color:var(--red, #ff4961)}.price-input.sc-ir-extra-service-config-form:focus{border-right-width:1px !important}.is-invalid.sc-ir-extra-service-config-form{background-image:none !important}.price-input.sc-ir-extra-service-config-form,.cost-input.sc-ir-extra-service-config-form{border-left:0}.row-group.sc-ir-extra-service-config-form{display:flex;flex-direction:column;gap:0.5rem}.extra-service-config__container.sc-ir-extra-service-config-form{display:flex;flex-direction:column;gap:1rem}@media (min-width: 640px){.row-group.sc-ir-extra-service-config-form{flex-direction:row;align-items:center;gap:0}.cost-label.sc-ir-extra-service-config-form{border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.until-prepend.sc-ir-extra-service-config-form,.cost-input-placeholder.sc-ir-extra-service-config-form{border-top-left-radius:0 !important;border-bottom-left-radius:0 !important}.date-from.sc-ir-extra-service-config-form,.price-input.sc-ir-extra-service-config-form{border-right-width:0 !important;border-top-right-radius:0 !important;border-bottom-right-radius:0 !important}}.date-focused.sc-ir-extra-service-config-form{border-color:#1e9ff2}";const hi=di;const pi=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7);this.resetBookingEvt=t(this,"resetBookingEvt",7)}booking;service;s_service;error;fromDateClicked;toDateClicked;autoValidate;closeModal;resetBookingEvt;bookingService=new u;componentWillLoad(){if(this.service){this.s_service={...this.service}}}handleServiceChange(){if(this.service){this.s_service={...this.service}}}async saveAmenity(){try{this.autoValidate=true;li.parse(this.s_service??{});await this.bookingService.doBookingExtraService({service:this.s_service,booking_nbr:this.booking.booking_nbr,is_remove:false});this.resetBookingEvt.emit(null);this.closeDialog()}catch(e){if(e instanceof K){this.error=true}console.error(e)}}closeDialog(){this.closeModal.emit()}updateService(e){let i=this.s_service;if(!i){i={cost:null,description:null,end_date:null,start_date:null,price:null,currency_id:this.booking.currency.id}}this.s_service={...i,...e}}render(){return e("form",{key:"08684efc223bc9a16136f493cea56014f0234a14",id:"extra-service-config-form",onSubmit:async e=>{e.preventDefault();this.saveAmenity()},class:"extra-service-config__container"},e("ir-validator",{key:"caff92b60c6d98a8d163de2a8339b6b7250769ae",id:"amenity description-validator",schema:li.shape.description},e("wa-textarea",{key:"2cb676df436883bea957a4c64584719179cb8892",size:"small",defaultValue:this.s_service?.description,value:this.s_service?.description,onchange:e=>this.updateService({description:e.target.value}),id:"amenity-description","aria-label":"Amenity description",maxlength:250,label:b.entries.Lcz_Description})),e("ir-validator",{key:"a9cec05ba51ffbc2cde04fcf99887e8b98f0ec0b",value:this.s_service?.start_date??null,schema:li.shape.start_date},e("ir-custom-date-picker",{key:"36270541cc173bb17e08a1683d474b58accb1f32",placeholder:"Select date",withClear:true,label:"Dates on",emitEmptyDate:true,date:this.s_service?.start_date,minDate:this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:e=>this.updateService({start_date:e.detail.start?.format("YYYY-MM-DD")})})),e("ir-custom-date-picker",{key:"d89d950fe415a09aed6da9104f60af4df68c8db2",withClear:true,emitEmptyDate:true,placeholder:"Select date",date:this.s_service?.end_date,minDate:this.s_service?.start_date??this.booking.from_date,maxDate:this.booking.to_date,onDateChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();this.updateService({end_date:e.detail.start?.format("YYYY-MM-DD")})},label:"Till and including"}),e("ir-validator",{key:"3f17908b2f4405ae8b90f9d1870c02e0313886f1",value:this.s_service?.price??null,schema:li.shape.price},e("ir-input",{key:"2d493d22de290bcf6775343c363ed9dffa46347f","onText-change":e=>{this.updateService({price:Number(e.detail)})},defaultValue:this.s_service?.price?.toString(),value:this.s_service?.price?.toString(),mask:"price",type:"text",label:b.entries.Lcz_Price},e("span",{key:"e720723b6fec6db4d0b90da3be9bd7ad4240308d",slot:"start"},this.booking.currency.symbol))),e("ir-validator",{key:"d750623d1133f0285d60159d2c7a0df919747a18",value:this.s_service?.cost??null,schema:li.shape.cost},e("ir-input",{key:"51d3be6f68bf2cb82e716168f2a1be9094cea27a",defaultValue:this.s_service?.cost?.toString(),"onText-change":e=>this.updateService({cost:Number(e.detail)}),value:this.s_service?.cost?.toString(),mask:"price",label:b.entries.Lcz_Cost},e("span",{key:"74c168abffdd6b3bfe1adb20c1e7a9c842027f83",slot:"start"},this.booking.currency.symbol))))}static get watchers(){return{service:["handleServiceChange"]}}};pi.style=hi;const mi=".sc-ir-extra-services-h{display:block}";const fi=mi;const bi=class{constructor(e){i(this,e)}booking;render(){return e(a,{key:"cbee6e236e0d62e7cbfcc7b69f555897439c0dcd"},e("wa-card",{key:"4c495fc4a6fe1321d48e32f91fc1ff8f8d34a0e4"},e("p",{key:"0648c8f007201aaac6caf6e1bf1cbfffe09c0f12",slot:"header",class:"font-size-large p-0 m-0 "},b.entries.Lcz_ExtraServices),e("wa-tooltip",{key:"d42bb71a45a5e564b93a2e8cd644a2d3c533da02",for:"extra_service_btn"},"Add extra service"),e("ir-custom-button",{key:"5caf5b4f72b6ef7ff73d049dd2cf5a504c249776",slot:"header-actions",id:"extra_service_btn",size:"small",appearance:"plain",variant:"neutral"},e("wa-icon",{key:"bccedb4aa55607bd4b01191542b1d83e0d0cbf74",name:"plus",style:{fontSize:"1rem"}})),(this.booking.extra_services??[])?.length===0&&e("ir-empty-state",{key:"4c23afff3bd497d1b975de45642aae2d718511bd"}),this.booking.extra_services?.map(((i,t)=>e(o,null,e("ir-extra-service",{bookingNumber:this.booking.booking_nbr,currencySymbol:this.booking.currency.symbol,key:i.booking_system_id,service:i}),t!==this.booking.extra_services.length-1&&e("wa-divider",null))))))}};bi.style=fi;const ui=".sc-ir-guest-info-drawer-h{display:block}";const gi=ui;const _i=class{constructor(e){i(this,e);this.guestInfoDrawerClosed=t(this,"guestInfoDrawerClosed",7);this.guestChanged=t(this,"guestChanged",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.toast=t(this,"toast",7)}open;language="en";email;booking_nbr;ticket;guestInfoDrawerClosed;guestChanged;resetBookingEvt;toast;get hostElement(){return n(this)}handleDrawerHide=e=>{e.stopImmediatePropagation();e.stopPropagation();this.guestInfoDrawerClosed.emit({source:e.detail?.source??this.hostElement})};handleCancel=()=>{this.guestInfoDrawerClosed.emit({source:this.hostElement})};_formId=`guest-details-form_${A()}`;render(){const i=b?.entries?.Lcz_GuestDetails||"Guest info";return e("ir-drawer",{key:"bbe5144fda1f36cdf64e7c790b1ac0a9911b26f3",open:this.open,label:i,onDrawerHide:this.handleDrawerHide,style:{"--ir-drawer-width":"40rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"}},this.open&&e("ir-guest-info-form",{key:"695073942b8bcd0b1037fdd2e61b58ecfec56938",ticket:this.ticket,language:this.language,email:this.email,booking_nbr:this.booking_nbr,fromId:this._formId}),e("div",{key:"46a0c6b410e7bfa3507bd037b54e828773e8e930",slot:"footer",class:"ir__drawer-footer"},e("ir-custom-button",{key:"fdb1522835c414c7147996a843709980330b04c1",size:"medium",appearance:"filled",variant:"neutral",type:"button",onClickHandler:this.handleCancel},b.entries?.Lcz_Cancel||"Cancel"),e("ir-custom-button",{key:"089e8a0becfbc6e24513ac87869d500126c9750e",type:"submit",form:this._formId,size:"medium",variant:"brand",loading:O("/Edit_Exposed_Guest")},b.entries?.Lcz_Save||"Save")))}};_i.style=gi;const yi=e=>U.string().trim().min(1,e);const ki=U.string().trim().email("Enter a valid email address").or(U.literal("")).optional().nullable();const vi=U.object({first_name:yi("First name is required"),last_name:yi("Last name is required"),email:yi("Email is required").email("Enter a valid email address"),alternative_email:ki,country_id:U.number({required_error:"Country is required"}).int("Country is required").positive("Country is required"),mobile:yi("Mobile number is required").min(5,"Mobile number is too short"),country_phone_prefix:yi("Country code is required"),notes:U.string().max(2e3,"Private note cannot exceed 2000 characters").optional()});const wi=".sc-ir-guest-info-form-h{height:100%;display:flex;flex-direction:column}.guest-form__container.sc-ir-guest-info-form{display:flex;flex-direction:column;gap:var(--wa-space-m, 1rem)}";const xi=wi;const Di=class{constructor(e){i(this,e);this.guestInfoDrawerClosed=t(this,"guestInfoDrawerClosed",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.toast=t(this,"toast",7);this.guestChanged=t(this,"guestChanged",7)}fromId;language;email;booking_nbr;ticket;guest=null;countries=[];isLoading=true;autoValidate=false;guestInfoDrawerClosed;resetBookingEvt;toast;guestChanged;bookingService=new u;roomService=new P;token=new R;componentWillLoad(){if(this.ticket){this.token.setToken(this.ticket)}if(!!this.token.getToken()){this.init()}}ticketChanged(e,i){if(e===i){return}this.token.setToken(this.ticket)}handleInputChange(e){this.guest={...this.guest,...e}}async init(){try{this.isLoading=true;const[e,i,t]=await Promise.all([this.bookingService.fetchGuest(this.email),this.bookingService.getCountries(this.language),!b||!b.entries||Object.keys(b.entries).length===0?this.roomService.fetchLanguage(this.language):Promise.resolve(null)]);if(t){b.entries=t.entries;b.direction=t.direction}this.countries=i;let a={...e,email:e.email.replace(/\s+(?=@)/g,"").trim()};if(a&&!a.country_phone_prefix){const e=this.countries.find((e=>e.id===a.country_id));console.log({country:e});if(e){a={...a,country_phone_prefix:e?.phone_prefix}}}this.guest=e?{...a,mobile:e.mobile_without_prefix}:null}catch(e){console.error(e)}finally{this.isLoading=false}}async editGuest(){try{this.autoValidate=true;vi.parse(this.guest);await this.bookingService.editExposedGuest(this.guest,this.booking_nbr??null);this.toast.emit({type:"success",description:"",title:"Saved Successfully",position:"top-right"});this.resetBookingEvt.emit(null);this.guestChanged.emit(this.guest);this.guestInfoDrawerClosed.emit({source:null})}catch(e){console.error(e)}}render(){if(this.isLoading){return e("div",{class:"drawer__loader-container"},e("ir-spinner",null))}return e("form",{id:this.fromId,onSubmit:e=>{e.preventDefault();this.editGuest()},class:"guest-form__container"},e("ir-validator",{schema:vi.shape.first_name,value:this.guest?.first_name??"",autovalidate:this.autoValidate,valueEvent:"text-change input input-change",blurEvent:"input-blur blur"},e("ir-input",{id:"firstName",value:this.guest?.first_name,defaultValue:this.guest?.first_name,required:true,"onText-change":e=>this.handleInputChange({first_name:e.detail.trim()}),label:b.entries?.Lcz_FirstName})),e("ir-validator",{schema:vi.shape.last_name,value:this.guest?.last_name??"",autovalidate:this.autoValidate,valueEvent:"text-change input input-change",blurEvent:"input-blur blur"},e("ir-input",{value:this.guest?.last_name,required:true,defaultValue:this.guest?.last_name,id:"lastName","onText-change":e=>this.handleInputChange({last_name:e.detail.trim()}),label:b.entries?.Lcz_LastName})),e("ir-validator",{schema:vi.shape.email,value:this.guest?.email??"",autovalidate:this.autoValidate,valueEvent:"text-change input input-change",blurEvent:"input-blur blur"},e("ir-input",{label:b.entries?.Lcz_Email,id:"email",defaultValue:this.guest?.email,value:this.guest?.email,required:true,"onText-change":e=>{const i=e.detail.replace(/(?<=^[^@]*)\s+(?=[^@]*@noemail\.com$)/g,"").trim();this.handleInputChange({email:i})}})),e("ir-validator",{schema:vi.shape.alternative_email,value:this.guest?.alternative_email??"",autovalidate:this.autoValidate,valueEvent:"text-change input input-change",blurEvent:"input-blur blur"},e("ir-input",{label:b.entries?.Lcz_AlternativeEmail,id:"altEmail",value:this.guest?.alternative_email,"onText-change":e=>{const i=e.detail.replace(/(?<=^[^@]*)\s+(?=[^@]*@noemail\.com$)/g,"").trim();this.handleInputChange({alternative_email:i})}})),e("ir-validator",{schema:vi.shape.country_id,value:this.guest?.country_id??undefined,autovalidate:this.autoValidate,valueEvent:"countryChange"},e("ir-country-picker",{size:"small",variant:"modern",country:this.countries.find((e=>e.id===this.guest?.country_id)),label:b.entries?.Lcz_Country,onCountryChange:e=>{const i=e.detail;let t={country_id:i.id};if(!this.guest?.mobile){t={...t,country_phone_prefix:i.phone_prefix}}this.handleInputChange(t)},countries:this.countries})),e("ir-validator",{schema:U.object({mobile:vi.shape.mobile,phone_prefix:vi.shape.country_phone_prefix}),value:{mobile:this.guest?.mobile??"",phone_prefix:this.guest?.country_phone_prefix},autovalidate:this.autoValidate,valueEvent:"mobile-input-change"},e("ir-mobile-input",{size:"small","onMobile-input-change":e=>{this.handleInputChange({mobile:e.detail.formattedValue.trim()})},"aria-invalid":"true","onMobile-input-country-change":e=>this.handleInputChange({country_phone_prefix:e.detail.phone_prefix}),value:this.guest?.mobile??"",required:true,countryCode:this.countries.find((e=>e.phone_prefix?.toString()===this.guest?.country_phone_prefix?.toString()))?.code,countries:this.countries})),e("ir-validator",{schema:vi.shape.notes,value:this.guest?.notes??"",autovalidate:this.autoValidate,valueEvent:"wa-change change input",blurEvent:"wa-blur blur"},e("wa-textarea",{size:"small",onchange:e=>this.handleInputChange({notes:e.target.value}),value:this.guest?.notes??"",label:b.entries?.Lcz_PrivateNote})))}static get watchers(){return{ticket:["ticketChanged"]}}};Di.style=xi;const Yi="";const Mi=Yi;const Ci=class{constructor(e){i(this,e);this.invoiceOpen=t(this,"invoiceOpen",7);this.invoiceClose=t(this,"invoiceClose",7)}open;booking;for="booking";roomIdentifier;autoPrint=false;invoiceInfo;invoiceOpen;invoiceClose;invoice=null;async openDrawer(){this.open=true;this.invoiceOpen.emit()}async closeDrawer(){this.open=false;this.invoiceClose.emit()}viewMode="invoice";isLoading;_id=`invoice-form__${A()}`;componentWillLoad(){if(this.booking){if(r().isBefore(r(this.booking.from_date,"YYYY-MM-DD"),"dates")&&this.viewMode==="invoice"){this.viewMode="proforma"}}}handleBookingChange(){if(!this.booking){return}if(r().isBefore(r(this.booking.from_date,"YYYY-MM-DD"),"dates")&&this.viewMode==="invoice"){this.viewMode="proforma"}}render(){return e(a,{key:"ab7905335a7c42f22e2ebc44d1c59d6a9220aed6"},e("ir-drawer",{key:"e41c57b77216e13dc541affed23711582b932d9b",style:{"--ir-drawer-width":"40rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"},label:"Issue Invoice",open:this.open,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeDrawer()}},e("div",{key:"c520fe37d5e2b388ff50eb6a4eca5a2b05c51971",class:"d-flex align-items-center",slot:"header-actions"},e("wa-switch",{key:"8837ebbe25aadb438532210b48b17ee2ae7f46c4",defaultChecked:this.viewMode==="proforma",checked:this.viewMode==="proforma",onchange:e=>{if(e.target.checked){this.viewMode="proforma"}else{this.viewMode="invoice"}}},"Pro-forma")),this.open&&e("ir-invoice-form",{key:"c2144e1470bff91c61fd1cb6ed9f915b4dc1fcb0",viewMode:this.viewMode,for:this.for,roomIdentifier:this.roomIdentifier,booking:this.booking,autoPrint:this.autoPrint,formId:this._id,onPreviewProformaInvoice:e=>this.invoice=e.detail.invoice,invoiceInfo:this.invoiceInfo,onLoadingChange:e=>this.isLoading=e.detail}),e("div",{key:"f72133930f9022cbf941e9429580dc065eb0a3a3",slot:"footer",class:"ir__drawer-footer"},e("ir-custom-button",{key:"3f020f8200ca88b71815542535b1e008ff357f3e",size:"medium",appearance:"filled",class:"w-100 flex-fill",variant:"neutral",onClickHandler:()=>{this.closeDrawer()}},"Cancel"),e("ir-custom-button",{key:"57befdeb1d5dfb5783c932f0e522c6367bf31d33",disabled:this.invoiceInfo?.invoiceable_items?.filter((e=>e.is_invoiceable))?.length===0,loading:this.isLoading,value:"invoice",type:"submit",form:this._id,class:"w-100 flex-fill",size:"medium",variant:"brand",id:`confirm-btn_${this._id}`},"Confirm")),e("ir-preview-screen-dialog",{key:"c467be107589b5c159c235520639535d4eda40d7",onOpenChanged:e=>{e.stopImmediatePropagation();e.stopPropagation();if(!e.detail){this.invoice=null}},open:this.invoice!==null},e("ir-proforma-invoice-preview",{key:"60514044be7c10fafe198217c03d1ae0f67ca348",invoice:this.invoice,property:m.property,booking:this.booking}))))}static get watchers(){return{booking:["handleBookingChange"]}}};Ci.style=Mi;const Ii="@layer wa-utilities {\n  .sc-ir-invoice-form-h[size='small'],\n  .wa-size-s {\n    font-size: var(--wa-font-size-s);\n  }\n\n  .sc-ir-invoice-form-h[size='medium'],\n  .wa-size-m {\n    font-size: var(--wa-font-size-m);\n  }\n\n  .sc-ir-invoice-form-h[size='large'],\n  .wa-size-l {\n    font-size: var(--wa-font-size-l);\n  }\n}\n\n.sc-ir-invoice-form-h {\n  display: block;\n  height: 100%;\n}\n.ir-invoice__container.sc-ir-invoice-form {\n  display: grid;\n  gap: var(--wa-space-l);\n  box-sizing: border-box;\n}\n.ir-invoice__service.sc-ir-invoice-form:last-child {\n  border-bottom-left-radius: var(--wa-border-radius-m);\n  border-bottom-right-radius: var(--wa-border-radius-m);\n}\n.ir-invoice__service.sc-ir-invoice-form:first-child {\n  border-top-left-radius: var(--wa-border-radius-m);\n  border-top-right-radius: var(--wa-border-radius-m);\n  border-top: var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);\n}\n.ir-invoice__service.sc-ir-invoice-form {\n  border-bottom: var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);\n  border-left: var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);\n  border-right: var(--wa-form-control-border-width) var(--wa-form-control-border-style) var(--wa-form-control-border-color);\n  background-color: var(--wa-color-surface-default);\n  \n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  width: 100%;\n}\n.ir-invoice__service.sc-ir-invoice-form:not(:disabled):hover {\n  background-color: color-mix(in srgb, var(--wa-color-surface-default) 95%, var(--wa-color-mix-hover));\n}\n.ir-invoice__checkbox.sc-ir-invoice-form, .ir-invoice__checkbox.sc-ir-invoice-form::part(base) {\n  height: 100%;\n  width: 100%;\n  display: flex;\n  box-sizing: border-box;\n}\n.ir-invoice__room-info.sc-ir-invoice-form {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  padding: 0.5rem;\n}\n.ir-invoice__checkbox.sc-ir-invoice-form::part(base) {\n  min-height: var(--wa-form-control-height);\n  padding: 0 var(--wa-form-control-padding-inline);\n  display: flex;\n  align-items: center;\n  box-sizing: border-box;\n  width: 100%;\n}\n.ir-invoice__checkbox.group.sc-ir-invoice-form::part(base) {\n  padding-block: var(--wa-form-control-padding-inline);\n  align-items: flex-start;\n}\n.ir-invoice__checkbox.sc-ir-invoice-form::part(label) {\n  display: flex;\n  width: 100%;\n}\n.ir-invoice__room-checkbox-container.sc-ir-invoice-form {\n  display: flex;\n  gap: 0.5rem;\n  width: 100%;\n  justify-content: space-between;\n  text-align: start;\n  align-items: center;\n}\n.ir-invoice__room-checkbox-container.group.sc-ir-invoice-form {\n  flex-direction: column;\n}\n.ir-invoice__checkbox-price.sc-ir-invoice-form {\n  font-weight: 700;\n  color: var(--wa-color-neutral-900);\n  white-space: nowrap;\n  text-align: right;\n  flex: 1 1 0%;\n}\n.ir-invoice__price-column.sc-ir-invoice-form {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  gap: 0.25rem;\n  min-width: fit-content;\n}\n.ir-invoice__reason.sc-ir-invoice-form {\n  color: var(--wa-color-gray-60);\n  font-size: 0.75rem;\n  line-height: 1.2;\n  text-align: right;\n}\n.ir-invoice__form-control-label.sc-ir-invoice-form {\n  display: inline-flex;\n  color: var(--wa-form-control-label-color);\n  font-weight: var(--wa-form-control-label-font-weight);\n  line-height: var(--wa-form-control-label-line-height);\n  margin-block-end: 0.5em;\n}\n.ir-invoice__reason.sc-ir-invoice-form {\n  color: var(--wa-color-danger-fill-loud);\n}";const Si=Ii;const Ei=class{constructor(e){i(this,e);this.invoiceOpen=t(this,"invoiceOpen",7);this.invoiceClose=t(this,"invoiceClose",7);this.invoiceCreated=t(this,"invoiceCreated",7);this.previewProformaInvoice=t(this,"previewProformaInvoice",7);this.loadingChange=t(this,"loadingChange",7)}viewMode="invoice";formId;open;booking;for="booking";roomIdentifier;autoPrint=false;invoiceInfo;selectedRecipient;isLoading;selectedItemKeys=new Set;invoicableKey;toBeInvoicedItems;invoiceDate=r();notInvoiceableItemKeys=new Set;invoiceOpen;invoiceClose;invoiceCreated;previewProformaInvoice;loadingChange;room;confirmButtonRef;bookingService=new u;invoiceTarget;apiDisabledItemKeys=new Set;alreadyInvoicedItemKeys=new Set;componentWillLoad(){this.init()}componentDidLoad(){this.confirmButtonRef=document.querySelector(`#confirm-btn_${this.formId}`)}handleViewModeChange(){if(this.invoicableKey?.size){this.applyDefaultSelections(Array.from(this.invoicableKey.values()))}this.enforceNonInvoiceableSelections()}handleBookingChange(){if(this.booking){this.selectedRecipient=this.booking.guest.id.toString();if(this.for==="room"&&this.roomIdentifier){this.room=this.booking.rooms.find((e=>e.identifier===this.roomIdentifier))}}this.setUpDisabledItems()}handleInvoiceInfoChange(){this.setupInvoicables(this.invoiceInfo)}setUpDisabledItems(){if(!this.booking||!this.invoicableKey?.size){this.notInvoiceableItemKeys=new Set;return}const e=(this.invoiceDate??r()).clone().startOf("day");const i=new Set;const t=(t,a,o)=>{if(o?.checkedOut){return}if(typeof t!=="number"||!this.invoicableKey.has(t)||!a){return}const n=r(a,"YYYY-MM-DD",true);if(n.isValid()&&e.isBefore(n.clone().startOf("day"))){i.add(t)}};const a=this.booking.rooms??[];a.forEach((e=>{t(e.system_id,e.to_date,{checkedOut:e?.in_out?.code==="002"})}));const o=this.booking.pickup_info;if(o){t(o?.system_id,o?.from_date??o?.date)}(this.booking.extra_services??[]).forEach((e=>{t(e.system_id,e?.from_date??e.start_date??e.end_date??this.booking.from_date)}));const n=L(a);if(n){const e=new Map(a.map((e=>[e.identifier,e])));n.heads.forEach((t=>{const a=n.chainOf.get(t)??[];if(a.length<=1){return}const o=a[a.length-1];const r=e.get(o);if(!r){return}const s=r.in_out?.code==="002";a.forEach((t=>{const a=e.get(t);if(!a||typeof a.system_id!=="number"||!this.invoicableKey.has(a.system_id)){return}if(s){i.delete(a.system_id);return}i.add(a.system_id)}))}))}this.notInvoiceableItemKeys=i;this.enforceNonInvoiceableSelections(this.getCombinedDisabledKeys(i))}enforceNonInvoiceableSelections(e){if(this.viewMode==="proforma"){return}const i=e??this.getCombinedDisabledKeys();if(!i.size){return}const t=new Set(this.selectedItemKeys);let a=false;i.forEach((e=>{if(t.delete(e)){a=true}}));if(a){this.syncSelectedItems(t)}}getCombinedDisabledKeys(e){const i=e??this.notInvoiceableItemKeys??new Set;const t=new Set(i);this.apiDisabledItemKeys.forEach((e=>t.add(e)));if(this.viewMode==="invoice"){this.alreadyInvoicedItemKeys.forEach((e=>t.add(e)))}return t}isAlreadyInvoiced(e){if(this.viewMode!=="invoice"||typeof e!=="number"){return false}return this.alreadyInvoicedItemKeys.has(e)}syncSelectedItems(e){this.selectedItemKeys=e;const i=[];e.forEach((e=>{const t=this.invoicableKey?.get(e);if(t){i.push(t)}}));this.toBeInvoicedItems=i;if(!this.confirmButtonRef){return}if(this.toBeInvoicedItems.length===0){this.confirmButtonRef.disabled=true}else{if(this.confirmButtonRef.disabled){this.confirmButtonRef.disabled=false}}}canInvoiceRoom(e){return Boolean(e&&this.invoicableKey?.has(e.system_id))}hasInvoiceableRooms(e){return e.some((e=>this.canInvoiceRoom(e)))}getInvoiceableRoomIds(e){const i=[];e.forEach((e=>{if(this.canInvoiceRoom(e)){i.push(e.system_id)}}));return i}async init(){try{this.isLoading=true;const[e,i]=await Promise.all([this.bookingService.getExposedBooking(this.booking.booking_nbr,"en",true),this.bookingService.getBookingInvoiceInfo({booking_nbr:this.booking.booking_nbr})]);this.booking={...e};this.setupInvoicables(i);if(this.booking){this.selectedRecipient=this.booking.guest.id.toString();if(this.for==="room"&&this.roomIdentifier){this.room=this.booking.rooms.find((e=>e.identifier===this.roomIdentifier))}}this.invoiceTarget=await this.bookingService.getSetupEntriesByTableName("_INVOICE_TARGET")}catch(e){console.error(e)}finally{this.isLoading=false}}setupInvoicables(e){const i=e?.invoiceable_items??[];const t=[];i.forEach((e=>{t.push([e.key,e]);if(typeof e.system_id==="number"&&e.system_id!==e.key){t.push([e.system_id,e])}}));this.invoicableKey=new Map(t);this.apiDisabledItemKeys=new Set(i.filter((e=>!e.is_invoiceable)).map((e=>this.getSelectableKey(e))));const a=[];i.forEach((e=>{if(e.reason?.code!=="001"){return}a.push(e.key);if(typeof e.system_id==="number"&&e.system_id!==e.key){a.push(e.system_id)}}));this.alreadyInvoicedItemKeys=new Set(a);this.applyDefaultSelections(i);this.setUpDisabledItems()}applyDefaultSelections(e){const i=this.viewMode==="proforma"?e.map((e=>this.getSelectableKey(e))):e.filter((e=>e.is_invoiceable&&e.reason?.code!=="001")).map((e=>this.getSelectableKey(e)));this.syncSelectedItems(new Set(i))}getSelectableKey(e){return typeof e.system_id==="number"?e.system_id:e.key}async handleConfirmInvoice(e=false){try{this.loadingChange.emit(true);const i=this.selectedRecipient?.startsWith("room__")?this.selectedRecipient.replace("room__","").trim():"";let t;const a=e=>{let i=this.invoiceTarget.find((i=>i.CODE_NAME===e));if(!i){throw new Error(`Invalid code ${e}`)}return{code:i.CODE_NAME,description:i.CODE_VALUE_EN}};if(this.selectedRecipient==="company"){t=a("002")}else{t=a("001")}const o={booking_nbr:this.booking.booking_nbr,currency:{id:this.booking.currency.id},Date:this.invoiceDate.format("YYYY-MM-DD"),items:this.toBeInvoicedItems,target:t,billed_to_name:i};if(e){this.previewProformaInvoice.emit({invoice:o});return}await this.bookingService.issueInvoice({is_proforma:e,property_id:m.property.id,invoice:o});const n=await this.bookingService.getBookingInvoiceInfo({booking_nbr:this.booking.booking_nbr});await this.openLastInvoice(n);this.invoiceCreated.emit(n);this.invoiceClose.emit()}catch(e){console.error(e)}finally{this.loadingChange.emit(false)}}async openLastInvoice(e){const i=e.invoices[e.invoices.length-1];const{My_Result:t}=await this.bookingService.printInvoice({property_id:m.property.id,mode:i?.credit_note?"creditnote":"invoice",invoice_nbr:i.nbr});window.open(t)}getMinDate(){if(this.for==="room"){return this.room.to_date}return this.booking.from_date}getMaxDate(){return r().format("YYYY-MM-DD")}computeRoomGroups(e){const i=new Map;e.forEach(((e,t)=>i.set(e.identifier,t)));if(!e.length){return{groups:[],indexById:i,hasSplitGroups:false}}const t=e=>{let i=Number.MAX_SAFE_INTEGER;for(const t of e){const e=Date.parse(t?.from_date??"");if(!Number.isNaN(e)){i=Math.min(i,e)}}return i};const a=L(e);if(!a){const a=[...e].sort(((e,t)=>{const a=Date.parse(e?.from_date??"")-Date.parse(t?.from_date??"");if(!Number.isNaN(a)&&a!==0){return a}return(i.get(e.identifier)??0)-(i.get(t.identifier)??0)}));return{groups:[{rooms:a,order:0,isSplit:false,sortKey:t(a)}],indexById:i,hasSplitGroups:false}}const o=new Map(e.map((e=>[e.identifier,e])));const n=[];const r=new Set;for(const e of a.heads){const s=a.chainOf.get(e)??[e];const c=s.map((e=>o.get(e))).filter((e=>Boolean(e)));if(!c.length)continue;const l=s.some((e=>{const i=a.parentOf.get(e);const t=a.childrenOf.get(e)??[];return Boolean(i)||t.length>0}))||c.some((e=>Boolean(e?.is_split)));if(l){c.forEach((e=>r.add(e.identifier)));const e=Math.min(...c.map((e=>i.get(e.identifier)??Number.MAX_SAFE_INTEGER)));n.push({rooms:c,order:e,sortKey:t(c),isSplit:true})}}for(const a of e){if(!r.has(a.identifier)){const e=i.get(a.identifier)??Number.MAX_SAFE_INTEGER;const o=[a];n.push({rooms:o,order:e,sortKey:t(o),isSplit:false})}}n.sort(((e,i)=>{if(e.sortKey!==i.sortKey){return e.sortKey-i.sortKey}return e.order-i.order}));const s=n.some((e=>e.isSplit));if(!s){const e=n.map((e=>e.rooms)).reduce(((e,i)=>e.concat(i)),[]).sort(((e,t)=>{const a=Date.parse(e?.from_date??"")-Date.parse(t?.from_date??"");if(!Number.isNaN(a)&&a!==0){return a}return(i.get(e.identifier)??0)-(i.get(t.identifier)??0)}));return{groups:[{rooms:e,order:0,sortKey:t(e),isSplit:false}],indexById:i,hasSplitGroups:false}}return{groups:n,indexById:i,hasSplitGroups:true}}getDateView(i,t){if(!i){return}const a=r(i,"YYYY-MM-DD").format("MMM DD, YYYY");if(!t){return e("span",null,a)}const o=r(t,"YYYY-MM-DD").format("MMM DD, YYYY");return e("span",null,a," ",e("wa-icon",{name:"arrow-right"})," ",o)}renderReasonDescription(i){if(this.viewMode!=="invoice"||typeof i!=="number"||!this.invoicableKey?.size){return null}const t=this.invoicableKey.get(i);if(!t||t.is_invoiceable||!t.reason?.description){return null}return e("span",{class:"ir-invoice__reason"},t.reason.description)}renderPriceColumn(i,t){const a=typeof i==="number";const o=this.renderReasonDescription(t);if(!a&&!o){return null}const n=this.booking?.currency?.symbol??"";return e("div",{class:"ir-invoice__price-column"},a&&e("span",{class:"ir-invoice__checkbox-price"},s(n,i)),o)}handleCheckChange({checked:e,system_id:i,system_ids:t}){if(!this.invoicableKey){return}const a=[...Array.isArray(t)?t:[],...typeof i==="number"?[i]:[]].filter((e=>typeof e==="number"));if(!a.length){return}if(this.isDisabled(a)){return}const o=new Set(this.selectedItemKeys);let n=false;a.forEach((i=>{if(!this.invoicableKey.has(i)){return}if(e){if(!o.has(i)){o.add(i);n=true}}else if(o.delete(i)){n=true}}));if(n){this.syncSelectedItems(o)}}isSelected(e=[]){if(!e?.length){return false}for(const i of e){if(typeof i==="number"&&this.selectedItemKeys.has(i)){return true}}return false}isDisabled(e=[]){if(this.viewMode==="proforma"||!e?.length){return false}const i=this.getCombinedDisabledKeys();if(!i.size){return false}return e.some((e=>{if(typeof e!=="number"){return false}if(this.isAlreadyInvoiced(e)){return true}return i.has(e)}))}renderRooms(){const i=this.booking?.rooms??[];if(!i.length||!this.invoicableKey?.size){return null}const{groups:t,hasSplitGroups:a}=this.computeRoomGroups(i);if(!a){const i=t[0].rooms;const a=i.filter((e=>this.canInvoiceRoom(e)));if(!a.length){return null}return a.map((i=>{const t=this.isSelected([i.system_id]);const a=this.isDisabled([i.system_id]);return e("div",{class:"ir-invoice__service",key:i.identifier},e("wa-checkbox",{disabled:a,size:"small",onchange:e=>{const t=e.target.checked;this.handleCheckChange({checked:t,system_id:i.system_id})},defaultChecked:t,checked:t,class:"ir-invoice__checkbox"},e("div",{class:"ir-invoice__room-checkbox-container align-items-center"},e("div",{class:"ir-invoice__room-info"},e("span",null,e("b",null,i.roomtype.name),e("span",{style:{paddingLeft:"0.5rem"}},i.rateplan.short_name)),this.getDateView(i.from_date,i.to_date)),this.renderPriceColumn(i.gross_total,i.system_id))))}))}return t.map((i=>{if(!this.hasInvoiceableRooms(i.rooms)){return null}const t=this.getInvoiceableRoomIds(i.rooms);const a=this.isDisabled(t);const o=this.isSelected(t);return e("div",{class:"ir-invoice__service",key:i.order},e("wa-checkbox",{disabled:a,size:"small",onchange:e=>{const i=e.target.checked;this.handleCheckChange({checked:i,system_ids:t})},defaultChecked:o,checked:o,class:"ir-invoice__checkbox group"},e("div",{class:"ir-invoice__room-checkbox-container group"},i.rooms.map((i=>{if(!this.canInvoiceRoom(i)){return null}return e("div",{class:"d-flex align-items-center",style:{gap:"0.5rem"}},e("div",{class:"ir-invoice__room-info"},e("p",null,e("b",null,i.roomtype.name),e("span",null,i.rateplan.short_name)),this.getDateView(i.from_date,i.to_date)),this.renderPriceColumn(i.gross_total,i.system_id))})))))}))}renderPickup(){const i=this.booking.pickup_info?.["system_id"];if(!this.invoicableKey?.has(i)){return null}const t=this.isSelected([i]);const a=this.isDisabled([i]);return e("div",{class:"ir-invoice__service"},e("wa-checkbox",{disabled:a,size:"small",onchange:e=>{const t=e.target.checked;this.handleCheckChange({checked:t,system_id:i})},defaultChecked:t,checked:t,class:"ir-invoice__checkbox"},e("div",{class:"ir-invoice__room-checkbox-container"},e("div",{class:"ir-invoice__room-info"},e("span",null,"Pickup"),this.getDateView(this.booking.pickup_info.date,null)),this.renderPriceColumn(this.booking.pickup_info.selected_option.amount,i))))}renderCancellationPenalty(){const i=this.booking.financial.payments?.find((e=>e.payment_type?.code==="013"));if(!i){return null}const t=i?.system_id;if(!this.invoicableKey.has(t)){return null}const a=this.invoicableKey.get(t);const o=this.isSelected([t]);const n=this.isDisabled([t]);return e("div",{class:"ir-invoice__service"},e("wa-checkbox",{disabled:n,size:"small",onchange:e=>{const i=e.target.checked;this.handleCheckChange({checked:i,system_id:t})},defaultChecked:o,checked:o,class:"ir-invoice__checkbox"},e("div",{class:"ir-invoice__room-checkbox-container"},e("div",{class:"ir-invoice__room-info"},e("span",null,"Cancellation penalty"),this.getDateView(i.date,null)),this.renderPriceColumn(a.amount,t))))}render(){if(this.isLoading){return e("div",{class:"drawer__loader-container"},e("ir-spinner",null))}return e(a,{size:"small"},e("form",{id:this.formId,onSubmit:e=>{e.preventDefault();const i=e.submitter;const t=this.viewMode==="proforma"||i?.value==="pro-forma";this.handleConfirmInvoice(t)},class:"ir-invoice__container"},e("ir-custom-date-picker",{onDateChanged:e=>{this.invoiceDate=e.detail.start;this.setUpDisabledItems()},label:"Date",date:this.invoiceDate.format("YYYY-MM-DD"),minDate:this.getMinDate(),maxDate:this.getMaxDate()}),e("ir-booking-billing-recipient",{onRecipientChange:e=>this.selectedRecipient=e.detail,booking:this.booking}),this.viewMode==="invoice"&&r().isBefore(r(this.booking.from_date,"YYYY-MM-DD"),"dates")?e("ir-empty-state",{message:"Invoices cannot be issued before guest arrival"}):e("div",{class:"ir-invoice__services"},e("p",{class:"ir-invoice__form-control-label"},"Choose what to invoice ",e("span",{style:{color:"var(--wa-color-gray-60)",paddingLeft:"0.5rem"}}," (Disabled services are not eligible to be invoiced yet)")),e("div",{class:"ir-invoice__services-container"},this.invoicableKey.size===0&&e("ir-empty-state",{style:{marginTop:"3rem"}}),this.renderRooms(),this.booking.pickup_info&&this.renderPickup(),this.booking.extra_services?.map((i=>{const t=i.system_id;if(!this.invoicableKey?.has(t)){return null}const a=this.isSelected([t]);const o=this.isDisabled([t]);return e("div",{key:i.system_id,class:"ir-invoice__service"},e("wa-checkbox",{disabled:o,size:"small",onchange:e=>{const i=e.target.checked;this.handleCheckChange({checked:i,system_id:t})},defaultChecked:a,class:"ir-invoice__checkbox",checked:a},e("div",{class:"ir-invoice__room-checkbox-container"},e("div",{class:"ir-invoice__room-info"},e("span",null,i.description),this.getDateView(i.start_date,i.end_date)),this.renderPriceColumn(i.price,t))))})),this.renderCancellationPenalty()))))}static get watchers(){return{viewMode:["handleViewModeChange"],booking:["handleBookingChange"],invoiceInfo:["handleInvoiceInfoChange"]}}};Ei.style=Si;const zi=".sc-ir-payment-details-h{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-payment-details-h *.sc-ir-payment-details{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sm-margin-right.sc-ir-payment-details{margin-right:5px !important;background:#000}.action_icons.sc-ir-payment-details{width:60px}.w-60.sc-ir-payment-details{width:100px;padding:0 5px}.payments-height.sc-ir-payment-details{height:30px}.payment_date.sc-ir-payment-details{width:100px}.iframeHeight.sc-ir-payment-details{height:max-content;height:22.5rem}.designation.sc-ir-payment-details{width:120px}.total-cost-container.sc-ir-payment-details{background:#7cbebe;color:white;padding:0.5rem;border-radius:5px}";const Bi=zi;const Oi=class{constructor(e){i(this,e);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.resetExposedCancellationDueAmount=t(this,"resetExposedCancellationDueAmount",7);this.toast=t(this,"toast",7);this.openSidebar=t(this,"openSidebar",7);this.openPrintScreen=t(this,"openPrintScreen",7)}booking;paymentActions;propertyId;paymentEntries;confirmModal=false;toBeDeletedItem=null;modalMode=null;isLoading=false;resetBookingEvt;resetExposedCancellationDueAmount;toast;openSidebar;openPrintScreen;paymentService=new N;bookingService=new u;dialogRef;handlePaymentGeneration(e){const i=e.detail;const t=this.paymentEntries?.types?.find((e=>e.CODE_NAME===(this.booking.status.code==="003"?i.pay_type_code:"001")));this.openSidebar.emit({type:"payment-folio",payload:{payment:{...i,date:r().format("YYYY-MM-DD"),id:-1,amount:i.amount,payment_type:t?{code:t.CODE_NAME,description:t.CODE_VALUE_EN,operation:t.NOTES}:null,designation:t?.CODE_VALUE_EN??null},mode:"payment-action"}})}handleAddPayment=e=>{let i={id:-1,date:r().format("YYYY-MM-DD"),amount:null,currency:m.currency,designation:null,reference:null};if(e){const{amount:t,type:a}=e;const o=this.paymentEntries.methods.find((e=>e.CODE_NAME==="001"));const n={code:o.CODE_NAME,description:o.CODE_VALUE_EN,operation:o.NOTES};const r=this.paymentEntries.types.find((e=>e.CODE_NAME===(a==="cancellation-penalty"?"001":"010")));i={...i,amount:t,designation:r.CODE_VALUE_EN,payment_type:{code:r.CODE_NAME,description:r.CODE_VALUE_EN,operation:r.NOTES},payment_method:a==="refund"?undefined:n};this.openSidebar.emit({type:"payment-folio",payload:{payment:i,mode:"payment-action"}});return}this.openSidebar.emit({type:"payment-folio",payload:{payment:i,mode:"new"}})};handleEditPayment(e){this.openSidebar.emit({type:"payment-folio",payload:{payment:e,mode:"edit"}})}handleDeletePayment(e){this.modalMode="delete";this.toBeDeletedItem=e;this.dialogRef.openModal()}async handleIssueReceipt(e){if(e.receipt_nbr){this.openPrintScreen.emit({mode:"receipt",payload:{pid:e.system_id?.toString(),rnb:e.receipt_nbr}});return}const i=await this.bookingService.getNextValue({starter:"RC"});this.openPrintScreen.emit({mode:"receipt",payload:{pid:e.system_id?.toString(),rnb:`RC-${i.My_Result}`}})}async cancelPayment(){try{this.isLoading=true;await this.paymentService.CancelPayment(this.toBeDeletedItem.system_id);const e=this.booking.financial.payments.filter((e=>e.id!==this.toBeDeletedItem.id));this.booking={...this.booking,financial:{...this.booking.financial,payments:e}};this.dialogRef.closeModal();this.confirmModal=false;this.resetBookingEvt.emit(null);this.resetExposedCancellationDueAmount.emit(null);this.toBeDeletedItem=null}catch(e){console.error("Error canceling payment:",e);this.toast.emit({type:"error",title:"Error",description:"Failed to cancel payment. Please try again.",position:"top-right"})}finally{this.isLoading=false}}handleConfirmModal=async e=>{e.stopImmediatePropagation();e.stopPropagation();if(this.modalMode==="delete"){await this.cancelPayment()}};handleCancelModal=e=>{e.stopImmediatePropagation();e.stopPropagation();this.modalMode=null;this.toBeDeletedItem=null};hasValidFinancialData(){return Boolean(this.booking?.financial)}shouldShowRefundButton(){if(!this.booking.is_direct){return false}if(this.booking.financial.due_amount===0){return false}if(this.booking.financial.cancelation_penality_as_if_today===0){return false}if(this.booking.is_requested_to_cancel||["003","004"].includes(this.booking.status.code)){return this.booking.financial.cancelation_penality_as_if_today<0}return false}shouldCancellationButton(){if(!this.booking.is_direct){return false}if(this.booking.financial.due_amount===0){return false}if(this.booking.financial.cancelation_penality_as_if_today===0){return false}if(["003","004"].includes(this.booking.status.code)&&this.booking.financial.cancelation_penality_as_if_today>0){return true}return false}render(){if(!this.hasValidFinancialData()){return null}const{financial:i,currency:t}=this.booking;return[e("wa-card",null,e("ir-payment-summary",{isBookingCancelled:["003","004"].includes(this.booking.status.code),totalCost:i.gross_cost,balance:i.due_amount,collected:this.booking.financial.collected+this.booking.financial.refunds,currency:t}),e("ir-booking-guarantee",{booking:this.booking,bookingService:this.bookingService}),!["003","004"].includes(this.booking.status.code)&&this.booking.is_direct&&e("ir-applicable-policies",{propertyId:this.propertyId,booking:this.booking}),this.shouldShowRefundButton()&&e("div",{class:"d-flex mt-1"},e("ir-custom-button",{variant:"brand",appearance:"outlined",onClickHandler:()=>{this.handleAddPayment({type:"refund",amount:Math.abs(this.booking.financial.cancelation_penality_as_if_today)})}},`Refund ${s(t.symbol,Math.abs(this.booking.financial.cancelation_penality_as_if_today))}`)),this.shouldCancellationButton()&&e("div",{class:"d-flex mt-1"},e("ir-custom-button",{variant:"brand",appearance:"outlined",onClickHandler:()=>{this.handleAddPayment({type:"cancellation-penalty",amount:Math.abs(this.booking.financial.cancelation_penality_as_if_today)})}},`Charge cancellation penalty ${s(t.symbol,this.booking.financial.cancelation_penality_as_if_today)}`))),e("ir-payments-folio",{payments:i.payments||[],onAddPayment:()=>this.handleAddPayment(),onEditPayment:e=>this.handleEditPayment(e.detail),onDeletePayment:e=>this.handleDeletePayment(e.detail),onIssueReceipt:e=>this.handleIssueReceipt(e.detail)}),e("ir-dialog",{onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation()},onIrDialogAfterHide:e=>{this.handleCancelModal(e)},ref:e=>this.dialogRef=e,label:"Alert",lightDismiss:this.modalMode!=="delete"},e("p",null,this.modalMode==="delete"?b.entries.Lcz_IfDeletedPermantlyLost:b.entries.Lcz_EnteringAmountGreaterThanDue),e("div",{slot:"footer",class:"ir-dialog__footer"},e("ir-custom-button",{size:"medium","data-dialog":"close",variant:"neutral",appearance:"filled"},b.entries.Lcz_Cancel),e("ir-custom-button",{loading:this.isLoading,size:"medium",onClickHandler:e=>this.handleConfirmModal(e),variant:this.modalMode==="delete"?"danger":"brand"},this.modalMode==="delete"?b.entries.Lcz_Delete:b.entries.Lcz_Confirm)))]}};Oi.style=Bi;const Ai=".sc-ir-payment-folio-h{display:block;--payment-type-badge-bg:#ff4961;text-align:start}.payment-type-badge.sc-ir-payment-folio{background:var(--payment-type-badge-bg);color:white;padding:0.2rem 0.3rem !important;font-size:12px;border-radius:4px;margin:0;text-transform:capitalize}.credit-badge.sc-ir-payment-folio{--payment-type-badge-bg:#629a4c}.debit-badge.sc-ir-payment-folio{--payment-type-badge-bg:#ff4961}.dropdown-item-payment.sc-ir-payment-folio{display:flex;align-items:center;gap:1rem;box-sizing:border-box;justify-content:space-between}.input-group-text.sc-ir-payment-folio{border-color:#cacfe7 !important}.payment-folio__payment-type-option.sc-ir-payment-folio{display:flex;align-items:center;justify-content:space-between}.payment-folio__form.sc-ir-payment-folio{display:grid;gap:var(--wa-space-m, 1rem)}";const Ti=Ai;const Pi="YYYY-MM-DD";const Ni=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7)}paymentEntries;bookingNumber;payment={date:r().format(Pi),amount:0,designation:undefined,currency:null,reference:null,id:-1};mode;isLoading=null;isOpen;closeModal;async openFolio(){this.isOpen=true}async closeFolio(){this.isOpen=false;this.closeModal.emit(null)}_id=`ir__folio-form-${A()}`;render(){return e("ir-drawer",{key:"798c8b6ed59c88ecabcd5cc12bfdc363865c076c",placement:"start",style:{"--ir-drawer-width":"40rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"},label:this.payment?.id!==-1?"Edit Folio Entry":"New Folio Entry",open:this.isOpen,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeFolio()}},this.isOpen&&e("ir-payment-folio-form",{key:"b7dab3b837c08c1dd15cad06f9b3f33ee5bfd970",formId:this._id,onLoadingChanged:e=>this.isLoading=e.detail,onCloseModal:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeFolio()},paymentEntries:this.paymentEntries,bookingNumber:this.bookingNumber,payment:this.payment,mode:this.mode}),e("div",{key:"ddcf11e2462d202a21da57c44369b9af48e97682",slot:"footer",class:"w-100 d-flex align-items-center",style:{gap:"var(--wa-space-xs)"}},e("ir-custom-button",{key:"fa57e300a3a6747947c536517863f30061421e64",class:"flex-fill",size:"medium","data-drawer":"close",appearance:"filled",variant:"neutral",onClickHandler:()=>this.closeFolio()},"Cancel"),e("ir-custom-button",{key:"e6827d5ad4f51f8bf1e7fb89e2463ea8066f8fee",form:this._id,loading:this.isLoading==="save",class:"flex-fill",size:"medium",type:"submit",value:"save",appearance:"accent",variant:"brand"},"Save")))}};Ni.style=Ti;function $i(e){try{const{groups:i,types:t}=U.object({types:B.array().min(1),groups:B.array().min(1),methods:B.array().min(1)}).parse(e);const a=[...t];const o=e=>e.map((e=>a.find((i=>i.CODE_NAME===e)))).filter((e=>Boolean(e)));const n=e=>{const t=i.find((i=>i.CODE_NAME===e));return t?t.CODE_VALUE_EN.split(","):[]};let r={};i.forEach((e=>{r[e.CODE_NAME]=o(n(e.CODE_NAME))}));return r}catch(e){console.log(e);return{}}}const Ri=".sc-ir-payment-folio-form-h{display:block;--payment-type-badge-bg:#ff4961;text-align:start}.payment-type-badge.sc-ir-payment-folio-form{background:var(--payment-type-badge-bg);color:white;padding:0.2rem 0.3rem !important;font-size:12px;border-radius:4px;margin:0;text-transform:capitalize}.credit-badge.sc-ir-payment-folio-form{--payment-type-badge-bg:#629a4c}.debit-badge.sc-ir-payment-folio-form{--payment-type-badge-bg:#ff4961}.dropdown-item-payment.sc-ir-payment-folio-form{display:flex;align-items:center;gap:1rem;box-sizing:border-box;justify-content:space-between}.input-group-text.sc-ir-payment-folio-form{border-color:#cacfe7 !important}.payment-folio__payment-type-option.sc-ir-payment-folio-form{display:flex;align-items:center;justify-content:space-between}.payment-folio__form.sc-ir-payment-folio-form{display:grid;gap:var(--wa-space-m, 1rem)}";const Li=Ri;const Gi="YYYY-MM-DD";const Hi=e=>{if(!e){return false}return W.includes(e)};const ji=U.object({code:U.string().min(3).max(4),description:U.string(),operation:U.union([U.literal("CR"),U.literal("DB")])});const Ui=U.object({code:U.string().min(3).max(4),description:U.string(),operation:U.string().optional().nullable()});const Ki=U.object({id:U.number().nullable().optional(),system_id:U.number().nullable().optional(),date:U.string().regex(/^\d{4}-\d{2}-\d{2}$/).refine((e=>{const i=r(e,Gi,true);return i.isValid()}),{message:`Invalid date`}),amount:U.coerce.number().min(0),reference:U.string().optional().nullable(),payment_type:ji,payment_method:Ui.nullable().optional()});const Vi=Ki.superRefine(((e,i)=>{if(Hi(e.payment_type?.code)&&!e.payment_method?.code){i.addIssue({code:U.ZodIssueCode.custom,path:["payment_method"],message:"Payment method is required for this transaction type."})}}));let Fi=0;const qi=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.resetExposedCancellationDueAmount=t(this,"resetExposedCancellationDueAmount",7);this.loadingChanged=t(this,"loadingChanged",7)}paymentEntries;bookingNumber;formId;payment={date:r().format(Gi),amount:0,designation:undefined,currency:null,reference:null,id:-1};mode;isLoading=null;errors={};autoValidate=false;folioData;_paymentTypes={};closeModal;resetBookingEvt;resetExposedCancellationDueAmount;loadingChanged;today=r().format(Gi);paymentService=new N;componentId=`ir-payment-folio-form-${++Fi}`;controlIds={date:`${this.componentId}-date`,transactionType:`${this.componentId}-transaction-type`,paymentMethod:`${this.componentId}-payment-method`,amount:`${this.componentId}-amount`,reference:`${this.componentId}-reference`};componentWillLoad(){if(this.payment){this.folioData={...this.payment}}this.syncPaymentTypes()}handlePaymentChange(e,i){if(e!==i&&e){this.folioData={...e};this.syncPaymentTypes()}}handlePaymentEntriesChange(e,i){if(e!==i){this.syncPaymentTypes()}}updateFolioData(e){this.folioData={...this.folioData??{},...e}}requiresPaymentMethod(e){return Hi(e)}getDefaultPaymentMethod(){const e=this.paymentEntries?.methods?.[0];if(!e){return null}return{code:e.CODE_NAME,description:e.CODE_VALUE_EN,operation:e.NOTES}}stopEventPropagation(e){e.stopImmediatePropagation();e.stopPropagation()}syncPaymentTypes(){if(!this.paymentEntries){this._paymentTypes={};return}const e=$i(this.paymentEntries);if(this.mode==="payment-action"&&this.payment?.payment_type?.code==="001"){const{PAYMENTS:i,CANCELLATION:t}=e;this._paymentTypes={PAYMENTS:i,CANCELLATION:t};return}this._paymentTypes=e}async savePayment(e=false){try{this.isLoading=e?"save-print":"save";this.loadingChanged.emit(this.isLoading);this.autoValidate=true;this.errors={};const i=Vi.parse({...this.folioData??{},amount:this.folioData?.amount??undefined});const{payment_type:t,payment_method:a,...o}=i;const n={...o,payment_type:t,payment_method:a?a:undefined,id:o.id??this.payment?.id??-1,date:o.date??this.payment?.date??this.today,system_id:o.system_id??this.payment?.system_id??undefined,amount:o.amount??0,currency:m.currency,reference:o.reference??"",designation:t?.description||""};await this.paymentService.AddPayment(n,this.bookingNumber);this.resetBookingEvt.emit(null);this.resetExposedCancellationDueAmount.emit({booking_nbr:this.bookingNumber});this.closeModal.emit()}catch(e){const i={};if(e instanceof K){e.issues.forEach((e=>{const t=e.path[0]?.toString();if(t){i[t]=true}}))}console.error("Failed to save payment folio entry",e);this.errors=i}finally{this.isLoading=null;this.loadingChanged.emit(null)}}handleDropdownChange(e){this.updateFolioData({designation:e});if(!e){this.updateFolioData({payment_type:null,payment_method:null});return}const i=this.paymentEntries?.types?.find((i=>i.CODE_NAME===e));if(!i){console.warn(`Invalid payment type ${e}`);this.updateFolioData({payment_type:null,payment_method:null});return}this.updateFolioData({payment_type:{code:i.CODE_NAME,description:i.CODE_VALUE_EN,operation:i.NOTES},payment_method:this.requiresPaymentMethod(i.CODE_NAME)?null:this.getDefaultPaymentMethod()})}handlePaymentMethodDropdownChange(e){const i=this.paymentEntries?.methods?.find((i=>i.CODE_NAME===e));if(!i){console.warn(`Invalid payment method ${e}`);this.updateFolioData({payment_method:null});return}this.updateFolioData({payment_method:{code:i.CODE_NAME,description:i.CODE_VALUE_EN,operation:i.NOTES}})}renderDropdownItems(){const i=Object.values(this._paymentTypes??{});if(!i.length){return null}return i.map(((i,t)=>e(o,null,i.map((i=>e("wa-option",{key:i.CODE_NAME,value:i.CODE_NAME,label:i.CODE_VALUE_EN},e("div",{class:"payment-folio__payment-type-option"},e("span",null,i.CODE_VALUE_EN),e("wa-badge",{variant:i.NOTES==="CR"?"success":"danger",style:{fontSize:"var(--wa-font-size-s)"}},i.NOTES==="CR"?"credit":"debit"))))),t!==Object.values(this._paymentTypes).length-1&&e("wa-divider",null))))}render(){return e("form",{key:"2e44edc22910e1566833c1941744c7be34b336b4",onSubmit:e=>{e.preventDefault();const i=e.submitter;if(i?.value==="save"){this.savePayment()}},class:"payment-folio__form",id:this.formId},e("ir-custom-date-picker",{key:"e976867a053257635d3505fbee72962e808585f3",id:this.controlIds.date,label:"Date","aria-invalid":this.errors?.date&&!this.folioData?.date?"true":"false","data-testid":"pickup_date",onDateChanged:e=>{this.updateFolioData({date:e.detail.start?.format(Gi)})},minDate:r().add(-2,"months").format("YYYY-MM-DD"),emitEmptyDate:true,maxDate:this.today,date:this.folioData?.date}),e("ir-validator",{key:"6c51a1b3340e8c61ae8d4300e1bc17397d68d1fe",value:this.folioData?.payment_type?.code,autovalidate:this.autoValidate,schema:ji.shape.code,valueEvent:"change wa-change select-change",blurEvent:"wa-hide"},e("wa-select",{key:"604ff1d867d9956dff1f363bf5fd5309b7cc6c5a",id:this.controlIds.transactionType,size:"small","onwa-hide":e=>this.stopEventPropagation(e),"onwa-show":e=>this.stopEventPropagation(e),placeholder:"Select...",label:"Transaction type",defaultValue:this.folioData?.payment_type?.code,value:this.folioData?.payment_type?.code,disabled:this.mode==="payment-action",onchange:e=>{this.stopEventPropagation(e);this.handleDropdownChange(e.target.value)}},e("wa-option",{key:"4b216b40bfe973d34bc1ce18b192ae9f911ca598",value:""},"Select..."),this.renderDropdownItems())),this.requiresPaymentMethod(this.folioData?.payment_type?.code)&&e("ir-validator",{key:"82809b9a4904251a0eaad53dbe6ba1485e6a5448",value:this.folioData?.payment_method?.code??"",autovalidate:this.autoValidate,schema:Ui.shape.code,valueEvent:"change wa-change select-change",blurEvent:"wa-hide"},e("wa-select",{key:"25528aca9eb3c10b5ad2ef869ff6d793145a001a",id:this.controlIds.paymentMethod,size:"small",label:`${this.folioData.payment_type?.code==="001"?"Payment":"Refund"} method`,"onwa-show":e=>this.stopEventPropagation(e),"onwa-hide":e=>this.stopEventPropagation(e),defaultValue:this.folioData?.payment_method?.code,value:this.folioData?.payment_method?.code??"",onchange:e=>{this.stopEventPropagation(e);this.handlePaymentMethodDropdownChange(e.target.value)}},e("wa-option",{key:"b6f7b6e6c1dd124be98b256932c6d722bf373f1f",value:""},"Select..."),this.paymentEntries?.methods?.map((i=>e("wa-option",{key:i.CODE_NAME,label:i.CODE_VALUE_EN,value:i.CODE_NAME},i.CODE_VALUE_EN))))),e("ir-validator",{key:"3dcc0c66b0894415cb1e727ce440b765e3b4bee5",value:this.folioData?.amount?.toString()??undefined,autovalidate:this.autoValidate,schema:Ki.shape.amount,valueEvent:"text-change input input-change",blurEvent:"input-blur"},e("ir-input",{key:"0ad018767d81daa2f1ea6e40b85a88a7118cf92c",id:this.controlIds.amount,"aria-invalid":String(!!this.errors?.amount),value:this.folioData?.amount?.toString()??"",label:"Amount",mask:"price",min:0,"onText-change":e=>this.updateFolioData({amount:!e.detail?undefined:Number(e.detail)})},e("span",{key:"aef4b879ed5510636a632c77c71d49e5c9862d17",slot:"start"},m.currency.symbol))),e("ir-validator",{key:"a8df6928d78a53696daf2aa16d00ebde391ef9a5",value:this.folioData?.reference??"",autovalidate:this.autoValidate,schema:Ki.shape.reference,valueEvent:"text-change input input-change",blurEvent:"input-blur"},e("ir-input",{key:"e314d99c9cdcb0d5eef225ce2798cf15eb8f493a",id:this.controlIds.reference,value:this.folioData?.reference??"",label:"Reference",maxlength:50,"onText-change":e=>this.updateFolioData({reference:e.detail??""})})))}static get watchers(){return{payment:["handlePaymentChange"],paymentEntries:["handlePaymentEntriesChange"]}}};qi.style=Li;const Wi=".payment-item__payment-item.sc-ir-payment-item{display:flex;flex-direction:column;min-height:2.5rem}.payment-item__payment-item.sc-ir-payment-item p.sc-ir-payment-item{padding:0;margin:0;box-sizing:border-box}.payment-item__payment-body.sc-ir-payment-item{display:flex;flex-direction:column}.payment-item__payment-fields.sc-ir-payment-item{display:flex;align-items:center;justify-content:space-between}.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item,.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-description.sc-ir-payment-item{display:none}.payment-item__payment-toolbar.sc-ir-payment-item{display:flex;align-items:center;justify-content:space-between}.payment-item__payment-toolbar.sc-ir-payment-item .payment-item__payment-amount.sc-ir-payment-item{display:none}.payment-item__action-button.sc-ir-payment-item{cursor:pointer}.payment-item__payment-amount.sc-ir-payment-item{font-weight:700;white-space:nowrap}.payment-item__payment-amount.is-credit.sc-ir-payment-item{color:var(--wa-color-success-50)}.payment-item__payment-amount.is-debit.sc-ir-payment-item{color:var(--wa-color-danger-50)}.payment-item__payment-reference.sc-ir-payment-item{font-size:12px}@media (min-width: 640px){.payment-item__payment-item.sc-ir-payment-item{flex-direction:row;align-items:center;gap:1rem}.payment-item__payment-item.sc-ir-payment-item:hover{background:var(--wa-color-neutral-fill-quiet, #f1f2f3)}.payment-item__payment-item.sc-ir-payment-item .payment-item__payment-actions.sc-ir-payment-item{display:inline-flex}.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item,.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-description.sc-ir-payment-item,.payment-item__payment-item.sc-ir-payment-item .payment-item__payment-amount.sc-ir-payment-item{display:inline-flex}.payment-item__payment-fields.sc-ir-payment-item .payment-item__payment-amount.sc-ir-payment-item,.payment-item__payment-toolbar.sc-ir-payment-item .payment-item__payment-description.sc-ir-payment-item,.payment-item__payment-item.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item,.payment-item__payment-actions.sc-ir-payment-item{display:none}.payment-item__payment-description.sc-ir-payment-item{padding:0 0.5rem !important}.payment-item__payment-body.sc-ir-payment-item .payment-item__payment-reference.sc-ir-payment-item{display:inline-flex;align-items:center}.payment-item__payment-body.sc-ir-payment-item{flex:1 1 0%;justify-content:flex-start}.payment-item__payment-fields.sc-ir-payment-item{justify-content:flex-start;gap:0.5rem}.payment-item__payment-toolbar.sc-ir-payment-item{gap:0.5rem;align-items:center}}";const Zi=Wi;const Ji=class{constructor(e){i(this,e);this.editPayment=t(this,"editPayment",7);this.deletePayment=t(this,"deletePayment",7);this.issueReceipt=t(this,"issueReceipt",7)}payment;editPayment;deletePayment;issueReceipt;_id=A();render(){const i=this.payment.payment_type.operation==="CR";const t=(W.includes(this.payment.payment_type?.code)?`${this.payment.payment_type?.description}: ${this.payment.payment_method.description}`:this.payment.payment_type.description)??this.payment.designation;return e("div",{key:"ac11f498d4ccbafc5aefe1e84961dcd6cb367387",class:"payment-item__payment-item"},e("div",{key:"8c0a5da1d0577bb1857caf7cdd20aac811fc9176",class:"payment-item__payment-body",part:"payment-body"},e("div",{key:"c2b2f8314bdd521c9b36c002e694a021b66197ef",class:"payment-item__payment-fields",part:"payment-fields"},e("p",{key:"1ec83be83370051d4f9c1ef5f3e292bd86b72539",class:"payment-item__payment-date"},r(this.payment.date,"YYYY-MM-DD").format("MMM DD, YYYY")),e("p",{key:"b502bb7d55f91f73b496254aab9c8ce6d6317a9c",class:`payment-item__payment-amount ${i?"is-credit":"is-debit"}`},s(this.payment.currency.symbol,this.payment.amount)),e("p",{key:"dc8008cf807ae805b147691695dec28f6d3048e0",class:"payment-item__payment-description"},t)),this.payment.reference&&e("p",{key:"3903c069776b155a7b310d6a55cb2da95ed4564e",class:"payment-item__payment-reference"},this.payment?.reference)),e("div",{key:"6f73abb83082343af90194b03b2de0069b19eeae",class:"payment-item__payment-toolbar"},e("p",{key:"f81cc85698ca010f1545eecf6b2a50a1d4668edc",class:`payment-item__payment-amount ${i?"is-credit":"is-debit"}`},s(this.payment.currency.symbol,this.payment.amount)),e("p",{key:"e1cf7871fff27a30faea0b98b7fbf21571f6ba26",class:"payment-item__payment-description"},t),e("div",{key:"1baadee6ce99f4c2e50c13736aed81a7ab82aa02",class:"payment-item__payment-actions"},e("div",{key:"7ed88918d591d2a38cebfb2f29835d0528781f3b",class:"d-flex align-items-center"},e("wa-tooltip",{key:"502a0176211dcf52f698b0e6eb56305c5c8ec656",for:this._id},"User: ",this.payment.time_stamp.user),e("wa-icon",{key:"a5765068a7accc3ff15c13252f5da259d9588501",name:"user",id:this._id}),e("wa-dropdown",{key:"39679caf304021ba2f2af95c8a2b2dabae437a1c","onwa-hide":e=>{e.stopImmediatePropagation();e.stopPropagation()},"onwa-select":e=>{switch(e.detail.item.value){case"edit":this.editPayment.emit(this.payment);break;case"delete":this.deletePayment.emit(this.payment);break;case"receipt":this.issueReceipt.emit(this.payment);break}}},e("ir-custom-button",{key:"9c0775a380d981aa8478fd433e210a0ec5ada6bc",slot:"trigger",appearance:"plain"},e("wa-icon",{key:"0206f39cf265c7fdd4153e25c7e7ae9f2f0b669f",name:"ellipsis-vertical"})),this.payment.payment_type.code==="001"&&e("wa-dropdown-item",{key:"85fa3c59bfb35b29fde6334eedf10473814ea987",value:"receipt"},e("wa-icon",{key:"32d6dd9c947dea89c1b7b342424adb44c7e26344",name:"receipt",slot:"icon"}),"Print Receipt"),e("wa-dropdown-item",{key:"6299b02cb384c3a865d2fa54e837b73a743093bf",value:"edit"},e("wa-icon",{key:"b50af1ca74a986b2bab5c7462cc13e6e2aa82521",slot:"icon",name:"edit"}),"Edit"),e("wa-dropdown-item",{key:"9c5c5f31fa71e2c326561472f35839f584898735",value:"delete",variant:"danger"},e("wa-icon",{key:"4097ba428905220d56f337a70b76169df3cac649",slot:"icon",name:"trash"}),"Delete"))))),this.payment.reference&&e("p",{key:"62ccb566e7dd1c6d2942dbfb0307c8b4796fc55f",class:"payment-item__payment-reference"},this.payment?.reference))}};Ji.style=Zi;const Qi=".sc-ir-payment-summary-h{display:block}.sc-ir-payment-summary-h{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}.sc-ir-payment-summary-h *.sc-ir-payment-summary{font-family:'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important}";const Xi=Qi;const et=class{constructor(e){i(this,e)}totalCost;balance;collected;currency;isBookingCancelled;shouldShowTotalCost(){return this.totalCost>0&&this.totalCost!==null}render(){return e("div",{key:"b6720906c316f07debcf9a7eb894c55720187cea",class:" m-0"},this.shouldShowTotalCost()&&e("div",{key:"06396be091662549774ba0346d8714e6425b2f87",class:"mb-2 h4 total-cost-container"},b.entries.Lcz_TotalCost,":",e("span",{key:"fc26a0525591861f86a7c05b216b4c8b1d6de0e7"},s(this.currency.symbol,this.totalCost))),e("div",{key:"36a8ea89d3b3fa08dd139ddf9ade30d1645c2166",class:"h4 d-flex align-items-center justify-content-between"},e("span",{key:"7d55655b23ff9cca50e5f9dc0d3dde1f68c4d24b"},b.entries.Lcz_Balance,": "),e("span",{key:"c4c18b697ac9d21f8682eaa8061aaba3b460c16a",class:"danger font-weight-bold"},s(this.currency.symbol,this.balance))),!this.isBookingCancelled&&e("div",{key:"1f0a40468adf10b50dfa731eb266b5c38b27d8b9",class:"mb-2 h4 d-flex align-items-center justify-content-between"},e("span",{key:"975c594884cbf72c7f9c07c549cad79565989280"},b.entries.Lcz_Collected,": "),e("span",{key:"a42ee6a6c785148f71b55b910736048e1f7d3e9a"},s(this.currency.symbol,this.collected))))}};et.style=Xi;const it=".sc-ir-payments-folio-h{display:block}.payment-divider.sc-ir-payments-folio{margin:0;padding:0}";const tt=it;const at=class{constructor(e){i(this,e);this.addPayment=t(this,"addPayment",7);this.editPayment=t(this,"editPayment",7);this.deletePayment=t(this,"deletePayment",7);this.issueReceipt=t(this,"issueReceipt",7)}payments=[];addPayment;editPayment;deletePayment;issueReceipt;handleAddPayment=()=>{this.addPayment.emit()};handleEditPayment=e=>{this.editPayment.emit(e)};handleDeletePayment=e=>{this.deletePayment.emit(e)};handleIssueReceipt(e){this.issueReceipt.emit(e)}hasPayments(){return this.payments&&this.payments.length>0}renderPaymentItem(i,t){return[e("ir-payment-item",{key:i.id,payment:i,onDeletePayment:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleDeletePayment(e.detail)},onEditPayment:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleEditPayment(e.detail)},onIssueReceipt:e=>{e.stopImmediatePropagation();e.stopPropagation();this.handleIssueReceipt(e.detail)}}),t<this.payments.length-1&&e("wa-divider",{class:"payment-divider"})]}renderEmptyState(){return e("ir-empty-state",null)}render(){return e("wa-card",{key:"0d683ad3af03c37b777aebf51730bde280785915",class:" payments-container"},e("div",{key:"ba7f2483a03f0e12f22e4bc3b7c5eef87b40ce26",slot:"header",class:"d-flex align-items-center",style:{gap:"0.5rem"}},e("p",{key:"43e50ab29a8fd88b129535ed77821c1bfe1174dc",class:"font-size-large p-0 m-0"},"Guest Folio"),e(X,{key:"43745b65c463937e881c1e308ac8205c9abfa04f",message:"Help",href:"https://help.igloorooms.com/extranet/booking-details/guest-folio"})),e("wa-tooltip",{key:"7b7f4715c1073d04ea7e938c174ba05a8fa2748b",for:"create-payment"},"Add Payment"),e("ir-custom-button",{key:"b2c8bf2d6e0d9c092fe267f4e4a27e2d05d365ea",slot:"header-actions",id:"create-payment",size:"small",variant:"neutral",appearance:"plain",onClickHandler:this.handleAddPayment},e("wa-icon",{key:"b8541dbe03b19ea008a8b131afbe13f3f9446371",name:"plus",style:{fontSize:"1rem"}})),this.hasPayments()?this.payments.map(((e,i)=>this.renderPaymentItem(e,i))):this.renderEmptyState())}};at.style=tt;const ot="";const nt=ot;const rt=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7)}defaultPickupData;numberOfPersons=0;bookingNumber;bookingDates;open;isLoading=false;canSubmitPickup=false;closeModal;_id=`pickup-form-${A()}`;render(){return e("ir-drawer",{key:"6b69e6da493f9ac560c6875f48572e0774b1a7d7",style:{"--ir-drawer-width":"40rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"},label:b.entries.Lcz_Pickup,open:this.open,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeModal.emit()}},this.open&&e("ir-pickup-form",{key:"33762c91d3a6a06f01fdd62ef621075cf5b65eba",onCanSubmitPickupChange:e=>{e.stopImmediatePropagation();e.stopPropagation();this.canSubmitPickup=e.detail},defaultPickupData:this.defaultPickupData,numberOfPersons:this.numberOfPersons,bookingNumber:this.bookingNumber,bookingDates:this.bookingDates,onLoadingChange:e=>this.isLoading=e.detail,onCloseModal:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeModal.emit()},formId:this._id}),e("div",{key:"4888312f044f6ed8d7b6593866c9800b4ad47b3c",slot:"footer",class:"ir__drawer-footer"},e("ir-custom-button",{key:"0519a069a6491faedea7b46ec58da29a0c7fe969",class:`flex-fill`,size:"medium",appearance:"filled",variant:"neutral","data-drawer":"close"},b.entries.Lcz_Cancel),this.canSubmitPickup&&e("ir-custom-button",{key:"ef536a737da1ae79bce1e4f4a4fed6c0eb25052c",type:"submit",loading:this.isLoading,form:this._id,size:"medium",class:`flex-fill`,variant:"brand"},b.entries.Lcz_Save)))}};rt.style=nt;class st{async savePickup(e,i,t){try{if(!e.currency||!e.selected_option){throw new Error("Cannot save pickup without a selected option and currency.")}const a=e.arrival_time.split(":");await T.post(`/Do_Pickup`,{booking_nbr:i,is_remove:t,currency:e.currency,date:e.arrival_date,details:e.flight_details,hour:a[0],minute:a[1],nbr_of_units:e.number_of_vehicles,selected_option:e.selected_option,total:+e.due_upon_booking})}catch(e){console.log(e)}}transformDefaultPickupData(e){const i=e.hour&&e.minute?p(e.hour)+":"+p(e.minute):"";return{arrival_date:e.date,arrival_time:i,currency:e.currency,due_upon_booking:e.total.toFixed(2),flight_details:e.details,location:e.selected_option.location.id,number_of_vehicles:e.nbr_of_units,selected_option:e.selected_option,vehicle_type_code:e.selected_option.vehicle.code}}getAvailableLocations(e){let i=[];m.pickup_service.allowed_options.forEach((t=>{if(i.filter((e=>e.value===t.location.id)).length===0){i.push({text:e+" "+t.location.description,value:t.location.id})}}));return i}createPickupSchema(e,i,t){const a=Boolean(t?.allowRemoval);const o=e=>{if(typeof e==="number"){return e}if(typeof e==="string"&&e.trim()!==""){const i=Number(e);return Number.isNaN(i)?e:i}return e};const n=U.string().min(1,{message:"Arrival date is required."}).regex(/^\d{4}-\d{2}-\d{2}$/,{message:"Invalid date format, expected YYYY-MM-DD."});return U.object({location:U.preprocess(o,U.number().int()).refine((e=>a?e===-1||e>0:e>0),{message:"Please select a pickup option."}),arrival_date:U.preprocess((e=>typeof e==="string"?e:e??""),n).refine((t=>{const a=r(t,"YYYY-MM-DD",true);const o=r(e,"YYYY-MM-DD",true);const n=r(i,"YYYY-MM-DD",true);return a.isValid()&&o.isValid()&&n.isValid()&&a.isBetween(o,n,undefined,"[]")}),{message:`Arrival date must be between ${e} and ${i}.`}),arrival_time:U.string().regex(/^\d{2}:\d{2}$/,{message:"Invalid time format. Expected HH:MM"}).refine((e=>{const[i,t]=e.split(":").map(Number);return i>=0&&i<=23&&t>=0&&t<=59}),{message:"Time values are out of range"}),flight_details:U.preprocess((e=>typeof e==="string"?e:""),U.string().nonempty({message:"Flight details cannot be empty."})),vehicle_type_code:U.preprocess((e=>typeof e==="string"?e:""),U.string().nonempty({message:"Vehicle type code cannot be empty."})),number_of_vehicles:U.preprocess(o,U.number().int().min(1,{message:"At least one vehicle is required."}))})}validateForm(e,i){return i.safeParse(e)}getNumberOfVehicles(e,i){let t=Math.ceil(i/e);let a=t>1?t:1;let o=t>1?2:3;return Array.from({length:t+o},((e,i)=>a+i))}getPickUpPersonStatus(e){const i=m.pickup_service.allowed_pricing_models.find((i=>i.code===e));if(!i){return null}return i.description}updateDue(e){const i=this.getPickUpPersonStatus(e.code);if(!i){return}if(i==="Person"){return e.amount*e.numberOfPersons}else{return e.amount*e.number_of_vehicles}}}const ct=".sc-ir-pickup-form-h{display:block}.custom-card-container.sc-ir-pickup-form{display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e4e5ec}.card-title.sc-ir-pickup-form{flex:1}.border-theme.sc-ir-pickup-form{border:1px solid #cacfe7}.pickup__container.sc-ir-pickup-form{display:flex;flex-direction:column;gap:1rem}@media (min-width: 768px){.price-input-container.sc-ir-pickup-form{max-width:290px}}";const lt=ct;const dt=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7);this.canSubmitPickupChange=t(this,"canSubmitPickupChange",7);this.loadingChange=t(this,"loadingChange",7);this.resetBookingEvt=t(this,"resetBookingEvt",7)}get el(){return n(this)}formId;defaultPickupData;numberOfPersons=0;bookingNumber;bookingDates;isLoading=false;allowedOptionsByLocation=[];pickupData={location:-1,flight_details:"",due_upon_booking:"",number_of_vehicles:1,vehicle_type_code:"",currency:undefined,arrival_time:"",arrival_date:null,selected_option:undefined};vehicleCapacity=[];autoValidate=false;closeModal;canSubmitPickupChange;loadingChange;resetBookingEvt;pickupService=new st;pickupSchema;get shouldRenderDetails(){return this.pickupData.location>0}get isRemovalRequest(){return Boolean(this.defaultPickupData&&this.pickupData.location===-1)}get canSubmitPickup(){return this.defaultPickupData!==null||this.shouldRenderDetails}lastCanSubmit=false;handleSubmitPickupChange(){const e=this.canSubmitPickup;if(e!==this.lastCanSubmit){this.lastCanSubmit=e;this.canSubmitPickupChange.emit(e)}}componentWillLoad(){if(this.defaultPickupData){const e=this.pickupService.transformDefaultPickupData(this.defaultPickupData);this.vehicleCapacity=this.pickupService.getNumberOfVehicles(e.selected_option.vehicle.capacity,this.numberOfPersons);this.allowedOptionsByLocation=m.pickup_service.allowed_options.filter((i=>i.location.id===e.location));this.pickupData={...e}}this.pickupSchema=this.pickupService.createPickupSchema(this.bookingDates.from,this.bookingDates.to,{allowRemoval:this.defaultPickupData!==null});this.lastCanSubmit=this.canSubmitPickup;this.canSubmitPickupChange.emit(this.lastCanSubmit)}handleLocationChange(e){if(e===""){this.allowedOptionsByLocation=[];this.vehicleCapacity=[];this.updatePickupData("location",-1);return}const i=Number(e);this.allowedOptionsByLocation=m.pickup_service.allowed_options.filter((e=>e.location.id===i));const t=this.allowedOptionsByLocation[0];if(!t){this.vehicleCapacity=[];this.pickupData={...this.pickupData,location:i,selected_option:undefined,vehicle_type_code:"",number_of_vehicles:1,due_upon_booking:"",currency:undefined};return}this.vehicleCapacity=this.pickupService.getNumberOfVehicles(t.vehicle.capacity,this.numberOfPersons);const a=this.computeDueAmount(t,this.vehicleCapacity[0]);this.pickupData={...this.pickupData,location:i,selected_option:t,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:a,vehicle_type_code:t.vehicle.code,currency:t.currency}}handleVehicleQuantityChange(e){if(!e||Number.isNaN(e)||!this.pickupData.selected_option){return}const i=this.computeDueAmount(this.pickupData.selected_option,e);this.pickupData={...this.pickupData,number_of_vehicles:e,due_upon_booking:i}}handleVehicleTypeChange(e){if(!e||this.pickupData.location<=0){return}const i=m.pickup_service.allowed_options.find((i=>i.location.id===this.pickupData.location&&i.vehicle.code===e));if(!i){return}this.vehicleCapacity=this.pickupService.getNumberOfVehicles(i.vehicle.capacity,this.numberOfPersons);const t=this.computeDueAmount(i,this.vehicleCapacity[0]);this.pickupData={...this.pickupData,selected_option:i,number_of_vehicles:this.vehicleCapacity[0],due_upon_booking:t,vehicle_type_code:i.vehicle.code,currency:i.currency}}computeDueAmount(e,i){const t=this.pickupService.updateDue({amount:e.amount,code:e.pricing_model.code,numberOfPersons:this.numberOfPersons,number_of_vehicles:i});return(t??0).toFixed(2)}updatePickupData(e,i){this.pickupData={...this.pickupData,[e]:i}}async savePickup(){if(!this.canSubmitPickup){return}try{this.isLoading=true;this.loadingChange.emit(this.isLoading);const e=this.isRemovalRequest;if(!e){this.autoValidate=true;const e=this.pickupService.validateForm(this.pickupData,this.pickupSchema);if(!e.success){return}}await this.pickupService.savePickup(this.pickupData,this.bookingNumber,e);this.resetBookingEvt.emit(null);this.closeModal.emit(null)}catch(e){console.error(e)}finally{this.isLoading=false;this.loadingChange.emit(this.isLoading)}}render(){return e("form",{key:"5f9d66e5b4b64f3ad6352c29e66f75a4bfef7536",id:this.formId,class:"pickup__container",onSubmit:async e=>{e.preventDefault();await this.savePickup()}},e("ir-validator",{key:"fcd8fc140bc28d023f93918d4e6687f55393abfa",schema:this.pickupSchema.shape.location,autovalidate:this.autoValidate,value:this.pickupData.location,valueEvent:"change wa-change select-change",blurEvent:"wa-hide blur"},e("wa-select",{key:"950b45c4aa61c25efa2cf2ce0bbd5ca0599071dd",size:"small",onchange:e=>this.handleLocationChange(e.target.value),defaultValue:this.pickupData.location===-1?"":this.pickupData.location?.toString(),value:this.pickupData.location===-1?"":this.pickupData.location?.toString()},e("wa-option",{key:"d8e860958e613960ad7891c17b4a25eed9986ab2",value:""},b.entries.Lcz_Pickup_NoThankYou),this.pickupService.getAvailableLocations(b.entries.Lcz_Pickup_YesFrom).map((i=>e("wa-option",{key:`pickup-location-${i.value}`,value:i.value?.toString()},i.text))))),this.shouldRenderDetails&&e("div",{key:"4b919cdf9dea23258f72d3ac1c35e927d37ec1d7",class:"pickup__container","data-testid":"pickup_body"},e("ir-validator",{key:"714fb4a5930dc0ebdf28846cf0e224678b65c05d",schema:this.pickupSchema.shape.arrival_date,autovalidate:this.autoValidate,value:this.pickupData.arrival_date??"",valueEvent:"dateChanged",blurEvent:"datePickerBlur blur"},e("ir-custom-date-picker",{key:"8ffcabfa119922a129f30d26dfe81218e7848eae",date:this.pickupData.arrival_date,minDate:this.bookingDates.from,maxDate:this.bookingDates?.to,emitEmptyDate:true,onDateChanged:e=>{this.updatePickupData("arrival_date",e.detail.start?.format("YYYY-MM-DD")??null)},label:b.entries.Lcz_ArrivalDate})),e("ir-validator",{key:"748249c982027c3fca3f1637f4bd7517f27a868b",schema:this.pickupSchema.shape.arrival_time,autovalidate:this.autoValidate,value:this.pickupData.arrival_time,valueEvent:"text-change input input-change",blurEvent:"input-blur blur"},e("ir-input",{key:"5e21f2712bd0ee246acb08f91e2897f5afcc5d7d",value:this.pickupData.arrival_time,"onText-change":e=>{this.updatePickupData("arrival_time",e.detail)},mask:"time",label:b.entries.Lcz_Time})),e("ir-validator",{key:"b2024d5a4c72edbd97a4d93171f8c8f483e6a210",schema:this.pickupSchema.shape.flight_details,autovalidate:this.autoValidate,value:this.pickupData.flight_details,valueEvent:"text-change input input-change",blurEvent:"input-blur blur"},e("ir-input",{key:"a3f07b47d919e0c9a807ec3cc60df5d3ae63d066","onText-change":e=>this.updatePickupData("flight_details",e.detail),value:this.pickupData.flight_details,label:b.entries.Lcz_FlightDetails})),e("ir-validator",{key:"585c7f2abc606bade55e175541952b6776ddb2c1",schema:this.pickupSchema.shape.vehicle_type_code,autovalidate:this.autoValidate,value:this.pickupData.vehicle_type_code,valueEvent:"change wa-change select-change",blurEvent:"wa-hide blur"},e("wa-select",{key:"6c06626f340e092b6ad1571c14d889bc08767979",size:"small",onchange:e=>this.handleVehicleTypeChange(e.target.value),value:this.pickupData.vehicle_type_code,defaultValue:this.pickupData.vehicle_type_code},this.allowedOptionsByLocation.map((i=>e("wa-option",{value:i.vehicle.code,key:i.vehicle.code},i.vehicle.description))))),e("ir-validator",{key:"48ca976554f00f5887adbd11c8e71539037383ab",schema:this.pickupSchema.shape.number_of_vehicles,autovalidate:this.autoValidate,value:this.pickupData.number_of_vehicles,valueEvent:"change wa-change select-change",blurEvent:"wa-hide blur"},e("wa-select",{key:"03687be00adc497b4708a50999fff0682b7f0f5d",size:"small",defaultValue:this.pickupData.number_of_vehicles?.toString(),value:this.pickupData.number_of_vehicles?.toString(),label:b.entries.Lcz_NbrOfVehicles,onchange:e=>{this.handleVehicleQuantityChange(Number(e.target.value))}},this.vehicleCapacity.map((i=>e("wa-option",{key:`capacity_${i}`,value:i.toString()},i))))),e("ir-input",{key:"6a2b4edc2952a61c9b1bbcae15092d0969b8d344",mask:"price",readonly:true,label:`${b.entries.Lcz_DueUponBooking}`,value:this.pickupData.due_upon_booking},e("span",{key:"87571bd4eca8dd601a00f4e103494171d0807b84",slot:"start"},this.pickupData.currency?.symbol))))}static get watchers(){return{defaultPickupData:["handleSubmitPickupChange"],pickupData:["handleSubmitPickupChange"]}}};dt.style=lt;const ht=".sc-ir-pickup-view-h{display:block}.pickup-info.sc-ir-pickup-view{display:flex;flex-direction:column;gap:0.75rem}.pickup-info__summary.sc-ir-pickup-view{display:flex;flex-wrap:wrap;gap:0.5rem;justify-content:space-between;align-items:center;color:#1f2a37}.pickup-info__datetime.sc-ir-pickup-view{font-weight:600;margin:0}.pickup-info__due.sc-ir-pickup-view{margin:0;color:#1f2a37}.pickup-info__details.sc-ir-pickup-view{display:flex;flex-direction:column;gap:0.3rem;color:#1f2a37}.pickup-info__line.sc-ir-pickup-view{margin:0;display:flex;flex-wrap:wrap;gap:0.25rem}.pickup-info__label.sc-ir-pickup-view{font-weight:600}.pickup-info__divider.sc-ir-pickup-view{opacity:0.4}.pickup-info__note.sc-ir-pickup-view{margin:0;color:#6b7280;font-size:0.875rem}@media (max-width: 600px){.pickup-info__summary.sc-ir-pickup-view{flex-direction:column;align-items:flex-start}}";const pt=ht;const mt=class{constructor(e){i(this,e)}booking;render(){if(!m.pickup_service.is_enabled||!this.booking.is_editable){return null}return e(a,null,e("wa-card",null,e("p",{slot:"header",class:"font-size-large p-0 m-0 "},b.entries.Lcz_Pickup),e("wa-tooltip",{for:"pickup"},this.booking.pickup_info?"Edit":"Add"," pickup"),e("ir-custom-button",{slot:"header-actions",id:"pickup",size:"small",appearance:"plain",variant:"neutral"},e("wa-icon",{name:"edit",style:{fontSize:"1rem"}})),this.booking.pickup_info?e("div",{class:"pickup-info"},e("div",{class:"pickup-info__summary"},e("div",null,e("p",{class:"pickup-info__datetime"},r(this.booking.pickup_info.date,"YYYY-MM-DD").format("MMM DD, YYYY"),this.booking.pickup_info.hour&&this.booking.pickup_info.minute&&e("span",null,"  ",Z(this.booking.pickup_info.hour.toString(),this.booking.pickup_info.minute.toString())))),e("p",{class:"pickup-info__due"},e("strong",null,this.booking.pickup_info.currency.symbol,this.booking.pickup_info.total))),e("div",{class:"pickup-info__details"},e("ir-label",{display:"inline",labelText:`${b.entries.Lcz_FlightDetails}:`,content:this.booking.pickup_info.details}),e("p",{class:"pickup-info__line"},e("span",{class:"pickup-info__label"},"Vehicle:"),e("span",null,this.booking.pickup_info.selected_option.vehicle.description)),e("p",{class:"pickup-info__line"},e("span",{class:"pickup-info__label"},b.entries.Lcz_NbrOfVehicles,":"),e("strong",null,this.booking.pickup_info.nbr_of_units))),e("p",{class:"pickup-info__note"},m.pickup_service.pickup_instruction.description,m.pickup_service.pickup_cancelation_prepayment.description)):e("ir-empty-state",null)))}};mt.style=pt;const ft=".sc-ir-pms-logs-h{display:block}.dialog-container-height.sc-ir-pms-logs{height:4rem}.list-title.sc-ir-pms-logs{margin:0;padding:0;font-weight:600;white-space:nowrap;display:inline}.list-item.sc-ir-pms-logs{margin:0;padding:0;font-size:14px;margin-left:5px;width:fit-content}.list-item.green.sc-ir-pms-logs{color:#629a4c;font-weight:600}.list-item.red.sc-ir-pms-logs{color:#ff4961;font-weight:600}";const bt=ft;const ut=class{constructor(e){i(this,e)}bookingNumber;pmsLogs;error;bookingService=new u;userTypeCode;componentWillLoad(){this.init();const e=JSON.parse(localStorage.getItem("UserInfo_b"));if(e){this.userTypeCode=e.USER_TYPE_CODE}}async init(){try{this.pmsLogs=await this.bookingService.fetchPMSLogs(this.bookingNumber)}catch(e){console.error(e)}}render(){return e("div",{key:"9b03ef8b11c5e47bb85ce4f3f819898082f8aa7a",class:""},O("/Get_Exposed_PMS_Logs")?e("div",{class:"d-flex align-items-center justify-content-center dialog-container-height"},e("ir-spinner",null)):e("div",{class:"dialog-container-height"},e("div",{class:"d-flex align-items-center ",style:{paddingBottom:"0.5rem"}},e("p",{class:"list-title p-0 m-0"},b.entries.Lcz_SentAt,":"),this.pmsLogs?.sent_date?e("p",{class:"list-item"},this.pmsLogs?.sent_date," ",Z(this.pmsLogs?.sent_hour.toString(),this.pmsLogs?.sent_minute.toString())):e("p",{class:`list-item ${this.pmsLogs?.sent_date?"green":"red"}`},this.pmsLogs?.is_acknowledged?b.entries.Lcz_YES:b.entries.Lcz_NO)),e("div",{class:"d-flex align-items-center p-0 m-0"},e("p",{class:"list-title p-0 m-0"},b.entries.Lcz_Acknowledged),e("div",{class:"d-flex align-items-center",style:{gap:"1rem"}},e("p",{class:`list-item  ${this.pmsLogs?.is_acknowledged?"green":"red"}`},this.pmsLogs?.is_acknowledged?b.entries.Lcz_YES:b.entries.Lcz_NO),!this.pmsLogs?.is_acknowledged&&this.pmsLogs?.revision_id&&this.userTypeCode==="1"&&e("ir-custom-button",{variant:"brand",loading:O("/Ack_Exposed_Revision"),onClickHandler:async e=>{e.stopImmediatePropagation();e.stopPropagation();const i=await this.bookingService.ackExposedRevision({revision_id:this.pmsLogs?.revision_id});this.error=i.ExceptionMsg}},"Acknowledge"))),this.error&&e("wa-callout",{size:"small",appearance:"filled-outlined",variant:"danger"},this.error)))}};ut.style=bt;const gt=":host{display:block;width:100%}*{box-sizing:border-box}.popover-trigger{all:unset;cursor:pointer}.popover-trigger:hover,.popover-trigger:focus{color:#000}";const _t=gt;const yt=class{constructor(e){i(this,e)}get el(){return n(this)}content;irPopoverLeft="10px";placement="auto";trigger="focus";renderContentAsHtml=false;initialized=false;popoverTrigger;componentDidLoad(){if(this.initialized){return}this.initializePopover()}initializePopover(){$(this.popoverTrigger).popover({trigger:this.trigger,content:this.content,placement:this.placement,html:this.renderContentAsHtml});this.initialized=true}disconnectedCallback(){$(this.popoverTrigger).popover("dispose")}render(){return e(a,{key:"2fc08c0fd1a9c2e8520225b2cd6ca0f09ce4076c",style:{"--ir-popover-left":this.irPopoverLeft}},this.trigger!=="focus"?e("p",{ref:e=>this.popoverTrigger=e,class:"popover-title m-0 p-0",style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer"}},e("slot",null)):e("button",{tabindex:"0",class:"popover-trigger",ref:e=>this.popoverTrigger=e},e("slot",null)))}};yt.style=_t;const kt=":host{display:block}.ir-fullscreen-dialog::part(dialog){width:100vw;height:100vh;max-width:none;max-height:none;margin:0;border-radius:0}@media print{@page {size:A4;margin:0}html,body{margin:0;padding:0;height:auto}.ir-fullscreen-dialog::part(dialog){position:static !important;width:auto !important;height:auto !important;max-height:none !important;overflow:visible !important;transform:none !important}.ir-fullscreen-dialog::part(header){display:none !important}body *{visibility:hidden}.ir-fullscreen-dialog,.ir-fullscreen-dialog *{visibility:visible}.ir-fullscreen-dialog{position:absolute;top:0;left:0;width:100%}}";const vt=kt;const wt=class{constructor(e){i(this,e);this.previewAction=t(this,"previewAction",7);this.openChanged=t(this,"openChanged",7)}get el(){return n(this)}actionIconByType={print:"file-pdf",download:"download"};printContainer;printPlaceholder;isPrintLayoutActive=false;handleBeforePrint=()=>{if(!this.open){return}this.preparePrintLayout()};handleAfterPrint=()=>{this.restorePrintLayout()};label="Preview";open=false;action="print";downloadUrl;downloadFileName;hideDefaultAction=false;actionButtonLabel;previewAction;openChanged;_id=`download_btn_${A()}`;async openDialog(){this.open=true}async closeDialog(){this.open=false}async triggerAction(e=this.action,i,t){const a=i??this.downloadUrl;const o=t??this.downloadFileName;let n=false;if(e==="print"){n=this.runPrintAction()}else{n=this.runDownloadAction(a,o)}this.previewAction.emit({action:e,url:a});return n}runPrintAction(){if(typeof window==="undefined"||typeof window.print!=="function"){console.warn("[ir-preview-screen-dialog] window.print is not available in this environment.");return false}this.preparePrintLayout();try{window.print()}finally{this.restorePrintLayout()}return true}runDownloadAction(e,i){if(!e){console.warn("[ir-preview-screen-dialog] No download URL was provided.");return false}if(typeof document==="undefined"){console.warn("[ir-preview-screen-dialog] document is not available in this environment.");return false}const t=document.createElement("a");t.href=e;if(i){t.download=i}t.target="_blank";t.rel="noopener";t.style.display="none";const a=document.body||document.documentElement;a?.appendChild(t);t.click();t.remove();return true}getActionLabel(){if(this.actionButtonLabel){return this.actionButtonLabel}return this.action==="print"?"Print preview":"Download preview"}shouldDisableActionButton(){return this.action==="download"&&!this.downloadUrl}handleActionButtonClick(){this.triggerAction()}preparePrintLayout(){if(typeof document==="undefined"||this.printContainer||this.isPrintLayoutActive){return}const e=Array.from(this.el.children).filter((e=>!e.hasAttribute("slot")));if(!e.length){return}const i=document.createComment("ir-preview-print-placeholder");this.el.insertBefore(i,e[0]);const t=document.createElement("div");t.className="ir-preview-print-container";e.forEach((e=>{t.appendChild(e)}));document.body.appendChild(t);document.body.classList.add("ir-preview-dialog-print-mode");this.printPlaceholder=i;this.printContainer=t;this.isPrintLayoutActive=true}restorePrintLayout(){if(!this.printContainer||!this.printPlaceholder||typeof document==="undefined"){return}const e=this.printPlaceholder.parentNode;if(e){while(this.printContainer.firstChild){e.insertBefore(this.printContainer.firstChild,this.printPlaceholder)}}this.printPlaceholder.remove();this.printContainer.remove();document.body.classList.remove("ir-preview-dialog-print-mode");this.printPlaceholder=undefined;this.printContainer=undefined;this.isPrintLayoutActive=false}componentDidLoad(){if(typeof window==="undefined"){return}window.addEventListener("beforeprint",this.handleBeforePrint);window.addEventListener("afterprint",this.handleAfterPrint)}disconnectedCallback(){if(typeof window!=="undefined"){window.removeEventListener("beforeprint",this.handleBeforePrint);window.removeEventListener("afterprint",this.handleAfterPrint)}this.restorePrintLayout()}render(){return e("ir-dialog",{key:"076043dd35f86c8b5440c7a5a032b5b39f23d42f",onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.openChanged.emit(false)},label:this.label,open:this.open,class:"ir-fullscreen-dialog"},!this.hideDefaultAction&&e(o,{key:"a36d3a606b897b347c10b7f8cc0aa14b1ca813be"},e("wa-tooltip",{key:"e2b6899b05c17c945b5e83222b7820483f99bc91",for:this._id},"Print PDF"),e("ir-custom-button",{key:"fae8071680a6ed31e14a7951063595d794def46b",id:this._id,size:"medium",slot:"header-actions",variant:"neutral",appearance:"plain",onClickHandler:this.handleActionButtonClick.bind(this),disabled:this.shouldDisableActionButton()},e("wa-icon",{key:"aa8c5f84272846b461986aa7b392dd79431d024d",name:this.actionIconByType[this.action],label:this.getActionLabel(),"aria-label":this.getActionLabel()}))),e("slot",{key:"d2a1f7040bb955f76adf5476953a379d1a383c8b"}))}};wt.style=vt;const xt=":host{box-sizing:border-box !important}:host *,:host *::before,:host *::after{box-sizing:inherit !important;padding:0;margin:0}[hidden]{display:none !important}:host{display:block;}.ir-print-room__header{display:flex;align-items:center;gap:0.625rem;font-weight:bold;font-size:1rem;line-height:1.5rem;margin-bottom:0.375rem}.ir-print-room__body{display:flex;align-items:center;gap:0.625rem;flex-wrap:wrap}.ir-print-room__details{flex:1 1 0%}.ir-print-room__row{display:flex;align-items:center;gap:1rem}.ir-print-room__daily-amounts{display:flex}.room_amount{min-width:4.38rem}.room_amount_container{display:flex;font-weight:600;flex-direction:column}.room_amount{min-width:4.38rem}.room_amount_day{padding:0.31rem}.room_amount_day.amount{font-weight:700;text-transform:capitalize}.room_amount_day.rate{font-weight:700;color:rgb(51, 51, 51)}.room_amount_empty{color:white;pointer-events:none;user-select:none;-webkit-user-drag:none;display:none}.room_amount_rate{display:none;color:#333;font-size:1rem;font-weight:bold}.room_amount_main_container{display:flex;flex-wrap:wrap;}.room_amount.date{color:#1f2937;background:#f3f4f6}.room_amount.amount{margin-bottom:0.5rem}.ir-print-room__daily-amounts--with-divider{padding-bottom:1rem}p,div,section,span{margin:0;padding:0;box-sizing:border-box}body{display:block;font-size:0.88rem;font-weight:600;box-sizing:border-box}.main-container{max-width:56.25rem;margin-left:auto;margin-right:auto;}.label-title{padding:0;margin:0;color:rgb(51, 51, 51);font-weight:700}.label-value{padding-left:0.25rem;color:rgb(102, 102, 102);font-weight:600}.booking-details,.pickup-container{padding:0.94rem 0;border-top:1px solid rgb(128, 128, 128);border-bottom:1px solid rgb(128, 128, 128)}.accommodation-summary{display:flex;align-items:center;justify-content:space-between;padding:0.94rem 0;flex-wrap:wrap;gap:0.62rem}.booking-dates{color:rgb(51, 51, 51);font-weight:700;padding:0;margin:0}.roomtype-title td{padding-top:1.56rem;padding-right:0.62rem}.policies{font-size:0.88rem}.policies-container{padding:0.62rem 0.06rem 0.94rem 0.06rem}.policies{padding-inline:0.06rem}.room_amount_day{padding:0.31rem}.room_amount_day.amount{font-weight:700;text-transform:capitalize}.room_amount_day.rate{font-weight:700;color:rgb(51, 51, 51)}.pricing-summary{text-align:end;padding-left:0.62rem;padding-bottom:0.94rem}.room_amount.date{color:#1f2937;background:#f3f4f6}.room_amount.amount{margin-bottom:0.5rem}.pricing-breakdown{display:flex;align-items:center;justify-content:flex-end;flex-wrap:wrap;gap:0.25rem}.property_name,.booked_on_date,.invoice_reference{color:rgb(51, 51, 51);font-size:0.88rem;font-weight:700}.booking-number{font-size:1.25rem;font-weight:600}.header{display:flex;justify-content:space-between;padding-bottom:0.94rem}.booked_on_date{font-weight:600}.reservation-details{display:flex;align-items:center;justify-content:flex-end}.origin-icon{height:2.5rem;width:2.5rem}.invoice_reference{text-align:end}.billing_header{color:#333;box-sizing:border-box;font-size:1rem}.billing_cell{text-align:left}.billing_table{padding:0.62rem 0}.billing_table caption{text-align:start;font-size:1.12rem;padding:0.62rem 0rem 0.94rem}.pickup-details{display:flex;align-items:center;flex-wrap:wrap}.pickup_title{font-size:1.12rem;padding:0rem 0 0.94rem 0}.car_name{color:#333;font-weight:bold;padding-right:0.62rem}.pickup-details .label-title{padding-right:0.62rem}.billing_reference{width:2.5rem}.room_amount_container{display:flex;flex-direction:column}.room_amount{min-width:4.38rem}.room_amount_empty{color:white;pointer-events:none;user-select:none;-webkit-user-drag:none;display:none}.room_amount_rate{display:none;color:#333;font-size:1rem;font-weight:bold}.room_amount_main_container{display:flex;flex-wrap:wrap;}.ir-print-room__tax-row{display:flex;font-size:0.875rem;font-weight:700}.ir-print-room__totals{display:flex;gap:0.25rem;flex-direction:column}.ir-print-room__header{font-size:1.1rem}.ir-print-room__dates{display:flex;align-items:center;gap:0.5rem;font-weight:600}.ir-print-room__body{flex-direction:column}.ir-print-room__body{align-items:flex-start;margin-top:1rem}@media (min-width: 640px){.ir-print-room__totals{align-items:flex-end}.room_amount_container{flex-direction:column}.ir-print-room__body{flex-direction:row}.billing_header,.billing_cell{padding:0.62rem}.billing_reference{width:auto}.room_amount_empty{display:block}.room_amount_rate{display:block}}";const Dt=xt;const Yt=class{constructor(e){i(this,e)}room;booking;property;currency;idx;getSmokingLabel(){const{booking:e,room:i,property:t}=this;if(e?.is_direct){if(!i?.smoking_option)return null;const e=t?.roomtypes?.find((e=>e.id===i?.roomtype?.id));const a=e?.smoking_option?.allowed_smoking_options;return a?.find((e=>e.code===i.smoking_option))?.description??null}return i?.ota_meta?.smoking_preferences??null}formatDate(e){const i=r(e,"YYYY-MM-DD");const t=i.format("DD/MM");let a=i.format("ddd");if(["Thu","Sun","Sat"].includes(a)){a=a.slice(0,2)}else{a=a.charAt(0)}return`${t} ${a}`}formatGuestName({first_name:e,last_name:i}){if(!i){return e}return`${e} ${i}`}formatGuestAvailability({adult_nbr:e,children_nbr:i,infant_nbr:t}){const a=e>0?e:0;const o=i>0?i:0;const n=t>0?t:0;const r=a>1?"adults":"adult";const s=o>1?"children":"child";const c=n>1?"infants":"infant";const l=[];if(a>0){l.push(`${a} ${r}`)}if(o>0){l.push(`${o} ${s}`)}if(n>0){l.push(`${n} ${c}`)}return l.join("&nbsp&nbsp&nbsp&nbsp")}formatBookingDates(e){return r(e,"YYYY-MM-DD").format("DD-MMM-YYYY")}renderTaxSection(){if(!this.booking?.is_direct){const i=this.room.ota_taxes.filter((e=>e.amount>0));return i.map(((i,t)=>e("div",{key:`room_${i.name}_${t}`,class:"ir-print-room__tax-row"},e("p",{class:"ir-print-room__tax-label"},i.is_exlusive?"Excluding":"Including"," ",i.name),e("p",{class:"ir-print-room__tax-amount"},i.currency.symbol,i.amount))))}const i=this.property?.taxes?.filter((e=>e.pct>0&&e.is_exlusive));return e(o,null,i?.map(((i,t)=>{const a=this.room.total*i.pct/100;return e("div",{key:`direct_room_${i.name}_${t}`,class:"ir-print-room__tax-row"},e("p",{class:"ir-print-room__tax-label"},i.is_exlusive?"Excluding":"Including"," ",i.name),e("p",{class:"ir-print-room__tax-amount"},i.pct,"%: ",s(this.currency,a)))})),this.room.inclusive_taxes?.CALCULATED_INCLUSIVE_TAXES?.map(((i,t)=>e("div",{key:`direct_room_${i.TAX_NAME}_${t}`,class:"ir-print-room__tax-row"},e("p",{class:"ir-print-room__tax-label"},"Including ",i.TAX_NAME),e("p",{class:"ir-print-room__tax-amount"},i.TAX_PCT*100,"%: ",s(this.currency,i.CALCULATED_VALUE))))))}render(){const{room:i,booking:t,property:a,currency:o,idx:n}=this;const r=a.roomtypes?.find((e=>e.id===i?.roomtype?.id))?.physicalrooms?.length>1;return e("section",{key:"c34f14cd9821dee04d0ce53bf9c4aa1fa525c6a2",class:"ir-print-room"},e("header",{key:"55747e4ae7cd16e2467908080baf1415632f4b3e",class:"ir-print-room__header"},e("p",{key:"42a4ced89a144bc076a51985c425cc3a5a791436",class:"ir-print-room__room-type"},i?.roomtype?.name),r&&i?.unit&&e("p",{key:"2317833720d7be2c0c014c9cc328406132cc176a",class:"ir-print-room__unit"},"(unit ",i.roomtype.id,")"),e("p",{key:"ff70a391674c1c31ab18d814466d618d5e86126b",class:"ir-print-room__rate-plan"},i?.rateplan?.short_name||i?.rateplan?.name)),e("div",{key:"856289e8ada911422eebcefae0ac0744dfb416e7",class:"ir-print-room__body"},e("div",{key:"88539b1db7a6e88bbd1942d728d68b98ffdbc36a",class:"ir-print-room__details"},e("div",{key:"2c8da3535d5e4b3038f462500376fb5b5dbf7a74",class:"ir-print-room__row"},e("ir-printing-label",{key:"cbb418db20379287810fb41784b01a42a99f7acc",label:"Guest Name:",content:this.formatGuestName(i?.sharing_persons?.find((e=>e.is_main))??i?.guest)}),e("ir-printing-label",{key:"4dc8f30e250e568a42cf4adc3346783fa8ca0f48","as-html":true,content:this.formatGuestAvailability(i?.occupancy)})),e("div",{key:"5a2d0522b26c09e4c7e74243b3f32fd6555a3c02",class:"ir-print-room__row"},e("div",{key:"0fb5941e943fee7b4a8d9255c11e31002abd8682",class:"ir-print-room__dates"},this.formatBookingDates(i?.from_date),e("span",{key:"16f2b6badb24be08f062e9fd5784a26a0424dc78",class:"ir-print-room__date-separator"},""),this.formatBookingDates(i?.to_date)),i?.departure_time?.description&&e("p",{key:"6371ec3e305066d863b7e0838d3f22527f568e61",class:"ir-print-room__departure-time"},"(Expected departure time: ",i.departure_time.description,")")),e("ir-printing-label",{key:"181238d39d065cc1f81ceb5f2a4bd4622e521bff",label:"Smoking options:",display:"inline",content:this.getSmokingLabel()}),t?.is_direct&&e("div",{key:"169071b0d1e691ef22d75786cef17f148eac0a53",class:"ir-print-room__policies"},e("ir-printing-label",{key:"df4653446a3abce73f3469efb5424e26b77408f4",label:"Cancellation:",display:"inline",asHtml:true,content:i?.rateplan?.cancelation?.replace("<u>","")?.replace("</u>","")?.replace("<b>",'<b style="font-weight:bold">')}),e("ir-printing-label",{key:"f198645a9b0ef682c5b85fd73605506ba4937d73",label:"Guarantee:",display:"inline",asHtml:true,content:(i?.rateplan?.guarantee??"")?.replace("<u>","")?.replace("</u>","")?.replace("<b>",'<b style="font-weight:bold">')}))),e("aside",{key:"393c3453aad67563f88510aa4ad39d8e757b7148",class:"ir-print-room__totals"},e("ir-printing-label",{key:"696fe618e2c6ca86f05158e1df96f247adf2c5ff",label:"Total:",content:s(o,i?.total)}),this.renderTaxSection(),e("ir-printing-label",{key:"7a5a3f1caad550da7c61fa608e9d4e5efbe844ce",label:"Grand total:",content:s(o,i?.gross_total)}),t?.is_direct&&e("ir-printing-label",{key:"b50b1304db2e0460e732b9ce8c4a573d7c4ef6a2",label:"Due upon booking:",content:s(o,Number(i?.gross_guarantee))}))),e("div",{key:"e411b97ded5814e8b4f58aad3373705fbeb8593c",class:{"ir-print-room__daily-amounts":true,"ir-print-room__daily-amounts--with-divider":n<t?.rooms?.length-1}},i?.days?.map((i=>e("div",{class:"room_amount_container",key:i.date},e("p",{class:"room_amount date"},this.formatDate(i.date)),e("p",{class:"room_amount amount",style:{paddingRight:"0.375rem"}},s(o,i.amount)))))))}};Yt.style=Dt;const Mt=":host{box-sizing:border-box !important}:host *,:host *::before,:host *::after{box-sizing:inherit !important;padding:0;margin:0}[hidden]{display:none !important}:host{display:block}.ir-print-extra-services{padding:1rem 0;border-top:1px solid #d1d5db}.ir-print-extra-services__title{font-weight:600;font-size:1.125rem ;line-height:1.75rem ;color:#111827;margin-bottom:0.625rem}.ir-print-extra-services__list{display:flex;flex-direction:column;gap:0.75rem}.ir-print-extra-services__item{display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap}.ir-print-extra-services__details{display:flex;flex-direction:column;gap:0.25rem;max-width:80%}.ir-print-extra-services__description{word-break:break-word}.ir-print-extra-services__dates{font-size:0.75rem;color:#374151}.ir-print-extra-services__date-wrapper{display:inline-flex;align-items:center;gap:0.25rem}.ir-print-extra-services__date{white-space:nowrap}.ir-print-extra-services__date-separator{margin:0 0.25rem}.ir-print-extra-services__date::part(content){font-size:0.875rem}.ir-print-extra-services__price{font-weight:700;white-space:nowrap}";const Ct=Mt;const It=class{constructor(e){i(this,e)}extraServices;currency;invocableKeys;render(){return e("section",{key:"034d801088b006b7969e470026a16e4fc1495150",class:"ir-print-extra-services"},e("h3",{key:"251cb8f0ad9074ab69c783634ac90ed42dc9766e",class:"ir-print-extra-services__title"},"Extra services"),e("div",{key:"81fb4b591f08aab80108757c70c9660ac73658b7",class:"ir-print-extra-services__list"},this.extraServices?.map((i=>{if(!this.invocableKeys.has(i.system_id)){return null}return e("div",{key:`service_${i.system_id}`,class:"ir-print-extra-services__item"},e("div",{class:"ir-print-extra-services__details"},e("ir-printing-label",{display:"inline",label:"",class:"ir-print-extra-services__description",content:i.description}),(i.start_date||i.end_date)&&e("div",{class:"ir-print-extra-services__dates"},e("span",{class:"ir-print-extra-services__date-wrapper"},"(",i.start_date&&e("ir-printing-label",{class:"ir-print-extra-services__date",label:"",content:r(i.start_date).format("dddd, DD MMM YYYY")}),i.end_date&&e(o,null,e("span",{class:"ir-print-extra-services__date-separator"},""),e("ir-printing-label",{class:"ir-print-extra-services__date",label:"",content:r(i.end_date).format("dddd, DD MMM YYYY")})),")"))),e("div",{class:"ir-print-extra-services__price"},s(this.currency?.symbol,i?.price||0)))}))))}};It.style=Ct;const St=":host{box-sizing:border-box !important}:host *,:host *::before,:host *::after{box-sizing:inherit !important;padding:0;margin:0}[hidden]{display:none !important}.main-container{max-width:56.25rem;margin-left:auto;margin-right:auto;}.label-title{padding:0;margin:0;color:rgb(51, 51, 51);font-weight:700}.label-value{padding-left:0.25rem;color:rgb(102, 102, 102);font-weight:600}.booking-details,.pickup-container{padding:0.94rem 0;border-top:1px solid rgb(128, 128, 128);border-bottom:1px solid rgb(128, 128, 128)}.accommodation-summary{display:flex;align-items:center;justify-content:space-between;padding:0.94rem 0;flex-wrap:wrap;gap:0.62rem}.booking-dates{color:rgb(51, 51, 51);font-weight:700;padding:0;margin:0}.roomtype-title td{padding-top:1.56rem;padding-right:0.62rem}.policies{font-size:0.88rem}.policies-container{padding:0.62rem 0.06rem 0.94rem 0.06rem}.policies{padding-inline:0.06rem}.room_amount_day{padding:0.31rem}.room_amount_day.amount{font-weight:700;text-transform:capitalize}.room_amount_day.rate{font-weight:700;color:rgb(51, 51, 51)}.pricing-summary{text-align:end;padding-left:0.62rem;padding-bottom:0.94rem}.room_amount.date{color:#1f2937;background:#f3f4f6}.room_amount.amount{margin-bottom:0.5rem}.pricing-breakdown{display:flex;align-items:center;justify-content:flex-end;flex-wrap:wrap;gap:0.25rem}.property_name,.booked_on_date,.invoice_reference{color:rgb(51, 51, 51);font-size:0.88rem;font-weight:700}.booking-number{font-size:1.25rem;font-weight:600}.header{display:flex;justify-content:space-between;padding-bottom:0.94rem}.booked_on_date{font-weight:600}.reservation-details{display:flex;align-items:center;justify-content:flex-end}.origin-icon{height:2.5rem;width:2.5rem}.invoice_reference{text-align:end}.billing_header{color:#333;box-sizing:border-box;font-size:1rem}.billing_cell{text-align:left}.billing_table{padding:0.62rem 0}.billing_table caption{text-align:start;font-size:1.12rem;padding:0.62rem 0rem 0.94rem}.pickup-details{display:flex;align-items:center;flex-wrap:wrap}.pickup_title{font-size:1.12rem;padding:0rem 0 0.94rem 0}.car_name{color:#333;font-weight:bold;padding-right:0.62rem}.pickup-details .label-title{padding-right:0.62rem}.billing_reference{width:2.5rem}.room_amount_container{display:flex;flex-direction:column}.room_amount{min-width:4.38rem}.room_amount_empty{color:white;pointer-events:none;user-select:none;-webkit-user-drag:none;display:none}.room_amount_rate{display:none;color:#333;font-size:1rem;font-weight:bold}.room_amount_main_container{display:flex;flex-wrap:wrap;}@media only screen and (min-width: 768px){.room_amount_container{flex-direction:column}.billing_header,.billing_cell{padding:0.62rem}.billing_reference{width:auto}.room_amount_empty{display:block}.room_amount_rate{display:block}}:host{display:block}.ir-print-pickup{padding:1rem 0;border-top:1px solid #d1d5db}.ir-print-pickup__title{font-size:1.125rem;font-weight:600;color:#111827;margin-bottom:0.625rem}.ir-print-pickup__content{display:flex;flex-direction:column;gap:0.5rem}.ir-print-pickup__row{display:flex;align-items:center;flex-wrap:wrap;gap:0.75rem}.ir-print-pickup__row--secondary{margin-top:0.375rem}.ir-print-pickup__vehicle{font-weight:500;white-space:nowrap}.ir-print-pickup__vehicle-separator{margin:0 0.25rem}";const Et=St;const zt=class{constructor(e){i(this,e)}pickup;render(){if(!this.pickup){return null}return e("section",{class:"ir-print-pickup"},e("p",{class:"ir-print-pickup__title"},"Yes, from ",this.pickup.selected_option.location.description),e("div",{class:"ir-print-pickup__content"},e("div",{class:"ir-print-pickup__row"},e("ir-printing-label",{label:"Arrival date:",content:r(this.pickup.date).format("dddd, DD MMM YYYY")}),e("ir-printing-label",{label:"Arrival time:",content:Z(this.pickup.hour.toString(),this.pickup.minute.toString())}),e("ir-printing-label",{label:"Flight details:",content:this.pickup.details})),e("div",{class:"ir-print-pickup__row ir-print-pickup__row--secondary"},e("p",{class:"ir-print-pickup__vehicle"},this.pickup.selected_option.vehicle.description,e("span",{class:"ir-print-pickup__vehicle-separator"},"  "),s(this.pickup.selected_option.currency.symbol,this.pickup.selected_option.amount)),e("ir-printing-label",{label:"Number of vehicles:",content:this.pickup.nbr_of_units?.toString()}),e("ir-printing-label",{label:"Due upon booking:",content:s(this.pickup.currency.symbol,this.pickup.total)}))))}};zt.style=Et;const Bt=":host{box-sizing:border-box !important}:host *,:host *::before,:host *::after{box-sizing:inherit !important;padding:0;margin:0}[hidden]{display:none !important}.main-container{max-width:56.25rem;margin-left:auto;margin-right:auto;}.label-title{padding:0;margin:0;color:rgb(51, 51, 51);font-weight:700}.label-value{padding-left:0.25rem;color:rgb(102, 102, 102);font-weight:600}.booking-details,.pickup-container{padding:0.94rem 0;border-top:1px solid rgb(128, 128, 128);border-bottom:1px solid rgb(128, 128, 128)}.accommodation-summary{display:flex;align-items:center;justify-content:space-between;padding:0.94rem 0;flex-wrap:wrap;gap:0.62rem}.booking-dates{color:rgb(51, 51, 51);font-weight:700;padding:0;margin:0}.roomtype-title td{padding-top:1.56rem;padding-right:0.62rem}.policies{font-size:0.88rem}.policies-container{padding:0.62rem 0.06rem 0.94rem 0.06rem}.policies{padding-inline:0.06rem}.room_amount_day{padding:0.31rem}.room_amount_day.amount{font-weight:700;text-transform:capitalize}.room_amount_day.rate{font-weight:700;color:rgb(51, 51, 51)}.pricing-summary{text-align:end;padding-left:0.62rem;padding-bottom:0.94rem}.room_amount.date{color:#1f2937;background:#f3f4f6}.room_amount.amount{margin-bottom:0.5rem}.pricing-breakdown{display:flex;align-items:center;justify-content:flex-end;flex-wrap:wrap;gap:0.25rem}.property_name,.booked_on_date,.invoice_reference{color:rgb(51, 51, 51);font-size:0.88rem;font-weight:700}.booking-number{font-size:1.25rem;font-weight:600}.header{display:flex;justify-content:space-between;padding-bottom:0.94rem}.booked_on_date{font-weight:600}.reservation-details{display:flex;align-items:center;justify-content:flex-end}.origin-icon{height:2.5rem;width:2.5rem}.invoice_reference{text-align:end}.billing_header{color:#333;box-sizing:border-box;font-size:1rem}.billing_cell{text-align:left}.billing_table{padding:0.62rem 0}.billing_table caption{text-align:start;font-size:1.12rem;padding:0.62rem 0rem 0.94rem}.pickup-details{display:flex;align-items:center;flex-wrap:wrap}.pickup_title{font-size:1.12rem;padding:0rem 0 0.94rem 0}.car_name{color:#333;font-weight:bold;padding-right:0.62rem}.pickup-details .label-title{padding-right:0.62rem}.billing_reference{width:2.5rem}.room_amount_container{display:flex;flex-direction:column}.room_amount{min-width:4.38rem}.room_amount_empty{color:white;pointer-events:none;user-select:none;-webkit-user-drag:none;display:none}.room_amount_rate{display:none;color:#333;font-size:1rem;font-weight:bold}.room_amount_main_container{display:flex;flex-wrap:wrap;}@media only screen and (min-width: 768px){.room_amount_container{flex-direction:column}.billing_header,.billing_cell{padding:0.62rem}.billing_reference{width:auto}.room_amount_empty{display:block}.room_amount_rate{display:block}}:host{display:block;width:100%;color:#1b1d26;background-color:white;padding:1rem}.proforma-invoice__company-details::part(container){text-align:end;justify-content:flex-end}.invoice__layout{display:flex;justify-content:space-between}.invoice__column,.property-overview{display:flex;flex-direction:column}.invoice__column--property,.property-overview{align-items:flex-end;text-align:end}.bill-to-section,.property-overview{margin-top:0.875rem}.property-logo{height:2.5rem}.invoice{max-width:58.25rem;margin-left:auto !important;margin-right:auto !important}.proforma__accommodation-container{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:1rem;padding:1rem 0;border-top:1px solid #d1d5db}.ir-proforma-invoice__service{display:flex;align-items:flex-start;justify-content:space-between}.ir-proforma-invoice__checkbox-price{font-weight:700;white-space:nowrap}.ir-proforma-invoice__cancellation-date{font-size:0.875rem;color:#374151}.ir-proforma-invoice__cancellation-info{display:flex;flex-direction:column;gap:0.25rem;max-width:80%}.proforma__accommodation-container .proforma__accommodation-title{font-weight:600;font-size:1.125rem ;line-height:1.75rem ;color:#111827}.invoice__title{font-size:1.3rem}.invoice__layout{padding:1rem 0}.proforma-payment__section{font-size:1rem;display:flex;flex-direction:column;padding:1rem 0;gap:0.5rem;border-top:1px solid #d1d5db}@media print{.invoice{min-width:100%;height:auto;min-height:auto}.invoice,.invoice *{visibility:visible}.invoice{position:absolute;top:0;left:0;width:100%}}";const Ot=Bt;const At=class{constructor(e){i(this,e)}booking;invoice;property;invoiceInfo;locale="en";footerNote;invocableKeys;componentWillLoad(){this.invocableKeys=new Set(this.invoice?.items?.map((e=>e.key)))}handleInvoiceChange(){this.invocableKeys=new Set(this.invoice?.items?.map((e=>e.key)))}get bookingNumber(){if(!this.booking.is_direct){return`${this.booking.booking_nbr} | ${this.booking.channel_booking_nbr}`}return this.booking.booking_nbr}get CompanyLocation(){const{company:i}=this.property;const{postal:t,city:a,country:o}=i;if(!t&&!a&&!o)return null;const n=[];if(t){n.push(t)}if(a){n.push(a)}if(o){if(t||a){n.push(`,${o.name}`)}else{n.push(i.name)}}if(n.length===0){return null}return e("p",{class:"invoice-company__location"},n.join(" "))}get guestPhoneNumber(){const{country_phone_prefix:e,mobile_without_prefix:i}=this.booking.guest;if(!e){return i}return`+${e?.replace("+","")}-${i}`}formatDisplayDate(e){if(!e){return null}const i=r(e,["YYYY-MM-DD",r.ISO_8601],true);if(!i.isValid()){return null}return i.format("MMMM DD, YYYY")}get issueDate(){return this.formatDisplayDate(this.invoice?.Date)??""}renderPropertyCompanyHeader(){const{company:i}=this.property;if(!i){return null}return e("div",{class:"invoice-company","aria-label":"Issuing company details"},i.name&&e("p",{class:"invoice-company__name"},i.name),i.address&&e("p",{class:"invoice-company__address"},i.address),this.CompanyLocation,i.phone&&e("ir-printing-label",{class:"proforma-invoice__company-details",label:"Phone:",content:`${i.country?.phone_prefix??""} ${i.phone}`.trim()}),i.tax_nbr&&e("ir-printing-label",{class:"proforma-invoice__company-details",label:"Tax ID:",content:i.tax_nbr}))}renderPropertyInfo(){const i=[this.property?.city?.name??null,this.property?.country?.name??null].filter((e=>e!==null)).join(", ");const t=this.property?.space_theme?.logo;return e("section",{class:"property-overview","aria-label":"Property overview"},e("div",{class:"property-overview__text"},e("p",{class:"property-overview__name"},this.property.name),e("p",{class:"property-overview__location"},i)),t&&e("img",{src:t,alt:`${this.property.name} logo`,class:"property-logo"}))}formatBookingDates(e){return r(e,"YYYY-MM-DD").format("DD-MMM-YYYY")}renderBillToSection(){const{guest:i,company_name:t,company_tax_nbr:a}=this.booking;const{target:o,billed_to_name:n}=this.invoice;if(o?.code==="002"){return e("div",{class:"bill-to","aria-label":"Bill to company"},t&&e("p",{class:"bill-to__name"},t),a&&e("p",{class:"bill-to__id"},a))}return e("div",{class:"bill-to","aria-label":"Bill to guest"},n&&e("p",null,n),e("p",{class:"bill-to__name"}," ",n&&e("b",null,"for")," ",[i.first_name??"",i.last_name??""].join(" ").trim()),i.email&&e("p",{class:"bill-to__contact"},i.email),this.guestPhoneNumber&&e("p",{class:"bill-to__contact"},this.guestPhoneNumber))}renderCancellationPenalty(){const i=this.booking.financial.payments?.find((e=>e.payment_type?.code==="013"));if(!i){return null}const t=i.system_id;if(!this.invocableKeys.has(t)){return null}return e("section",{class:"proforma-payment__section"},e("div",{class:"ir-proforma-invoice__service"},e("div",{class:"ir-proforma-invoice__cancellation-info"},e("p",null,"Cancellation penalty"),e("p",{class:"ir-proforma-invoice__cancellation-date"},"( ",this.formatDisplayDate(i.date)," )")),e("span",{class:"ir-proforma-invoice__checkbox-price"},s(this.booking.currency.symbol,i.amount))))}render(){if(!this.booking||!this.invoice||!this.property){return}const i=this.renderBillToSection();const t=this.renderPropertyCompanyHeader();const n=this.renderPropertyInfo();const r=G(this.booking.from_date,this.booking.to_date);const c=this.booking.rooms.filter((e=>this.invocableKeys.has(e.system_id)));const l=c.length>0;const d=this.booking.extra_services?.some((e=>this.invocableKeys.has(e.system_id)));const h=this.invocableKeys?.has(this.booking.pickup_info?.["system_id"]);return e(a,null,e("article",{class:"invoice","aria-label":"Pro-forma invoice"},e("header",{class:"invoice__header"},e("h3",{class:"invoice__title"},"Pro-forma Invoice"),e("section",{class:"invoice__layout","aria-label":"Invoice summary"},e("div",{class:"invoice__column invoice__column--details"},e("div",{class:"invoice__details"},e("ir-printing-label",{label:"Date of issue:",content:this.issueDate}),e("ir-printing-label",{label:"Booking no:",content:this.bookingNumber})),i&&e("section",{class:"bill-to-section","aria-label":"Bill to"},e("h4",{class:"section-heading"},"Bill To"),i)),e("div",{class:"invoice__column invoice__column--property"},t&&e("section",{class:"issuer-section","aria-label":"Issuer"},t),n))),e("main",null,l&&e("section",{style:{marginTop:"2.5rem"}},e("div",{class:"proforma__accommodation-container"},e("p",{class:"proforma__accommodation-title"},"ACCOMMODATION"),e("p",{class:"booking-dates"},this.formatBookingDates(this.booking?.from_date)),e("p",{class:"booking-dates"},this.formatBookingDates(this.booking?.to_date)),e("p",{class:"number-of-nights"},r," ",r===1?"night":"nights"),e("p",{class:"vat-exclusion"},e("i",null,this.property?.tax_statement))),e("div",null,c.map(((i,t)=>e(o,null,e("ir-print-room",{room:i,idx:t,booking:this.booking,key:i.identifier,currency:this.booking.currency.symbol,property:this.property})))))),h&&e("ir-printing-pickup",{pickup:this.booking.pickup_info}),d&&e("ir-printing-extra-service",{invocableKeys:this.invocableKeys,extraServices:this.booking.extra_services,currency:this.booking.currency}),this.renderCancellationPenalty(),e("section",{class:"proforma-payment__section"},e("ir-printing-label",{label:"Balance:",content:s(this.booking.currency.symbol,this.booking.financial.due_amount)}),e("ir-printing-label",{label:"Collected (payments - refunds):",content:s(this.booking.currency.symbol,this.booking.financial.collected+this.booking.financial.refunds)}))),this.footerNote&&e("footer",{class:"invoice__footer"},e("p",{class:"invoice__footer-note"},this.footerNote))))}static get watchers(){return{invoice:["handleInvoiceChange"]}}};At.style=Ot;const Tt=".sc-ir-reservation-information-h{display:block}.reservation-information.sc-ir-reservation-information{display:flex;flex-direction:column;gap:0.5rem !important}.reservation-information__property-name.sc-ir-reservation-information{margin:0;font-weight:600;margin-bottom:1rem}.reservation-information__row.sc-ir-reservation-information{display:flex;align-items:center;justify-content:space-between;gap:0.5rem}.reservation-information.sc-ir-reservation-information>ir-label.sc-ir-reservation-information,.reservation-information.sc-ir-reservation-information>ota-label.sc-ir-reservation-information,.reservation-information__row.sc-ir-reservation-information ir-label.sc-ir-reservation-information{display:flex;align-items:center}";const Pt=Tt;const Nt=class{constructor(e){i(this,e);this.openSidebar=t(this,"openSidebar",7)}booking;countries;userCountry=null;isOpen;openSidebar;reservationInformationEl;irBookingCompanyFormRef;irBookingExtraNoteRef;componentWillLoad(){const e=this.booking?.guest?.country_id;this.userCountry=e?this.countries?.find((i=>i.id===e))||null:null}componentDidLoad(){this.setDynamicLabelHeight()}componentDidUpdate(){this.setDynamicLabelHeight()}handleEditClick(e,i){e.stopImmediatePropagation();e.stopPropagation();this.openSidebar.emit({type:i})}renderPhoneNumber(){const{mobile_without_prefix:e,country_phone_prefix:i,country_id:t}=this.booking.guest;if(!e){return null}if(i){return i+" "+e}if(t){const i=this.countries.find((e=>e.id===t));if(!i){throw new Error("Invalid country id")}return i.phone_prefix+" "+e}return e}setDynamicLabelHeight(){if(!this.reservationInformationEl){return}requestAnimationFrame((()=>{const e=this.reservationInformationEl?.querySelectorAll("ir-label, ota-label, .reservation-information__row");if(!e||e.length===0){return}const i=Array.from(e).map((e=>e.getBoundingClientRect().height)).filter((e=>e>0));if(!i.length){return}const t=Math.max(...i,32);this.reservationInformationEl.style.setProperty("--ir-reservation-label-height",`${t}px`)}))}render(){const i=H(this.booking.extras);return e("wa-card",{key:"2287a891772013a14f99e60f7ca57c8ae4259e93"},e("div",{key:"fb8248a7954b5dd54db5f492dd42b24d9b28300e",class:"reservation-information",ref:e=>this.reservationInformationEl=e},e("p",{key:"144d9395746d53adb4de5a5068e222d5482ada48",class:"reservation-information__property-name"},this.booking.property.name||""),e("ir-label",{key:"1688862fde5d40457349500f7e1de7da6109eeb7",labelText:`${b.entries.Lcz_Source}:`,content:this.booking.origin.Label,image:{src:this.booking.origin.Icon,alt:this.booking.origin.Label}}),e("ir-label",{key:"dae34228fe8a7393173a6b59f4a6a64a20902f7f",renderContentAsHtml:true,labelText:`${b.entries.Lcz_BookedOn}:`,content:`${J(this.booking.booked_on.date)}&nbsp&nbsp&nbsp&nbsp${Z(this.booking.booked_on.hour.toString(),this.booking.booked_on.minute.toString())}`}),e("div",{key:"65a5256ee39795906c6758b74c7d9b9e8c07d108",class:"reservation-information__row"},e("ir-label",{key:"f877b1e5f11a01b02df648b34b416f26d46ad7e5",labelText:`${b.entries.Lcz_BookedBy}:`,content:`${this.booking.guest.first_name} ${this.booking.guest.last_name}`},this.booking.guest?.nbr_confirmed_bookings>1&&!this.booking.agent&&e("div",{key:"610f9b8def7aa0016357841f371c9087a0efdf9c",class:"m-0 p-0 ",slot:"prefix"},e("wa-tooltip",{key:"4b3593241d2c6ef1672f51656d8097c855819e0a",for:"guests_nbr_confirmed_bookings"},`${b.entries.Lcz_BookingsNbr}`.replace("%1",this.booking.guest.nbr_confirmed_bookings.toString())),e("div",{key:"a0d8d80d68bca183e40e0e8a5c2b0853f0086f3b",style:{color:"#FB0AAD"},id:"guests_nbr_confirmed_bookings"},e("span",{key:"c801bb85cf436900bea2779c979d6d2d719fec05"}," ",this.booking.guest.nbr_confirmed_bookings),e("wa-icon",{key:"44422bcbe13ba0215932bee0c3e98bef5b536b56",name:"heart",style:{color:"#FB0AAD"}})))),e("wa-tooltip",{key:"524e4e0d1872587fa3034178f49b1cc8137eb47a",for:`edit_guest-details`},"Edit guest details"),e("ir-custom-button",{key:"f93694243d52c96add419e5e17bfb1c5742e1e38",iconBtn:true,id:`edit_guest-details`,onClickHandler:e=>this.handleEditClick(e,"guest"),appearance:"plain",variant:"neutral"},e("wa-icon",{key:"6af50c5dce1ea085633a7614d1b6e88f4c9db107",name:"edit",label:"Edit guest details",style:{fontSize:"1rem"}}))),e("div",{key:"296f189e91f33c8997bfe27f993787ed23f8e97b",class:"reservation-information__row"},e("ir-label",{key:"e75de54592034dbac9678d44678b29b356291c97",labelText:`Company:`,placeholder:"No company name provided",content:`${this.booking.company_name??""}${this.booking.company_tax_nbr?` - ${this.booking.company_tax_nbr}`:""}`,display:"flex"}),e("wa-tooltip",{key:"2fd841ce225ae66ebe00bd58140799bcbf90b48d",for:`edit_create-company-info`},"Add company info"),e("ir-custom-button",{key:"e8a92d5e94bf7b27ea83fee27e37df9f78f92dbb",iconBtn:true,id:`edit_create-company-info`,onClickHandler:e=>{e.stopImmediatePropagation();e.stopPropagation();this.irBookingCompanyFormRef.openCompanyForm()},appearance:"plain",variant:"neutral"},e("wa-icon",{key:"690e0b1593ca286ab911bc23257b5a4d44a1e8fe",name:"edit",label:"Add or modify company info",style:{fontSize:"1rem"}}))),this.booking.guest.mobile&&e("ir-label",{key:"c22e51206f60641f7167868eb2d3614873413080",labelText:`${b.entries.Lcz_Phone}:`,content:this.renderPhoneNumber()}),!this.booking.agent&&e("ir-label",{key:"68e72c26c1abe152f23b971934bc5ef55646b30b",labelText:`${b.entries.Lcz_Email}:`,content:this.booking.guest.email}),this.booking.guest.alternative_email&&e("ir-label",{key:"2c5ab9ee302b28fb4e0f10f1bdeb3fc667adf26c",labelText:`${b.entries.Lcz_AlternativeEmail}:`,content:this.booking.guest.alternative_email}),this.booking?.guest?.address&&e("ir-label",{key:"ccdb2c8e3e2b9d328c4d3a46a785523969ab7ee5",labelText:`${b.entries.Lcz_Address}:`,content:this.booking.guest.address}),this.userCountry&&e("ir-label",{key:"bd0497af05e9edb6f1ee279547c84e8be49ef37a",labelText:`${b.entries.Lcz_Country}:`,isCountryImage:true,content:this.userCountry.name,image:{src:this.userCountry.flag,alt:this.userCountry.name}}),this.booking.guest?.notes&&e("ir-label",{key:"dcc6d29bf58adcdfd85f695d585e30cb6caad0f6",display:"inline",labelText:`${b.entries.Lcz_GuestPrivateNote}:`,content:this.booking.guest?.notes}),this.booking.is_direct&&e("ir-label",{key:"10e227ef534452e25945d532536769019ed21577",labelText:`${b.entries.Lcz_ArrivalTime}:`,content:this.booking.arrival.description}),this.booking.promo_key&&e("ir-label",{key:"b3238601d45643ecf3e1bfcf143be509ebb984cf",labelText:`${b.entries.Lcz_Coupon}:`,content:this.booking.promo_key}),this.booking.is_in_loyalty_mode&&!this.booking.promo_key&&e("div",{key:"844f42b5868711c241892c57bc6de13fe32fe7ca",class:"d-flex align-items-center"},e("svg",{key:"fb1aa57614579b5f9ab39dda7f2b09519c85a8f2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",height:18,width:18},e("path",{key:"408ed8ad0a5a302114cd2070cd193ab7afacfef6",fill:"#fc6c85",d:"M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8v-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5v3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20c0 0-.1-.1-.1-.1c0 0 0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5v3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2v-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z"})),e("p",{key:"36b9ae955cfcde38a1d899904e7b6e0bb5309437",class:"m-0 p-0 ml-1"},b.entries.Lcz_LoyaltyDiscountApplied)),this.booking.is_direct?e("ir-label",{labelText:`${b.entries.Lcz_GuestRemark}:`,display:"inline",content:this.booking.remark}):e("ota-label",{class:"m-0 p-0",label:`${b.entries.Lcz_ChannelNotes||"Channel notes"}:`,remarks:this.booking.ota_notes,maxVisibleItems:this.booking.ota_notes?.length}),e("div",{key:"ca3f06c8a1347c220e18079156d5db83b528c0ba",class:"reservation-information__row"},e("ir-label",{key:"c48c867a05e9dba46fd257713ae38cac1830cdd5",labelText:`${b.entries.Lcz_BookingPrivateNote}:`,placeholder:b.entries.Lcz_VisibleToHotelOnly,content:i,display:i?"inline":"flex"}),e("wa-tooltip",{key:"b78ae727e9fb9ba7df3e3e1af99043b86b82584a",for:`edit_create-extra-note`},i?"Edit":"Create"," private note"),e("ir-custom-button",{key:"c6657e5330856fd456882ee1b71af08ac3172184",iconBtn:true,id:`edit_create-extra-note`,onClickHandler:()=>{this.irBookingExtraNoteRef.openDialog()},appearance:"plain",variant:"neutral"},e("wa-icon",{key:"02be209e53a9c221246c6478a290bb07b776c03c",style:{fontSize:"1rem"},name:"edit",label:"Edit or create private note"}))),e("ir-booking-extra-note",{key:"9586e50de75ba685633366a45a9631857b2e2125",booking:this.booking,ref:e=>this.irBookingExtraNoteRef=e}),e("ir-booking-company-dialog",{key:"a36b1a3d7674547132c1bbf44b81b56e25943b2d",booking:this.booking,ref:e=>this.irBookingCompanyFormRef=e})))}};Nt.style=Pt;const $t=".light-blue-bg.sc-ir-room{background:#acecff;padding:0.1rem 0.3rem;border-radius:5px;display:block;max-width:100px;box-sizing:border-box;display:inline-block;overflow:hidden;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;cursor:default}.room_statements.sc-ir-room{display:block;width:100%}.room_statements.sc-ir-room{display:block;width:100%}.room_statements.sc-ir-room span.sc-ir-room{display:inline;white-space:normal;line-height:1.5;word-break:break-word}.room_statements.sc-ir-room b.sc-ir-room{display:inline;margin-right:5px}.payment-container.sc-ir-room{position:absolute;right:1rem;height:fit-content}.sc-ir-room-h{position:relative}.subtotal_row.sc-ir-room{padding-top:8px;font-weight:600}.room_actions_btns.sc-ir-room{gap:0.5rem}.night-cost.sc-ir-room{color:#7cbebe}.room_actions_btns.sc-ir-room{white-space:nowrap;width:max-content}.room_actions_btns.sc-ir-room{flex:1 1 0%;display:flex;justify-content:flex-end}.mx-0-5.sc-ir-room{margin-left:2px !important;margin-right:2px !important}.tax-width.sc-ir-room{font-size:10px}.mx-01.sc-ir-room{--m:5px;margin-right:var(--m) !important;margin-left:var(--m) !important}*.sc-ir-room-h{box-sizing:border-box}.booking-room__collapse-btn.sc-ir-room{all:unset;display:inline-flex;align-items:center;align-self:flex-start;height:fit-content;border-radius:calc(var(--wa-panel-border-radius) - var(--wa-panel-border-width));aspect-ratio:1;cursor:pointer;transition:rotate var(--wa-transition-normal) var(--wa-transition-easing)}.booking-room__collapse-btn[data-state='opened'].sc-ir-room{rotate:90deg}.booking-room__collapse-btn[data-state='opened'].sc-ir-room:dir(rtl){rotate:-90deg}.booking-room__collapse-btn.sc-ir-room:focus-visible{outline:var(--wa-focus-ring);outline-offset:calc(var(--wa-panel-border-width) + var(--wa-focus-ring-offset))}.booking-room__header-row.sc-ir-room{display:flex;gap:var(--wa-space-sm, 0.5rem);margin:0}.booking-room__price-row.sc-ir-room{display:flex;align-items:center;gap:var(--wa-space-xs)}.booking-room__summary-row.sc-ir-room{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:var(--wa-space-xs, 0.25rem)}.booking-room__summary-text.sc-ir-room,.booking-room__text-reset.sc-ir-room{margin:0;padding:0}.booking-room__summary-highlight.sc-ir-room{font-weight:600}.booking-room__dates-row.sc-ir-room{display:flex;flex-wrap:wrap;gap:var(--wa-space-xs, 0.25rem);align-items:center}.booking-room__date-view.sc-ir-room{flex:1 1 150px;min-width:140px;width:fit-content}.booking-room__guest-row.sc-ir-room{display:flex;flex-wrap:wrap;align-items:center;gap:0.5rem}.booking-room__guest-name.sc-ir-room{font-weight:600}.booking-room__bed-info.sc-ir-room{color:var(--wa-color-neutral-700)}.booking-room__departure-row.sc-ir-room{display:flex;flex-wrap:wrap;align-items:center;gap:0.5rem}.booking-room__departure-label.sc-ir-room{font-weight:500}.booking-room_summary.sc-ir-room{display:grid;gap:0.5rem}.booking-room__actions.sc-ir-room{display:flex;align-items:center}.booking-room__breakdown-row.sc-ir-room{display:flex;flex-direction:column;gap:0.5rem;margin:0.5rem 0}@media (min-width: 640px){.booking-room__breakdown-row.sc-ir-room{flex-direction:row;align-items:flex-start}}.booking-room__breakdown-label-wrapper.sc-ir-room{flex:0 0 auto;padding-top:0.25rem}.booking-room__breakdown-label.sc-ir-room{margin:0;padding-right:0.5rem;font-weight:600;white-space:nowrap}.booking-room__breakdown-table.sc-ir-room{flex:1 1 auto;overflow-x:auto}.booking-room__cell.sc-ir-room{padding:0.125rem 0;line-height:1.3;white-space:nowrap}.booking-room__cell--right.sc-ir-room{text-align:right}.booking-room__cell--left.sc-ir-room{text-align:left}.booking-room__cell--pad-right.sc-ir-room{padding-right:0.5rem}.booking-room__cell--pad-left.sc-ir-room{padding-left:0.5rem}.booking-room__details.sc-ir-room,.booking-room__details.sc-ir-room::part(base),.booking-room__details.sc-ir-room::part(header),.booking-room__details.sc-ir-room::part(content){width:100%;box-sizing:border-box;padding:0}.booking-room__details.sc-ir-room::part(header){align-items:flex-start}.booking-room__price.sc-ir-room{font-weight:700;color:var(--wa-color-neutral-900);white-space:nowrap;text-align:right}";const Rt=$t;const Lt=class{constructor(e){i(this,e);this.deleteFinished=t(this,"deleteFinished",7);this.toast=t(this,"toast",7);this.pressCheckIn=t(this,"pressCheckIn",7);this.pressCheckOut=t(this,"pressCheckOut",7);this.editInitiated=t(this,"editInitiated",7);this.resetbooking=t(this,"resetbooking",7);this.openSidebar=t(this,"openSidebar",7)}get element(){return n(this)}booking;bookingIndex;isEditable;room;property_id;includeDepartureTime;mealCodeName;myRoomTypeFoodCat;currency="USD";language="en";legendData;roomsInfo;bedPreferences;departureTime;hasRoomEdit=false;hasRoomDelete=false;hasRoomAdd=false;hasCheckIn=false;hasCheckOut=false;collapsed=true;isLoading=false;modalReason=null;mainGuest;isModelOpen=false;isOpen=false;deleteFinished;toast;pressCheckIn;pressCheckOut;editInitiated;resetbooking;openSidebar;modal;bookingService=new u;dialogRef;componentWillLoad(){this.mainGuest=this.getMainGuest()}handleClick(e){let i=e.target;if(i.id=="checkin"){this.pressCheckIn.emit(this.room)}else if(i.id=="checkout"){this.pressCheckOut.emit(this.room)}}handleRoomDataChange(){this.mainGuest=this.getMainGuest()}getDateStr(e,i="default"){return e.getDate()+" "+e.toLocaleString(i,{month:"short"})+" "+e.getFullYear()}handleEditClick(){this.editInitiated.emit({event_type:"EDIT_BOOKING",ID:this.room["assigned_units_pool"],NAME:j(this.mainGuest?.first_name,this.mainGuest?.last_name),EMAIL:this.booking.guest.email,PHONE:this.booking.guest.mobile,REFERENCE_TYPE:"",FROM_DATE:this.booking.from_date,TO_DATE:this.booking.to_date,TITLE:`${b.entries.Lcz_EditBookingFor} ${this.room?.roomtype?.name} ${this.room?.unit?.name||""}`,defaultDateRange:{dateDifference:this.room.days.length,fromDate:new Date(this.room.from_date+"T00:00:00"),fromDateStr:this.getDateStr(new Date(this.room.from_date+"T00:00:00")),toDate:new Date(this.room.to_date+"T00:00:00"),toDateStr:this.getDateStr(new Date(this.room.to_date+"T00:00:00")),message:""},bed_preference:this.room.bed_preference,adult_child_offering:this.room.rateplan.selected_variation.adult_child_offering,ADULTS_COUNT:this.room.rateplan.selected_variation.adult_nbr,ARRIVAL:this.booking.arrival,ARRIVAL_TIME:this.booking.arrival.description,BOOKING_NUMBER:this.booking.booking_nbr,cancelation:this.room.rateplan.cancelation,channel_booking_nbr:this.booking.channel_booking_nbr,CHILDREN_COUNT:this.room.rateplan.selected_variation.child_nbr,COUNTRY:this.booking.guest.country_id,ENTRY_DATE:this.booking.from_date,FROM_DATE_STR:this.booking.format.from_date,guarantee:this.room.rateplan.guarantee,GUEST:this.mainGuest,IDENTIFIER:this.room.identifier,is_direct:this.booking.is_direct,IS_EDITABLE:this.booking.is_editable,NO_OF_DAYS:this.room.days.length,NOTES:this.booking.remark,origin:this.booking.origin,POOL:this.room["assigned_units_pool"],PR_ID:this.room.unit?.id,RATE:this.room.total,RATE_PLAN:this.room.rateplan.name,RATE_PLAN_ID:this.room.rateplan.id,RATE_TYPE:this.room.roomtype.id,ROOMS:this.booking.rooms,SOURCE:this.booking.source,SPLIT_BOOKING:false,STATUS:"IN-HOUSE",TO_DATE_STR:this.booking.format.to_date,TOTAL_PRICE:this.booking.total,legendData:this.legendData,roomsInfo:this.roomsInfo,roomName:this.room.unit?.name||"",PICKUP_INFO:this.booking.pickup_info,booking:this.booking,currentRoomType:this.room})}openModal(e){if(!e){return}this.modalReason=e;this.modal.openModal()}async handleModalConfirmation(e){try{e.stopImmediatePropagation();e.stopPropagation();if(!this.modalReason){return}this.isLoading=true;switch(this.modalReason){case"delete":await this.deleteRoom();break;case"checkin":case"checkout":await this.bookingService.handleExposedRoomInOut({booking_nbr:this.booking.booking_nbr,room_identifier:this.room.identifier,status:this.modalReason==="checkin"?"001":"002"});this.resetbooking.emit(null);break}}catch(e){console.log(e)}finally{this.isLoading=false;this.modalReason=null;this.modal.closeModal()}}async deleteRoom(){let e=[...this.booking.rooms];e=e.filter((e=>e.identifier!==this.room.identifier));const i={assign_units:true,check_in:true,is_pms:true,is_direct:true,booking:{booking_nbr:this.booking.booking_nbr,from_date:this.booking.from_date,to_date:this.booking.to_date,remark:this.booking.remark,property:this.booking.property,source:this.booking.source,currency:this.booking.currency,arrival:this.booking.arrival,guest:this.booking.guest,rooms:e},extras:this.booking.extras,pickup_info:this.booking.pickup_info};await this.bookingService.doReservation(i);this.deleteFinished.emit(this.room.identifier)}async updateDepartureTime(e){try{await this.bookingService.setDepartureTime({property_id:this.property_id,code:e,room_identifier:this.room.identifier});this.toast.emit({type:"success",description:"",title:"Saved Successfully",position:"top-right"})}catch(e){console.log(e)}}formatVariation({infant_nbr:e,adult_nbr:i,children_nbr:t}){const a=i>0?i:0;const o=t>0?t:0;const n=e>0?e:0;const r=a>1?b.entries.Lcz_Adults.toLowerCase():b.entries.Lcz_Adult.toLowerCase();const s=o>1?b.entries.Lcz_Children.toLowerCase():b.entries.Lcz_Child.toLowerCase();const c=n>1?b.entries.Lcz_Infants.toLowerCase():b.entries.Lcz_Infant.toLowerCase();const l=[];if(a>0){l.push(`${a} ${r}`)}if(o>0){l.push(`${o} ${s}`)}if(n>0){l.push(`${n} ${c}`)}return l.join("&nbsp&nbsp&nbsp&nbsp")}getSmokingLabel(){if(this.booking.is_direct){if(!this.room.smoking_option){return null}const e=m.roomsInfo.find((e=>e.id===this.room.roomtype.id));if(e){const i=e["smoking_option"]?.allowed_smoking_options;if(i){return i.find((e=>e.code===this.room.smoking_option))?.description}return null}return null}return this.room.ota_meta?.smoking_preferences}getBedName(){if(this.booking.is_direct){const e=this.bedPreferences.find((e=>e.CODE_NAME===this.room?.bed_preference?.toString()));if(!e){return}return e[`CODE_VALUE_${this.language}`]??e.CODE_VALUE_EN}return this.room.ota_meta?.bed_preferences}renderModalMessage(){switch(this.modalReason){case"delete":return`${b.entries["Lcz_AreYouSureDoYouWantToRemove "]} ${this.room.roomtype.name} ${this.room.unit?this.room.unit.name:""} ${b.entries.Lcz_FromThisBooking}`;case"checkin":return`Are you sure you want to Check In this unit?\n`;case"checkout":return`Are you sure you want to Check Out this unit?`;default:return""}}handleCheckIn(){const{adult_nbr:e,children_nbr:i,infant_nbr:t}=this.room.occupancy;if(this.room.sharing_persons.length<e+i+t){return this.showGuestModal()}return this.renderModalMessage()}getMainGuest(){return this.room.sharing_persons?.find((e=>e.is_main))}render(){const i=this.getBedName();return e(a,{key:"099c80f6307b3cd794291bc65e8e187794b88626"},e("div",{key:"0a2cf482e58f0143170f95ec2f6ef0311a34689a",class:"booking-room__header-row"},e("button",{key:"07e0e1b84814ddca309b12d622be0854d9cf11b4","data-state":this.collapsed?"closed":"opened",class:"booking-room__collapse-btn",onClick:()=>this.collapsed=!this.collapsed},e("wa-icon",{key:"5d56f7ee1bc5024801c44cc3324196e63fa66302",name:"chevron-right"})),e("div",{key:"643dcba1c17eccc67bf241673ae143249441a83b",style:{width:"100%",cursor:"default"}},e("div",{key:"df5fc561e3870db80618e903f447c2d56ace2b1e",class:"booking-room_summary",style:{width:"100%",cursor:"default"}},e("div",{key:"8b36b1046b7d3667aca2680c7698b1ed301a0a6d",class:"booking-room__summary-row"},e("p",{key:"7291aa7f4cd4bfff5d1fa3cc30dc2e2049edf776",class:"booking-room__summary-text"},e("span",{key:"d3b7cb78329db4606addac015d758a6906075b09",class:"booking-room__summary-highlight"},this.myRoomTypeFoodCat||""," ")," ",this.mealCodeName," ",this.room.rateplan.is_non_refundable&&` - ${b.entries.Lcz_NonRefundable}`," "),e("div",{key:"40e8470dcbcf8cc7aae655fa06a5d89750d56f14",class:"booking-room__price-row"},e("span",{key:"46467f5f29968738c9e1ab06e092c61f085c5e46",class:"booking-room__price"},s(this.currency,this.room["gross_total"])),e("div",{key:"224208fb75d4de9f626a657ee989d8513265a550",class:"booking-room__actions"},this.hasRoomEdit&&this.isEditable&&e(o,{key:"bc6607b2b274a4c0124f165de78fcfe0b39f9b64"},e("wa-tooltip",{key:"5cc7b346e32dc77a7932f0e4d58461e75976624d",for:`edit-room-${this.room.identifier}`},"Edit ",this.room.roomtype.name),e("ir-custom-button",{key:"d7c812cf46f506282f73910641b923942986ea40",iconBtn:true,id:`edit-room-${this.room.identifier}`,class:"booking-room__edit-button",onClickHandler:this.handleEditClick.bind(this),variant:"neutral",size:"small",appearance:"plain"},e("wa-icon",{key:"2f1571ef593f8f8b4dcad61a3e9e09088a8f47f8",label:"Edit room",class:"booking-room__edit-icon",name:"edit",style:{fontSize:"1rem"}}))),this.hasRoomDelete&&this.isEditable&&e(o,{key:"1d0c663a831c524fa013b53b308aeab452ac728c"},e("wa-tooltip",{key:"a8b649574e5588079d5edbfa444fea0a8bf33fbe",for:`delete-room-${this.room.identifier}`},"Delete ",this.room.roomtype.name),e("ir-custom-button",{key:"e6b5f8b0af2575288dbcf136c842ca694e86d682",iconBtn:true,id:`delete-room-${this.room.identifier}`,class:"booking-room__delete-button",onClickHandler:this.openModal.bind(this,"delete"),variant:"danger",size:"small",appearance:"plain"},e("wa-icon",{key:"20031fcc06dda77da8c81fdffa7b4009c16c7605",label:"Delete room",class:"booking-room__delete-icon",name:"trash-can",style:{fontSize:"1rem"}})))))),e("div",{key:"3d16383505f18f0e3f08bcb4b8897c61ca37966f",class:"booking-room__dates-row"},e("ir-date-view",{key:"6b96cf35d9d0cd85f3077f1ed3fa95e1bea07943",class:"booking-room__date-view",from_date:this.room.from_date,to_date:this.room.to_date,showDateDifference:false}),!f(this.room.roomtype.id)&&m.is_frontdesk_enabled&&this.room.unit&&e("ir-unit-tag",{key:"345d655ba673e5ed4651a75fb4e002c5702e2858",unit:this.room.unit.name}),this.hasCheckIn&&e("ir-custom-button",{key:"bb97cfb70231b2483d8ab49bbf84de53851ec4cd",onClickHandler:this.handleCheckIn.bind(this),id:"checkin",appearance:"outlined",variant:"brand"},b.entries.Lcz_CheckIn),this.hasCheckOut&&e("ir-custom-button",{key:"fad186a6a67a91539a8f38bfbabde34c810c3aa7",appearance:"outlined",variant:"brand",onClickHandler:()=>{this.modalReason="checkout"},id:"checkout"},b.entries.Lcz_CheckOut)),e("div",{key:"b882bf3cfbbb903c732f9452e5d57808276a5228",class:"booking-room__guest-row"},e("p",{key:"f7e1ad975d3f9ff5ddc87ec4948d0fbeb653c7b9",class:"booking-room__text-reset booking-room__guest-name"},`${this.mainGuest.first_name||""} ${this.mainGuest.last_name||""}`),this.room.rateplan.selected_variation.adult_nbr>0&&(this.room.unit?e(o,null,e("wa-tooltip",{for:`view-guest-btn-${this.room.identifier}`},"View guests"),e("ir-custom-button",{link:true,onClickHandler:()=>this.showGuestModal(),id:`view-guest-btn-${this.room.identifier}`,variant:"brand",appearance:"plain"},e("span",{innerHTML:this.formatVariation(this.room.occupancy)}))):e("span",{innerHTML:this.formatVariation(this.room.occupancy)})),i&&e("p",{key:"401a92216d153eec7cbe0a7fd5aa4fa32a0d0685",class:"booking-room__text-reset booking-room__bed-info"},"(",i,")")),this.includeDepartureTime&&e("div",{key:"3ccc723bb6d41db28f786280a50759d8ebc334ce",class:"booking-room__departure-row"},e("p",{key:"892314754fa739e617fb840b415916470316f11e",class:"booking-room__text-reset booking-room__departure-label"},"Expected departure time:"),e("wa-select",{key:"dd50cd4224e2e5cabd96836d068d46fed0905efc",onchange:e=>{this.updateDepartureTime(e.target.value)},style:{width:"140px"},size:"small",placeholder:"Not provided",value:this.room.departure_time?.code,defaultValue:this.room.departure_time?.code},this.departureTime?.map((i=>e("wa-option",{key:i.CODE_NAME,value:i.CODE_NAME},i[`CODE_VALUE_${this.language?.toUpperCase()}`]??i[`CODE_VALUE_EN`])))))),!this.collapsed&&e("div",{key:"db356b6888c2c5a7a0bd71ce455891e085a33df7",class:"booking-room__details-container"},e("div",{key:"5060c03db7445b038879a2d9e2ae4dafd09847d4",class:"booking-room__breakdown-row"},e("div",{key:"34a5fa746dc4747e679e041737e8df7db7bbcf6f",class:"booking-room__breakdown-label-wrapper"},e("p",{key:"f7f921bd7ddae47ba93711ad967aa75169246b75",class:"booking-room__breakdown-label"},`${b.entries.Lcz_Breakdown}:`)),e("div",{key:"9c7acd91aaeb01f1d47a2196ff0d802d5c20baac",class:"booking-room__breakdown-table"},e("table",{key:"e28c9d0ecadeace8124eea43b1d5fe6e106b5acf"},this.room.days.length>0&&this.room.days.map((i=>e("tr",null,e("td",{class:"booking-room__cell booking-room__cell--right booking-room__cell--pad-right"},Q(i.date)),e("td",{class:"booking-room__cell booking-room__cell--right"},s(this.currency,i.amount)),i.cost>0&&i.cost!==null&&e("td",{class:"booking-room__cell booking-room__cell--left booking-room__cell--pad-left night-cost"},s(this.currency,i.cost))))),e("tr",{key:"373d94a9b3e6487434373b3a81bc6762619d9a7c",class:""},e("th",{key:"5fb3a69825f8f7e26595bf475eff3aa17b21e030",class:"booking-room__cell booking-room__cell--right booking-room__cell--pad-right subtotal_row"},b.entries.Lcz_SubTotal),e("th",{key:"0e4746fb41ce9601868cc0fa5547b155d8c56fbe",class:"booking-room__cell booking-room__cell--right subtotal_row"},s(this.currency,this.room.total)),this.room.gross_cost>0&&this.room.gross_cost!==null&&e("th",{key:"404afe6e294a557ad11d4c011325b5aa0543218a",class:"booking-room__cell booking-room__cell--right booking-room__cell--pad-left night-cost"},s(this.currency,this.room.cost))),this.booking.is_direct?e(o,null,(()=>{const i=m.taxes.filter((e=>e.pct>0&&e.is_exlusive));return i.map((i=>{const t=i.is_exlusive?this.room.total*i.pct:this.room.total-this.room.total/(1+i.pct);return e("tr",null,e("td",{class:"booking-room__cell booking-room__cell--right booking-room__cell--pad-right"},i.is_exlusive?b.entries.Lcz_Excluding:b.entries.Lcz_Including," ",i.name," (",i.pct,"%)"),e("td",{class:"booking-room__cell booking-room__cell--right"},s(this.currency,t/100)),this.room.gross_cost>0&&this.room.gross_cost!==null&&e("td",{class:"booking-room__cell booking-room__cell--right booking-room__cell--pad-left night-cost"},s(this.currency,this.room.cost*i.pct/100)))}))})(),this.room.inclusive_taxes?.CALCULATED_INCLUSIVE_TAXES?.map((i=>e("tr",null,e("td",{class:"booking-room__cell booking-room__cell--right booking-room__cell--pad-right"},b.entries.Lcz_Including," ",i.TAX_NAME," (",i.TAX_PCT*100,"%)"),e("td",{class:"booking-room__cell booking-room__cell--right"},s(this.currency,i.CALCULATED_VALUE)))))):e(o,null,(()=>{const i=this.room.ota_taxes.filter((e=>e.amount>0));return i.map((i=>e("tr",null,e("td",{class:"booking-room__cell booking-room__cell--right booking-room__cell--pad-right"},i.is_exlusive?b.entries.Lcz_Excluding:b.entries.Lcz_Including," ",i.name),e("td",{class:"booking-room__cell booking-room__cell--right"},i.currency.symbol,i.amount))))})())))),e("ir-label",{key:"af9f728334742755dadd1e64eba28aa8aa6dc1cd",labelText:`${b.entries.Lcz_SmokingOptions}:`,display:"inline",content:this.getSmokingLabel()}),this.booking.is_direct&&e(o,{key:"3e36b54ab616cad8c4d6160bdfa33a5b996e60bc"},this.room.rateplan.cancelation&&e("ir-label",{key:"41f2ce564f774d343b334cc90319a9fba2014491",labelText:`${b.entries.Lcz_Cancellation}:`,display:"inline",content:this.room.rateplan.cancelation||"",renderContentAsHtml:true}),this.room.rateplan.guarantee&&e("ir-label",{key:"a44413b6c7af045cd734e1e89255d6c086c70115",labelText:`${b.entries.Lcz_Guarantee}:`,display:"inline",content:this.room.rateplan.guarantee||"",renderContentAsHtml:true})),this.room.ota_meta&&e("div",{key:"0aba4a382a0c9719ea885d01991db2efcc35ebf5"},e("ir-label",{key:"83343146d66be74594f8810d13785263e3606b27",labelText:`${b.entries.Lcz_MealPlan}:`,display:"inline",content:this.room.ota_meta.meal_plan}),e("ir-label",{key:"ecae0471e812c1cd07007ebc75601b1a025bbee8",labelText:`${b.entries.Lcz_Policies}:`,display:"inline",content:this.room.ota_meta.policies}))))),e("ir-dialog",{key:"e8569bed31d20a59f70035808597156df7380b19",label:this.modalReason==="delete"?"Alert":b.entries.Lcz_Confirmation,ref:e=>this.modal=e,onIrDialogHide:e=>{e.stopImmediatePropagation();e.stopPropagation()},onIrDialogAfterHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.modalReason=null},lightDismiss:this.modalReason==="checkin"},e("p",{key:"0e7c318fe8e1a014ebcfd1e7ef5af957ac3103c8"},this.renderModalMessage()),e("div",{key:"4786e09531a1e87aa11207fc0efe7a38162f2f0b",slot:"footer",class:"ir-dialog__footer"},e("ir-custom-button",{key:"203c0913c9a00063bc67bc0da9619988679a0de7",size:"medium","data-dialog":"close",appearance:"filled",variant:"neutral"},b.entries.Lcz_Cancel),e("ir-custom-button",{key:"fe3d27bab0e8358a83d36da0adb1e0faef2c6880",size:"medium",loading:this.isLoading,onClickHandler:e=>this.handleModalConfirmation(e),variant:this.modalReason==="delete"?"danger":"brand"},this.modalReason==="delete"?b.entries.Lcz_Delete:b.entries.Lcz_Confirm))),e("ir-checkout-dialog",{key:"a9c2d00f784a78431d4cbcb25b3668ec09a43207",onCheckoutDialogClosed:e=>{e.stopImmediatePropagation();e.stopPropagation();this.modalReason=null;if(e.detail.reason==="openInvoice"){this.isOpen=true}},identifier:this.room.identifier,open:this.modalReason==="checkout",booking:this.booking}),e("ir-invoice",{key:"4dbb132665ee014ad6211d1fa797c2437cf1e19c",onInvoiceClose:e=>{e.stopImmediatePropagation();e.stopPropagation();this.isOpen=false},open:this.isOpen,booking:this.booking,roomIdentifier:this.room.identifier}))}showGuestModal(){const{adult_nbr:e,children_nbr:i,infant_nbr:t}=this.room.occupancy;this.openSidebar.emit({type:"room-guest",payload:{roomName:this.room.unit?.name,sharing_persons:this.room.sharing_persons,totalGuests:e+i+t,checkin:this.hasCheckIn,identifier:this.room.identifier}})}static get watchers(){return{room:["handleRoomDataChange"]}}};Lt.style=Rt;const Gt="";const Ht=Gt;const jt=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7)}open;roomName;identifier;sharedPersons=[];totalGuests=0;countries;checkIn;language="en";bookingNumber;closeModal;render(){return e("ir-drawer",{key:"dd633ca5c8b136934a1ce269e623738c7a6fa3ff",style:{"--ir-drawer-width":"60rem","--ir-drawer-background-color":"var(--wa-color-surface-default)","--ir-drawer-padding-left":"var(--spacing)","--ir-drawer-padding-right":"var(--spacing)","--ir-drawer-padding-top":"var(--spacing)","--ir-drawer-padding-bottom":"var(--spacing)"},label:`Room ${this.roomName}`,open:this.open,onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.closeModal.emit()}},this.open&&e("ir-room-guests-form",{key:"fcf933e3c03538876a7ea94743e0dcc2ac17b971",sharedPersons:this.sharedPersons,roomName:this.roomName,countries:this.countries,totalGuests:this.totalGuests,identifier:this.identifier,bookingNumber:this.bookingNumber,checkIn:this.checkIn,language:this.language}),e("div",{key:"1807f85758b15102bd4f03f6d2880271a1116c63",slot:"footer",class:"ir__drawer-footer"},e("ir-custom-button",{key:"c8c375e42dfe5517f5e573aa59c1d28faf82f880",size:"medium","data-drawer":"close",appearance:"filled",variant:"neutral"},b?.entries?.Lcz_Cancel??"Save"),e("ir-custom-button",{key:"6d7bb3a4ba157d3b338afaeb0a5739528de01c56",loading:O("/Handle_Exposed_Room_Guests"),size:"medium",form:`room-guests__${this.identifier}`,type:"submit",variant:"brand"},this.checkIn?b.entries?.Lcz_CheckIn??"Check in":b?.entries?.Lcz_Save??"Save")))}};jt.style=Ht;const Ut={id:-1,full_name:"",country_id:null,dob:"",id_info:{type:{code:null,description:null},number:""},address:null,alternative_email:null,cci:null,city:null,country:undefined,country_phone_prefix:null,email:null,first_name:"",last_name:"",mobile:null,nbr_confirmed_bookings:0,notes:null,password:null,subscribe_to_news_letter:null};const Kt={mask:Date,pattern:"DD/MM/YYYY",lazy:false,min:r("1900-01-01","YYYY-MM-DD").toDate(),max:new Date,format:e=>r(e).format("DD/MM/YYYY"),parse:e=>r(e,"DD/MM/YYYY").toDate(),autofix:true,placeholderChar:"_",blocks:{YYYY:{mask:q,from:1900,to:(new Date).getFullYear(),placeholderChar:"Y"},MM:{mask:q,from:1,to:12,placeholderChar:"M"},DD:{mask:q,from:1,to:31,placeholderChar:"D"}}};const Vt=".sc-ir-room-guests-form-h{display:block;height:100%;position:relative;text-align:start !important;padding-bottom:1rem !important}.id-select.sc-ir-room-guests-form{border-top-right-radius:0;border-bottom-right-radius:0;border-right-width:0}.sc-ir-room-guests-form-h{display:block;width:100%}.guests-labels.sc-ir-room-guests-form{display:none}.sharing_persons_label.sc-ir-room-guests-form{display:none}.loading-container.sc-ir-room-guests-form{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.guest_document.sc-ir-room-guests-form input.sc-ir-room-guests-form{border-top-left-radius:0;border-bottom-left-radius:0}.guests-labels.sc-ir-room-guests-form *.sc-ir-room-guests-form,.sharing_persons_label.sc-ir-room-guests-form{margin-bottom:0.5rem;padding-bottom:0}.room-guest__info-container.sc-ir-room-guests-form{display:flex;flex:1 1 0%;align-items:center}.room-guest__document.sc-ir-room-guests-form::part(base):dir(ltr),.room-guest__id-info.sc-ir-room-guests-form::part(combobox):dir(rtl){border-top-left-radius:0;border-bottom-left-radius:0}.room-guest__document.sc-ir-room-guests-form{flex:1 1 0%}.room-guest__id-info.sc-ir-room-guests-form::part(combobox):dir(ltr),.room-guest__document.sc-ir-room-guests-form::part(base):dir(rtl){border-top-right-radius:0;border-bottom-right-radius:0}.room-guest__id-info.sc-ir-room-guests-form::part(combobox):dir(ltr){border-right-width:0}.room-guest__id-info.sc-ir-room-guests-form::part(combobox):dir(rtl){border-left-width:0}.room-guest__id-info[open].sc-ir-room-guests-form,.room-guest__id-info.sc-ir-room-guests-form:focus-visible,.room-guest__id-info.sc-ir-room-guests-form:focus-within{z-index:2}.room-guest__section.sc-ir-room-guests-form{display:flex;flex-direction:column;margin-bottom:1rem}.room-guest__section.sc-ir-room-guests-form p.sc-ir-room-guests-form{margin:0;padding:0}.guest_label.sc-ir-room-guests-form{width:100px;display:inline-block;position:relative;color:var(--wa-form-control-label-color);font-weight:var(--wa-form-control-label-font-weight);line-height:var(--wa-form-control-label-line-height);margin-bottom:0.5em !important}@media (min-width: 768px){.sharing_persons_label.sc-ir-room-guests-form{display:block}.guest_country_picker.sc-ir-room-guests-form{margin-bottom:3px}.room-guest__section.sc-ir-room-guests-form{display:block}.guest-grid.sc-ir-room-guests-form{display:grid;grid-template-columns:minmax(0, 120px) \n      minmax(0, 120px) \n      minmax(0, 120px) \n      minmax(0, 120px) \n      minmax(0, 1fr);gap:0.5rem;align-items:flex-start}.guest_label.sc-ir-room-guests-form,.sharing_persons_heading.sc-ir-room-guests-form,.main_guest_heading.sc-ir-room-guests-form{display:none}}";const Ft=Vt;const qt=class{constructor(e){i(this,e);this.closeModal=t(this,"closeModal",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.updateRoomGuests=t(this,"updateRoomGuests",7)}roomName;identifier;sharedPersons=[];totalGuests=0;countries;checkIn;language="en";bookingNumber;guests=[];idTypes=[];error={};isLoading;propertyCountry;autoValidate=false;closeModal;resetBookingEvt;updateRoomGuests;bookingService=new u;componentWillLoad(){this.init();this.initializeGuests()}async init(){try{this.isLoading=true;const[e,i]=await Promise.all([this.bookingService.getUserDefaultCountry(),this.bookingService.getSetupEntriesByTableName("_ID_TYPE")]);this.idTypes=i;if(e){this.propertyCountry=this.countries.find((i=>i.id===e.COUNTRY_ID))}}catch(e){console.error(e)}finally{this.isLoading=false}}initializeGuests(){let e=[];if(this.totalGuests>this.sharedPersons.length){const i=this.totalGuests-this.sharedPersons.length;e=[...this.sharedPersons,...Array(i).fill({...Ut,id_info:{...Ut.id_info,type:{code:this.idTypes[0]?.CODE_NAME||"001",description:this.idTypes[0]?.CODE_VALUE_EN||""},number:""}})]}else{e=[...this.sharedPersons]}e=e.map((e=>({...e,dob:new Date(e.dob).getFullYear()===1900?null:e.dob})));this.guests=e.map((e=>({...e,dob:e.dob?r(new Date(e.dob)).format("DD/MM/YYYY"):"",country_id:e.country?e.country.id:null})))}updateGuestInfo(e,i){const t=[...this.guests];let a=t[e];a={...a,...i};t[e]=a;this.guests=[...t]}async saveGuests(){try{this.error={};this.autoValidate=true;console.log({sharedPersons:this.sharedPersons,guests:this.guests});for(const e of this.guests){ci(e)}await this.bookingService.handleExposedRoomGuests({booking_nbr:this.bookingNumber,identifier:this.identifier,guests:this.guests.map((e=>{if(!e.first_name&&e.id===-1){return null}return{...e,dob:e.dob?r(e.dob,"DD/MM/YYYY").format("YYYY-MM-DD"):null}})).filter(Boolean)});if(this.checkIn){await this.bookingService.handleExposedRoomInOut({booking_nbr:this.bookingNumber,room_identifier:this.identifier,status:"001"})}this.closeModal.emit(null);this.updateRoomGuests.emit({identifier:this.identifier,guests:this.guests});this.resetBookingEvt.emit()}catch(e){console.log(e);if(e instanceof K){let i={};e.issues.forEach((e=>{i[e.path[e.path.length-1]]=true}));this.error={...i}}}}render(){if(this.isLoading){return e("div",{class:"loading-container"},e("ir-spinner",null))}return e("form",{id:`room-guests__${this.identifier}`,class:"sheet-container",style:{minWidth:"300px"},onSubmit:e=>{e.preventDefault();this.saveGuests()}},e("section",{class:"sheet-body"},e("div",{class:""},e("div",{class:"guest-grid guests-labels"},e("p",{class:""},b.entries.Lcz_MainGuest),e("p",{class:""}),e("p",{class:" "},b.entries.Lcz_DOB),e("p",{class:""},b.entries.Lcz_Nationality),e("p",{class:" "},b.entries.Lcz_Documents)),e("h5",{class:"main_guest_heading"},b.entries.Lcz_MainGuest),this.guests.map(((i,t)=>{let a=true;try{ci(i)}catch(e){a=false}return e(o,null,t===1&&e("div",{class:"d-flex mx-0 px-0"},e("h5",{class:"mx-0 px-0 sharing_persons_heading"},b.entries.Lcz_PersonsSharingRoom),e("p",{class:"mx-0 px-0 sharing_persons_label"},b.entries.Lcz_PersonsSharingRoom)),e("div",{key:t,class:"guest-grid"},e("div",{class:"room-guest__section"},e("label",{htmlFor:`first_name_${t}`,class:"guest_label"},"First name"),e("ir-validator",{class:"flex-grow-1",schema:si.shape.first_name},e("ir-input",{"aria-invalid":String(!!this.error["first_name"]&&!a),size:"small",id:`first_name_${t}`,placeholder:"First name","onText-change":e=>this.updateGuestInfo(t,{first_name:e.detail}),value:i.first_name,maxlength:40}))),e("div",{class:"room-guest__section"},e("label",{class:"guest_label"},"Last name"),e("ir-input",{"aria-invalid":String(!!this.error["last_name"]&&!a),size:"small",id:`last_name_${t}`,placeholder:"Last name","onText-change":e=>this.updateGuestInfo(t,{last_name:e.detail}),value:i.last_name,maxlength:40})),e("div",{class:"room-guest__section"},e("p",{class:"guest_label"},b.entries.Lcz_DOB),e("ir-validator",{class:"flex-grow-1",schema:si.shape.dob},e("ir-input",{"aria-invalid":String(!!this.error["dob"]&&!a),id:`dob_${t}`,mask:Kt,size:"small",placeholder:"","onText-change":e=>{this.updateGuestInfo(t,{dob:e.detail})},value:i.dob}))),e("div",{class:"room-guest__section"},e("p",{class:"guest_label"},b.entries.Lcz_Nationality),e("div",{class:"flex-grow-1"},e("ir-country-picker",{size:"small",variant:"modern","aria-invalid":String(!!this.error["country_id"]&&!i.country_id),propertyCountry:this.propertyCountry,id:`{locales.entries.Lcz_Nationality}_${t}`,error:!!this.error["country_id"]&&!i.country_id,country:this.countries?.find((e=>e.id?.toString()===i.country?.id?.toString())),onCountryChange:e=>this.updateGuestInfo(t,{country_id:e.detail?.id?.toString()??null,country:e.detail}),countries:this.countries}))),e("div",{class:"room-guest__section"},e("p",{class:"guest_label"},b.entries.Lcz_Documents),e("div",{class:"room-guest__info-container flex-grow-1"},e("wa-select",{class:"room-guest__id-info",defaultValue:i.id_info?.type?.code??this.idTypes[0]?.CODE_NAME,value:i.id_info?.type?.code,onchange:e=>{this.updateGuestInfo(t,{id_info:{...this.guests[t].id_info,type:{code:e.target.value,description:""}}})},size:"small"},this.idTypes?.map((i=>{const t=i[`CODE_VALUE_${this.language.toUpperCase()}`]??i[`CODE_VALUE_EN`];return e("wa-option",{value:i["CODE_NAME"],label:t},t)}))),e("wa-input",{size:"small","aria-invalid":String(!!this.error["number"]&&!a),class:"room-guest__document",defaultValue:i?.id_info?.number,value:i?.id_info?.number,maxlength:18,placeholder:"12345",onchange:e=>this.updateGuestInfo(t,{id_info:{...this.guests[t].id_info,number:e.target.value}})})))))})))))}};qt.style=Ft;const Wt=".sc-ir-unit-tag-h{display:inline-flex;box-sizing:border-box;height:fit-content;width:fit-content;padding:0;margin:0}.unit-tag__content.sc-ir-unit-tag{max-width:50px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box}.unit-tag__el.sc-ir-unit-tag{height:1.4rem;overflow:hidden}.unit-tag__el.sc-ir-unit-tag::part(base){padding-top:0;padding-bottom:0;height:fit-content;box-sizing:border-box;height:fit-content}";const Zt=Wt;const Jt=class{constructor(e){i(this,e)}unit;showTooltip=false;_id=A();resizeObserver;contentElement;measurementFrame;setContentRef=e=>{if(this.resizeObserver){this.resizeObserver.disconnect()}this.contentElement=e||undefined;if(!this.contentElement){return}this.attachResizeObserver();this.scheduleTooltipUpdate()};componentDidLoad(){this.attachResizeObserver();this.scheduleTooltipUpdate()}disconnectedCallback(){this.resizeObserver?.disconnect();if(this.measurementFrame){cancelAnimationFrame(this.measurementFrame);this.measurementFrame=undefined}}onUnitChange(){this.scheduleTooltipUpdate()}attachResizeObserver(){if(typeof window==="undefined"||!this.contentElement||typeof ResizeObserver==="undefined"){return}if(!this.resizeObserver){this.resizeObserver=new ResizeObserver((()=>this.scheduleTooltipUpdate()))}this.resizeObserver.observe(this.contentElement)}scheduleTooltipUpdate(){if(typeof window==="undefined"){return}if(this.measurementFrame){cancelAnimationFrame(this.measurementFrame)}this.measurementFrame=requestAnimationFrame((()=>{this.measurementFrame=undefined;this.updateTooltipState()}))}updateTooltipState(){if(typeof window==="undefined"){return}const e=this.contentElement;if(!e||!this.unit){if(this.showTooltip){this.showTooltip=false}return}const i=e.scrollWidth>e.clientWidth;if(i!==this.showTooltip){this.showTooltip=i}}render(){return e(o,{key:"8ef7bff6bb6d2448584e666affa98a2cbdf0cf58"},this.showTooltip&&e("wa-tooltip",{key:"31b32d57e489595997f164515145600dab16a0f0",for:this._id},this.unit),e("wa-tag",{key:"83df7ec527bc0217296670df3de77a294260d4db",id:this._id,class:"unit-tag__el",size:"small",appearance:"filled",variant:"brand"},e("span",{key:"c235a86d84f16ec98e9791fa857c90cff0091a42",class:"unit-tag__content",ref:this.setContentRef},this.unit)))}static get watchers(){return{unit:["onUnitChange"]}}};Jt.style=Zt;const Qt="*.sc-ota-label{margin:0;padding:0}.sc-ota-label-h{display:flex;margin-bottom:5px;gap:5px}.label_title.sc-ota-label{min-width:max-content;padding:0;margin:0;font-weight:600}.ota-message-list.sc-ota-label{margin:0 3px;padding:0;overflow:hidden;width:100%;word-wrap:break-word !important;overflow-wrap:break-word !important}.ota-message-item.sc-ota-label{width:100%;line-height:1.5;margin:0;padding:0;word-wrap:break-word !important;overflow-wrap:break-word !important}.ota-message-item.sc-ota-label::before{content:'- ';margin-right:0.25rem}.ota-visibility-toggle.sc-ota-label{background:white;color:var(--blue);padding:0;margin:0;margin-left:3px;font-size:12px;border:0}.ota-visibility-toggle.sc-ota-label:hover{color:#355270}.ota-message-list.sc-ota-label{margin:0 3px;padding:0;overflow:hidden;width:100%;word-wrap:break-word !important;overflow-wrap:break-word !important;white-space:normal;list-style:none}.ota-message-item.sc-ota-label{width:100%;line-height:1.5;margin:0 0 0 1.2em;padding:0;word-wrap:break-word !important;overflow-wrap:break-word !important;white-space:normal;position:relative}";const Xt=Qt;const ea=class{constructor(e){i(this,e)}label;remarks;maxVisibleItems=3;showAll=false;toggleShowAll=()=>{this.showAll=!this.showAll};render(){if(!this.remarks){return null}const i=this.showAll?this.remarks:this.remarks.slice(0,this.maxVisibleItems);return e(a,null,e("p",{class:"label_title"},this.label),e("ul",{class:"ota-message-list"},i.map(((t,a)=>e("li",{key:A(),class:"ota-message-item"},t.statement," ",this.remarks.length>this.maxVisibleItems&&a===i.length-1&&e("button",{class:"ota-visibility-toggle",onClick:this.toggleShowAll},this.showAll?b.entries.Lcz_ShowLess:b.entries.Lcz_ShowMore))))))}};ea.style=Xt;export{ae as ir_applicable_policies,ce as ir_billing,he as ir_billing_drawer,fe as ir_booking_billing_recipient,ge as ir_booking_details,xe as ir_booking_editor,Me as ir_booking_editor_drawer,Se as ir_booking_editor_form,Be as ir_booking_editor_guest_form,Te as ir_booking_editor_header,$e as ir_booking_extra_note,Ge as ir_booking_guarantee,Ue as ir_booking_header,Fe as ir_booking_status_tag,Ze as ir_checkout_dialog,Xe as ir_events_log,ti as ir_extra_service,ni as ir_extra_service_config,pi as ir_extra_service_config_form,bi as ir_extra_services,_i as ir_guest_info_drawer,Di as ir_guest_info_form,Ci as ir_invoice,Ei as ir_invoice_form,Oi as ir_payment_details,Ni as ir_payment_folio,qi as ir_payment_folio_form,Ji as ir_payment_item,et as ir_payment_summary,at as ir_payments_folio,rt as ir_pickup,dt as ir_pickup_form,mt as ir_pickup_view,ut as ir_pms_logs,yt as ir_popover,wt as ir_preview_screen_dialog,Yt as ir_print_room,It as ir_printing_extra_service,zt as ir_printing_pickup,At as ir_proforma_invoice_preview,Nt as ir_reservation_information,Lt as ir_room,jt as ir_room_guests,qt as ir_room_guests_form,Jt as ir_unit_tag,ea as ota_label};
//# sourceMappingURL=p-cf116ead.entry.js.map