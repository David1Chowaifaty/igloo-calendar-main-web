import{r as t,c as i,g as e,h as s,H as h}from"./p-d239357b.js";const n=":host{display:block;position:relative}.error-message{font-weight:var(--wa-form-control-hint-font-weight);margin-block-start:0.5em;font-size:var(--wa-font-size-smaller);line-height:var(--wa-form-control-label-line-height);color:var(--wa-color-danger-fill-loud);}";const r=n;const a=class{constructor(e){t(this,e);this.validationChange=i(this,"irValidationChange",7);this.valueChange=i(this,"irValueChange",7)}get el(){return e(this)}schema;value;showErrorMessage;autovalidate;form;valueEvent="input input-change value-change select-change";blurEvent="blur input-blur select-blur";validationDebounce=200;validationChange;valueChange;isValid=true;autoValidateActive=false;errorMessage="";childEl;formEl;slotEl;currentValue;hasInteracted=false;validationTimer;valueEventsBound=[];blurEventsBound=[];componentWillLoad(){if(!this.schema){throw new Error("<ir-validator> requires a `schema` prop.")}this.syncAutovalidateFlag(this.autovalidate)}componentDidLoad(){this.slotEl=this.el.shadowRoot?.querySelector("slot");this.slotEl?.addEventListener("slotchange",this.handleSlotChange);this.initializeChildReference();this.attachFormListener()}disconnectedCallback(){this.teardownChildListeners();this.detachFormListener();this.slotEl?.removeEventListener("slotchange",this.handleSlotChange);this.clearValidationTimer()}handleSchemaChange(){if(this.autoValidateActive&&this.hasInteracted){this.flushValidation()}}handleAutoValidatePropChange(t){this.syncAutovalidateFlag(t);if(this.autoValidateActive){this.flushValidation()}}handleFormPropChange(){this.detachFormListener();this.attachFormListener()}handleValueEventChange(t,i){if(t===i)return;this.rebindChildListeners()}handleBlurEventChange(t,i){if(t===i)return;this.rebindChildListeners()}syncAutovalidateFlag(t){this.autoValidateActive=JSON.parse(String(t??false))}parseEvents(t){if(!t)return[];return t.split(/[\s,]+/).map((t=>t.trim())).filter(Boolean)}handleValuePropChange(t,i){if(Object.is(t,i))return;this.updateValue(t,{suppressValidation:true,emitChange:false});if(this.autoValidateActive&&this.hasInteracted){this.flushValidation()}}handleSlotChange=()=>{this.initializeChildReference()};initializeChildReference(){const t=this.pickSingleChild();if(t===this.childEl)return;this.teardownChildListeners();if(!t)return;this.childEl=t;this.hasInteracted=false;this.registerChildListeners();const i=this.readValueFromChild();this.updateValue(i,{suppressValidation:!this.autoValidateActive,emitChange:true});if(!this.autoValidateActive){this.updateAriaValidity(this.isValid)}}pickSingleChild(){const t=this.slotEl?.assignedElements({flatten:true})??Array.from(this.el.children);const i=t.filter((t=>t.nodeType===Node.ELEMENT_NODE));if(i.length===0){console.warn("<ir-validator> requires exactly one child element but found none.");return undefined}if(i.length>1){console.warn(`<ir-validator> requires exactly one child element but found ${i.length}. Using the first.`)}return i[0]}registerChildListeners(){if(!this.childEl)return;this.unbindChildListeners();this.valueEventsBound=this.parseEvents(this.valueEvent);this.blurEventsBound=this.parseEvents(this.blurEvent);this.valueEventsBound.forEach((t=>this.childEl.addEventListener(t,this.handleValueEvent)));this.blurEventsBound.forEach((t=>this.childEl.addEventListener(t,this.handleBlurEvent)))}unbindChildListeners(){if(!this.childEl)return;this.valueEventsBound.forEach((t=>this.childEl.removeEventListener(t,this.handleValueEvent)));this.blurEventsBound.forEach((t=>this.childEl.removeEventListener(t,this.handleBlurEvent)));this.valueEventsBound=[];this.blurEventsBound=[]}teardownChildListeners(){if(this.childEl){this.unbindChildListeners();this.childEl=undefined}this.clearValidationTimer()}rebindChildListeners(){if(!this.childEl)return;this.registerChildListeners()}handleValueEvent=t=>{if(!this.childEl)return;const i=this.extractEventValue(t);this.hasInteracted=true;this.updateValue(i)};handleBlurEvent=()=>{if(!this.childEl)return;this.hasInteracted=true;if(this.autoValidateActive){this.flushValidation()}};extractEventValue(t){if("detail"in t&&t["detail"]&&typeof t["detail"]==="object"&&"value"in t.detail){return t.detail.value}const i=t.target;if(i&&"value"in i){return i.value}return this.readValueFromChild()}readValueFromChild(){if(this.value!==undefined){return this.value}if(!this.childEl)return undefined;if("value"in this.childEl){return this.childEl.value}return this.childEl.getAttribute?.("value")}updateValue(t,i={}){const e=this.currentValue;this.currentValue=t;if(i.emitChange!==false&&!Object.is(e,t)){this.valueChange.emit({value:this.currentValue})}if(!i.suppressValidation&&this.autoValidateActive&&this.hasInteracted){this.scheduleValidation()}}validateCurrentValue(t=false){if(!this.schema)return true;const i=this.currentValue??this.readValueFromChild();this.currentValue=i;const e=this.schema.safeParse(i);const s=e.success;const h=this.isValid;this.isValid=s;if(!e.success){this.errorMessage=e.error.issues[0]?.message??""}else{this.errorMessage=""}const n=t||this.autoValidateActive&&this.hasInteracted;if(n){this.updateAriaValidity(s);if(h!==s){this.emitValidationChange()}}return s}updateAriaValidity(t){if(!this.childEl)return;if(t){this.childEl.removeAttribute("aria-invalid")}else{this.childEl.setAttribute("aria-invalid","true")}}emitValidationChange(){this.validationChange.emit({valid:this.isValid,value:this.currentValue})}attachFormListener(){this.formEl=this.resolveFormRef();this.formEl?.addEventListener("submit",this.handleFormSubmit,true)}detachFormListener(){this.formEl?.removeEventListener("submit",this.handleFormSubmit,true);this.formEl=undefined}resolveFormRef(){if(typeof document!=="undefined"&&this.form){const t=document.getElementById(this.form);if(t&&t instanceof HTMLFormElement){return t}}return this.el.closest("form")}handleFormSubmit=()=>{this.hasInteracted=true;const t=this.flushValidation();if(!t&&!this.autoValidateActive){this.autoValidateActive=true}};scheduleValidation(t=false){this.clearValidationTimer();const i=Number(this.validationDebounce);if(t||!isFinite(i)||i<=0){return this.validateCurrentValue(true)}this.validationTimer=setTimeout((()=>{this.validationTimer=undefined;this.validateCurrentValue(true)}),i);return this.isValid}flushValidation(){return this.scheduleValidation(true)}clearValidationTimer(){if(this.validationTimer!==undefined){clearTimeout(this.validationTimer);this.validationTimer=undefined}}render(){return s(h,{key:"f9484d3a89da8ca80a9b25f9b96c6375bfc83cd8"},s("slot",{key:"bda333316f5768959586dfbc49ee72a529f10b93"}),!this.isValid&&this.showErrorMessage&&s("span",{key:"fcfada1d2104f9116987f42b756122be03d7dc3f",part:"error-message",class:"error-message"},this.errorMessage))}static get watchers(){return{schema:["handleSchemaChange"],autovalidate:["handleAutoValidatePropChange"],form:["handleFormPropChange"],valueEvent:["handleValueEventChange"],blurEvent:["handleBlurEventChange"],value:["handleValuePropChange"]}}};a.style=r;export{a as ir_validator};
//# sourceMappingURL=p-a4955c6e.entry.js.map