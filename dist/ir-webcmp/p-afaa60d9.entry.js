import{r as e,c as t,h as i,F as o,H as a}from"./p-acddcbeb.js";import{b as s,B as n,m as r,s as l,e as c,j as d,c as h,f as p,r as u,o as b}from"./p-ca752bfb.js";import{e as f,K as g,g as m,o as y,f as k,T as _}from"./p-b29f6fd8.js";import{V as D,R as w,B as v,I as x}from"./p-33ef03eb.js";import{h as I}from"./p-6c4ba7c0.js";import{l as B}from"./p-e58470d9.js";import{i as O}from"./p-3b76fc4f.js";import{c as Y}from"./p-d6d6fb27.js";import{z as C}from"./p-e7d273da.js";import{v as M}from"./p-4ed69de7.js";import"./p-bf44a732.js";import"./p-2925ded6.js";class N{hasUnderscore(e){return/_+/.test(e)}variationService;setBookingInfoFromAutoComplete(e,t){e.bookedByInfoData={id:t.guest.id,email:t.guest.email,firstName:t.guest.first_name,lastName:t.guest.last_name,countryId:t.guest.country_id,isdCode:t.guest?.country_phone_prefix??t.guest?.country_id.toString(),contactNumber:t.guest.mobile,selectedArrivalTime:t.arrival,emailGuest:t.guest.subscribe_to_news_letter,message:t.remark,cardNumber:"",cardHolderName:"",expiryMonth:"",expiryYear:"",bookingNumber:t.booking_nbr,rooms:t.rooms,from_date:t.from_date,to_date:t.to_date}}resetRoomsInfoAndMessage(e){e.defaultData.roomsInfo=[];e.message=""}onDataRoomUpdate(e,t,i,o,a){let s=t;const{data:n,key:r,changedKey:l}=e.detail;const c=`c_${n.roomCategoryId}`;const d=`p_${n.ratePlanId}`;if(this.shouldClearData(r)){s=new Map}this.initializeRoomCategoryIfNeeded(c,s);if(o){if(l==="rate"){if(s.has(c)&&s.get(c).has(d)){this.applyBookingEditToSelectedRoom(c,d,n,s,a,i)}}else{if(l!=="rateType"){if(l==="adult_child_offering"){if(s.has(c)&&t.get(c).has(d)){this.applyBookingEditToSelectedRoom(c,d,n,s,a,i)}}else{this.applyBookingEditToSelectedRoom(c,d,n,s,a,i)}}}}else{this.setSelectedRoomData(c,d,n,s)}this.cleanupEmptyData(c,s);return s}shouldClearData(e){return e==="clearData"||e==="EDIT_BOOKING"}initializeRoomCategoryIfNeeded(e,t){if(!t.has(e)){t.set(e,new Map)}}setSelectedRoomData(e,t,i,o){let a=o.get(e);if(i.totalRooms===0||i.inventory===0){a.delete(t)}else{o.set(e,a.set(t,{...i,selectedUnits:Array(i.totalRooms).fill(-1)}))}}cleanupEmptyData(e,t){if(t.has(e)){let i=t.get(e);if(i.size===0){t.delete(e)}}}applyBookingEditToSelectedRoom(e,t,i,o,a,s){o.clear();let n={};if(s){n={...i,guestName:a||"",roomId:""}}else{n={...i}}o.set(e,(new Map).set(t,n))}calculateAmount({is_amount_modified:e,selected_variation:t,view_mode:i,rp_amount:o}){const a=t.nights.length;if(e){return i==="002"?o:o/a}}generateDailyRates(e,t){let i=e.selected_variation;const o=e.is_amount_modified?this.calculateAmount(e):null;if(e.guest[t].infant_nbr>0&&!e.is_amount_modified){if(!this.variationService){this.variationService=new D}i=this.variationService.getVariationBasedOnInfants({variations:e.ratePlan.variations,baseVariation:e.selected_variation,infants:e.guest[t].infant_nbr})}return i.nights.map((e=>({date:e.night,amount:o??e.discounted_amount,cost:null})))}getBookedRooms({check_in:e,check_out:t,notes:i,identifier:o,override_unit:a,unit:n,auto_check_in:r}){const l=[];for(const c in s.ratePlanSelections){const d=s.ratePlanSelections[c];for(const s in d){const c=d[s];if(c.reserved>0){for(let s=0;s<c.reserved;s++){const{first_name:d,last_name:h}=c.guest[s];l.push({identifier:o,roomtype:c.roomtype,rateplan:c.ratePlan,prepayment_amount_gross:0,unit:a?{id:n}:c.guest[s].unit?{id:c.guest[s].unit}:null,occupancy:{adult_nbr:c.selected_variation.adult_nbr,children_nbr:Number(c.selected_variation.child_nbr??0)-Math.max(Number(c.guest[s].infant_nbr??0),0),infant_nbr:c.guest[s].infant_nbr},bed_preference:c.guest[s].bed_preference,from_date:I(e).format("YYYY-MM-DD"),to_date:I(t).format("YYYY-MM-DD"),notes:i,check_in:r,days:this.generateDailyRates(c,s),guest:{email:null,first_name:d,last_name:h,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null,cci:null}})}}}}return l}async prepareBookUserServiceParams({context:e,check_in:t}){try{if(!e||!e.dateRangeData){throw new Error("Invalid context: Missing date range data.")}const i=new Date(e.dateRangeData.fromDate);const o=new Date(e.dateRangeData.toDate);const a=(t=null,a=false)=>this.getBookedRooms({check_in:i,check_out:o,identifier:t,notes:"",override_unit:e.isEventType("BAR_BOOKING")?true:false,unit:e.isEventType("BAR_BOOKING")?e.bookingData.PR_ID:null,auto_check_in:a});const n=({pickup_info:e,extra_services:t,is_direct:i,is_in_loyalty_mode:o,promo_key:a,extras:s,...n},r)=>({assign_units:true,is_pms:true,is_direct:i,is_backend:true,is_in_loyalty_mode:o,promo_key:a,extras:s,booking:{...n,rooms:r},extra_services:t,pickup_info:e});let r=null;const l=s.bookingDraft.source;console.log({sourceOption:l});console.log({event_type:e.defaultData.event_type,defaultData:e.defaultData});switch(e.defaultData.event_type){case"EDIT_BOOKING":{const{booking:t,currentRoomType:i}=e.defaultData;const o=t.rooms.filter((e=>e.identifier!==i.identifier));console.log("currentRoomType",i);const s=a(i.identifier,i.in_out?.code==="001");r=n(t,[...o,...s]);break}case"ADD_ROOM":case"SPLIT_BOOKING":{const{booking:t}=e.defaultData;if(!t){throw new Error("Missing booking")}const i=a();const o=t.rooms;r=n(t,[...o,...i]);break}default:{const n=a(null,t);const{bookedByInfoData:c}=e;const d=l.type==="TRAVEL_AGENCY";r={assign_units:true,is_pms:true,is_direct:true,is_backend:true,is_in_loyalty_mode:false,promo_key:null,extras:[...f.filter((e=>e.key!=="payment_code")),{key:"payment_code",value:s.selectedPaymentMethod?.code}],agent:d?{id:l.tag}:null,booking:{from_date:I(i).format("YYYY-MM-DD"),to_date:I(o).format("YYYY-MM-DD"),remark:c.message||null,booking_nbr:"",property:{id:e.propertyid},booked_on:{date:I().format("YYYY-MM-DD"),hour:(new Date).getHours(),minute:(new Date).getMinutes()},source:d?"":l,rooms:n,currency:e.currency,arrival:{code:c.selectedArrivalTime},guest:{email:c.email===""?null:c.email||null,first_name:c.firstName,last_name:c.lastName,country_id:c.countryId===""?null:c.countryId,city:null,mobile:c.contactNumber===null?"":this.hasUnderscore(c.contactNumber)?"":c.contactNumber,country_phone_prefix:c?.isdCode??null,address:"",dob:null,subscribe_to_news_letter:c.emailGuest||false,cci:c.cardNumber?{nbr:c.cardNumber,holder_name:c.cardHolderName,expiry_month:c.expiryMonth,expiry_year:c.expiryYear}:null}},pickup_info:null};break}}return r}catch(e){console.error(e)}}getRoomCategoryByRoomId(e){return e.roomsInfo?.find((t=>t.id===e.RATE_TYPE))}setEditingRoomInfo(e,t){const i=this.getRoomCategoryByRoomId(e);const o=!i?"":`c_${i?.id}`;const a=`p_${e.RATE_PLAN_ID}`;const s={adultCount:e.ADULTS_COUNT,rate:e.RATE,rateType:e.RATE_TYPE,ratePlanId:e.RATE_PLAN_ID,roomCategoryId:i?i.id:"",roomCategoryName:i?i.name:"",totalRooms:1,ratePlanName:e.RATE_PLAN,roomId:e.PR_ID,guestName:e.NAME,cancelation:e.cancelation,guarantee:e.guarantee,adult_child_offering:e.adult_child_offering};t.set(o,(new Map).set(a,s))}}const T=".sc-igl-book-property-h{position:fixed;top:0;right:0;width:100vw;min-height:100vh;z-index:99;overflow:hidden}.card-title.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%}.card-header-container.sc-igl-book-property{border-bottom:1px solid #e4e5ec;width:100%;display:flex;align-items:center;box-sizing:border-box;padding:1rem 0;justify-content:space-between}.fd-book-property__title.sc-igl-book-property{margin:0;padding:0;font-family:var(--wa-font-family-heading);font-weight:var(--wa-font-weight-heading);line-height:var(--wa-line-height-condensed);text-wrap:balance;font-size:var(--wa-font-size-l)}.loading-container.sc-igl-book-property{height:100%;width:100%;display:flex;justify-content:center;align-items:center;margin:0;padding:0}.card-header-container.sc-igl-book-property h3.sc-igl-book-property{padding:0;margin:0}.background-overlay.sc-igl-book-property{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.25)}.formContainer.sc-igl-book-property{height:calc(100% - 79px);overflow:auto}.gap-30.sc-igl-book-property{gap:30px}.block-date.sc-igl-book-property{width:100%}.sideWindow.sc-igl-book-property{position:absolute;inset:0;left:unset;background-color:#ffffff;width:100%;overflow:auto;animation:slideInFromRight 0.5s}.card.sc-igl-book-property{top:0;z-index:1000}.close.sc-igl-book-property{float:right;font-size:1.5rem;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;opacity:0.5;padding:0;background-color:transparent;border:0;appearance:none}.close-icon.sc-igl-book-property{position:absolute;top:18px;right:33px;outline:none}button.sc-igl-book-property:not(:disabled),[type='button'].sc-igl-book-property:not(:disabled){cursor:pointer}.sheet-footer.sc-igl-book-property{width:100%}.card-header-container.sc-igl-book-property{--spacing:var(--wa-space-l);padding:0;display:flex;flex-wrap:nowrap;padding-inline-start:var(--spacing);padding-block-end:0;padding-inline-end:calc(var(--spacing) - var(--wa-form-control-padding-block));padding-block-start:calc(var(--spacing) - var(--wa-form-control-padding-block));border-bottom:1px solid var(--wa-color-surface-border);padding-bottom:calc(var(--spacing) / 2);background-color:var(--wa-color-surface-default)}@media only screen and (min-width: 1200px){.sideWindow.sc-igl-book-property{max-width:70%}}@media only screen and (min-width: 2000px){.sideWindow.sc-igl-book-property{max-width:40%}}@media only screen and (min-width: 768px) and (max-width: 1200px){.sideWindow.sc-igl-book-property{max-width:90%}}@media only screen and (min-width: 600px) and (max-width: 768px){.sideWindow.sc-igl-book-property{max-width:75%}}@media only screen and (min-width: 641px){.block-date.sc-igl-book-property{max-width:450px;padding-bottom:0 !important}}@keyframes slideInFromRight{from{transform:translateX(120%)}to{transform:translateX(0)}}@keyframes slideOutToRight{from{transform:translateX(0)}to{transform:translateX(120%)}}.sideWindow--exit.sc-igl-book-property{animation:slideOutToRight 0.5s forwards}";const E=T;const R=".sc-igl-book-property-h{height:100%}.sheet-container.sc-igl-book-property{display:flex !important;flex-direction:column !important;background:white;height:100vh;gap:1rem;z-index:1000}.sheet-container.sc-igl-book-property{height:-webkit-fill-available;height:100vh;height:100dvh}.sheet-footer.sc-igl-book-property{position:sticky;bottom:0;z-index:20;background:white;border-top:1px solid #e4e5ec;display:flex;flex-direction:column;padding:1rem;gap:0.5rem}.sheet-header.sc-igl-book-property{position:sticky;top:0;z-index:10;background:white}.sheet-body.sc-igl-book-property{flex:1 1 0%}@media (min-width: 768px){.sheet-footer.sc-igl-book-property{flex-direction:row;align-items:center}}";const A=R;const S=class{constructor(i){e(this,i);this.closeBookingWindow=t(this,"closeBookingWindow",7);this.blockedCreated=t(this,"blockedCreated",7);this.resetBookingEvt=t(this,"resetBookingEvt",7);this.animateIrButton=t(this,"animateIrButton",7);this.animateIrSelect=t(this,"animateIrSelect",7);this.toast=t(this,"toast",7)}propertyid;allowedBookingSources;language;countries;showPaymentDetails=false;currency;bookingData;adultChildConstraints;renderAgain=false;dateRangeData;defaultData;isLoading;bookingHistory=[];closeBookingWindow;blockedCreated;resetBookingEvt;animateIrButton;animateIrSelect;toast;initialRoomIds=null;page;showSplitBookingOption=false;guestData=[];bookedByInfoData={};blockDatesData={};ratePricingMode=[];selectedUnits=new Map;bedPreferenceType=[];bookingService=new n;bookPropertyService=new N;defaultDateRange;updatedBooking=false;MAX_HISTORY_LENGTH=2;didReservation;wasBlockedUnit;async componentWillLoad(){if(s.roomTypes){r("roomTypes",[]);r("ratePlanSelections",{})}this.handleKeyDown=this.handleKeyDown.bind(this);this.initializeDefaultDateRange();if(!this.bookingData.defaultDateRange){return}this.initializeDefaultData();this.wasBlockedUnit=this.defaultData.hasOwnProperty("block_exposed_unit_props");r("event_type",{type:this.defaultData.event_type});this.fetchSetupEntriesAndInitialize()}componentDidLoad(){document.addEventListener("keydown",this.handleKeyDown);g(true)}disconnectedCallback(){document.removeEventListener("keydown",this.handleKeyDown)}clearBooking(e){if(this.isEventType("SPLIT_BOOKING")){e.stopImmediatePropagation();e.stopPropagation();this.bookedByInfoData={};this.bookPropertyService.resetRoomsInfoAndMessage(this);this.renderPage()}}async handleSpiltBookingSelected(e){e.stopImmediatePropagation();e.stopPropagation();const{key:t,data:i}=e.detail;if(t==="select"||t==="blur"&&i!==""){const e=await this.bookingService.getExposedBooking(i.booking_nbr||i,this.language);this.defaultData={...this.defaultData,booking:e};this.bookPropertyService.setBookingInfoFromAutoComplete(this,e);const t=s.selects.sources.find((t=>t.code===e.source.code));l({source:t});this.renderPage()}}onDateRangeSelect(e){e.stopImmediatePropagation();e.stopPropagation();c(false);const t=e.detail;this.updateBookingHistory({dates:{checkIn:new Date(this.dateRangeData.fromDate),checkOut:new Date(new Date(t.data.toDate))}});if(t.key==="selectedDateRange"){this.dateRangeData=t.data;if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){this.defaultData.roomsInfo=[]}}}gotoSplitPageTwo(){this.gotoPage("page_two")}handleButtonClicked(e){switch(e.detail.key){case"save":this.bookUser(false);break;case"cancel":e.stopImmediatePropagation();e.stopPropagation();this.closeWindow();break;case"back":e.stopImmediatePropagation();e.stopPropagation();if(this.isEventType("BAR_BOOKING")){h()}this.gotoPage("page_one");break;case"book":this.bookUser(false);break;case"bookAndCheckIn":this.bookUser(true);break;case"next":e.stopImmediatePropagation();e.stopPropagation();if(!s.bookingDraft.occupancy?.adults){this.animateIrSelect.emit("adult_child_select");break}if(d()>0){this.gotoPage("page_two");break}else if(this.defaultData?.roomsInfo.length===0){this.animateIrButton.emit("check_availability");break}this.toast.emit({type:"error",description:B.entries.Lcz_SelectRatePlan,title:B.entries.Lcz_SelectRatePlan});break;case"check":this.checkBookingAvailability();break}}updateBookingHistory(e){const t=this.bookingHistory[this.bookingHistory.length-1];const i={dates:{checkIn:e.dates?.checkIn||t?.dates?.checkIn||new Date(this.dateRangeData.fromDate),checkOut:e.dates?.checkOut||t?.dates?.checkOut||new Date(this.dateRangeData.toDate)},adults:e.adults??t?.adults??s.bookingDraft.occupancy?.adults,children:e.children??t?.children??s.bookingDraft.occupancy.children};this.bookingHistory.push(i);if(this.bookingHistory.length>this.MAX_HISTORY_LENGTH){this.bookingHistory.shift()}}handleKeyDown(e){if(e.key==="Escape"){this.closeWindow()}}initializeDefaultDateRange(){this.defaultDateRange={from_date:this.bookingData.FROM_DATE,to_date:this.bookingData.TO_DATE}}initializeDefaultData(){this.defaultData=this.bookingData;this.dateRangeData={...this.defaultData.defaultDateRange};l({dates:{checkIn:I(this.defaultData.defaultDateRange.fromDate),checkOut:I(this.defaultData.defaultDateRange.toDate)}})}async fetchSetupEntriesAndInitialize(){try{const e=await this.fetchSetupEntries();this.setSourceOptions(this.allowedBookingSources);this.setOtherProperties(e);this.initializeEventData()}catch(e){console.error("Error fetching setup entries:",e)}}initializeEventData(){if(this.isEventType("EDIT_BOOKING")){this.initializeEditBookingData()}if(!this.isEventType("BAR_BOOKING")){this.bookPropertyService.resetRoomsInfoAndMessage(this)}this.initializePage()}initializeEditBookingData(){l({occupancy:{adults:Number(this.defaultData.ADULTS_COUNT),children:Number(this.defaultData.CHILDREN_COUNT)}});this.initialRoomIds={roomName:this.defaultData.roomName,ratePlanId:this.defaultData.RATE_PLAN_ID,roomId:this.defaultData.PR_ID,roomTypeId:this.defaultData.RATE_TYPE};const{currentRoomType:e,GUEST:t}=this.defaultData;r("guest",{bed_preference:e.bed_preference?.toString(),infant_nbr:e.occupancy.infant_nbr,first_name:t.first_name??"",last_name:t.last_name??"",unit:e.unit?.id?.toString()});this.checkBookingAvailability();this.bookPropertyService.setEditingRoomInfo(this.defaultData,this.selectedUnits)}initializePage(){switch(this.defaultData.event_type){case"SPLIT_BOOKING":this.showSplitBookingOption=true;this.page="page_one";break;case"BLOCK_DATES":this.page="page_block_date";break;default:this.page="page_one";break}}async fetchSetupEntries(){return await this.bookingService.fetchSetupEntries()}isGuestDataIncomplete(){for(const e in s.ratePlanSelections){const t=s.ratePlanSelections[e];for(const e in t){const i=t[e];if(i.reserved>0){for(const e of i.guest){w.parse({...e,requires_bed_preference:i.roomtype.is_bed_configuration_enabled})}}}}return false}setSourceOptions(e){const t=this.isEventType("BAR_BOOKING")?this.getFilteredSourceOptions(e):e;p({sources:t});let i;if(this.isEventType("EDIT_BOOKING")){const t=e.find((e=>this.defaultData.SOURCE?.code===e.code));i=t}else{i=t.find((e=>e.type!=="LABEL"))}l({source:i})}getFilteredSourceOptions(e){const t=new Set;const i=this.bookingData?.roomsInfo?.some((e=>{const i=e?.rateplans??[];if(i.length===0)return false;const o=i.every((e=>(e?.agents?.length??0)>0));if(o){i.forEach((e=>{(e?.agents??[]).forEach((e=>t.add(e?.id?.toString())))}))}return o}))??false;if(!i){return e}return e.filter((e=>{if(e?.type==="LABEL")return true;const i=e?.tag;const o=i!=null&&t.has(i);return o}))}setOtherProperties(e){this.ratePricingMode=e?.ratePricingMode;this.bookedByInfoData.arrivalTime=e.arrivalTime;this.bedPreferenceType=e.bedPreferenceType}async checkBookingAvailability(){c(false);const{source:e,occupancy:t}=s.bookingDraft;const i=I(this.dateRangeData.fromDate).format("YYYY-MM-DD");const o=I(this.dateRangeData.toDate).format("YYYY-MM-DD");const a=e?.type==="TRAVEL_AGENCY";try{const s=this.isEventType("EDIT_BOOKING")?[this.defaultData.RATE_TYPE]:[];const n=this.isEventType("BAR_BOOKING")?this.defaultData.roomsInfo.map((e=>e.id)):[];const r=await this.bookingService.getBookingAvailability({from_date:i,to_date:o,propertyid:this.propertyid,adultChildCount:{adult:t.adults,child:t.children},language:this.language,room_type_ids:n,currency:this.currency,agent_id:a?e?.tag:null,is_in_agent_mode:a,room_type_ids_to_update:s});if(!this.isEventType("EDIT_BOOKING")){this.defaultData.defaultDateRange.fromDate=new Date(this.dateRangeData.fromDate);this.defaultData.defaultDateRange.toDate=new Date(this.dateRangeData.toDate)}this.defaultData={...this.defaultData,roomsInfo:r};if(this.isEventType("EDIT_BOOKING")&&!this.updatedBooking){this.updateBooking()}}catch(e){console.error("Error initializing booking availability:",e)}}updateBooking(){try{const{currentRoomType:e,GUEST:t}=this.defaultData;const i=e.roomtype.id;const o=e.rateplan.id;const a={bed_preference:e.bed_preference?.toString(),infant_nbr:e.occupancy.infant_nbr,last_name:t.last_name,first_name:t.first_name,unit:e.unit?.id?.toString(),roomtype_id:e.roomtype.id};r("guest",a);u({roomTypeId:i,ratePlanId:o,rooms:1,guest:[a]})}catch(e){console.error(e)}}async checkAndBlockDate(){try{const{block_exposed_unit_props:e}=this.defaultData;await this.bookingService.getBookingAvailability({from_date:e.from_date,to_date:e.to_date,propertyid:this.propertyid,adultChildCount:{adult:2,child:0},language:this.language,room_type_ids:this.defaultData.roomsInfo.map((e=>e.id)),currency:this.currency});const t=s.roomTypes.every((e=>{if(e.is_available_to_book){return true}return e.inventory>0&&e["not_available_reason"]==="ALL-RATES-PLAN-NOT-BOOKABLE"}));if(t){await this.handleBlockDate(false)}else{console.warn("Blocked date is unavailable. Continuing...")}}catch(e){console.error("Error checking and blocking date:",e)}}async closeWindow(){c(true);g(false);if(this.wasBlockedUnit&&!this.didReservation){await this.checkAndBlockDate()}const e=document.querySelector(".sideWindow");if(!e)return;e.classList.add("sideWindow--exit");setTimeout((()=>{this.closeBookingWindow.emit();document.removeEventListener("keydown",this.handleKeyDown)}),300)}isEventType(e){return this.defaultData.event_type===e}handleBlockDateUpdate(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;this.blockDatesData=t.data}handleGuestInfoUpdate(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;if(t.guestRefKey){if(this.isEventType("BAR_BOOKING")||this.wasBlockedUnit||this.isEventType("SPLIT_BOOKING")){this.guestData[t.guestRefKey]={...t.data,roomId:this.defaultData.PR_ID}}else this.guestData[t.guestRefKey]=t.data}}handleBookedByInfoUpdate(e){e.stopImmediatePropagation();e.stopPropagation();const t=e.detail;this.bookedByInfoData=t.value.data}renderPage(){this.renderAgain=!this.renderAgain}gotoPage(e){this.page=e;this.renderPage()}getPageBlockDatesView(){return i(o,null,i("igl-block-dates-view",{fromDate:this.defaultData.FROM_DATE,toDate:this.defaultData.TO_DATE,entryDate:this.defaultData.ENTRY_DATE,onDataUpdateEvent:e=>this.handleBlockDateUpdate(e)}))}handlePageTwoDataUpdateEvent(e){e.stopImmediatePropagation();e.stopPropagation();if(e.detail.key==="propertyBookedBy"){this.handleBookedByInfoUpdate(e)}else{this.handleGuestInfoUpdate(e)}}async handleBlockDate(e=true){const t=this.wasBlockedUnit?this.defaultData.block_exposed_unit_props:(()=>{const e=m(+this.blockDatesData.RELEASE_AFTER_HOURS);return{from_date:y(this.defaultData.defaultDateRange.fromDate),to_date:y(this.defaultData.defaultDateRange.toDate),NOTES:this.blockDatesData.OPTIONAL_REASON||"",pr_id:this.defaultData.PR_ID.toString(),STAY_STATUS_CODE:this.blockDatesData.OUT_OF_SERVICE?"004":this.blockDatesData.RELEASE_AFTER_HOURS===0?"002":"003",DESCRIPTION:this.blockDatesData.RELEASE_AFTER_HOURS||"",...e}})();await this.bookingService.blockUnit(t);if(e)this.closeWindow()}async bookUser(e){try{this.setLoadingState(e);if(!this.isEventType("EDIT_BOOKING")&&!this.isEventType("ADD_ROOM")){v.parse({first_name:this.bookedByInfoData?.firstName,last_name:this.bookedByInfoData?.lastName})}this.isGuestDataIncomplete();const t=this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM");if(t){this.bookedByInfoData.message=this.defaultData.NOTES}this.didReservation=true;const i=await this.bookPropertyService.prepareBookUserServiceParams({context:this,check_in:e});await this.bookingService.doReservation(i);await this.adjustBlockedDatesAfterReservation(i);this.resetBookingEvt.emit(null);this.resetLoadingState()}catch(e){console.error("Error booking user:",e);this.isLoading=null}}async adjustBlockedDatesAfterReservation(e){if(!this.wasBlockedUnit){return}const t=I(this.defaultData.block_exposed_unit_props.from_date,"YYYY-MM-DD");const i=I(e.booking.from_date,"YYYY-MM-DD");const o=I(this.defaultData.block_exposed_unit_props.to_date,"YYYY-MM-DD");const a=I(e.booking.to_date,"YYYY-MM-DD");if(a.isBefore(o,"days")){const e={...this.defaultData.block_exposed_unit_props,from_date:a.format("YYYY-MM-DD")};await this.bookingService.blockUnit(e)}if(i.isAfter(t,"days")){const e={...this.defaultData.block_exposed_unit_props,to_date:i.format("YYYY-MM-DD")};await this.bookingService.blockUnit(e)}return}setLoadingState(e){if(this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")){this.isLoading="save"}else{this.isLoading=e?"bookAndCheckIn":"book"}}resetLoadingState(){this.isLoading="";setTimeout((()=>{this.closeWindow()}),100)}getCurrentPage(e){return this.page===e}render(){return i(a,{key:"e2a60b92dcfd826614d70e7ee49d7c15217ef157","data-testid":"book_property_sheet h-100"},i("div",{key:"3b025d509236dfc7dbc6df96acaa9d8e088af1cb",class:"background-overlay",onClick:()=>this.closeWindow()}),i("div",{key:"b7bb556a64d46b0032797147a2640ea2aaa67176",class:"sideWindow sheet-container "+(this.getCurrentPage("page_block_date")?"block-date":"")},O("/Get_Setup_Entries_By_TBL_NAME_MULTI")?i("div",{class:"loading-container"},i("ir-spinner",null)):i(o,null,i("div",{class:"sheet-header"},i("div",{class:"card-header-container"},i("h2",{class:"fd-book-property__title"},this.getCurrentPage("page_block_date")?this.defaultData.BLOCK_DATES_TITLE:this.defaultData.TITLE),i("ir-custom-button",{appearance:"plain",variant:"neutral",size:"medium",onClickHandler:()=>this.closeWindow()},i("wa-icon",{name:"xmark",library:"system",variant:"solid",label:"Close","aria-label":"Close"})))),i("div",{class:"px-2 sheet-body"},this.getCurrentPage("page_one")&&i("igl-booking-overview-page",{wasBlockedUnit:this.wasBlockedUnit,initialRoomIds:this.initialRoomIds,defaultDaterange:this.defaultDateRange,eventType:this.defaultData.event_type,selectedRooms:this.selectedUnits,currency:this.currency,showSplitBookingOption:this.showSplitBookingOption,ratePricingMode:this.ratePricingMode,dateRangeData:this.dateRangeData,bookingData:this.defaultData,bookedByInfoData:this.bookedByInfoData,adultChildConstraints:this.adultChildConstraints,propertyId:this.propertyid}),this.getCurrentPage("page_two")&&i("igl-booking-form",{currency:this.currency,propertyId:this.propertyid,showPaymentDetails:this.showPaymentDetails,selectedGuestData:this.guestData,countries:this.countries,isLoading:this.isLoading,selectedRooms:this.selectedUnits,bedPreferenceType:this.bedPreferenceType,dateRangeData:this.dateRangeData,bookingData:this.defaultData,showSplitBookingOption:this.showSplitBookingOption,language:this.language,bookedByInfoData:this.bookedByInfoData,defaultGuestData:this.defaultData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),onDataUpdateEvent:e=>this.handlePageTwoDataUpdateEvent(e)}),this.getCurrentPage("page_block_date")?this.getPageBlockDatesView():null),this.getCurrentPage("page_block_date")?i("div",{class:"sheet-footer"},i("ir-button",{text:B.entries.Lcz_Cancel,btn_color:"secondary",class:"flex-fill",onClick:()=>this.closeWindow()}),i("ir-button",{text:B.entries.Lcz_Blockdates,isLoading:O("/Block_Exposed_Unit"),class:"flex-fill",onClick:()=>this.handleBlockDate()})):i("igl-book-property-footer",{page:this.page,dateRangeData:this.dateRangeData,isEditOrAddRoomEvent:this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM"),isLoading:this.isLoading,class:"sheet-footer",eventType:this.bookingData.event_type}))))}};S.style=E+A;const G=".sc-igl-book-property-footer-h{width:100% !important;background:#000}";const L=G;const P=class{constructor(i){e(this,i);this.buttonClicked=t(this,"buttonClicked",7)}eventType;page;isEditOrAddRoomEvent;dateRangeData;isLoading;buttonClicked;isEventType(e){return e===this.eventType}editNext(e){if(this.isEventType("EDIT_BOOKING")){if(e==="Cancel"){return"flex-fill"}else{return"d-none d-md-block  flex-fill"}}return"flex-fill"}renderButton({label:e,type:t="button",disabled:o=false,isLoading:a,appearance:s,variant:n,value:r,form:l}){return i("div",{class:this.shouldRenderTwoButtons()?` ${this.editNext(e)}`:"flex-fill"},i("ir-custom-button",{type:t,form:l,size:"medium",loading:a,appearance:s,variant:n,disabled:o,onClickHandler:()=>{this.buttonClicked.emit({key:r})},class:"full-width"},e))}shouldRenderTwoButtons(){return this.isEventType("PLUS_BOOKING")||this.isEventType("ADD_ROOM")||this.isEventType("EDIT_BOOKING")}render(){if(this.page==="page_one"){return i(a,null,this.isEventType("EDIT_BOOKING")?i(o,null,this.renderButton({value:"cancel",label:B.entries.Lcz_Cancel,appearance:"filled",variant:"neutral"}),this.shouldRenderTwoButtons()&&this.renderButton({value:"next",label:`${B.entries.Lcz_Next}`,icon_name:"angles_right",variant:"brand",appearance:"accent"})):i(o,null,this.renderButton({value:"cancel",label:B.entries.Lcz_Cancel,appearance:"filled",variant:"neutral"}),this.shouldRenderTwoButtons()&&this.renderButton({value:"next",label:`${B.entries.Lcz_Next}`,icon_name:"angles_right",variant:"brand",appearance:"accent"})))}const e=Y.checkin_enabled&&I(new Date(this.dateRangeData?.fromDate)).isSame(new Date,"day");return i(o,null,this.isEditOrAddRoomEvent?i(o,null,this.renderButton({value:"back",icon_position:"left",label:B.entries.Lcz_Back,icon_name:"angles_left",appearance:"filled",variant:"neutral"}),this.renderButton({value:"save",label:B.entries.Lcz_Save,isLoading:this.isLoading==="save",variant:"brand",appearance:"accent"})):i(o,null,this.renderButton({value:"back",icon_position:"left",label:B.entries.Lcz_Back,icon_name:"angles_left",appearance:"filled",variant:"neutral"}),this.renderButton({value:"book",type:"submit",form:"new_booking_form",label:B.entries.Lcz_Book,isLoading:this.isLoading==="book",variant:"brand",appearance:e?"outlined":"accent"}),e&&this.renderButton({type:"submit",form:"new_booking_form",value:"bookAndCheckIn",label:B.entries.Lcz_BookAndChekcIn,isLoading:this.isLoading==="bookAndCheckIn",variant:"brand",appearance:"accent"})))}};P.style=L;const K=".sc-igl-book-property-header-h{display:flex;flex-direction:column;text-align:start;gap:1rem}.sourceContainer.sc-igl-book-property-header{max-width:350px}.message-label.sc-igl-book-property-header{font-size:80%}.fd-book-property__constraints-container.sc-igl-book-property-header,.fd-book-property__header-container.sc-igl-book-property-header{display:flex;flex-direction:column;gap:0.5rem;flex-wrap:wrap}@media (min-width: 768px){.fd-book-property__constraints-container.sc-igl-book-property-header,.fd-book-property__header-container.sc-igl-book-property-header{flex-direction:row;align-items:center}.fd-book-property__adults-select.sc-igl-book-property-header{width:100px}.fd-book-property__children-select.sc-igl-book-property-header{width:170px}}";const U=K;const z=class{constructor(i){e(this,i);this.splitBookingDropDownChange=t(this,"splitBookingDropDownChange",7);this.checkClicked=t(this,"checkClicked",7);this.buttonClicked=t(this,"buttonClicked",7);this.toast=t(this,"toast",7);this.spiltBookingSelected=t(this,"spiltBookingSelected",7);this.animateIrSelect=t(this,"animateIrSelect",7)}splitBookingId="";bookingData="";minDate;message;bookingDataDefaultDateRange;showSplitBookingOption=false;adultChildConstraints;splitBookings;dateRangeData;bookedByInfoData;defaultDaterange;propertyId;wasBlockedUnit;isLoading;bookings=[];splitBookingDropDownChange;checkClicked;buttonClicked;toast;spiltBookingSelected;animateIrSelect;autoValidate;bookingService=new n;adultAnimationContainer;async fetchExposedBookings(e){this.isLoading=true;this.bookings=await this.bookingService.fetchExposedBookings(e,this.propertyId,I(this.bookingDataDefaultDateRange.fromDate).format("YYYY-MM-DD"),I(this.bookingDataDefaultDateRange.toDate).format("YYYY-MM-DD"));this.isLoading=false}getSplitBookingList(){return i("ir-picker",{mode:"select-async",class:"sourceContainer",debounce:300,"onText-change":e=>{this.fetchExposedBookings(e.detail)},defaultValue:Object.keys(this.bookedByInfoData).length>1?this.bookedByInfoData.bookingNumber?.toString():"",value:Object.keys(this.bookedByInfoData).length>1?this.bookedByInfoData.bookingNumber?.toString():"",label:`${B.entries.Lcz_Tobooking}#`,placeholder:B.entries.Lcz_BookingNumber,loading:this.isLoading,"onCombobox-select":e=>{const t=this.bookings?.find((t=>t.booking_nbr?.toString()===e.detail.item.value));this.spiltBookingSelected.emit({key:"select",data:t})}},this.bookings?.map((e=>{const t=`${e.booking_nbr} ${e.guest.first_name} ${e.guest.last_name}`;return i("ir-picker-item",{value:e.booking_nbr?.toString(),label:t},t)})))}getSourceNode(){const{sources:e}=s.selects;return i("wa-select",{size:"small",placeholder:B.entries.Lcz_Source,value:s.bookingDraft.source?.id?.toString(),defaultValue:s.bookingDraft.source?.id,id:"xSmallSelect","onwa-hide":e=>{e.stopImmediatePropagation();e.stopPropagation()},onchange:t=>{l({source:e.find((e=>e.id===t.target.value))})}},e.map((e=>{if(e.type==="LABEL"){return i("small",null,e.description)}return i("wa-option",{value:e.id?.toString()},e.description)})))}getAdultChildConstraints(){const{adults:e,children:t}=s.bookingDraft.occupancy;return i(o,null,i("ir-validator",{value:e,schema:C.number().min(1),autovalidate:this.autoValidate},i("wa-select",{class:"fd-book-property__adults-select","onwa-hide":e=>{e.stopImmediatePropagation();e.stopPropagation()},onchange:e=>{l({occupancy:{children:t,adults:Number(e.target.value)}})},value:e?.toString(),defaultValue:e?.toString(),placeholder:B.entries.Lcz_AdultsCaption,size:"small"},Array.from(Array(this.adultChildConstraints.adult_max_nbr),((e,t)=>t+1)).map((e=>i("wa-option",{value:e?.toString()},e))))),this.adultChildConstraints.child_max_nbr>0&&i("wa-select",{class:"fd-book-property__children-select","onwa-hide":e=>{e.stopImmediatePropagation();e.stopPropagation()},onchange:t=>l({occupancy:{adults:e,children:Number(t.target.value)}}),defaultValue:t?.toString(),value:t?.toString(),placeholder:this.renderChildCaption(),size:"small"},Array.from(Array(this.adultChildConstraints.child_max_nbr),((e,t)=>t+1)).map((e=>i("wa-option",{value:e?.toString()},e)))))}renderChildCaption(){const e=this.adultChildConstraints.child_max_age;let t=B.entries.Lcz_Years;if(e===1){t=B.entries.Lcz_Year}return`${B.entries.Lcz_ChildCaption} 0 - ${this.adultChildConstraints.child_max_age} ${t}`}handleButtonClicked(){const{occupancy:e}=s.bookingDraft;if(this.isEventType("SPLIT_BOOKING")&&Object.keys(this.bookedByInfoData).length<=1){this.toast.emit({type:"error",title:B.entries.Lcz_ChooseBookingNumber,description:"",position:"top-right"})}else if(this.isEventType("ADD_ROOM")||this.isEventType("SPLIT_BOOKING")){const t=I(new Date(this.bookedByInfoData.to_date||this.defaultDaterange.to_date));const i=I(new Date(this.bookedByInfoData.from_date||this.defaultDaterange.from_date));const o=I(new Date(this.dateRangeData.fromDate));const a=I(new Date(this.dateRangeData.toDate));if(a.isBefore(i)||o.isAfter(t)){this.toast.emit({type:"error",title:`${B.entries.Lcz_CheckInDateShouldBeMAx.replace("%1",I(new Date(this.bookedByInfoData.from_date||this.defaultDaterange.from_date)).format("ddd, DD MMM YYYY")).replace("%2",I(new Date(this.bookedByInfoData.to_date||this.defaultDaterange.to_date)).format("ddd, DD MMM YYYY"))}  `,description:"",position:"top-right"});return}else if(Number(e.adults)===0){this.toast.emit({type:"error",title:B.entries.Lcz_PlzSelectNumberOfGuests,description:"",position:"top-right"});this.autoValidate=true}else{this.buttonClicked.emit({key:"check"})}}else if(Number(e.adults)===0){this.autoValidate=true;this.toast.emit({type:"error",title:B.entries.Lcz_PlzSelectNumberOfGuests,description:"",position:"top-right"})}else{this.buttonClicked.emit({key:"check"})}}isEventType(e){return this.bookingData.event_type===e}getMinDate(){if(this.isEventType("PLUS_BOOKING")){return I().add(-1,"months").startOf("month").format("YYYY-MM-DD")}if(this.wasBlockedUnit){return this.bookingData?.block_exposed_unit_props.from_date}return this.minDate}getMaxDate(){if(!this.bookingData?.block_exposed_unit_props){if(this.isEventType("PLUS_BOOKING")){return I().add(60,"days").format("YYYY-MM-DD")}return undefined}return this.bookingData?.block_exposed_unit_props.to_date}render(){console.log(this.bookingData.event_type);const e=this.showSplitBookingOption?this.getSplitBookingList():this.isEventType("EDIT_BOOKING")||this.isEventType("ADD_ROOM")?false:true;return i(a,{key:"1b73682a2f562aa53c988869323c0e655628c732"},this.isEventType("SPLIT_BOOKING")&&this.getSplitBookingList(),i("div",{key:"afec1a23b8281281392c99ce3997675e1adaafcc",class:`fd-book-property__header-container`},e&&this.getSourceNode(),i("igl-date-range",{key:"07278a34f8e8865fd4456a9142b58101d5a4075d","data-testid":"date_picker",variant:"booking",dateLabel:B.entries.Lcz_Dates,maxDate:this.getMaxDate(),minDate:this.getMinDate(),disabled:this.isEventType("BAR_BOOKING")&&!this.wasBlockedUnit||this.isEventType("SPLIT_BOOKING"),defaultData:this.bookingDataDefaultDateRange}),!this.isEventType("EDIT_BOOKING")&&this.getAdultChildConstraints(),i("ir-custom-button",{key:"efaa2c7a7562a1b78b3b635b42e51b9990c0a661",loading:O("/Check_Availability"),variant:"brand",onClickHandler:()=>this.handleButtonClicked()},B.entries.Lcz_Check)),i("p",{key:"b35046f935132e98d4e6368d8c8c0f9099451515",class:"text-right message-label"},Y.tax_statement))}};z.style=U;const $=".sc-igl-booking-form-h{display:flex;flex-direction:column}";const j=$;const V=class{constructor(i){e(this,i);this.dataUpdateEvent=t(this,"dataUpdateEvent",7);this.buttonClicked=t(this,"buttonClicked",7)}showPaymentDetails;currency;isEditOrAddRoomEvent;dateRangeData;bookingData;showSplitBookingOption;language;bookedByInfoData;propertyId;bedPreferenceType;selectedRooms;isLoading;countries;selectedGuestData;defaultGuestData;selectedBookedByData;guestData;selectedUnits={};dataUpdateEvent;buttonClicked;componentWillLoad(){this.initializeGuestData();this.selectedBookedByData=this.bookedByInfoData}initializeGuestData(){let e=0;const t={...this.selectedUnits};const i=(e,t,i,o)=>{if(i&&o===2){return e*t}return e};this.selectedUnits=t;this.guestData=[];this.selectedRooms.forEach(((o,a)=>{o.forEach((o=>{t[a]=o.selectedUnits;e+=o.totalRooms*i(o.rate,this.dateRangeData.dateDifference,o.isRateModified,o.rateType);for(let e=1;e<=o.totalRooms;e++){this.guestData.push({guestName:"",roomId:"",preference:"",...o})}}))}));this.bookingData.TOTAL_PRICE=e}handleOnApplicationInfoDataUpdateEvent(e,t){const i=e.detail;const o=`c_${i.data.roomCategoryId}`;const a=[...this.selectedUnits[o]||[]];a[t]=i.data.roomId;this.selectedUnits={...this.selectedUnits,[o]:a};this.dataUpdateEvent.emit({key:"applicationInfoUpdateEvent",value:e.detail})}handleEventData(e,t,i){if(t==="application-info"){this.handleOnApplicationInfoDataUpdateEvent(e,i)}else{this.selectedBookedByData=e.detail.data;this.dataUpdateEvent.emit({key:"propertyBookedBy",value:e.detail})}}isGuestDataIncomplete(){if(this.selectedGuestData.length!==this.guestData.length){return true}for(const e of this.selectedGuestData){if(e.guestName===""||e.preference===""||e.roomId===""){return true}}return false}isButtonDisabled(e){const t=(e,t,i)=>{if(!e){return true}if(e===this.selectedGuestData){return this.isGuestDataIncomplete()}if(t==="selectedArrivalTime"){if(e[t]!==undefined){return e[t].code===""}else{return true}}return e[t]===i||e[t]===undefined};return this.isLoading===e||t(this.selectedGuestData,"guestName","")||t(this.selectedBookedByData,"isdCode","")||t(this.selectedBookedByData,"contactNumber","")||t(this.selectedBookedByData,"firstName","")||t(this.selectedBookedByData,"lastName","")||t(this.selectedBookedByData,"countryId",-1)||t(this.selectedBookedByData,"selectedArrivalTime","")||t(this.selectedBookedByData,"email","")}render(){return i("form",{key:"cd1e8e0c9df0ac776b90873975286b85d20cadd0",class:"d-flex flex-column h-100",id:"new_booking_form",autoComplete:"off",onSubmit:e=>{e.preventDefault()}},i("div",{key:"a19cc3ac1f63f17ca6d748cb281826aa9eb24d04",class:"d-flex flex-wrap"},i("ir-date-view",{key:"9ad3fcaac8ab05e8c544e7b6189f4848e7b1074a",class:"mr-1 flex-fill font-weight-bold font-medium-1",from_date:new Date(this.dateRangeData.fromDate),to_date:new Date(this.dateRangeData.toDate),dateOption:"DD MMM YYYY"}),this.guestData.length>1&&i("div",{key:"169ecd6e0d8f8c83f7cd8f1295f70e24e5b5babb",class:"mt-1 mt-md-0 text-right"},B.entries.Lcz_TotalPrice," ",i("span",{key:"858166579d584a1f0771f213ff459b131b5d1cb9",class:"font-weight-bold font-medium-1"},k(this.currency.symbol,this.bookingData.TOTAL_PRICE||"0")))),Object.values(s.ratePlanSelections).map((e=>Object.values(e).map((e=>{const t=e;if(t.reserved===0){return null}return[...new Array(t.reserved)].map(((e,o)=>i("igl-application-info",{totalNights:Number(this.dateRangeData.dateDifference),bedPreferenceType:this.bedPreferenceType,currency:this.currency,guestInfo:t.guest?t.guest[o]:null,bookingType:this.bookingData.event_type,rateplanSelection:t,key:`${t.ratePlan.id}_${o}`,roomIndex:o,baseData:this.bookingData.event_type==="EDIT_BOOKING"?{roomtypeId:this.bookingData.currentRoomType.roomtype.id,unit:this.bookingData.currentRoomType.unit}:undefined})))})))),this.isEditOrAddRoomEvent||this.showSplitBookingOption?null:i("igl-property-booked-by",{propertyId:this.propertyId,countries:this.countries,language:this.language,showPaymentDetails:this.showPaymentDetails,defaultData:this.bookedByInfoData,onDataUpdateEvent:e=>{this.handleEventData(e,"propertyBookedBy",0)}}))}};V.style=j;const W=".sc-igl-booking-overview-page-h{display:block}.sc-igl-booking-overview-page-h>*.sc-igl-booking-overview-page{margin:0;padding:auto}.scrollContent.sc-igl-booking-overview-page{height:calc(100% - 79px);overflow:auto;position:relative}.loading-container.sc-igl-booking-overview-page{display:flex;align-items:center;justify-content:center;height:100%;background:white;position:absolute;inset:0;z-index:100}.loader.sc-igl-booking-overview-page{width:1.25rem;height:1.25rem;border:2.5px solid #3f3f3f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}";const H=W;const F=class{constructor(i){e(this,i);this.roomsDataUpdate=t(this,"roomsDataUpdate",7)}bookingData;propertyId;message;showSplitBookingOption;eventType;currency;adultChildConstraints;ratePricingMode;dateRangeData;defaultDaterange;selectedRooms;bookedByInfoData;initialRoomIds;wasBlockedUnit;roomsDataUpdate;getSplitBookings(){return this.bookingData.hasOwnProperty("splitBookingEvents")&&this.bookingData.splitBookingEvents||[]}isEventType(e){return e===this.eventType}setMinDate(){if(!this.isEventType("EDIT_BOOKING")){return I().format("YYYY-MM-DD")}const e=I(this.bookingData.FROM_DATE,"YYYY-MM-DD");const t=I();if(e.isAfter(t)){return t.add(-2,"weeks").format("YYYY-MM-DD")}return e.add(-2,"weeks").format("YYYY-MM-DD")}render(){return i(a,{key:"8d83ce49af6b764a69d196c3f0c2184d616f9f95"},i("igl-book-property-header",{key:"674c21608b42da29867fa77389f0a9db6e9a1950",wasBlockedUnit:this.wasBlockedUnit,bookedByInfoData:this.bookedByInfoData,defaultDaterange:this.defaultDaterange,dateRangeData:this.dateRangeData,minDate:this.setMinDate(),splitBookingId:this.showSplitBookingOption,bookingData:this.bookingData,message:this.message,bookingDataDefaultDateRange:this.bookingData.defaultDateRange,showSplitBookingOption:this.showSplitBookingOption,adultChildConstraints:this.adultChildConstraints,splitBookings:this.getSplitBookings(),propertyId:this.propertyId}),i("div",{key:"b96f71fe7d2e9d25db562d772fdfc3ee02822e35",class:" text-left"},O("/Check_Availability")&&this.isEventType("EDIT_BOOKING")?i("div",{class:"loading-container"},i("div",{class:"loader"})):i(o,null,s.roomTypes?.map((e=>i("igl-room-type",{isBookDisabled:Object.keys(this.bookedByInfoData).length<=1,key:`room-type-${e.id}`,currency:this.currency,ratePricingMode:this.ratePricingMode,bookingType:this.bookingData.event_type,roomType:e,class:"mt-2 mb-1 p-0","data-testid":`room_type_${e.id}`,id:e.id.toString(),roomTypeId:this.selectedRooms.has(`c_${e.id}`)?e.id:null}))))))}};F.style=H;const X=".sc-igl-property-booked-by-h{display:block}.bookedByEmailContainer.sc-igl-property-booked-by{flex:auto;max-width:350px}.bookedDetailsForm.sc-igl-property-booked-by label.sc-igl-property-booked-by{min-width:125px;max-width:125px}.row.sc-igl-booking-form.sc-igl-property-booked-by{padding:0 !important}.bookedDetailsForm.sc-igl-property-booked-by .form-group.sc-igl-property-booked-by{margin-bottom:10px !important}.bookedDetailsForm.sc-igl-property-booked-by .checkBoxContainer.sc-igl-property-booked-by input.sc-igl-property-booked-by{height:1.2rem !important;width:30px}.property-booked-by__money-transfer-description.sc-igl-property-booked-by *.sc-igl-property-booked-by{margin:0 !important;margin-bottom:0 !important;margin-top:0 !important}.property-booked-by__money-transfer-description.sc-igl-property-booked-by,.property-booked-by__money-transfer-description.sc-igl-property-booked-by .sc-igl-property-booked-by:where(*,*.sc-igl-property-booked-by::before,*.sc-igl-property-booked-by::after){margin:0.5rem !important}.controlContainer.sc-igl-property-booked-by textarea.sc-igl-property-booked-by{height:60px !important}.margin3.sc-igl-property-booked-by{margin-bottom:5px !important}@media (min-width: 768px){.bookedByEmailContainer.sc-igl-property-booked-by{margin-left:37px}}.fd-property-booked-by__guest-form.sc-igl-property-booked-by{display:grid;padding:0;box-sizing:border-box;gap:0.5rem;width:100%;flex:1 1 0%}";const q=X;const J=class{constructor(i){e(this,i);this.dataUpdateEvent=t(this,"dataUpdateEvent",7)}language;showPaymentDetails=false;defaultData;countries=[];propertyId;isButtonPressed=false;bookedByData={id:undefined,email:"",firstName:"",lastName:"",countryId:"",isdCode:"",contactNumber:"",selectedArrivalTime:"",emailGuest:false,message:"",cardNumber:"",cardHolderName:"",expiryMonth:"",expiryYear:""};guests;typedEmail;dataUpdateEvent;bookingService=new n;arrivalTimeList=[];currentMonth="01";country;paymentMethods=[];pickerRef;componentWillLoad(){this.assignCountryCode();this.initializeDateData();this.populateBookedByData();this.paymentMethods=Y.property.allowed_payment_methods.filter((e=>e.is_active&&!e.is_payment_gateway));if(this.paymentMethods.length>0){r("selectedPaymentMethod",{code:this.paymentMethods[0].code})}}handleButtonClicked(e){switch(e.detail.key){case"book":case"bookAndCheckIn":this.isButtonPressed=true;break}}async assignCountryCode(){const e=await this.bookingService.getUserDefaultCountry();const t=e["COUNTRY_ID"];this.country=t;const i=this.countries.find((e=>e.id?.toString()===t?.toString()));this.bookedByData={...this.bookedByData,isdCode:i.phone_prefix.toString(),countryId:t}}initializeDateData(){const e=new Date;const t=e.getMonth()+1;this.currentMonth=t<10?`0${t}`:t.toString()}populateBookedByData(){this.bookedByData=this.defaultData?{...this.bookedByData,...this.defaultData}:{};this.arrivalTimeList=this.defaultData?.arrivalTime||[];this.bookedByData={...this.bookedByData,selectedArrivalTime:this.arrivalTimeList[0].CODE_NAME};if(!this.bookedByData.expiryMonth){this.bookedByData.expiryMonth=this.currentMonth}if(!this.bookedByData.expiryYear){this.bookedByData.expiryYear=(new Date).getFullYear()}}handleDataChange(e,t){this.bookedByData={...this.bookedByData,[e]:e==="emailGuest"?t.target.checked:t.target.value};this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:{...this.bookedByData}});if(e==="firstName"||e==="lastName"){b(true)}if(e==="countryId"){this.bookedByData={...this.bookedByData,isdCode:t.target.value}}}handleCreditCardDataChange(e,t){this.bookedByData[e]=t;this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:{...this.bookedByData}});if(e==="countryId"){this.bookedByData={...this.bookedByData,isdCode:t}}}handleCountryChange(e){this.bookedByData={...this.bookedByData,isdCode:e,countryId:e};this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:{...this.bookedByData}})}updateGuest(e){r("checkout_guest",{...s.checkout_guest??{},...e})}handleComboboxSelect(e){const t=this.guests?.find((t=>t.id?.toString()===e.detail.item.value));if(!t){console.warn(`guest not found with id ${e.detail.item.value}`);return}this.bookedByData.email=t.email;this.bookedByData={...this.bookedByData,id:t.id,firstName:t.first_name,lastName:t.last_name,contactNumber:t.mobile_without_prefix,countryId:t.country_id,isdCode:t["country_phone_prefix"]??t?.country_id};this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:this.bookedByData})}clearEvent(){this.bookedByData={...this.bookedByData,id:"",firstName:"",lastName:"",contactNumber:"",email:"",isdCode:this.country.toString(),countryId:this.country};b(false);this.dataUpdateEvent.emit({key:"bookedByInfoUpdated",data:{...this.bookedByData}})}async fetchGuests(e){this.typedEmail=e;this.guests=await this.bookingService.fetchExposedGuest(e,this.propertyId)}get expiryDate(){const{expiryMonth:e,expiryYear:t}=this.bookedByData;if(!e||!t){return""}const i=t.toString().length===4?t.toString().slice(-2):t.toString();return`${e}/${i}`}render(){return i(a,{key:"fcdad996f336d638bec16736caf5648df0a99979"},i("div",{key:"734d7baac0bafe320b89e36f2857815c29e850a0",class:"text-left mt-3"},i("div",{key:"9eb7e0811d9441a3804f4aa41957d30cc3af807c",class:"d-flex",style:{alignItems:"flex-end",gap:"0.5rem"}},i("ir-picker",{key:"615059746d28869bb513e5fff00fa4e73ece82d7",class:"bookedByEmailContainer m-0 p-0",label:B.entries.Lcz_BookedBy,value:this.bookedByData.email,ref:e=>this.pickerRef=e,"aria-invalid":String(Boolean(this.isButtonPressed&&this.bookedByData.email!==""&&_(this.bookedByData.email))),withClear:true,"onText-change":e=>this.fetchGuests(e.detail),debounce:300,"onInput-picker-blurred":e=>{e.stopPropagation();e.stopImmediatePropagation();const t=this.typedEmail;if(this.bookedByData.email){return}if(this.guests.length===0){if(C.string().email().safeParse(t).success){this.bookedByData={...this.bookedByData,email:t}}else{this.clearEvent();this.pickerRef.clearInput()}}},"onCombobox-clear":e=>{e.stopImmediatePropagation();e.stopPropagation();this.clearEvent()},loading:O("/Fetch_Exposed_Guests"),placeholder:B.entries.Lcz_FindEmailAddress,mode:"select-async","onCombobox-select":this.handleComboboxSelect.bind(this)},this.guests?.map((e=>{const t=`${e.email} - ${e.first_name} ${e.last_name}`;return i("ir-picker-item",{label:t,value:e.id?.toString(),key:e.id},t)}))),i("div",{key:"02732e39091b463b87cb9c327b6902a329a68729",style:{paddingBottom:"0.5rem"}},i("wa-tooltip",{key:"091ab4367d0bc84f455cae3d00d9af77ab1cabe1",for:`main_guest-search-tooltip`},"Leave empty if email is unavailable"),i("wa-icon",{key:"331280d096ee093bbf4873cc2bf8f27b30a76954",name:"circle-info",id:`main_guest-search-tooltip`})))),i("div",{key:"5c9bc704f9fa73cf2dce8a43bc7627a24979bb93",class:"bookedDetailsForm text-left mt-2 font-small-3 "},i("div",{key:"4b4f75cecf62ece573ada8be873f05a10d188201",class:"d-flex flex-column flex-md-row  justify-content-md-between ",style:{gap:"1rem"}},i("div",{key:"4c9c0f11cee81e7d7987583914f5a4e986d5c327",class:"fd-property-booked-by__guest-form "},i("ir-validator",{key:"8ddeee99589e15bc7b1ca96a3ef650242d421b56",value:this.bookedByData.firstName,schema:v.shape.first_name},i("ir-input",{key:"1435d1137db1cc3686cd65c29121c521a176e699","onText-change":e=>{this.updateGuest({first_name:e.detail});this.handleDataChange("firstName",{target:{value:e.detail.trim()}})},defaultValue:this.bookedByData.firstName,value:this.bookedByData.firstName,label:B.entries.Lcz_FirstName,placeholder:B.entries.Lcz_FirstName,required:true,name:"last_name_custom",autocomplete:"family-name"})),i("ir-validator",{key:"600913c4b8fe80ea8f30e90dddb8956e2e71fba9",value:this.bookedByData.lastName,schema:v.shape.last_name},i("ir-input",{key:"80da6af55aaa2a817861c3dce66b24c8a0bb6477","onText-change":e=>{this.updateGuest({last_name:e.detail});this.handleDataChange("lastName",{target:{value:e.detail.trim()}})},name:"first_name_custom",autocomplete:"given-name",defaultValue:this.bookedByData.lastName,value:this.bookedByData.lastName,label:B.entries.Lcz_LastName,placeholder:B.entries.Lcz_LastName,required:true})),i("ir-country-picker",{key:"bffa2947747c32566031bd8a5400a93d397c7564",label:B.entries.Lcz_Country,variant:"modern",testId:"main_guest_country",class:"flex-grow-1 m-0",onCountryChange:e=>this.handleCountryChange(e.detail.id),countries:this.countries,country:this.countries.find((e=>e.id===this.bookedByData.countryId))}),i("ir-mobile-input",{key:"038a2454bc6321a9ec0ce9a341418bd8ed69f95c",size:"small","onMobile-input-change":e=>{this.handleDataChange("contactNumber",{target:{value:e.detail.formattedValue}})},"onMobile-input-country-change":e=>this.handleDataChange("isdCode",{target:{value:e.detail.phone_prefix}}),value:this.bookedByData.contactNumber,countryCode:this.countries.find((e=>e.phone_prefix===this.bookedByData.isdCode))?.code,countries:this.countries}),i("wa-select",{key:"230daefb74438452eaf00ec7b8b688db22074d51",size:"small",label:B.entries.Lcz_YourArrivalTime,"data-testid":"arrival_time","aria-disabled":String(Boolean(this.isButtonPressed&&this.bookedByData.selectedArrivalTime.code==="")),id:M(),defaultValue:this.arrivalTimeList[0].CODE_NAME,value:this.bookedByData.selectedArrivalTime.code,onchange:e=>this.handleDataChange("selectedArrivalTime",e)},this.arrivalTimeList.map((e=>i("wa-option",{value:e.CODE_NAME,selected:this.bookedByData.selectedArrivalTime.code===e.CODE_NAME},e.CODE_VALUE_EN))))),i("div",{key:"d40539969b1d8dfdfea09eba47b09e0cbb199750",class:"p-0 flex-fill  ml-md-3 d-flex flex-column",style:{gap:"0.5rem"}},i("wa-textarea",{key:"cc8e1d1ba939f332341055661e3eb7082af42d00",onchange:e=>this.handleDataChange("message",e),size:"small",value:this.bookedByData.message,defaultValue:this.bookedByData.message,label:B.entries.Lcz_AnyMessageForUs,rows:4}),this.paymentMethods.length>1&&i("wa-select",{key:"b5631dfe2f5d44c325a3d5a07f4905a5c42a84e8",label:"Payment Method",size:"small",value:s?.selectedPaymentMethod?.code,onchange:e=>r("selectedPaymentMethod",{code:e.target.value})},this.paymentMethods.map((e=>i("wa-option",{value:e.code},e.description)))),s.selectedPaymentMethod?.code==="001"&&i(o,{key:"345800f8ad4d3485154c1229c44953c90780b848"},i("ir-input",{key:"8a524826ad185cd31ec13512b18db2d35ae87642",value:this.bookedByData.cardNumber,defaultValue:this.bookedByData.cardNumber,"onText-change":e=>this.handleCreditCardDataChange("cardNumber",e.detail.trim()),label:B.entries.Lcz_CardNumber}),i("ir-input",{key:"3edec98fff6d99ff87dc37dff59c6f3be13feeab",value:this.bookedByData.cardHolderName,defaultValue:this.bookedByData.cardHolderName,"onText-change":e=>this.handleCreditCardDataChange("cardHolderName",e.detail.trim()),label:B.entries.Lcz_CardHolderName}),i("ir-input",{key:"15a1d91ab39b49bba9c3a6ec2d567c130850b5ff","onText-change":e=>{const[t,i]=e.detail.split("/");this.handleCreditCardDataChange("expiryYear",t??"");this.handleCreditCardDataChange("expiryMonth",i??"")},value:this.expiryDate,mask:{mask:"MM/YY",placeholderChar:"_",blocks:{MM:{mask:x.MaskedRange,from:1,to:12,maxLength:2},YY:{mask:x.MaskedRange,from:(new Date).getFullYear()%100,to:(new Date).getFullYear()%100+20,maxLength:2}}},label:B.entries.Lcz_ExpiryDate})),s.selectedPaymentMethod?.code==="005"&&i("div",{key:"6c6ad7aacfd7811f7ad8bfd3ecc59507585b4b97",class:"form-group mt-md-1 mt-1 p-0 d-flex flex-column flex-md-row align-items-md-center"},i("label",{key:"ff96b85561f457fbd55851ea175d3e7bc608acb9",class:"p-0 m-0 margin3"}),i("div",{key:"4ccd0ee48e07c15a56fdc245745f9b9b706bdd24",class:"p-0 m-0  controlContainer flex-fill"},i("div",{key:"fcdf77605ac14d868d16c1a6a612ee0c1e9b4af9",class:"property-booked-by__money-transfer-description",innerHTML:this.paymentMethods.find((e=>e.code==="005"))?.localizables.find((e=>e.language.code.toLowerCase()==="en"))?.description}))),i("wa-checkbox",{key:"5ba31fd3321d238aa48f5cb8a1905da5ef476474",checked:this.bookedByData.emailGuest,onchange:e=>this.handleDataChange("emailGuest",e)},B.entries.Lcz_EmailTheGuest)))))}};J.style=q;export{S as igl_book_property,P as igl_book_property_footer,z as igl_book_property_header,V as igl_booking_form,F as igl_booking_overview_page,J as igl_property_booked_by};
//# sourceMappingURL=p-afaa60d9.entry.js.map