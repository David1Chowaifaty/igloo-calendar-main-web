import{r as t,c as i,h as e,H as s}from"./p-53d64953.js";import{T as o}from"./p-12da89ce.js";import{l as a}from"./p-71768c2d.js";import{N as n}from"./p-c5a1fae3.js";import{v as l}from"./p-4ed69de7.js";import"./p-bf44a732.js";import"./p-6c4ba7c0.js";import"./p-a973aec7.js";import"./p-b859bcd5.js";import"./p-c226aa13.js";const r=".sc-igl-tba-booking-view-h{display:block}.guestTitle.sc-igl-tba-booking-view{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:2px;margin-bottom:5px;margin-top:5px;padding-left:5px;padding-right:5px}.guestTitle.selectedOrder.sc-igl-tba-booking-view{background-color:#f9f9c9}.pointer.sc-igl-tba-booking-view{cursor:pointer}hr.sc-igl-tba-booking-view{margin-top:8px;margin-bottom:0px}.bookingContainer.sc-igl-tba-booking-view{background-color:#ececec}.actionsContainer.sc-igl-tba-booking-view{display:flex;align-items:center;padding:5px !important;width:100%;gap:16px}.room-select.sc-igl-tba-booking-view{flex:1}.selectContainer.sc-igl-tba-booking-view{width:195px;margin-right:8px}.buttonsContainer.sc-igl-tba-booking-view{box-sizing:border-box;display:flex;align-items:center;justify-content:flex-end;padding:0;margin:0;gap:0.5rem}";const c=r;const d=class{constructor(e){t(this,e);this.highlightToBeAssignedBookingEvent=i(this,"highlightToBeAssignedBookingEvent",7);this.openCalendarSidebar=i(this,"openCalendarSidebar",7);this.addToBeAssignedEvent=i(this,"addToBeAssignedEvent",7);this.scrollPageToRoom=i(this,"scrollPageToRoom",7);this.assignRoomEvent=i(this,"assignRoomEvent",7);this.eventData={};this.categoriesData={};this.renderAgain=false;this.selectedRoom=-1;this.isLoading=null;this.highlightSection=false;this.allRoomsList=[];this.toBeAssignedService=new o}componentShouldUpdate(t,i,e){if(e==="selectedDate"&&t!==i){this.highlightSection=false;this.selectedRoom=-1;return true}else if(e==="eventData"&&t!==i){this.selectedRoom=-1;return true}return true}componentWillLoad(){if(this.categoryIndex===0&&this.eventIndex===0){setTimeout((()=>{this.handleHighlightAvailability()}),100)}}highlightBookingEvent(t){let i=t.detail.data;if(i.bookingId!=this.eventData.ID){this.highlightSection=false;this.selectedRoom=-1;this.renderView()}else{this.highlightSection=true;this.renderView()}}onSelectRoom(t){if(t.stopImmediatePropagation){t.stopImmediatePropagation();t.stopPropagation()}this.selectedRoom=parseInt(t.target.value)}async handleAssignUnit(t,i=false){var e,s;try{t.stopImmediatePropagation();t.stopPropagation();if(this.selectedRoom){this.isLoading=i?"checkin":"default";const t=await this.toBeAssignedService.assignUnit({booking_nbr:this.eventData.BOOKING_NUMBER,identifier:this.eventData.ID,pr_id:this.selectedRoom,check_in:i});const o=t.rooms.find((t=>t.identifier===this.eventData.identifier));console.log("room=>",o);if(o&&i){const{adult_nbr:t,children_nbr:i,infant_nbr:a}=o.occupancy;window.dispatchEvent(new CustomEvent("openCalendarSidebar",{detail:{type:"room-guests",payload:{identifier:this.eventData.ID,bookingNumber:this.eventData.BOOKING_NUMBER,checkin:false,roomName:(s=(e=o.unit)===null||e===void 0?void 0:e.name)!==null&&s!==void 0?s:"",sharing_persons:o.sharing_persons,totalGuests:t+i+a}},bubbles:true,composed:true}));console.log("event emitted directly to window ðŸ”¥")}let a=Object.assign(Object.assign({},this.eventData),{PR_ID:this.selectedRoom});this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[a]});this.assignRoomEvent.emit({key:"assignRoom",data:a})}}catch(t){console.log(t)}finally{this.isLoading=null}}handleHighlightAvailability(){this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:this.eventData.ID,fromDate:this.eventData.FROM_DATE}});if(!this.selectedDate){return}let t=[];let i=[];t=this.eventData.availableRooms.map((t=>{i.push({calendar_cell:null,id:t.PR_ID,name:t.roomName});return Object.assign(Object.assign({},t),{defaultDateRange:this.eventData.defaultDateRange,identifier:this.eventData.identifier})}));this.allRoomsList=i;this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:t});this.scrollPageToRoom.emit({key:"scrollPageToRoom",id:this.categoryId,refClass:"category_"+this.categoryId});this.renderView()}handleCloseAssignment(t){t.stopImmediatePropagation();t.stopPropagation();this.highlightSection=false;this.highlightToBeAssignedBookingEvent.emit({key:"highlightBookingId",data:{bookingId:"----"}});this.onSelectRoom({target:{value:""}});this.selectedRoom=-1;this.addToBeAssignedEvent.emit({key:"tobeAssignedEvents",data:[]});this.renderView()}renderView(){this.renderAgain=!this.renderAgain}canCheckIn(){return n({from_date:this.eventData.FROM_DATE,to_date:this.eventData.TO_DATE})}render(){return e(s,{key:"2283ce0f38bcaa8ec4ad697f9ce9f60c2435bb4b"},e("div",{key:"9e38f2432d4b6218c5727618839f146b75812918",class:"bookingContainer",onClick:()=>this.handleHighlightAvailability()},e("div",{key:"b1aa37723ecf811907d395a05abc47a85499de85",class:`guestTitle ${this.highlightSection?"selectedOrder":""} pointer font-small-3`,"data-toggle":"tooltip","data-placement":"top","data-original-title":"Click to assign unit"},`Book# ${this.eventData.BOOKING_NUMBER} - ${this.eventData.NAME}`),e("div",{key:"e7d97d392ed06c72ce22c9d3cf05c3732b304ce6",class:"row m-0 p-0 actionsContainer"},e("select",{key:"2bba2442bb07427601717f249db0f918ab39ae3a",class:"form-control input-sm room-select flex-grow-1",id:l(),onChange:t=>this.onSelectRoom(t)},e("option",{key:"2eb18fdf2db3190cb4ef70a0884cf6213c1b3d05",value:"",selected:this.selectedRoom==-1},a.entries.Lcz_AssignUnit),this.allRoomsList.map((t=>e("option",{value:t.id,selected:this.selectedRoom==t.id},t.name)))),this.highlightSection?e("div",{class:"buttonsContainer bg-red"},e("button",{type:"button",class:"btn btn-secondary btn-sm mx-0",onClick:t=>this.handleCloseAssignment(t)},e("svg",{class:"m-0 p-0",xmlns:"http://www.w3.org/2000/svg",height:"12",width:"9",viewBox:"0 0 384 512"},e("path",{fill:"currentColor",d:"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"})))):null),e("div",{key:"1661be795f70a32d7ac6666ce8babb2b4dd4ce67",class:"d-flex align-items-center ",style:{gap:"0.5rem",paddingInline:"5px"}},e("ir-button",{key:"bfb22824a7e75191a5d094d5010a4e1cf37524d8",isLoading:this.isLoading==="default",size:"sm",class:"flex-grow-1",text:a.entries.Lcz_Assign,onClickHandler:t=>this.handleAssignUnit(t),btn_disabled:this.selectedRoom===-1}),this.canCheckIn()&&e("ir-button",{key:"f2dc0f9c3a7632ef3f35af873a44859218b13f04",isLoading:this.isLoading==="checkin",size:"sm",class:"flex-grow-1",text:a.entries.Lcz_AssignedAndChecIn,onClickHandler:t=>this.handleAssignUnit(t,true),btn_disabled:this.selectedRoom===-1})),e("hr",{key:"5ebef9911fd8e0afcfa41e42f25b0d517abcc365"})))}};d.style=c;export{d as igl_tba_booking_view};
//# sourceMappingURL=p-f678c76b.entry.js.map