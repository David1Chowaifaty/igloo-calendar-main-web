import{r as t,c as i,h as e,H as s}from"./p-b4b99085.js";import{P as o,p as n}from"./p-38591831.js";import{R as a}from"./p-7f3cdfe0.js";import{l}from"./p-2fcb9a1f.js";import{T as r}from"./p-a93581f3.js";import"./p-bf44a732.js";import"./p-41fabaeb.js";import"./p-a66990e0.js";const d=".sc-ir-payment-option-h{display:block}.payment-table-container.sc-ir-payment-option{display:flex;align-items:center;justify-content:center}.po-view.sc-ir-payment-option{padding:0;margin:0}.payment-img.sc-ir-payment-option{height:18px;display:none}.loading-container.sc-ir-payment-option{background:white;display:flex;align-items:center;flex-direction:column;align-items:center;justify-content:center;width:100%;height:40rem}.payment-option-loader.sc-ir-payment-option{width:1.25rem;height:1.25rem;border:2.5px solid #3f3f3f;border-bottom-color:transparent;border-radius:50%;display:inline-block;box-sizing:border-box;animation:rotation 1s linear infinite}.loading-container.default.sc-ir-payment-option{height:100vh;width:100%}@media (min-width: 768px){.po-view.sc-ir-payment-option{display:flex;align-items:center;justify-content:space-between;gap:0.5rem}.dataTable.sc-ir-payment-option{width:70%}.payment-img.sc-ir-payment-option{display:block}.actions-header.sc-ir-payment-option{width:max-content !important}.payment-table-container.sc-ir-payment-option{justify-content:flex-start}}@media (min-width: 1280px){.dataTable.sc-ir-payment-option{width:50%}}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}";const c=d;const h=class{constructor(e){t(this,e);this.toast=i(this,"toast",7);this.language="en";this.defaultStyles=true;this.hideLogs=true;this.paymentOptions=[];this.isLoading=false;this.selectedOption=null;this.paymentOptionService=new o;this.roomService=new a;this.token=new r}componentWillLoad(){if(!!this.ticket){this.token.setToken(this.ticket);this.init()}}ticketChanged(t,i){if(t===i){return}this.token.setToken(this.ticket);this.init()}init(){this.initServices();this.fetchData()}handleCloseModal(t){t.stopPropagation();t.stopImmediatePropagation();this.closeModal(t.detail)}closeModal(t){var i,e;if(t){this.modifyPaymentList(t);if(t.is_payment_gateway){this.propertyOptionsById.set(t.id,t)}else{this.propertyOptionsByCode.set(t.code,t)}}else{if(!this.propertyOptionsByCode.has((i=n.selectedOption)===null||i===void 0?void 0:i.code)&&!this.propertyOptionsById.has((e=n.selectedOption)===null||e===void 0?void 0:e.id)){this.modifyPaymentList(Object.assign(Object.assign({},n.selectedOption),{is_active:false}))}}n.selectedOption=null;n.mode=null}async fetchData(){try{if(!this.propertyid&&!this.p){throw new Error("Property ID or username is required")}this.isLoading=true;let t=this.propertyid;if(!t){console.log("fetching property id");const i=await this.roomService.getExposedProperty({id:0,aname:this.p,language:this.language});t=i.My_Result.id}const[i,e,s]=await Promise.all([this.paymentOptionService.GetExposedPaymentMethods(),this.paymentOptionService.GetPropertyPaymentMethods(t),this.roomService.fetchLanguage(this.language,["_PAYMENT_BACK"])]);l.entries=s.entries;l.direction=s.direction;this.propertyOptionsById=new Map(e===null||e===void 0?void 0:e.map((t=>[t.id,t])));this.propertyOptionsByCode=new Map(e===null||e===void 0?void 0:e.map((t=>[t.code,t])));this.paymentOptions=i===null||i===void 0?void 0:i.map((t=>{if(t.is_payment_gateway){return this.propertyOptionsById.get(t.id)||t}return this.propertyOptionsByCode.get(t.code)||t}))}catch(t){console.error(t)}finally{this.isLoading=false}}initServices(){this.token.setToken(this.ticket)}modifyPaymentList(t){let i=[...this.paymentOptions];console.log(t);let e=i.findIndex((i=>i.code===t.code));if(e===-1){throw new Error("Invalid code")}i[e]=Object.assign({},t);this.paymentOptions=[...i]}async handleCheckChange(t,i){var e;t.stopPropagation();t.stopImmediatePropagation();const s=t.detail;const o=Object.assign(Object.assign({},i),{is_active:s,property_id:this.propertyid});if(i.code!=="005"&&!i.is_payment_gateway){await this.changePaymentMethod(o);this.modifyPaymentList(o);if(i.code==="000"&&s&&this.paymentOptions.filter((t=>t.code!=="000")).every((t=>t.is_active===false||t.is_active===null))){this.toast.emit({type:"success",description:"",title:l.entries["Lcz_YouNeedToSelect"],position:"top-right"})}return}if(!this.showEditButton(i)){this.modifyPaymentList(o);return}if(s&&((e=i.data)===null||e===void 0?void 0:e.some((t=>t.value===null)))){n.mode="create";n.selectedOption=o}else{await this.changePaymentMethod(o)}this.modifyPaymentList(o)}async changePaymentMethod(t){try{await this.paymentOptionService.HandlePaymentMethod(t);this.toast.emit({position:"top-right",title:"Saved Successfully",description:"",type:"success"})}catch(t){console.log(t)}}showEditButton(t){var i;if(!t.is_payment_gateway&&t.code!=="005"){return false}return t.code==="005"||t.is_payment_gateway&&((i=t.data)===null||i===void 0?void 0:i.length)>0}render(){var t,i,o,a,r;if(this.isLoading===true||this.paymentOptions&&this.paymentOptions.length===0){return e(s,{class:this.defaultStyles?"p-2":""},e("div",{class:`loading-container ${this.defaultStyles?"default":""}`},e("span",{class:"payment-option-loader"})))}return e(s,{class:this.defaultStyles?"p-2":""},e("ir-toast",null),e("ir-interceptor",null),e("div",{class:`${this.defaultStyles?"card ":""} p-1 flex-fill m-0`},e("div",{class:"d-flex align-items-center mb-2"},e("div",{class:"p-0 m-0 mr-1"},e("ir-icons",{name:"credit_card"})),e("h3",{class:"m-0 p-0"},(t=l===null||l===void 0?void 0:l.entries)===null||t===void 0?void 0:t.Lcz_PaymentOptions)),e("div",{class:"payment-table-container"},e("table",{class:"table table-striped table-bordered no-footer dataTable"},e("thead",null,e("tr",null,e("th",{scope:"col",class:"text-left"},(i=l===null||l===void 0?void 0:l.entries)===null||i===void 0?void 0:i.Lcz_PaymentMethod),e("th",{scope:"col"},(o=l===null||l===void 0?void 0:l.entries)===null||o===void 0?void 0:o.Lcz_Status),e("th",{scope:"col",class:"actions-header"},(a=l===null||l===void 0?void 0:l.entries)===null||a===void 0?void 0:a.Lcz_Action))),e("tbody",{class:""},(r=this.paymentOptions)===null||r===void 0?void 0:r.map((t=>{var i;if(t.code==="004"){return null}return e("tr",{key:t.id},e("td",{class:"text-left po-description"},e("div",{class:"po-view"},e("span",{class:"p-0 m-0"},t===null||t===void 0?void 0:t.description))),e("td",null,e("ir-switch",{checked:t.is_active,onCheckChange:i=>this.handleCheckChange(i,t)})),e("td",{class:"payment-action"},this.showEditButton(t)&&e("ir-button",{title:(i=l===null||l===void 0?void 0:l.entries)===null||i===void 0?void 0:i.Lcz_Edit,variant:"icon",icon_name:"edit",onClickHandler:()=>{n.selectedOption=t;n.mode="edit"}})))})))))),e("ir-sidebar",{onIrSidebarToggle:()=>{this.closeModal(null)},side:"right",showCloseButton:false,open:(n===null||n===void 0?void 0:n.selectedOption)!==null},(n===null||n===void 0?void 0:n.selectedOption)&&e("ir-option-details",{propertyId:this.propertyid,slot:"sidebar-body"})))}static get watchers(){return{ticket:["ticketChanged"]}}};h.style=c;export{h as ir_payment_option};
//# sourceMappingURL=p-3f171c24.entry.js.map