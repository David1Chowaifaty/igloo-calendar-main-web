import{r as e,c as a,h as t,F as r,H as s}from"./p-d239357b.js";import{l as i}from"./p-4e493fea.js";import{i as o}from"./p-6fec77c0.js";import{h as n}from"./p-6c4ba7c0.js";import{U as l}from"./p-9ca91f1c.js";import{_ as c}from"./p-b2679b77.js";import{S as d}from"./p-0e0f732a.js";import"./p-c5894a47.js";import"./p-cc7e2ae6.js";import"./p-99cb260a.js";import"./p-bf44a732.js";const b=".sc-ir-user-form-panel-drawer-h{display:block}";const m=b;const u=class{constructor(t){e(this,t);this.closeSideBar=a(this,"closeSideBar",7)}open;user;userTypes=Map;isEdit=false;language="en";property_id;haveAdminPrivileges;superAdminId="5";userTypeCode;allowedUsersTypes=[];baseUserTypeCode;closeSideBar;render(){const e=`user-form-${this.user?.id}`;return t("ir-drawer",{key:"be8447893cee0ab8a2de83350482e3a177e70a25",onDrawerHide:e=>{e.stopImmediatePropagation();e.stopPropagation();if(!e.detail){return}this.closeSideBar.emit(null)},label:this.isEdit?this.user.username:"Create New User",open:this.open},this.open&&t("ir-user-form-panel",{key:"b1973196379b1cd66370c232d34376bc3740dba0",user:this.user,userTypes:this.userTypes,isEdit:this.isEdit,language:this.language,property_id:this.property_id,haveAdminPrivileges:this.haveAdminPrivileges,superAdminId:this.superAdminId,userTypeCode:this.userTypeCode,allowedUsersTypes:this.allowedUsersTypes,baseUserTypeCode:this.baseUserTypeCode,formId:e}),t("div",{key:"39d625356dc07d4bae8dfc8deffa47eaf15771fe",slot:"footer",class:"ir__drawer-footer"},t("ir-custom-button",{key:"1414c6bdb64257201443dce66fd631c63b591bea","data-testid":"cancel",onClickHandler:()=>this.closeSideBar.emit(null),class:"flex-fill",appearance:"filled",variant:"neutral",size:"medium"},i?.entries?.Lcz_Cancel),t("ir-custom-button",{key:"ed2eff42124d402b9b27b568ba39849913cf9059",form:e,loading:o("/Handle_Exposed_User"),"data-testid":"save",size:"medium",class:"flex-fill",type:"submit",variant:"brand"},i?.entries?.Lcz_Save)))}};u.style=m;const h=".sc-ir-user-management-table-h{display:flex;flex-direction:column;border-radius:0.5rem;overflow-x:auto;min-height:60vh;max-width:1920px;border:1px solid var(--wa-color-neutral-border-quiet, #abaeb9);background-color:white}.sc-ir-user-management-table-h{box-sizing:border-box !important}.sc-ir-user-management-table-h *.sc-ir-user-management-table,.sc-ir-user-management-table-h *.sc-ir-user-management-table::before,.sc-ir-user-management-table-h *.sc-ir-user-management-table::after{box-sizing:inherit !important;padding:0;margin:0}[hidden].sc-ir-user-management-table{display:none !important}.badge.sc-ir-user-management-table{border:none;padding:0.2rem 0.3rem}.badge.sc-ir-user-management-table:disabled{cursor:default}";const f=h;const p=".ir-table-row.sc-ir-user-management-table td.sc-ir-user-management-table{padding:0.5rem 1rem !important;text-align:left;z-index:2;background-color:var(--wa-color-surface-default);white-space:nowrap;color:var(--wa-color-text-normal);box-sizing:border-box}.table--container.sc-ir-user-management-table{overflow-x:auto}.table.sc-ir-user-management-table td.sc-ir-user-management-table{border-top:0;border-bottom:1px solid var(--wa-color-neutral-border-quiet, #abaeb9);transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.table.sc-ir-user-management-table tbody.sc-ir-user-management-table tr.sc-ir-user-management-table:last-child>td.sc-ir-user-management-table{border-bottom:0 !important}.table.sc-ir-user-management-table thead.sc-ir-user-management-table th.sc-ir-user-management-table{border:none !important;background:#ececec;background:color-mix(in oklab, var(--wa-color-neutral-fill-quiet, #f1f2f3) 60%, transparent);color:#374151;padding:0.5rem 1rem !important;text-align:left}.data-table.sc-ir-user-management-table thead.sc-ir-user-management-table th.sc-ir-user-management-table{box-sizing:border-box;background:var(--wa-color-surface-default) !important;padding-top:0.5rem !important;padding-bottom:0.5rem !important;border-bottom:1px solid var(--wa-color-neutral-90) !important;color:var(--wa-color-text-normal)}.data-table.sc-ir-user-management-table .empty-row.sc-ir-user-management-table{height:50vh !important;text-align:center;color:var(--wa-color-gray-60)}.data-table--pagination.sc-ir-user-management-table{padding:0.5rem 1rem;position:sticky;bottom:0;background:var(--wa-color-surface-default);border-top:1px solid var(--wa-color-neutral-90)}.selected.sc-ir-user-management-table td.sc-ir-user-management-table{background:#e3f3fa !important}.selected.sc-ir-user-management-table td.sc-ir-user-management-table{color:var(--gray-dark) !important;transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.sortable.sc-ir-user-management-table,.ir-table-row.sc-ir-user-management-table{transition:color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out}.sortable.sc-ir-user-management-table{text-transform:capitalize}.sortable.sc-ir-user-management-table:hover{color:#212529;background-color:#e2e8f0 !important;border-color:#dae0e5;cursor:pointer}.ir-table-row.sc-ir-user-management-table:hover td.sc-ir-user-management-table{background:#e2e6ea3f !important;background:var(--wa-color-neutral-fill-quiet, #f1f2f3) !important}.sortable.sc-ir-user-management-table:active{color:#212529;background-color:#e2e8f0;border-color:#d3d9df}.sortable.sc-ir-user-management-table svg.sc-ir-user-management-table{color:var(--blue)}.sticky-column.sc-ir-user-management-table{position:sticky !important;right:0;background-color:white}.table--container.sc-ir-user-management-table,.data-table.sc-ir-user-management-table{height:100%}";const g=p;const y=class{constructor(t){e(this,t);this.toast=a(this,"toast",7);this.resetData=a(this,"resetData",7)}users=[];isSuperAdmin;userTypes=new Map;userTypeCode;haveAdminPrivileges;superAdminId="5";allowedUsersTypes=[];baseUserTypeCode;property_id;currentTrigger=null;user=null;modalType;canDelete;canEdit;canCreate;toast;resetData;dialogRef;userService=new l;systemService=new d;componentWillLoad(){this.assignPermissions()}handleChange(e,a){if(e!==a){this.assignPermissions()}}assignPermissions(){this.canCreate=this.haveAdminPrivileges;this.canDelete=this.haveAdminPrivileges;this.canEdit=true}async handleUserActiveChange(e,a){e.stopImmediatePropagation();e.stopPropagation();const t=await this.verifyAdminAction({type:"user",mode:"update",user:a});if(t==="cancelled"){return}await this.userService.handleExposedUser({email:a.email,id:a.id,is_active:e.target.checked,mobile:a.mobile,password:a.password,type:a.type,username:a.username,base_user_type_code:this.baseUserTypeCode,property_id:this.property_id});this.toast.emit({position:"top-right",title:"Saved Successfully",description:"",type:"success"})}async executeUserAction(e){try{e.stopImmediatePropagation();e.stopPropagation();await this.userService.handleExposedUser({email:this.user.email,id:this.user.id,is_active:this.user.is_active,is_email_verified:this.modalType==="verify"?false:this.user.is_email_verified,mobile:this.user.mobile,password:this.user.password,type:this.user.type,username:this.user.username,is_to_remove:this.modalType==="delete"});this.resetData.emit(null)}finally{this.dialogRef.closeModal()}}openModal(e,a){if(!this.dialogRef||!e){return}this.user=e;this.modalType=a;this.dialogRef.openModal()}maskEmail(e){if(!e||!e.includes("@"))return"";const[a,t]=e.split("@");const r=a.slice(0,1);const s="*".repeat(Math.max(a.length-1,1));return`${r}${s}@${t}`}async verifyAdminAction(e){const a=await this.systemService.checkOTPNecessity({METHOD_NAME:"Handle_Exposed_User"});if(a?.cancelled){return"cancelled"}const{mode:t,...r}=e;if(t==="edit"||t==="create"){this.currentTrigger={...r,isEdit:t==="edit"}}return"ok"}render(){return t(s,{key:"a827379feec09a9b268dbf0368427934f0606744"},t("section",{key:"2c16c434cd6cbc66cbeddcba274904d94766d70a",class:"table-container h-100  w-100 m-0 table-responsive"},t("table",{key:"9dca083e2c8d4d557b90c35ab9a84bc754e86198",class:"table"},t("thead",{key:"57dafd92723c2b45aa3f747695a404cfcf58e174"},t("tr",{key:"5c42e45f080d7ad0b9a3ba4fd683cd790e311f1c"},t("th",{key:"88b0202ac0756d53747cf19dc52b4518a750a934",class:"text-left"},i.entries.Lcz_Username??"Username"),t("th",{key:"5ee30297ff4101338bfe39c7661b2c5262e53179",class:"text-left"},i.entries.Lcz_Email),t("th",{key:"ddeb1049360a941f06496eae6130bbd9776b09c8",class:"text-left"},i.entries.Lcz_Mobile??"Mobile"),t("th",{key:"a14143bb1d70b0635f7a0744ae0c085934b3b721",class:"text-left"},i.entries.Lcz_Role),t("th",{key:"ef0ceb57950655c96192b47e80e6b4b8c3fb5350",class:"text-left small",style:{fontWeight:"bold"}},t("p",{key:"3c4c6ca581a7bc188ece9c4a5bbda3e6995249f8",class:"m-0 p-0 "},i.entries.Lcz_CreatedAt),t("p",{key:"29b1c89d5362acc903b7eff230b5793c3bb2ea65",class:"m-0 p-0"},i.entries.Lcz_LastSignedIn)),this.haveAdminPrivileges&&t("th",{key:"34664dfef01af9c0cbf922ebd3c2b05ed695f19c"},i.entries.Lcz_Active),t("th",{key:"bacac7f96bfac14f9b5056434f2903a80384d730",class:"action-row"},this.canCreate&&t(r,{key:"b828a4e4b41b0f5ee958f88431fbec8d7a0c4e57"},t("ir-custom-button",{key:"228c30d7ec41c75e702e1de7e5e0a10bf6f6c339",appearance:"plain",variant:"neutral",id:"new-user-btn",onClickHandler:()=>{this.verifyAdminAction({type:"user",mode:"create",user:null})}},t("wa-icon",{key:"eb8e402f2e36a2a00a0378f0da1bf1e9a74d5af2",name:"plus",style:{fontSize:"1.2rem"}})),t("wa-tooltip",{key:"f987184fdad65d1508c71039639c53cf95357d23",for:"new-user-btn"},i.entries.Lcz_CreateUser))))),t("tbody",{key:"fc108367b184e4c14ce744b9900267ae298d25ab"},this.users.map((e=>{const a=e.type.toString()===this.superAdminId;const s=e.sign_ins?e.sign_ins[0]:null;const o=s?n(s.date,"YYYY-MM-DD"):null;const l=o?n().diff(o,"days")>30:false;return t("tr",{key:e.id,class:"ir-table-row"},t("td",null,e.username),t("td",null,e.email,this.haveAdminPrivileges&&t("span",{style:{marginLeft:"0.5rem",color:`var(--wa-color-${e.is_email_verified?"success":"danger"}-fill-loud)`},class:`small`},e.is_email_verified?i.entries.Lcz_Verified:i.entries.Lcz_NotVerified)),t("td",null,e.mobile??"N/A"),t("td",null,e.type.toString()===this.superAdminId?i.entries.Lcz_SuperAdmin:this.userTypes.get(e.type.toString())),t("td",{class:"small"},t("p",{class:"m-0 p-0"},new Date(e.created_on).getFullYear()===1900||!e.created_on?"N/A":n(e.created_on,"YYYY-MM-DD").format("DD-MMM-YYYY")),t("p",{class:`m-0 p-0`,style:{color:l?"var(--wa-color-danger-fill-loud)":""}},s&&new Date(s.date).getFullYear()>1900?n(s.date,"YYYY-MM-DD").format("DD-MMM-YYYY")+" "+c(s.hour.toString(),s.minute.toString()):"N/A")),this.haveAdminPrivileges&&t("td",null,this.haveAdminPrivileges&&!this.isSuperAdmin&&e.type.toString()==="17"?null:!a&&t("wa-switch",{onchange:a=>this.handleUserActiveChange(a,e),defaultChecked:e.is_active,checked:e.is_active})),t("td",{class:"action-row"},(this.canEdit||this.canDelete)&&(!this.isSuperAdmin&&!a||this.isSuperAdmin)&&t("div",{class:"icons-container  d-flex align-items-center"},this.canEdit&&t(r,null,t("ir-custom-button",{"data-testid":"edit",onClickHandler:()=>{this.verifyAdminAction({type:"user",mode:"edit",user:e})},appearance:"plain",variant:"neutral",id:`edit-user-${e.id}`},t("wa-icon",{name:"edit",style:{fontSize:"1.2rem"}})),t("wa-tooltip",{for:`edit-user-${e.id}`},i.entries.Lcz_EditUser)),this.canDelete&&!a&&(this.isSuperAdmin||e.type.toString()!=="17")&&t(r,null,t("ir-custom-button",{onClickHandler:async()=>{const a=await this.verifyAdminAction({type:"user",mode:"delete",user:e});if(a==="cancelled"){return}this.openModal(e,"delete")},"data-testid":"delete",variant:"danger",appearance:"plain",id:`delete-user-${e.id}`},t("wa-icon",{name:"trash-can",style:{fontSize:"1.2rem"}})),t("wa-tooltip",{for:`delete-user-${e.id}`},i.entries.Lcz_DeleteUser)))))}))))),t("ir-user-form-panel-drawer",{key:"75ab9d875930b75be88fd25b18d3ca5212ce552e",open:this.currentTrigger!==null&&this.currentTrigger?.type!=="delete",property_id:this.property_id,baseUserTypeCode:this.baseUserTypeCode,superAdminId:this.superAdminId,allowedUsersTypes:this.allowedUsersTypes,userTypeCode:this.userTypeCode,haveAdminPrivileges:this.haveAdminPrivileges,onCloseSideBar:()=>this.currentTrigger=null,slot:"sidebar-body",user:this.currentTrigger?.user,isEdit:this.currentTrigger?.isEdit}),t("ir-dialog",{key:"10664a03c153609d912e3a2b0b4d8d905ff6e1c3",label:"Alert",onIrDialogAfterHide:e=>{e.stopImmediatePropagation();e.stopPropagation();this.user=null;this.modalType=null},ref:e=>this.dialogRef=e},t("span",{key:"4d789bbd112ecb0f6ee6c50672dd4d4d9dc4ca68"},this.modalType==="delete"?`${i.entries.Lcz_AreYouSureToDelete} ${this.user?.username}?`:`${i.entries.Lcz_AreYouSureToUnverify} ${this.maskEmail(this.user?.email)}`),t("div",{key:"e4edb36e262d5c7aa413ae63b51aa5ddd8cba88c",slot:"footer",class:"ir-dialog__footer"},t("ir-custom-button",{key:"1ab05a8d6024b031bf29463a6e9dec5d6f14e3fe","data-dialog":"close",size:"medium",appearance:"filled"},"Cancel"),t("ir-custom-button",{key:"9017046e98d81fd73daf162c3bd4b0e4834d502e",size:"medium",loading:o("/Handle_Exposed_User"),appearance:"accent",variant:this.modalType==="verify"?"brand":"danger",onClickHandler:this.executeUserAction.bind(this)},this.modalType==="verify"?i.entries.Lcz_Confirm:i.entries.Lcz_Delete))))}static get watchers(){return{haveAdminPrivileges:["handleChange"]}}};y.style=f+g;export{u as ir_user_form_panel_drawer,y as ir_user_management_table};
//# sourceMappingURL=p-f61aa051.entry.js.map