import{a as t}from"./p-bf44a732.js";import{z as e,o as r,s as n,n as o,b as a,c as s,e as i,d as c,f as l}from"./p-ebcd5b73.js";import{e as u,j as _,k as d,l as E,d as y}from"./p-df69c285.js";import{c as w}from"./p-2925ded6.js";import{c as f}from"./p-d6d6fb27.js";const m={checkout_guest:null,guest:null,tax_statement:null,roomTypes:[],enableBooking:false,resetBooking:false,ratePlanSelections:{},selectedPaymentMethod:null,isInFreeCancelationZone:false,bookingAvailabilityParams:{from_date:null,to_date:null,adult_nbr:0,child_nbr:0,infant_nbr:0},booking:null,fictus_booking_nbr:null,event_type:{type:"PLUS_BOOKING"}};let{state:h,onChange:p,reset:b}=w(m);function g(){b()}function k(t,e){if(!t){return null}if(!e||h.resetBooking){return t[0]}return t?.find((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))??null}p("roomTypes",(t=>{const e=h.ratePlanSelections;const r={};t.forEach((t=>{if(!t.is_active)return;r[t.id]=r[t.id]||{};t.rateplans.forEach((n=>{if(!n.is_active||!n?.variations?.length)return;const o=e[t.id]?.[n.id];r[t.id][n.id]=o&&Object.keys(o).length>0?{...o,ratePlan:n,selected_variation:k(n.variations,o.selected_variation)??null,visibleInventory:t.inventory,reserved:t.inventory===0?0:h.resetBooking?0:o.reserved,checkoutVariations:t.inventory===0?[]:o.checkoutVariations,checkoutBedSelection:t.inventory===0?[]:o.checkoutBedSelection,checkoutSmokingSelection:t.inventory===0?[]:o.checkoutSmokingSelection,guestName:t.inventory===0?[]:o.guestName,roomtype:{...o.roomtype}}:{reserved:0,rp_amount:0,view_mode:"001",guest:null,visibleInventory:t.inventory,selected_variation:n?.variations[0]??null,ratePlan:n,guestName:[],is_bed_configuration_enabled:t.is_bed_configuration_enabled,roomtype:{...t,physicalrooms:null,rateplans:null,availabilities:null},checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[]}}))}));h.ratePlanSelections=r;h.resetBooking=false}));function v(t){const e=h.ratePlanSelections[t];const r=t=>Object.entries(e).reduce(((e,[r,n])=>Number(r)!==t?e+n.reserved:e),0);const n=Object.fromEntries(Object.entries(e).map((([e,n])=>{const o=r(Number(e));const a=h.roomTypes.find((e=>e.id===t));const s=a?a.inventory-o:0;return[e,{...n,visibleInventory:s>0?s:0}]})));if(JSON.stringify(e)!==JSON.stringify(n)){h.ratePlanSelections={...h.ratePlanSelections,[t]:n}}}function B({ratePlanId:t,roomTypeId:e,params:r}){h.ratePlanSelections={...h.ratePlanSelections,[Number(e)]:{...h.ratePlanSelections[Number(e)],[t]:{...h.ratePlanSelections[e][t],...r}}}}function S({ratePlanId:t,roomTypeId:e,rooms:r,guest:n}){if(!h.ratePlanSelections[e]){h.ratePlanSelections[e]={}}const o=h.roomTypes?.find((t=>t.id===e));if(!o){throw new Error("Invalid room type id")}const a=o.rateplans.find((e=>e.id===t));if(!a){throw new Error("Invalid rate plan")}let s=Array.from({length:r},(()=>({first_name:"",last_name:"",unit:null,bed_preference:null,infant_nbr:null})));if(n){s=n}if(!h.ratePlanSelections[e][t]){h.ratePlanSelections[e][t]={guestName:null,reserved:0,view_mode:"001",rp_amount:0,guest:s,is_bed_configuration_enabled:o.is_bed_configuration_enabled,visibleInventory:0,selected_variation:null,ratePlan:a,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],roomtype:{id:o.id,name:o.name,physicalrooms:null,rateplans:null,availabilities:null,inventory:o.inventory,rate:o.rate,bedding_setup:o.bedding_setup,smoking_option:o.smoking_option,is_bed_configuration_enabled:o.is_bed_configuration_enabled}}}h.ratePlanSelections={...h.ratePlanSelections,[Number(e)]:{...h.ratePlanSelections[Number(e)],[t]:{...h.ratePlanSelections[e][t],reserved:r,checkoutVariations:[],guest:s}}};v(e)}function I(t,e){if(!h.ratePlanSelections||!h.ratePlanSelections[t]){return{reserved:0,guest:null,visibleInventory:0,selected_variation:null,ratePlan:null,guestName:[],is_bed_configuration_enabled:false,checkoutVariations:[],checkoutBedSelection:[],checkoutSmokingSelection:[],rp_amount:0,view_mode:"001",roomtype:null}}return h.ratePlanSelections[t][e]}function D(t,e){h[t]=e}function x(){return Object.values(h.ratePlanSelections).reduce(((t,e)=>t+Object.values(e).reduce(((t,e)=>{if(e.reserved===0){return t}return t+e.reserved}),0)),0)}function A(){const t=Object.entries(h.ratePlanSelections).reduce(((t,[e,r])=>{const n=h.roomTypes.find((t=>t.id.toString()===e.toString()));t[e]=Object.entries(r).reduce(((t,[e,r])=>{t[e]={...r,reserved:0,visibleInventory:n?.inventory??r.visibleInventory};return t}),{});return t}),{});h.ratePlanSelections={...t}}const N=e.object({CODE_NAME:e.string(),CODE_VALUE_AR:e.string().nullable(),CODE_VALUE_DE:e.string().nullable(),CODE_VALUE_EL:e.string().nullable(),CODE_VALUE_EN:e.string().nullable(),CODE_VALUE_FR:e.string().nullable(),CODE_VALUE_HE:e.string().nullable(),CODE_VALUE_PL:e.string().nullable(),CODE_VALUE_RU:e.string().nullable(),CODE_VALUE_UA:e.string().nullable(),DISPLAY_ORDER:e.number().nullable(),ENTRY_DATE:e.string().nullable(),ENTRY_USER_ID:e.number().nullable(),INVARIANT_VALUE:e.string().nullable(),ISDELETEABLE:e.boolean(),ISDELETED:e.boolean(),ISSYSTEM:e.boolean(),ISUPDATEABLE:e.boolean(),ISVISIBLE:e.boolean(),NOTES:e.string().nullable(),OWNER_ID:e.number().nullable(),TBL_NAME:e.string()});var T;(function(t){t["Room"]="room"})(T||(T={}));var P;(function(t){t["Penthouse"]="Penthouse";t["PremiumSuites"]="Premium Suites";t["StandardRooms"]="Standard Rooms"})(P||(P={}));var R;(function(t){t["Empty"]="";t["The001"]="001";t["The002"]="002"})(R||(R={}));const L=r({code:n(),id:o(),symbol:n()});const C=r({amount:o(),booking_nbr:n(),currency:L,invoice_nbr:a(),is_invoiceable:s(),key:a(),status:a(),system_id:a(),type:i(["BSA","BSP","BSE"])});const O=r({invoicable_items:c(C),invoices:c(l())});function G(t){try{const{groups:r,types:n}=e.object({types:N.array().min(1),groups:N.array().min(1),methods:N.array().min(1)}).parse(t);const o=[...n];const a=t=>t.map((t=>o.find((e=>e.CODE_NAME===t)))).filter((t=>Boolean(t)));const s=t=>{const e=r.find((e=>e.CODE_NAME===t));return e?e.CODE_VALUE_EN.split(","):[]};let i={};r.forEach((t=>{i[t.CODE_NAME]=a(s(t.CODE_NAME))}));return i}catch(t){console.log(t);return{}}}class U{async unBlockUnitByPeriod(e){const{data:r}=await t.post(`/Unblock_Unit_By_Period`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async getNextValue(e){const{data:r}=await t.post(`/Get_Next_Value`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async getExposedApplicablePolicies(e){const{data:r}=await t.post(`/Get_Exposed_Applicable_Policies`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result??[]}async handleExposedRoomInOut(e){const{data:r}=await t.post(`/Handle_Exposed_Room_InOut`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async GetPenaltyStatement(e){const{data:r}=await t.post("/Get_Penalty_Statement",e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}async setExposedRestrictionPerRoomType(e){const{data:r}=await t.post(`https://gateway.igloorooms.com/IRBE/Set_Exposed_Restriction_Per_Room_Type`,{operation_type:e.operation_type??"close_open",...e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async getLov(){const{data:e}=await t.post(`/Get_LOV`,{});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e}async sendBookingConfirmationEmail(e,r){const{data:n}=await t.post(`/Send_Booking_Confirmation_Email`,{booking_nbr:e,language:r});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}async getCalendarData(e,r,n){try{const{data:o}=await t.post(`/Get_Exposed_Calendar`,{propertyid:e,from_date:r,to_date:n,extras:u,include_sales_rate_plans:true});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}const a=o.My_Result.months;const s=[];const i=await _(a);const c=a.map((t=>{s.push({daysCount:t.days.length,monthName:t.description});return t.days.map((e=>{if(e["value"]==="2025-05-30"){console.log(e)}return{day:d(e.description,t.description),value:e.value,currentDate:E(e.description,t.description),dayDisplayName:e.description,rate:e.room_types,unassigned_units_nbr:e.unassigned_units_nbr,occupancy:e.occupancy}}))})).flat();return Promise.resolve({ExceptionCode:null,ExceptionMsg:"",My_Params_Get_Rooming_Data:{AC_ID:e,FROM:o.My_Params_Get_Exposed_Calendar.from_date,TO:o.My_Params_Get_Exposed_Calendar.to_date},days:c,months:s,myBookings:i,defaultMonths:a})}catch(t){console.error(t)}}async handleExposedRoomGuests(e){const{data:r}=await t.post("/Handle_Exposed_Room_Guests",e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async fetchGuest(e){try{const{data:r}=await t.post(`/Get_Exposed_Guest`,{email:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.log(t);throw new Error(t)}}async changeExposedBookingStatus(e){try{const{data:r}=await t.post(`/Change_Exposed_Booking_Status`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){throw new Error(t)}}async fetchPMSLogs(e){try{const{data:r}=await t.post(`/Get_Exposed_PMS_Logs`,{booking_nbr:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.log(t);throw new Error(t)}}async getExposedBookingEvents(e){try{const{data:r}=await t.post(`/Get_Exposed_Booking_Events`,{booking_nbr:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.log(t);throw new Error(t)}}async editExposedGuest(e,r){try{const{data:n}=await t.post(`/Edit_Exposed_Guest`,{...e,book_nbr:r});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n.My_Result}catch(t){console.log(t);throw new Error(t)}}async getBookingInvoiceInfo(e){const{data:r}=await t.post("/Get_Booking_Invoice_Info",e);return O.parse(r.My_Result)}async getBookingAvailability(e){try{const{adultChildCount:r,currency:n,...o}=e;const{data:a}=await t.post(`/Check_Availability`,{...o,adult_nbr:r.adult,child_nbr:r.child,currency_ref:n.code,skip_getting_assignable_units:!f.is_frontdesk_enabled,is_backend:true});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}const s=this.modifyRateplans(this.sortRoomTypes(a["My_Result"],{adult_nbr:Number(r.adult),child_nbr:Number(r.child)}));h.roomTypes=[...s];h.tax_statement={message:a.My_Result.tax_statement};return s}catch(t){console.error(t);throw new Error(t)}}sortRoomTypes(t,e){return t.sort(((t,r)=>{if(t.is_available_to_book&&!r.is_available_to_book)return-1;if(!t.is_available_to_book&&r.is_available_to_book)return 1;const n=t.rateplans?.some((t=>t.variations?.some((t=>t.discounted_amount===0||t.discounted_amount===null))));const o=r.rateplans?.some((t=>t.variations?.some((t=>t.discounted_amount===0||t.discounted_amount===null))));if(n&&!o)return 1;if(!n&&o)return-1;const a=t.rateplans?.some((t=>t.variations?.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))));const s=r.rateplans?.some((t=>t.variations?.some((t=>t.adult_nbr===e.adult_nbr&&t.child_nbr===e.child_nbr))));if(a&&!s)return-1;if(!a&&s)return 1;const i=Math.max(...t.rateplans.flatMap((t=>t.variations?.map((t=>t.discounted_amount??0)))));const c=Math.max(...r.rateplans.flatMap((t=>t.variations?.map((t=>t.discounted_amount??0)))));if(i<c)return-1;if(i>c)return 1;return 0}))}modifyRateplans(t){return t?.map((t=>({...t,rateplans:t.rateplans?.map((t=>({...t,variations:this.sortVariations(t?.variations??[])})))})))}sortVariations(t){return t.sort(((t,e)=>{if(t.adult_nbr!==e.adult_nbr){return e.adult_nbr-t.adult_nbr}return e.child_nbr-t.child_nbr}))}async getCountries(e){try{const{data:r}=await t.post(`/Get_Exposed_Countries`,{language:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.error(t);throw new Error(t)}}async getSetupEntriesByTableName(e){const{data:r}=await t.post(`/Get_Setup_Entries_By_TBL_NAME`,{TBL_NAME:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}const n=r.My_Result??[];return n}async fetchSetupEntries(){try{const t=await this.getSetupEntriesByTableNameMulti(["_ARRIVAL_TIME","_RATE_PRICING_MODE","_BED_PREFERENCE_TYPE"]);const{arrival_time:e,rate_pricing_mode:r,bed_preference_type:n}=this.groupEntryTablesResult(t);return{arrivalTime:e,ratePricingMode:r,bedPreferenceType:n}}catch(t){console.error(t);throw new Error(t)}}async doBookingExtraService({booking_nbr:e,service:r,is_remove:n}){const{data:o}=await t.post(`/Do_Booking_Extra_Service`,{...r,booking_nbr:e,is_remove:n});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}groupEntryTablesResult(t){let e={};for(const r of t){const t=r.TBL_NAME.substring(1,r.TBL_NAME.length).toLowerCase();if(!e[t]){e[t]=[]}e[t]=[...e[t],r]}return e}async getSetupEntriesByTableNameMulti(e){const{data:r}=await t.post(`/Get_Setup_Entries_By_TBL_NAME_MULTI`,{TBL_NAMES:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}async getBlockedInfo(){return await this.getSetupEntriesByTableNameMulti(["_CALENDAR_BLOCKED_TILL"])}async getUserDefaultCountry(){try{const{data:e}=await t.post(`/Get_Country_By_IP`,{IP:""});if(e.ExceptionMsg!==""){throw new Error(e.ExceptionMsg)}return e["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async blockUnit(e){try{const{data:r}=await t.post(`/Block_Exposed_Unit`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}console.log(r);return r["My_Params_Block_Exposed_Unit"]}catch(t){console.error(t);throw new Error(t)}}async blockAvailabilityForBrackets(e){try{const{data:r}=await t.post(`/Block_Availability_For_Brackets`,e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}catch(t){console.error(t);throw new Error(t)}}async setDepartureTime(e){const{data:r}=await t.post("/Set_Departure_Time",e);if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r}async getUserInfo(e){try{const{data:r}=await t.post(`/GET_EXPOSED_GUEST`,{email:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r.My_Result}catch(t){console.error(t);throw new Error(t)}}async getExposedBooking(e,r,n=true){try{const{data:o}=await t.post(`/Get_Exposed_Booking`,{booking_nbr:e,language:r,extras:n?u:null});if(o.ExceptionMsg!==""){throw new Error(o.ExceptionMsg)}return o.My_Result}catch(t){console.error(t)}}generateDays(t,e,r){const n=new Date(t);const o=new Date(e);const a=[];while(n<o){a.push({date:n.toISOString().split("T")[0],amount:r,cost:null});n.setDate(n.getDate()+1)}return a}calculateTotalRate(t,e,r,n){if(r&&n===2){return+t}return+t/+e}async fetchExposedGuest(e,r){try{const{data:n}=await t.post(`/Fetch_Exposed_Guests`,{email:e,property_id:r});if(n.ExceptionMsg!==""){throw new Error(n.ExceptionMsg)}return n["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async fetchExposedBookings(e,r,n,o){try{const{data:a}=await t.post(`/Fetch_Exposed_Bookings`,{booking_nbr:e,property_id:r,from_date:n,to_date:o});if(a.ExceptionMsg!==""){throw new Error(a.ExceptionMsg)}return a["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async getPCICardInfoURL(e){try{const{data:r}=await t.post(`/Get_PCI_Card_Info_URL`,{BOOK_NBR:e});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}return r["My_Result"]}catch(t){console.error(t);throw new Error(t)}}async doReservation(e){const{data:r}=await t.post(`/DoReservation`,{...e,extras:e.extras?e.extras:u});if(r.ExceptionMsg!==""){throw new Error(r.ExceptionMsg)}console.log(r["My_Result"]);return r["My_Result"]}async bookUser({bookedByInfoData:t,check_in:e,currency:r,extras:n=null,fromDate:o,guestData:a,pickup_info:s,propertyid:i,rooms:c,source:l,toDate:u,totalNights:_,arrivalTime:d,bookingNumber:E,defaultGuest:w,identifier:f,pr_id:m}){try{const h=y(o);const p=y(u);let b={email:t.email===""?null:t.email||null,first_name:t.firstName,last_name:t.lastName,country_id:t.countryId===""?null:t.countryId,city:null,mobile:t.contactNumber===null?"":t.contactNumber,phone_prefix:null,address:"",dob:null,subscribe_to_news_letter:t.emailGuest||false,cci:t.cardNumber?{nbr:t.cardNumber,holder_name:t.cardHolderName,expiry_month:t.expiryMonth,expiry_year:t.expiryYear}:null};if(w){b={...w,email:w.email===""?null:w.email}}if(t.id){b={...b,id:t.id}}const g={assign_units:true,check_in:e,is_pms:true,is_direct:true,is_in_loyalty_mode:false,promo_key:null,extras:n,booking:{booking_nbr:E||"",from_date:h,to_date:p,remark:t.message||null,property:{id:i},source:l,currency:r,arrival:{code:d?d:t.selectedArrivalTime},guest:b,rooms:[...a.map((t=>({identifier:f||null,roomtype:{id:t.roomCategoryId,name:t.roomCategoryName,physicalrooms:null,rateplans:null,availabilities:null,inventory:t.inventory,rate:t.rate/_},rateplan:{id:t.ratePlanId,name:t.ratePlanName,rate_restrictions:null,variations:null,cancelation:t.cancelation,guarantee:t.guarantee},unit:typeof m==="undefined"&&t.roomId===""?null:{id:+m||+t.roomId},occupancy:{adult_nbr:t.adultCount,children_nbr:t.childrenCount,infant_nbr:null},bed_preference:t.preference,from_date:h,to_date:p,notes:null,days:this.generateDays(h,p,this.calculateTotalRate(t.rate,_,t.isRateModified,t.rateType)),guest:{email:null,first_name:t.guestName,last_name:null,country_id:null,city:null,mobile:null,address:null,dob:null,subscribe_to_news_letter:null}}))),...c]},pickup_info:s};console.log("book user payload",g)}catch(t){console.error(t);throw new Error(t)}}}export{U as B,g as a,h as b,x as c,S as d,G as e,I as g,D as m,A as r,B as u};
//# sourceMappingURL=p-c3e5f021.js.map