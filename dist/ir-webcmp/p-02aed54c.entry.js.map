{"version":3,"names":["iglBookingEventCss","IglBookingEventStyle0","IglBookingEvent","constructor","hostRef","this","is_vacation_rental","allBookingEvents","renderElement","isShrinking","dayWidth","eventSpace","vertSpace","showInfoPopup","bubbleInfoTopSide","isStretch","eventsService","EventsService","bookingService","BookingService","resizeSide","isDragging","animationFrameId","handleMouseMoveBind","handleMouseMove","bind","handleMouseUpBind","handleMouseUp","handleClickOutsideBind","handleClickOutside","role","findRoomType","roomId","roomType","bookingEvent","roomsInfo","filter","room","physicalrooms","some","r","id","length","componentWillLoad","window","addEventListener","SPLIT_INDEX","buildSplitIndex","ROOMS","_a","getSplitRole","IDENTIFIER","componentDidLoad","isNewEvent","hideBubble","setTimeout","async","includes","STATUS_CODE","showEventInfo","STATUS","fetchAndAssignBookingData","renderAgain","disconnectedCallback","removeEventListener","cancelAnimationFrame","event","clickedElement","target","element","contains","hideBubbleInfoPopup","detail","currentInfoBubbleId","getBookingId","key","moveBookingToHandler","bookingId","moveToDay","toRoomId","FROM_DATE","fromRoomId","isTouchStart","moveDifferenceX","moveDifferenceY","isBlockUnit","requestAnimationFrame","resetBookingToInitialPosition","pool","to_date","from_date","previousToDate","moment","add","format","console","log","Number","PR_ID","TO_DATE","isSame","calendar_dates","disabled_cells","get","disabled","_b","_c","reset","checkIfSlotOccupied","reallocateEvent","catch","description","status","newRatePlans","getModalDescription","hideConfirmButton","oldFromDate","defaultDates","oldToDate","diffDays","calculateDaysBetweenDates","shrinkingDirection","fromDate","toDate","isAfter","isBefore","newToDate","subtract","warn","showDialog","emit","Object","assign","reason","title","rateplans","validateDates","base_date","cursor","counter","locales","entries","Lcz_ThisUnitIsNotAvailable","payload","booking","bookingNumber","BOOKING_NUMBER","identifier","is_direct","showRoomNightsDialog","error","toast","position","message","type","validStatuses","data","getExposedBooking","base_booking","filteredRooms","rooms","ID","Error","transformedBooking","transformNewBooking","NO_OF_DAYS","NAME","origin","TOTAL_PRICE","POOL","NOTES","BALANCE","channel_booking_nbr","otherBookingData","__rest","DEPARTURE_TIME","PHONE","PHONE_PREFIX","PRIVATE_NOTE","ROOM_INFO","sharing_persons","updateBookingEvent","Lcz_OTA_Modification_Alter","initialRT","targetRT","Lcz_AreYouSureWantToMoveAnotherUnit","mealPlans","checkMealPlan","rateplan_id","RATE_PLAN_ID","roomTypeId","roomTypes","calendar_data","property","roomtypes","Array","isArray","undefined","Lcz_CannotChangeCHBookings","toString","Lcz_ConfrmModiication","Lcz_SameRatesWillBeKept","style","left","initialLeft","width","initialWidth","finalWidth","top","dragInitPos","handleRevertBooking","fromTime","toTime","isOccupied","eventFromTime","eventToTime","isSameOrAfter","getUniqueId","Date","getTime","isSplitBooking","SPLIT_BOOKING","isHighlightEventType","getEventType","getBookingStatus","getBookedBy","getBookedRoomId","getEventStartingDate","getEventEndingDate","event_type","getEventLegend","legendData","statusId","orderRide","color","getLegendOfStatus","aStatusId","getNoteNode","INTERNAL_NOTE","getBalanceNode","setStayDays","aStayDays","getStayDays","getPosition","startingDate","startingCellClass","getDate","getMonth","getFullYear","bodyContainer","document","querySelector","startingCell","pos","height","getBoundingClientRect","bodyContainerRect","boundingRect","getNumber","aData","parseFloat","startDragging","side","preventDefault","stopPropagation","stopImmediatePropagation","initialX","clientX","touches","initialY","clientY","elementRect","offsetX","offsetY","x","y","dragEndPos","dragOverEventData","offsetWidth","offsetLeft","currentX","distanceX","currentY","distanceY","baseCondition","newWidth","Math","min","max","newLeft","abs","nbOfDays","numberOfDays","round","initialStayDays","isNaN","replace","offset","updateData","updateEventData","calculateHoverPosition","barRect","barWidth","barLeft","screenWidth","innerWidth","hoverLeft","transform","renderEventBookingNumber","showInfo","midPoint","hideBubbleInfo","render","legend","noteNode","balanceNode","backgroundColor","calendar_extra","_d","booking_color","foreground","stripe","_f","_e","colorsForegrounds","checkout","h","Host","class","clsName","bookingEventBase","skewedLeft","skewedRight","onTouchStart","onMouseDown","Fragment","countries","currency","bubbleInfoTop","ReloadInterceptor","options","isActive","handleBeforeUnload","e","onIntercept","returnValue","autoActivate","activate","capture","deactivate","iglBulkBlockCss","IglBulkBlockStyle0","sheetCss","IglBulkBlockStyle1","IglBulkBlock","maxDatesLength","selectedRoomTypes","Map","selectedUnit","blockState","dates","from","to","dateRefs","minDate","datesSchema","z","array","object","any","refine","val","isMoment","reloadInterceptor","sidebar","addBlockDates","errors","isLoading","periods","parse","unitSections","scrollIntoView","behavior","block","blockAvailabilityForBrackets","unit_id","block_status_code","brackets","map","p","unBlockUnitByPeriod","Lcz_RequestSubmittedSuccessfully","closeModal","ZodError","datesSections","preventClose","handleDateChange","index","date","i","rowFrom","isSameOrBefore","openDatePicker","nextFrom","findIndex","d","addDateRow","last_dates","onSubmit","gap","showFirstOption","selectedValue","text","value","onSelectChange","Lcz_PlzSelectOneListing","Lcz_PlzSelectOneUnit","ref","el","name","j","row_style","checked","onCheckChange","roomtype_id","label","Lcz_From","Lcz_ToExclusive","variant","icon_name","onClickHandler","fromDateMinDate","clone","toDateMinDate","forceDestroyOnUpdate","emitEmptyDate","String","onDateChanged","evt","start","onDatePickerFocus","slot","_g","maxDate","_","Lcz_Cancel","btn_color","Lcz_Confirm","btn_type","iglBulkOperationsCss","IglBulkOperationsStyle0","IglBulkOperationsStyle1","IglBulkOperations","tabs","tabsEl","setProperty","titleEl","onCloseSideBar","displayContext","onTabChanged","selectedTab","property_id","iglBulkStopSaleCss","IglBulkStopSaleStyle0","IglBulkStopSaleStyle1","IglBulkStopSale","selectedWeekdays","Set","fill","getDayIndex","dateStr","day","generatePeriodsToModify","period","current","lastDay","nextDay","has","selectedRoom","push","room_type_id","night","updateCalendarCells","payloads","prevDisabledCells","roomsInfoById","rt","dayIndexByValue","days","rateByRoomTypeAndDate","restriction","restrictions","dayIndex","rateKey","rp","rate","find","set","haveAvailability","exposed_inventory","rts","is_closed","size","weekdaysSections","periods_to_modify","isAllOpen","every","result","isAllClosed","setExposedRestrictionPerRoomType","f","Promise","all","firstOption","Lcz_Select","Lcz_Open","Lcz_StopSale","choice","rest","entry","weekdays","onWeekdayChange","Lcz_Save","iglCalBodyCss","IglCalBodyStyle0","IglCalBody","dragOverElement","selectedRooms","currentDate","housekeepingService","HouseKeepingService","bookingMap","interactiveTitle","dayRateMap","setHours","getBookingMap","getBookingData","forEach","updateDisabledCellsCache","handleCalendarDataChange","dragOverHighlightElementHandler","gotoRoom","category","getRoomCategoryByRoomId","expanded","toggleCategory","scrollToRoom","addToBeAssignedEvents","addBookingDatas","closeWindow","ind","ev","splice","scrollPageToRoom","refClass","calendarData","roomCategory","getCategoryRooms","getRoomId","getCategoryName","getCategoryId","getTotalPhysicalRooms","getRoomName","roomInfo","getRoomById","physicalRooms","physical_room","bookingEvents","addBookingDatasEvent","getSelectedCellRefName","selectedDay","getSplitBookingEvents","newEvent","addNewEvent","keys","startDate","endDate","dateDifference","EMAIL","convertBooking","REFERENCE_TYPE","getTwoDigitNumStr","RELEASE_AFTER_HOURS","ENTRY_DATE","ADULTS_COUNT","COUNTRY","RATE","RATE_PLAN","ARRIVAL_TIME","TITLE","Lcz_NewBookingFor","CATEGORY","defaultDateRange","fromDateStr","toDateStr","editable","popupTitle","BLOCK_DATES_TITLE","Lcz_BlockDatesFor","getDateStr","toISOString","formattedLegendData","splitBookingEvents","num","locale","toLocaleString","month","removeNewEvent","events","clickCell","isScrollViewDragging","refKey","hasOwnProperty","disabledCount","dateKey","isCellDisabled","showNewBookingPopup","bookings","today","startOf","compareTime","createDateWithOffsetAndHour","checkin_checkout_hours","hour","getGeneralCategoryDayColumns","addClass","isCategory","dayInfo","highlightedDate","getGeneralRoomDayColumns","roomName","prevDate","isDisabled","isSelected","isCurrentDate","cleaningDates","cleaningTasks","shouldBeCleaned","cleaning_frequency","code","onClick","Boolean","getRoomCategoryRow","is_active","popoverTitle","xmlns","viewBox","getRoomsByCategory","haveSingleRooms","housekeeping_enabled","hkModal","openModal","onMouseEnter","onMouseLeave","removeProperty","hk_status","hkStatus","display","getRoomRows","confirmHousekeepingUpdate","setExposedUnitHKStatus","propertyId","unit","executeHKAction","actions","hkm_id","housekeeper","booking_nbr","RATE_TYPE","language","leftBtnText","middleBtnText","renderModalMiddleButtonText","middleBtnActive","rightBtnText","renderModalRightButtonText","modalBody","renderModalBody","onConfirmModal","onMiddleModal","autoClose","isMiddleButtonLoading","onCancelModal","clear","categoryIndex","cellKey","getCellKey","is_available_to_book","iglCalFooterCss","IglCalFooterStyle0","IglCalFooter","handleOptionEvent","optionEvent","paddingLeft","Lcz_Legend","marginLeft","dayDisplayName","iglCalHeaderCss","IglCalHeaderStyle0","IglCalHeader","unassignedRoomsNumber","roomsList","toBeAssignedService","ToBeAssignedService","initializeRoomsList","handleUnAssignedDatesChange","newValue","fetchAndAssignUnassignedRooms","handleCalendarDataChanged","concat","assignRoomsToDate","unassignedDates","dt","selectedDate","getUnassignedRooms","propertyid","dateToFormattedString","res","newEndDate","renderView","handleReduceAvailableUnitEvent","showToBeAssigned","gotoToBeAssignedDate","handleDateSelect","handleClearSearch","handleFilterRooms","inputElement","trim","toLowerCase","handleScrollToRoom","gotoRoomEvent","getStringDateFormat","getNewBookingModel","setDate","Lcz_NewBooking","editabled","colorVariants","secondary","Lcz_UnassignedUnitsTooltip","btn_styles","visibleBackgroundOnHover","Lcz_Navigate","dateRef","Lcz_Today","Lcz_CreateNewBooking","Lcz_StopOpenSale","placeholder","Lcz_FindUnit","onOptionChange","monthsInfo","monthInfo","daysCount","monthName","unassigned_units_nbr","occupancy","iglLegendsCss","IglLegendsStyle0","IglLegends","propertyService","PropertyService","bookingColors","saveState","loadingIndex","saveTimeout","clearTimeout","handleSaveStateChange","syncCalendarExtra","colors","calendarExtra","booking_colors","updateBookingColor","patch","idx","persistBookingColors","saveError","setPropertyCalendarExtra","JSON","stringify","handleNameInput","handleBlur","handleLoaderComplete","currentIndex","legendInfo","l","design","stripeColor","colSpan","marginTop","marginBottom","paddingBottom","previewClass","inputContainerStyle","margin","onTextChange","onInputBlur","onLoaderComplete","Lcz_MonthAndYear","Lcz_UnassignedUnits","Lcz_Date","Lcz_Occupancy","Lcz_TotalAvailability","iglReallocationDialogCss","IglReallocationDialogStyle0","IglReallocationDialog","showRateplanError","handleDialogVisibilityChange","dialogClose","handleRateplanChange","selectedRateplan","handleCancelClick","dialogEl","handleDataChange","newData","resetState","reallocateUnit","validateRateplanSelection","revertBooking","resetModalState","rateplanOptions","option","formatRateplanLabel","suffix","custom_text","hasRateplanRequirement","focusRateplanSelect","selectEl","rateplanSelectEl","shadowRoot","focus","hasRateplans","onOpenChange","required","isRequestPending","SelectedUnitSchema","coerce","number","iglSplitBookingCss","IglSplitBookingStyle0","IglSplitBookingStyle1","IglSplitBooking","mealPlanOptions","getRoom","generateDates","selectedDates","MFromDate","MToDate","checkBookingAvailability","resetBookingStore","is_in_agent_mode","agent","getBookingAvailability","adultChildCount","adult","child","room_type_ids","agent_id","room_type_ids_to_update","doReservation","oldRooms","departure_time","assigned_units_pool","parent_room_identifier","is_split","roomtype","rateplan","assign_units","is_pms","is_backend","is_in_loyalty_mode","promo_key","extras","remark","booked_on","source","arrival","guest","pickup_info","err","issues","path","updateSelectedUnit","params","merged","roomTypesSource","mealPlanResult","hasExplicitRateplanUpdate","prototype","call","showDateDifference","short_name","is_non_refundable","Lcz_NonRefundable","units","unitMap","assignable_units","Is_Fully_Available","pr_id","showMealPlanSelect","iglTbaCategoryViewCss","IglTbaCategoryViewStyle0","IglTbaCategoryView","categoriesData","handleAssignRoomEvent","opt","eventDatas","eventData","assignUnitEvent","RT_ID","categoryId","assignEvent","getEventView","eventIndex","onAssignRoomEvent","iglToBeAssignedCss","IglToBeAssignedStyle0","IglToBeAssigned","showDatesList","orderedDatesList","noScroll","isGotoToBeAssignedDate","reArrangeData","loadingMessage","Lcz_FetchingUnAssignedUnits","handleUnassignedDatesToBeAssignedChange","setMinutes","setSeconds","sort","a","b","parseInt","showForDate","handleAssignUnit","categories","updateCategories","categorisedRooms","roomIds","getUnassignedDates","firstKey","gotoDate","handleToBeAssignedDate","showBookingPopup","dateStamp","withLoading","showUnassignedDate","addToBeAssignedEvent","getDay","dayOfWeek","getLocalizedDayOfWeek","weekday","toLocaleDateString","highlightToBeAssignedBookingEvent","getToBeAssignedEntities","getCategoryView","onAssignUnitEvent","Lcz_Assignments","Lcz_AllBookingsAreAssigned","ordDate","Lcz_AllAssignForThisDay","irInteractiveTitleCss","IrInteractiveTitleStyle0","IrInteractiveTitle","irPopoverLeft","cropSize","lastRenderedTitle","initializePopoverIfNeeded","titleContainer","popoverInstance","disposePopover","tempSpan","createElement","visibility","whiteSpace","textContent","body","appendChild","textWidth","removeChild","containerWidth","clientWidth","iconWidth","willOverflow","$","popover","trigger","content","placement","html","sanitize","delay","show","hide","titleContainerRef","shouldCrop","displayTitle","slice","overflow","textOverflow","alignItems","flexShrink","minWidth","broomTooltip","irRoomNightsCss","IrRoomNightsStyle0","IrRoomNightsStyle1","IrRoomNights","rates","initialLoading","inventory","isEndDateBeforeFromDate","defaultTotalNights","isInputFocused","init","isButtonDisabled","amount","fetchBookingAvailability","newDatesArr","getDaysArray","cost","handleInput","inputValue","rate_plan_id","bookingAvailability","selected_variation","adult_nbr","child_nbr","rate_plan_ids","rate_plan","variations","variation","discounted_gross_amount","renderInputField","currency_symbol","renderReadOnlyField","toFixed","renderRateFields","renderDates","symbol","convertDatePrice","handleRoomConfirmation","selectedRoomIndex","check_in","extra_services","closeRoomNightsDialog","Lcz_AddingRoomNightsTo","Lcz_Booking","formatDate","Lcz_NoAvailabilityForAdditionalNights","btn_disabled","irSuccessLoaderCss","IrSuccessLoaderStyle0","IrSuccessLoader","spinnerDuration","successDuration","autoStart","active","phase","startCycle","clearTimers","onActiveChange","resetCycle","onDurationChange","spinnerDelay","showSuccess","spinnerTimer","successDelay","handleCompletion","successTimer","loaderComplete","part","irTabsCss","IrTabsStyle0","IrTabs","ariaLabel","remSize","fontSize","getComputedStyle","documentElement","tab","t","initialTab","selectTab","updateActiveIndicator","parentLeft","activeIndicator","_selectedTab","tabChanged","handleKeyDown","currentTab","nextIndex","nextTab","tabButton","tabindex","onKeyDown"],"sources":["src/components/igloo-calendar/igl-booking-event/igl-booking-event.css?tag=igl-booking-event&encapsulation=scoped","src/components/igloo-calendar/igl-booking-event/igl-booking-event.tsx","src/utils/ReloadInterceptor.ts","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-block/igl-bulk-block.css?tag=igl-bulk-block&encapsulation=scoped","src/common/sheet.css?tag=igl-bulk-block&encapsulation=scoped","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-block/igl-bulk-block.tsx","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-operations.css?tag=igl-bulk-operations&encapsulation=scoped","src/common/sheet.css?tag=igl-bulk-operations&encapsulation=scoped","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-operations.tsx","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-stop-sale/igl-bulk-stop-sale.css?tag=igl-bulk-stop-sale&encapsulation=scoped","src/common/sheet.css?tag=igl-bulk-stop-sale&encapsulation=scoped","src/components/igloo-calendar/igl-bulk-operations/igl-bulk-stop-sale/igl-bulk-stop-sale.tsx","src/components/igloo-calendar/igl-cal-body/igl-cal-body.css?tag=igl-cal-body&encapsulation=scoped","src/components/igloo-calendar/igl-cal-body/igl-cal-body.tsx","src/components/igloo-calendar/igl-cal-footer/igl-cal-footer.css?tag=igl-cal-footer&encapsulation=scoped","src/components/igloo-calendar/igl-cal-footer/igl-cal-footer.tsx","src/components/igloo-calendar/igl-cal-header/igl-cal-header.css?tag=igl-cal-header&encapsulation=scoped","src/components/igloo-calendar/igl-cal-header/igl-cal-header.tsx","src/components/igloo-calendar/igl-legends/igl-legends.css?tag=igl-legends&encapsulation=scoped","src/components/igloo-calendar/igl-legends/igl-legends.tsx","src/components/igloo-calendar/igl-reallocation-dialog/igl-reallocation-dialog.css?tag=igl-reallocation-dialog&encapsulation=scoped","src/components/igloo-calendar/igl-reallocation-dialog/igl-reallocation-dialog.tsx","src/components/igloo-calendar/igl-split-booking/types.ts","src/components/igloo-calendar/igl-split-booking/igl-split-booking.css?tag=igl-split-booking&encapsulation=scoped","src/common/sheet.css?tag=igl-split-booking&encapsulation=scoped","src/components/igloo-calendar/igl-split-booking/igl-split-booking.tsx","src/components/igloo-calendar/igl-to-be-assigned/igl-tba-category-view/igl-tba-category-view.css?tag=igl-tba-category-view&encapsulation=scoped","src/components/igloo-calendar/igl-to-be-assigned/igl-tba-category-view/igl-tba-category-view.tsx","src/components/igloo-calendar/igl-to-be-assigned/igl-to-be-assigned.css?tag=igl-to-be-assigned&encapsulation=scoped","src/components/igloo-calendar/igl-to-be-assigned/igl-to-be-assigned.tsx","src/components/ui/ir-interactive-title/ir-interactive-title.css?tag=ir-interactive-title&encapsulation=scoped","src/components/ui/ir-interactive-title/ir-interactive-title.tsx","src/components/igloo-calendar/ir-room-nights/ir-room-nights.css?tag=ir-room-nights&encapsulation=scoped","src/common/sheet.css?tag=ir-room-nights&encapsulation=scoped","src/components/igloo-calendar/ir-room-nights/ir-room-nights.tsx","src/components/ui/ir-success-loader/ir-success-loader.css?tag=ir-success-loader&encapsulation=shadow","src/components/ui/ir-success-loader/ir-success-loader.tsx","src/components/ui/ir-tabs/ir-tabs.css?tag=ir-tabs&encapsulation=scoped","src/components/ui/ir-tabs/ir-tabs.tsx"],"sourcesContent":[":host {\n  display: block;\n  position: absolute;\n  --ota-bar-width: 2px;\n  --stripe-period: 20px;\n  --split-border-width: 5px;\n  --split-border-color: black;\n}\n\n.bookingEventBase {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  border-radius: 4px;\n  background-color: rgb(49, 190, 241);\n  transform: skewX(-22deg);\n  cursor: pointer;\n}\n.bookingEventBase.leftSplit {\n  border-left: var(--split-border-width) solid var(--split-border-color);\n}\n.bookingEventBase.rightSplit {\n  border-right: var(--split-border-width) solid var(--split-border-color);\n}\n.bookingEventBase.fullSplit {\n  border-right: var(--split-border-width) solid var(--split-border-color);\n  border-left: var(--split-border-width) solid var(--split-border-color);\n}\n\n.bookingEventBase.fullSplit.skewedLeft,\n.bookingEventBase.leftSplit.skewedLeft {\n  border-left: 0;\n}\n.bookingEventBase.fullSplit.skewedRight,\n.bookingEventBase.leftSplit.skewedRight {\n  border-right: 0;\n}\n\n.bookingEvent {\n  cursor: pointer;\n}\n\n/* OTA bar width helper */\n.ota-booking-event {\n  border-width: var(--ota-bar-width) !important;\n}\n\n/* Hidden sizing surface (note: fixed missing px) */\n.bookingEventHiddenBase {\n  position: absolute;\n  top: 0;\n  left: -4px;\n  width: calc(100% + 8px);\n}\n\n/* Shared half-tile base for skewed sides */\n.bookingEventBase.skewedLeft::before,\n.bookingEventBase.skewedRight::before {\n  content: '';\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  width: 50%;\n  height: 100%;\n  left: -4px;\n  background-color: var(--ir-event-bg);\n  border-radius: 4px;\n}\n\n/* Individual adjustments */\n.bookingEventBase.skewedLeft::before {\n  transform-origin: right;\n  transform: skewX(22deg);\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n.bookingEventBase.fullSplit.skewedLeft::before,\n.bookingEventBase.leftSplit.skewedLeft::before {\n  border-left: var(--split-border-width) solid var(--split-border-color) !important;\n  z-index: 2;\n  background-color: transparent;\n}\n.bookingEventBase.fullSplit.skewedRight::before,\n.bookingEventBase.leftRight.skewedRight::before {\n  border-right: var(--split-border-width) solid var(--split-border-color) !important;\n  z-index: 2;\n  background-color: transparent;\n}\n\n/* .bookingEventBase::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  background: inherit;\n  background-color: var(--ir-event-bg);\n  transform-origin: left;\n  left: 10px;\n  right: -4px;\n  transform: skewX(22deg);\n  border-radius: inherit;\n} */\n\n.bookingEventBase.skewedRight::before {\n  transform-origin: left;\n  transform: skewX(22deg 0deg);\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n/* Border variant on skewed halves */\n.bookingEventBase.border.skewedLeft::before {\n  border: var(--ota-bar-width) solid #424242;\n  border-right: 0;\n  border-left: 0;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n  top: calc(var(--ota-bar-width) * -1);\n  height: 20px;\n  left: -4px;\n}\n\n.bookingEventBase.border.skewedRight::before {\n  border: var(--ota-bar-width) solid #424242;\n  border-left: 0;\n  border-right: 0;\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n  top: calc(var(--ota-bar-width) * -1);\n  height: 20px;\n  right: -4px;\n}\n\n.bookingEventBase.striped-bar.fullSplit.skewedLeft.vertical::after,\n.bookingEventBase.striped-bar.leftSplit.skewedLeft.vertical::after {\n  z-index: 1;\n  border-left: var(--split-border-width) solid var(--split-border-color);\n}\n.bookingEventBase.striped-bar.fullSplit.skewedRight.vertical::after,\n.bookingEventBase.striped-bar.rightSplit.skewedRight.vertical::after {\n  z-index: 1;\n  border-right: var(--split-border-width) solid var(--split-border-color);\n}\n\n.bookingEventBase.striped-bar.vertical::after {\n  --stripe-angle: 360deg;\n}\n/* Striped overlay */\n.bookingEventBase.striped-bar::after {\n  content: '';\n  position: absolute;\n  inset: 0;\n  border-radius: 4px;\n\n  /* clean, seamless repeating tile */\n  background: repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-event-bg) 0,\n    var(--ir-event-bg) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  );\n  backface-visibility: hidden;\n}\n.bookingEventBase.skewedRight.striped-bar::after,\n.bookingEventBase.border.skewedRight::after {\n  right: -8px;\n}\n.bookingEventBase.skewedLeft.striped-bar::after,\n.bookingEventBase.border.skewedLeft::after {\n  left: -8px;\n}\n.bookingEventBase.striped-bar.animated::after {\n  background-size: 28.28px 28.28px;\n  backface-visibility: hidden;\n  animation: stripes 0.8s linear infinite;\n  will-change: background-position;\n}\n\n@keyframes stripes {\n  0% {\n    background-position: 0 0;\n  }\n  100% {\n    background-position: 28.28px 0;\n  }\n}\n.bookingEventDragHandle {\n  position: absolute;\n  top: 0;\n  width: 15px;\n  height: 100%;\n  opacity: 0.1;\n  background-color: rgba(0, 0, 0, 0.15);\n  transform: skewX(-22deg);\n  border-radius: 4px;\n  /* display: none; */\n  cursor: pointer;\n}\n\n:host:hover .bookingEventDragHandle {\n  display: block;\n  opacity: 1;\n}\n\n:host.newEvent:hover .bookingEventDragHandle {\n  display: none;\n  opacity: 1;\n}\n\n.leftSide {\n  left: 0;\n}\n.rightSide {\n  right: 0;\n}\n\n/* cancel skew on side wrappers when needed */\n.leftSide.skewedLeft {\n  transform: skewX(0);\n}\n.rightSide.skewedRight {\n  transform: skewX(0);\n}\n\n.bookingEventTitle {\n  position: relative;\n  top: 2px;\n  left: 5px;\n  max-width: calc(100% - 10px);\n  color: #fff;\n  font-size: 0.8em;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n  cursor: pointer;\n}\n\n.legend_circle {\n  width: 10px;\n  height: 10px;\n  margin: 3px 3px 3px 2px;\n  border: 1px solid #fff;\n  border-radius: 100%;\n}\n\n.noteIcon {\n  position: absolute;\n  bottom: -8px;\n  left: 2px;\n}\n\n.balanceIcon {\n  position: absolute;\n  top: -8px;\n  right: 2px;\n}\n.splitBooking {\n  border-right: 2px solid #000000;\n}\n","import { Component, Element, Event, EventEmitter, Fragment, Host, Listen, Prop, State, h } from '@stencil/core';\nimport { BookingService } from '@/services/booking.service';\nimport { buildSplitIndex, calculateDaysBetweenDates, getSplitRole, transformNewBooking } from '@/utils/booking';\nimport { checkMealPlan, isBlockUnit } from '@/utils/utils';\nimport { IRoomNightsData, CalendarModalEvent } from '@/models/property-types';\nimport moment from 'moment';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport { EventsService } from '@/services/events.service';\nimport locales from '@/stores/locales.store';\nimport { ICountry } from '@/models/IBooking';\nimport calendar_dates from '@/stores/calendar-dates.store';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'igl-booking-event',\n  styleUrl: 'igl-booking-event.css',\n  scoped: true,\n})\nexport class IglBookingEvent {\n  @Element() private element: HTMLElement;\n\n  @Prop() currency;\n  @Prop() is_vacation_rental: boolean = false;\n  @Prop() language: string;\n  @Prop({ mutable: true }) bookingEvent: { [key: string]: any };\n  @Prop() allBookingEvents: { [key: string]: any } = [];\n  @Prop() countries: ICountry[];\n\n  @Event({ bubbles: true, composed: true }) hideBubbleInfo: EventEmitter;\n  @Event() updateEventData: EventEmitter;\n  @Event() dragOverEventData: EventEmitter;\n  @Event() showRoomNightsDialog: EventEmitter<IRoomNightsData>;\n  @Event() showDialog: EventEmitter<CalendarModalEvent>;\n  @Event() resetStretchedBooking: EventEmitter<string>;\n  @Event() toast: EventEmitter<IToast>;\n  @Event() updateBookingEvent: EventEmitter<{ [key: string]: any }>;\n\n  @State() renderElement: boolean = false;\n  @State() position: { [key: string]: any };\n  @State() isShrinking: boolean | null = null;\n\n  private dayWidth: number = 0;\n  private eventSpace: number = 8;\n\n  private vertSpace: number = 10;\n\n  /* show bubble */\n  private showInfoPopup: boolean = false;\n  private bubbleInfoTopSide: boolean = false;\n  private isStretch = false;\n  /*Services */\n  private eventsService = new EventsService();\n  private bookingService = new BookingService();\n  /* Resize props */\n  private resizeSide: string = '';\n  private isDragging: boolean = false;\n  private initialX: number;\n  private initialY: number;\n  private currentX: number;\n  private currentY: number;\n  private initialWidth: number;\n  private initialLeft: number;\n  private finalWidth: number;\n  private dragInitPos: { [key: string]: any };\n  private dragEndPos: { [key: string]: any };\n  elementRect: { [key: string]: any };\n  private isTouchStart: boolean;\n  private moveDifferenceX: number;\n  private moveDifferenceY: number;\n  private animationFrameId: number | null = null;\n\n  private handleMouseMoveBind = this.handleMouseMove.bind(this);\n  private handleMouseUpBind = this.handleMouseUp.bind(this);\n  private handleClickOutsideBind = this.handleClickOutside.bind(this);\n\n  private role: string = '';\n\n  componentWillLoad() {\n    window.addEventListener('click', this.handleClickOutsideBind);\n\n    this.bookingEvent.SPLIT_INDEX = buildSplitIndex(this.bookingEvent.ROOMS);\n    if (this.bookingEvent.SPLIT_INDEX) {\n      this.role = getSplitRole(this.bookingEvent.SPLIT_INDEX, this.bookingEvent.IDENTIFIER) ?? '';\n    }\n  }\n\n  componentDidLoad() {\n    if (this.isNewEvent()) {\n      if (!this.bookingEvent.hideBubble) {\n        /* auto matically open the popup, calling the method shows bubble either top or bottom based on available space. */\n        setTimeout(async () => {\n          if (['003', '002', '004'].includes(this.bookingEvent.STATUS_CODE)) {\n            this.showEventInfo(true);\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\n            await this.fetchAndAssignBookingData();\n          } else {\n            this.showEventInfo(true);\n          }\n          this.renderAgain();\n        }, 1);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    window.removeEventListener('click', this.handleClickOutsideBind);\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n  }\n\n  @Listen('click', { target: 'window' })\n  handleClickOutside(event: Event) {\n    const clickedElement = event.target as HTMLElement;\n    // Check if the clicked element is not within the target div\n    if (!this.element.contains(clickedElement)) {\n      // The click occurred outside the target div\n      this.showEventInfo(false);\n    }\n  }\n\n  @Listen('hideBubbleInfo', { target: 'window' })\n  hideBubbleInfoPopup(event: CustomEvent) {\n    if (event.detail.currentInfoBubbleId != this.getBookingId() || (event.detail.key === 'hidebubble' && event.detail.currentInfoBubbleId === this.getBookingId())) {\n      this.showInfoPopup = false;\n      this.renderAgain();\n    }\n  }\n\n  @Listen('moveBookingTo', { target: 'window' })\n  async moveBookingToHandler(event: CustomEvent) {\n    try {\n      if (event.detail.bookingId !== this.getBookingId()) {\n        this.showEventInfo(false);\n        return;\n      }\n\n      if (event.detail.moveToDay === 'revert' || event.detail.toRoomId === 'revert') {\n        event.detail.moveToDay = this.bookingEvent.FROM_DATE;\n        event.detail.toRoomId = event.detail.fromRoomId;\n        if (this.isTouchStart && this.moveDifferenceX <= 5 && this.moveDifferenceY <= 5 && !this.isStretch) {\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n            this.showEventInfo(true);\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\n            await this.fetchAndAssignBookingData();\n          }\n        } else {\n          this.animationFrameId = requestAnimationFrame(() => {\n            this.resetBookingToInitialPosition();\n          });\n          return;\n        }\n      } else {\n        if (this.isTouchStart && this.moveDifferenceX <= 5 && this.moveDifferenceY <= 5 && !this.isStretch) {\n          if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n            this.showEventInfo(true);\n          } else if (['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'].includes(this.bookingEvent.STATUS)) {\n            await this.fetchAndAssignBookingData();\n          }\n        } else {\n          const { pool, to_date, from_date, toRoomId } = event.detail as any;\n          const previousToDate = moment(to_date, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD');\n          console.log(this.findRoomType(Number(this.bookingEvent.PR_ID)), this.findRoomType(Number(toRoomId)));\n          if (\n            (!moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD').isSame(moment(to_date, 'YYYY-MM-DD'), 'dates') ||\n              this.findRoomType(Number(this.bookingEvent.PR_ID)) !== this.findRoomType(Number(toRoomId))) &&\n            (calendar_dates.disabled_cells.get(`${toRoomId}_${from_date}`)?.disabled ||\n              (calendar_dates.disabled_cells.get(`${toRoomId}_${to_date}`)?.disabled && calendar_dates.disabled_cells.get(`${toRoomId}_${previousToDate}`)?.disabled)) &&\n            !this.isStretch\n          ) {\n            this.reset('This room isnâ€™t available for the entire selected period. Please choose different dates or a different room.');\n          }\n          if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\n            this.reset('Overlapping Dates');\n          }\n          if (pool) {\n            if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n              // let fromDate = moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(moment(new Date(from_date)))\n              //   ? this.bookingEvent.defaultDates.from_date\n              //   : from_date;\n              // console.log('room', fromDate, this.bookingEvent.defaultDates.from_date, from_date);\n              await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date).catch(() => {\n                this.resetBookingToInitialPosition();\n              });\n            } else {\n              if (this.isShrinking || !this.isStretch) {\n                // try {\n                //   if (this.bookingEvent.PR_ID.toString() === toRoomId.toString()) {\n                //     await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date);\n                //     return;\n                //   }\n                // } catch (error) {\n                //   this.resetBookingToInitialPosition();\n                //   return;\n                // }\n                const { description, status, newRatePlans } = this.getModalDescription(toRoomId, from_date, to_date);\n                let hideConfirmButton = false;\n                if (status === '400') {\n                  hideConfirmButton = true;\n                }\n                const oldFromDate = this.bookingEvent.defaultDates.from_date;\n                const oldToDate = this.bookingEvent.defaultDates.to_date;\n                const diffDays = calculateDaysBetweenDates(oldFromDate, oldToDate);\n\n                let shrinkingDirection = null;\n                let fromDate = oldFromDate;\n                let toDate = oldToDate;\n                if (this.isShrinking) {\n                  if (moment(from_date, 'YYYY-MM-DD').isAfter(moment(oldFromDate, 'YYYY-MM-DD')) && moment(to_date, 'YYYY-MM-DD').isBefore(moment(oldToDate, 'YYYY-MM-DD'))) {\n                    fromDate = oldFromDate;\n                    toDate = to_date;\n                  } else {\n                    shrinkingDirection = moment(from_date, 'YYYY-MM-DD').isAfter(moment(oldFromDate, 'YYYY-MM-DD'))\n                      ? 'left'\n                      : moment(to_date, 'YYYY-MM-DD').isBefore(moment(oldToDate, 'YYYY-MM-DD'))\n                      ? 'right'\n                      : null;\n                    if (shrinkingDirection === 'left') {\n                      fromDate = from_date;\n                    }\n\n                    if (shrinkingDirection === 'right') {\n                      toDate = to_date;\n                    }\n                  }\n                } else {\n                  console.log('stretching');\n                  if (moment(from_date, 'YYYY-MM-DD').isBefore(moment(oldFromDate, 'YYYY-MM-DD'))) {\n                    fromDate = from_date;\n                    const newToDate = moment(from_date, 'YYYY-MM-DD').add(diffDays, 'days');\n                    toDate = newToDate.isBefore(moment(to_date, 'YYYY-MM-DD'), 'days') ? to_date : newToDate.format('YYYY-MM-DD');\n                  } else if (moment(to_date, 'YYYY-MM-DD').isAfter(moment(oldToDate, 'YYYY-MM-DD'))) {\n                    toDate = to_date;\n                    fromDate = moment(to_date, 'YYYY-MM-DD').subtract(diffDays, 'days').format('YYYY-MM-DD');\n                  }\n                }\n                console.warn({ fromDate, toDate });\n                this.showDialog.emit({\n                  reason: 'reallocate',\n                  ...event.detail,\n                  description,\n                  title: '',\n                  rateplans: newRatePlans,\n                  hideConfirmButton,\n                  from_date: fromDate,\n                  to_date: toDate,\n                });\n              } else {\n                // if (this.checkIfSlotOccupied(toRoomId, from_date, to_date)) {\n                //   this.animationFrameId = requestAnimationFrame(() => {\n                //     this.resetBookingToInitialPosition();\n                //   });\n                //   throw new Error('Overlapping Dates');\n                // } else {\n\n                // let stretchDirection: \"left\" | \"right\"\n                const oldFromDate = this.bookingEvent.defaultDates.from_date;\n                const oldToDate = this.bookingEvent.defaultDates.to_date;\n                // const diffDays = calculateDaysBetweenDates(oldFromDate, oldToDate);\n\n                // let fromDate = oldFromDate;\n\n                // if (moment(from_date, 'YYYY-MM-DD').isBefore(moment(oldFromDate, 'YYYY-MM-DD'))) {\n                //   fromDate = from_date;\n                //   const newToDate = moment(from_date, 'YYYY-MM-DD').add(diffDays, 'days');\n                //   toDate = newToDate.isBefore(moment(to_date, 'YYYY-MM-DD'), 'days') ? to_date : newToDate.format('YYYY-MM-DD');\n                // } else if (moment(to_date, 'YYYY-MM-DD').isAfter(moment(oldToDate, 'YYYY-MM-DD'))) {\n                //   toDate = to_date;\n                //   fromDate = moment(to_date, 'YYYY-MM-DD').subtract(diffDays, 'days').format('YYYY-MM-DD');\n                // }\n                const validateDates = (base_date: string, to_date: string) => {\n                  let cursor = base_date;\n                  let counter = 0;\n                  while (cursor !== to_date) {\n                    if (calendar_dates.disabled_cells.get(`${toRoomId}_${cursor}`)?.disabled) {\n                      counter++;\n                    }\n                    cursor = moment(cursor, 'YYYY-MM-DD').add(1, 'days').format('YYYY-MM-DD');\n                  }\n                  if (counter >= 1) {\n                    this.reset(locales.entries.Lcz_ThisUnitIsNotAvailable);\n                  }\n                };\n\n                if (moment(oldToDate, 'YYYY-MM-DD').isBefore(moment(to_date), 'dates')) {\n                  validateDates(oldToDate, to_date);\n                } else if (moment(oldFromDate, 'YYYY-MM-DD').isAfter(moment(from_date, 'YYYY-MM-DD'), 'dates')) {\n                  validateDates(from_date, oldFromDate);\n                }\n                const payload: IRoomNightsData = {\n                  booking: this.bookingEvent,\n                  bookingNumber: this.bookingEvent.BOOKING_NUMBER,\n                  identifier: this.bookingEvent.IDENTIFIER,\n                  to_date,\n                  pool,\n                  from_date,\n                  defaultDates: this.bookingEvent.defaultDates,\n                };\n                if (!this.bookingEvent.is_direct) {\n                  this.showDialog.emit({ reason: 'stretch', ...payload });\n                } else {\n                  this.showRoomNightsDialog.emit(payload);\n                }\n                // }\n              }\n            }\n            this.isShrinking = null;\n          }\n        }\n      }\n    } catch (error) {\n      this.toast.emit({\n        position: 'top-right',\n        title: error.message,\n        description: '',\n        type: 'error',\n      });\n      console.log('something went wrong');\n    }\n  }\n\n  private async fetchAndAssignBookingData() {\n    try {\n      console.log('clicked on book#', this.bookingEvent.BOOKING_NUMBER);\n\n      const validStatuses = ['IN-HOUSE', 'CONFIRMED', 'PENDING-CONFIRMATION', 'CHECKED-OUT'];\n      if (!validStatuses.includes(this.bookingEvent.STATUS)) {\n        return;\n      }\n\n      const data = await this.bookingService.getExposedBooking(this.bookingEvent.BOOKING_NUMBER, 'en');\n      const base_booking = { ...data };\n      const filteredRooms = data.rooms.filter(room => room['assigned_units_pool'] === this.bookingEvent.ID);\n\n      if (filteredRooms.length === 0) {\n        throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty array`);\n      }\n\n      if (filteredRooms.some(room => room['assigned_units_pool'] === null)) {\n        throw new Error(`booking#${this.bookingEvent.BOOKING_NUMBER} has an empty pool`);\n      }\n\n      data.rooms = filteredRooms;\n\n      const transformedBooking = transformNewBooking(data)[0];\n      const {\n        ID,\n        TO_DATE,\n        FROM_DATE,\n        NO_OF_DAYS,\n        STATUS,\n        NAME,\n        IDENTIFIER,\n        origin,\n        TOTAL_PRICE,\n        PR_ID,\n        POOL,\n        BOOKING_NUMBER,\n        NOTES,\n        is_direct,\n        BALANCE,\n        channel_booking_nbr,\n        ...otherBookingData\n      } = transformedBooking;\n      this.bookingEvent = {\n        ...otherBookingData,\n        ...this.bookingEvent,\n        channel_booking_nbr,\n        booking: data,\n        base_booking,\n        DEPARTURE_TIME: otherBookingData.DEPARTURE_TIME,\n        PHONE: otherBookingData.PHONE,\n        PHONE_PREFIX: otherBookingData.PHONE_PREFIX,\n        PRIVATE_NOTE: otherBookingData.PRIVATE_NOTE,\n        origin,\n        BALANCE,\n        TOTAL_PRICE,\n        ROOM_INFO: { ...this.bookingEvent.ROOM_INFO, sharing_persons: otherBookingData.ROOM_INFO.sharing_persons },\n      };\n      this.updateBookingEvent.emit(this.bookingEvent);\n      this.showEventInfo(true);\n    } catch (error) {\n      console.error(error.message);\n    }\n  }\n\n  private reset(message: string) {\n    this.animationFrameId = requestAnimationFrame(() => {\n      this.resetBookingToInitialPosition();\n    });\n    throw new Error(message);\n  }\n\n  private findRoomType = (roomId: number) => {\n    let roomType = this.bookingEvent.roomsInfo.filter(room => room.physicalrooms.some(r => r.id === +roomId));\n    if (roomType.length) {\n      return roomType[0].id;\n    }\n    return null;\n  };\n\n  private getModalDescription(toRoomId: number, from_date, to_date): { status: '200' | '400'; description: string; newRatePlans?: any[] } {\n    if (!this.bookingEvent.is_direct) {\n      if (this.isShrinking) {\n        return {\n          description: locales.entries.Lcz_OTA_Modification_Alter,\n          status: '200',\n        };\n        // return {\n        //   description: `${locales.entries.Lcz_YouWillLoseFutureUpdates}.`,\n        //   status: '200',\n        // };\n      } else {\n        if (\n          moment(from_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.FROM_DATE, 'YYYY-MM-DD')) &&\n          moment(to_date, 'YYYY-MM-DD').isSame(moment(this.bookingEvent.TO_DATE, 'YYYY-MM-DD'))\n        ) {\n          const initialRT = this.findRoomType(this.bookingEvent.PR_ID);\n          const targetRT = this.findRoomType(toRoomId);\n          if (initialRT === targetRT) {\n            return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\n          } else {\n            const mealPlans = checkMealPlan({\n              rateplan_id: this.bookingEvent.RATE_PLAN_ID,\n              roomTypeId: targetRT,\n              roomTypes: calendar_data?.property?.roomtypes,\n            });\n            return {\n              description: locales.entries.Lcz_OTA_Modification_Alter,\n              status: '200',\n              newRatePlans: Array.isArray(mealPlans) ? mealPlans : undefined,\n            };\n            // return {\n            //   description: `${locales.entries.Lcz_YouWillLoseFutureUpdates} ${this.bookingEvent.origin ? this.bookingEvent.origin.Label : ''}. ${\n            //     locales.entries.Lcz_SameRatesWillBeKept + '.'\n            //   }`,\n            //   status: '200',\n            // };\n          }\n        }\n        return { description: locales.entries.Lcz_CannotChangeCHBookings + '.', status: '400' };\n      }\n    } else {\n      if (!this.isShrinking) {\n        const initialRT = this.findRoomType(Number(this.bookingEvent.PR_ID));\n        const targetRT = this.findRoomType(Number(toRoomId));\n        if (initialRT === targetRT) {\n          console.log('same rt');\n          if (this.bookingEvent.PR_ID.toString() === toRoomId.toString()) {\n            //TODO add the description\n            return { description: locales.entries.Lcz_ConfrmModiication + '.', status: '200' };\n          }\n          return { description: `${locales.entries.Lcz_AreYouSureWantToMoveAnotherUnit}?`, status: '200' };\n        } else {\n          const mealPlans = checkMealPlan({\n            rateplan_id: this.bookingEvent.RATE_PLAN_ID,\n            roomTypeId: targetRT,\n            roomTypes: calendar_data?.property?.roomtypes,\n          });\n\n          return {\n            description: locales.entries.Lcz_SameRatesWillBeKept,\n            status: '200',\n            newRatePlans: Array.isArray(mealPlans) ? mealPlans : undefined,\n          };\n        }\n      }\n      return { description: locales.entries.Lcz_ConfrmModiication + '.', status: '200' };\n    }\n  }\n\n  private resetBookingToInitialPosition() {\n    if (this.isStretch) {\n      this.element.style.left = `${this.initialLeft}px`;\n      this.element.style.width = `${this.initialWidth}px`;\n      this.isStretch = false;\n      this.finalWidth = this.initialWidth;\n      this.isShrinking = null;\n    } else {\n      this.element.style.top = `${this.dragInitPos.top}px`;\n      this.element.style.left = `${this.dragInitPos.left}px`;\n    }\n  }\n\n  @Listen('revertBooking', { target: 'window' })\n  handleRevertBooking(event: CustomEvent<string>) {\n    if (this.bookingEvent.POOL === event.detail) {\n      this.resetBookingToInitialPosition();\n    }\n  }\n\n  checkIfSlotOccupied(toRoomId, from_date, to_date) {\n    const fromTime = moment(from_date, 'YYYY-MM-DD');\n    const toTime = moment(to_date, 'YYYY-MM-DD');\n    const isOccupied = this.allBookingEvents.some(event => {\n      if (event.POOL === this.bookingEvent.POOL) {\n        return false;\n      }\n      const eventFromTime = moment(event.FROM_DATE, 'YYYY-MM-DD').add(1, 'days');\n      const eventToTime = moment(event.TO_DATE, 'YYYY-MM-DD');\n      return event.PR_ID === +toRoomId && toTime.isSameOrAfter(eventFromTime) && fromTime.isBefore(eventToTime);\n    });\n    return isOccupied;\n  }\n\n  renderAgain() {\n    this.renderElement = !this.renderElement;\n  }\n\n  getUniqueId() {\n    return new Date().getTime();\n  }\n\n  isSplitBooking() {\n    return !!this.bookingEvent.SPLIT_BOOKING;\n  }\n\n  isNewEvent() {\n    return this.getBookingId() === 'NEW_TEMP_EVENT';\n  }\n\n  isHighlightEventType() {\n    return this.getEventType() === 'HIGH_LIGHT';\n  }\n\n  getBookingId() {\n    return this.bookingEvent.ID;\n  }\n\n  getBookingStatus() {\n    return this.bookingEvent.STATUS;\n  }\n\n  getBookedBy() {\n    return this.bookingEvent.NAME;\n  }\n\n  getBookedRoomId() {\n    return this.bookingEvent.PR_ID;\n  }\n\n  getEventStartingDate() {\n    return new Date(this.bookingEvent.FROM_DATE);\n  }\n\n  getEventEndingDate() {\n    return new Date(this.bookingEvent.TO_DATE);\n  }\n\n  getEventType() {\n    return this.bookingEvent.event_type;\n  }\n\n  getEventLegend() {\n    // console.log(this.getBookingStatus());\n    let status = this.bookingEvent?.legendData.statusId[this.getBookingStatus()];\n    let orderRide = this.isNewEvent() ? { color: '#f9f9c9' } : {};\n    return {\n      ...this.bookingEvent?.legendData[status.id],\n      ...status,\n      ...orderRide,\n    };\n  }\n\n  getLegendOfStatus(aStatusId) {\n    // console.log(aStatusId);\n    let status = this.bookingEvent?.legendData.statusId[aStatusId];\n    return { ...this.bookingEvent.legendData[status.id], ...status };\n  }\n\n  getNoteNode() {\n    if (this.bookingEvent.NOTES || this.bookingEvent.INTERNAL_NOTE || this.bookingEvent.PRIVATE_NOTE) {\n      return this.getLegendOfStatus('NOTES');\n    }\n    return null;\n  }\n\n  getBalanceNode() {\n    if (this.bookingEvent.BALANCE !== null && this.bookingEvent.BALANCE >= 1) {\n      return this.getLegendOfStatus('OUTSTANDING-BALANCE');\n    }\n    return null;\n  }\n\n  setStayDays(aStayDays: number) {\n    this.bookingEvent.NO_OF_DAYS = aStayDays;\n    this.renderAgain();\n    // this.updateData({id: this.getBookedRoomId(), data: { NO_OF_DAYS: aStayDays }});\n  }\n\n  getStayDays() {\n    return this.bookingEvent.NO_OF_DAYS;\n  }\n\n  getPosition() {\n    let startingDate = this.getEventStartingDate();\n    let startingCellClass = '.room_' + this.getBookedRoomId() + '_' + startingDate.getDate() + '_' + (startingDate.getMonth() + 1) + '_' + startingDate.getFullYear();\n    let bodyContainer = document.querySelector('.bodyContainer');\n    let startingCell = document.querySelector(startingCellClass);\n    let pos = { top: '0', left: '0', width: '0', height: '20px' };\n    if (startingCell && bodyContainer && startingCell.getBoundingClientRect() && bodyContainer.getBoundingClientRect()) {\n      let bodyContainerRect = bodyContainer.getBoundingClientRect();\n      let boundingRect = startingCell.getBoundingClientRect();\n      this.dayWidth = this.dayWidth || boundingRect.width;\n      pos.top = boundingRect.top + boundingRect.height / 2 - this.vertSpace - bodyContainerRect.top + 'px';\n      // pos.left = boundingRect.left + this.dayWidth / 2 + this.eventSpace / 2 - bodyContainerRect.left + 'px';\n      // pos.width = this.getStayDays() * this.dayWidth - this.eventSpace + 'px';\n      pos.left =\n        boundingRect.left +\n        (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 0 : this.dayWidth / 2) +\n        this.eventSpace / 2 -\n        bodyContainerRect.left +\n        'px';\n      pos.width =\n        (this.getStayDays() + (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 0.5 : 0)) *\n          this.dayWidth -\n        this.eventSpace +\n        'px';\n    } else {\n      console.log(this.bookingEvent);\n      console.log('Locating event cell failed ', startingCellClass);\n    }\n    //console.log(pos);\n    return pos;\n  }\n\n  getNumber(aData) {\n    return aData ? parseFloat(aData) : 0;\n  }\n\n  startDragging(event: any, side: string) {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (this.isNewEvent() || this.isHighlightEventType()) {\n      return null;\n    }\n\n    this.resizeSide = side;\n    this.isDragging = true;\n\n    this.showEventInfo(false);\n    this.isStretch = side !== 'move';\n    if (side === 'move') {\n      this.initialX = event.clientX || event.touches[0].clientX;\n      this.initialY = event.clientY || event.touches[0].clientY;\n      this.elementRect = this.element.getBoundingClientRect();\n      const offsetX = 0;\n      const offsetY = 0;\n      this.dragInitPos = {\n        id: this.getBookingId(),\n        fromRoomId: this.getBookedRoomId(),\n        top: this.getNumber(this.element.style.top) + offsetY,\n        left: this.getNumber(this.element.style.left) + offsetX,\n      };\n      this.dragInitPos.x = this.dragInitPos.left;\n      this.dragInitPos.y = this.dragInitPos.top;\n      this.dragEndPos = { ...this.dragInitPos };\n      this.element.style.top = `${this.dragInitPos.top}px`;\n      this.element.style.left = `${this.dragInitPos.left}px`;\n      this.isTouchStart = true; // !!(event.touches && event.touches.length);\n      this.dragOverEventData.emit({\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\n        data: this.dragInitPos,\n      });\n    } else {\n      this.initialWidth = this.element.offsetWidth;\n      this.initialLeft = this.element.offsetLeft;\n      this.initialX = event.clientX || event.touches[0].clientX;\n      this.dragOverEventData.emit({\n        id: 'CALCULATE_DRAG_OVER_BOUNDS',\n        data: {\n          id: this.getBookingId(),\n          fromRoomId: this.getBookedRoomId(),\n          top: this.getNumber(this.element.style.top),\n          left: this.initialLeft,\n          x: this.initialX,\n          y: event.clientY || event.touches[0].clientY,\n        },\n      });\n    }\n\n    document.addEventListener('mousemove', this.handleMouseMoveBind);\n    document.addEventListener('touchmove', this.handleMouseMoveBind);\n    document.addEventListener('pointermove', this.handleMouseMoveBind);\n\n    document.addEventListener('mouseup', this.handleMouseUpBind);\n    document.addEventListener('touchup', this.handleMouseUpBind);\n    document.addEventListener('pointerup', this.handleMouseUpBind);\n  }\n\n  handleMouseMove(event: any) {\n    if (this.isDragging) {\n      this.currentX = event.clientX || event.touches[0].clientX;\n      let distanceX = this.currentX - this.initialX;\n      if (this.resizeSide === 'move') {\n        this.currentY = event.clientY || event.touches[0].clientY;\n        let distanceY = this.currentY - this.initialY;\n        this.element.style.top = `${this.dragInitPos.top + distanceY}px`;\n        this.element.style.left = `${this.dragInitPos.left + distanceX}px`;\n        this.dragEndPos = {\n          id: this.getBookingId(),\n          fromRoomId: this.getBookedRoomId(),\n          top: this.dragInitPos.top + distanceY,\n          left: this.dragInitPos.left + distanceX,\n        };\n        this.dragEndPos.x = this.dragEndPos.left; // + 18;\n        this.dragEndPos.y = this.dragEndPos.top; // + (this.elementRect.height/2);\n        this.dragOverEventData.emit({ id: 'DRAG_OVER', data: this.dragEndPos });\n      } else {\n        // if (this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n        //   return;\n        // }\n        if (this.role === 'fullSplit') {\n          return;\n        }\n        const baseCondition = !this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE);\n        let newWidth = this.initialWidth;\n        if (this.resizeSide == 'rightSide') {\n          newWidth = this.initialWidth + distanceX;\n          newWidth = Math.min(newWidth, this.initialX + this.element.offsetWidth);\n          newWidth = Math.max(this.dayWidth - this.eventSpace, newWidth);\n          this.isShrinking = distanceX < 0;\n          if (!this.isShrinking && baseCondition) {\n            return;\n          }\n          if (this.role === 'rightSplit') {\n            return;\n          }\n          this.element.style.width = `${newWidth}px`;\n        } else if (this.resizeSide == 'leftSide') {\n          this.isShrinking = distanceX > 0;\n          if (!this.isShrinking && baseCondition) {\n            return;\n          }\n          if (this.role === 'leftSplit') {\n            return;\n          }\n          newWidth = Math.max(this.dayWidth - this.eventSpace, this.initialWidth - distanceX);\n          let newLeft = this.initialLeft + (this.initialWidth - newWidth);\n          this.element.style.left = `${newLeft}px`;\n          this.element.style.width = `${newWidth}px`;\n        }\n        this.finalWidth = newWidth;\n      }\n    } else {\n      console.log('still mouse move listening...');\n    }\n  }\n\n  handleMouseUp() {\n    if (this.isDragging) {\n      if (this.resizeSide === 'move') {\n        // console.log(\"Initial X::\"+this.dragInitPos.x);\n        // console.log(\"Initial Y::\"+this.dragInitPos.y);\n        // console.log(\"End X::\"+this.dragEndPos.x);\n        // console.log(\"End Y::\"+this.dragEndPos.y);\n        if (this.isTouchStart) {\n          this.moveDifferenceX = Math.abs(this.dragEndPos.x - this.dragInitPos.x);\n          this.moveDifferenceY = Math.abs(this.dragEndPos.y - this.dragInitPos.y);\n        }\n        this.dragOverEventData.emit({\n          id: 'DRAG_OVER_END',\n          data: {\n            ...this.dragEndPos,\n            pool: this.bookingEvent.POOL,\n            nbOfDays: this.bookingEvent.NO_OF_DAYS,\n          },\n        });\n      } else {\n        const finalWidth =\n          this.finalWidth -\n          (!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? this.dayWidth / 2 : 0);\n        const numberOfDays = Math.round(finalWidth / this.dayWidth);\n        console.log(finalWidth, this.dayWidth, numberOfDays);\n        let initialStayDays = this.getStayDays();\n        if (initialStayDays != numberOfDays && !isNaN(numberOfDays)) {\n          //this.setStayDays(numberOfDays);\n          if (this.resizeSide == 'leftSide') {\n            this.element.style.left = `${this.initialLeft + (initialStayDays - numberOfDays) * this.dayWidth}px`;\n            // set FROM_DATE = TO_DATE - numberOfDays\n          } else {\n            if (numberOfDays < initialStayDays) {\n              this.isShrinking = true;\n            }\n            // set TO_DATE = FROM_DATE + numberOfDays\n          }\n          // const nbrOfDays =\n          // !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? numberOfDays - 1 : numberOfDays;\n          this.dragOverEventData.emit({\n            id: 'STRETCH_OVER_END',\n            data: {\n              id: this.getBookingId(),\n              fromRoomId: +this.getBookedRoomId(),\n              x: +this.element.style.left.replace('px', ''),\n              y: +this.element.style.top.replace('px', ''),\n              pool: this.bookingEvent.POOL,\n              nbOfDays: numberOfDays,\n            },\n          });\n          const offset = !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? +this.dayWidth / 2 : 0;\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace + offset}px`;\n        } else {\n          this.element.style.left = `${this.initialLeft}px`;\n          this.element.style.width = `${numberOfDays * this.dayWidth - this.eventSpace}px`;\n        }\n      }\n    } else {\n      console.log('still mouse up listening...');\n    }\n    this.isDragging = false;\n\n    document.removeEventListener('mousemove', this.handleMouseMoveBind);\n    document.removeEventListener('touchmove', this.handleMouseMoveBind);\n    document.removeEventListener('pointermove', this.handleMouseMoveBind);\n\n    document.removeEventListener('mouseup', this.handleMouseUpBind);\n    document.removeEventListener('touchup', this.handleMouseUpBind);\n    document.removeEventListener('pointerup', this.handleMouseUpBind);\n  }\n\n  updateData(data: any) {\n    this.updateEventData.emit(data);\n  }\n  private calculateHoverPosition() {\n    const barRect = this.element.getBoundingClientRect();\n    const barWidth = barRect.width;\n    const barLeft = barRect.left;\n    const screenWidth = window.innerWidth;\n\n    let hoverLeft;\n\n    if (barWidth <= screenWidth) {\n      hoverLeft = barWidth / 2;\n    } else {\n      hoverLeft = screenWidth / 2 - barLeft;\n    }\n    return {\n      position: 'absolute',\n      left: `${hoverLeft}px`,\n      transform: 'translateX(-50%)',\n    };\n  }\n  renderEventBookingNumber() {\n    if (this.bookingEvent.STATUS === 'TEMP-EVENT' || this.bookingEvent.ID === 'NEW_TEMP_EVENT') {\n      return '';\n    }\n    if (isBlockUnit(this.bookingEvent.STATUS_CODE)) {\n      return '';\n    }\n    if (!this.bookingEvent.is_direct) {\n      return ` - ${this.bookingEvent.channel_booking_nbr}`;\n    }\n    return ` - ${this.bookingEvent.BOOKING_NUMBER}`;\n  }\n  showEventInfo(showInfo) {\n    // if (this.isHighlightEventType() || this.bookingEvent.hideBubble) {\n    //   return null;\n    // }\n\n    // if (showInfo) {\n    //   // Calculate which side we need to show the bubble, top side or bottom.\n    //   let bodyContainer = document.querySelector('.calendarScrollContainer');\n    //   let bodyContainerRect: { [key: string]: any } = bodyContainer.getBoundingClientRect();\n    //   let elementRect: { [key: string]: any } = this.element.getBoundingClientRect();\n    //   let midPoint = bodyContainerRect.height / 2 + bodyContainerRect.top + 50;\n    //   // let topDifference = elementRect.top - bodyContainerRect.top;\n    //   // let bottomDifference = bodyContainerRect.bottom - elementRect.bottom;\n\n    //   if (elementRect.top < midPoint) {\n    //     this.bubbleInfoTopSide = false;\n    //   } else {\n    //     this.bubbleInfoTopSide = true;\n    //   }\n    // }\n\n    // // showInfo = true;\n    // if (showInfo) {\n    //   this.hideBubbleInfo.emit({\n    //     key: 'hidePopup',\n    //     currentInfoBubbleId: this.getBookingId(),\n    //   });\n    // }\n    // this.showInfoPopup = showInfo;\n    // this.renderAgain();\n    if (this.isHighlightEventType() || this.bookingEvent.hideBubble) {\n      return null;\n    }\n\n    if (showInfo) {\n      // Calculate which side we need to show the bubble, top side or bottom.\n      let bodyContainer = document.querySelector('.calendarScrollContainer');\n      let bodyContainerRect: { [key: string]: any } = bodyContainer.getBoundingClientRect();\n      let elementRect: { [key: string]: any } = this.element.getBoundingClientRect();\n      let midPoint = bodyContainerRect.height / 2 + bodyContainerRect.top + 50;\n\n      if (elementRect.top < midPoint) {\n        this.bubbleInfoTopSide = false;\n      } else {\n        this.bubbleInfoTopSide = true;\n      }\n    }\n\n    if (showInfo) {\n      this.hideBubbleInfo.emit({\n        key: 'hidePopup',\n        currentInfoBubbleId: this.getBookingId(),\n      });\n    }\n    this.showInfoPopup = showInfo;\n    this.renderAgain();\n  }\n\n  render() {\n    // onMouseLeave={()=>this.showEventInfo(false)}\n    let legend = this.getEventLegend();\n\n    let noteNode = this.getNoteNode();\n    let balanceNode = this.getBalanceNode();\n\n    let backgroundColor = this.bookingEvent.ROOM_INFO?.calendar_extra ? this.bookingEvent.ROOM_INFO.calendar_extra?.booking_color?.color ?? legend.color : legend.color;\n\n    const { foreground, stripe } = calendar_data.colorsForegrounds?.[backgroundColor] ?? {\n      foreground: '',\n      checkout: '',\n    };\n    backgroundColor = this.bookingEvent.STATUS === 'CHECKED-OUT' ? legend.color : backgroundColor;\n    // console.log(this.bookingEvent.BOOKING_NUMBER === '46231881' ? this.bookingEvent : '');\n    return (\n      <Host\n        class={`bookingEvent  ${this.isNewEvent() || this.isHighlightEventType() ? 'newEvent' : ''} ${legend.clsName} `}\n        style={this.getPosition()}\n        id={'event_' + this.getBookingId()}\n      >\n        {/* onMouseOver={() =>this.showEventInfo(true)}  */}\n        <div\n          //     class={`bookingEventBase  ${\n          //       !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\n          //     }\n          //     ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}\n          //  ${this.bookingEvent.STATUS === 'IN-HOUSE' ? 'striped-bar vertical' : ''}\n          //  ${isBlockUnit(this.bookingEvent.STATUS_CODE) && this.bookingEvent.STATUS_CODE === '003' ? 'striped-bar animated' : ''}\n          //  ${\n          //    !this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE) && this.bookingEvent.STATUS !== 'TEMP-EVENT' && this.bookingEvent.ID !== 'NEW_TEMP_EVENT'\n          //      ? 'border border-dark ota-booking-event'\n          //      : ''\n          //  }  ${this.isSplitBooking() ? 'splitBooking' : ''}\n          //       fullSplit\n\n          //       `}\n          class={{\n            'bookingEventBase': true,\n            'skewedLeft': !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)),\n            'skewedRight': !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)),\n            'striped-bar vertical': this.bookingEvent.STATUS === 'IN-HOUSE',\n            'striped-bar animated': isBlockUnit(this.bookingEvent.STATUS_CODE) && this.bookingEvent.STATUS_CODE === '003',\n            'border border-dark ota-booking-event':\n              !this.bookingEvent.is_direct && !isBlockUnit(this.bookingEvent.STATUS_CODE) && this.bookingEvent.STATUS !== 'TEMP-EVENT' && this.bookingEvent.ID !== 'NEW_TEMP_EVENT',\n            [this.role]: true,\n          }}\n          style={{\n            'backgroundColor': backgroundColor,\n            '--ir-event-bg': backgroundColor,\n            '--ir-event-bg-stripe-color': stripe,\n          }}\n          onTouchStart={event => this.startDragging(event, 'move')}\n          onMouseDown={event => this.startDragging(event, 'move')}\n        ></div>\n        {noteNode ? <div class=\"legend_circle noteIcon\" style={{ backgroundColor: noteNode.color }}></div> : null}\n        {balanceNode ? <div class=\"legend_circle balanceIcon\" style={{ backgroundColor: balanceNode.color }}></div> : null}\n        {/* onMouseOver={() => this.showEventInfo(true)}  */}\n        <div\n          class=\"bookingEventTitle\"\n          style={{ color: foreground }}\n          onTouchStart={event => this.startDragging(event, 'move')}\n          onMouseDown={event => this.startDragging(event, 'move')}\n        >\n          {this.getBookedBy()}\n          {this.renderEventBookingNumber()}\n        </div>\n\n        {/* {(this.bookingEvent.is_direct || isBlockUnit(this.bookingEvent.STATUS_CODE)) && ( */}\n        <Fragment>\n          <div\n            class={`bookingEventDragHandle leftSide ${\n              !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\n            }\n            ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}`}\n            onTouchStart={event => this.startDragging(event, 'leftSide')}\n            onMouseDown={event => this.startDragging(event, 'leftSide')}\n          ></div>\n          <div\n            class={`bookingEventDragHandle rightSide ${\n              !this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.from_date)).isBefore(new Date(this.bookingEvent.FROM_DATE)) ? 'skewedLeft' : ''\n            }\n              ${!this.isNewEvent() && moment(new Date(this.bookingEvent.defaultDates.to_date)).isAfter(new Date(this.bookingEvent.TO_DATE)) ? 'skewedRight' : ''}`}\n            onTouchStart={event => this.startDragging(event, 'rightSide')}\n            onMouseDown={event => this.startDragging(event, 'rightSide')}\n          ></div>\n        </Fragment>\n        {/* )} */}\n\n        {this.showInfoPopup ? (\n          <igl-booking-event-hover\n            is_vacation_rental={this.is_vacation_rental}\n            countries={this.countries}\n            currency={this.currency}\n            class=\"top\"\n            bookingEvent={this.bookingEvent}\n            bubbleInfoTop={this.bubbleInfoTopSide}\n            style={this.calculateHoverPosition()}\n          ></igl-booking-event-hover>\n        ) : null}\n      </Host>\n    );\n  }\n}\n","export class ReloadInterceptor {\n  private isActive = false;\n  private readonly onIntercept: () => void;\n\n  /**\n   * @param onIntercept\n   *   Called whenever a reload is intercepted (F5/Ctrl+R or beforeunload).\n   * @param autoActivate\n   *   If true, will immediately attach listeners.\n   */\n  constructor(options: { onIntercept?: () => void; autoActivate: boolean }) {\n    this.onIntercept = options.onIntercept ?? (() => {});\n    if (options.autoActivate) {\n      this.activate();\n    }\n  }\n\n  /** Begin intercepting reloads & navigations */\n  public activate(): void {\n    if (this.isActive) return;\n    window.addEventListener('beforeunload', this.handleBeforeUnload, { capture: true });\n    this.isActive = true;\n  }\n\n  /** Stop intercepting reloads & navigations */\n  public deactivate(): void {\n    if (!this.isActive) return;\n    window.removeEventListener('beforeunload', this.handleBeforeUnload, { capture: true });\n    this.isActive = false;\n  }\n\n  /** Native â€œAre you sure you want to leave?â€ dialog */\n  private handleBeforeUnload = (e: BeforeUnloadEvent): void => {\n    this.onIntercept();\n    e.preventDefault();\n    e.returnValue = '';\n  };\n}\n",":host {\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 0%;\n  height: 100%;\n}\n.bulk-sheet-container {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  gap: 1rem;\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.physical-room {\n  margin-left: 1rem !important;\n  padding-top: 0.5rem;\n}\n/* target only the last <td> in each .physical-room row */\n.physical-room > td:last-child {\n  padding-left: 1rem; /* or whatever indent you like */\n}\n.room-type-list {\n  padding: 0;\n  margin: 0;\n}\n\n.room-type-list > li,\n.physical-room,\n.room-type-row {\n  list-style: none;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { BookingService } from '@/services/booking.service';\nimport calendar_data from '@/stores/calendar-data';\nimport { ReloadInterceptor } from '@/utils/ReloadInterceptor';\nimport { Component, Event, EventEmitter, Fragment, h, Prop, State } from '@stencil/core';\nimport moment, { Moment } from 'moment';\nimport { z, ZodError } from 'zod';\nimport { IToast } from '@components/ui/ir-toast/toast';\n// import calendar_dates from '@/stores/calendar-dates.store';\nimport locales from '@/stores/locales.store';\nexport type RoomStatus = 'open' | 'closed';\nexport type SelectedRooms = {\n  id: string | number;\n  result: RoomStatus;\n};\n\n@Component({\n  tag: 'igl-bulk-block',\n  styleUrls: ['igl-bulk-block.css', '../../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglBulkBlock {\n  @Prop() maxDatesLength = 8;\n  @Prop() property_id: number;\n\n  @State() selectedRoomTypes: Map<string | number, SelectedRooms[]> = new Map();\n  @State() selectedUnit: {\n    roomtype_id: number;\n    unit_id: number;\n  } | null = null;\n  @State() errors: 'dates' | 'rooms';\n  @State() isLoading: boolean;\n  @State() blockState: 'block' | 'unblock' = 'block';\n  @State() dates: {\n    from: Moment | null;\n    to: Moment | null;\n  }[] = [{ from: null, to: null }];\n\n  @Event() closeModal: EventEmitter<null>;\n  @Event() toast: EventEmitter<IToast>;\n\n  private sidebar: HTMLIrSidebarElement;\n  private dateRefs: { from?: HTMLIrDatePickerElement; to?: HTMLIrDatePickerElement }[] = [];\n  private reloadInterceptor: ReloadInterceptor;\n  private minDate = moment().format('YYYY-MM-DD');\n  private bookingService = new BookingService();\n\n  private datesSchema = z.array(\n    z.object({\n      from: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'from' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n      to: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'to' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n    }),\n  );\n\n  private unitSections: HTMLUListElement;\n  private datesSections: HTMLTableElement;\n\n  componentDidLoad() {\n    this.reloadInterceptor = new ReloadInterceptor({ autoActivate: false });\n    this.sidebar = document.querySelector('ir-sidebar') as HTMLIrSidebarElement;\n  }\n\n  disconnectedCallback() {\n    this.reloadInterceptor.deactivate();\n  }\n\n  private async addBlockDates() {\n    try {\n      this.errors = null;\n      this.isLoading = true;\n      const periods = this.datesSchema.parse(this.dates);\n      if (!this.selectedUnit) {\n        this.unitSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'rooms';\n        return;\n      }\n      if (this.blockState === 'block') {\n        await this.bookingService.blockAvailabilityForBrackets({\n          unit_id: this.selectedUnit?.unit_id,\n          description: '',\n          block_status_code: '002',\n          brackets: periods.map(p => ({\n            from_date: p.from,\n            to_date: p.to,\n          })),\n        });\n      } else {\n        await this.bookingService.unBlockUnitByPeriod({\n          unit_id: this.selectedUnit?.unit_id,\n          from_date: periods[0].from,\n          to_date: periods[0].to,\n        });\n      }\n      this.activate();\n      this.deactivate();\n      this.toast.emit({\n        type: 'success',\n        title: locales.entries.Lcz_RequestSubmittedSuccessfully,\n        description: '',\n      });\n      this.isLoading = false;\n      this.closeModal.emit();\n    } catch (error) {\n      console.log(error);\n      if (error instanceof ZodError) {\n        this.datesSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'dates';\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private activate() {\n    this.reloadInterceptor.activate();\n    if (this.sidebar) this.sidebar.preventClose = true;\n  }\n\n  private deactivate() {\n    this.reloadInterceptor.deactivate();\n    if (this.sidebar) this.sidebar.preventClose = false;\n  }\n\n  private handleDateChange({ index, date, key }: { index: number; date: Moment; key: 'from' | 'to' }) {\n    // 1) clone and set the new date\n    const dates = [...this.dates];\n    dates[index] = { ...dates[index], [key]: date };\n\n    // 1a) if they just changed the \"from\", always clear that row's \"to\"\n    if (key === 'from' && dates[index].to?.isBefore(date, 'dates')) {\n      dates[index].to = null;\n    }\n\n    // 2) clear any subsequent rows whose \"from\" is on or before the changed date\n    for (let i = index + 1; i < dates.length; i++) {\n      const rowFrom = dates[i]?.from;\n      if (rowFrom && rowFrom.isSameOrBefore(date, 'day')) {\n        dates[i] = { from: null, to: null };\n      }\n    }\n\n    // 3) commit\n    this.dates = dates;\n\n    // 4) open the appropriate picker\n    setTimeout(() => {\n      if (key === 'from') {\n        this.dateRefs[index]?.to.openDatePicker();\n      } else {\n        const nextFrom = dates.findIndex(d => d.from === null);\n        if (nextFrom > -1) {\n          this.dateRefs[nextFrom]?.from.openDatePicker();\n        }\n      }\n    }, 100);\n  }\n\n  private addDateRow() {\n    const last_dates = this.dates[this.dates.length - 1];\n    if (!last_dates.from || !last_dates.to) {\n      this.errors = 'dates';\n      return;\n    }\n    this.errors = null;\n    this.dates = [...this.dates, { from: null, to: null }];\n    setTimeout(() => {\n      this.dateRefs[this.dates.length - 1].to?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 100);\n  }\n\n  render() {\n    return (\n      <form\n        class={'bulk-sheet-container'}\n        onSubmit={e => {\n          e.preventDefault();\n          this.addBlockDates();\n        }}\n      >\n        <div class=\"sheet-body px-1\">\n          <div class=\"text-muted text-left pt-0 my-0 d-flex align-items-center pb-1\" style={{ gap: '0.5rem' }}>\n            <p class=\"m-0 p-0\">Select the unit to</p>\n            <ir-select\n              showFirstOption={false}\n              selectedValue={this.blockState}\n              data={[\n                { text: 'Block', value: 'block' },\n                { text: 'Unblock', value: 'unblock' },\n              ]}\n              onSelectChange={e => {\n                this.blockState = e.detail;\n              }}\n            ></ir-select>\n          </div>\n          <div>\n            {this.errors === 'rooms' && (\n              <p class={'text-danger text-left smaller p-0 '} style={{ 'margin-bottom': '0.5rem' }}>\n                {calendar_data.is_vacation_rental ? locales.entries.Lcz_PlzSelectOneListing : locales.entries.Lcz_PlzSelectOneUnit}\n              </p>\n            )}\n            <ul class=\"room-type-list\" ref={el => (this.unitSections = el)}>\n              {calendar_data.roomsInfo.map(roomType => {\n                return (\n                  <Fragment>\n                    <li key={`roomTypeRow-${roomType.id}`} class={`room-type-row`}>\n                      <div class={'d-flex choice-row'}>\n                        <span class=\"pl-1 text-left room-type-name\">{roomType.name}</span>\n                      </div>\n                    </li>\n                    {roomType.physicalrooms.map((room, j) => {\n                      const row_style = j === roomType.physicalrooms.length - 1 ? 'pb-1' : '';\n                      return (\n                        <li key={`physicalRoom-${room.id}-${j}`} class={`physical-room ${row_style}`}>\n                          <div class={'d-flex choice-row'}>\n                            <ir-radio\n                              class=\"pl-1 \"\n                              name=\"unit\"\n                              checked={this.selectedUnit?.unit_id === room.id}\n                              onCheckChange={() =>\n                                (this.selectedUnit = {\n                                  roomtype_id: roomType.id,\n                                  unit_id: room.id,\n                                })\n                              }\n                              label={room.name}\n                            ></ir-radio>\n                          </div>\n                        </li>\n                      );\n                    })}\n                  </Fragment>\n                );\n              })}\n            </ul>\n          </div>\n          {/* Dates */}\n          <table class=\"mt-1\" ref={el => (this.datesSections = el)}>\n            <thead>\n              <tr>\n                <th class=\"text-left\">{locales.entries.Lcz_From}</th>\n                <th class=\"text-left\">{locales.entries.Lcz_ToExclusive}</th>\n                <td>\n                  {this.dates.length !== this.maxDatesLength && this.blockState === 'block' && (\n                    <ir-button\n                      variant=\"icon\"\n                      icon_name=\"plus\"\n                      onClickHandler={() => {\n                        this.addDateRow();\n                      }}\n                    ></ir-button>\n                  )}\n                </td>\n              </tr>\n            </thead>\n            <tbody>\n              {this.dates.map((d, i) => {\n                if (!this.dateRefs[i]) {\n                  this.dateRefs[i] = {};\n                }\n                const fromDateMinDate = i > 0 ? this.dates[i - 1]?.to.clone().add(1, 'days')?.format('YYYY-MM-DD') ?? this.minDate : this.minDate;\n                const toDateMinDate = this.dates[i].from ? this.dates[i]?.from.clone().add(1, 'days')?.format('YYYY-MM-DD') : this.minDate;\n                return (\n                  <tr key={`date_${i}`}>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        ref={el => {\n                          this.dateRefs[i].from = el;\n                        }}\n                        forceDestroyOnUpdate\n                        minDate={fromDateMinDate}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.from?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        aria-invalid={String(this.errors === 'dates' && !d.from)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'from' });\n                        }}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          if (i === 0) {\n                            return;\n                          }\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.from ? d.from.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm ${this.errors === 'dates' && !d.to ? 'border-danger' : ''} text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        forceDestroyOnUpdate\n                        ref={el => {\n                          this.dateRefs[i].to = el;\n                        }}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.to?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        minDate={toDateMinDate}\n                        aria-invalid={String(this.errors === 'dates' && !d.to)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'to' });\n                        }}\n                        maxDate={d.from ? moment(d.from).add(3, 'months').format('YYYY-MM-DD') : undefined}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from?.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.to ? d.to.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm \n                          ${this.errors === 'dates' && !d.to ? 'border-danger' : ''}\n                          text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    {i > 0 && (\n                      <td class=\"pb-1\">\n                        <ir-button\n                          variant=\"icon\"\n                          icon_name=\"minus\"\n                          onClickHandler={() => {\n                            this.dates = this.dates.filter((_, j) => j !== i);\n                          }}\n                        ></ir-button>\n                      </td>\n                    )}\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n        <div class={'sheet-footer'}>\n          <ir-button text={locales.entries.Lcz_Cancel} btn_color=\"secondary\" class={'flex-fill'} onClickHandler={() => this.closeModal.emit(null)}></ir-button>\n          <ir-button isLoading={this.isLoading} text={locales.entries.Lcz_Confirm} btn_type=\"submit\" class=\"flex-fill\"></ir-button>\n        </div>\n      </form>\n    );\n  }\n}\n",".bulk-operations-sheet-container {\n  display: flex;\n  flex-direction: column;\n  height: auto !important;\n  min-height: 100vh;\n  background: white !important;\n  /* gap: 1rem; */\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.tabs {\n  position: sticky;\n  top: var(--ir-tabs-top, 54px);\n  background-color: white;\n  z-index: 9999999;\n  padding-top: 1rem;\n  margin-bottom: 1rem;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { Tab } from '@/components/ui/ir-tabs/ir-tabs';\nimport { IrToast } from '@/components/ui/ir-toast/ir-toast';\nimport { Component, Event, EventEmitter, Prop, State, h } from '@stencil/core';\n\n@Component({\n  tag: 'igl-bulk-operations',\n  styleUrls: ['igl-bulk-operations.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglBulkOperations {\n  @Prop() maxDatesLength = 8;\n  @Prop() property_id: number;\n\n  @Event() closeModal: EventEmitter<null>;\n  @Event() toast: EventEmitter<IrToast>;\n\n  @State() selectedTab: Tab;\n\n  private tabs = [\n    {\n      id: 'stop-sale',\n      label: 'Stop/Open Sale',\n    },\n    {\n      id: 'block',\n      label: 'Block Unit',\n    },\n  ];\n\n  private tabsEl: HTMLIrTabsElement;\n  private titleEl: HTMLIrTitleElement;\n\n  componentDidLoad() {\n    this.tabsEl.style.setProperty('--ir-tabs-top', this.titleEl?.getBoundingClientRect()?.height?.toString() + 'px');\n  }\n\n  render() {\n    return (\n      <div class={'bulk-operations-sheet-container'}>\n        <div class=\"sheet-header d-flex align-items-center\">\n          <ir-title\n            ref={el => (this.titleEl = el)}\n            onCloseSideBar={e => {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              // if (this.isLoading) {\n              //   return;\n              // }\n              this.closeModal.emit(null);\n            }}\n            class=\"px-1 mb-0\"\n            // label={locales.entries.Lcz_BulkStopOpenSale}\n            label={'Bulk Operations'}\n            displayContext=\"sidebar\"\n          ></ir-title>\n        </div>\n        <ir-tabs ref={el => (this.tabsEl = el)} class=\"tabs\" tabs={this.tabs} onTabChanged={e => (this.selectedTab = e.detail)}></ir-tabs>\n        {this.selectedTab?.id === 'stop-sale' ? (\n          <igl-bulk-stop-sale maxDatesLength={this.maxDatesLength} property_id={this.property_id}></igl-bulk-stop-sale>\n        ) : (\n          <igl-bulk-block maxDatesLength={this.maxDatesLength} property_id={this.property_id}></igl-bulk-block>\n        )}\n      </div>\n    );\n  }\n}\n",":host {\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 0%;\n  height: 100%;\n}\n.bulk-sheet-container {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  gap: 1rem;\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.days-checkbox {\n  gap: 0.5rem;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { BookingService } from '@/services/booking.service';\nimport calendar_data from '@/stores/calendar-data';\nimport { ReloadInterceptor } from '@/utils/ReloadInterceptor';\nimport { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\nimport moment, { Moment } from 'moment';\nimport { z, ZodError } from 'zod';\nimport { IToast } from '@components/ui/ir-toast/toast';\nimport calendar_dates from '@/stores/calendar-dates.store';\nimport locales from '@/stores/locales.store';\nexport type SelectedRooms = { id: string | number; result: 'open' | 'closed' };\n\n@Component({\n  tag: 'igl-bulk-stop-sale',\n  styleUrls: ['igl-bulk-stop-sale.css', '../../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglBulkStopSale {\n  @Prop() maxDatesLength = 8;\n  @Prop() property_id: number;\n\n  @State() selectedRoomTypes: SelectedRooms[] = [];\n  @State() errors: 'dates' | 'rooms' | 'weekdays';\n  @State() isLoading: boolean;\n  @State() dates: {\n    from: Moment | null;\n    to: Moment | null;\n  }[] = [{ from: null, to: null }];\n\n  @State() selectedWeekdays: Set<number> = new Set(\n    Array(7)\n      .fill(null)\n      .map((_, i) => i),\n  );\n\n  @Event() closeModal: EventEmitter<null>;\n  @Event() toast: EventEmitter<IToast>;\n\n  private sidebar: HTMLIrSidebarElement;\n  private dateRefs: { from?: HTMLIrDatePickerElement; to?: HTMLIrDatePickerElement }[] = [];\n  // private allRoomTypes: SelectedRooms[] = [];\n  private reloadInterceptor: ReloadInterceptor;\n  private minDate = moment().format('YYYY-MM-DD');\n  private bookingService = new BookingService();\n  private getDayIndex(dateStr: string): number {\n    return moment(dateStr, 'YYYY-MM-DD').day();\n  }\n  private datesSchema = z.array(\n    z.object({\n      from: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'from' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n      to: z\n        .any()\n        .refine((val): val is Moment => moment.isMoment(val), {\n          message: \"Invalid 'to' date; expected a Moment object.\",\n        })\n        .transform((val: Moment) => val.format('YYYY-MM-DD')),\n    }),\n  );\n\n  //sections\n  private unitSections: HTMLTableElement;\n  private weekdaysSections: HTMLIrWeekdaySelectorElement;\n  private datesSections: HTMLTableElement;\n\n  componentDidLoad() {\n    this.reloadInterceptor = new ReloadInterceptor({ autoActivate: false });\n    this.sidebar = document.querySelector('ir-sidebar') as HTMLIrSidebarElement;\n  }\n\n  disconnectedCallback() {\n    this.reloadInterceptor.deactivate();\n  }\n\n  // @Listen('beforeSidebarClose', { target: 'body' })\n  // handleBeforeSidebarClose(e: CustomEvent) {\n  //   e.stopImmediatePropagation();\n  //   e.stopPropagation();\n  //   if (window.confirm('Do you really want to proceed?')) {\n  //     this.deactivate();\n  //     this.sidebar.toggleSidebar();\n  //   }\n  // }\n\n  private async addBlockDates() {\n    const generatePeriodsToModify = periods => {\n      const p = [];\n      for (const period of periods) {\n        let current = period.from;\n        const lastDay = moment(period.to, 'YYYY-MM-DD').add(1, 'days').format('YYYY-MM-DD');\n        while (current !== lastDay) {\n          const nextDay = moment(current, 'YYYY-MM-DD').add(1, 'days').format('YYYY-MM-DD');\n          if (!this.selectedWeekdays.has(this.getDayIndex(current))) {\n            current = nextDay;\n            continue;\n          }\n          for (const selectedRoom of this.selectedRoomTypes) {\n            p.push({\n              room_type_id: selectedRoom.id,\n              night: current,\n            });\n          }\n          current = nextDay;\n        }\n      }\n      return p;\n    };\n    const updateCalendarCells = (\n      payloads: {\n        is_closed: boolean;\n        restrictions: {\n          night: string;\n          room_type_id: number;\n        }[];\n      }[],\n    ) => {\n      const prevDisabledCells = new Map(calendar_dates.disabled_cells);\n\n      // Caches\n      const roomsInfoById = new Map(calendar_data.roomsInfo.map((rt, i) => [rt.id, { roomType: rt, index: i }]));\n      const dayIndexByValue = new Map(calendar_dates.days.map((day, i) => [day.value, i]));\n      const rateByRoomTypeAndDate = new Map<string, any>();\n\n      for (const payload of payloads) {\n        for (const restriction of payload.restrictions) {\n          const { night, room_type_id } = restriction;\n          const { roomType } = roomsInfoById.get(room_type_id);\n\n          if (!roomType) continue;\n\n          const dayIndex = dayIndexByValue.get(night);\n          if (dayIndex === undefined) {\n            console.warn(`Couldn't find date ${night}`);\n            continue;\n          }\n\n          const day = calendar_dates.days[dayIndex];\n          const rateKey = `${room_type_id}_${night}`;\n          let rp = rateByRoomTypeAndDate.get(rateKey);\n          if (!rp) {\n            rp = day.rate.find(r => r.id === room_type_id);\n            if (!rp) {\n              console.warn(`Couldn't find room type ${room_type_id}`);\n              continue;\n            }\n            rateByRoomTypeAndDate.set(rateKey, rp);\n          }\n\n          const haveAvailability = (rp.exposed_inventory as any).rts === 0;\n          for (const room of roomType.physicalrooms) {\n            const key = `${room.id}_${night}`;\n            prevDisabledCells.set(key, {\n              disabled: payload.is_closed ? true : haveAvailability,\n              reason: payload.is_closed ? 'stop_sale' : haveAvailability ? 'inventory' : 'stop_sale',\n            });\n          }\n        }\n      }\n      calendar_dates['disabled_cells'] = new Map(prevDisabledCells);\n    };\n    try {\n      this.errors = null;\n      this.isLoading = true;\n      const periods = this.datesSchema.parse(this.dates);\n      if (this.selectedRoomTypes.length === 0) {\n        this.unitSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'rooms';\n        return;\n      }\n      if (this.selectedWeekdays.size === 0) {\n        this.weekdaysSections.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        this.errors = 'weekdays';\n        return;\n      }\n      this.activate();\n      const periods_to_modify = generatePeriodsToModify(periods);\n      const isAllOpen = this.selectedRoomTypes.every(e => e.result === 'open');\n      const isAllClosed = this.selectedRoomTypes.every(e => e.result === 'closed');\n      if (isAllClosed || isAllOpen) {\n        const payload = {\n          is_closed: isAllClosed,\n          restrictions: periods_to_modify,\n          property_id: this.property_id,\n        };\n        await this.bookingService.setExposedRestrictionPerRoomType(payload);\n        updateCalendarCells([payload]);\n      } else {\n        const payloads = [];\n        for (const room of this.selectedRoomTypes) {\n          const periods = periods_to_modify.filter(f => f.room_type_id === room.id);\n          payloads.push({\n            is_closed: room.result === 'closed',\n            restrictions: periods,\n            property_id: this.property_id,\n          });\n        }\n        await Promise.all(payloads.map(p => this.bookingService.setExposedRestrictionPerRoomType(p)));\n        updateCalendarCells(payloads);\n      }\n      this.deactivate();\n      this.toast.emit({\n        type: 'success',\n        title: locales.entries.Lcz_RequestSubmittedSuccessfully,\n        description: '',\n      });\n      this.isLoading = false;\n      this.closeModal.emit();\n    } catch (error) {\n      console.log(error);\n      if (error instanceof ZodError) {\n        this.datesSections.scrollIntoView({ behavior: 'smooth', block: 'end' });\n        this.errors = 'dates';\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private activate() {\n    this.reloadInterceptor.activate();\n    if (this.sidebar) this.sidebar.preventClose = true;\n  }\n\n  private deactivate() {\n    this.reloadInterceptor.deactivate();\n    if (this.sidebar) this.sidebar.preventClose = false;\n  }\n\n  private handleDateChange({ index, date, key }: { index: number; date: Moment; key: 'from' | 'to' }) {\n    // 1) clone and set the new date\n    const dates = [...this.dates];\n    dates[index] = { ...dates[index], [key]: date };\n\n    // 1a) if they just changed the â€œfromâ€, always clear that rowâ€™s â€œtoâ€\n    if (key === 'from' && dates[index].to?.isBefore(date, 'dates')) {\n      dates[index].to = null;\n    }\n\n    // 2) clear any subsequent rows whose â€œfromâ€ is on or before the changed date\n    for (let i = index + 1; i < dates.length; i++) {\n      const rowFrom = dates[i]?.from;\n      if (rowFrom && rowFrom.isSameOrBefore(date, 'day')) {\n        dates[i] = { from: null, to: null };\n      }\n    }\n\n    // 3) commit\n    this.dates = dates;\n\n    // 4) open the appropriate picker\n    setTimeout(() => {\n      if (key === 'from') {\n        this.dateRefs[index]?.to.openDatePicker();\n      } else {\n        const nextFrom = dates.findIndex(d => d.from === null);\n        if (nextFrom > -1) {\n          this.dateRefs[nextFrom]?.from.openDatePicker();\n        }\n      }\n    }, 100);\n  }\n\n  private addDateRow() {\n    const last_dates = this.dates[this.dates.length - 1];\n    if (!last_dates.from || !last_dates.to) {\n      this.errors = 'dates';\n      return;\n    }\n    this.errors = null;\n    this.dates = [...this.dates, { from: null, to: null }];\n    setTimeout(() => {\n      this.dateRefs[this.dates.length - 1].to?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 100);\n  }\n\n  render() {\n    return (\n      <form\n        class={'bulk-sheet-container'}\n        onSubmit={e => {\n          e.preventDefault();\n          this.addBlockDates();\n        }}\n      >\n        {/* <div class=\"sheet-header d-flex align-items-center\">\n          <ir-title\n            onCloseSideBar={e => {\n              e.stopImmediatePropagation();\n              e.stopPropagation();\n              if (this.isLoading) {\n                return;\n              }\n              this.closeModal.emit(null);\n            }}\n            class=\"px-1 mb-0\"\n            label={locales.entries.Lcz_BulkStopOpenSale}\n            displayContext=\"sidebar\"\n          ></ir-title>\n        </div> */}\n        <div class=\"sheet-body px-1\">\n          <div class=\"text-muted text-left py-0 my-0\">\n            <p>\n              {/* {locales.entries.Lcz_SelectAffectedUnits} */}\n              Select the types to stop or open sales for all related rate plans\n              {/* <span class=\"text-warning\">{locales.entries.Lcz_OperationRequiresSeveralMinutes}</span> */}\n            </p>\n          </div>\n          <div>\n            {this.errors === 'rooms' && (\n              <p class={'text-danger text-left smaller p-0 '} style={{ 'margin-bottom': '0.5rem' }}>\n                {calendar_data.is_vacation_rental ? locales.entries.Lcz_PlzSelectOneListing : locales.entries.Lcz_PlzSelectOneUnit}\n              </p>\n            )}\n            <table ref={el => (this.unitSections = el)}>\n              <thead>\n                <tr>\n                  <th class=\"sr-only\">choice</th>\n                  <th class=\"sr-only\">room type</th>\n                </tr>\n              </thead>\n              <tbody>\n                {calendar_data.roomsInfo.map((roomType, i) => {\n                  const row_style = i === calendar_data.roomsInfo.length - 1 ? '' : 'pb-1';\n                  return (\n                    <tr key={roomType.id}>\n                      <td class={`choice-row ${row_style}`}>\n                        <div class={'d-flex justify-content-end'}>\n                          <ir-select\n                            firstOption={`${locales.entries.Lcz_Select}...`}\n                            data={[\n                              { value: 'open', text: locales.entries.Lcz_Open },\n                              { value: 'closed', text: locales.entries.Lcz_StopSale },\n                            ]}\n                            onSelectChange={e => {\n                              const choice = e.detail as 'open' | 'closed' | undefined;\n                              // drop any existing entry for this roomType\n                              const rest = this.selectedRoomTypes.filter(entry => entry.id !== roomType.id);\n                              // if they actually picked something, append it\n                              if (choice) {\n                                rest.push({ id: roomType.id, result: choice });\n                              }\n                              this.selectedRoomTypes = rest;\n                            }}\n                          ></ir-select>\n                        </div>\n                      </td>\n                      <td class={`pl-1 text-left ${row_style}`}>{roomType.name}</td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n          <p class=\"text-left mt-2 text-muted\">Included days</p>\n          {this.errors === 'weekdays' && <p class={'text-danger text-left smaller m-0 p-0'}>Please select at least one day</p>}\n          <ir-weekday-selector\n            ref={el => (this.weekdaysSections = el)}\n            weekdays={Array.from(this.selectedWeekdays)}\n            onWeekdayChange={e => {\n              e.stopPropagation();\n              e.stopImmediatePropagation();\n              this.selectedWeekdays = new Set(e.detail);\n            }}\n          ></ir-weekday-selector>\n          {/* Dates */}\n          <table class=\"mt-1\" ref={el => (this.datesSections = el)}>\n            <thead>\n              <tr>\n                <th class=\"text-left\">{locales.entries.Lcz_From}</th>\n                <th class=\"text-left\">{locales.entries.Lcz_ToExclusive}</th>\n                <td>\n                  {this.dates.length !== this.maxDatesLength && (\n                    <ir-button\n                      variant=\"icon\"\n                      icon_name=\"plus\"\n                      onClickHandler={() => {\n                        this.addDateRow();\n                      }}\n                    ></ir-button>\n                  )}\n                </td>\n              </tr>\n            </thead>\n            <tbody>\n              {this.dates.map((d, i) => {\n                if (!this.dateRefs[i]) {\n                  this.dateRefs[i] = {};\n                }\n\n                const fromDateMinDate = i > 0 ? this.dates[i - 1]?.to.clone().add(1, 'days')?.format('YYYY-MM-DD') ?? this.minDate : this.minDate;\n                const toDateMinDate = this.dates[i].from ? this.dates[i]?.from.clone()?.format('YYYY-MM-DD') : this.minDate;\n                return (\n                  <tr key={`date_${i}`}>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        ref={el => {\n                          this.dateRefs[i].from = el;\n                        }}\n                        forceDestroyOnUpdate\n                        minDate={fromDateMinDate}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.from?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        aria-invalid={String(this.errors === 'dates' && !d.from)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'from' });\n                        }}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          if (i === 0) {\n                            return;\n                          }\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.from ? d.from.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm ${this.errors === 'dates' && !d.to ? 'border-danger' : ''} text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    <td class=\"pr-1 pb-1\">\n                      <ir-date-picker\n                        forceDestroyOnUpdate\n                        ref={el => {\n                          this.dateRefs[i].to = el;\n                        }}\n                        data-testid=\"pickup_arrival_date\"\n                        date={d.to?.format('YYYY-MM-DD')}\n                        emitEmptyDate={true}\n                        minDate={toDateMinDate}\n                        aria-invalid={String(this.errors === 'dates' && !d.to)}\n                        onDateChanged={evt => {\n                          evt.stopImmediatePropagation();\n                          evt.stopPropagation();\n                          this.handleDateChange({ index: i, date: evt.detail.start, key: 'to' });\n                        }}\n                        onDatePickerFocus={e => {\n                          e.stopImmediatePropagation();\n                          e.stopPropagation();\n                          const index = this.dates.findIndex(d => !d.from || !d.to);\n\n                          if (!this.dates[index]?.from) {\n                            this.dateRefs[index]?.from?.openDatePicker();\n                            return;\n                          }\n                          if (!this.dates[index]?.to) {\n                            this.dateRefs[index].to.openDatePicker();\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"text\"\n                          slot=\"trigger\"\n                          value={d.to ? d.to.format('MMM DD, YYYY') : null}\n                          class={`form-control input-sm \n                          ${this.errors === 'dates' && !d.to ? 'border-danger' : ''}\n                          text-center`}\n                          style={{ width: '100%' }}\n                        ></input>\n                      </ir-date-picker>\n                    </td>\n                    {i > 0 && (\n                      <td class=\"pb-1\">\n                        <ir-button\n                          variant=\"icon\"\n                          icon_name=\"minus\"\n                          onClickHandler={() => {\n                            this.dates = this.dates.filter((_, j) => j !== i);\n                          }}\n                        ></ir-button>\n                      </td>\n                    )}\n                  </tr>\n                );\n              })}\n            </tbody>\n          </table>\n        </div>\n        <div class={'sheet-footer'}>\n          <ir-button text={locales.entries.Lcz_Cancel} btn_color=\"secondary\" class={'flex-fill'} onClickHandler={() => this.closeModal.emit(null)}></ir-button>\n          <ir-button isLoading={this.isLoading} text={locales.entries.Lcz_Save} btn_type=\"submit\" class=\"flex-fill\"></ir-button>\n        </div>\n      </form>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n\n.bodyContainer {\n  position: relative;\n}\n\n.roomRow {\n  width: max-content;\n}\n\n.roomRow:first-child {\n  margin-top: 80px;\n}\n.categoryName {\n  font-weight: bold;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n/* .cellData[data-dirty-room='true'] { \n  border-bottom: 5px solid rgb(80, 80, 80) !important;\n} */\n.cellData[data-dirty-room='true']::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  height: 100%;\n  left: 30%;\n  right: 30%;\n  background-color: #d4d0be !important;\n}\n\n/* .cellData.disabled[data-dirty-room='true'] {\n  border-bottom: 2px solid rgb(80, 80, 80) !important;\n} */\n.cellData.disabled {\n  background: rgba(153, 153, 153, 15%);\n  cursor: var(--cell-cursor, not-allowed);\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n.roomRow .room {\n  cursor: pointer;\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n}\n.roomRow .room:hover {\n  background: #e0e0e0;\n}\n.roomRow .room:hover[data-hk-enabled='false'] {\n  background: white;\n  cursor: default;\n}\n.cellData {\n  width: 58px;\n  height: 30px;\n  display: inline-grid;\n  border-top: 1px solid #e0e0e0;\n  border-left: 1px solid #e0e0e0;\n  vertical-align: top;\n}\n.triangle-button {\n  --size: 10px;\n  position: absolute;\n  right: -6px;\n  top: -1px;\n\n  width: 0;\n  height: 0;\n  padding: 0;\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  width: 0;\n  height: 0;\n  border-left: var(--size) solid transparent;\n  border-right: var(--size) solid transparent;\n  border-bottom: var(--size) solid var(--in-toggle-color);\n\n  transform: rotate(45deg);\n}\n.cellData:nth-child(2) {\n  border-left: 0px;\n}\n\n.cellData:last-child {\n  border-right: 1px solid rgba(186, 191, 199, 0.5);\n}\n\n.roomHeaderCell {\n  position: -webkit-sticky;\n  position: sticky;\n  left: 0;\n  background: #fff;\n  border-right: 1px solid #ccc;\n  width: 170px;\n  z-index: 1;\n}\n\n.currentDay {\n  background-color: #e3f3fa;\n}\n\n.dragOverHighlight {\n  background-color: #f5f5dc !important;\n}\n\n.selectedDay {\n  background-color: #f9f9c9 !important;\n}\n\n.categoryTitle {\n  grid-template-columns: 1fr 20px;\n  padding-left: 10px;\n  cursor: pointer;\n  height: 40px;\n  font-size: 0.9em;\n}\n.categoryTitle > :nth-child(1) {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.roomTitle {\n  padding-left: 20px;\n  font-size: 0.9em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.roomTitle > :nth-child(1) {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.roomTitle.pl10 {\n  padding-left: 10px;\n}\n\n.categoryPriceColumn {\n  align-items: center;\n  height: 40px;\n  -webkit-user-select: none;\n  user-select: none;\n  position: relative;\n}\n\n/* BOOKING EVENT */\n.bookingEventsContainer {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n","import { Component, Host, Listen, Prop, State, h, Event, EventEmitter, Watch, Fragment } from '@stencil/core';\n\nimport moment from 'moment';\n\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { compareTime, createDateWithOffsetAndHour } from '@/utils/booking';\n\nimport calendar_dates from '@/stores/calendar-dates.store';\nimport locales from '@/stores/locales.store';\nimport calendar_data from '@/stores/calendar-data';\n\nimport { PhysicalRoom, RoomHkStatus, RoomType } from '@/models/booking.dto';\nimport { ICountry } from '@/models/IBooking';\n\nexport type RoomCategory = RoomType & { expanded: boolean };\n\n@Component({\n  tag: 'igl-cal-body',\n  styleUrl: 'igl-cal-body.css',\n  scoped: true,\n})\nexport class IglCalBody {\n  @Prop() isScrollViewDragging: boolean;\n  @Prop() propertyId: number;\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() today: String;\n  @Prop() currency;\n  @Prop() language: string;\n  @Prop() countries: ICountry[];\n  @Prop() highlightedDate: string;\n\n  @State() dragOverElement: string = '';\n  @State() renderAgain: boolean = false;\n  @State() selectedRoom: PhysicalRoom;\n  @State() isLoading: 'middle' | 'right' | null = null;\n\n  @Event() addBookingDatasEvent: EventEmitter<any[]>;\n  @Event() showBookingPopup: EventEmitter;\n  @Event({ bubbles: true, composed: true }) scrollPageToRoom: EventEmitter;\n\n  @State() selectedRooms: { [key: string]: any } = {};\n  private fromRoomId: number = -1;\n  private newEvent: { [key: string]: any };\n  private currentDate = new Date();\n  private hkModal: HTMLIrModalElement;\n  private housekeepingService = new HouseKeepingService();\n  private bookingMap = new Map<string | number, string | number>();\n  private interactiveTitle: HTMLIrInteractiveTitleElement[] = [];\n  private dayRateMap = new Map<string, (typeof calendar_dates.days)[0]['rate']>();\n  // private disabledCellsCache = new Map<string, boolean>();\n\n  componentWillLoad() {\n    this.currentDate.setHours(0, 0, 0, 0);\n    this.bookingMap = this.getBookingMap(this.getBookingData());\n    calendar_dates.days.forEach(day => {\n      this.dayRateMap.set(day.day, day.rate);\n    });\n    this.updateDisabledCellsCache();\n  }\n\n  @Watch('calendarData')\n  handleCalendarDataChange() {\n    this.bookingMap = this.getBookingMap(this.getBookingData());\n    this.updateDisabledCellsCache();\n  }\n\n  @Listen('dragOverHighlightElement', { target: 'window' })\n  dragOverHighlightElementHandler(event: CustomEvent) {\n    this.dragOverElement = event.detail.dragOverElement;\n  }\n\n  @Listen('gotoRoomEvent', { target: 'window' })\n  gotoRoom(event: CustomEvent) {\n    let roomId = event.detail.roomId;\n    let category = this.getRoomCategoryByRoomId(roomId);\n    if (!category.expanded) {\n      this.toggleCategory(category);\n      setTimeout(() => {\n        this.scrollToRoom(roomId);\n      }, 10);\n    } else {\n      this.scrollToRoom(roomId);\n    }\n  }\n\n  @Listen('addToBeAssignedEvent', { target: 'window' })\n  addToBeAssignedEvents(event: CustomEvent) {\n    // let roomId = event.detail.roomId;\n    this.addBookingDatas(event.detail.data);\n    this.renderElement();\n  }\n\n  @Listen('closeBookingWindow', { target: 'window' })\n  closeWindow() {\n    let ind = this.getBookingData().findIndex(ev => ev.ID === 'NEW_TEMP_EVENT');\n    if (ind !== -1) {\n      this.getBookingData().splice(ind, 1);\n      console.log('removed item..');\n      this.renderElement();\n    }\n  }\n\n  private scrollToRoom(roomId: number) {\n    this.scrollPageToRoom.emit({\n      key: 'scrollPageToRoom',\n      id: roomId,\n      refClass: 'room_' + roomId,\n    });\n  }\n\n  private getRoomCategoryByRoomId(roomId) {\n    return this.calendarData.roomsInfo.find(roomCategory => {\n      return this.getCategoryRooms(roomCategory).find(room => this.getRoomId(room) === roomId);\n    });\n  }\n\n  private getCategoryName(roomCategory) {\n    return roomCategory.name;\n  }\n\n  private getCategoryId(roomCategory) {\n    return roomCategory.id;\n  }\n\n  private getTotalPhysicalRooms(roomCategory) {\n    return this.getCategoryRooms(roomCategory).length;\n  }\n\n  private getCategoryRooms(roomCategory: RoomCategory) {\n    return (roomCategory && roomCategory.physicalrooms) || [];\n  }\n\n  private getRoomName(roomInfo) {\n    return roomInfo.name;\n  }\n\n  private getRoomId(roomInfo) {\n    return roomInfo.id;\n  }\n\n  private getRoomById(physicalRooms, roomId) {\n    return physicalRooms.find(physical_room => this.getRoomId(physical_room) === roomId);\n  }\n\n  private getBookingData() {\n    return this.calendarData.bookingEvents;\n  }\n\n  private addBookingDatas(aData) {\n    this.addBookingDatasEvent.emit(aData);\n  }\n\n  private getSelectedCellRefName(roomId, selectedDay) {\n    return 'room_' + roomId + '_' + selectedDay.currentDate;\n  }\n\n  // getSplitBookingEvents(newEvent) {\n  //   return this.getBookingData().some(bookingEvent => !['003', '002', '004'].includes(bookingEvent.STATUS_CODE) && newEvent.FROM_DATE === bookingEvent.FROM_DATE);\n  // }\n  private getSplitBookingEvents(newEvent) {\n    console.log(newEvent.FROM_DATE);\n    return this.getBookingData().some(bookingEvent => {\n      if (!['003', '002', '004'].includes(bookingEvent.STATUS_CODE)) {\n        if (\n          new Date(newEvent.FROM_DATE).getTime() >= new Date(bookingEvent.FROM_DATE).getTime() &&\n          new Date(newEvent.FROM_DATE).getTime() <= new Date(bookingEvent.TO_DATE).getTime()\n        ) {\n          return bookingEvent;\n        }\n      }\n    });\n  }\n\n  private addNewEvent(roomCategory) {\n    let keys = Object.keys(this.selectedRooms);\n    let startDate: Date, endDate: Date;\n\n    if (this.selectedRooms[keys[0]].currentDate < this.selectedRooms[keys[1]].currentDate) {\n      startDate = new Date(this.selectedRooms[keys[0]].currentDate);\n      endDate = new Date(this.selectedRooms[keys[1]].currentDate);\n    } else {\n      startDate = new Date(this.selectedRooms[keys[1]].currentDate);\n      endDate = new Date(this.selectedRooms[keys[0]].currentDate);\n    }\n\n    const dateDifference = Math.round(Math.abs((endDate.getTime() - startDate.getTime()) / 86_400_000));\n    this.newEvent = {\n      ID: 'NEW_TEMP_EVENT',\n      NAME: <span>&nbsp;</span>,\n      EMAIL: '',\n      PHONE: '',\n      convertBooking: false,\n      REFERENCE_TYPE: 'PHONE',\n      FROM_DATE: startDate.getFullYear() + '-' + this.getTwoDigitNumStr(startDate.getMonth() + 1) + '-' + this.getTwoDigitNumStr(startDate.getDate()),\n      TO_DATE: endDate.getFullYear() + '-' + this.getTwoDigitNumStr(endDate.getMonth() + 1) + '-' + this.getTwoDigitNumStr(endDate.getDate()),\n      BALANCE: '',\n      NOTES: '',\n      RELEASE_AFTER_HOURS: 0,\n      PR_ID: this.selectedRooms[keys[0]].roomId,\n      ENTRY_DATE: '',\n      NO_OF_DAYS: dateDifference,\n      ADULTS_COUNT: 1,\n      COUNTRY: '',\n      INTERNAL_NOTE: '',\n      RATE: '',\n      TOTAL_PRICE: '',\n      RATE_PLAN: '',\n      ARRIVAL_TIME: '',\n      TITLE: locales.entries.Lcz_NewBookingFor,\n      roomsInfo: [roomCategory],\n      CATEGORY: roomCategory.name,\n      event_type: 'BAR_BOOKING',\n      STATUS: 'TEMP-EVENT',\n      defaultDateRange: {\n        fromDate: null,\n        fromDateStr: '',\n        toDate: null,\n        toDateStr: '',\n        dateDifference,\n        editable: false,\n        message: 'Including 5.00% City Tax - Excluding 11.00% VAT',\n      },\n    };\n\n    let popupTitle = roomCategory.name + ' ' + this.getRoomName(this.getRoomById(this.getCategoryRooms(roomCategory), this.selectedRooms[keys[0]].roomId));\n    this.newEvent.BLOCK_DATES_TITLE = `${locales.entries.Lcz_BlockDatesFor} ${popupTitle}`;\n    this.newEvent.TITLE += popupTitle;\n    this.newEvent.defaultDateRange.toDate = new Date(this.newEvent.TO_DATE + 'T00:00:00');\n    this.newEvent.defaultDateRange.fromDate = new Date(this.newEvent.FROM_DATE + 'T00:00:00');\n    this.newEvent.defaultDateRange.fromDateStr = this.getDateStr(this.newEvent.defaultDateRange.fromDate);\n    this.newEvent.defaultDateRange.toDateStr = this.getDateStr(this.newEvent.defaultDateRange.toDate);\n    this.newEvent.ENTRY_DATE = new Date().toISOString();\n    this.newEvent.legendData = this.calendarData.formattedLegendData;\n\n    let splitBookingEvents = this.getSplitBookingEvents(this.newEvent);\n    if (splitBookingEvents) {\n      this.newEvent.splitBookingEvents = splitBookingEvents;\n    }\n\n    this.getBookingData().push(this.newEvent);\n    return this.newEvent;\n  }\n\n  private getTwoDigitNumStr(num) {\n    return num <= 9 ? '0' + num : num;\n  }\n\n  private getDateStr(date, locale = 'default') {\n    return date.getDate() + ' ' + date.toLocaleString(locale, { month: 'short' }) + ' ' + date.getFullYear();\n  }\n\n  private removeNewEvent() {\n    this.calendarData.bookingEvents = this.calendarData.bookingEvents.filter(events => events.ID !== 'NEW_TEMP_EVENT');\n    this.newEvent = null;\n  }\n\n  // private clickCell(roomId, selectedDay, roomCategory) {\n  //   if (!this.isScrollViewDragging && selectedDay.currentDate >= this.currentDate.getTime()) {\n  //     let refKey = this.getSelectedCellRefName(roomId, selectedDay);\n  //     if (this.selectedRooms.hasOwnProperty(refKey)) {\n  //       this.removeNewEvent();\n  //       delete this.selectedRooms[refKey];\n  //       this.renderElement();\n  //       return;\n  //     } else if (Object.keys(this.selectedRooms).length != 1 || this.fromRoomId != roomId) {\n  //       this.removeNewEvent();\n  //       this.selectedRooms = {};\n  //       this.selectedRooms[refKey] = { ...selectedDay, roomId };\n  //       this.fromRoomId = roomId;\n  //       this.renderElement();\n  //     } else {\n  //       // create bar;\n  //       this.selectedRooms[refKey] = { ...selectedDay, roomId };\n  //       this.addNewEvent(roomCategory);\n  //       this.selectedRooms = {};\n  //       this.renderElement();\n  //       this.showNewBookingPopup(this.newEvent);\n  //     }\n  //   }\n  // }\n  private clickCell(roomId: number, selectedDay: any, roomCategory: RoomCategory) {\n    if (!this.isScrollViewDragging && selectedDay.currentDate >= this.currentDate.getTime()) {\n      let refKey = this.getSelectedCellRefName(roomId, selectedDay);\n      if (this.selectedRooms.hasOwnProperty(refKey)) {\n        this.removeNewEvent();\n        delete this.selectedRooms[refKey];\n        this.renderElement();\n        return;\n      } else if (Object.keys(this.selectedRooms).length != 1 || this.fromRoomId != roomId) {\n        this.removeNewEvent();\n        this.selectedRooms = {};\n        this.selectedRooms[refKey] = { ...selectedDay, roomId };\n        this.fromRoomId = roomId;\n        this.renderElement();\n      } else {\n        const keys = Object.keys(this.selectedRooms);\n        const startDate = moment(this.selectedRooms[keys[0]].value, 'YYYY-MM-DD');\n        const endDate = moment(selectedDay.value, 'YYYY-MM-DD');\n        let cursor = startDate.clone().add(1, 'days');\n        let disabledCount = 0;\n        while (cursor.isBefore(endDate, 'day')) {\n          const dateKey = cursor.format('YYYY-MM-DD');\n          if (this.isCellDisabled(roomId, dateKey)) {\n            disabledCount++;\n          }\n          cursor.add(1, 'days');\n        }\n        if (disabledCount >= 1) {\n          this.selectedRooms = {};\n          this.fromRoomId = roomId;\n          this.renderElement();\n          return;\n        }\n\n        this.selectedRooms[refKey] = { ...selectedDay, roomId };\n        this.addNewEvent(roomCategory);\n        this.selectedRooms = {};\n        this.renderElement();\n        this.showNewBookingPopup(this.newEvent);\n      }\n    }\n  }\n  private showNewBookingPopup(data) {\n    console.log(data);\n    // this.showBookingPopup.emit({key: \"add\", data});\n  }\n\n  private renderElement() {\n    this.renderAgain = !this.renderAgain;\n  }\n  private getBookingMap(bookings: any[]): Map<string | number, string | number> {\n    const bookingMap = new Map<string | number, string | number>();\n    const today = moment().startOf('day');\n\n    for (const booking of bookings) {\n      const fromDate = moment(booking.FROM_DATE, 'YYYY-MM-DD').startOf('day');\n      const toDate = moment(booking.TO_DATE, 'YYYY-MM-DD').startOf('day');\n\n      // Check if today is between fromDate and toDate, inclusive.\n      if (today.isSameOrAfter(fromDate) && today.isSameOrBefore(toDate)) {\n        if (!bookingMap.has(booking.PR_ID)) {\n          bookingMap.set(booking.PR_ID, booking.BOOKING_NUMBER);\n        } else {\n          if (compareTime(moment().toDate(), createDateWithOffsetAndHour(calendar_data.checkin_checkout_hours?.offset, calendar_data.checkin_checkout_hours?.hour))) {\n            bookingMap.set(booking.PR_ID, booking.BOOKING_NUMBER);\n          }\n        }\n      }\n    }\n\n    return bookingMap;\n  }\n  private getGeneralCategoryDayColumns(addClass: string, isCategory: boolean = false, index: number) {\n    return calendar_dates.days.map(dayInfo => {\n      // const isActive = true;\n      return (\n        <div\n          class={`cellData  font-weight-bold categoryPriceColumn ${addClass + '_' + dayInfo.day} ${\n            dayInfo.day === this.today || dayInfo.day === this.highlightedDate ? 'currentDay' : ''\n          }`}\n        >\n          {isCategory ? (\n            <Fragment>\n              <span class={'categoryName'}>\n                {dayInfo.rate[index].exposed_inventory.rts}\n                {/* <button class={'triangle-button'} style={{ '--in-toggle-color': isActive ? 'green' : '#ff4961' }}></button> */}\n                {/* <br />\n              {dayInfo.rate[index].exposed_inventory.offline} */}\n              </span>\n            </Fragment>\n          ) : (\n            ''\n          )}\n        </div>\n      );\n    });\n  }\n\n  private getGeneralRoomDayColumns(roomId: string, roomCategory: RoomCategory, roomName: string) {\n    return this.calendarData.days.map(dayInfo => {\n      const isCellDisabled = this.isCellDisabled(Number(roomId), dayInfo.value);\n      const prevDate = moment(dayInfo.value, 'YYYY-MM-DD').add(-1, 'days').format('YYYY-MM-DD');\n      const isDisabled = (isCellDisabled && Object.keys(this.selectedRooms).length === 0) || (isCellDisabled && this.isCellDisabled(Number(roomId), prevDate));\n      const isSelected = this.selectedRooms.hasOwnProperty(this.getSelectedCellRefName(roomId, dayInfo));\n      const isCurrentDate = dayInfo.day === this.today || dayInfo.day === this.highlightedDate;\n      const cleaningDates = calendar_dates.cleaningTasks.has(+roomId) ? calendar_dates.cleaningTasks.get(+roomId) : null;\n      const shouldBeCleaned = ['001', '003'].includes(calendar_data.cleaning_frequency?.code) ? false : cleaningDates?.has(dayInfo.value);\n      return (\n        <div\n          class={`cellData position-relative roomCell ${isCellDisabled ? 'disabled' : ''} ${'room_' + roomId + '_' + dayInfo.day} ${isCurrentDate ? 'currentDay' : ''} ${\n            this.dragOverElement === roomId + '_' + dayInfo.day ? 'dragOverHighlight' : ''\n          } ${isSelected ? 'selectedDay' : ''}`}\n          style={!isDisabled && { '--cell-cursor': 'default' }}\n          onClick={() => {\n            if (isDisabled) {\n              return;\n            }\n            this.clickCell(Number(roomId), dayInfo, roomCategory);\n          }}\n          aria-label={roomName}\n          role=\"gridcell\"\n          data-room-id={roomId}\n          data-date={dayInfo.value}\n          aria-current={isCurrentDate ? 'date' : undefined}\n          data-room-name={roomName}\n          data-dirty-room={String(shouldBeCleaned)}\n          aria-disabled={String(isDisabled)}\n          aria-selected={Boolean(isSelected)}\n          // tabIndex={-1}\n        >\n          {/* <button class={'triangle-button'} style={{ '--in-toggle-color': isDisabled ? 'green' : '#ff4961' }}></button> */}\n        </div>\n      );\n    });\n  }\n\n  private toggleCategory(roomCategory: RoomCategory) {\n    roomCategory.expanded = !roomCategory.expanded;\n    this.renderElement();\n  }\n\n  private getRoomCategoryRow(roomCategory: RoomCategory, index: number) {\n    if (this.getTotalPhysicalRooms(roomCategory) <= 1 || !roomCategory.is_active) {\n      return null;\n    }\n    return (\n      <div class=\"roomRow\">\n        <div\n          class={`cellData text-left align-items-center roomHeaderCell categoryTitle ${'category_' + this.getCategoryId(roomCategory)}`}\n          onClick={() => this.toggleCategory(roomCategory)}\n        >\n          <div class={'categoryName'}>\n            <ir-interactive-title popoverTitle={this.getCategoryName(roomCategory)}></ir-interactive-title>\n            {/* <ir-popover popoverTitle={this.getCategoryName(roomCategory)}></ir-popover> */}\n          </div>\n          {roomCategory.expanded ? (\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" height={14} width={14}>\n              <path\n                fill=\"#6b6f82\"\n                d=\"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z\"\n              />\n            </svg>\n          ) : (\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 320 512\" height={14} width={14}>\n              <path\n                fill=\"#6b6f82\"\n                d=\"M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z\"\n              />\n            </svg>\n          )}\n          {/* <i class={`la la-angle-${roomCategory.expanded ? 'down' : 'right'}`}></i> */}\n        </div>\n        {this.getGeneralCategoryDayColumns('category_' + this.getCategoryId(roomCategory), true, index)}\n      </div>\n    );\n  }\n\n  /**\n   * Renders a list of active rooms for an expanded room category. Returns an array of JSX elements, including headers and day columns, or an empty array if the category is collapsed or contains no active rooms.\n   *\n   * @param {RoomCategory} roomCategory - The category containing room details.\n   */\n  private getRoomsByCategory(roomCategory: RoomCategory) {\n    // Check accordion is expanded.\n    if (!roomCategory.expanded) {\n      return null;\n    }\n    return this.getCategoryRooms(roomCategory)?.map(room => {\n      if (!room.is_active) {\n        return null;\n      }\n      const haveSingleRooms = this.getTotalPhysicalRooms(roomCategory) <= 1;\n      const name = haveSingleRooms ? this.getCategoryName(roomCategory) : this.getRoomName(room);\n      return (\n        <div class=\"roomRow\">\n          <div\n            class={`cellData room text-left align-items-center roomHeaderCell  roomTitle ${this.getTotalPhysicalRooms(roomCategory) <= 1 ? 'pl10' : ''} ${\n              'room_' + this.getRoomId(room)\n            }`}\n            data-room-name={name}\n            data-hk-enabled={String(calendar_data.housekeeping_enabled)}\n            data-room={this.getRoomId(room)}\n            onClick={() => {\n              if (!calendar_data.housekeeping_enabled) {\n                return;\n              }\n              this.selectedRoom = room;\n              this.hkModal.openModal();\n            }}\n            onMouseEnter={() => {\n              this.interactiveTitle[room.id]?.style?.setProperty('--ir-interactive-hk-bg', '#e0e0e0');\n            }}\n            onMouseLeave={() => {\n              this.interactiveTitle[room.id]?.style?.removeProperty('--ir-interactive-hk-bg');\n            }}\n          >\n            <ir-interactive-title\n              ref={el => {\n                if (el) this.interactiveTitle[room.id] = el;\n              }}\n              style={room.hk_status === '003' && { '--dot-color': '#ededed' }}\n              hkStatus={calendar_data.housekeeping_enabled && room.hk_status !== '001'}\n              popoverTitle={name}\n            >\n              {room.hk_status !== '001' && (\n                <div slot=\"end\" class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                  {room.hk_status === '004' ? (\n                    <svg height={14} width={14} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\">\n                      <title>Inspected</title>\n                      <path\n                        fill=\"green\"\n                        d=\"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z\"\n                      />\n                    </svg>\n                  ) : (\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"13.5\" viewBox=\"0 0 576 512\" style={{ display: 'block' }}>\n                      {room.hk_status === '002' && <title>This unit is dirty</title>}\n                      <path\n                        fill=\"currentColor\"\n                        d=\"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z\"\n                      />\n                    </svg>\n                  )}\n                </div>\n              )}\n            </ir-interactive-title>\n          </div>\n          {this.getGeneralRoomDayColumns(this.getRoomId(room), roomCategory, name)}\n        </div>\n      );\n    });\n  }\n\n  private getRoomRows() {\n    return this.calendarData.roomsInfo?.map((roomCategory, index) => {\n      if (roomCategory.is_active) {\n        return (\n          <Fragment>\n            {this.getRoomCategoryRow(roomCategory, index)}\n            {roomCategory.expanded && this.getRoomsByCategory(roomCategory)}\n          </Fragment>\n        );\n      } else {\n        return null;\n      }\n    });\n  }\n  private async confirmHousekeepingUpdate(e: CustomEvent, status: RoomHkStatus) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      this.isLoading = status === '004' ? 'right' : 'middle';\n      await this.housekeepingService.setExposedUnitHKStatus({\n        property_id: this.propertyId,\n        // housekeeper: this.selectedRoom?.housekeeper ? { id: this.selectedRoom?.housekeeper?.id } : null,\n        status: {\n          code: status,\n        },\n        unit: {\n          id: this.selectedRoom?.id,\n        },\n      });\n      if (['001', '004'].includes(status)) {\n        await this.housekeepingService.executeHKAction({\n          actions: [\n            {\n              description: 'Cleaned',\n              hkm_id: this.selectedRoom?.housekeeper?.id || null,\n              unit_id: this.selectedRoom?.id,\n              booking_nbr: this.bookingMap.get(this.selectedRoom?.id) ?? null,\n              status: status as any,\n            },\n          ],\n        });\n      }\n    } finally {\n      this.isLoading = null;\n      this.selectedRoom = null;\n      this.hkModal.closeModal();\n    }\n  }\n  render() {\n    return (\n      <Host>\n        <div class=\"bodyContainer\">\n          {this.getRoomRows()}\n          <div class=\"bookingEventsContainer preventPageScroll\">\n            {this.getBookingData()?.map(bookingEvent => {\n              return (\n                <igl-booking-event\n                  data-testid={`booking_${bookingEvent.BOOKING_NUMBER}`}\n                  data-room-name={bookingEvent.roomsInfo?.find(r => r.id === bookingEvent.RATE_TYPE)?.physicalrooms.find(r => r.id === bookingEvent.PR_ID)?.name}\n                  language={this.language}\n                  is_vacation_rental={this.calendarData.is_vacation_rental}\n                  countries={this.countries}\n                  currency={this.currency}\n                  data-component-id={bookingEvent.ID}\n                  bookingEvent={bookingEvent}\n                  allBookingEvents={this.getBookingData()}\n                ></igl-booking-event>\n              );\n            })}\n          </div>\n        </div>\n        <ir-modal\n          ref={el => (this.hkModal = el)}\n          leftBtnText={locales?.entries?.Lcz_Cancel}\n          middleBtnText={this.renderModalMiddleButtonText()}\n          middleBtnActive\n          rightBtnText={this.renderModalRightButtonText()}\n          modalBody={this.renderModalBody()}\n          onConfirmModal={e => this.confirmHousekeepingUpdate(e, '004')}\n          onMiddleModal={e => this.confirmHousekeepingUpdate(e, this.selectedRoom?.hk_status === '002' ? '001' : '002')}\n          autoClose={false}\n          isMiddleButtonLoading={this.isLoading === 'middle'}\n          isLoading={this.isLoading === 'right'}\n          onCancelModal={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.selectedRoom = null;\n            this.hkModal.closeModal();\n          }}\n        ></ir-modal>\n      </Host>\n    );\n  }\n\n  private renderModalBody() {\n    if (!this.selectedRoom) {\n      return null;\n    }\n    return (\n      <p>Update unit {this.selectedRoom?.name} to ...</p>\n      // <ir-select\n      //   showFirstOption={false}\n      //   selectedValue={this.selectedRoom?.hk_status === '001' ? '001' : '002'}\n      //   data={[\n      //     { text: 'Clean', value: '001' },\n      //     { text: 'Dirty', value: '002' },\n      //   ]}\n      //   onSelectChange={e => (this.selectedHKStatus = e.detail)}\n      // ></ir-select>\n    );\n  }\n  private renderModalMiddleButtonText() {\n    if (!this.selectedRoom) {\n      return null;\n    }\n    return this.selectedRoom.hk_status === '002' ? 'Clean' : 'Dirty';\n  }\n  private renderModalRightButtonText() {\n    if (!this.selectedRoom) {\n      return null;\n    }\n    return this.selectedRoom.hk_status !== '004' ? 'Clean & Inspected' : 'Clean';\n  }\n\n  private updateDisabledCellsCache() {\n    calendar_dates.disabled_cells.clear();\n    this.calendarData.roomsInfo?.forEach((roomCategory, categoryIndex) => {\n      if (roomCategory.is_active) {\n        this.getCategoryRooms(roomCategory)?.forEach(room => {\n          if (room.is_active) {\n            this.calendarData.days.forEach(dayInfo => {\n              const cellKey = this.getCellKey(room.id, dayInfo.value);\n              calendar_dates.disabled_cells.set(cellKey, {\n                disabled: !dayInfo.rate[categoryIndex].is_available_to_book,\n                reason: 'stop_sale',\n              });\n            });\n          }\n        });\n      }\n    });\n  }\n\n  private getCellKey(roomId: number, day: string): string {\n    return `${roomId}_${day}`;\n  }\n\n  private isCellDisabled(roomId: number, day: string): boolean {\n    const key = this.getCellKey(roomId, day);\n    if (!calendar_dates.disabled_cells.has(key)) {\n      return false;\n    }\n    const { disabled } = calendar_dates.disabled_cells.get(key);\n    return disabled;\n  }\n}\n",":host {\n  display: block;\n  position: sticky;\n  bottom: 0;\n  width: max-content;\n  z-index: 3;\n}\n\n.footerCell {\n  display: -moz-inline-grid;\n  display: -ms-inline-grid;\n  display: inline-grid;\n  position: -webkit-sticky;\n  position: sticky;\n  bottom: 0;\n  width: 58px;\n  height: 40px;\n  /* color: #b8b6b7; */\n  background: #fff;\n  vertical-align: top;\n  border-top: 1px solid #e0e0e0;\n}\n\n.bottomLeftCell {\n  left: -1px;\n  z-index: 2;\n  width: 170px;\n  text-align: left;\n  padding-left: 15px;\n  color: #000000;\n}\n\n.footerCell i {\n  margin-right: 5px;\n}\n\n.legendBtn {\n  color: #41bff3;\n  cursor: pointer;\n}\n.legendBtn:hover {\n  color: #1e29ca;\n}\n\n.isOnline i {\n  color: #2f9c3f;\n  font-weight: bold;\n}\n\n.isOffline i {\n  font-weight: bold;\n}\n\n.isOffline {\n  color: #a40000;\n}\n\n.dayTitle {\n  font-size: 0.8em;\n  font-weight: 600;\n  display: grid;\n  user-select: none;\n  /* height: 100%;\n  \n  align-items: center;\n  text-align: center;\n  width: 100%; */\n}\n\n.currentDay .dayTitle {\n  font-weight: bold;\n  /* color: #262b31; */\n}\n\n.currentDay {\n  background-color: #e3f3fa;\n}\n\n.dayCapacityPercent {\n  font-size: 0.75em;\n}\n\n.badge-pill {\n  padding-left: 1em;\n  padding-right: 1em;\n  font-size: 0.7em;\n  margin-bottom: 2px;\n}\n","import locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Host, Prop, h } from '@stencil/core';\n\n@Component({\n  tag: 'igl-cal-footer',\n  styleUrl: 'igl-cal-footer.css',\n  scoped: true,\n})\nexport class IglCalFooter {\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() today: String;\n  @Prop() highlightedDate: string;\n\n  // private isOnline:boolean = false;\n\n  handleOptionEvent(key, data = '') {\n    this.optionEvent.emit({ key, data });\n  }\n\n  render() {\n    return (\n      <Host class=\"footerContainer\">\n        <div class=\"footerCell bottomLeftCell align-items-center preventPageScroll\" style={{ paddingLeft: '10px' }}>\n          <button class=\"m-0 p-0 btn btn-sm  legendBtn d-flex align-items-center\" style={{ gap: '0.25rem' }} onClick={() => this.handleOptionEvent('showLegend')}>\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\" height={16} width={16}>\n              <path\n                fill=\"currentColor\"\n                d=\"M535.1 342.6C547.6 330.1 547.6 309.8 535.1 297.3L375.1 137.3C362.6 124.8 342.3 124.8 329.8 137.3C317.3 149.8 317.3 170.1 329.8 182.6L467.2 320L329.9 457.4C317.4 469.9 317.4 490.2 329.9 502.7C342.4 515.2 362.7 515.2 375.2 502.7L535.2 342.7zM183.1 502.6L343.1 342.6C355.6 330.1 355.6 309.8 343.1 297.3L183.1 137.3C170.6 124.8 150.3 124.8 137.8 137.3C125.3 149.8 125.3 170.1 137.8 182.6L275.2 320L137.9 457.4C125.4 469.9 125.4 490.2 137.9 502.7C150.4 515.2 170.7 515.2 183.2 502.7z\"\n              />\n            </svg>\n            <span>{locales.entries.Lcz_Legend}</span>\n            <span>v1.02</span>\n            <ir-new-badge style={{ marginLeft: '0.25rem' }}></ir-new-badge>\n          </button>\n          {/* <div class={`${this.isOnline ? 'isOnline' : 'isOffline'}`}>\n            <i class=\"la la-share-alt isOffline\"></i><span>{this.isOnline ? \"Connected\": \"Offline\"}</span>\n          </div> */}\n        </div>\n        {this.calendarData.days.map(dayInfo => (\n          <div class=\"footerCell align-items-center\">\n            <div class={`dayTitle full-height align-items-center ${dayInfo.day === this.today || this.highlightedDate === dayInfo.day ? 'currentDay' : ''}`}>\n              {dayInfo.dayDisplayName}\n            </div>\n\n            {/* <div class=\"dayTitle\">{dayInfo.dayDisplayName}</div>\n              <div class=\"dayCapacityPercent\">28.57%</div>\n              <div class=\"preventPageScroll\">\n                <span class=\"badge badge-primary badge-pill\">\n                  {index}\n                </span>\n              </div> */}\n          </div>\n        ))}\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  position: absolute;\n  top: 0;\n  height: 100%;\n}\n.svg-icon {\n  height: 20px;\n  width: 20px;\n}\n.darkGrey {\n  background: #ececec;\n}\n.btn {\n  pointer-events: auto;\n}\n\n.stickyCell {\n  display: -ms-inline-grid;\n  display: -moz-inline-grid;\n  display: inline-grid;\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0px;\n  height: 82px;\n  display: inline-block;\n  vertical-align: top;\n  z-index: 2;\n}\n\n.headersContainer {\n  background-color: #ffffff;\n}\n\n.headerCell {\n  display: inline-grid;\n  width: 58px;\n  height: 58px;\n  vertical-align: top;\n  background-color: #ffffff;\n  border-bottom: 1px solid #e0e0e0;\n}\n\n.monthsContainer {\n  height: 20px;\n  background-color: #ffffff;\n  margin-bottom: 0.2em;\n}\n\n.monthCell {\n  display: inline-grid;\n  height: 20px;\n  background-color: #ececec;\n  border-right: 1px solid #c7c7c7;\n  vertical-align: top;\n}\n\n.monthCell:nth-child(odd) {\n  background-color: #dddddd;\n}\n\n.monthTitle {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  font-size: 0.9em;\n  text-transform: uppercase;\n  font-weight: bold;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.topLeftCell {\n  left: 0px;\n  z-index: 3;\n  width: 170px;\n  background-color: #ffffff;\n  display: -ms-inline-grid;\n  display: -moz-inline-grid;\n  display: inline-grid;\n}\n.datePickerHidden {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  opacity: 0;\n  cursor: pointer;\n  /* z-index: 1; */\n  z-index: 1;\n}\n\n.date_btn {\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n}\n\n.date_btn:hover {\n  background: #f6f6f6;\n  border-radius: 0.3rem;\n}\n.caledarBtns {\n  position: relative;\n  cursor: pointer;\n  padding: 0.4rem;\n}\n\n.caledarBtns:hover {\n  background-color: #f6f6f6;\n}\n\n.dayTitle {\n  font-size: 0.8em;\n  font-weight: 600;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.currentDay .dayTitle {\n  font-weight: bold;\n}\n\n.currentDay {\n  background-color: #e3f3fa;\n}\n\n.dayCapacityPercent {\n  font-size: 0.75em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.badge-pill {\n  padding: 3px 1em;\n  font-size: 0.8em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.pointer {\n  cursor: pointer;\n}\n\n.searchContiner {\n  padding-left: 10px;\n  padding-right: 10px;\n}\n\n.searchListContainer {\n  background: #fff;\n  border: 1px solid #ccc;\n  border-bottom: none;\n}\n\n.searchListItem {\n  background: white;\n  border-bottom: 1px solid #ccc;\n  padding-left: 8px;\n}\n\n.badge-light {\n  background-color: #999999;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.min-width-full {\n  min-width: 100%;\n}\n","import { Component, Event, EventEmitter, Host, Prop, h, State, Listen, Watch } from '@stencil/core';\nimport { ToBeAssignedService } from '@/services/toBeAssigned.service';\nimport { dateToFormattedString } from '@/utils/utils';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { handleUnAssignedDatesChange } from '@/stores/unassigned_dates.store';\nimport { colorVariants } from '@/components/ui/ir-icons/icons';\n\n@Component({\n  tag: 'igl-cal-header',\n  styleUrl: 'igl-cal-header.css',\n  scoped: true,\n})\nexport class IglCalHeader {\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Event({ bubbles: true, composed: true }) gotoRoomEvent: EventEmitter<{\n    [key: string]: any;\n  }>;\n  @Event({ bubbles: true, composed: true }) gotoToBeAssignedDate: EventEmitter<{\n    [key: string]: any;\n  }>;\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() today: String;\n  @Prop() propertyid: number;\n  @Prop() unassignedDates;\n  @Prop() to_date: string;\n  @Prop() highlightedDate: string;\n  @State() renderAgain: boolean = false;\n  @State() unassignedRoomsNumber: any = {};\n  // private searchValue: string = '';\n  // private searchList: { [key: string]: any }[] = [];\n  private roomsList: { [key: string]: any }[] = [];\n  private toBeAssignedService = new ToBeAssignedService();\n  dateRef: HTMLIrButtonElement;\n  componentWillLoad() {\n    try {\n      this.initializeRoomsList();\n\n      if (!this.calendarData.is_vacation_rental) {\n        handleUnAssignedDatesChange('unassigned_dates', newValue => {\n          if (Object.keys(newValue).length > 0) {\n            this.fetchAndAssignUnassignedRooms();\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Error in componentWillLoad:', error);\n    }\n  }\n  @Watch('unassignedDates')\n  handleCalendarDataChanged() {\n    this.fetchAndAssignUnassignedRooms();\n  }\n  private initializeRoomsList() {\n    this.roomsList = [];\n    this.calendarData.roomsInfo.forEach(category => {\n      this.roomsList = this.roomsList.concat(...category.physicalrooms);\n    });\n  }\n\n  private async fetchAndAssignUnassignedRooms() {\n    await this.assignRoomsToDate();\n  }\n\n  private async assignRoomsToDate() {\n    try {\n      const { fromDate, toDate, data } = this.unassignedDates;\n      let dt = new Date(fromDate);\n      dt.setHours(0, 0, 0, 0);\n      let endDate = dt.getTime();\n      while (endDate <= new Date(toDate).getTime()) {\n        const selectedDate = moment(endDate).format('D_M_YYYY');\n        if (data[endDate]) {\n          const result = await this.toBeAssignedService.getUnassignedRooms(\n            { from_date: this.calendarData.from_date, to_date: this.calendarData.to_date },\n            this.propertyid,\n            dateToFormattedString(new Date(endDate)),\n            this.calendarData.roomsInfo,\n            this.calendarData.formattedLegendData,\n          );\n          this.unassignedRoomsNumber[selectedDate] = result.length;\n        } else if (this.unassignedRoomsNumber[selectedDate]) {\n          const res = this.unassignedRoomsNumber[selectedDate] - 1;\n          this.unassignedRoomsNumber[selectedDate] = res < 0 ? 0 : res;\n        }\n        const newEndDate = moment(endDate).add(1, 'days').toDate();\n        newEndDate.setHours(0, 0, 0, 0);\n        endDate = newEndDate.getTime();\n        this.renderView();\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  @Listen('reduceAvailableUnitEvent', { target: 'window' })\n  handleReduceAvailableUnitEvent(event: CustomEvent<{ fromDate: string; toDate: string }>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const { fromDate, toDate } = event.detail;\n    let endDate = new Date(fromDate).getTime();\n    while (endDate < new Date(toDate).getTime()) {\n      const selectedDate = moment(endDate).format('D_M_YYYY');\n      this.unassignedRoomsNumber[selectedDate] = this.unassignedRoomsNumber[selectedDate] - 1;\n      endDate = moment(endDate).add(1, 'days').toDate().getTime();\n    }\n    this.renderView();\n  }\n\n  showToBeAssigned(dayInfo) {\n    if (this.unassignedRoomsNumber[dayInfo.day] || 0) {\n      this.handleOptionEvent('showAssigned');\n      setTimeout(() => {\n        this.gotoToBeAssignedDate.emit({\n          key: 'gotoToBeAssignedDate',\n          data: dayInfo.currentDate,\n        });\n      }, 100);\n    } else {\n      // do nothing as the value is 0;\n    }\n  }\n\n  handleOptionEvent(key, data: any = '') {\n    this.optionEvent.emit({ key, data });\n  }\n\n  handleDateSelect(event: CustomEvent) {\n    if (Object.keys(event.detail).length > 0) {\n      this.handleOptionEvent('calendar', event.detail);\n    }\n  }\n\n  handleClearSearch() {\n    // this.searchValue = '';\n    // this.searchList = [];\n    this.renderView();\n  }\n\n  handleFilterRooms(event: Event) {\n    const inputElement = event.target as HTMLInputElement;\n    let value = inputElement.value.trim();\n    // this.searchValue = value;\n    value = value.toLowerCase();\n    if (value === '') {\n      this.handleClearSearch();\n    } else {\n      // this.searchList = this.roomsList.filter(room => room.name.toLocaleLowerCase().indexOf(value) != -1);\n    }\n    this.renderView();\n  }\n\n  handleScrollToRoom(roomId) {\n    this.handleClearSearch();\n    this.gotoRoomEvent.emit({ key: 'gotoRoom', roomId });\n  }\n\n  getStringDateFormat(dt) {\n    return dt.getFullYear() + '-' + (dt.getMonth() < 9 ? '0' : '') + (dt.getMonth() + 1) + '-' + (dt.getDate() <= 9 ? '0' : '') + dt.getDate();\n  }\n\n  getNewBookingModel() {\n    let today = new Date();\n    today.setHours(0, 0, 0, 0);\n    let from_date = this.getStringDateFormat(today);\n    today.setDate(today.getDate() + 1);\n    today.setHours(0, 0, 0, 0);\n    let to_date = this.getStringDateFormat(today);\n    return {\n      ID: '',\n      NAME: '',\n      EMAIL: '',\n      PHONE: '',\n      REFERENCE_TYPE: 'PHONE',\n      FROM_DATE: from_date, // \"2023-07-09\",\n      TO_DATE: to_date, // \"2023-07-11\",\n      roomsInfo: this.calendarData.roomsInfo,\n      TITLE: locales.entries.Lcz_NewBooking,\n      event_type: 'PLUS_BOOKING',\n      legendData: this.calendarData.formattedLegendData,\n      defaultDateRange: {\n        fromDate: new Date(from_date), //new Date(\"2023-09-10\"),\n        fromDateStr: '', //\"10 Sep 2023\",\n        toDate: new Date(to_date), //new Date(\"2023-09-15\"),\n        toDateStr: '', // \"15 Sep 2023\",\n        dateDifference: 0,\n        editabled: true,\n        message: '',\n      },\n    };\n  }\n\n  renderView() {\n    this.renderAgain = !this.renderAgain;\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"stickyCell align-items-center topLeftCell preventPageScroll\">\n          <div class=\"row justify-content-around no-gutters\">\n            {/* {!this.calendarData.is_vacation_rental && (\n              <div\n                class=\"caledarBtns\"\n                onClick={() => this.handleOptionEvent('showAssigned')}\n                data-toggle=\"tooltip\"\n                data-placement=\"bottom\"\n                title={locales.entries.Lcz_UnassignedUnitsTooltip}\n              >\n\n                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" class=\"svg-icon\">\n                  <path\n                    fill=\"#6b6f82\"\n                    d=\"M448 160H320V128H448v32zM48 64C21.5 64 0 85.5 0 112v64c0 26.5 21.5 48 48 48H464c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zM448 352v32H192V352H448zM48 288c-26.5 0-48 21.5-48 48v64c0 26.5 21.5 48 48 48H464c26.5 0 48-21.5 48-48V336c0-26.5-21.5-48-48-48H48z\"\n                  />\n                </svg>\n              </div>\n            )} */}\n            {/* <div class=\"caledarBtns\" onClick={() => this.handleOptionEvent('calendar')} data-toggle=\"tooltip\" data-placement=\"bottom\" title={locales.entries.Lcz_Navigate}>\n          \n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" class={'svg-icon'}>\n                <path\n                  fill=\"#6b6f82\"\n                  d=\"M152 24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H64C28.7 64 0 92.7 0 128v16 48V448c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V192 144 128c0-35.3-28.7-64-64-64H344V24c0-13.3-10.7-24-24-24s-24 10.7-24 24V64H152V24zM48 192H400V448c0 8.8-7.2 16-16 16H64c-8.8 0-16-7.2-16-16V192z\"\n                />\n              </svg>\n\n              </div> */}\n            {/* <div class=\"caledarBtns\" onClick={() => this.handleOptionEvent('gotoToday')} data-toggle=\"tooltip\" data-placement=\"bottom\" title={locales.entries.Lcz_Today}>\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" class=\"svg-icon\">\n              <path\n                  fill=\"#6b6f82\"\n                  d=\"M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120V256c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2V120c0-13.3-10.7-24-24-24s-24 10.7-24 24z\"\n                />\n                </svg>\n                </div> */}\n            {!this.calendarData.is_vacation_rental && (\n              <ir-button\n                variant=\"icon\"\n                icon_name=\"server\"\n                style={{ ...colorVariants.secondary, '--icon-size': '1.5rem' }}\n                data-toggle=\"tooltip\"\n                data-placement=\"bottom\"\n                title={locales.entries.Lcz_UnassignedUnitsTooltip}\n                onClickHandler={() => this.handleOptionEvent('showAssigned')}\n                btn_styles=\"caledarBtns\"\n                visibleBackgroundOnHover\n              ></ir-button>\n            )}\n            <ir-date-picker\n              minDate={moment().add(-2, 'months').startOf('month').format('YYYY-MM-DD')}\n              // autoApply\n              // singleDatePicker\n              onDateChanged={evt => {\n                console.log('evt', evt);\n                this.handleDateSelect(evt);\n              }}\n              // class=\"datePickerHidden\"\n              class={'date_btn'}\n              title={locales.entries.Lcz_Navigate}\n              data-toggle=\"tooltip\"\n              data-placement=\"bottom\"\n            >\n              <ir-button\n                slot=\"trigger\"\n                btn_styles=\"caledarBtns\"\n                variant=\"icon\"\n                icon_name=\"calendar\"\n                style={{ ...colorVariants.secondary, '--icon-size': '1.5rem' }}\n                onClickHandler={() => this.handleOptionEvent('calendar')}\n                visibleBackgroundOnHover\n                ref={el => (this.dateRef = el)}\n              ></ir-button>\n            </ir-date-picker>\n\n            <ir-button\n              variant=\"icon\"\n              btn_styles=\"caledarBtns\"\n              class={'pointer'}\n              icon_name=\"clock\"\n              visibleBackgroundOnHover\n              style={{ ...colorVariants.secondary, '--icon-size': '1.5rem' }}\n              data-toggle=\"tooltip\"\n              data-placement=\"bottom\"\n              title={locales.entries.Lcz_Today}\n              onClickHandler={() => this.handleOptionEvent('gotoToday')}\n            ></ir-button>\n            <ir-button\n              variant=\"icon\"\n              btn_styles=\"caledarBtns\"\n              icon_name=\"plus\"\n              data-toggle=\"tooltip\"\n              data-placement=\"bottom\"\n              data-testid=\"new_booking_btn\"\n              title={locales.entries.Lcz_CreateNewBooking}\n              visibleBackgroundOnHover\n              style={{ ...colorVariants.secondary, '--icon-size': '1.5rem' }}\n              onClickHandler={() => this.handleOptionEvent('add', this.getNewBookingModel())}\n            ></ir-button>\n            <ir-button\n              variant=\"icon\"\n              btn_styles=\"caledarBtns\"\n              icon_name=\"calendar-xmark\"\n              data-toggle=\"tooltip\"\n              data-placement=\"bottom\"\n              data-testid=\"new_bulk_btn\"\n              title={locales.entries.Lcz_StopOpenSale}\n              visibleBackgroundOnHover\n              style={{ ...colorVariants.secondary, '--icon-size': '1.5rem' }}\n              onClickHandler={() => this.handleOptionEvent('bulk', this.getNewBookingModel())}\n            ></ir-button>\n            {/* <div\n              class=\"caledarBtns\"\n              onClick={() => this.handleOptionEvent('add', this.getNewBookingModel())}\n              data-toggle=\"tooltip\"\n              data-placement=\"bottom\"\n              title={locales.entries.Lcz_CreateNewBooking}\n            >\n\n              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" class=\"svg-icon\">\n                <path\n                  fill=\"#6b6f82\"\n                  d=\"M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z\"\n                />\n              </svg>\n            </div> */}\n          </div>\n          <div class=\"row justify-content-around no-gutters searchContiner\">\n            <ir-m-combobox\n              placeholder={locales.entries.Lcz_FindUnit}\n              options={this.roomsList.map(r => ({\n                label: r.name,\n                value: r.id,\n              }))}\n              onOptionChange={e => {\n                this.handleScrollToRoom(e.detail.value);\n              }}\n            ></ir-m-combobox>\n          </div>\n        </div>\n        <div class=\"stickyCell headersContainer\">\n          <div class=\"monthsContainer\">\n            {this.calendarData.monthsInfo.map(monthInfo => (\n              <div class=\"monthCell\" style={{ width: monthInfo.daysCount * 58 + 'px' }}>\n                <div class=\"monthTitle\">{monthInfo.monthName}</div>\n              </div>\n            ))}\n          </div>\n          {this.calendarData.days.map(dayInfo => (\n            <div\n              class={`headerCell align-items-center ${'day-' + dayInfo.day} ${dayInfo.day === this.today || dayInfo.day === this.highlightedDate ? 'currentDay' : ''}`}\n              data-day={dayInfo.day}\n            >\n              {!this.calendarData.is_vacation_rental && (\n                <div class=\"preventPageScroll\">\n                  <span\n                    class={`badge badge-${this.unassignedRoomsNumber[dayInfo.day] || dayInfo.unassigned_units_nbr !== 0 ? 'info pointer' : 'light'} badge-pill`}\n                    onClick={() => this.showToBeAssigned(dayInfo)}\n                  >\n                    {this.unassignedRoomsNumber[dayInfo.day] || dayInfo.unassigned_units_nbr}\n                  </span>\n                </div>\n              )}\n              <div class=\"dayTitle\">{dayInfo.dayDisplayName}</div>\n              <div class=\"dayCapacityPercent\">{dayInfo.occupancy}%</div>\n            </div>\n          ))}\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n\n/* Legend */\n\n.legendHeader {\n  font-weight: 500;\n  letter-spacing: 0.05rem;\n  font-size: 1.12rem;\n  padding-top: 5px;\n  margin-bottom: 1rem;\n}\n\n.legendCloseBtn {\n  position: absolute;\n  top: 50%;\n  right: 0;\n  cursor: pointer;\n  font-size: 1.75em;\n  line-height: 1em;\n  padding: 0.4rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 3px;\n  transform: translateY(-50%);\n}\n\n.legendCloseBtn:hover {\n  background-color: #f6f6f6;\n}\n\n.stickyHeader {\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0;\n  background-color: #ffffff;\n  z-index: 1;\n}\n\n.legendRow {\n  position: relative;\n  vertical-align: middle;\n  margin-bottom: 0.3rem;\n}\n\n.legendRow div {\n  display: inline-block;\n  vertical-align: middle;\n}\n\n.legend_skew,\n.legend_skew-bordered,\n.legend_skewsplit {\n  transform: skew(-22deg);\n  width: 15px;\n  height: 16px;\n  border-radius: 4px;\n  background-color: var(--ir-skew-background);\n}\n.legend_skew.striped.vertical {\n  --stripe-period: 17px;\n  --stripe-angle: 360deg;\n}\n.legend_skew.striped {\n  --stripe-period: 6px;\n  background: repeating-linear-gradient(\n    var(--stripe-angle, 45deg),\n    var(--ir-skew-background) 0,\n    var(--ir-skew-background) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) calc(var(--stripe-period) / 2),\n    var(--ir-event-bg-stripe-color) var(--stripe-period)\n  );\n}\n.legend_skew.split {\n  border-right: 4px solid black;\n}\n.legend_skew-bordered {\n  border: 1px solid black;\n}\n.legend_dirty-unit {\n  background-color: white !important;\n  border: 1px solid #e0e0e0;\n  height: 12px;\n  width: 20px;\n  margin-right: 1rem;\n  position: relative;\n}\n.legend_dirty-unit::after {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  height: 100%;\n  left: 30%;\n  right: 30%;\n  background-color: #d4d0be !important;\n}\n\n.legend_circle {\n  border-radius: 100%;\n  width: 10px;\n  height: 10px;\n  margin: 3px 3px 3px 2px;\n}\n\n.legend_skewsplit {\n  border-right: 2px solid #000000;\n}\n.headerCell .blueColor {\n  background-color: #31bef1;\n}\n.greenColor {\n  background-color: #45b16d;\n}\n.yellowColor {\n  background-color: #f4d552;\n}\n.greyColor {\n  background-color: #a0a0a0;\n}\n.redColor {\n  background-color: #f34752;\n}\n.pinkColor {\n  background-color: #f9b4b7;\n}\n\n/* Legend Calendar */\n\n.legendCalendar .legendRow {\n  margin-bottom: 0;\n}\n\n.legendCalendar .legendRow:first-child .legendCal {\n  background-color: #ececec;\n}\n\n.legendCalendar .legendRow div {\n  display: inline-block;\n  vertical-align: middle;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.total-availability {\n  font-size: 1em !important;\n}\n.legendCalendar .legendCal {\n  width: 80px;\n  height: 25px;\n  text-align: center;\n  display: inline-grid !important;\n  align-content: center;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.legendCalendar .legendCal .badge {\n  margin-top: 0.2rem;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.legendCalendar .legendCal.legendCal-h2 {\n  height: 40px;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.br-t {\n  border-top: 1px solid #a0a0a0;\n}\n.br-s {\n  border-left: 1px solid #a0a0a0;\n  border-right: 1px solid #a0a0a0;\n}\n.br-bt {\n  border-bottom: 1px solid #a0a0a0;\n}\n\n.highphenLegend {\n  font-size: 0.9em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.highphenLegend::before {\n  width: 12px;\n  height: 0.5px;\n  content: ' ';\n  background-color: #000000;\n  vertical-align: middle;\n  display: inline-block;\n  margin-left: 5px;\n  margin-right: 5px;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n/* .badge-pill {\n  padding: 4px 1.1em;\n  font-size: 0.9em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n} */\n.badge-pill {\n  padding: 3px 1em;\n  font-size: 0.8em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n\n.legendRow-editor {\n  vertical-align: top;\n}\n\n.legendColorCell {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding-right: 0.5rem;\n}\n\n.legendColorPicker {\n  appearance: none;\n  border: none;\n  background: none;\n  cursor: pointer;\n  width: 30px;\n  height: 30px;\n  padding: 0;\n}\n\n.legendColorPicker::-webkit-color-swatch {\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n}\n\n.legendColorPicker::-moz-color-swatch {\n  border: 1px solid #e0e0e0;\n  border-radius: 4px;\n}\n\n.legendDetailsCell {\n  min-width: 220px;\n}\n\n.legendInput,\n.legendTextarea {\n  width: 100%;\n  border: 1px solid #d8d8d8;\n  border-radius: 4px;\n  padding: 0.4rem 0.6rem;\n  font-size: 0.85rem;\n  display: block;\n}\n\n.legendInput {\n  margin-bottom: 0.4rem;\n}\n\n.legendTextarea {\n  resize: vertical;\n}\n\n.legendActionsCell {\n  width: 32px;\n  text-align: right;\n}\n\n.legendRemoveBtn {\n  border: none;\n  background: none;\n  cursor: pointer;\n  font-size: 1.2rem;\n  line-height: 1;\n  color: #a0a0a0;\n  padding: 0;\n}\n\n.legendRemoveBtn:hover,\n.legendRemoveBtn:focus {\n  color: #5c5c5c;\n}\n\n.legendEditorFooter {\n  margin-top: 0.75rem;\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.legendAddBtn {\n  border: 1px solid #d8d8d8;\n  border-radius: 4px;\n  background-color: #ffffff;\n  padding: 0.35rem 0.75rem;\n  font-size: 0.85rem;\n  cursor: pointer;\n}\n\n.legendAddBtn:hover,\n.legendAddBtn:focus {\n  border-color: #b3b3b3;\n}\n\n.legendStatus {\n  font-size: 0.75rem;\n}\n\n.legendStatus.saving {\n  color: #6b6f82;\n}\n\n.legendStatus.success {\n  color: #2e7d32;\n}\n\n.legendStatus.error {\n  color: #d32f2f;\n}\n\n.headerCell {\n  width: 70px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.dayTitle {\n  font-size: 0.8em;\n  font-weight: 600;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.dayCapacityPercent {\n  font-size: 0.75em;\n  -webkit-user-select: none;\n  user-select: none;\n  -webkit-user-drag: none;\n}\n.legend_rectangle {\n  height: 12px;\n  width: 20px;\n  margin-right: 1rem;\n}\n","import { BookingColor } from '@/models/booking.dto';\nimport { PropertyService } from '@/services/property.service';\nimport calendar_data from '@/stores/calendar-data';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\ntype SaveState = 'idle' | 'saving' | 'saved' | 'error';\n\n@Component({\n  tag: 'igl-legends',\n  styleUrl: 'igl-legends.css',\n  scoped: true,\n})\nexport class IglLegends {\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Prop() legendData: { [key: string]: any };\n  private propertyService = new PropertyService();\n\n  @State() bookingColors: BookingColor[] = [];\n  @State() saveState: SaveState = 'idle';\n  @State() saveError?: string;\n  @State() loadingIndex: number[] = [];\n\n  private saveTimeout?: number;\n\n  disconnectedCallback() {\n    if (this.saveTimeout) {\n      clearTimeout(this.saveTimeout);\n    }\n  }\n\n  @Watch('saveState')\n  handleSaveStateChange(newValue: SaveState) {\n    if (newValue === 'error' || newValue === 'idle') {\n      this.loadingIndex = [];\n    }\n  }\n\n  handleOptionEvent(key, data = '') {\n    this.optionEvent.emit({ key, data });\n  }\n\n  private syncCalendarExtra(colors: BookingColor[]) {\n    const calendarExtra = calendar_data.property.calendar_extra ?? {};\n    calendar_data.property.calendar_extra = {\n      ...calendarExtra,\n      booking_colors: colors.map(color => ({ ...color })),\n    };\n  }\n\n  private get propertyId(): number | null {\n    return calendar_data.property?.id ?? calendar_data.property.id ?? null;\n  }\n\n  private updateBookingColor(index: number, patch: Partial<BookingColor>) {\n    const bookingColors = calendar_data.property.calendar_extra?.booking_colors.map((color, idx) => (idx === index ? { ...color, ...patch } : color));\n    this.syncCalendarExtra(bookingColors);\n    if (this.saveState === 'saved') {\n      this.saveState = 'idle';\n    }\n  }\n\n  private async persistBookingColors() {\n    const propertyId = this.propertyId;\n    if (!propertyId) {\n      return;\n    }\n\n    if (this.saveState === 'saving') {\n      return;\n    }\n    this.saveState = 'saving';\n    this.saveError = undefined;\n\n    try {\n      await this.propertyService.setPropertyCalendarExtra({\n        property_id: propertyId,\n        value: JSON.stringify(calendar_data.property.calendar_extra),\n      });\n      this.saveState = 'saved';\n      if (this.saveTimeout) {\n        clearTimeout(this.saveTimeout);\n      }\n      this.saveTimeout = window.setTimeout(() => {\n        this.saveState = 'idle';\n        this.saveTimeout = undefined;\n      }, 2000);\n    } catch (error) {\n      this.saveState = 'error';\n      this.saveError = error instanceof Error ? error.message : String(error);\n    }\n  }\n\n  private handleNameInput(index: number, value: string) {\n    this.updateBookingColor(index, { name: value });\n  }\n\n  private handleBlur(index: number) {\n    this.persistBookingColors();\n    if (!this.loadingIndex.includes(index)) {\n      this.loadingIndex = [...this.loadingIndex, index];\n    }\n  }\n\n  private handleLoaderComplete(index: number) {\n    this.loadingIndex = this.loadingIndex.filter(currentIndex => currentIndex !== index);\n  }\n\n  render() {\n    return (\n      <Host class=\"legendContainer pr-1 text-left pb-4\">\n        <div class={'w-full'}>\n          <div class={'w-full'}>\n            <div class=\"stickyHeader pt-1 \">\n              <p class=\"legendHeader\">{locales.entries.Lcz_Legend}</p>\n              <div class=\"legendCloseBtn\" onClick={() => this.handleOptionEvent('closeSideMenu')}>\n                {/* <i class=\"ft-chevrons-left\"></i> */}\n                <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" height={18} width={18}>\n                  <path\n                    fill=\"#6b6f82\"\n                    d=\"M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160zm352-160l-160 160c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L301.3 256 438.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0z\"\n                  />\n                </svg>\n              </div>\n              <hr />\n            </div>\n            <div class=\"mt-2 pl-1\">\n              <table>\n                {(() => {\n                  const legendInfo = this.legendData.find(l => l.id === '14');\n                  return (\n                    <tr>\n                      <td>\n                        <div class={`legend_${legendInfo.design}`} style={{ '--ir-skew-background': legendInfo.color }}></div>\n                      </td>\n                      <td>\n                        <div class={'d-flex align-items-center'} style={{ gap: '0.5rem' }}>\n                          <span class=\"font-small-3\">{legendInfo.name}</span>\n                          <ir-new-badge></ir-new-badge>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })()}\n\n                {this.legendData.map(legendInfo => {\n                  if (['1', '2', '3', '14'].includes(legendInfo.id)) {\n                    return null;\n                  }\n                  const stripeColor = calendar_data.colorsForegrounds[legendInfo?.color];\n                  return (\n                    <tr key={`legend_${legendInfo.id}`} class=\"legendRow \">\n                      <td>\n                        {legendInfo.design === 'broom' ? (\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"13.5\" viewBox=\"0 0 576 512\" style={{ display: 'block' }}>\n                            <path\n                              fill=\"black\"\n                              d=\"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z\"\n                            />\n                          </svg>\n                        ) : legendInfo.design === 'check' ? (\n                          <svg height={14} width={14} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\">\n                            <path\n                              fill=\"green\"\n                              d=\"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z\"\n                            />\n                          </svg>\n                        ) : (\n                          <div\n                            class={`legend_${legendInfo.design} ${\n                              ['1', '7'].includes(legendInfo.id.toString()) ? `striped ${legendInfo.id.toString() === '1' ? 'vertical' : ''}` : ''\n                            }`}\n                            style={{ '--ir-skew-background': legendInfo.color, '--ir-event-bg-stripe-color': stripeColor?.stripe, 'backgroundColor': legendInfo.color }}\n                          ></div>\n                        )}\n                      </td>\n                      <td>\n                        <div class={'d-flex align-items-center'} style={{ gap: '0.5rem' }}>\n                          <span class=\"font-small-3\">{legendInfo.name}</span>\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n                <tr>\n                  <td colSpan={2}>\n                    <hr style={{ marginTop: '0.5rem', marginBottom: '0.5rem' }} />\n                  </td>\n                </tr>\n                <tr>\n                  <th colSpan={2} class=\"\" style={{ paddingBottom: '0.5rem' }}>\n                    <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                      <span>Default colors</span>\n                    </div>\n                  </th>\n                </tr>\n                {this.legendData.map(legendInfo => {\n                  if (!['1', '2', '3'].includes(legendInfo.id)) {\n                    return null;\n                  }\n                  const stripeColor = calendar_data.colorsForegrounds[legendInfo?.color];\n                  return (\n                    <tr key={`legend_${legendInfo.id}`} class=\"legendRow \">\n                      <td>\n                        {legendInfo.design === 'broom' ? (\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"12\" width=\"13.5\" viewBox=\"0 0 576 512\" style={{ display: 'block' }}>\n                            <path\n                              fill=\"black\"\n                              d=\"M566.6 54.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192-34.7-34.7c-4.2-4.2-10-6.6-16-6.6c-12.5 0-22.6 10.1-22.6 22.6l0 29.1L364.3 320l29.1 0c12.5 0 22.6-10.1 22.6-22.6c0-6-2.4-11.8-6.6-16l-34.7-34.7 192-192zM341.1 353.4L222.6 234.9c-42.7-3.7-85.2 11.7-115.8 42.3l-8 8C76.5 307.5 64 337.7 64 369.2c0 6.8 7.1 11.2 13.2 8.2l51.1-25.5c5-2.5 9.5 4.1 5.4 7.9L7.3 473.4C2.7 477.6 0 483.6 0 489.9C0 502.1 9.9 512 22.1 512l173.3 0c38.8 0 75.9-15.4 103.4-42.8c30.6-30.6 45.9-73.1 42.3-115.8z\"\n                            />\n                          </svg>\n                        ) : legendInfo.design === 'check' ? (\n                          <svg height={14} width={14} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 640\">\n                            <path\n                              fill=\"green\"\n                              d=\"M530.8 134.1C545.1 144.5 548.3 164.5 537.9 178.8L281.9 530.8C276.4 538.4 267.9 543.1 258.5 543.9C249.1 544.7 240 541.2 233.4 534.6L105.4 406.6C92.9 394.1 92.9 373.8 105.4 361.3C117.9 348.8 138.2 348.8 150.7 361.3L252.2 462.8L486.2 141.1C496.6 126.8 516.6 123.6 530.9 134z\"\n                            />\n                          </svg>\n                        ) : (\n                          <div\n                            class={`legend_${legendInfo.design} ${\n                              ['1', '7'].includes(legendInfo.id.toString()) ? `striped ${legendInfo.id.toString() === '1' ? 'vertical' : ''}` : ''\n                            }`}\n                            style={{ '--ir-skew-background': legendInfo.color, '--ir-event-bg-stripe-color': stripeColor?.stripe, 'backgroundColor': legendInfo.color }}\n                          ></div>\n                        )}\n                      </td>\n                      <td>\n                        <div class={'d-flex align-items-center'} style={{ gap: '0.5rem' }}>\n                          <span class=\"font-small-3\">{legendInfo.name}</span>\n                          {legendInfo.id === '14' && <ir-new-badge></ir-new-badge>}\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n                <tr>\n                  <td colSpan={2}>\n                    <hr style={{ marginTop: '0.5rem', marginBottom: '0.5rem' }} />\n                  </td>\n                </tr>\n                <tr>\n                  <th colSpan={2} style={{ paddingBottom: '0.5rem' }}>\n                    <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                      <span>Use your own colors</span>\n                      <ir-new-badge></ir-new-badge>\n                    </div>\n                  </th>\n                </tr>\n                {calendar_data.property.calendar_extra?.booking_colors.map((legendInfo, index) => {\n                  const previewClass = `legend_${legendInfo.design}`;\n                  return (\n                    <tr key={`legend_${index}`} class=\"legendRow \">\n                      <td>\n                        <div class={previewClass} style={{ backgroundColor: legendInfo.color }}></div>\n                      </td>\n                      <td class=\"legendDetailsCell\">\n                        <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                          <ir-input-text\n                            class=\"legendTextarea border-0 m-0 p-0\"\n                            value={legendInfo.name}\n                            inputContainerStyle={{ margin: '0' }}\n                            placeholder=\"Reason for this color\"\n                            onTextChange={event => this.handleNameInput(index, event.detail)}\n                            onInputBlur={() => this.handleBlur(index)}\n                          ></ir-input-text>\n                          {this.loadingIndex.includes(index) && (this.saveState === 'saving' || this.saveState === 'saved') ? (\n                            <ir-success-loader onLoaderComplete={() => this.handleLoaderComplete(index)}></ir-success-loader>\n                          ) : null}\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </table>\n            </div>\n            <hr style={{ marginTop: '1rem', marginBottom: '0.5rem' }} />\n            <div class=\"mt-1\">\n              <div class=\"legendCalendar\">\n                <div class=\"legendRow align-items-center\">\n                  <div class=\"legendCal br-t br-s br-bt\">\n                    <strong>MAR 2022</strong>\n                  </div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_MonthAndYear}</div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal headerCell align-items-center br-s\">\n                    <span class=\"badge badge-info  badge-pill\">3</span>\n                  </div>\n                  <div class=\"highphenLegend\">\n                    <div>{locales.entries.Lcz_UnassignedUnits}</div>\n                  </div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal dayTitle br-s\">Fri 18</div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_Date}</div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal br-s br-bt dayCapacityPercent\">15%</div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_Occupancy}</div>\n                </div>\n                <div class=\"legendRow\">\n                  <div class=\"legendCal br-s br-bt  font-weight-bold total-availability\">20</div>\n                  <div class=\"highphenLegend\">{locales.entries.Lcz_TotalAvailability}</div>\n                </div>\n\n                {/* <div class=\"legendRow align-items-center\">\n                  <div class=\"legendCal br-s br-bt font-small-2\">15</div>\n                  <div class=\"highphenLegend\">\n                    <div>{locales.entries.Lcz_OfflineAvailability}</div>\n                  </div>\n                </div> */}\n              </div>\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n\n.dialog-body {\n  display: grid;\n  gap: 1.5rem;\n}\n\n.dialog-body__description {\n  margin: 0;\n}\n\n.dialog-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.75rem;\n}\n","import { EventsService } from '@/services/events.service';\nimport { Component, Element, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\nimport type { IReallocationPayload } from '@/models/property-types';\nimport type { SelectOption } from '@/utils/utils';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n\n@Component({\n  tag: 'igl-reallocation-dialog',\n  styleUrl: 'igl-reallocation-dialog.css',\n  scoped: true,\n})\nexport class IglReallocationDialog {\n  @Element() hostEl!: HTMLElement;\n\n  @Prop() data?: IReallocationPayload;\n\n  @State() selectedRateplan?: string;\n  @State() showRateplanError = false;\n\n  @Event() dialogClose: EventEmitter<boolean>;\n  @Event() revertBooking: EventEmitter<string>;\n  @Event() resetModalState: EventEmitter<void>;\n\n  private dialogEl?: HTMLIrDialogElement;\n  private rateplanSelectEl?: HTMLIrSelectElement;\n  private eventsService = new EventsService();\n\n  @Watch('data')\n  handleDataChange(newData: IReallocationPayload | undefined) {\n    this.resetState(newData);\n    if (newData) {\n      this.dialogEl?.openModal();\n    } else {\n      this.dialogEl?.closeModal();\n    }\n  }\n\n  private async reallocateUnit() {\n    if (!this.data) {\n      return;\n    }\n\n    if (!this.validateRateplanSelection()) {\n      return;\n    }\n\n    const { pool, toRoomId, from_date, to_date } = this.data;\n    try {\n      await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date, this.data.rateplans ? Number(this.selectedRateplan) : undefined);\n    } catch (error) {\n      console.log(error);\n      this.revertBooking.emit(pool);\n    } finally {\n      this.dialogEl?.closeModal();\n      this.resetModalState.emit();\n    }\n  }\n\n  private get rateplanOptions(): SelectOption[] {\n    if (!Array.isArray(this.data?.rateplans)) {\n      return [];\n    }\n\n    return this.data.rateplans.map(option => ({\n      ...option,\n      text: this.formatRateplanLabel(option),\n    }));\n  }\n\n  private formatRateplanLabel(option: SelectOption): string {\n    if (!option) {\n      return '';\n    }\n\n    const suffix = option.custom_text ? ` | ${option.custom_text}` : '';\n    return `${option.text}${suffix}`.trim();\n  }\n\n  private hasRateplanRequirement(): boolean {\n    return this.rateplanOptions.length > 0;\n  }\n\n  private validateRateplanSelection(): boolean {\n    if (!this.hasRateplanRequirement()) {\n      return true;\n    }\n\n    if (!this.selectedRateplan) {\n      this.showRateplanError = true;\n      this.focusRateplanSelect();\n      return false;\n    }\n\n    return true;\n  }\n\n  private focusRateplanSelect() {\n    const selectEl = this.rateplanSelectEl?.shadowRoot?.querySelector('select') ?? this.rateplanSelectEl?.querySelector('select');\n    if (selectEl) {\n      selectEl.focus();\n    }\n  }\n\n  private resetState(data?: IReallocationPayload) {\n    if (!data) {\n      this.selectedRateplan = undefined;\n      this.showRateplanError = false;\n      return;\n    }\n\n    this.selectedRateplan = undefined;\n    this.showRateplanError = false;\n  }\n\n  private handleDialogVisibilityChange = (event: CustomEvent<boolean>) => {\n    if (!event.detail) {\n      this.dialogClose.emit(false);\n    }\n  };\n\n  private handleRateplanChange = (event: CustomEvent<string>) => {\n    this.selectedRateplan = event.detail;\n    this.showRateplanError = false;\n  };\n\n  private handleCancelClick = () => {\n    this.dialogEl?.closeModal();\n    this.dialogClose.emit(false);\n  };\n\n  render() {\n    const hasRateplans = this.hasRateplanRequirement();\n\n    return (\n      <ir-dialog ref={el => (this.dialogEl = el)} onOpenChange={this.handleDialogVisibilityChange}>\n        {this.data && (\n          <Fragment>\n            {this.data.title && <div slot=\"modal-title\">{this.data.title}</div>}\n            <div slot=\"modal-body\" class=\"dialog-body\">\n              <p class=\"text-left dialog-body__description m-0 p-0\">{this.data.description}</p>\n              {hasRateplans && (\n                <ir-select\n                  ref={el => (this.rateplanSelectEl = el)}\n                  required\n                  firstOption=\"Select rate plan...\"\n                  data={this.rateplanOptions.map(option => ({ text: option.text, value: option.value }))}\n                  error={this.showRateplanError}\n                  onSelectChange={this.handleRateplanChange}\n                ></ir-select>\n              )}\n            </div>\n            <div class=\"dialog-footer\" slot=\"modal-footer\">\n              <ir-button onClick={this.handleCancelClick} text=\"Cancel\" size=\"md\" btn_color=\"secondary\"></ir-button>\n              <ir-button text=\"Confirm\" onClick={() => this.reallocateUnit()} size=\"md\" isLoading={isRequestPending('/ReAllocate_Exposed_Room')}></ir-button>\n            </div>\n          </Fragment>\n        )}\n      </ir-dialog>\n    );\n  }\n}\n","import { Moment } from 'moment';\nimport { z } from 'zod';\n\nexport type RoomDates = { from_date: Moment; to_date: Moment };\n\nexport const SelectedUnitSchema = z.object({\n  roomtype_id: z.coerce.number(),\n  unit_id: z.coerce.number(),\n  rateplan_id: z.coerce.number(),\n});\n\nexport type SelectedUnit = z.infer<typeof SelectedUnitSchema>;\n",":host {\n  display: block;\n}\n:host {\n  display: flex;\n  flex-direction: column;\n  flex: 1 1 0%;\n  height: 100%;\n}\n.bulk-sheet-container {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  gap: 1rem;\n}\n.animated-container {\n  transition: all 0.5s ease;\n}\n.physical-room {\n  margin-left: 1rem !important;\n  /* padding-top: 0.5rem; */\n}\n/* target only the last <td> in each .physical-room row */\n.physical-room > td:last-child {\n  padding-left: 1rem; /* or whatever indent you like */\n}\n.room-type-list {\n  padding: 0;\n  margin: 0;\n}\n\n.room-type-list > li,\n.physical-room,\n.room-type-row {\n  list-style: none;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { Booking, Room } from '@/models/booking.dto';\nimport { PropertyRoomType } from '@/models/IBooking';\nimport { BookingService } from '@/services/booking.service';\nimport { resetBookingStore } from '@/stores/booking.store';\nimport calendar_data from '@/stores/calendar-data';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport locales from '@/stores/locales.store';\nimport { checkMealPlan, SelectOption } from '@/utils/utils';\nimport { Component, Event, EventEmitter, Fragment, Prop, State, h } from '@stencil/core';\nimport moment from 'moment';\nimport { ZodError } from 'zod';\nimport { RoomDates, SelectedUnit, SelectedUnitSchema } from './types';\n\n@Component({\n  tag: 'igl-split-booking',\n  styleUrls: ['igl-split-booking.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IglSplitBooking {\n  @Prop() booking: Booking;\n  @Prop() identifier: Room['identifier'];\n\n  @State() selectedDates: RoomDates;\n  @State() room: Room;\n  @State() roomTypes: PropertyRoomType[] = [];\n  @State() selectedUnit: Partial<SelectedUnit> = {};\n  @State() isLoading: boolean;\n  @State() errors: Record<string, boolean> | null;\n  @State() mealPlanOptions: SelectOption[] | null = null;\n\n  @Event() closeModal: EventEmitter<null>;\n\n  private defaultDates: RoomDates;\n  private bookingService = new BookingService();\n\n  componentWillLoad() {\n    this.room = this.getRoom();\n    this.defaultDates = { ...this.generateDates(this.room) };\n    this.selectedDates = { ...this.defaultDates };\n    console.log(this.booking);\n  }\n\n  private getRoom() {\n    if (!this.booking) {\n      throw new Error('Missing booking');\n    }\n    if (!this.identifier) {\n      throw new Error('Missing Identifier');\n    }\n    const room = this.booking.rooms.find(r => r.identifier === this.identifier);\n    if (!room) {\n      throw new Error(`Couldn't find room with identifier ${this.identifier}`);\n    }\n    return room;\n  }\n\n  private generateDates(room: Room): RoomDates {\n    let MFromDate = moment(room.from_date, 'YYYY-MM-DD');\n    const MToDate = moment(room.to_date, 'YYYY-MM-DD').add(-1, 'days');\n    const today = moment();\n    if (MFromDate.isBefore(today)) {\n      MFromDate = today.clone();\n    }\n    if (MFromDate.isSame(today)) {\n      return { from_date: MFromDate, to_date: MToDate };\n    }\n    if (MFromDate.isSameOrAfter(today)) {\n      return { from_date: MFromDate.clone().add(1, 'days'), to_date: MToDate };\n    }\n    return { from_date: today.clone().add(1, 'days'), to_date: MToDate };\n  }\n\n  private async checkBookingAvailability() {\n    resetBookingStore();\n    const from_date = this.selectedDates.from_date.format('YYYY-MM-DD');\n    const to_date = this.selectedDates.to_date.format('YYYY-MM-DD');\n\n    const is_in_agent_mode = this.booking.agent !== null;\n    try {\n      const data = await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: this.booking.property.id,\n        adultChildCount: {\n          adult: 1,\n          child: 0,\n        },\n        language: 'en',\n        room_type_ids: [],\n        currency: this.booking.currency,\n        agent_id: is_in_agent_mode ? this.booking.agent.id : null,\n        is_in_agent_mode,\n        room_type_ids_to_update: [],\n      });\n      this.roomTypes = data as any as PropertyRoomType[];\n    } catch (error) {\n      console.error('Error initializing booking availability:', error);\n    }\n  }\n\n  private async doReservation() {\n    try {\n      this.isLoading = true;\n      this.errors = null;\n      const selectedUnit = SelectedUnitSchema.parse(this.selectedUnit);\n      const oldRooms = this.booking.rooms.filter(r => r.identifier !== this.identifier);\n      let rooms = [\n        ...oldRooms,\n        {\n          ...this.room,\n          from_date: this.room.from_date,\n          to_date: this.selectedDates.from_date.format('YYYY-MM-DD'),\n          days: this.room.days.filter(r => moment(r.date, 'YYYY-MM-DD').isBefore(this.selectedDates.from_date, 'dates')),\n          departure_time: null,\n        },\n        {\n          ...this.room,\n          identifier: null,\n          assigned_units_pool: null,\n          parent_room_identifier: this.room.identifier,\n          is_split: true,\n          roomtype: {\n            id: selectedUnit.roomtype_id,\n          },\n          rateplan: {\n            id: selectedUnit.rateplan_id || this.room.rateplan.id,\n          },\n          departure_time: this.room.departure_time,\n          unit: { id: selectedUnit.unit_id },\n          from_date: this.selectedDates.from_date.format('YYYY-MM-DD'),\n          // to_date: this.selectedDates.to_date.format('YYYY-MM-DD'),\n          days: this.room.days.filter(r => moment(r.date, 'YYYY-MM-DD').isSameOrAfter(this.selectedDates.from_date, 'dates')),\n        },\n      ];\n      const booking = {\n        assign_units: true,\n        is_pms: true,\n        is_direct: this.booking.is_direct,\n        is_backend: true,\n        is_in_loyalty_mode: this.booking.is_in_loyalty_mode,\n        promo_key: this.booking.promo_key,\n        extras: this.booking.extras,\n        agent: this.booking.agent,\n        booking: {\n          from_date: this.booking.from_date,\n          to_date: this.booking.to_date,\n          remark: this.booking.remark,\n          booking_nbr: this.booking.booking_nbr,\n          property: this.booking.property,\n          booked_on: this.booking.booked_on,\n          source: this.booking.source,\n          rooms,\n          currency: this.booking.currency,\n          arrival: this.booking.arrival,\n          guest: this.booking.guest,\n        },\n        pickup_info: this.booking.pickup_info,\n      };\n      await this.bookingService.doReservation(booking);\n      this.closeModal.emit(null);\n    } catch (error) {\n      const err: Record<string, boolean> = {};\n      if (error instanceof ZodError) {\n        console.error(error);\n        error.issues.forEach(i => {\n          err[i.path[0]] = true;\n        });\n        this.errors = { ...err };\n      }\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private updateSelectedUnit(params: Partial<SelectedUnit>) {\n    const merged: Partial<SelectedUnit> = { ...this.selectedUnit, ...params };\n    const roomTypesSource = calendar_data?.property?.roomtypes;\n    const mealPlanResult = checkMealPlan({\n      rateplan_id: this.room.rateplan.id.toString(),\n      roomTypeId: merged?.roomtype_id,\n      roomTypes: roomTypesSource,\n    });\n\n    const hasExplicitRateplanUpdate = Object.prototype.hasOwnProperty.call(params, 'rateplan_id');\n\n    if (Array.isArray(mealPlanResult)) {\n      this.mealPlanOptions = mealPlanResult;\n      if (!hasExplicitRateplanUpdate) {\n        delete merged.rateplan_id;\n      }\n    } else {\n      this.mealPlanOptions = null;\n      if (!hasExplicitRateplanUpdate) {\n        if (mealPlanResult) {\n          merged.rateplan_id = Number(mealPlanResult.value);\n        } else {\n          delete merged.rateplan_id;\n        }\n      }\n    }\n\n    this.selectedUnit = merged;\n  }\n\n  render() {\n    return (\n      <form\n        onSubmit={e => {\n          e.preventDefault();\n          this.doReservation();\n        }}\n        class=\"sheet-container\"\n      >\n        <ir-title class=\"px-1 sheet-header mb-0\" displayContext=\"sidebar\" onCloseSideBar={() => this.closeModal.emit()} label={`Split unit ${this.room?.unit['name']}`}></ir-title>\n        <section class=\"px-1 sheet-body\">\n          <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n            <div>\n              <ir-date-view from_date={this.room.from_date} to_date={this.room.to_date} showDateDifference={false}></ir-date-view>\n            </div>\n            <p class=\"m-0 p-0\">\n              {this.room.rateplan.short_name} {this.room.rateplan.is_non_refundable ? locales.entries.Lcz_NonRefundable : ''}\n            </p>\n          </div>\n          <div class={'d-flex align-items-center mt-1'} style={{ gap: '0.5rem' }}>\n            <span>From:</span>\n            <ir-date-picker\n              data-testid=\"pickup_arrival_date\"\n              date={this.selectedDates?.from_date?.format('YYYY-MM-DD')}\n              maxDate={this.defaultDates?.to_date.format('YYYY-MM-DD')}\n              minDate={this.defaultDates?.from_date.format('YYYY-MM-DD')}\n              emitEmptyDate={true}\n              // aria-invalid={this.errors?.arrival_date && !this.pickupData.arrival_date ? 'true' : 'false'}\n              onDateChanged={evt => {\n                this.selectedDates = {\n                  ...this.selectedDates,\n                  from_date: evt.detail.start,\n                };\n              }}\n            >\n              <input\n                type=\"text\"\n                slot=\"trigger\"\n                value={this.selectedDates.from_date ? this.selectedDates.from_date.format('MMM DD, YYYY') : null}\n                class={`form-control input-sm  text-center`}\n                style={{ width: '120px' }}\n              ></input>\n            </ir-date-picker>\n            <ir-button isLoading={isRequestPending('/Check_Availability')} text=\"Check available units\" size=\"sm\" onClick={() => this.checkBookingAvailability()}></ir-button>\n          </div>\n          {this.errors?.roomtype_id && <p class=\"text-danger text-left mt-2\">Please select a room</p>}\n          <ul class=\"room-type-list mt-2\">\n            {this.roomTypes?.map(roomType => {\n              if (!roomType.is_available_to_book) {\n                return null;\n              }\n              const units = (() => {\n                const unitMap = new Map<number, string>();\n                for (const rateplan of roomType.rateplans) {\n                  for (const unit of rateplan.assignable_units) {\n                    if (unit.Is_Fully_Available) {\n                      unitMap.set(unit.pr_id, unit.name);\n                    }\n                  }\n                }\n\n                return Array.from(unitMap, ([id, name]) => ({ id, name }));\n              })();\n              return (\n                <Fragment>\n                  <li key={`roomTypeRow-${roomType.id}`} class={`room-type-row`}>\n                    <div class={'d-flex choice-row'}>\n                      <span class=\"text-left room-type-name\">{roomType.name}</span>\n                    </div>\n                  </li>\n                  {units.map((room, j) => {\n                    const row_style = j === roomType.physicalrooms.length - 1 ? 'pb-1' : '';\n                    const showMealPlanSelect = this.selectedUnit?.unit_id === room.id && Array.isArray(this.mealPlanOptions) && this.mealPlanOptions.length > 0;\n                    return (\n                      <li key={`physicalRoom-${room.id}-${j}`} class={`physical-room ${row_style}`}>\n                        <div class={'d-flex choice-row align-items-center'} style={{ gap: '0.5rem' }}>\n                          <ir-radio\n                            class=\"pl-1\"\n                            name=\"unit\"\n                            checked={this.selectedUnit?.unit_id === room.id}\n                            onCheckChange={() =>\n                              this.updateSelectedUnit({\n                                roomtype_id: roomType.id,\n                                unit_id: room.id,\n                              })\n                            }\n                            label={room.name}\n                          ></ir-radio>\n                          {showMealPlanSelect && (\n                            <ir-select\n                              firstOption=\"Select a new rateplan...\"\n                              error={this.errors?.rateplan_id && !this.selectedUnit?.rateplan_id}\n                              onSelectChange={e => {\n                                const value = e.detail === null || e.detail === undefined || e.detail === '' ? undefined : Number(e.detail);\n                                this.updateSelectedUnit({\n                                  rateplan_id: value,\n                                });\n                              }}\n                              data={this.mealPlanOptions.map(e => ({ ...e, text: e.text + `${e.custom_text ? ' | ' : ''}${e.custom_text}` }))}\n                            ></ir-select>\n                            // <ir-dropdown\n                            //   onOptionChange={e => {\n                            //     this.updateSelectedUnit({\n                            //       rateplan_id: Number(e.detail.toString()),\n                            //     });\n                            //   }}\n                            //   style={{ '--ir-dropdown-menu-min-width': 'max-content' }}\n                            // >\n                            //   <button type=\"button\" class=\"btn btn-sm form-control pr-2 d-flex align-items-center\" style={{ minWidth: '200px' }} slot=\"trigger\">\n                            //     {this.selectedUnit?.rateplan_id ? this.mealPlanOptions.find(r => r.value === this.selectedUnit.rateplan_id.toString()).text : 'Choose a meal plan'}\n                            //   </button>\n                            //   {this.mealPlanOptions.map(o => (\n                            //     <ir-dropdown-item value={o.value}>\n                            //       <p class=\"m-0 p-0\">\n                            //         {o.text} {o.custom_text && <span class=\"m-0 p-0\">| {o.custom_text}</span>}\n                            //       </p>\n                            //     </ir-dropdown-item>\n                            //   ))}\n                            // </ir-dropdown>\n                          )}\n                        </div>\n                      </li>\n                    );\n                  })}\n                </Fragment>\n              );\n            })}\n          </ul>\n        </section>\n        <div class={'sheet-footer'}>\n          <ir-button text={locales.entries.Lcz_Cancel} btn_color=\"secondary\" class={'flex-fill'} onClickHandler={() => this.closeModal.emit(null)}></ir-button>\n          <ir-button isLoading={this.isLoading} text={locales.entries.Lcz_Confirm} btn_type=\"submit\" class=\"flex-fill\"></ir-button>\n        </div>\n      </form>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n","import { Component, Host, Prop, State, h, Event, EventEmitter } from '@stencil/core';\n\n@Component({\n  tag: 'igl-tba-category-view',\n  styleUrl: 'igl-tba-category-view.css',\n  scoped: true,\n})\nexport class IglTbaCategoryView {\n  @Prop() calendarData: { [key: string]: any };\n  @Prop() selectedDate;\n  @Prop() categoriesData: { [key: string]: any } = {};\n  @Prop() categoryId;\n  @Prop({ mutable: true }) eventDatas;\n  @Prop() categoryIndex;\n\n  @State() renderAgain: boolean = false;\n\n  @Event() assignUnitEvent: EventEmitter<{ [key: string]: any }>;\n\n  handleAssignRoomEvent(event: CustomEvent<{ [key: string]: any }>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    const opt: { [key: string]: any } = event.detail;\n    this.eventDatas = this.eventDatas.filter(eventData => eventData.ID != opt.data.ID);\n    this.calendarData.bookingEvents.push(opt.data);\n    this.assignUnitEvent.emit({\n      key: 'assignUnit',\n      data: {\n        RT_ID: this.categoryId,\n        selectedDate: this.selectedDate,\n        assignEvent: opt.data,\n        calendarData: this.calendarData,\n      },\n    });\n    // if(this.localEventDatas.length){\n    this.renderView();\n    // }\n  }\n\n  getEventView(categoryId, eventDatas) {\n    return eventDatas.map((eventData, ind) => (\n      <igl-tba-booking-view\n        calendarData={this.calendarData}\n        selectedDate={this.selectedDate}\n        eventData={eventData}\n        categoriesData={this.categoriesData}\n        categoryId={categoryId}\n        categoryIndex={this.categoryIndex}\n        eventIndex={ind}\n        onAssignRoomEvent={evt => this.handleAssignRoomEvent(evt)}\n      ></igl-tba-booking-view>\n    ));\n  }\n\n  renderView() {\n    this.renderAgain = !this.renderAgain;\n  }\n\n  render() {\n    return (\n      <Host>\n        <div class=\"sectionContainer\">\n          <div class=\"font-weight-bold mt-1 font-small-3\">{this.categoriesData[this.categoryId]?.name}</div>\n          {this.getEventView(this.categoryId, this.eventDatas)}\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n.custom-dropdown {\n  cursor: pointer;\n  padding: 5px 10px;\n  width: min-content;\n  margin-left: auto;\n  margin-right: auto;\n}\n.dropdown-toggle {\n  all: unset;\n  display: flex;\n  width: max-content;\n  align-items: center;\n  gap: 10px;\n}\n.close_btn_style {\n  padding: 0.4rem;\n}\n.close_btn_style:hover {\n  background-color: #f6f6f6;\n}\n.dropdown-menu {\n  max-height: 250px;\n  overflow-y: auto;\n}\n.tobeAssignedHeader {\n  font-weight: 500;\n  letter-spacing: 0.05rem;\n  font-size: 1.12rem;\n  padding: 0;\n  margin: 0;\n}\n.assignment_header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding-top: 5px;\n  margin-bottom: 1rem;\n}\n.dropdown-toggle::after {\n  content: none;\n  display: none;\n}\n.dropdown-toggle .caret-icon {\n  transition: transform 0.2s ease;\n}\n.show .caret-icon {\n  transform: rotate(-180deg);\n}\n.stickyHeader {\n  position: -webkit-sticky;\n  position: sticky;\n  top: 0;\n  background-color: #ffffff;\n  z-index: 1;\n}\n.pointer {\n  cursor: pointer;\n}\n\n.dots {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 3px;\n  padding: 0;\n}\n.dot {\n  width: 5px;\n  height: 5px;\n  margin: 5px 4px 0;\n  background-color: #6b6f82;\n  border-radius: 50%;\n  animation: dotFlashing 1s infinite linear alternate;\n}\n.dot:nth-child(2) {\n  animation-delay: 0.2s;\n}\n.dot:nth-child(3) {\n  animation-delay: 0.4s;\n}\n\n@keyframes dotFlashing {\n  0% {\n    opacity: 0;\n  }\n  50%,\n  100% {\n    opacity: 1;\n  }\n}\n","import { Component, Host, h, Prop, Event, EventEmitter, State, Listen, Fragment, Watch } from '@stencil/core';\nimport { ToBeAssignedService } from '@/services/toBeAssigned.service';\nimport { dateToFormattedString } from '@/utils/utils';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { getUnassignedDates } from '@/stores/unassigned_dates.store';\nimport { colorVariants } from '@/components/ui/ir-icons/icons';\n//import { updateCategories } from '@/utils/events.utils';\n\n@Component({\n  tag: 'igl-to-be-assigned',\n  styleUrl: 'igl-to-be-assigned.css',\n  scoped: true,\n})\nexport class IglToBeAssigned {\n  @Prop() unassignedDatesProp: any;\n  @Prop() propertyid: number;\n  @Prop() from_date: string;\n  @Prop() to_date: string;\n  @Prop({ mutable: true }) calendarData: { [key: string]: any };\n\n  @State() loadingMessage: string;\n  @State() showDatesList: boolean = false;\n  @State() renderAgain: boolean = false;\n  @State() orderedDatesList: any[] = [];\n  @State() noScroll = false;\n\n  @Event() optionEvent: EventEmitter<{ [key: string]: any }>;\n  @Event({ bubbles: true, composed: true })\n  reduceAvailableUnitEvent: EventEmitter<{ [key: string]: any }>;\n  @Event() showBookingPopup: EventEmitter;\n  @Event({ bubbles: true, composed: true }) addToBeAssignedEvent: EventEmitter;\n  @Event({ bubbles: true, composed: true })\n  highlightToBeAssignedBookingEvent: EventEmitter;\n\n  private isGotoToBeAssignedDate: boolean = false;\n  private isLoading: boolean = true;\n  private selectedDate = null;\n  private data: { [key: string]: any } = {};\n  private today = new Date();\n  private categoriesData: { [key: string]: any } = {};\n  private toBeAssignedService: ToBeAssignedService = new ToBeAssignedService();\n  private unassignedDates: any;\n\n  componentWillLoad() {\n    this.reArrangeData();\n    this.loadingMessage = locales.entries.Lcz_FetchingUnAssignedUnits;\n  }\n\n  @Watch('unassignedDatesProp')\n  handleUnassignedDatesToBeAssignedChange(newValue: any) {\n    const { fromDate, toDate, data } = newValue;\n    let dt = new Date(fromDate);\n    dt.setHours(0);\n    dt.setMinutes(0);\n    dt.setSeconds(0);\n    let endDate = dt.getTime();\n    while (endDate <= new Date(toDate).getTime()) {\n      if (data && !data[endDate] && this.unassignedDates.hasOwnProperty(endDate)) {\n        delete this.unassignedDates[endDate];\n      } else if (data && data[endDate]) {\n        this.unassignedDates[endDate] = data[endDate];\n      }\n      endDate = moment(endDate).add(1, 'days').toDate().getTime();\n    }\n    this.data = { ...this.unassignedDates };\n    this.orderedDatesList = Object.keys(this.data).sort((a, b) => parseInt(a) - parseInt(b));\n\n    if (this.orderedDatesList.length) {\n      if (!this.data.hasOwnProperty(this.selectedDate)) {\n        this.selectedDate = this.orderedDatesList.length ? this.orderedDatesList[0] : null;\n      }\n      this.showForDate(this.selectedDate, false);\n      this.renderView();\n    } else {\n      this.selectedDate = null;\n    }\n  }\n  handleAssignUnit(event: CustomEvent<{ [key: string]: any }>) {\n    const opt: { [key: string]: any } = event.detail;\n    const data = opt.data;\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    if (opt?.key === 'assignUnit' && this.data) {\n      // Verify data.selectedDate exists in this.data\n      if (data?.selectedDate && this.data[data.selectedDate]) {\n        // Check if categories exist and there's only one category\n        if (this.data[data.selectedDate]?.categories && Object.keys(this.data[data.selectedDate]?.categories || {})?.length === 1) {\n          this.isLoading = true;\n          this.noScroll = true;\n        }\n\n        // Make sure all required properties exist before filtering\n        if (\n          data?.RT_ID &&\n          this.data[data.selectedDate]?.categories &&\n          this.data[data.selectedDate].categories[data.RT_ID] &&\n          Array.isArray(this.data[data.selectedDate].categories[data.RT_ID]) &&\n          data?.assignEvent?.ID\n        ) {\n          this.data[data.selectedDate].categories[data.RT_ID] = this.data[data.selectedDate].categories[data.RT_ID].filter(\n            eventData => eventData && eventData.ID !== data.assignEvent.ID,\n          );\n        }\n\n        // Only update calendarData if it exists in the data\n        if (data?.calendarData) {\n          this.calendarData = data.calendarData;\n        }\n\n        this.renderView();\n      }\n    }\n  }\n\n  async updateCategories(key, calendarData) {\n    try {\n      //console.log(\"called\")\n      let categorisedRooms = {};\n      const result = await this.toBeAssignedService.getUnassignedRooms(\n        { from_date: calendarData.from_date, to_date: calendarData.to_date },\n        this.propertyid,\n        dateToFormattedString(new Date(+key)),\n        calendarData.roomsInfo,\n        calendarData.formattedLegendData,\n      );\n      result.forEach(room => {\n        if (!categorisedRooms.hasOwnProperty(room.RT_ID)) {\n          categorisedRooms[room.RT_ID] = [room];\n        } else {\n          categorisedRooms[room.RT_ID].push(room);\n        }\n      });\n      this.unassignedDates[key].categories = categorisedRooms;\n    } catch (error) {\n      //  toastr.error(error);\n    }\n  }\n\n  async reArrangeData() {\n    try {\n      this.today.setHours(0, 0, 0, 0);\n      this.calendarData.roomsInfo.forEach(category => {\n        this.categoriesData[category.id] = {\n          name: category.name,\n          roomsList: category.physicalrooms,\n          roomIds: category.physicalrooms.map(room => {\n            return room.id;\n          }),\n        };\n      });\n\n      this.selectedDate = null;\n      //this.unassignedDates = await this.toBeAssignedService.getUnassignedDates(this.propertyid, dateToFormattedString(new Date()), this.to_date);\n      this.unassignedDates = getUnassignedDates();\n      console.log(this.unassignedDates);\n\n      this.data = this.unassignedDates;\n      this.orderedDatesList = Object.keys(this.data).sort((a, b) => parseInt(a) - parseInt(b));\n\n      if (!this.selectedDate && this.orderedDatesList.length) {\n        this.selectedDate = this.orderedDatesList[0];\n      }\n    } catch (error) {\n      console.error('Error fetching unassigned dates:', error);\n      //  toastr.error(error);\n    }\n  }\n  async componentDidLoad() {\n    setTimeout(() => {\n      if (!this.isGotoToBeAssignedDate && Object.keys(this.unassignedDates).length > 0) {\n        //console.log(this.isGotoToBeAssignedDate);\n        const firstKey = Object.keys(this.unassignedDates)[0];\n\n        this.showForDate(firstKey);\n      }\n    }, 100);\n  }\n  @Listen('gotoToBeAssignedDate', { target: 'window' })\n  async gotoDate(event: CustomEvent) {\n    this.isGotoToBeAssignedDate = true;\n    this.showForDate(event.detail.data);\n    this.showDatesList = false;\n    this.renderView();\n  }\n  @Listen('highlightToBeAssignedBookingEvent')\n  handleToBeAssignedDate(e: CustomEvent) {\n    this.showBookingPopup.emit({\n      key: 'calendar',\n      data: new Date(e.detail.data.fromDate).getTime() - 86400000,\n      noScroll: false,\n    });\n  }\n  async showForDate(dateStamp, withLoading = true) {\n    try {\n      if (withLoading) {\n        this.isLoading = true;\n      }\n      if (this.showDatesList) {\n        this.showUnassignedDate();\n      }\n      await this.updateCategories(dateStamp, this.calendarData);\n      this.addToBeAssignedEvent.emit({ key: 'tobeAssignedEvents', data: [] });\n      this.showBookingPopup.emit({\n        key: 'calendar',\n        data: parseInt(dateStamp) - 86400000,\n        noScroll: this.noScroll,\n      });\n      if (this.isGotoToBeAssignedDate) {\n        this.isGotoToBeAssignedDate = false;\n      }\n      this.isLoading = false;\n      this.selectedDate = dateStamp;\n      this.renderView();\n    } catch (error) {\n      // toastr.error(error);\n    }\n  }\n\n  getDay(dt) {\n    const currentDate = new Date(dt);\n    const locale = 'default'; //'en-US';\n    const dayOfWeek = this.getLocalizedDayOfWeek(currentDate, locale);\n    // const monthName = currentDate.toLocaleString(\"default\", { month: 'short' })\n    return dayOfWeek + ' ' + currentDate.getDate() + ', ' + currentDate.getFullYear();\n  }\n\n  getLocalizedDayOfWeek(date, locale) {\n    const options = { weekday: 'short' };\n    return date.toLocaleDateString(locale, options);\n  }\n\n  handleOptionEvent(key, data = '') {\n    this.highlightToBeAssignedBookingEvent.emit({\n      key: 'highlightBookingId',\n      data: { bookingId: '----' },\n    });\n    this.addToBeAssignedEvent.emit({ key: 'tobeAssignedEvents', data: [] });\n    this.optionEvent.emit({ key, data });\n  }\n\n  showUnassignedDate() {\n    this.showDatesList = !this.showDatesList;\n  }\n\n  getToBeAssignedEntities() {\n    // toBeAssignedEvents\n  }\n\n  getCategoryView() {\n    if (this.orderedDatesList.length && this.selectedDate && this.data[this.selectedDate]) {\n      return Object.entries(this.data[this.selectedDate].categories).map(([id, eventDatas], ind) => (\n        <igl-tba-category-view\n          calendarData={this.calendarData}\n          selectedDate={this.selectedDate}\n          categoryId={id}\n          categoryIndex={ind}\n          categoriesData={this.categoriesData}\n          eventDatas={eventDatas}\n          onAssignUnitEvent={evt => this.handleAssignUnit(evt)}\n        ></igl-tba-category-view>\n      ));\n    } else {\n      return null;\n    }\n  }\n\n  renderView() {\n    this.renderAgain = !this.renderAgain;\n  }\n\n  render() {\n    return (\n      <Host class=\"tobeAssignedContainer pr-1 text-left\">\n        <div>\n          <div>\n            <div class=\"stickyHeader pt-1\">\n              <div class={'assignment_header'}>\n                <p class=\"tobeAssignedHeader \">{locales.entries.Lcz_Assignments}</p>\n                <ir-button\n                  class=\"close_btn\"\n                  variant=\"icon\"\n                  btn_styles=\"close_btn_style\"\n                  icon_name=\"double_caret_left\"\n                  style={colorVariants.secondary}\n                  onClickHandler={() => this.handleOptionEvent('closeSideMenu')}\n                  visibleBackgroundOnHover\n                ></ir-button>\n              </div>\n              <hr />\n              {Object.keys(this.data).length === 0 ? (\n                <p>{locales.entries.Lcz_AllBookingsAreAssigned}</p>\n              ) : this.isLoading ? (\n                <p class=\"d-flex align-items-center\">\n                  <span class=\"p-0\">{this.loadingMessage}</span>\n                  <div class=\"dots\">\n                    <div class=\"dot\"></div>\n                    <div class=\"dot\"></div>\n                    <div class=\"dot\"></div>\n                  </div>\n                </p>\n              ) : (\n                <Fragment>\n                  {this.orderedDatesList.length ? (\n                    <div\n                      class={`custom-dropdown border border-light rounded text-center ` + (this.showDatesList ? 'show' : '')}\n                      id=\"dropdownMenuButton\"\n                      data-toggle=\"dropdown\"\n                      aria-haspopup=\"true\"\n                      aria-expanded=\"false\"\n                    >\n                      <div\n                        class={'dropdown-toggle'}\n                        //onClick={() => this.showUnassignedDate()}\n                      >\n                        <span class=\"font-weight-bold\">{this.data[this.selectedDate].dateStr}</span>\n                        <svg class={'caret-icon'} xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\" height={14} width={14}>\n                          <path\n                            fill=\"#6b6f82\"\n                            d=\"M201.4 342.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 274.7 86.6 137.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z\"\n                          />\n                        </svg>\n                      </div>\n                      <div class=\"dropdown-menu dropdown-menu-right full-width\" aria-labelledby=\"dropdownMenuButton\">\n                        {this.orderedDatesList?.map(ordDate => (\n                          <div class=\"dropdown-item pointer\" onClick={() => this.showForDate(ordDate)}>\n                            {this.data[ordDate].dateStr}\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ) : (\n                    locales.entries.Lcz_AllBookingsAreAssigned\n                  )}\n                </Fragment>\n              )}\n            </div>\n            {!this.isLoading && (\n              <div class=\"scrollabledArea\">\n                {this.orderedDatesList.length ? (\n                  Object.keys(this.data[this.selectedDate].categories).length ? (\n                    this.getCategoryView()\n                  ) : (\n                    <div class=\"mt-1\">{locales.entries.Lcz_AllAssignForThisDay}</div>\n                  )\n                ) : null}\n              </div>\n            )}\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  width: 100%;\n  --hk-green: green;\n}\n* {\n  box-sizing: border-box;\n}\n.popover-title {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  margin: 0;\n  padding: 0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  z-index: 10;\n  left: 0;\n  display: flex;\n  align-items: center;\n}\n.popover-container {\n  position: absolute;\n  bottom: 0px;\n  left: var(--ir-popover-left, 10px);\n  background: rgb(0, 0, 0);\n  color: white;\n  min-width: 100%;\n  box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 10px;\n  z-index: 9999;\n  padding: 3.5px 7px;\n  border-radius: 5px;\n  pointer-events: none;\n  opacity: 0;\n  transition: all 100ms ease;\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n  font-style: normal;\n  font-weight: 400;\n  line-height: 1.45;\n  text-decoration: none;\n  text-shadow: none;\n  font-size: 0.875rem;\n}\n.popover-container[data-state='show'] {\n  opacity: 1;\n}\n.hk-dot {\n  inset: 0;\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: fit-content;\n  padding: 4px;\n  left: auto;\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;\n  padding-inline: var(--ir-popover-left);\n  background: var(--ir-interactive-hk-bg, white);\n  color: var(--dot-color, black);\n}\n.hk-dot::slotted(*)[name='end'] {\n  height: 12px;\n}\n\n/* .hk-dot::after {\n  content: '';\n  height: 8px;\n  aspect-ratio: 1;\n  border-radius: 9999999px;\n  background: var(--dot-color, #ffffff);\n} */\n","import { Component, Host, Prop, h, Element } from '@stencil/core';\n\n@Component({\n  tag: 'ir-interactive-title',\n  styleUrl: 'ir-interactive-title.css',\n  scoped: true,\n})\nexport class IrInteractiveTitle {\n  @Element() el: HTMLElement;\n\n  /**\n   * The full title string that may be cropped in the UI.\n   */\n  @Prop() popoverTitle: string = '';\n\n  /**\n   * CSS offset for the left position of the popover.\n   * Used as a CSS variable `--ir-popover-left`.\n   */\n  @Prop() irPopoverLeft: string = '10px';\n\n  /**\n   * Whether to show the housekeeping (HK) status dot.\n   */\n  @Prop() hkStatus: boolean = false;\n\n  /**\n   * The number of characters to display before cropping the title with ellipsis.\n   */\n  @Prop() cropSize: number = 20;\n  /**\n   * The message shown when hovering over the broom svg if provided.\n   * @requires hkStatus to be true\n   */\n  @Prop() broomTooltip: string;\n\n  /**\n   * Reference to track if we've initialized popover for current render\n   */\n  private lastRenderedTitle: string = '';\n  private titleContainerRef: HTMLElement;\n  private popoverInstance: any;\n\n  /**\n   * Initialize popover with overflow detection\n   */\n  private initializePopoverIfNeeded(titleContainer: HTMLElement, title: string) {\n    // Only initialize if title changed or first time\n    if (this.lastRenderedTitle === title && this.popoverInstance) {\n      return;\n    }\n    this.disposePopover();\n\n    const tempSpan = document.createElement('span');\n    tempSpan.style.visibility = 'hidden';\n    tempSpan.style.position = 'absolute';\n    tempSpan.style.whiteSpace = 'nowrap';\n    tempSpan.textContent = title;\n    document.body.appendChild(tempSpan);\n\n    const textWidth = tempSpan.offsetWidth;\n    document.body.removeChild(tempSpan);\n\n    const containerWidth = titleContainer.clientWidth;\n    const iconWidth = this.hkStatus ? 20 : 0;\n\n    const willOverflow = textWidth + iconWidth > containerWidth;\n\n    if (willOverflow && typeof $ !== 'undefined') {\n      try {\n        this.popoverInstance = $(titleContainer).popover({\n          trigger: 'hover',\n          content: title,\n          placement: 'top',\n          html: false,\n          sanitize: true,\n          delay: { show: 300, hide: 100 },\n        });\n      } catch (error) {\n        console.error('Failed to initialize popover:', error);\n      }\n    }\n\n    this.lastRenderedTitle = title;\n  }\n\n  private disposePopover() {\n    if (this.popoverInstance && typeof $ !== 'undefined') {\n      try {\n        $(this.titleContainerRef).popover('dispose');\n        this.popoverInstance = null;\n      } catch (error) {\n        console.error('Failed to dispose popover:', error);\n      }\n    }\n  }\n\n  disconnectedCallback() {\n    this.disposePopover();\n  }\n\n  render() {\n    const title = this.popoverTitle || '';\n\n    const shouldCrop = title.length > this.cropSize;\n    const displayTitle = shouldCrop ? title.slice(0, this.cropSize) + '...' : title;\n\n    return (\n      <Host style={{ '--ir-popover-left': this.irPopoverLeft }}>\n        <p\n          ref={el => {\n            this.titleContainerRef = el;\n            if (el && title) {\n              setTimeout(() => this.initializePopoverIfNeeded(el, title), 0);\n            }\n          }}\n          class=\"popover-title\"\n          style={{\n            whiteSpace: 'nowrap',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '4px',\n          }}\n        >\n          <span\n            class=\"cropped-title\"\n            style={{\n              flexShrink: '1',\n              minWidth: '0',\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n            }}\n          >\n            {displayTitle}\n          </span>\n          {this.hkStatus && (\n            <div title={this.broomTooltip} class=\"hk-dot\" style={{ flexShrink: '0' }}>\n              <slot name=\"end\"></slot>\n            </div>\n          )}\n        </p>\n      </Host>\n    );\n  }\n}\n",":host {\n  display: block;\n  box-sizing: border-box;\n  margin: 0;\n  position: relative;\n}\n.loading-container {\n  position: relative;\n  height: 100%;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.close-icon {\n  position: absolute;\n  top: 18px;\n  right: 33px;\n  outline: none;\n}\n.close {\n  float: right;\n  font-size: 1.5rem;\n  font-weight: 700;\n  line-height: 1;\n  color: #000;\n  text-shadow: 0 1px 0 #fff;\n  opacity: 0.5;\n\n  padding: 0;\n  background-color: transparent;\n  border: 0;\n  appearance: none;\n}\n.card {\n  top: 0;\n  z-index: 1000;\n}\n.card-title {\n  border-bottom: 1px solid #e4e5ec;\n  width: 100%;\n}\n.irfontgreen {\n  color: #0e930e;\n}\n.currency {\n  display: block;\n  position: absolute;\n  margin: 0;\n  padding: 0;\n  height: auto;\n  left: 10px;\n}\n.rate-input {\n  font-size: 14px;\n  line-height: 0;\n  padding: 0;\n  height: 0;\n  border-left: 0;\n  border-radius: 0.25rem !important;\n}\n.rate-input-container {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  box-sizing: border-box;\n  flex: 1;\n}\n.new-currency {\n  color: #3b4781;\n  border: 1px solid #cacfe7;\n  font-size: 0.975rem;\n  height: 2rem;\n  background: rgb(255, 255, 255);\n  padding-right: 0 !important;\n  border-right: 0;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n  transition: border-color 0.15s ease-in-out, -webkit-box-shadow 0.15s ease-in-out;\n}\n.input-group-prepend span[data-state='focus'] {\n  border-color: var(--blue);\n}\n.input-group-prepend span[data-disabled] {\n  background-color: #eceff1;\n  border-color: rgba(118, 118, 118, 0.3);\n}\n.rateInputBorder {\n  padding-left: 5px !important;\n  padding-right: 5px !important;\n  border-top-left-radius: 0 !important;\n  border-bottom-left-radius: 0 !important;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import { Component, Prop, State, h, Event, EventEmitter, Fragment } from '@stencil/core';\nimport { BookingService } from '@/services/booking.service';\nimport { convertDatePrice, formatDate, getDaysArray } from '@/utils/utils';\nimport { Booking, Day, IUnit, Room } from '@/models/booking.dto';\nimport { IRoomNightsDataEventPayload } from '@/models/property-types';\nimport moment from 'moment';\nimport locales from '@/stores/locales.store';\nimport { Variation } from '@/models/property';\n\n@Component({\n  tag: 'ir-room-nights',\n  styleUrls: ['ir-room-nights.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IrRoomNights {\n  @Prop() bookingNumber: string;\n  @Prop() propertyId: number;\n  @Prop() language: string;\n  @Prop() identifier: string;\n  @Prop() toDate: string;\n  @Prop() fromDate: string;\n  @Prop() pool: string;\n  @Prop() ticket: string;\n  @Prop() defaultDates: { from_date: string; to_date: string };\n\n  @State() bookingEvent: Booking;\n  @State() selectedRoom: Room;\n  @State() rates: Day[] = [];\n  @State() isLoading = false;\n  @State() initialLoading = false;\n  @State() inventory: number | null = null;\n  @State() isEndDateBeforeFromDate: boolean = false;\n  @State() defaultTotalNights = 0;\n  @State() isInputFocused = -1;\n  @State() dates: { from_date: Date; to_date: Date } = { from_date: new Date(), to_date: new Date() };\n\n  @Event() closeRoomNightsDialog: EventEmitter<IRoomNightsDataEventPayload>;\n\n  private bookingService = new BookingService();\n\n  componentWillLoad() {\n    this.dates = { from_date: new Date(this.fromDate), to_date: new Date(this.toDate) };\n    this.init();\n  }\n\n  isButtonDisabled() {\n    return this.isLoading || this.rates.some(rate => rate.amount === -1) || this.inventory === 0 || this.inventory === null;\n  }\n  async init() {\n    try {\n      const { from_date } = this.defaultDates;\n      if (moment(from_date, 'YYYY-MM-DD').isBefore(moment(this.fromDate, 'YYYY-MM-DD'))) {\n        this.dates.from_date = new Date(from_date);\n      } else {\n        this.dates.from_date = new Date(this.fromDate);\n      }\n      this.dates.to_date = new Date(this.toDate);\n      this.bookingEvent = await this.bookingService.getExposedBooking(this.bookingNumber, this.language);\n      if (this.bookingEvent) {\n        const filteredRooms = this.bookingEvent.rooms.filter(room => room.identifier === this.identifier);\n        this.selectedRoom = filteredRooms[0];\n        const lastDay = this.selectedRoom?.days[this.selectedRoom.days.length - 1];\n        //let first_rate = this.selectedRoom.days[0].amount;\n        if (moment(this.toDate).add(-1, 'days').isSame(moment(lastDay.date))) {\n          console.log('here1');\n          const amount = await this.fetchBookingAvailability(this.fromDate, this.selectedRoom.days[0].date, this.selectedRoom.rateplan.id);\n          const newDatesArr = getDaysArray(this.selectedRoom.days[0].date, this.fromDate);\n          this.isEndDateBeforeFromDate = true;\n          this.rates;\n          this.rates = [\n            ...newDatesArr.map(day => ({\n              amount: amount / newDatesArr.length,\n              date: day,\n              cost: null,\n            })),\n            ...this.selectedRoom.days,\n          ];\n          this.defaultTotalNights = this.rates.length - this.selectedRoom.days.length;\n        } else {\n          console.log('here2');\n          console.log(lastDay);\n          const amount = await this.fetchBookingAvailability(this.bookingEvent.to_date, moment(this.toDate, 'YYYY-MM-DD').format('YYYY-MM-DD'), this.selectedRoom.rateplan.id);\n          const newDatesArr = getDaysArray(lastDay.date, this.toDate);\n          this.rates = [\n            ...this.selectedRoom.days,\n            ...newDatesArr.map(day => ({\n              amount: amount / newDatesArr.length,\n              date: day,\n              cost: null,\n            })),\n          ];\n        }\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  private handleInput(event: string, index: number) {\n    let inputValue = event;\n    let days = [...this.rates];\n    inputValue = inputValue.replace(/[^0-9.]/g, '');\n    if (inputValue === '') {\n      days[index].amount = -1;\n    } else {\n      if (!isNaN(Number(inputValue))) {\n        days[index].amount = Number(inputValue);\n      }\n    }\n    this.rates = days;\n  }\n  async fetchBookingAvailability(from_date: string, to_date: string, rate_plan_id: number) {\n    try {\n      this.initialLoading = true;\n      const bookingAvailability = await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: this.propertyId,\n        adultChildCount: {\n          adult: this.selectedRoom.rateplan.selected_variation.adult_nbr,\n          child: this.selectedRoom.rateplan.selected_variation.child_nbr,\n        },\n        language: this.language,\n        currency: this.bookingEvent.currency,\n        room_type_ids: [this.selectedRoom.roomtype.id],\n        rate_plan_ids: [rate_plan_id],\n      });\n      console.log(bookingAvailability[0], rate_plan_id);\n      this.inventory = bookingAvailability[0].inventory;\n      const rate_plan = bookingAvailability[0].rateplans.find(rate => rate.id === rate_plan_id);\n      if (!rate_plan || !rate_plan.variations) {\n        this.inventory = null;\n        return null;\n      }\n      const selected_variation: Variation = rate_plan.variations?.find(\n        variation =>\n          variation.adult_nbr === this.selectedRoom.rateplan.selected_variation.adult_nbr && variation.child_nbr === this.selectedRoom.rateplan.selected_variation.child_nbr,\n      );\n      if (!selected_variation) {\n        return null;\n      }\n      return selected_variation.discounted_gross_amount;\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.initialLoading = false;\n    }\n  }\n\n  private renderInputField(index: number, currency_symbol: string, day: Day) {\n    return (\n      <div class=\"col-3 ml-1 position-relative  m-0 p-0 rate-input-container\">\n        <ir-price-input\n          value={day.amount > 0 ? day.amount.toString() : ''}\n          disabled={this.inventory === 0 || this.inventory === null}\n          currency={currency_symbol}\n          aria-label=\"rate\"\n          aria-describedby=\"rate cost\"\n          onTextChange={e => this.handleInput(e.detail, index)}\n        ></ir-price-input>\n      </div>\n    );\n  }\n\n  private renderReadOnlyField(currency_symbol: string, day: Day) {\n    return <p class=\"col-9 ml-1 m-0 p-0\">{`${currency_symbol}${Number(day.amount).toFixed(2)}`}</p>;\n  }\n  private renderRateFields(index: number, currency_symbol: string, day: Day) {\n    if (this.isEndDateBeforeFromDate) {\n      if (index < this.defaultTotalNights) {\n        return this.renderInputField(index, currency_symbol, day);\n      } else {\n        return this.renderReadOnlyField(currency_symbol, day);\n      }\n    } else {\n      return index < this.selectedRoom.days.length ? this.renderReadOnlyField(currency_symbol, day) : this.renderInputField(index, currency_symbol, day);\n    }\n  }\n  renderDates() {\n    const currency_symbol = this.bookingEvent.currency.symbol;\n    // const currency_symbol = getCurrencySymbol(this.bookingEvent.currency.code);\n    return (\n      <div class={'mt-2 m-0'}>\n        {this.rates?.map((day, index) => (\n          <div class={'row m-0 mt-1 align-items-center'}>\n            <p class={'col-2 m-0 p-0'}>{convertDatePrice(day.date)}</p>\n            {this.renderRateFields(index, currency_symbol, day)}\n          </div>\n        ))}\n      </div>\n    );\n  }\n  async handleRoomConfirmation() {\n    try {\n      this.isLoading = true;\n      let oldRooms = [...this.bookingEvent.rooms];\n      let selectedRoomIndex = oldRooms.findIndex(room => room.identifier === this.identifier);\n      if (selectedRoomIndex === -1) {\n        throw new Error('Invalid Pool');\n      }\n      oldRooms[selectedRoomIndex] = {\n        ...oldRooms[selectedRoomIndex],\n        days: this.rates,\n        to_date: moment(this.dates.to_date).format('YYYY-MM-DD'),\n        from_date: moment(this.dates.from_date).format('YYYY-MM-DD'),\n      };\n      const body = {\n        assign_units: true,\n        check_in: true,\n        is_pms: true,\n        is_direct: true,\n        pickup_info: this.bookingEvent.pickup_info,\n        extra_services: this.bookingEvent.extra_services,\n        booking: {\n          booking_nbr: this.bookingNumber,\n          from_date: moment(this.dates.from_date).format('YYYY-MM-DD'),\n          to_date: moment(this.dates.to_date).format('YYYY-MM-DD'),\n          remark: this.bookingEvent.remark,\n          property: this.bookingEvent.property,\n          source: this.bookingEvent.source,\n          currency: this.bookingEvent.currency,\n          arrival: this.bookingEvent.arrival,\n          guest: this.bookingEvent.guest,\n          rooms: oldRooms,\n        },\n      };\n      await this.bookingService.doReservation(body);\n      this.closeRoomNightsDialog.emit({ type: 'confirm', pool: this.pool });\n    } catch (error) {\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  render() {\n    if (!this.bookingEvent) {\n      return (\n        <div class=\"loading-container\">\n          <ir-loading-screen></ir-loading-screen>\n        </div>\n      );\n    }\n    return (\n      <div class=\"sheet-container\">\n        <ir-title\n          class=\"p-1 sheet-header\"\n          onCloseSideBar={() => this.closeRoomNightsDialog.emit({ type: 'cancel', pool: this.pool })}\n          label={`${locales.entries.Lcz_AddingRoomNightsTo} ${this.selectedRoom?.roomtype?.name} ${(this.selectedRoom?.unit as IUnit).name}`}\n          displayContext=\"sidebar\"\n        ></ir-title>\n        <section class={'text-left px-1 pt-0 sheet-body'}>\n          <p class={'font-medium-1'}>\n            {`${locales.entries.Lcz_Booking}#`} {this.bookingNumber}\n          </p>\n          {this.initialLoading ? (\n            <p class={'mt-2 text-secondary'}>{locales.entries['Lcz_CheckingRoomAvailability ']}</p>\n          ) : (\n            <Fragment>\n              <p class={'font-weight-bold font-medium-1'}>{`${formatDate(moment(this.dates.from_date).format('YYYY-MM-DD'), 'YYYY-MM-DD')} - ${formatDate(\n                moment(this.dates.to_date).format('YYYY-MM-DD'),\n                'YYYY-MM-DD',\n              )}`}</p>\n              <p class={'font-medium-1 mb-0'}>\n                {`${this.selectedRoom.rateplan.name}`} {this.selectedRoom.rateplan.is_non_refundable && <span class={'irfontgreen'}>{locales.entries.Lcz_NonRefundable}</span>}\n              </p>\n              {(this.inventory === 0 || this.inventory === null) && <p class=\"font-medium-1 text danger\">{locales.entries.Lcz_NoAvailabilityForAdditionalNights}</p>}\n\n              {this.selectedRoom.rateplan.custom_text && <p class={'text-secondary mt-0'}>{this.selectedRoom.rateplan.custom_text}</p>}\n              {this.renderDates()}\n            </Fragment>\n          )}\n        </section>\n        <section class={'sheet-footer'}>\n          <ir-button\n            btn_color=\"secondary\"\n            btn_disabled={this.isLoading}\n            text={locales?.entries.Lcz_Cancel}\n            class=\"full-width\"\n            btn_styles=\"justify-content-center\"\n            onClickHandler={() => this.closeRoomNightsDialog.emit({ type: 'cancel', pool: this.pool })}\n          ></ir-button>\n\n          {this.inventory > 0 && this.inventory !== null && (\n            <ir-button\n              isLoading={this.isLoading}\n              text={locales?.entries.Lcz_Confirm}\n              btn_disabled={this.isButtonDisabled()}\n              class=\"full-width\"\n              btn_styles=\"justify-content-center\"\n              onClickHandler={this.handleRoomConfirmation.bind(this)}\n            ></ir-button>\n          )}\n        </section>\n      </div>\n    );\n  }\n}\n",":host {\n  display: block;\n}\n.spinner {\n  transform-origin: center;\n  animation: spinner_svv2 0.75s infinite linear;\n}\n@keyframes spinner_svv2 {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n","import { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\ntype LoaderPhase = 'spinner' | 'success';\n\n@Component({\n  tag: 'ir-success-loader',\n  styleUrl: 'ir-success-loader.css',\n  shadow: true,\n})\nexport class IrSuccessLoader {\n  /**\n   * How long the spinner should be shown before transitioning to the success icon.\n   * Value is expressed in milliseconds.\n   */\n  @Prop() spinnerDuration = 1500;\n\n  /**\n   * How long the success icon should be shown before the loader dispatches the completion event.\n   * Value is expressed in milliseconds.\n   */\n  @Prop() successDuration = 1000;\n\n  /**\n   * Whether the loader should automatically start its cycle when it becomes active.\n   */\n  @Prop() autoStart = true;\n\n  /**\n   * Controls the visibility of the loader. Setting this to `true` starts the spinner/success cycle.\n   */\n  @Prop({ mutable: true, reflect: true }) active = true;\n\n  /**\n   * Emit when the loader finishes the success state and should be hidden by the parent.\n   */\n  @Event({ bubbles: true, composed: true }) loaderComplete: EventEmitter<void>;\n\n  @State() private phase: LoaderPhase = 'spinner';\n\n  private spinnerTimer?: number;\n  private successTimer?: number;\n\n  componentWillLoad() {\n    if (this.autoStart && this.active) {\n      this.startCycle();\n    }\n  }\n\n  disconnectedCallback() {\n    this.clearTimers();\n  }\n\n  @Watch('active')\n  protected onActiveChange(isActive: boolean) {\n    if (isActive) {\n      if (this.autoStart) {\n        this.startCycle();\n      }\n    } else {\n      this.resetCycle();\n    }\n  }\n\n  @Watch('spinnerDuration')\n  @Watch('successDuration')\n  protected onDurationChange() {\n    if (this.active && this.autoStart) {\n      this.startCycle();\n    }\n  }\n\n  private startCycle() {\n    this.clearTimers();\n    this.phase = 'spinner';\n    const spinnerDelay = Math.max(0, Number(this.spinnerDuration) || 0);\n    if (spinnerDelay === 0) {\n      this.showSuccess();\n      return;\n    }\n    this.spinnerTimer = window.setTimeout(() => this.showSuccess(), spinnerDelay);\n  }\n\n  private showSuccess() {\n    this.phase = 'success';\n    const successDelay = Math.max(0, Number(this.successDuration) || 0);\n    if (successDelay === 0) {\n      this.handleCompletion();\n      return;\n    }\n    this.successTimer = window.setTimeout(() => this.handleCompletion(), successDelay);\n  }\n\n  private handleCompletion() {\n    this.loaderComplete.emit();\n    this.active = false;\n  }\n\n  private resetCycle() {\n    this.clearTimers();\n    this.phase = 'spinner';\n  }\n\n  private clearTimers() {\n    if (this.spinnerTimer) {\n      clearTimeout(this.spinnerTimer);\n      this.spinnerTimer = undefined;\n    }\n    if (this.successTimer) {\n      clearTimeout(this.successTimer);\n      this.successTimer = undefined;\n    }\n  }\n\n  render() {\n    return (\n      <Host>\n        {this.phase === 'spinner' ? (\n          <svg part=\"spinner\" width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n            <path\n              d=\"M10.14,1.16a11,11,0,0,0-9,8.92A1.59,1.59,0,0,0,2.46,12,1.52,1.52,0,0,0,4.11,10.7a8,8,0,0,1,6.66-6.61A1.42,1.42,0,0,0,12,2.69h0A1.57,1.57,0,0,0,10.14,1.16Z\"\n              class=\"spinner\"\n            />\n          </svg>\n        ) : (\n          <ir-icons part=\"check\" name=\"check\" style={{ color: '#45b16d' }}></ir-icons>\n        )}\n      </Host>\n    );\n  }\n}\n",":host {\n  display: flex;\n  align-items: center;\n  position: relative;\n  overflow-x: auto;\n  gap: 1rem;\n  padding: 0 1rem;\n}\n.tab {\n  font-size: 0.95rem;\n  font-weight: 400;\n  cursor: pointer;\n  position: relative;\n  margin: 0;\n  padding: 0rem;\n  padding-bottom: 1rem;\n  transition: color 0.3s ease;\n  user-select: none;\n  background-color: transparent;\n  border: none;\n  outline: none;\n  flex: 1 1 0%;\n  text-align: center;\n  white-space: nowrap;\n}\n.tab[data-disabled] {\n  cursor: auto;\n}\n.tab:hover {\n  opacity: 80%;\n}\n\n.tab[data-state='selected'],\n.tab[data-state='selected']:hover {\n  color: var(--blue, #1e9ff2);\n  opacity: 100%;\n}\n.active-indicator {\n  padding: 0;\n  bottom: 0px;\n  position: absolute;\n  height: 3px;\n  border-radius: 4px;\n  transition: transform 0.3s ease, width 0.3s ease;\n  background: var(--blue, #1e9ff2);\n}\n","import { Component, Element, Event, EventEmitter, Host, Prop, State, h } from '@stencil/core';\n\nexport type Tab = { id: string; label: string };\n\n@Component({\n  tag: 'ir-tabs',\n  styleUrl: 'ir-tabs.css',\n  scoped: true,\n})\nexport class IrTabs {\n  @Element() el: HTMLElement;\n\n  /**\n   * Array of tab objects containing id and label\n   * @type {Tab[]}\n   * @default []\n   */\n  @Prop() tabs: Tab[] = [];\n\n  /**\n   * ID of the tab that should be selected initially\n   * @type {string}\n   * @default undefined\n   */\n  @Prop() initialTab: string;\n\n  /**\n   * Whether the tabs are disabled\n   * @type {boolean}\n   * @default false\n   */\n  @Prop() disabled: boolean = false;\n\n  /**\n   * Aria label for the tab list\n   * @type {string}\n   * @default 'Tabs'\n   */\n  @Prop() ariaLabel: string = 'Tabs';\n\n  @State() _selectedTab: Tab;\n\n  /**\n   * Emitted when a tab is selected\n   * @event tabChanged\n   * @type {CustomEvent<Tab>}\n   */\n  @Event() tabChanged: EventEmitter<Tab>;\n\n  private activeIndicator: HTMLSpanElement;\n  private animationFrameId: number;\n\n  componentWillLoad() {\n    const tab = this.tabs?.find(t => t.id === this.initialTab);\n    if (tab) {\n      this.selectTab(tab);\n    } else if (this.tabs?.length > 0) {\n      // Select first tab if no initial tab is specified\n      this.selectTab(this.tabs[0]);\n    }\n  }\n\n  // componentDidLoad() {\n  //   this.updateActiveIndicator();\n  // }\n\n  disconnectedCallback() {\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n  }\n\n  private updateActiveIndicator() {\n    // if (this.animationFrameId) {\n    //   cancelAnimationFrame(this.animationFrameId);\n    // }\n    // this.animationFrameId = requestAnimationFrame(() => {\n    //   const selectedTab = this.el.querySelector(`button.tab[data-state=\"selected\"]`);\n    //   if (selectedTab && this.activeIndicator) {\n    //     const { left, width } = selectedTab.getBoundingClientRect();\n    //     const parentLeft = this.el.getBoundingClientRect().left;\n    //     const position = left - parentLeft;\n    //     this.activeIndicator.style.width = `${width}px`;\n    //     this.activeIndicator.style.transform = `translateX(${position}px)`;\n    //   }\n    // });\n    if (this.animationFrameId) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n    requestAnimationFrame(() => {\n      const selectedTab = this.el.querySelector(`.tab[data-state=\"selected\"]`);\n      if (selectedTab) {\n        const { left, width } = selectedTab.getBoundingClientRect();\n        const parentLeft = this.el.getBoundingClientRect().left;\n        const position = left - parentLeft - this.remSize;\n        this.activeIndicator.style.width = `${width - this.remSize}px`;\n        this.activeIndicator.style.transform = `translateX(${position}px)`;\n      }\n    });\n  }\n  private remSize = (() => {\n    const fontSize = getComputedStyle(document.documentElement).fontSize;\n    return parseFloat(fontSize);\n  })();\n  private selectTab(tab: Tab) {\n    if (this.disabled) return;\n\n    this._selectedTab = tab;\n    this.updateActiveIndicator();\n    this.tabChanged.emit(tab);\n  }\n\n  private handleKeyDown(event: KeyboardEvent, currentTab: Tab) {\n    if (this.disabled) return;\n\n    const currentIndex = this.tabs.findIndex(t => t.id === currentTab.id);\n    let nextIndex = currentIndex;\n\n    switch (event.key) {\n      case 'ArrowRight':\n        event.preventDefault();\n        nextIndex = (currentIndex + 1) % this.tabs.length;\n        break;\n      case 'ArrowLeft':\n        event.preventDefault();\n        nextIndex = currentIndex === 0 ? this.tabs.length - 1 : currentIndex - 1;\n        break;\n      case 'Home':\n        event.preventDefault();\n        nextIndex = 0;\n        break;\n      case 'End':\n        event.preventDefault();\n        nextIndex = this.tabs.length - 1;\n        break;\n      case 'Enter':\n      case ' ':\n        event.preventDefault();\n        this.selectTab(currentTab);\n        return;\n      default:\n        return;\n    }\n\n    const nextTab = this.tabs[nextIndex];\n    if (nextTab) {\n      this.selectTab(nextTab);\n      requestAnimationFrame(() => {\n        const tabButton = this.el.querySelector(`button.tab[data-tab-id=\"${nextTab.id}\"]`) as HTMLButtonElement;\n        if (tabButton) {\n          tabButton.focus();\n        }\n      });\n    }\n  }\n\n  render() {\n    return (\n      <Host role=\"tablist\" aria-label={this.ariaLabel} aria-orientation=\"horizontal\">\n        {this.tabs.map(tab => (\n          <button\n            class=\"tab\"\n            key={tab.id}\n            type=\"button\"\n            data-tab-id={tab.id}\n            role=\"tab\"\n            tabindex={this._selectedTab?.id === tab.id ? 0 : -1}\n            aria-selected={this._selectedTab?.id === tab.id ? 'true' : 'false'}\n            aria-controls={`tabpanel-${tab.id}`}\n            id={`tab-${tab.id}`}\n            disabled={this.disabled}\n            data-state={this._selectedTab?.id === tab.id ? 'selected' : undefined}\n            onClick={() => this.selectTab(tab)}\n            onKeyDown={event => this.handleKeyDown(event, tab)}\n          >\n            {tab.label}\n          </button>\n        ))}\n        <span class=\"active-indicator\" ref={el => (this.activeIndicator = el)}></span>\n      </Host>\n    );\n  }\n}\n"],"mappings":"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","ignoreList":[]}