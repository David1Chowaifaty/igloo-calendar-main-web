{"version":3,"file":"booking_listing.service--fGRlEq4.js","sources":["src/stores/booking_listing.store.ts","src/services/booking_listing.service.ts"],"sourcesContent":["import { IExposedBookingsCriteria } from '@/models/IrBookingListing';\r\nimport { Booking } from '@/models/booking.dto';\r\nimport { createStore } from '@stencil/store';\r\nimport moment from 'moment';\r\n\r\nexport interface IBookingListingStore extends IExposedBookingsCriteria {\r\n  token: string;\r\n  userSelection: IUserListingSelection;\r\n  bookings: Booking[];\r\n  download_url: string | null;\r\n  rowCount: number;\r\n}\r\nexport interface IUserListingSelection {\r\n  channel: string;\r\n  property_id: number;\r\n  filter_type: number;\r\n  from: string;\r\n  to: string;\r\n  name: string;\r\n  book_nbr: string;\r\n  booking_status: string;\r\n  affiliate_id: 0;\r\n  is_mpo_managed: false;\r\n  is_mpo_used: false;\r\n  is_for_mobile: false;\r\n  is_combined_view: false;\r\n  start_row: number;\r\n  end_row: number;\r\n  total_count: number;\r\n  is_to_export: boolean;\r\n}\r\n\r\nconst initialState: IBookingListingStore = {\r\n  channels: [],\r\n  settlement_methods: [],\r\n  statuses: [],\r\n  types: [],\r\n  token: '',\r\n  rowCount: 10,\r\n  bookings: [],\r\n  userSelection: {\r\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\r\n    to: moment().format('YYYY-MM-DD'),\r\n    channel: '',\r\n    property_id: null,\r\n    start_row: 0,\r\n    end_row: 20,\r\n    total_count: 0,\r\n    filter_type: null,\r\n    name: '',\r\n    book_nbr: '',\r\n    booking_status: '',\r\n    affiliate_id: 0,\r\n    is_mpo_managed: false,\r\n    is_mpo_used: false,\r\n    is_for_mobile: false,\r\n    is_combined_view: false,\r\n    is_to_export: false,\r\n  },\r\n  download_url: null,\r\n};\r\n\r\nexport const { state: booking_listing, onChange: onBookingListingChange } = createStore<IBookingListingStore>(initialState);\r\nexport function initializeUserSelection() {\r\n  //booking_listing.channels[0].name\r\n  booking_listing.userSelection = {\r\n    ...booking_listing.userSelection,\r\n    channel: '',\r\n    booking_status: booking_listing.statuses[0].code,\r\n    filter_type: booking_listing.types[0].id,\r\n    book_nbr: '',\r\n    name: '',\r\n    from: moment().add(-7, 'days').format('YYYY-MM-DD'),\r\n    to: moment().format('YYYY-MM-DD'),\r\n    start_row: 0,\r\n    end_row: booking_listing.rowCount,\r\n  };\r\n}\r\nexport function updateUserSelection(key: keyof IUserListingSelection, value: any) {\r\n  booking_listing.userSelection = {\r\n    ...booking_listing.userSelection,\r\n    [key]: value,\r\n  };\r\n}\r\nexport default booking_listing;\r\n","import booking_listing, { IUserListingSelection, initializeUserSelection } from '@/stores/booking_listing.store';\r\nimport { extras } from '@/utils/utils';\r\nimport axios from 'axios';\r\n\r\nexport class BookingListingService {\r\n  public async getExposedBookingsCriteria(property_id: number) {\r\n    const { data } = await axios.post(`/Get_Exposed_Bookings_Criteria`, {\r\n      property_id,\r\n    });\r\n    const result = data.My_Result;\r\n    booking_listing.channels = result.channels;\r\n    booking_listing.settlement_methods = result.settlement_methods;\r\n    booking_listing.statuses = result.statuses;\r\n    booking_listing.types = result.types;\r\n    initializeUserSelection();\r\n  }\r\n\r\n  public async getExposedBookings(params: IUserListingSelection) {\r\n    const { data } = await axios.post(`/Get_Exposed_Bookings`, { ...params, extras });\r\n    const result = data.My_Result;\r\n    const header = data.My_Params_Get_Exposed_Bookings;\r\n    booking_listing.bookings = [...result];\r\n    booking_listing.userSelection = {\r\n      ...booking_listing.userSelection,\r\n      total_count: header.total_count,\r\n    };\r\n    booking_listing.download_url = header.exported_data_url;\r\n  }\r\n  public async removeExposedBooking(booking_nbr: string, is_to_revover: boolean) {\r\n    await axios.post(`/Remove_Exposed_Booking`, {\r\n      booking_nbr,\r\n      is_to_revover,\r\n    });\r\n  }\r\n}\r\n"],"names":["moment"],"mappings":"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"}