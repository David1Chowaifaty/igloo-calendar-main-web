{"file":"ir-listing-modal.entry.js","mappings":"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","names":["moment"],"sources":["src/components/ir-booking-listing/ir-listing-modal/ir-listing-modal.css?tag=ir-listing-modal&encapsulation=scoped","src/components/ir-booking-listing/ir-listing-modal/ir-listing-modal.tsx"],"sourcesContent":[".backdropModal {\n  background-color: rgba(0, 0, 0, 0.5);\n  z-index: 1000;\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: 100vh;\n  width: 100%;\n  opacity: 0;\n  transition: opacity 0.3s ease-in-out;\n  pointer-events: none;\n}\n.backdropModal.active {\n  cursor: pointer;\n  opacity: 1 !important;\n  pointer-events: all;\n}\n\n.ir-modal[data-state='opened'] {\n  opacity: 1;\n  /* transform: translate(-50%, 0); */\n  visibility: visible; /* Make modal visible */\n  pointer-events: all; /* Restore pointer events */\n  transition: all 0.3s ease-in-out;\n}\n.ir-alert-content {\n  padding: 10px;\n  background: white;\n  border-radius: 5px;\n}\n.modal {\n  z-index: 1001 !important;\n}\n\n.modal-dialog {\n  height: 100vh;\n  display: flex;\n  align-items: center;\n}\n.ir-alert-footer {\n  gap: 10px;\n}\n.exit-icon {\n  position: absolute;\n  right: 10px;\n  top: 5px;\n  margin: 0;\n}\n.ir-modal {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 1050;\n  width: 90%;\n  max-width: 32rem;\n  overflow: hidden;\n  outline: 0;\n  opacity: 0;\n  transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;\n  visibility: hidden;\n  pointer-events: none;\n}\n\n.ir-modal.active {\n  opacity: 1;\n  transform: translate(-50%, 0);\n  visibility: visible; /* Make modal visible */\n  pointer-events: all; /* Restore pointer events */\n  transition: all 0.3s ease-in-out;\n}\n","import booking_listing from '@/stores/booking_listing.store';\nimport { Component, EventEmitter, Listen, Method, Prop, State, h, Event } from '@stencil/core';\nimport { Booking } from '@/models/booking.dto';\nimport locales from '@/stores/locales.store';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { PaymentService } from '@/services/payment.service';\nimport moment from 'moment';\nimport { IEntries } from '@/models/property';\nimport { PaymentEntries } from '@/components/ir-booking-details/types';\n\n@Component({\n  tag: 'ir-listing-modal',\n  styleUrl: 'ir-listing-modal.css',\n  scoped: true,\n})\nexport class IrListingModal {\n  @Prop() modalTitle: string = 'Modal Title';\n  @Prop() editBooking: { booking: Booking; cause: 'edit' | 'payment' | 'delete' | 'guest' };\n  @Prop() paymentEntries: PaymentEntries;\n\n  @State() isOpen: boolean = false;\n  @State() deletionStage = 2;\n  @State() selectedDesignation: IEntries;\n  @State() loadingBtn: 'confirm' | 'just_delete' | 'recover_and_delete' | null = null;\n\n  private bookingListingsService = new BookingListingService();\n  private paymentService = new PaymentService();\n\n  componentWillLoad() {\n    this.selectedDesignation = this.paymentEntries.methods[0];\n  }\n\n  @Event() modalClosed: EventEmitter<null>;\n  @Event() resetData: EventEmitter<string>;\n\n  @Method()\n  async closeModal() {\n    this.isOpen = false;\n    // this.deletionStage = 1;\n    this.selectedDesignation = this.paymentEntries.methods[0];\n    this.modalClosed.emit(null);\n  }\n  @Method()\n  async openModal() {\n    this.isOpen = true;\n  }\n  filterBookings() {\n    booking_listing.bookings = booking_listing.bookings.filter(booking => booking.booking_nbr !== this.editBooking.booking.booking_nbr);\n  }\n\n  @Listen('clickHandler')\n  async btnClickHandler(event: CustomEvent) {\n    let target = event.target as HTMLInputElement;\n    let name = target.name;\n    try {\n      if (name === 'confirm') {\n        this.loadingBtn = 'confirm';\n        if (this.editBooking.cause === 'payment') {\n          const paymentType = this.paymentEntries.types.find(pt => pt.CODE_NAME === (this.editBooking.booking.financial.due_amount < 0 ? '010' : '001'));\n          await this.paymentService.AddPayment(\n            {\n              amount: ['003', '004'].includes(this.editBooking.booking.status.code)\n                ? Math.abs(this.editBooking.booking.financial.cancelation_penality_as_if_today)\n                : this.editBooking.booking.financial.due_amount,\n              currency: this.editBooking.booking.currency,\n              date: moment().format('YYYY-MM-DD'),\n              designation: this.selectedDesignation.CODE_VALUE_EN,\n              payment_method: {\n                code: this.selectedDesignation.CODE_NAME,\n                description: this.selectedDesignation.CODE_VALUE_EN,\n                operation: this.selectedDesignation.NOTES,\n              },\n              payment_type: {\n                code: paymentType.CODE_NAME,\n                description: paymentType.CODE_VALUE_EN,\n                operation: paymentType.NOTES,\n              },\n              id: -1,\n              reference: '',\n            },\n            this.editBooking.booking.booking_nbr,\n          );\n          this.resetData.emit(this.editBooking.booking.booking_nbr);\n          // this.closeModal();\n        } else {\n          if (this.deletionStage === 2) {\n            // this.loadingBtn = 'recover_and_delete';\n            await this.bookingListingsService.removeExposedBooking(this.editBooking.booking.booking_nbr, true);\n            this.filterBookings();\n          }\n          // if (this.deletionStage === 1) {\n          //   this.deletionStage = 2;\n          // }\n        }\n      }\n      if (name === 'cancel') {\n        // if (this.deletionStage === 2) {\n        //   this.loadingBtn = 'just_delete';\n        //   await this.bookingListingsService.removeExposedBooking(this.editBooking.booking.booking_nbr, false);\n        //   this.filterBookings();\n        // } else {\n        //   this.closeModal();\n        // }\n        this.closeModal();\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      if (this.loadingBtn) {\n        this.loadingBtn = null;\n        this.closeModal();\n      }\n    }\n  }\n\n  renderTitle() {\n    if (this.editBooking.cause === 'payment') {\n      return locales.entries?.Lcz_MarkBookingAsPaid.replace('%1', this.editBooking.booking.booking_nbr);\n    } else {\n      // if (this.deletionStage === 1) {\n      //   return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\n      // }\n      // return locales.entries.Lcz_WantToRecoverAllotment;\n      return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\n    }\n  }\n  renderConfirmationTitle() {\n    // if (this.deletionStage === 2) {\n    //   return locales.entries.Lcz_RecoverAndDelete;\n    // }\n    return locales.entries.Lcz_Confirm;\n  }\n  renderCancellationTitle() {\n    // if (this.deletionStage === 2) {\n    //   return locales.entries.Lcz_JustDelete;\n    // }\n    return locales.entries.Lcz_Cancel;\n  }\n  private handleDropdownChange(e: CustomEvent<string | number>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const value = e.detail.toString();\n    console.log(value);\n\n    const payment_method = this.paymentEntries.methods.find(pt => pt.CODE_NAME === value);\n    if (!payment_method) {\n      console.warn(`Invalid payment method ${e.detail}`);\n\n      return;\n    }\n    this.selectedDesignation = payment_method;\n  }\n  render() {\n    if (!this.editBooking) {\n      return null;\n    }\n    return [\n      <div\n        class={`backdropModal ${this.isOpen ? 'active' : ''}`}\n        onClick={() => {\n          if (this.editBooking.cause === 'delete') {\n            return;\n          }\n          this.closeModal();\n        }}\n      ></div>,\n      <div data-state={this.isOpen ? 'opened' : 'closed'} class={`ir-modal`} tabindex=\"-1\">\n        {this.isOpen && (\n          <div class={`ir-alert-content p-2`}>\n            <div class={`ir-alert-header align-items-center border-0 py-0 m-0 `}>\n              <p class=\"p-0 my-0 mb-1\">{this.renderTitle()}</p>\n              <ir-icon\n                class=\"exit-icon\"\n                style={{ cursor: 'pointer' }}\n                onClick={() => {\n                  this.closeModal();\n                }}\n              >\n                <svg slot=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" height=\"14\" width=\"10.5\" viewBox=\"0 0 384 512\">\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"\n                  />\n                </svg>\n              </ir-icon>\n            </div>\n            <div class=\"modal-body text-left p-0 mb-2\">\n              {this.editBooking.cause === 'payment' ? (\n                <ir-select\n                  selectedValue={this.selectedDesignation?.CODE_NAME}\n                  onSelectChange={this.handleDropdownChange.bind(this)}\n                  showFirstOption={false}\n                  data={this.paymentEntries.methods?.map(m => ({\n                    value: m.CODE_NAME,\n                    text: m.CODE_VALUE_EN,\n                  }))}\n                ></ir-select>\n              ) : null}\n            </div>\n\n            <div class={`ir-alert-footer border-0 d-flex justify-content-end`}>\n              <ir-button isLoading={this.loadingBtn === 'just_delete'} btn_color={'secondary'} btn_block text={this.renderCancellationTitle()} name={'cancel'}></ir-button>\n              <ir-button\n                isLoading={this.loadingBtn === 'confirm'}\n                // isLoading={this.loadingBtn === 'recover_and_delete'}\n                btn_color={'primary'}\n                btn_block\n                text={this.renderConfirmationTitle()}\n                name={'confirm'}\n              ></ir-button>\n            </div>\n          </div>\n        )}\n      </div>,\n    ];\n  }\n}\n"],"version":3}