{"version":3,"file":"ir-departures-table.js","sourceRoot":"","sources":["../../../../src/components/ir-departures/ir-departures-table/ir-departures-table.tsx"],"names":[],"mappings":"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","sourcesContent":["import type { PaginationChangeEvent } from '@/components/ir-pagination/ir-pagination';\nimport { Booking } from '@/models/booking.dto';\nimport { departuresStore } from '@/stores/departures.store';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Host, h } from '@stencil/core';\nimport moment from 'moment';\nexport type CheckoutRoomEvent = {\n  booking: Booking;\n  identifier: string;\n};\n@Component({\n  tag: 'ir-departures-table',\n  styleUrls: ['ir-departures-table.css', '../../../common/table.css'],\n  scoped: true,\n})\nexport class IrDeparturesTable {\n  @Event() checkoutRoom: EventEmitter<CheckoutRoomEvent>;\n  @Event() requestPageChange: EventEmitter<PaginationChangeEvent>;\n  @Event() requestPageSizeChange: EventEmitter<PaginationChangeEvent>;\n\n  private renderSection({ bookings, showAction = false, isFuture = false }: { bookings: Booking[]; showAction?: boolean; isFuture?: boolean }) {\n    if (!bookings?.length) {\n      return null;\n    }\n\n    const rows = bookings.flatMap(booking => this.renderBookingRows({ booking, showAction, isFuture }));\n    return [...rows];\n  }\n\n  private renderBookingRows({ booking, isFuture, showAction }: { booking: Booking; showAction?: boolean; isFuture?: boolean }) {\n    return (booking.rooms ?? []).map((room, index) => this.renderRow(booking, room, index, showAction, isFuture));\n  }\n\n  private compareGuests(booking: Booking, room: Booking['rooms'][number]): boolean {\n    const roomGuest = room?.guest;\n    const bookingGuest = booking?.guest;\n\n    if (!roomGuest || !bookingGuest) {\n      return false;\n    }\n\n    const normalize = (value?: string) => value?.trim().toLowerCase() ?? '';\n\n    return normalize(roomGuest.first_name) === normalize(bookingGuest.first_name) && normalize(roomGuest.last_name) === normalize(bookingGuest.last_name);\n  }\n  private renderRow(booking: Booking, room: Booking['rooms'][number], index: number, showAction: boolean, isFuture) {\n    const rowKey = `${booking.booking_nbr}-${room?.identifier ?? index}`;\n    const isOverdueCheckout = moment(room.to_date, 'YYYY-MM-DD').startOf('day').isBefore(moment().startOf('day'));\n    return (\n      <tr class=\"ir-table-row\" key={rowKey}>\n        <td class=\"sticky-column\">\n          <ir-booking-number-cell\n            origin={booking.origin}\n            channelBookingNumber={booking.channel_booking_nbr}\n            source={booking.source}\n            bookingNumber={booking.booking_nbr}\n          ></ir-booking-number-cell>\n        </td>\n        <td>\n          <ir-booked-by-cell guest={booking.guest}></ir-booked-by-cell>\n          {!this.compareGuests(booking, room) && <ir-guest-name-cell name={room.guest}></ir-guest-name-cell>}\n        </td>\n        {/* <td>\n        </td> */}\n        <td>\n          <ir-unit-cell room={room}></ir-unit-cell>\n        </td>\n        <td>\n          <ir-dates-cell overdueCheckout={isOverdueCheckout} checkIn={room.from_date} checkOut={room.to_date}></ir-dates-cell>\n        </td>\n        <td class=\"text-right\">\n          <ir-balance-cell\n            bookingNumber={booking.booking_nbr}\n            isDirect={booking.is_direct}\n            statusCode={booking.status.code}\n            currencySymbol={booking.currency.symbol}\n            financial={booking.financial}\n            removeBalance\n          ></ir-balance-cell>\n        </td>\n        <td>\n          <div class=\"departures-table__actions-cell\">\n            {showAction ? (\n              <ir-actions-cell\n                onIrAction={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  this.checkoutRoom.emit({\n                    booking: booking,\n                    identifier: room.identifier,\n                  });\n                }}\n                buttons={isOverdueCheckout ? ['overdue_check_out'] : ['check_out']}\n              ></ir-actions-cell>\n            ) : isFuture ? (\n              ''\n            ) : (\n              'In-house'\n            )}\n          </div>\n        </td>\n      </tr>\n    );\n  }\n\n  private handlePageChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.requestPageChange.emit(event.detail);\n  }\n\n  private handlePageSizeChange(event: CustomEvent<PaginationChangeEvent>) {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.requestPageSizeChange.emit(event.detail);\n  }\n\n  render() {\n    const { needsCheckOutBookings, futureRooms, outBookings, pagination } = departuresStore;\n    return (\n      <Host>\n        <div class=\"table--container\">\n          <table class=\"table data-table\">\n            <thead>\n              <tr>\n                <th>\n                  <span class={'departures-table__departure__cell'}>Booking#</span>\n                </th>\n                <th>\n                  <div>\n                    <p>Booked by /</p>\n                    <p>Guest name</p>\n                  </div>\n                </th>\n                {/* <th></th> */}\n                <th>Unit</th>\n                <th>Dates</th>\n                <th class=\"text-center\">Balance</th>\n                <th></th>\n              </tr>\n            </thead>\n            <tbody>\n              {this.renderSection({ bookings: futureRooms, isFuture: true })}\n              {this.renderSection({ bookings: needsCheckOutBookings, showAction: true })}\n              {this.renderSection({ bookings: outBookings })}\n              {!needsCheckOutBookings.length && !outBookings.length && (\n                <tr>\n                  <td colSpan={6} class=\"empty-row\">\n                    <ir-empty-state></ir-empty-state>\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n        {(needsCheckOutBookings.length > 0 || outBookings.length > 0 || futureRooms.length > 0) && (\n          <ir-pagination\n            class=\"data-table--pagination\"\n            showing={pagination.showing}\n            total={pagination.total}\n            pages={pagination.totalPages}\n            pageSize={pagination.pageSize}\n            currentPage={pagination.currentPage}\n            allowPageSizeChange={false}\n            pageSizes={[pagination.pageSize]}\n            recordLabel={locales.entries?.Lcz_Bookings ?? 'Bookings'}\n            onPageChange={event => this.handlePageChange(event as CustomEvent<PaginationChangeEvent>)}\n            onPageSizeChange={event => this.handlePageSizeChange(event as CustomEvent<PaginationChangeEvent>)}\n          ></ir-pagination>\n        )}\n      </Host>\n    );\n  }\n}\n"]}