{"version":3,"file":"ir-departures.js","sourceRoot":"","sources":["../../../src/components/ir-departures/ir-departures.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { departuresStore } from '@/stores/departures.store';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { Payment, PaymentEntries } from '../ir-booking-details/types';\nimport { RoomService } from '@/services/room.service';\nimport { BookingService } from '@/services/booking-service/booking.service';\n\n@Component({\n  tag: 'ir-departures',\n  styleUrls: ['../../assets/webawesome/component/host.css', 'ir-departures.css'],\n  scoped: true,\n})\nexport class IrDepartures {\n  @Prop() ticket: string;\n  @Prop() propertyid: number;\n  @Prop() language: string = 'en';\n  @Prop() p: string;\n\n  @State() bookingNumber: number;\n  @State() booking: Booking;\n  @State() paymentEntries: PaymentEntries;\n  @State() isPageLoading: boolean;\n  @State() payment: Payment;\n\n  private tokenService = new Token();\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n\n  private paymentFolioRef: HTMLIrPaymentFolioElement;\n\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  @Listen('openBookingDetails')\n  handleOpen(e: CustomEvent) {\n    this.bookingNumber = e.detail;\n  }\n\n  @Listen('payBookingBalance')\n  handleBookingPayment(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { booking_nbr, payment } = e.detail;\n    this.booking = departuresStore.bookings.find(b => b.booking_nbr === booking_nbr);\n    const paymentType = this.paymentEntries.types.find(p => p.CODE_NAME === payment.payment_type.code);\n    this.payment = {\n      ...payment,\n      payment_type: {\n        code: paymentType.CODE_NAME,\n        description: paymentType.CODE_VALUE_EN,\n        operation: paymentType.NOTES,\n      },\n    };\n    this.paymentFolioRef.openFolio();\n  }\n\n  private async init() {\n    try {\n      this.isPageLoading = true;\n      const [_, __, setupEntries] = await Promise.all([\n        this.roomService.getExposedProperty({ id: this.propertyid || 0, language: this.language, aname: this.p }),\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getSetupEntriesByTableNameMulti(['_BED_PREFERENCE_TYPE', '_DEPARTURE_TIME', '_PAY_TYPE', '_PAY_TYPE_GROUP', '_PAY_METHOD']),\n      ]);\n\n      const { pay_type, pay_type_group, pay_method } = this.bookingService.groupEntryTablesResult(setupEntries);\n\n      this.paymentEntries = { types: pay_type, groups: pay_type_group, methods: pay_method };\n    } catch (error) {\n    } finally {\n      this.isPageLoading = false;\n    }\n  }\n\n  render() {\n    if (this.isPageLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast style={{ display: 'none' }}></ir-toast>\n        <ir-interceptor style={{ display: 'none' }}></ir-interceptor>\n        <h3 class=\"page-title\">Departures</h3>\n        <ir-departures-filter></ir-departures-filter>\n        <ir-departures-table></ir-departures-table>\n        <ir-drawer\n          onDrawerHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.bookingNumber = null;\n          }}\n          withoutHeader\n          open={!!this.bookingNumber}\n          style={{\n            '--ir-drawer-width': '80rem',\n            '--ir-drawer-background-color': '#F2F3F8',\n            '--ir-drawer-padding-left': '0',\n            '--ir-drawer-padding-right': '0',\n            '--ir-drawer-padding-top': '0',\n            '--ir-drawer-padding-bottom': '0',\n          }}\n        >\n          {this.bookingNumber && (\n            <ir-booking-details\n              hasPrint\n              hasReceipt\n              hasCloseButton\n              onCloseSidebar={() => (this.bookingNumber = null)}\n              is_from_front_desk\n              propertyid={this.propertyid as any}\n              hasRoomEdit\n              hasRoomDelete\n              bookingNumber={this.bookingNumber.toString()}\n              ticket={this.ticket}\n              language={this.language}\n              hasRoomAdd\n            ></ir-booking-details>\n          )}\n        </ir-drawer>\n        <ir-payment-folio\n          style={{ height: 'auto' }}\n          bookingNumber={this.booking?.booking_nbr}\n          paymentEntries={this.paymentEntries}\n          payment={this.payment}\n          mode={'payment-action'}\n          ref={el => (this.paymentFolioRef = el)}\n          onCloseModal={() => {\n            this.booking = null;\n            this.payment = null;\n          }}\n        ></ir-payment-folio>\n      </Host>\n    );\n  }\n}\n"]}