{"version":3,"file":"ir-otp-modal.js","sourceRoot":"","sources":["../../../src/components/ir-otp-modal/ir-otp-modal.tsx"],"names":[],"mappings":"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","sourcesContent":["import { SystemService } from '@/services/system.service';\nimport { Component, Event, EventEmitter, Host, Method, Prop, State, h } from '@stencil/core';\n\n@Component({\n  tag: 'ir-otp-modal',\n  styleUrl: 'ir-otp-modal.css',\n  scoped: false,\n})\nexport class IrOtpModal {\n  @Prop() resendTimer = 60;\n  @Prop() requestUrl: string;\n  @Prop() showResend: boolean = true;\n  @State() otp = '';\n  @State() error = '';\n  @State() isLoading = false;\n  @State() timer = 60;\n\n  private modalRef!: HTMLDivElement;\n  private timerInterval: number;\n  private systemService = new SystemService();\n\n  /** Emits the final OTP (or empty on cancel) */\n  @Event({ bubbles: true, composed: true }) otpFinished: EventEmitter<string>;\n\n  /** Open & reset everything */\n  @Method()\n  async openModal() {\n    this.resetState();\n    $(this.modalRef).modal({ backdrop: 'static', keyboard: false });\n    $(this.modalRef).modal('show');\n    if (this.showResend) this.startTimer();\n    await this.focusFirstInput();\n  }\n\n  /** Hide & clear timer */\n  @Method()\n  async closeModal() {\n    $(this.modalRef).modal('hide');\n    this.clearTimer();\n  }\n\n  private resetState() {\n    this.otp = '';\n    this.error = '';\n    this.isLoading = false;\n    this.timer = 60;\n    this.clearTimer();\n  }\n\n  private startTimer() {\n    this.clearTimer();\n    this.timerInterval = window.setInterval(() => {\n      if (this.timer > 0) {\n        this.timer--;\n      } else {\n        this.clearTimer();\n      }\n    }, 1000);\n  }\n\n  private clearTimer() {\n    if (this.timerInterval) {\n      clearInterval(this.timerInterval);\n      this.timerInterval = null;\n    }\n  }\n\n  private async focusFirstInput() {\n    await new Promise(r => setTimeout(r, 50));\n    const first = this.modalRef.querySelector('input');\n    first && (first as HTMLInputElement).focus();\n  }\n\n  /** Called by your <ir-otp> child whenever the 6-digit value changes/pastes */\n  private handleOtpComplete = (e: CustomEvent<string>) => {\n    this.error = '';\n    this.otp = e.detail;\n    if (this.otp.length === 6) {\n      // auto-submit\n      this.verifyOtp();\n    }\n  };\n\n  private async verifyOtp() {\n    if (this.otp.length < 6) return;\n\n    this.isLoading = true;\n    try {\n      await this.systemService.validateOTP({ METHOD_NAME: this.requestUrl, OTP: this.otp });\n      // emit the filled OTP back to the interceptor\n      this.otpFinished.emit(this.otp);\n      this.closeModal();\n    } catch (err) {\n      this.error = 'Verification failed. Please try again.';\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  /** Allow the user to request a new OTP */\n  private async resendOtp() {\n    if (this.timer > 0) return;\n    // you’d trigger your API here; then:\n    this.timer = 60;\n    this.startTimer();\n  }\n\n  private onCancel = () => {\n    this.otpFinished.emit('');\n    this.closeModal();\n  };\n\n  render() {\n    return (\n      <Host>\n        <div ref={el => (this.modalRef = el as any)} class=\"modal fade\" id=\"staticBackdrop\" aria-hidden=\"true\">\n          <div class=\"modal-dialog modal-dialog-centered\">\n            <div class=\"modal-content\">\n              <div class=\"modal-header\">\n                <h5 class=\"modal-title\">Verify Code</h5>\n                <button type=\"button\" class=\"close\" onClick={this.onCancel}>\n                  <span aria-hidden=\"true\">&times;</span>\n                </button>\n              </div>\n\n              <div class=\"modal-body d-flex  flex-column\">\n                <p>Please enter the 6-digit code we just sent you.</p>\n                <ir-otp\n                  autoFocus\n                  // value={this.otp}\n                  onOtpComplete={this.handleOtpComplete}\n                ></ir-otp>\n\n                {this.error && <p class=\"text-danger small mt-2\">{this.error}</p>}\n\n                {this.showResend && (\n                  <p class=\"small mt-1\">\n                    {this.timer > 0 ? (\n                      `Resend code in 00:${String(this.timer).padStart(2, '0')}`\n                    ) : (\n                      <a\n                        href=\"#\"\n                        onClick={e => {\n                          e.preventDefault();\n                          this.resendOtp();\n                        }}\n                      >\n                        Didn’t receive code? Resend\n                      </a>\n                    )}\n                  </p>\n                )}\n              </div>\n\n              <div class=\"modal-footer\">\n                <ir-button text=\"Cancel\" btn_color=\"secondary\" onClick={this.onCancel} btn_disabled={this.isLoading}></ir-button>\n                <ir-button text=\"Verify\" isLoading={this.isLoading} btn_disabled={this.otp.length < 6 || this.isLoading} onClick={() => this.verifyOtp()}></ir-button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}