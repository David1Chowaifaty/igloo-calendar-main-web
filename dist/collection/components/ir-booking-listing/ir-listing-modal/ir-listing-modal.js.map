{"version":3,"file":"ir-listing-modal.js","sourceRoot":"","sources":["../../../../src/components/ir-booking-listing/ir-listing-modal/ir-listing-modal.tsx"],"names":[],"mappings":"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","sourcesContent":["import booking_listing from '@/stores/booking_listing.store';\nimport { Component, EventEmitter, Listen, Method, Prop, State, h, Event } from '@stencil/core';\nimport { Booking } from '@/models/booking.dto';\nimport locales from '@/stores/locales.store';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { PaymentService } from '@/services/payment.service';\nimport moment from 'moment';\n\n@Component({\n  tag: 'ir-listing-modal',\n  styleUrl: 'ir-listing-modal.css',\n  scoped: true,\n})\nexport class IrListingModal {\n  @Prop() modalTitle: string = 'Modal Title';\n  @Prop() editBooking: { booking: Booking; cause: 'edit' | 'payment' | 'delete' };\n\n  @State() isOpen: boolean = false;\n  @State() deletionStage = 1;\n  @State() selectedDesignation: string;\n\n  private bookingListingsService = new BookingListingService();\n  private paymentService = new PaymentService();\n\n  componentWillLoad() {\n    this.bookingListingsService.setToken(booking_listing.token);\n    this.paymentService.setToken(booking_listing.token);\n    this.selectedDesignation = booking_listing.settlement_methods[0].name;\n  }\n\n  @Event() modalClosed: EventEmitter<null>;\n  @Event() resetData: EventEmitter<null>;\n  @Method()\n  async closeModal() {\n    this.isOpen = false;\n    this.deletionStage = 1;\n    this.selectedDesignation = booking_listing.settlement_methods[0].name;\n    this.modalClosed.emit(null);\n  }\n  @Method()\n  async openModal() {\n    this.isOpen = true;\n  }\n\n  @Listen('clickHanlder')\n  async btnClickHandler(event: CustomEvent) {\n    let target = event.target as HTMLInputElement;\n    let name = target.name;\n    try {\n      if (name === 'confirm') {\n        if (this.editBooking.cause === 'payment') {\n          await this.paymentService.AddPayment(\n            {\n              amount: this.editBooking.booking.financial.due_amount,\n              currency: this.editBooking.booking.currency,\n              date: moment().format('YYYY-MM-DD'),\n              designation: this.selectedDesignation,\n              id: -1,\n              reference: '',\n            },\n            this.editBooking.booking.booking_nbr,\n          );\n          this.resetData.emit(null);\n          this.closeModal();\n        } else {\n          if (this.deletionStage === 1) {\n            this.deletionStage = 2;\n          }\n        }\n      }\n    } catch (error) {\n      console.error(error);\n    }\n    if (name === 'cancel') {\n      if (this.deletionStage === 2) {\n        return;\n      }\n      this.closeModal();\n    }\n  }\n\n  renderTitle() {\n    if (this.editBooking.cause === 'payment') {\n      return locales.entries?.Lcz_MarkBookingAsPaid.replace('%1', this.editBooking.booking.booking_nbr);\n    } else {\n      if (this.deletionStage === 1) {\n        return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\n      }\n      return locales.entries.Lcz_WantToRecoverAllotment;\n    }\n  }\n  renderConfirmationTitle() {\n    if (this.editBooking.cause === 'payment') {\n      return locales.entries.Lcz_Confirm;\n    } else {\n      if (this.deletionStage === 1) {\n        return locales.entries.Lcz_OK;\n      }\n      return locales.entries.Lcz_RecoverAndDelete;\n    }\n  }\n  renderCancelationTitle() {\n    if (this.deletionStage === 2) {\n      return locales.entries.Lcz_JustDelete;\n    }\n    return locales.entries.Lcz_Cancel;\n  }\n  render() {\n    if (!this.editBooking) {\n      return null;\n    }\n    return [\n      <div\n        class={`backdropModal ${this.isOpen ? 'active' : ''}`}\n        onClick={() => {\n          if (this.editBooking.cause === 'delete') {\n            return;\n          }\n          this.closeModal();\n        }}\n      ></div>,\n      <div data-state={this.isOpen ? 'opened' : 'closed'} class={`ir-modal`} tabindex=\"-1\">\n        <div class={`ir-alert-content p-2`}>\n          <div class={`ir-alert-header align-items-center border-0 py-0 m-0 `}>\n            <p class=\"font-weight-bold p-0 my-0 mb-1\">{this.renderTitle()}</p>\n            <ir-icon\n              class=\"exit-icon\"\n              style={{ cursor: 'pointer' }}\n              onClick={() => {\n                this.closeModal();\n              }}\n            >\n              <svg slot=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" height=\"14\" width=\"10.5\" viewBox=\"0 0 384 512\">\n                <path\n                  fill=\"currentColor\"\n                  d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"\n                />\n              </svg>\n            </ir-icon>\n          </div>\n          <div class=\"modal-body text-left p-0 mb-2\">\n            {this.editBooking.cause === 'payment' ? (\n              <ir-select\n                selectedValue={this.selectedDesignation}\n                onSelectChange={e => (this.selectedDesignation = e.detail)}\n                showFirstOption={false}\n                LabelAvailable={false}\n                data={booking_listing.settlement_methods.map(m => ({\n                  value: m.name,\n                  text: m.name,\n                }))}\n              ></ir-select>\n            ) : null}\n          </div>\n\n          <div class={`ir-alert-footer border-0 d-flex justify-content-end`}>\n            <ir-button icon={''} btn_color={'secondary'} btn_block text={this.renderCancelationTitle()} name={'cancel'}></ir-button>\n            <ir-button icon={''} btn_color={'primary'} btn_block text={this.renderConfirmationTitle()} name={'confirm'}></ir-button>\n          </div>\n        </div>\n      </div>,\n    ];\n  }\n}\n"]}