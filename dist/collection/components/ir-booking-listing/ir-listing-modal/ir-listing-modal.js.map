{"version":3,"file":"ir-listing-modal.js","sourceRoot":"","sources":["../../../../src/components/ir-booking-listing/ir-listing-modal/ir-listing-modal.tsx"],"names":[],"mappings":"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","sourcesContent":["import booking_listing from '@/stores/booking_listing.store';\nimport { Component, EventEmitter, Listen, Method, Prop, State, h, Event } from '@stencil/core';\nimport { Booking } from '@/models/booking.dto';\nimport locales from '@/stores/locales.store';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { PaymentService } from '@/services/payment.service';\nimport moment from 'moment';\nimport { IEntries } from '@/models/property';\nimport { PaymentEntries } from '@/components/ir-booking-details/types';\n\n@Component({\n  tag: 'ir-listing-modal',\n  styleUrl: 'ir-listing-modal.css',\n  scoped: true,\n})\nexport class IrListingModal {\n  @Prop() modalTitle: string = 'Modal Title';\n  @Prop() editBooking: { booking: Booking; cause: 'edit' | 'payment' | 'delete' | 'guest' };\n  @Prop() paymentEntries: PaymentEntries;\n\n  @State() isOpen: boolean = false;\n  @State() deletionStage = 2;\n  @State() selectedDesignation: IEntries;\n  @State() loadingBtn: 'confirm' | 'just_delete' | 'recover_and_delete' | null = null;\n\n  private bookingListingsService = new BookingListingService();\n  private paymentService = new PaymentService();\n\n  componentWillLoad() {\n    this.selectedDesignation = this.paymentEntries.methods[0];\n  }\n\n  @Event() modalClosed: EventEmitter<null>;\n  @Event() resetData: EventEmitter<string>;\n\n  @Method()\n  async closeModal() {\n    this.isOpen = false;\n    // this.deletionStage = 1;\n    this.selectedDesignation = this.paymentEntries.methods[0];\n    this.modalClosed.emit(null);\n  }\n  @Method()\n  async openModal() {\n    this.isOpen = true;\n  }\n  filterBookings() {\n    booking_listing.bookings = booking_listing.bookings.filter(booking => booking.booking_nbr !== this.editBooking.booking.booking_nbr);\n  }\n\n  @Listen('clickHandler')\n  async btnClickHandler(event: CustomEvent) {\n    let target = event.target as HTMLInputElement;\n    let name = target.name;\n    try {\n      if (name === 'confirm') {\n        this.loadingBtn = 'confirm';\n        if (this.editBooking.cause === 'payment') {\n          const paymentType = this.paymentEntries.types.find(pt => pt.CODE_NAME === (this.editBooking.booking.financial.due_amount < 0 ? '010' : '001'));\n          await this.paymentService.AddPayment(\n            {\n              amount:\n                this.editBooking.booking.status.code === '003'\n                  ? Math.abs(this.editBooking.booking.financial.cancelation_penality_as_if_today)\n                  : this.editBooking.booking.financial.due_amount,\n              currency: this.editBooking.booking.currency,\n              date: moment().format('YYYY-MM-DD'),\n              designation: this.selectedDesignation.CODE_VALUE_EN,\n              payment_method: {\n                code: this.selectedDesignation.CODE_NAME,\n                description: this.selectedDesignation.CODE_VALUE_EN,\n                operation: this.selectedDesignation.NOTES,\n              },\n              payment_type: {\n                code: paymentType.CODE_NAME,\n                description: paymentType.CODE_VALUE_EN,\n                operation: paymentType.NOTES,\n              },\n              id: -1,\n              reference: '',\n            },\n            this.editBooking.booking.booking_nbr,\n          );\n          this.resetData.emit(this.editBooking.booking.booking_nbr);\n          // this.closeModal();\n        } else {\n          if (this.deletionStage === 2) {\n            // this.loadingBtn = 'recover_and_delete';\n            await this.bookingListingsService.removeExposedBooking(this.editBooking.booking.booking_nbr, true);\n            this.filterBookings();\n          }\n          // if (this.deletionStage === 1) {\n          //   this.deletionStage = 2;\n          // }\n        }\n      }\n      if (name === 'cancel') {\n        // if (this.deletionStage === 2) {\n        //   this.loadingBtn = 'just_delete';\n        //   await this.bookingListingsService.removeExposedBooking(this.editBooking.booking.booking_nbr, false);\n        //   this.filterBookings();\n        // } else {\n        //   this.closeModal();\n        // }\n        this.closeModal();\n      }\n    } catch (error) {\n      console.error(error);\n    } finally {\n      if (this.loadingBtn) {\n        this.loadingBtn = null;\n        this.closeModal();\n      }\n    }\n  }\n\n  renderTitle() {\n    if (this.editBooking.cause === 'payment') {\n      return locales.entries?.Lcz_MarkBookingAsPaid.replace('%1', this.editBooking.booking.booking_nbr);\n    } else {\n      // if (this.deletionStage === 1) {\n      //   return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\n      // }\n      // return locales.entries.Lcz_WantToRecoverAllotment;\n      return locales.entries.Lcz_SureYouWantToDeleteBookingNbr + this.editBooking?.booking.booking_nbr;\n    }\n  }\n  renderConfirmationTitle() {\n    // if (this.deletionStage === 2) {\n    //   return locales.entries.Lcz_RecoverAndDelete;\n    // }\n    return locales.entries.Lcz_Confirm;\n  }\n  renderCancellationTitle() {\n    // if (this.deletionStage === 2) {\n    //   return locales.entries.Lcz_JustDelete;\n    // }\n    return locales.entries.Lcz_Cancel;\n  }\n  private handleDropdownChange(e: CustomEvent<string | number>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const value = e.detail.toString();\n    console.log(value);\n\n    const payment_method = this.paymentEntries.methods.find(pt => pt.CODE_NAME === value);\n    if (!payment_method) {\n      console.warn(`Invalid payment method ${e.detail}`);\n\n      return;\n    }\n    this.selectedDesignation = payment_method;\n  }\n  render() {\n    if (!this.editBooking) {\n      return null;\n    }\n    return [\n      <div\n        class={`backdropModal ${this.isOpen ? 'active' : ''}`}\n        onClick={() => {\n          if (this.editBooking.cause === 'delete') {\n            return;\n          }\n          this.closeModal();\n        }}\n      ></div>,\n      <div data-state={this.isOpen ? 'opened' : 'closed'} class={`ir-modal`} tabindex=\"-1\">\n        {this.isOpen && (\n          <div class={`ir-alert-content p-2`}>\n            <div class={`ir-alert-header align-items-center border-0 py-0 m-0 `}>\n              <p class=\"p-0 my-0 mb-1\">{this.renderTitle()}</p>\n              <ir-icon\n                class=\"exit-icon\"\n                style={{ cursor: 'pointer' }}\n                onClick={() => {\n                  this.closeModal();\n                }}\n              >\n                <svg slot=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" height=\"14\" width=\"10.5\" viewBox=\"0 0 384 512\">\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\"\n                  />\n                </svg>\n              </ir-icon>\n            </div>\n            <div class=\"modal-body text-left p-0 mb-2\">\n              {this.editBooking.cause === 'payment' ? (\n                <ir-select\n                  selectedValue={this.selectedDesignation?.CODE_NAME}\n                  onSelectChange={this.handleDropdownChange.bind(this)}\n                  showFirstOption={false}\n                  data={this.paymentEntries.methods?.map(m => ({\n                    value: m.CODE_NAME,\n                    text: m.CODE_VALUE_EN,\n                  }))}\n                ></ir-select>\n              ) : null}\n            </div>\n\n            <div class={`ir-alert-footer border-0 d-flex justify-content-end`}>\n              <ir-button isLoading={this.loadingBtn === 'just_delete'} btn_color={'secondary'} btn_block text={this.renderCancellationTitle()} name={'cancel'}></ir-button>\n              <ir-button\n                isLoading={this.loadingBtn === 'confirm'}\n                // isLoading={this.loadingBtn === 'recover_and_delete'}\n                btn_color={'primary'}\n                btn_block\n                text={this.renderConfirmationTitle()}\n                name={'confirm'}\n              ></ir-button>\n            </div>\n          </div>\n        )}\n      </div>,\n    ];\n  }\n}\n"]}