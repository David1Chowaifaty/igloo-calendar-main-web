{"version":3,"file":"ir-print-room.js","sourceRoot":"","sources":["../../../../src/components/printing/ir-print-room/ir-print-room.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Booking, Property } from '@/models/booking.dto';\nimport { formatAmount } from '@/utils/utils';\nimport { Component, Prop, h } from '@stencil/core';\nimport moment from 'moment';\n\n@Component({\n  tag: 'ir-print-room',\n  styleUrl: 'ir-print-room.css',\n  shadow: true,\n})\nexport class IrPrintRoom {\n  /** Room data */\n  @Prop() room: Booking['rooms'][0];\n\n  /** Booking context */\n  @Prop() booking: Booking;\n\n  /** Property context */\n  @Prop() property: Property;\n\n  /** Currency code (e.g. USD, EUR) */\n  @Prop() currency: string;\n\n  /** Room index */\n  @Prop() idx: number;\n\n  private getSmokingLabel() {\n    const { booking, room, property } = this;\n\n    if (booking?.is_direct) {\n      if (!room?.smoking_option) return null;\n\n      const currRT = property?.roomtypes?.find(rt => rt.id === room?.roomtype?.id);\n\n      const smokingOptions = currRT?.smoking_option?.allowed_smoking_options;\n\n      return smokingOptions?.find(s => s.code === room.smoking_option)?.description ?? null;\n    }\n\n    return room?.ota_meta?.smoking_preferences ?? null;\n  }\n\n  private formatDate(date: string | Date) {\n    const m = moment(date, 'YYYY-MM-DD');\n\n    const dayMonth = m.format('DD/MM');\n    let dayOfWeekAbbr = m.format('ddd'); // Mon, Tue, Wed, Thu, Fri, Sat, Sun\n\n    if (['Thu', 'Sun', 'Sat'].includes(dayOfWeekAbbr)) {\n      dayOfWeekAbbr = dayOfWeekAbbr.slice(0, 2);\n    } else {\n      dayOfWeekAbbr = dayOfWeekAbbr.charAt(0);\n    }\n\n    return `${dayMonth} ${dayOfWeekAbbr}`;\n  }\n  private formatGuestName({ first_name, last_name }) {\n    if (!last_name) {\n      return first_name;\n    }\n    return `${first_name} ${last_name}`;\n  }\n  private formatGuestAvailability({ adult_nbr, children_nbr, infant_nbr }) {\n    // Adjust child number based on infants\n    const adultCount = adult_nbr > 0 ? adult_nbr : 0;\n    const childCount = children_nbr > 0 ? children_nbr : 0;\n    const infantCount = infant_nbr > 0 ? infant_nbr : 0;\n\n    // Define labels based on singular/plural rules\n    const adultLabel = adultCount > 1 ? 'adults' : 'adult';\n    const childLabel = childCount > 1 ? 'children' : 'child';\n    const infantLabel = infantCount > 1 ? 'infants' : 'infant';\n\n    // Construct parts with the updated child number\n    const parts = [];\n    if (adultCount > 0) {\n      parts.push(`${adultCount} ${adultLabel}`);\n    }\n    if (childCount > 0) {\n      parts.push(`${childCount} ${childLabel}`);\n    }\n    if (infantCount > 0) {\n      parts.push(`${infantCount} ${infantLabel}`);\n    }\n    return parts.join('&nbsp&nbsp&nbsp&nbsp');\n  }\n  private formatBookingDates(date: string) {\n    return moment(date, 'YYYY-MM-DD').format('DD-MMM-YYYY');\n  }\n  private renderTaxSection() {\n    // OTA booking taxes\n    if (!this.booking?.is_direct) {\n      const filteredData = this.room.ota_taxes.filter(tx => tx.amount > 0);\n\n      return filteredData.map((d, index) => (\n        <div key={`room_${d.name}_${index}`} class=\"ir-print-room__tax-row\">\n          <p class=\"ir-print-room__tax-label\">\n            {d.is_exlusive ? 'Excluding' : 'Including'} {d.name}\n          </p>\n          <p class=\"ir-print-room__tax-amount\">\n            {d.currency.symbol}\n            {d.amount}\n          </p>\n        </div>\n      ));\n    }\n\n    // Direct booking taxes\n    const filteredData = this.property?.taxes?.filter(tx => tx.pct > 0);\n\n    return filteredData?.map((d, index) => {\n      const amount = (this.room.total * d.pct) / 100;\n\n      return (\n        <div key={`direct_room_${d.name}_${index}`} class=\"ir-print-room__tax-row\">\n          <p class=\"ir-print-room__tax-label\">\n            {d.is_exlusive ? 'Excluding' : 'Including'} {d.name}\n          </p>\n          <p class=\"ir-print-room__tax-amount\">\n            {d.pct}%: {formatAmount(this.currency, amount)}\n          </p>\n        </div>\n      );\n    });\n  }\n  render() {\n    const { room, booking, property, currency, idx } = this;\n\n    const haveMultipleRooms = property.roomtypes?.find(rt => rt.id === room?.roomtype?.id)?.physicalrooms?.length > 1;\n\n    return (\n      <section class=\"ir-print-room\">\n        {/* Header */}\n        <header class=\"ir-print-room__header\">\n          <p class=\"ir-print-room__room-type\">{room?.roomtype?.name}</p>\n\n          {haveMultipleRooms && room?.unit && <p class=\"ir-print-room__unit\">(unit {room.roomtype.id})</p>}\n\n          <p class=\"ir-print-room__rate-plan\">{room?.rateplan?.short_name || room?.rateplan?.name}</p>\n        </header>\n\n        {/* Main content */}\n        <div class=\"ir-print-room__body\">\n          <div class=\"ir-print-room__details\">\n            <div class=\"ir-print-room__row\">\n              <ir-printing-label label=\"Guest Name:\" content={this.formatGuestName(room?.sharing_persons?.find(p => p.is_main) ?? room?.guest)} />\n              <ir-printing-label as-html content={this.formatGuestAvailability(room?.occupancy)} />\n            </div>\n\n            <div class=\"ir-print-room__row\">\n              <div class=\"ir-print-room__dates\">\n                {this.formatBookingDates(room?.from_date)}\n                <span class=\"ir-print-room__date-separator\">â†’</span>\n                {this.formatBookingDates(room?.to_date)}\n              </div>\n\n              {room?.departure_time?.description && <p class=\"ir-print-room__departure-time\">(Expected departure time: {room.departure_time.description})</p>}\n            </div>\n\n            <ir-printing-label label=\"Smoking options:\" display=\"inline\" content={this.getSmokingLabel()} />\n\n            {booking?.is_direct && (\n              <div class=\"ir-print-room__policies\">\n                <ir-printing-label\n                  label=\"Cancellation:\"\n                  display=\"inline\"\n                  asHtml\n                  content={room?.rateplan?.cancelation?.replace('<u>', '')?.replace('</u>', '')?.replace('<b>', '<b style=\"font-weight:bold\">')}\n                />\n\n                <ir-printing-label\n                  label=\"Guarantee:\"\n                  display=\"inline\"\n                  asHtml\n                  content={(room?.rateplan?.guarantee ?? '')?.replace('<u>', '')?.replace('</u>', '')?.replace('<b>', '<b style=\"font-weight:bold\">')}\n                />\n              </div>\n            )}\n          </div>\n\n          {/* Totals */}\n          <aside class=\"ir-print-room__totals\">\n            <ir-printing-label label=\"Total:\" content={formatAmount(currency, room?.total)} />\n\n            {this.renderTaxSection()}\n\n            <ir-printing-label label=\"Grand total:\" content={formatAmount(currency, room?.gross_total)} />\n\n            {booking?.is_direct && <ir-printing-label label=\"Due upon booking:\" content={formatAmount(currency, Number(room?.gross_guarantee))} />}\n          </aside>\n        </div>\n\n        {/* Daily amounts */}\n        <div\n          class={{\n            'ir-print-room__daily-amounts': true,\n            'ir-print-room__daily-amounts--with-divider': idx < booking?.rooms?.length - 1,\n          }}\n        >\n          {room?.days?.map(d => (\n            <div class=\"room_amount_container\" key={d.date}>\n              <p class=\"room_amount date\">{this.formatDate(d.date)}</p>\n              <p class=\"room_amount amount\" style={{ paddingRight: '0.375rem' }}>\n                {formatAmount(currency, d.amount)}\n              </p>\n            </div>\n          ))}\n        </div>\n      </section>\n    );\n  }\n}\n"]}