{"version":3,"file":"ir-queue-manager.js","sourceRoot":"","sources":["../../../src/components/ir-queue-manager/ir-queue-manager.tsx"],"names":[],"mappings":"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","sourcesContent":["import Token from '@/models/Token';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport { Component, Element, Host, Prop, State, Watch, h } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-queue-manager',\n  styleUrl: 'ir-queue-manager.css',\n  scoped: true,\n})\nexport class IrQueueManager {\n  @Element() el: HTMLElement;\n\n  @Prop() ticket: string = '';\n\n  @State() isLoading: boolean = true;\n\n  private tokenService = new Token();\n  @State() data: {\n    pendingRequests: number[];\n    properties: string[];\n    q_name: string;\n    total_pending: number;\n  }[];\n  componentWillLoad() {\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n      this.init();\n    }\n  }\n\n  private async init() {\n    await this.fetchData();\n    this.isLoading = false;\n  }\n  private async fetchData() {\n    const { data } = await axios.post('/Get_Q_Summary', {});\n    if (data.ExceptionMsg) {\n      return;\n    }\n    this.data = data.My_Result.map(r => {\n      const { pendingRequests, properties } = this.formatResults(r.properties);\n      return {\n        pendingRequests,\n        properties,\n        q_name: r.q_name,\n        total_pending: r.total_pending,\n      };\n    });\n  }\n  private formatResults(data: string): {\n    properties: string[];\n    pendingRequests: number[];\n  } {\n    if (!data) {\n      return { properties: [], pendingRequests: [] };\n    }\n\n    const parsed = data\n      .split(',')\n      .map(item => {\n        const [property, pending] = item.split('|').map(v => v.trim());\n        const pendingNumber = Number(pending);\n\n        if (!property || Number.isNaN(pendingNumber)) {\n          return null;\n        }\n\n        return {\n          property,\n          pending: pendingNumber,\n        };\n      })\n      .filter((v): v is { property: string; pending: number } => v !== null);\n\n    // ðŸ”½ Sort by pending requests (highest first)\n    parsed.sort((a, b) => b.pending - a.pending);\n\n    return {\n      properties: parsed.map(p => p.property),\n      pendingRequests: parsed.map(p => p.pending),\n    };\n  }\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n\n    return (\n      <Host>\n        <ir-interceptor></ir-interceptor>\n        <ir-toast></ir-toast>\n        <div class=\"ir-page__container\">\n          <div class=\"queue-page__header\">\n            <h3 class=\"page-title\">Pending Queues</h3>\n            <ir-custom-button\n              onClickHandler={() => {\n                this.fetchData();\n              }}\n              appearance=\"filled\"\n              loading={isRequestPending('/Get_Q_Summary')}\n            >\n              <wa-icon name=\"refresh\"></wa-icon>\n            </ir-custom-button>\n          </div>\n\n          {this.data.length === 0 && <ir-empty-state style={{ marginTop: '20vh' }}></ir-empty-state>}\n\n          <div class=\"queue-grid\">\n            {this.data.map(d => (\n              <wa-card>\n                <p slot=\"header\">\n                  {d.q_name} ({d.total_pending} total pending)\n                </p>\n\n                {d.properties.map((property, index) => {\n                  const pending = d.pendingRequests[index];\n                  const percentage = d.total_pending > 0 ? (pending / d.total_pending) * 100 : 0;\n\n                  return (\n                    <div class=\"queue-item\">\n                      <span class=\"queue-item__property\">{property}</span>\n\n                      <div class=\"queue-item__status\">\n                        <wa-progress-bar class=\"queue-item__progress\" value={percentage}></wa-progress-bar>\n\n                        <span class=\"queue-item__count\">\n                          {pending} ({percentage.toFixed(2)}%)\n                        </span>\n                      </div>\n                    </div>\n                  );\n                })}\n              </wa-card>\n            ))}\n          </div>\n        </div>\n      </Host>\n    );\n  }\n}\n"]}