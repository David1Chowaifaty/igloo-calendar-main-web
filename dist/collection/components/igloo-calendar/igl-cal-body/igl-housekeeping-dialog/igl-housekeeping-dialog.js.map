{"version":3,"file":"igl-housekeeping-dialog.js","sourceRoot":"","sources":["../../../../../src/components/igloo-calendar/igl-cal-body/igl-housekeeping-dialog/igl-housekeeping-dialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Prop, State, Event, EventEmitter } from '@stencil/core';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { PhysicalRoom, RoomHkStatus } from '@/models/booking.dto';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'igl-housekeeping-dialog',\n  styleUrl: 'igl-housekeeping-dialog.css',\n  scoped: true,\n})\nexport class IglHousekeepingDialog {\n  /**\n   * Controls whether the dialog is open.\n   * The parent component is responsible for toggling this value.\n   */\n  @Prop() open: boolean;\n\n  /**\n   * Currently selected room for housekeeping actions.\n   * When null or undefined, the dialog will not render.\n   */\n  @Prop() selectedRoom: PhysicalRoom;\n\n  /**\n   * Booking number associated with the selected room (if any).\n   * Used for housekeeping action tracking.\n   */\n  @Prop() bookingNumber: number;\n\n  /**\n   * Current property identifier.\n   * Required for housekeeping service requests.\n   */\n  @Prop() propertyId: number;\n\n  @State() isLoading: 'hk-toggle-clean-dirty' | 'hk-clean-inspect' | null = null;\n\n  /** Fired after dialog is fully closed */\n  @Event() irAfterClose: EventEmitter<void>;\n\n  private dialogRef!: HTMLIrDialogElement;\n  private housekeepingService = new HouseKeepingService();\n\n  private getStatusLabel() {\n    switch (this.selectedRoom?.hk_status) {\n      case '002':\n        return 'dirty';\n      case '004':\n        return 'inspected';\n      default:\n        return 'clean';\n    }\n  }\n\n  private middleButtonLabel() {\n    return this.selectedRoom?.hk_status === '002' ? 'Clean' : 'Dirty';\n  }\n\n  private rightButtonLabel() {\n    return this.selectedRoom?.hk_status !== '004' ? 'Clean & Inspect' : 'Clean';\n  }\n\n  // private renderModalBody() {\n  //   if (!this.selectedRoom) {\n  //     return null;\n  //   }\n  //   return <p style={{ padding: '0', margin: '0' }}>Update unit {this.selectedRoom?.name} to ...</p>;\n  // }\n  private async updateHousekeeping(e: CustomEvent, status: RoomHkStatus) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      this.isLoading = (e.target as HTMLIrCustomButtonElement).value as any;\n      await this.housekeepingService.setExposedUnitHKStatus({\n        property_id: calendar_data.property.id,\n        // housekeeper: this.selectedRoom?.housekeeper ? { id: this.selectedRoom?.housekeeper?.id } : null,\n        status: {\n          code: status,\n        },\n        unit: {\n          id: this.selectedRoom?.id,\n        },\n      });\n      if (['001', '004'].includes(status)) {\n        await this.housekeepingService.executeHKAction({\n          actions: [\n            {\n              description: 'Cleaned',\n              hkm_id: this.selectedRoom?.housekeeper?.id || null,\n              unit_id: this.selectedRoom?.id,\n              booking_nbr: this.bookingNumber,\n              status: status as any,\n            },\n          ],\n        });\n      }\n    } finally {\n      this.isLoading = null;\n      this.dialogRef.closeModal();\n    }\n  }\n\n  render() {\n    return (\n      <ir-dialog ref={el => (this.dialogRef = el)} open={this.open} label=\"Housekeeping Update\" onIrDialogAfterHide={() => this.irAfterClose.emit()}>\n        <p style={{ margin: '0' }}>{`${this.selectedRoom?.name} is currently marked as ${this.getStatusLabel()}.`}</p>\n\n        <div slot=\"footer\" class=\"ir-dialog__footer\">\n          <ir-custom-button data-dialog=\"close\" size=\"medium\" variant=\"neutral\" appearance=\"filled\">\n            Cancel\n          </ir-custom-button>\n\n          <ir-custom-button\n            value=\"hk-toggle-clean-dirty\"\n            size=\"medium\"\n            variant=\"brand\"\n            appearance=\"outlined\"\n            loading={this.isLoading === 'hk-toggle-clean-dirty'}\n            onClickHandler={e => this.updateHousekeeping(e, this.selectedRoom.hk_status === '002' ? '001' : '002')}\n          >\n            {this.middleButtonLabel()}\n          </ir-custom-button>\n\n          <ir-custom-button\n            value=\"hk-clean-inspect\"\n            size=\"medium\"\n            variant=\"brand\"\n            appearance=\"accent\"\n            loading={this.isLoading === 'hk-clean-inspect'}\n            onClickHandler={e => this.updateHousekeeping(e, this.selectedRoom.hk_status === '004' ? '001' : '004')}\n          >\n            {this.rightButtonLabel()}\n          </ir-custom-button>\n        </div>\n      </ir-dialog>\n    );\n  }\n}\n"]}