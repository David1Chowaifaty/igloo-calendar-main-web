{"version":3,"file":"ir-booking-editor-form.js","sourceRoot":"","sources":["../../../../../src/components/igloo-calendar/ir-booking-editor/ir-booking-editor-form/ir-booking-editor-form.tsx"],"names":[],"mappings":"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","sourcesContent":["import booking_store, { bookedByGuestBaseData, calculateTotalRooms, getBookingTotalPrice, IRatePlanSelection, updateBookedByGuest } from '@/stores/booking.store';\nimport calendar_data from '@/stores/calendar-data';\nimport locales from '@/stores/locales.store';\nimport { formatAmount } from '@/utils/utils';\nimport { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\nimport { BookingEditorMode } from '../types';\nimport { calculateDaysBetweenDates } from '@/utils/booking';\nimport { Room } from '@/models/booking.dto';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { ExposedGuests } from '@/services/booking-service/types';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n\n@Component({\n  tag: 'ir-booking-editor-form',\n  styleUrl: 'ir-booking-editor-form.css',\n  scoped: true,\n})\nexport class IrBookingEditorForm {\n  @Prop() mode: BookingEditorMode = 'PLUS_BOOKING';\n  @Prop() room: Room;\n\n  @State() guests: ExposedGuests;\n  @Event() doReservation: EventEmitter<string>;\n\n  private bookingService = new BookingService();\n  pickerEl: HTMLIrPickerElement;\n\n  private async fetchGuests(email: string) {\n    try {\n      if (!email) {\n        return;\n      }\n      this.guests = await this.bookingService.fetchExposedGuest(email, calendar_data.property.id);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  private handleComboboxSelect(e: CustomEvent) {\n    const guest = this.guests?.find(guest => guest.id?.toString() === e.detail.item.value);\n    if (!guest) {\n      console.warn(`guest not found with id ${e.detail.item.value}`);\n      return;\n    }\n    updateBookedByGuest({\n      id: guest.id,\n      email: guest.email,\n      firstName: guest.first_name,\n      lastName: guest.last_name,\n      mobile: guest.mobile_without_prefix,\n      countryId: guest.country_id?.toString(),\n      phone_prefix: guest['country_phone_prefix'],\n    });\n  }\n  render() {\n    const { dates } = booking_store.bookingDraft;\n    let hasBookedByGuestController = false;\n    const totalRooms = calculateTotalRooms();\n    const totalCost = totalRooms > 1 ? getBookingTotalPrice() : 0;\n    return (\n      <form\n        class=\"booking-editor__guest-form\"\n        id=\"new_booking_form\"\n        autoComplete=\"off\"\n        onSubmit={e => {\n          e.preventDefault();\n          const submitter = (e as SubmitEvent).submitter as any | null;\n          this.doReservation.emit(submitter?.value);\n        }}\n      >\n        <div class=\"booking-editor__header\">\n          <ir-date-view\n            class=\"booking-editor__dates mr-1 flex-fill font-weight-bold font-medium-1\"\n            from_date={dates.checkIn}\n            to_date={dates.checkOut}\n            dateOption=\"DD MMM YYYY\"\n          ></ir-date-view>\n\n          {totalRooms > 1 && (\n            <div class=\"booking-editor__total mt-1 mt-md-0 text-right\">\n              <span class=\"booking-editor__total-label\">{locales.entries.Lcz_TotalPrice}</span>{' '}\n              <span class=\"booking-editor__total-amount font-weight-bold font-medium-1\">{formatAmount(calendar_data.property.currency.symbol, totalCost)}</span>\n            </div>\n          )}\n        </div>\n        {Object.values(booking_store.ratePlanSelections).map(val =>\n          Object.values(val).map(ratePlan => {\n            const rp = ratePlan as IRatePlanSelection;\n            if (rp.reserved === 0) {\n              return null;\n            }\n\n            return [...new Array(rp.reserved)].map((_, i) => {\n              const shouldAutoFillGuest =\n                ['BAR_BOOKING', 'PLUS_BOOKING'].includes(this.mode) &&\n                booking_store.bookedByGuest.id === -1 &&\n                !hasBookedByGuestController &&\n                !booking_store.bookedByGuestManuallyEdited;\n              if (shouldAutoFillGuest) {\n                hasBookedByGuestController = true;\n              }\n              return (\n                <igl-application-info\n                  autoFillGuest={shouldAutoFillGuest}\n                  totalNights={calculateDaysBetweenDates(dates.checkIn.format('YYYY-MM-DD'), dates.checkOut.format('YYYY-MM-DD'))}\n                  bedPreferenceType={booking_store.selects.bedPreferences}\n                  currency={calendar_data.property.currency}\n                  guestInfo={rp.guest ? rp.guest[i] : null}\n                  bookingType={this.mode}\n                  rateplanSelection={rp}\n                  key={`${rp.ratePlan.id}_${i}`}\n                  roomIndex={i}\n                  baseData={\n                    this.mode === 'EDIT_BOOKING'\n                      ? {\n                          roomtypeId: this.room.roomtype.id,\n                          unit: this.room.unit as any,\n                        }\n                      : undefined\n                  }\n                ></igl-application-info>\n              );\n            });\n          }),\n        )}\n        {['BAR_BOOKING', 'PLUS_BOOKING'].includes(this.mode) && (\n          <section class={'mt-2'}>\n            <div class=\"booking-editor__booked-by booking-editor__booked-by-header\">\n              <h4 class=\"booking-editor__heading booking-editor__booked-by-title\">Booked by</h4>\n\n              <ir-picker\n                class=\"booking-editor__booked-by-picker\"\n                appearance=\"filled\"\n                // placeholder=\"Search customer by email, name or company name\"\n                placeholder=\"Search customer by email or name\"\n                withClear\n                onText-change={event => this.fetchGuests(event.detail)}\n                debounce={500}\n                loading={isRequestPending('/Fetch_Exposed_Guests')}\n                mode=\"select-async\"\n                ref={el => (this.pickerEl = el)}\n                onCombobox-select={this.handleComboboxSelect.bind(this)}\n              >\n                {this.guests?.map(guest => {\n                  const label = `${guest.email} - ${guest.first_name} ${guest.last_name}`;\n                  return (\n                    <ir-picker-item label={label} value={guest.id?.toString()} key={guest.id}>\n                      {label}\n                    </ir-picker-item>\n                  );\n                })}\n              </ir-picker>\n              {booking_store.bookedByGuest.id !== -1 && (\n                <ir-custom-button\n                  onClickHandler={() => {\n                    updateBookedByGuest(bookedByGuestBaseData);\n                    this.pickerEl.clearInput();\n                  }}\n                  variant=\"brand\"\n                >\n                  Clear user\n                </ir-custom-button>\n              )}\n            </div>\n            <ir-booking-editor-guest-form></ir-booking-editor-guest-form>\n          </section>\n        )}\n      </form>\n    );\n  }\n}\n"]}