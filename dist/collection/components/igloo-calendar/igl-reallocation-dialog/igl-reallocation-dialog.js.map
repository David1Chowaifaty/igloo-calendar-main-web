{"version":3,"file":"igl-reallocation-dialog.js","sourceRoot":"","sources":["../../../../src/components/igloo-calendar/igl-reallocation-dialog/igl-reallocation-dialog.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,aAAa,EAAE,MAAM,2BAA2B,CAAC;AAC1D,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,KAAK,EAAgB,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,eAAe,CAAC;AAGzG,OAAO,EAAE,gBAAgB,EAAE,MAAM,+BAA+B,CAAC;AAOjE,MAAM,OAAO,qBAAqB;IACrB,MAAM,CAAe;IAExB,IAAI,CAAwB;IAE3B,gBAAgB,CAAU;IAC1B,iBAAiB,GAAG,KAAK,CAAC;IAE1B,WAAW,CAAwB;IACnC,aAAa,CAAuB;IACpC,eAAe,CAAqB;IAErC,QAAQ,CAAuB;IAC/B,gBAAgB,CAAuB;IACvC,aAAa,GAAG,IAAI,aAAa,EAAE,CAAC;IAG5C,gBAAgB,CAAC,OAAyC;QACxD,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;QACzB,IAAI,OAAO,EAAE,CAAC;YACZ,IAAI,CAAC,QAAQ,EAAE,SAAS,EAAE,CAAC;QAC7B,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,QAAQ,EAAE,UAAU,EAAE,CAAC;QAC9B,CAAC;IACH,CAAC;IAEO,KAAK,CAAC,cAAc;QAC1B,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC;YACf,OAAO;QACT,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,yBAAyB,EAAE,EAAE,CAAC;YACtC,OAAO;QACT,CAAC;QAED,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC;QACzD,IAAI,CAAC;YACH,MAAM,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,EAAE,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;QAChJ,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;YACnB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC;gBAAS,CAAC;YACT,IAAI,CAAC,QAAQ,EAAE,UAAU,EAAE,CAAC;YAC5B,IAAI,CAAC,eAAe,CAAC,IAAI,EAAE,CAAC;QAC9B,CAAC;IACH,CAAC;IAED,IAAY,eAAe;QACzB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,EAAE,SAAS,CAAC,EAAE,CAAC;YACzC,OAAO,EAAE,CAAC;QACZ,CAAC;QAED,OAAO,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;YACxC,GAAG,MAAM;YACT,IAAI,EAAE,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC;SACvC,CAAC,CAAC,CAAC;IACN,CAAC;IAEO,mBAAmB,CAAC,MAAoB;QAC9C,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,OAAO,EAAE,CAAC;QACZ,CAAC;QAED,MAAM,MAAM,GAAG,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,MAAM,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;QACpE,OAAO,GAAG,MAAM,CAAC,IAAI,GAAG,MAAM,EAAE,CAAC,IAAI,EAAE,CAAC;IAC1C,CAAC;IAEO,sBAAsB;QAC5B,OAAO,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC;IACzC,CAAC;IAEO,yBAAyB;QAC/B,IAAI,CAAC,IAAI,CAAC,sBAAsB,EAAE,EAAE,CAAC;YACnC,OAAO,IAAI,CAAC;QACd,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC3B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;YAC9B,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC3B,OAAO,KAAK,CAAC;QACf,CAAC;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAEO,mBAAmB;QACzB,MAAM,QAAQ,GAAG,IAAI,CAAC,gBAAgB,EAAE,UAAU,EAAE,aAAa,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,gBAAgB,EAAE,aAAa,CAAC,QAAQ,CAAC,CAAC;QAC9H,IAAI,QAAQ,EAAE,CAAC;YACb,QAAQ,CAAC,KAAK,EAAE,CAAC;QACnB,CAAC;IACH,CAAC;IAEO,UAAU,CAAC,IAA2B;QAC5C,IAAI,CAAC,IAAI,EAAE,CAAC;YACV,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC;YAClC,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC;YAC/B,OAAO;QACT,CAAC;QAED,IAAI,CAAC,gBAAgB,GAAG,SAAS,CAAC;QAClC,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC;IACjC,CAAC;IAEO,4BAA4B,GAAG,CAAC,CAAc,EAAE,EAAE;QACxD,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC,CAAC;IAEM,oBAAoB,GAAG,CAAC,KAAa,EAAE,EAAE;QAC/C,IAAI,CAAC,gBAAgB,GAAG,KAAK,CAAC;QAC9B,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC;IACjC,CAAC,CAAC;IAEM,iBAAiB,GAAG,GAAG,EAAE;QAC/B,IAAI,CAAC,QAAQ,EAAE,UAAU,EAAE,CAAC;QAC5B,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IAC/B,CAAC,CAAC;IAEF,MAAM;QACJ,MAAM,YAAY,GAAG,IAAI,CAAC,sBAAsB,EAAE,CAAC;QAEnD,OAAO,CACL,kEAAW,KAAK,EAAE,OAAO,EAAE,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,EAAE,cAAc,EAAE,IAAI,CAAC,4BAA4B,IAC1G,IAAI,CAAC,IAAI,IAAI,CACZ,EAAC,QAAQ;YACP,4DAAK,KAAK,EAAC,aAAa;gBACtB,0DAAG,KAAK,EAAC,4CAA4C,IAAE,IAAI,CAAC,IAAI,CAAC,WAAW,CAAK;gBAChF,YAAY,IAAI;gBACf,aAAa;gBACb,6CAA6C;gBAC7C,aAAa;gBACb,sCAAsC;gBACtC,4FAA4F;gBAC5F,mCAAmC;gBACnC,+CAA+C;gBAC/C,gBAAgB;gBAChB,+EACa,CAAC,CAAC,EAAE;wBACb,CAAC,CAAC,wBAAwB,EAAE,CAAC;wBAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;oBACtB,CAAC,EACD,YAAY,EAAE,EAAE,eACL,CAAC,CAAC,EAAE;wBACb,CAAC,CAAC,wBAAwB,EAAE,CAAC;wBAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;oBACtB,CAAC,kBACa,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAC5C,QAAQ,EAAE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,oBAAoB,CAAE,CAAC,CAAC,MAAc,CAAC,KAAK,CAAC;oBAEjE,kEAAW,KAAK,EAAC,EAAE,0BAAgC;oBAClD,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC,CAClC,iBAAW,GAAG,EAAE,MAAM,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,KAAK,IAC9C,MAAM,CAAC,IAAI,CACF,CACb,CAAC,CACQ,CACb,CACG;YACN,4DAAK,KAAK,EAAC,eAAe,EAAC,IAAI,EAAC,QAAQ;gBACtC,yEAAkB,UAAU,EAAC,QAAQ,EAAC,OAAO,EAAC,SAAS,EAAC,cAAc,EAAE,IAAI,CAAC,iBAAiB,EAAE,IAAI,EAAC,QAAQ,aAE1F;gBACnB,yEAAkB,OAAO,EAAC,OAAO,EAAC,cAAc,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,IAAI,EAAC,QAAQ,EAAC,OAAO,EAAE,gBAAgB,CAAC,0BAA0B,CAAC,cAE/H,CACf,CACG,CACZ,CACS,CACb,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { EventsService } from '@/services/events.service';\nimport { Component, Element, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\nimport type { IReallocationPayload } from '@/models/property-types';\nimport type { SelectOption } from '@/utils/utils';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n\n@Component({\n  tag: 'igl-reallocation-dialog',\n  styleUrl: 'igl-reallocation-dialog.css',\n  scoped: true,\n})\nexport class IglReallocationDialog {\n  @Element() hostEl!: HTMLElement;\n\n  @Prop() data?: IReallocationPayload;\n\n  @State() selectedRateplan?: string;\n  @State() showRateplanError = false;\n\n  @Event() dialogClose: EventEmitter<boolean>;\n  @Event() revertBooking: EventEmitter<string>;\n  @Event() resetModalState: EventEmitter<void>;\n\n  private dialogEl?: HTMLIrDialogElement;\n  private rateplanSelectEl?: HTMLIrSelectElement;\n  private eventsService = new EventsService();\n\n  @Watch('data')\n  handleDataChange(newData: IReallocationPayload | undefined) {\n    this.resetState(newData);\n    if (newData) {\n      this.dialogEl?.openModal();\n    } else {\n      this.dialogEl?.closeModal();\n    }\n  }\n\n  private async reallocateUnit() {\n    if (!this.data) {\n      return;\n    }\n\n    if (!this.validateRateplanSelection()) {\n      return;\n    }\n\n    const { pool, toRoomId, from_date, to_date } = this.data;\n    try {\n      await this.eventsService.reallocateEvent(pool, toRoomId, from_date, to_date, this.data.rateplans ? Number(this.selectedRateplan) : undefined);\n    } catch (error) {\n      console.log(error);\n      this.revertBooking.emit(pool);\n    } finally {\n      this.dialogEl?.closeModal();\n      this.resetModalState.emit();\n    }\n  }\n\n  private get rateplanOptions(): SelectOption[] {\n    if (!Array.isArray(this.data?.rateplans)) {\n      return [];\n    }\n\n    return this.data.rateplans.map(option => ({\n      ...option,\n      text: this.formatRateplanLabel(option),\n    }));\n  }\n\n  private formatRateplanLabel(option: SelectOption): string {\n    if (!option) {\n      return '';\n    }\n\n    const suffix = option.custom_text ? ` | ${option.custom_text}` : '';\n    return `${option.text}${suffix}`.trim();\n  }\n\n  private hasRateplanRequirement(): boolean {\n    return this.rateplanOptions.length > 0;\n  }\n\n  private validateRateplanSelection(): boolean {\n    if (!this.hasRateplanRequirement()) {\n      return true;\n    }\n\n    if (!this.selectedRateplan) {\n      this.showRateplanError = true;\n      this.focusRateplanSelect();\n      return false;\n    }\n\n    return true;\n  }\n\n  private focusRateplanSelect() {\n    const selectEl = this.rateplanSelectEl?.shadowRoot?.querySelector('select') ?? this.rateplanSelectEl?.querySelector('select');\n    if (selectEl) {\n      selectEl.focus();\n    }\n  }\n\n  private resetState(data?: IReallocationPayload) {\n    if (!data) {\n      this.selectedRateplan = undefined;\n      this.showRateplanError = false;\n      return;\n    }\n\n    this.selectedRateplan = undefined;\n    this.showRateplanError = false;\n  }\n\n  private handleDialogVisibilityChange = (_: CustomEvent) => {\n    this.dialogClose.emit(false);\n  };\n\n  private handleRateplanChange = (value: string) => {\n    this.selectedRateplan = value;\n    this.showRateplanError = false;\n  };\n\n  private handleCancelClick = () => {\n    this.dialogEl?.closeModal();\n    this.dialogClose.emit(false);\n  };\n\n  render() {\n    const hasRateplans = this.hasRateplanRequirement();\n\n    return (\n      <ir-dialog label={'Alert'} ref={el => (this.dialogEl = el)} onIrDialogHide={this.handleDialogVisibilityChange}>\n        {this.data && (\n          <Fragment>\n            <div class=\"dialog-body\">\n              <p class=\"text-left dialog-body__description m-0 p-0\">{this.data.description}</p>\n              {hasRateplans && (\n                // <ir-select\n                //   ref={el => (this.rateplanSelectEl = el)}\n                //   required\n                //   firstOption=\"Select rate plan...\"\n                //   data={this.rateplanOptions.map(option => ({ text: option.text, value: option.value }))}\n                //   error={this.showRateplanError}\n                //   onSelectChange={this.handleRateplanChange}\n                // ></ir-select>\n                <wa-select\n                  onwa-hide={e => {\n                    e.stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  defaultValue={''}\n                  onwa-show={e => {\n                    e.stopImmediatePropagation();\n                    e.stopPropagation();\n                  }}\n                  aria-invalid={String(this.showRateplanError)}\n                  onchange={e => this.handleRateplanChange((e.target as any).value)}\n                >\n                  <wa-option value=\"\">Select rate plan...</wa-option>\n                  {this.rateplanOptions.map(option => (\n                    <wa-option key={option.value} value={option.value}>\n                      {option.text}\n                    </wa-option>\n                  ))}\n                </wa-select>\n              )}\n            </div>\n            <div class=\"dialog-footer\" slot=\"footer\">\n              <ir-custom-button appearance=\"filled\" variant=\"neutral\" onClickHandler={this.handleCancelClick} size=\"medium\">\n                Cancel\n              </ir-custom-button>\n              <ir-custom-button variant=\"brand\" onClickHandler={() => this.reallocateUnit()} size=\"medium\" loading={isRequestPending('/ReAllocate_Exposed_Room')}>\n                Confirm\n              </ir-custom-button>\n            </div>\n          </Fragment>\n        )}\n      </ir-dialog>\n    );\n  }\n}\n"]}