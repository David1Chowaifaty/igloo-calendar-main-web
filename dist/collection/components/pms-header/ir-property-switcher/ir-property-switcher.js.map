{"version":3,"file":"ir-property-switcher.js","sourceRoot":"","sources":["../../../../src/components/pms-header/ir-property-switcher/ir-property-switcher.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\nimport { FetchedProperty, LinkedProperty } from '@/services/property.service';\nimport { GetACByACID } from './legacy.types';\nimport Token from '@/models/Token';\nimport axios from 'axios';\nimport WaDropdownItem from '@awesome.me/webawesome/dist/components/dropdown-item/dropdown-item';\n\ntype SwitcherMode = 'dropdown' | 'dialog' | 'read-only';\n\n// Unified property state\ninterface PropertyState {\n  selected: FetchedProperty | null;\n  linked: LinkedProperty[];\n  source: 'storage' | 'external' | 'user-selection';\n}\n\n@Component({\n  tag: 'ir-property-switcher',\n  styleUrl: 'ir-property-switcher.css',\n  scoped: true,\n})\nexport class IrPropertySwitcher {\n  @Element() el: HTMLIrPropertySwitcherElement;\n\n  @Prop() mode: 'dropdown' | 'dialog' = 'dialog';\n  @Prop() ticket: string;\n  @Prop() baseUrl: string;\n\n  // NEW: Allow external property binding\n  @Prop({ mutable: true }) propertyId?: number;\n  @Prop({ mutable: true }) selectedLinkedPropertyId?: number;\n\n  @State() open = false;\n  @State() isLinkedLoading = false;\n  @State() linkedLoaded = false;\n  @State() hasPool = false;\n  @State() propertyState: PropertyState = {\n    selected: null,\n    linked: [],\n    source: 'storage',\n  };\n  @State() displayMode: SwitcherMode = 'read-only';\n\n  private token = new Token();\n\n  /** Single unified event - emitted when dialog confirms selection OR dropdown selects linked property */\n  @Event({ bubbles: true, composed: true })\n  propertyChange: EventEmitter<{\n    property: GetACByACID;\n    linkedProperty: LinkedProperty | null;\n    allLinkedProperties: LinkedProperty[];\n  }>;\n\n  private storagePoller?: number;\n  private userInfoPoller?: number;\n  private lastSelectedAcRaw: string | null = null;\n  private lastUserInfoRaw: string | null = null;\n  private isUpdating = false; // Prevent circular updates\n\n  async componentWillLoad() {\n    if (this.baseUrl) this.token.setBaseUrl(this.baseUrl);\n    if (this.ticket) {\n      this.token.setToken(this.ticket);\n      await this.init();\n    }\n\n    window.addEventListener('storage', this.handleStorageEvent);\n  }\n\n  disconnectedCallback() {\n    this.stopPolling();\n    window.removeEventListener('storage', this.handleStorageEvent);\n  }\n\n  @Watch('ticket')\n  async handleTicketChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.token.setToken(newValue);\n      await this.init();\n    }\n  }\n\n  // NEW: React to external property ID changes\n  @Watch('propertyId')\n  async handlePropertyIdChange(newId: number | undefined) {\n    if (this.isUpdating) return;\n    if (newId && newId !== this.propertyState.selected?.PROPERTY_ID) {\n      // External changes don't emit propertyChange event\n      await this.loadPropertyById(newId, 'external', undefined, false);\n    }\n  }\n\n  @Watch('selectedLinkedPropertyId')\n  handleLinkedPropertyIdChange(newId: number | undefined) {\n    // Validate that the linked property exists\n    if (newId && !this.propertyState.linked.find(p => p.property_id === newId)) {\n      console.warn(`Linked property ${newId} not found in available properties`);\n    }\n  }\n\n  private async init() {\n    await this.pollSelectedAcStorage();\n    this.pollUserInfoStorage();\n\n    if (!this.propertyState.selected) {\n      this.startPolling();\n    }\n  }\n\n  private startPolling() {\n    if (this.storagePoller) return;\n    this.storagePoller = window.setInterval(() => {\n      this.pollSelectedAcStorage();\n      this.pollUserInfoStorage();\n    }, 300);\n  }\n\n  private stopPolling() {\n    if (this.storagePoller) {\n      clearInterval(this.storagePoller);\n      this.storagePoller = undefined;\n    }\n    if (this.userInfoPoller) {\n      clearInterval(this.userInfoPoller);\n      this.userInfoPoller = undefined;\n    }\n  }\n\n  private handleStorageEvent = () => {\n    this.startPolling();\n  };\n\n  private pollSelectedAcStorage = async () => {\n    const selectedAcRaw = localStorage.getItem('_Selected_Ac');\n\n    if (selectedAcRaw === this.lastSelectedAcRaw) return;\n    this.lastSelectedAcRaw = selectedAcRaw;\n\n    if (!selectedAcRaw) return;\n\n    let selectedAc: GetACByACID;\n    try {\n      selectedAc = JSON.parse(selectedAcRaw);\n    } catch {\n      return;\n    }\n\n    await this.updatePropertyState(selectedAc, null, 'storage');\n    this.stopPolling();\n  };\n\n  private pollUserInfoStorage = () => {\n    const userInfoRaw = localStorage.getItem('UserInfo_b');\n\n    if (userInfoRaw === this.lastUserInfoRaw) return;\n    this.lastUserInfoRaw = userInfoRaw;\n\n    if (!userInfoRaw) return;\n\n    this.resolveDisplayMode();\n    if (this.userInfoPoller) {\n      clearInterval(this.userInfoPoller);\n      this.userInfoPoller = undefined;\n    }\n  };\n\n  // NEW: Unified state update method\n  private async updatePropertyState(\n    selectedAc: GetACByACID,\n    linkedProperty: LinkedProperty | null,\n    source: PropertyState['source'],\n    emitEvent: boolean = false, // Control when to emit propertyChange\n  ) {\n    this.isUpdating = true;\n\n    const selected: FetchedProperty = {\n      A_NAME: selectedAc.My_User?.USERNAME ?? '',\n      COUNTRY_CODE: selectedAc.COUNTRY_ID as any,\n      COUNTRY_NAME: selectedAc.My_Country?.L1_NAME_REF ?? '',\n      PROPERTY_ID: selectedAc.AC_ID,\n      PROPERTY_NAME: selectedAc.NAME,\n    };\n\n    const hasPool = Boolean(selectedAc.POOL);\n    const sameProperty = this.propertyState.selected?.PROPERTY_ID === selectedAc.AC_ID;\n    const keepLinked = sameProperty && this.linkedLoaded && hasPool;\n    const linked = keepLinked ? this.propertyState.linked : [];\n\n    // Update state atomically\n    this.propertyState = {\n      selected,\n      linked,\n      source,\n    };\n    this.hasPool = hasPool;\n    this.linkedLoaded = keepLinked;\n    if (!keepLinked) {\n      this.isLinkedLoading = false;\n    }\n\n    // Sync external props\n    this.propertyId = selected.PROPERTY_ID;\n    this.selectedLinkedPropertyId = linkedProperty?.property_id;\n\n    this.resolveDisplayMode();\n\n    // Only emit event when explicitly requested (user selection from dialog)\n    if (emitEvent) {\n      this.propertyChange.emit({\n        property: selectedAc,\n        linkedProperty,\n        allLinkedProperties: linked,\n      });\n    }\n\n    if (this.open) {\n      this.ensureLinkedPropertiesLoaded();\n    }\n\n    this.isUpdating = false;\n  }\n\n  private async ensureLinkedPropertiesLoaded() {\n    if (!this.hasPool || this.linkedLoaded || this.isLinkedLoading) return;\n    if (!this.propertyState.selected?.PROPERTY_ID) return;\n\n    this.isLinkedLoading = true;\n    const linked = await this.fetchLinkedProperties(this.propertyState.selected.PROPERTY_ID);\n    this.propertyState = {\n      ...this.propertyState,\n      linked,\n    };\n    this.linkedLoaded = true;\n    this.isLinkedLoading = false;\n  }\n\n  private async fetchLinkedProperties(acId: number): Promise<LinkedProperty[]> {\n    try {\n      const { data } = await axios.post(`${this.baseUrl ?? ''}/Fetch_Linked_Properties`, {\n        property_id: acId,\n      });\n\n      if (data.ExceptionMsg) {\n        throw new Error(data.ExceptionMsg);\n      }\n\n      return Array.isArray(data.My_Result) ? data.My_Result : [];\n    } catch (error) {\n      console.error('Failed to fetch linked properties', error);\n      return [];\n    }\n  }\n\n  private resolveDisplayMode() {\n    const userInfoRaw = localStorage.getItem('UserInfo_b');\n\n    let userInfo: any = null;\n    try {\n      if (userInfoRaw) userInfo = JSON.parse(userInfoRaw);\n    } catch {\n      /* noop */\n    }\n\n    const userTypeCode = String(userInfo?.USER_TYPE_CODE ?? '');\n\n    if (userTypeCode === '1' || userTypeCode === '4') {\n      this.displayMode = 'dialog';\n      return;\n    }\n\n    if (!this.propertyState?.selected || !this.hasPool) {\n      this.displayMode = 'read-only';\n      return;\n    }\n\n    this.displayMode = 'dropdown';\n  }\n\n  private handlePropertySelected = async (event: CustomEvent<FetchedProperty['PROPERTY_ID']>) => {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    // This is the ONLY place where propertyChange event is emitted\n    // Only fired when dialog content confirms selection\n    await this.loadPropertyById(event.detail, 'user-selection', undefined, true);\n  };\n\n  private handleDropdownSelect = async (selectedProperty: LinkedProperty['property_id']) => {\n    const selectedId = Number(selectedProperty);\n    const linkedProperty = this.propertyState.linked.find(p => p.property_id === selectedId);\n    if (!linkedProperty) return;\n\n    // Dropdown selection also emits propertyChange with linkedProperty context\n    await this.loadPropertyById(linkedProperty.property_id, 'user-selection', linkedProperty, true);\n  };\n\n  // NEW: Consolidated loading method\n  private async loadPropertyById(\n    propertyId: number,\n    source: PropertyState['source'],\n    linkedProperty?: LinkedProperty,\n    emitEvent: boolean = false, // Only emit when true\n  ) {\n    if (this.isUpdating) return;\n\n    this.open = false;\n\n    try {\n      const { data } = await axios.post(`${this.baseUrl ?? ''}/Get_Ac_By_AC_ID_Adv`, {\n        AC_ID: propertyId,\n        Bypass_Caching: true,\n        IS_BACK_OFFICE: true,\n      });\n\n      if (data.ExceptionMsg) {\n        throw new Error(data.ExceptionMsg);\n      }\n\n      await this.updatePropertyState(data.My_Result, linkedProperty ?? null, source, emitEvent);\n    } catch (error) {\n      console.error('Failed to fetch selected property details', error);\n    }\n  }\n\n  private renderReadOnly() {\n    return <p class=\"property-switcher__trigger\">{this.propertyState.selected?.PROPERTY_NAME ?? 'Property'}</p>;\n  }\n\n  private trigger() {\n    return (\n      <wa-button\n        size=\"small\"\n        withCaret\n        class=\"property-switcher__trigger-btn\"\n        variant=\"neutral\"\n        appearance=\"outlined\"\n        onClick={() => {\n          this.open = !this.open;\n          if (this.open) {\n            this.ensureLinkedPropertiesLoaded();\n          }\n        }}\n      >\n        <p class=\"property-switcher__trigger\">{this.propertyState.selected?.PROPERTY_NAME ?? 'Select property'}</p>\n      </wa-button>\n    );\n  }\n\n  render() {\n    return (\n      <Host>\n        {this.displayMode === 'read-only' && this.renderReadOnly()}\n\n        {this.displayMode === 'dropdown' && (\n          <wa-dropdown\n            onwa-show={() => {\n              this.ensureLinkedPropertiesLoaded();\n            }}\n            onwa-hide={e => {\n              e.stopPropagation();\n              e.stopImmediatePropagation();\n            }}\n            onwa-select={(e: CustomEvent<{ item: WaDropdownItem }>) => {\n              e.stopPropagation();\n              e.stopImmediatePropagation();\n              this.handleDropdownSelect(Number(e.detail.item.value));\n            }}\n          >\n            <wa-button size=\"small\" class=\"property-switcher__trigger-btn\" slot=\"trigger\" withCaret variant=\"neutral\" appearance=\"outlined\">\n              <p class=\"property-switcher__trigger\">{this.propertyState.selected?.PROPERTY_NAME}</p>\n            </wa-button>\n            {this.isLinkedLoading && (\n              <wa-dropdown-item disabled class=\"property-switcher__dropdown-loader\">\n                <wa-spinner></wa-spinner>\n              </wa-dropdown-item>\n            )}\n            {this.propertyState.linked?.map(property => (\n              <wa-dropdown-item value={property.property_id?.toString()} key={`dropdown-item-${property.property_id}`}>\n                {property.name}\n              </wa-dropdown-item>\n            ))}\n          </wa-dropdown>\n        )}\n\n        {this.displayMode === 'dialog' && (\n          <div>\n            {this.trigger()}\n            <ir-dialog\n              // withoutHeader\n              open={this.open}\n              label=\"Find property\"\n              class=\"property-switcher__dialog\"\n              style={{ '--ir-dialog-width': '40rem' }}\n              onIrDialogAfterHide={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.open = false;\n              }}\n            >\n              {this.open &&\n                (this.isLinkedLoading ? (\n                  <div class=\"property-switcher__loader\">\n                    <ir-spinner></ir-spinner>\n                  </div>\n                ) : (\n                  <ir-property-switcher-dialog-content\n                    onLinkedPropertyChange={e => {\n                      e.stopImmediatePropagation();\n                      e.stopPropagation();\n                      this.handleDropdownSelect(Number(e.detail.property_id));\n                    }}\n                    open={this.open}\n                    selectedPropertyId={this.propertyState.selected?.PROPERTY_ID}\n                    properties={this.propertyState.linked}\n                    onPropertySelected={this.handlePropertySelected}\n                  />\n                ))}\n            </ir-dialog>\n          </div>\n        )}\n      </Host>\n    );\n  }\n}\n"]}