{"version":3,"file":"ir-pms-search.js","sourceRoot":"","sources":["../../../../src/components/pms-header/ir-pms-search/ir-pms-search.tsx"],"names":[],"mappings":"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","sourcesContent":["import { IrComboboxSelectEventDetail } from '@/components';\nimport { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\n@Component({\n  tag: 'ir-pms-search',\n  styleUrl: 'ir-pms-search.css',\n  shadow: true,\n})\nexport class IrPmsSearch {\n  @Prop() propertyid: string;\n  @Prop() ticket: string;\n\n  @State() shortcutHint: string | null = null;\n  @State() bookings: Booking[] = [];\n  @State() isLoading: boolean;\n\n  private pickerInputRef: HTMLIrPickerElement;\n\n  private tokenService = new Token();\n  private bookingListingService = new BookingListingService();\n\n  @Event({ bubbles: true, composed: true, eventName: 'combobox-select' }) comboboxSelect: EventEmitter<IrComboboxSelectEventDetail>;\n\n  componentWillLoad() {\n    document.addEventListener('keydown', this.focusInput);\n    this.detectShortcutHint();\n    if (this.ticket) {\n      console.log(this.ticket);\n      this.tokenService.setToken(this.ticket);\n    }\n  }\n\n  disconnectedCallback() {\n    document.removeEventListener('keydown', this.focusInput);\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    console.log(this.ticket);\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n    }\n  }\n\n  private detectShortcutHint() {\n    // Hide on mobile / touch devices\n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    if (isTouchDevice) {\n      this.shortcutHint = null;\n      return;\n    }\n\n    // Detect macOS\n    const isMac = /Mac|iPhone|iPad|iPod/.test(navigator.platform);\n\n    this.shortcutHint = isMac ? 'âŒ˜ K' : 'Ctrl K';\n  }\n\n  private focusInput = (event: KeyboardEvent) => {\n    const isK = event.key.toLowerCase() === 'k';\n    const isCmdOrCtrl = event.metaKey || event.ctrlKey;\n\n    if (isK && isCmdOrCtrl) {\n      event.preventDefault();\n      this.pickerInputRef?.focusInput();\n    }\n  };\n  private async fetchBookings(event: CustomEvent<string>) {\n    // throw new Error('Method not implemented.');\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const value = event.detail;\n    const isNumber = !isNaN(Number(value));\n    this.isLoading = true;\n    this.bookings = await this.bookingListingService.getExposedBookings(\n      {\n        book_nbr: isNumber ? value : null,\n        name: isNumber ? null : value,\n        property_id: this.propertyid as any,\n        filter_type: 1,\n        from: '2026-01-01',\n        to: '2026-01-08',\n        balance_filter: '0',\n        start_row: 0,\n        end_row: 20,\n        total_count: 0,\n        booking_status: '',\n        affiliate_id: 0,\n        is_mpo_managed: false,\n        is_mpo_used: false,\n        is_for_mobile: false,\n        is_combined_view: false,\n        is_to_export: false,\n        property_ids: null,\n        channel: '',\n      },\n      { skipStore: true },\n    );\n    this.isLoading = false;\n  }\n  render() {\n    return (\n      <Host>\n        <ir-picker\n          loading={this.isLoading}\n          onText-change={event => this.fetchBookings(event as CustomEvent<string>)}\n          mode=\"select-async\"\n          ref={el => (this.pickerInputRef = el)}\n          pill\n          appearance=\"filled\"\n          onCombobox-select={event => this.handleComboboxSelect(event as CustomEvent<IrComboboxSelectEventDetail>)}\n        >\n          {this.shortcutHint && <span slot=\"end\">{this.shortcutHint}</span>}\n          {this.bookings.map(b => {\n            const label = `${b.booking_nbr} ${b.guest.first_name} ${b.guest.last_name}`;\n            return (\n              <ir-picker-item value={b.booking_nbr} label={label}>\n                {label}\n              </ir-picker-item>\n            );\n          })}\n        </ir-picker>\n      </Host>\n    );\n  }\n  private handleComboboxSelect(event: CustomEvent<IrComboboxSelectEventDetail>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.comboboxSelect.emit(event.detail);\n  }\n}\n"]}