{"version":3,"file":"ir-pms-search.js","sourceRoot":"","sources":["../../../../src/components/pms-header/ir-pms-search/ir-pms-search.tsx"],"names":[],"mappings":"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","sourcesContent":["import { IrComboboxSelectEventDetail } from '@/components';\nimport { Debounce } from '@/decorators/debounce';\nimport { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\n\n@Component({\n  tag: 'ir-pms-search',\n  styleUrl: 'ir-pms-search.css',\n  shadow: true,\n})\nexport class IrPmsSearch {\n  @Prop() propertyid: string;\n  @Prop() ticket: string;\n\n  @State() shortcutHint: string | null = null;\n  @State() bookings: Booking[] = [];\n  @State() isLoading: boolean;\n\n\n  private tokenService = new Token();\n  private bookingListingService = new BookingListingService();\n\n  @Event({ bubbles: true, composed: true, eventName: 'combobox-select' }) comboboxSelect: EventEmitter<IrComboboxSelectEventDetail>;\n  autoCompleteRef: HTMLIrAutocompleteElement;\n\n  componentWillLoad() {\n    document.addEventListener('keydown', this.focusInput);\n    this.detectShortcutHint();\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n    }\n  }\n  disconnectedCallback() {\n    document.removeEventListener('keydown', this.focusInput);\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    console.log(this.ticket);\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n    }\n  }\n\n  private detectShortcutHint() {\n    // Hide on mobile / touch devices\n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    if (isTouchDevice) {\n      this.shortcutHint = null;\n      return;\n    }\n\n    // Detect macOS\n    const isMac = /Mac|iPhone|iPad|iPod/.test(navigator.platform);\n\n    this.shortcutHint = isMac ? 'âŒ˜ K' : 'Ctrl K';\n  }\n\n  private focusInput = (event: KeyboardEvent) => {\n    const isK = event.key.toLowerCase() === 'k';\n    const isCmdOrCtrl = event.metaKey || event.ctrlKey;\n\n    if (isK && isCmdOrCtrl) {\n      event.preventDefault();\n      // this.pickerInputRef?.focusInput();\n      console.log(this.autoCompleteRef)\n      this.autoCompleteRef.focusInput()\n    }\n  };\n  @Debounce(300)\n  private async fetchBookings(event: CustomEvent<string>) {\n    // throw new Error('Method not implemented.');\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const value = event.detail;\n    this.autoCompleteRef.hide()\n    if (!value) {\n      return;\n    }\n    const isNumber = /^(?:-?\\d+|.{3}-.*)$/.test(value);\n    this.isLoading = true;\n    this.bookings = await this.bookingListingService.getExposedBookings(\n      {\n        book_nbr: isNumber ? value : null,\n        name: isNumber ? null : value,\n        property_id: this.propertyid as any,\n        filter_type: 1,\n        from: '2026-01-01',\n        to: '2026-01-08',\n        balance_filter: '0',\n        start_row: 0,\n        end_row: 20,\n        total_count: 0,\n        booking_status: '',\n        affiliate_id: 0,\n        is_mpo_managed: false,\n        is_mpo_used: false,\n        is_for_mobile: false,\n        is_combined_view: false,\n        is_to_export: false,\n        property_ids: null,\n        channel: '',\n      },\n      { skipStore: true },\n    );\n    this.autoCompleteRef.show()\n    this.isLoading = false;\n  }\n  private handleComboboxSelect(event: CustomEvent<string>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.comboboxSelect.emit({\n      item: {\n        label: \"\",\n        value: event.detail\n      }\n    });\n  }\n  render() {\n    return (\n      <Host>\n        <ir-autocomplete\n         \n          class=\"pms-search__autocomplete\"\n          placeholder='Search'\n          ref={el => this.autoCompleteRef = el}\n          onCombobox-change={event => this.handleComboboxSelect(event as CustomEvent<string>)}\n          onText-change={event => this.fetchBookings(event as CustomEvent<string>)}\n          pill appearance='filled'>\n          <wa-icon name='magnifying-glass' slot='start'></wa-icon>\n          <div slot='end' class=\"pms-autocomplete__end-slot\">\n            {this.isLoading && <wa-spinner></wa-spinner>}\n            {this.shortcutHint && <span>{this.shortcutHint}</span>}\n          </div>\n          {this.bookings?.length === 0 && !this.isLoading && (\n            <div class=\"pms-search__empty\" role=\"status\" aria-live=\"polite\">\n              <wa-icon name=\"circle-info\" aria-hidden=\"true\"></wa-icon>\n              <div class=\"pms-search__empty-content\">\n                <div class=\"pms-search__empty-title\">No results found</div>\n              </div>\n            </div>\n          )}\n          {this.bookings.map(b => {\n            const label = `${b.booking_nbr}  ${b.guest.first_name} ${b.guest.last_name}`;\n            return (\n              <ir-autocomplete-option class='pms-search__autocomplete-option' value={b.booking_nbr} label={label}>\n                  <img\n                    slot='start'\n                    class=\"pms-search__option-icon\"\n                    src={b.origin.Icon}\n                    alt={b.origin.Label}\n                  />\n                <div class=\"pms-search__option\">\n                  <p class=\"pms-search__option-bookings\">\n                    <span class=\"pms-search__option-booking\">\n                      {b.booking_nbr}\n                    </span>\n                    {b.channel_booking_nbr && (\n                      <span class=\"pms-search__option-channel-booking\">\n                        {b.channel_booking_nbr}\n                      </span>\n                    )}\n                  </p>\n                  <span class=\"pms-search__option-label\">\n                    {b.guest.first_name} {b.guest.last_name}\n                  </span>\n                </div>\n                  <ir-booking-status-tag\n                    slot='end'\n                    class=\"pms-search__option-status\"\n                    status={b.status}\n                  ></ir-booking-status-tag>\n\n              </ir-autocomplete-option>\n            );\n          })}\n        </ir-autocomplete>\n      </Host>\n    );\n  }\n\n}\n"]}