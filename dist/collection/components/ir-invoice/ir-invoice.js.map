{"version":3,"file":"ir-invoice.js","sourceRoot":"","sources":["../../../src/components/ir-invoice/ir-invoice.tsx"],"names":[],"mappings":"AACA,OAAO,EAAE,eAAe,EAAE,MAAM,iBAAiB,CAAC;AAClD,OAAO,EAAE,YAAY,EAAE,MAAM,eAAe,CAAC;AAC7C,OAAO,EAAE,SAAS,EAAE,KAAK,EAAgB,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,MAAM,eAAe,CAAC;AACpG,OAAO,MAAM,MAAM,QAAQ,CAAC;AAO5B,MAAM,OAAO,SAAS;IACpB;;;;;;OAMG;IACqC,IAAI,CAAU;IAEtD;;;OAGG;IACK,OAAO,CAAU;IAEzB;;;;OAIG;IACK,IAAI,GAAiC,QAAQ,CAAC;IAEtD;;;;OAIG;IACK,GAAG,GAAuB,SAAS,CAAC;IAE5C;;;OAGG;IACK,cAAc,CAAS;IAE/B;;;OAGG;IACK,SAAS,GAAY,KAAK,CAAC;IAE1B,iBAAiB,CAAS;IAEnC;;;;;OAKG;IACM,WAAW,CAAqB;IAEzC;;;;;OAKG;IACM,YAAY,CAAqB;IAE1C;;;;;;;;;OASG;IACM,cAAc,CAMpB;IAEK,cAAc,CAAkB;IAChC,IAAI,CAAsB;IAElC,iBAAiB;QACf,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC;YAC1D,IAAI,IAAI,CAAC,GAAG,KAAK,MAAM,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;gBAC/C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,UAAU,KAAK,IAAI,CAAC,cAAc,CAAC,CAAC;YACjF,CAAC;QACH,CAAC;IACH,CAAC;IAGD,mBAAmB;QACjB,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;YACjB,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAC;YAC1D,IAAI,IAAI,CAAC,GAAG,KAAK,MAAM,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;gBAC/C,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,UAAU,KAAK,IAAI,CAAC,cAAc,CAAC,CAAC;YACjF,CAAC;QACH,CAAC;IACH,CAAC;IAED;;;;;;;;;OASG;IAEH,KAAK,CAAC,UAAU;QACd,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,IAAI,CAAC,WAAW,CAAC,IAAI,EAAE,CAAC;IAC1B,CAAC;IAED;;;;;;;;;;OAUG;IAEH,KAAK,CAAC,WAAW;QACf,IAAI,CAAC,IAAI,GAAG,KAAK,CAAC;QAClB,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,CAAC;QAC5B,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE,EAAE,QAAQ,EAAE,CAAC;QAC7D,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;IAC3B,CAAC;IAED;;;;;OAKG;IACK,oBAAoB,CAAC,aAAsB,KAAK;QACtD,IAAI,CAAC,UAAU;YACb,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;gBACvB,OAAO,EAAE,IAAI,CAAC,OAAO;gBACrB,WAAW,EAAE,IAAI,CAAC,iBAAiB;gBACnC,GAAG,EAAE,IAAI,CAAC,GAAG;gBACb,cAAc,EAAE,IAAI,CAAC,cAAc;gBACnC,IAAI,EAAE,IAAI,CAAC,IAAI;aAChB,CAAC,CAAC;QAEL,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;YACnB,IAAI,CAAC;gBACH,kBAAkB;YACpB,CAAC;YAAC,OAAO,KAAK,EAAE,CAAC;gBACf,sCAAsC;gBACtC,OAAO,CAAC,KAAK,CAAC,oBAAoB,EAAE,KAAK,CAAC,CAAC;YAC7C,CAAC;QACH,CAAC;IACH,CAAC;IACO,UAAU;QAChB,IAAI,IAAI,CAAC,GAAG,KAAK,MAAM,EAAE,CAAC;YACxB,OAAO,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC;QAC3B,CAAC;QACD,MAAM,kBAAkB,GAAG,GAAG,EAAE;YAC9B,IAAI,OAAO,GAAG,MAAM,EAAE,CAAC;YACvB,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAC;gBACtC,MAAM,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;gBAC7C,IAAI,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE,CAAC;oBACxB,OAAO,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC;gBACtB,CAAC;YACH,CAAC;YACD,OAAO,OAAO,CAAC;QACjB,CAAC,CAAC;QAEF,OAAO,kBAAkB,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;IACnD,CAAC;IAEO,UAAU;QAChB,OAAO,MAAM,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;IACvC,CAAC;IACO,iBAAiB,CAAC,KAAa;QACrC,MAAM,SAAS,GAAG,IAAI,GAAG,EAAkB,CAAC;QAC5C,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,EAAE,GAAG,CAAC,CAAC,CAAC;QAElE,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;YAClB,OAAO,EAAE,MAAM,EAAE,EAAE,EAAE,SAAS,EAAE,cAAc,EAAE,KAAK,EAAE,CAAC;QAC1D,CAAC;QAED,MAAM,YAAY,GAAG,CAAC,UAAkB,EAAE,EAAE;YAC1C,IAAI,GAAG,GAAG,MAAM,CAAC,gBAAgB,CAAC;YAClC,KAAK,MAAM,CAAC,IAAI,UAAU,EAAE,CAAC;gBAC3B,MAAM,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,IAAI,EAAE,CAAC,CAAC;gBAC1C,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC;oBACtB,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;gBAC1B,CAAC;YACH,CAAC;YACD,OAAO,GAAG,CAAC;QACb,CAAC,CAAC;QAEF,MAAM,UAAU,GAAG,eAAe,CAAC,KAAK,CAAC,CAAC;QAC1C,IAAI,CAAC,UAAU,EAAE,CAAC;YAChB,MAAM,WAAW,GAAG,CAAC,GAAG,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC3C,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,IAAI,EAAE,CAAC,CAAC;gBAC7E,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,IAAI,KAAK,CAAC,EAAE,CAAC;oBACtC,OAAO,IAAI,CAAC;gBACd,CAAC;gBACD,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;YACjF,CAAC,CAAC,CAAC;YACH,OAAO,EAAE,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,EAAE,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,SAAS,EAAE,cAAc,EAAE,KAAK,EAAE,CAAC;QAC9I,CAAC;QAED,MAAM,SAAS,GAAG,IAAI,GAAG,CAAe,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;QACpF,MAAM,OAAO,GAA0E,EAAE,CAAC;QAC1F,MAAM,OAAO,GAAG,IAAI,GAAG,EAAU,CAAC;QAElC,KAAK,MAAM,IAAI,IAAI,UAAU,CAAC,KAAK,EAAE,CAAC;YACpC,MAAM,KAAK,GAAG,UAAU,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACrD,MAAM,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,EAAgB,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;YACpG,IAAI,CAAC,UAAU,CAAC,MAAM;gBAAE,SAAS;YAEjC,MAAM,iBAAiB,GACrB,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE;gBACd,MAAM,MAAM,GAAG,UAAU,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;gBAC3C,MAAM,QAAQ,GAAG,UAAU,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC;gBACrD,OAAO,OAAO,CAAC,MAAM,CAAC,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;YAChD,CAAC,CAAC,IAAI,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;YAEzD,IAAI,iBAAiB,EAAE,CAAC;gBACtB,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;gBACzD,MAAM,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,MAAM,CAAC,gBAAgB,CAAC,CAAC,CAAC;gBAC7G,OAAO,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,UAAU,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,CAAC,UAAU,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;YAC/F,CAAC;QACH,CAAC;QAED,KAAK,MAAM,IAAI,IAAI,KAAK,EAAE,CAAC;YACzB,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC;gBAClC,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,MAAM,CAAC,gBAAgB,CAAC;gBACxE,MAAM,WAAW,GAAG,CAAC,IAAI,CAAC,CAAC;gBAC3B,OAAO,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,WAAW,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,CAAC,WAAW,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;YAClG,CAAC;QACH,CAAC;QAED,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;YACpB,IAAI,CAAC,CAAC,OAAO,KAAK,CAAC,CAAC,OAAO,EAAE,CAAC;gBAC5B,OAAO,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC,OAAO,CAAC;YAC/B,CAAC;YACD,OAAO,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC;QAC3B,CAAC,CAAC,CAAC;QACH,MAAM,cAAc,GAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;QAE5D,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,MAAM,MAAM,GAAG,OAAO;iBACnB,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC;iBACzB,MAAM,CAAS,CAAC,GAAG,EAAE,IAAI,EAAE,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;iBACnD,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;gBACb,MAAM,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,IAAI,EAAE,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,IAAI,EAAE,CAAC,CAAC;gBAC7E,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,IAAI,KAAK,CAAC,EAAE,CAAC;oBACtC,OAAO,IAAI,CAAC;gBACd,CAAC;gBACD,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC;YACjF,CAAC,CAAC,CAAC;YACL,OAAO,EAAE,MAAM,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,CAAC,EAAE,OAAO,EAAE,YAAY,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,EAAE,SAAS,EAAE,cAAc,EAAE,KAAK,EAAE,CAAC;QACpI,CAAC;QAED,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,EAAE,cAAc,EAAE,IAAI,EAAE,CAAC;IAC9D,CAAC;IACO,WAAW;QACjB,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,EAAE,KAAK,IAAI,EAAE,CAAC;QACxC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;YAClB,OAAO,IAAI,CAAC;QACd,CAAC;QAED,MAAM,EAAE,MAAM,EAAE,cAAc,EAAE,GAAG,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QAEjE,IAAI,CAAC,cAAc,EAAE,CAAC;YACpB,MAAM,UAAU,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;YACnC,OAAO,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,CAC5B,WAAK,KAAK,EAAC,qBAAqB,EAAC,GAAG,EAAE,IAAI,CAAC,UAAU;gBACnD,mBAAa,KAAK,EAAC,sBAAsB,EAAC,OAAO;oBAC/C,WAAK,KAAK,EAAE,qCAAqC;wBAC/C,aAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAK;wBAC3B,gBAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAQ;wBACvC,YAAM,KAAK,EAAC,4BAA4B,IAAE,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,CAAQ,CACnF,CACM,CACV;YAEN,qEAAqE;YACrE,mEAAmE;aACpE,CAAC,CAAC;QACL,CAAC;QACD,OAAO,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CACzB,WAAK,KAAK,EAAC,qBAAqB,EAAC,GAAG,EAAE,KAAK,CAAC,KAAK;YAC/C,mBAAa,KAAK,EAAC,4BAA4B,EAAC,OAAO;gBACrD,WAAK,KAAK,EAAE,2CAA2C,IACpD,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;oBACtB,OAAO,CACL,WAAK,KAAK,EAAC,2BAA2B,EAAC,KAAK,EAAE,EAAE,GAAG,EAAE,QAAQ,EAAE;wBAC7D,aAAI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAK;wBAC3B,gBAAO,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAQ;wBACvC,YAAM,KAAK,EAAC,4BAA4B,IAAE,YAAY,CAAC,KAAK,EAAE,IAAI,CAAC,WAAW,CAAC,CAAQ,CACnF,CACP,CAAC;gBACJ,CAAC,CAAC,CACE,CACM,CACV,CACP,CAAC,CAAC;IACL,CAAC;IAED,MAAM;QACJ,OAAO,CACL,EAAC,IAAI;YACH,kEACE,KAAK,EAAC,SAAS,EACf,IAAI,EAAE,IAAI,CAAC,IAAI,EACf,YAAY,EAAE,CAAC,CAAC,EAAE;oBAChB,CAAC,CAAC,wBAAwB,EAAE,CAAC;oBAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;oBACpB,IAAI,CAAC,WAAW,EAAE,CAAC;gBACrB,CAAC;gBAED,6DAAM,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC,EAAE,KAAK,EAAC,uBAAuB;oBACxE,8EAAuB,KAAK,EAAC,MAAM,EAAC,IAAI,EAAE,MAAM,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,UAAU,EAAE,EAAE,OAAO,EAAE,IAAI,CAAC,UAAU,EAAE,GAA0B;oBACzJ,qFAA8B,iBAAiB,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,MAAM,CAAC,EAAE,OAAO,EAAE,IAAI,CAAC,OAAO,GAAiC;oBACjJ,4DAAK,KAAK,EAAE,sBAAsB;wBAChC,0DAAG,KAAK,EAAC,gCAAgC,6BAA2B;wBACpE,4DAAK,KAAK,EAAC,gCAAgC;4BACxC,IAAI,CAAC,WAAW,EAAE;4BAClB,IAAI,CAAC,OAAO,CAAC,WAAW,IAAI,CAC3B,4DAAK,KAAK,EAAC,qBAAqB;gCAC9B,oEAAa,KAAK,EAAC,sBAAsB;oCACvC,uEAAiB,CACL,CACV,CACP;4BACA,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CACjD,WAAK,GAAG,EAAE,aAAa,CAAC,SAAS,EAAE,KAAK,EAAC,qBAAqB;gCAC5D,mBAAa,KAAK,EAAC,sBAAsB;oCACvC,cAAW,CACC,CACV,CACP,CAAC,CACE,CACF,CACD;gBACP,4DAAK,IAAI,EAAC,QAAQ,EAAC,KAAK,EAAC,mBAAmB;oBAC1C,yEACE,IAAI,EAAC,QAAQ,EACb,UAAU,EAAC,QAAQ,EACnB,KAAK,EAAC,iBAAiB,EACvB,OAAO,EAAC,SAAS,EACjB,cAAc,EAAE,GAAG,EAAE;4BACnB,IAAI,CAAC,WAAW,EAAE,CAAC;wBACrB,CAAC,aAGgB;oBACnB,yEACE,cAAc,EAAE,GAAG,EAAE;4BACnB,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,CAAC;wBAClC,CAAC,EACD,IAAI,EAAC,QAAQ,EACb,KAAK,EAAC,iBAAiB,EACvB,UAAU,EAAC,UAAU,EACrB,OAAO,EAAC,OAAO,wBAGE;oBACnB,yEACE,cAAc,EAAE,GAAG,EAAE;4BACnB,IAAI,CAAC,oBAAoB,EAAE,CAAC;wBAC9B,CAAC,EACD,KAAK,EAAC,iBAAiB,EACvB,IAAI,EAAC,QAAQ,EACb,OAAO,EAAC,OAAO,sBAGE,CACf,CACI,CACP,CACR,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Booking, Room } from '@/models/booking.dto';\nimport { buildSplitIndex } from '@/utils/booking';\nimport { formatAmount } from '@/utils/utils';\nimport { Component, Event, EventEmitter, Host, Method, Prop, State, Watch, h } from '@stencil/core';\nimport moment from 'moment';\n\n@Component({\n  tag: 'ir-invoice',\n  styleUrls: ['ir-invoice.css', '../../global/app.css'],\n  scoped: true,\n})\nexport class IrInvoice {\n  /**\n   * Whether the invoice drawer is open.\n   *\n   * This prop is mutable and reflected to the host element,\n   * allowing parent components to control visibility via markup\n   * or via the public `openDrawer()` / `closeDrawer()` methods.\n   */\n  @Prop({ mutable: true, reflect: true }) open: boolean;\n\n  /**\n   * The booking object for which the invoice is being generated.\n   * Should contain room, guest, and pricing information.\n   */\n  @Prop() booking: Booking;\n\n  /**\n   * Determines what should happen after creating the invoice.\n   * - `\"create\"`: create an invoice normally\n   * - `\"check_in-create\"`: create an invoice as part of the check-in flow\n   */\n  @Prop() mode: 'create' | 'check_in-create' = 'create';\n\n  /**\n   * Specifies what the invoice is for.\n   * - `\"room\"`: invoice for a specific room\n   * - `\"booking\"`: invoice for the entire booking\n   */\n  @Prop() for: 'room' | 'booking' = 'booking';\n\n  /**\n   * The identifier of the room for which the invoice is being generated.\n   * Used when invoicing at room level instead of booking level.\n   */\n  @Prop() roomIdentifier: string;\n\n  /**\n   * When `true`, automatically triggers `window.print()` after an invoice is created.\n   * Useful for setups where the invoice should immediately be sent to a printer.\n   */\n  @Prop() autoPrint: boolean = false;\n\n  @State() selectedRecipient: string;\n\n  /**\n   * Emitted when the invoice drawer is opened.\n   *\n   * Fired when `openDrawer()` is called and the component\n   * transitions into the open state.\n   */\n  @Event() invoiceOpen: EventEmitter<void>;\n\n  /**\n   * Emitted when the invoice drawer is closed.\n   *\n   * Fired when `closeDrawer()` is called, including when the\n   * underlying drawer emits `onDrawerHide`.\n   */\n  @Event() invoiceClose: EventEmitter<void>;\n\n  /**\n   * Emitted when an invoice is created/confirmed.\n   *\n   * The event `detail` contains:\n   * - `booking`: the booking associated with the invoice\n   * - `recipientId`: the selected billing recipient\n   * - `for`: whether the invoice is for `\"room\"` or `\"booking\"`\n   * - `roomIdentifier`: the room identifier when invoicing a specific room\n   * - `mode`: the current invoice mode\n   */\n  @Event() invoiceCreated: EventEmitter<{\n    booking: Booking;\n    recipientId: string;\n    for: 'room' | 'booking';\n    roomIdentifier?: string;\n    mode: 'create' | 'check_in-create';\n  }>;\n\n  private invoiceFormRef: HTMLFormElement;\n  private room: Booking['rooms'][0];\n\n  componentWillLoad() {\n    if (this.booking) {\n      this.selectedRecipient = this.booking.guest.id.toString();\n      if (this.for === 'room' && this.roomIdentifier) {\n        this.room = this.booking.rooms.find(r => r.identifier === this.roomIdentifier);\n      }\n    }\n  }\n\n  @Watch('booking')\n  handleBookingChange() {\n    if (this.booking) {\n      this.selectedRecipient = this.booking.guest.id.toString();\n      if (this.for === 'room' && this.roomIdentifier) {\n        this.room = this.booking.rooms.find(r => r.identifier === this.roomIdentifier);\n      }\n    }\n  }\n\n  /**\n   * Opens the invoice drawer.\n   *\n   * This method sets the `open` property to `true`, making the drawer visible.\n   * It can be called programmatically by parent components.\n   *\n   * Also emits the `invoiceOpen` event.\n   *\n   * @returns {Promise<void>} Resolves once the drawer state is updated.\n   */\n  @Method()\n  async openDrawer(): Promise<void> {\n    this.open = true;\n    this.invoiceOpen.emit();\n  }\n\n  /**\n   * Closes the invoice drawer.\n   *\n   * This method sets the `open` property to `false`, hiding the drawer.\n   * Parent components can call this to close the drawer programmatically,\n   * and it is also used internally when the drawer emits `onDrawerHide`.\n   *\n   * Also emits the `invoiceClose` event.\n   *\n   * @returns {Promise<void>} Resolves once the drawer state is updated.\n   */\n  @Method()\n  async closeDrawer(): Promise<void> {\n    this.open = false;\n    this.invoiceFormRef.reset();\n    this.selectedRecipient = this.booking?.guest?.id?.toString();\n    this.invoiceClose.emit();\n  }\n\n  /**\n   * Handles confirming/creating the invoice.\n   *\n   * Emits the `invoiceCreated` event with invoice context, and if\n   * `autoPrint` is `true`, triggers `window.print()` afterwards.\n   */\n  private handleConfirmInvoice(isProforma: boolean = false) {\n    if (!isProforma)\n      this.invoiceCreated.emit({\n        booking: this.booking,\n        recipientId: this.selectedRecipient,\n        for: this.for,\n        roomIdentifier: this.roomIdentifier,\n        mode: this.mode,\n      });\n\n    if (this.autoPrint) {\n      try {\n        // window.print();\n      } catch (error) {\n        // Fail silently but log for debugging\n        console.error('Auto print failed:', error);\n      }\n    }\n  }\n  private getMinDate() {\n    if (this.for === 'room') {\n      return this.room.to_date;\n    }\n    const getMinCheckoutDate = () => {\n      let minDate = moment();\n      for (const room of this.booking.rooms) {\n        const d = moment(room.to_date, 'YYYY-MM-DD');\n        if (d.isBefore(minDate)) {\n          minDate = d.clone();\n        }\n      }\n      return minDate;\n    };\n\n    return getMinCheckoutDate().format('YYYY-MM-DD');\n  }\n\n  private getMaxDate() {\n    return moment().format('YYYY-MM-DD');\n  }\n  private computeRoomGroups(rooms: Room[]) {\n    const indexById = new Map<string, number>();\n    rooms.forEach((room, idx) => indexById.set(room.identifier, idx));\n\n    if (!rooms.length) {\n      return { groups: [], indexById, hasSplitGroups: false };\n    }\n\n    const groupSortKey = (groupRooms: Room[]) => {\n      let min = Number.MAX_SAFE_INTEGER;\n      for (const r of groupRooms) {\n        const ts = Date.parse(r?.from_date ?? '');\n        if (!Number.isNaN(ts)) {\n          min = Math.min(min, ts);\n        }\n      }\n      return min;\n    };\n\n    const splitIndex = buildSplitIndex(rooms);\n    if (!splitIndex) {\n      const sortedRooms = [...rooms].sort((a, b) => {\n        const diff = Date.parse(a?.from_date ?? '') - Date.parse(b?.from_date ?? '');\n        if (!Number.isNaN(diff) && diff !== 0) {\n          return diff;\n        }\n        return (indexById.get(a.identifier) ?? 0) - (indexById.get(b.identifier) ?? 0);\n      });\n      return { groups: [{ rooms: sortedRooms, order: 0, isSplit: false, sortKey: groupSortKey(sortedRooms) }], indexById, hasSplitGroups: false };\n    }\n\n    const roomsById = new Map<string, Room>(rooms.map(room => [room.identifier, room]));\n    const grouped: { rooms: Room[]; order: number; sortKey: number; isSplit: boolean }[] = [];\n    const visited = new Set<string>();\n\n    for (const head of splitIndex.heads) {\n      const chain = splitIndex.chainOf.get(head) ?? [head];\n      const chainRooms = chain.map(id => roomsById.get(id)).filter((room): room is Room => Boolean(room));\n      if (!chainRooms.length) continue;\n\n      const chainHasSplitLink =\n        chain.some(id => {\n          const parent = splitIndex.parentOf.get(id);\n          const children = splitIndex.childrenOf.get(id) ?? [];\n          return Boolean(parent) || children.length > 0;\n        }) || chainRooms.some(room => Boolean(room?.is_split));\n\n      if (chainHasSplitLink) {\n        chainRooms.forEach(room => visited.add(room.identifier));\n        const order = Math.min(...chainRooms.map(room => indexById.get(room.identifier) ?? Number.MAX_SAFE_INTEGER));\n        grouped.push({ rooms: chainRooms, order, sortKey: groupSortKey(chainRooms), isSplit: true });\n      }\n    }\n\n    for (const room of rooms) {\n      if (!visited.has(room.identifier)) {\n        const order = indexById.get(room.identifier) ?? Number.MAX_SAFE_INTEGER;\n        const singleGroup = [room];\n        grouped.push({ rooms: singleGroup, order, sortKey: groupSortKey(singleGroup), isSplit: false });\n      }\n    }\n\n    grouped.sort((a, b) => {\n      if (a.sortKey !== b.sortKey) {\n        return a.sortKey - b.sortKey;\n      }\n      return a.order - b.order;\n    });\n    const hasSplitGroups = grouped.some(group => group.isSplit);\n\n    if (!hasSplitGroups) {\n      const merged = grouped\n        .map(group => group.rooms)\n        .reduce<Room[]>((acc, curr) => acc.concat(curr), [])\n        .sort((a, b) => {\n          const diff = Date.parse(a?.from_date ?? '') - Date.parse(b?.from_date ?? '');\n          if (!Number.isNaN(diff) && diff !== 0) {\n            return diff;\n          }\n          return (indexById.get(a.identifier) ?? 0) - (indexById.get(b.identifier) ?? 0);\n        });\n      return { groups: [{ rooms: merged, order: 0, sortKey: groupSortKey(merged), isSplit: false }], indexById, hasSplitGroups: false };\n    }\n\n    return { groups: grouped, indexById, hasSplitGroups: true };\n  }\n  private renderRooms() {\n    const rooms = this.booking?.rooms ?? [];\n    if (!rooms.length) {\n      return null;\n    }\n\n    const { groups, hasSplitGroups } = this.computeRoomGroups(rooms);\n\n    if (!hasSplitGroups) {\n      const groupRooms = groups[0].rooms;\n      return groupRooms.map(room => (\n        <div class=\"ir-invoice__service\" key={room.identifier}>\n          <wa-checkbox class=\"ir-invoice__checkbox\" checked>\n            <div class={'ir-invoice__room-checkbox-container'}>\n              <b>{room.roomtype.name}</b>\n              <span>{room.rateplan.short_name}</span>\n              <span class=\"ir-invoice__checkbox-price\">{formatAmount('$US', room.gross_total)}</span>\n            </div>\n          </wa-checkbox>\n        </div>\n\n        // {this.renderRoomItem(room, indexById.get(room.identifier) ?? idx)}\n        // {idx < groupRooms.length - 1 ? <wa-divider></wa-divider> : null}\n      ));\n    }\n    return groups.map(group => (\n      <div class=\"ir-invoice__service\" key={group.order}>\n        <wa-checkbox class=\"ir-invoice__checkbox group\" checked>\n          <div class={'ir-invoice__room-checkbox-container group'}>\n            {group.rooms.map(room => {\n              return (\n                <div class=\"d-flex align-items-center\" style={{ gap: '0.5rem' }}>\n                  <b>{room.roomtype.name}</b>\n                  <span>{room.rateplan.short_name}</span>\n                  <span class=\"ir-invoice__checkbox-price\">{formatAmount('$US', room.gross_total)}</span>\n                </div>\n              );\n            })}\n          </div>\n        </wa-checkbox>\n      </div>\n    ));\n  }\n\n  render() {\n    return (\n      <Host>\n        <ir-drawer\n          label=\"Invoice\"\n          open={this.open}\n          onDrawerHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.closeDrawer();\n          }}\n        >\n          <form ref={el => (this.invoiceFormRef = el)} class=\"ir-invoice__container\">\n            <ir-custom-date-picker label=\"Date\" date={moment().format('YYYY-MM-DD')} minDate={this.getMinDate()} maxDate={this.getMaxDate()}></ir-custom-date-picker>\n            <ir-booking-billing-recipient onRecipientChange={e => (this.selectedRecipient = e.detail)} booking={this.booking}></ir-booking-billing-recipient>\n            <div class={'ir-invoice__services'}>\n              <p class=\"ir-invoice__form-control-label\">Choose what to invoice</p>\n              <div class=\"ir-invoice__services-container\">\n                {this.renderRooms()}\n                {this.booking.pickup_info && (\n                  <div class=\"ir-invoice__service\">\n                    <wa-checkbox class=\"ir-invoice__checkbox\">\n                      <div>Pickup</div>\n                    </wa-checkbox>\n                  </div>\n                )}\n                {this.booking.extra_services?.map(extra_service => (\n                  <div key={extra_service.system_id} class=\"ir-invoice__service\">\n                    <wa-checkbox class=\"ir-invoice__checkbox\">\n                      <div></div>\n                    </wa-checkbox>\n                  </div>\n                ))}\n              </div>\n            </div>\n          </form>\n          <div slot=\"footer\" class=\"ir__drawer-footer\">\n            <ir-custom-button\n              size=\"medium\"\n              appearance=\"filled\"\n              class=\"w-100 flex-fill\"\n              variant=\"neutral\"\n              onClickHandler={() => {\n                this.closeDrawer();\n              }}\n            >\n              Cancel\n            </ir-custom-button>\n            <ir-custom-button\n              onClickHandler={() => {\n                this.handleConfirmInvoice(true);\n              }}\n              size=\"medium\"\n              class=\"w-100 flex-fill\"\n              appearance=\"outlined\"\n              variant=\"brand\"\n            >\n              Pro-forma invoice\n            </ir-custom-button>\n            <ir-custom-button\n              onClickHandler={() => {\n                this.handleConfirmInvoice();\n              }}\n              class=\"w-100 flex-fill\"\n              size=\"medium\"\n              variant=\"brand\"\n            >\n              Confirm invoice\n            </ir-custom-button>\n          </div>\n        </ir-drawer>\n      </Host>\n    );\n  }\n}\n"]}