{"version":3,"file":"ir-hk-unassigned-units.js","sourceRoot":"","sources":["../../../../src/components/ir-housekeeping/ir-hk-unassigned-units/ir-hk-unassigned-units.tsx"],"names":[],"mappings":"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","sourcesContent":["import { IHouseKeepers, IPropertyHousekeepingAssignment } from '@/models/housekeeping';\r\nimport { HouseKeepingService } from '@/services/housekeeping.service';\r\nimport calendar_data from '@/stores/calendar-data';\r\nimport housekeeping_store from '@/stores/housekeeping.store';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport { Component, Event, EventEmitter, Host, Prop, State, h } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'ir-hk-unassigned-units',\r\n  styleUrl: 'ir-hk-unassigned-units.css',\r\n  scoped: true,\r\n})\r\nexport class IrHkUnassignedUnits {\r\n  @Prop() user: IHouseKeepers | null = null;\r\n\r\n  @State() renderAgain = false;\r\n\r\n  @Event() closeSideBar: EventEmitter<null>;\r\n  @Event() resetData: EventEmitter<null>;\r\n\r\n  private assignedUnits: Map<number, IPropertyHousekeepingAssignment> = new Map();\r\n  private housekeepingService = new HouseKeepingService();\r\n\r\n  componentWillLoad() {\r\n    this.housekeepingService.setToken(housekeeping_store.default_properties.token);\r\n  }\r\n\r\n  assignUnit(unit_id: number, hk_id: number | null, checked: boolean) {\r\n    if (this.user) {\r\n      const userUnit = this.user.assigned_units.find(unit => unit.id === unit_id);\r\n      if ((checked && userUnit) || (!checked && !userUnit)) {\r\n        this.assignedUnits.delete(unit_id);\r\n      } else if (!checked && userUnit) {\r\n        this.assignedUnits.set(unit_id, { hkm_id: hk_id, is_to_assign: false, unit_id });\r\n      } else if (checked) {\r\n        const assignment: IPropertyHousekeepingAssignment = {\r\n          hkm_id: hk_id,\r\n          is_to_assign: true,\r\n          unit_id,\r\n        };\r\n        this.assignedUnits.set(unit_id, assignment);\r\n      }\r\n    } else {\r\n      if (this.assignedUnits.has(unit_id) && !hk_id) {\r\n        this.assignedUnits.delete(unit_id);\r\n        return;\r\n      } else {\r\n        this.assignedUnits.set(unit_id, {\r\n          hkm_id: hk_id,\r\n          is_to_assign: true,\r\n          unit_id,\r\n        });\r\n      }\r\n    }\r\n    this.renderAgain = !this.renderAgain;\r\n  }\r\n\r\n  async assignUnits() {\r\n    try {\r\n      await this.housekeepingService.manageExposedAssignedUnitToHKM(housekeeping_store.default_properties.property_id, [...this.assignedUnits.values()]);\r\n      this.resetData.emit(null);\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      this.closeSideBar.emit(null);\r\n    }\r\n  }\r\n  renderRooms() {\r\n    if (!this.user) {\r\n      return housekeeping_store.hk_criteria.units_assignments.unassigned_units.map(unit => (\r\n        <li key={unit.id}>\r\n          <p class=\"mr-2\">{unit.name}</p>\r\n          <ir-select\r\n            class=\"ml-4\"\r\n            onSelectChange={e => {\r\n              let hk_id = e.detail;\r\n              if (hk_id === '') {\r\n                hk_id = null;\r\n              } else {\r\n                hk_id = +hk_id;\r\n              }\r\n              this.assignUnit(unit.id, hk_id, false);\r\n            }}\r\n            LabelAvailable={false}\r\n            data={housekeeping_store.hk_criteria.housekeepers.map(hk => ({ text: hk.name, value: hk.id.toString() }))}\r\n          ></ir-select>\r\n        </li>\r\n      ));\r\n    }\r\n    return calendar_data.roomsInfo.map(roomType => {\r\n      if (!roomType.is_active) {\r\n        return null;\r\n      }\r\n      return roomType.physicalrooms?.map(physical_room => {\r\n        let taken = !housekeeping_store.hk_criteria.units_assignments.unassigned_units.find(unit => unit.id === physical_room.id);\r\n        let housekeeper = [];\r\n        const assignedRoom = this.assignedUnits.get(physical_room.id);\r\n        if (assignedRoom && assignedRoom.is_to_assign) {\r\n          housekeeper = [this.user];\r\n          taken = true;\r\n        } else {\r\n          if (taken) {\r\n            housekeeper = housekeeping_store.hk_criteria.housekeepers.filter(hk => hk.assigned_units.find(unit => unit.id === physical_room.id));\r\n          }\r\n        }\r\n        return (\r\n          <li key={physical_room.id}>\r\n            <div class=\"d-flex mr-3\">\r\n              <p class=\"mr-2\">{physical_room.name}</p> <span>{taken ? housekeeper[0]?.name : ''}</span>\r\n            </div>\r\n            <ir-switch\r\n              onCheckChange={e => {\r\n                const checked = e.detail;\r\n                this.assignUnit(physical_room.id, this.user.id, checked);\r\n              }}\r\n              checked={taken && housekeeper[0]?.id === this.user.id}\r\n            ></ir-switch>\r\n          </li>\r\n        );\r\n      });\r\n    });\r\n  }\r\n  render() {\r\n    return (\r\n      <Host class=\"px-1\">\r\n        <div class=\"d-flex align-items-center py-1 justify-content-between\">\r\n          <h3 class=\"text-left font-medium-2 title py-0 my-0\">{!this.user ? 'Assingn Units' : `Assignment for ${this.user.name}`}</h3>\r\n          <ir-icon\r\n            class={'ml-1 m-0 p-0 close'}\r\n            onIconClickHandler={() => {\r\n              this.closeSideBar.emit(null);\r\n            }}\r\n          >\r\n            <svg slot=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 384 512\" height={20} width={20}>\r\n              <path d=\"M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z\" />\r\n            </svg>\r\n          </ir-icon>\r\n        </div>\r\n        <section class=\"pt-1 pb-1 border-top\">\r\n          <ul>{this.renderRooms()}</ul>\r\n          <div class=\"d-flex flex-column flex-md-row align-items-md-center mt-2 w-100\">\r\n            <ir-button\r\n              onClickHanlder={() => this.closeSideBar.emit(null)}\r\n              class=\"flex-fill\"\r\n              btn_styles=\"w-100  justify-content-center align-items-center\"\r\n              btn_color=\"secondary\"\r\n              text={'Cancel'}\r\n            ></ir-button>\r\n            <ir-button\r\n              isLoading={isRequestPending('/Manage_Exposed_Assigned_Unit_To_HKM')}\r\n              onClickHanlder={this.assignUnits.bind(this)}\r\n              class=\"flex-fill ml-md-1\"\r\n              btn_styles=\"w-100  justify-content-center align-items-center mt-1 mt-md-0\"\r\n              text={'Confirm'}\r\n            ></ir-button>\r\n          </div>\r\n        </section>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}