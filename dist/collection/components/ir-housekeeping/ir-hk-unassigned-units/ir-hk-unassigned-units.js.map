{"version":3,"file":"ir-hk-unassigned-units.js","sourceRoot":"","sources":["../../../../src/components/ir-housekeeping/ir-hk-unassigned-units/ir-hk-unassigned-units.tsx"],"names":[],"mappings":"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","sourcesContent":["import { IHouseKeepers, IPropertyHousekeepingAssignment } from '@/models/housekeeping';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport calendar_data from '@/stores/calendar-data';\nimport housekeeping_store from '@/stores/housekeeping.store';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Prop, State, h } from '@stencil/core';\n\n@Component({\n  tag: 'ir-hk-unassigned-units',\n  styleUrls: ['ir-hk-unassigned-units.css', '../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IrHkUnassignedUnits {\n  @Prop() user: IHouseKeepers | null = null;\n\n  @State() renderAgain = false;\n\n  @Event() closeSideBar: EventEmitter<null>;\n  @Event() resetData: EventEmitter<null>;\n\n  private assignedUnits: Map<number, IPropertyHousekeepingAssignment> = new Map();\n  private housekeepingService = new HouseKeepingService();\n\n  assignUnit(unit_id: number, hk_id: number | null, checked: boolean) {\n    if (this.user) {\n      const userUnit = this.user.assigned_units.find(unit => unit.id === unit_id);\n      if ((checked && userUnit) || (!checked && !userUnit)) {\n        this.assignedUnits.delete(unit_id);\n      } else if (!checked && userUnit) {\n        this.assignedUnits.set(unit_id, { hkm_id: hk_id, is_to_assign: false, unit_id });\n      } else if (checked) {\n        const assignment: IPropertyHousekeepingAssignment = {\n          hkm_id: hk_id,\n          is_to_assign: true,\n          unit_id,\n        };\n        this.assignedUnits.set(unit_id, assignment);\n      }\n    } else {\n      if (this.assignedUnits.has(unit_id) && !hk_id) {\n        this.assignedUnits.delete(unit_id);\n        return;\n      } else {\n        this.assignedUnits.set(unit_id, {\n          hkm_id: hk_id,\n          is_to_assign: true,\n          unit_id,\n        });\n      }\n    }\n    this.renderAgain = !this.renderAgain;\n  }\n\n  async assignUnits() {\n    try {\n      await this.housekeepingService.manageExposedAssignedUnitToHKM(housekeeping_store.default_properties.property_id, [...this.assignedUnits.values()]);\n      this.resetData.emit(null);\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.closeSideBar.emit(null);\n    }\n  }\n  renderRooms() {\n    if (!this.user) {\n      return housekeeping_store.hk_criteria.units_assignments.unassigned_units?.map(unit => (\n        <tr key={unit.id}>\n          <td class=\"\">{unit.name}</td>\n          <td class=\"sr-only\"></td>\n          <td class=\"pl-1\">\n            <ir-select\n              onSelectChange={e => {\n                let hk_id = e.detail;\n                if (hk_id === '') {\n                  hk_id = null;\n                } else {\n                  hk_id = +hk_id;\n                }\n                this.assignUnit(unit.id, hk_id, false);\n              }}\n              data={housekeeping_store.hk_criteria.housekeepers.map(hk => ({ text: hk.name, value: hk.id.toString() }))}\n            ></ir-select>\n          </td>\n        </tr>\n      ));\n    }\n    return calendar_data.roomsInfo.map(roomType => {\n      console.log(roomType);\n      if (!roomType.is_active) {\n        return null;\n      }\n      return roomType.physicalrooms?.map(physical_room => {\n        if (!physical_room['is_active']) {\n          return null;\n        }\n        let taken = !housekeeping_store.hk_criteria.units_assignments.unassigned_units?.find(unit => unit.id.toString() === physical_room.id.toString());\n        let housekeeper = [];\n        const assignedRoom = this.assignedUnits.get(physical_room.id);\n        if (assignedRoom && assignedRoom.is_to_assign) {\n          housekeeper = [this.user];\n          taken = true;\n        } else {\n          if (taken) {\n            housekeeper = housekeeping_store.hk_criteria.housekeepers.filter(hk => hk.assigned_units.find(unit => unit.id === physical_room.id));\n          }\n        }\n        return (\n          <tr key={physical_room.id}>\n            <td>{physical_room.name}</td>\n            <td>{taken ? housekeeper[0]?.name : ''}</td>\n            <td>\n              <ir-switch\n                onCheckChange={e => {\n                  const checked = e.detail;\n                  this.assignUnit(physical_room.id, this.user.id, checked);\n                }}\n                checked={taken && housekeeper[0]?.id === this.user.id}\n              ></ir-switch>\n            </td>\n          </tr>\n        );\n      });\n    });\n  }\n  render() {\n    return (\n      <div class=\"sheet-container\">\n        <ir-title class=\"title sheet-header px-1\" displayContext=\"sidebar\" label={!this.user ? 'Assingn Units' : `Assignment for ${this.user.name}`}></ir-title>\n        <section class=\"px-1 sheet-body\">\n          <table>\n            <thead>\n              <th class=\"sr-only\">{locales.entries.Lcz_RoomName}</th>\n              <th class=\"sr-only\">{locales.entries.Lcz_HousekeeperName}</th>\n              <th class=\"sr-only\">{locales.entries.Lcz_Actions}</th>\n            </thead>\n            <tbody>{this.renderRooms()}</tbody>\n          </table>\n        </section>\n        <div class=\"sheet-footer\">\n          <ir-button\n            onClickHandler={() => this.closeSideBar.emit(null)}\n            class=\"flex-fill\"\n            btn_styles=\"w-100 justify-content-center align-items-center\"\n            btn_color=\"secondary\"\n            text={locales.entries.Lcz_Cancel}\n          ></ir-button>\n          <ir-button\n            isLoading={isRequestPending('/Manage_Exposed_Assigned_Unit_To_HKM')}\n            onClickHandler={this.assignUnits.bind(this)}\n            class=\"flex-fill\"\n            btn_styles=\"w-100  justify-content-center align-items-center\"\n            text={locales.entries.Lcz_Confirm}\n          ></ir-button>\n        </div>\n      </div>\n    );\n  }\n}\n"]}