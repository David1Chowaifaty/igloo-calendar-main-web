{"version":3,"file":"ir-hk-archive.js","sourceRoot":"","sources":["../../../../../src/components/ir-housekeeping/ir-hk-tasks/ir-hk-archive/ir-hk-archive.tsx"],"names":[],"mappings":"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","sourcesContent":["// import { HouseKeepingService } from '@/services/housekeeping.service';\r\n// import housekeeping_store from '@/stores/housekeeping.store';\r\nimport { ArchivedTask } from '@/models/housekeeping';\r\nimport { HouseKeepingService } from '@/services/housekeeping.service';\r\nimport calendar_data from '@/stores/calendar-data';\r\nimport housekeeping_store from '@/stores/housekeeping.store';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport locales from '@/stores/locales.store';\r\nimport { Component, Host, Listen, Prop, State, h } from '@stencil/core';\r\nimport moment from 'moment';\r\nimport { v4 } from 'uuid';\r\nexport type ArchivesFilters = {\r\n  from_date: string;\r\n  to_date: string;\r\n  filtered_by_hkm?: number[];\r\n  filtered_by_unit?: number[];\r\n};\r\n@Component({\r\n  tag: 'ir-hk-archive',\r\n  styleUrl: 'ir-hk-archive.css',\r\n  scoped: true,\r\n})\r\nexport class IrHkArchive {\r\n  @Prop() propertyId: string | number;\r\n\r\n  @State() filters: ArchivesFilters = {\r\n    from_date: moment().add(-90, 'days').format('YYYY-MM-DD'),\r\n    to_date: moment().format('YYYY-MM-DD'),\r\n    filtered_by_hkm: [],\r\n    filtered_by_unit: [],\r\n  };\r\n  @State() data: (ArchivedTask & { id: string })[] = [];\r\n  @State() isLoading: 'search' | 'excel' | null = null;\r\n\r\n  private houseKeepingService = new HouseKeepingService();\r\n  private units: { id: number; name: string }[] = [];\r\n\r\n  componentWillLoad() {\r\n    this.initializeData();\r\n    this.setUpUnits();\r\n  }\r\n  private setUpUnits() {\r\n    const units = [];\r\n    calendar_data.roomsInfo.forEach(r => {\r\n      r.physicalrooms.forEach(room => {\r\n        units.push({ id: room.id, name: room.name });\r\n      });\r\n    });\r\n    this.units = units;\r\n  }\r\n  private async initializeData() {\r\n    await this.getArchivedTasks();\r\n  }\r\n  private async getArchivedTasks() {\r\n    const res = await this.houseKeepingService.getArchivedHKTasks({ property_id: Number(this.propertyId), ...this.filters });\r\n    this.data = [...(res || [])]?.map(t => ({ ...t, id: v4() }));\r\n  }\r\n\r\n  @Listen('dateChanged')\r\n  handleDateRangeChange(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const { start, end } = e.detail;\r\n    this.updateFilters({\r\n      from_date: start.format('YYYY-MM-DD'),\r\n      to_date: end.format('YYYY-MM-DD'),\r\n    });\r\n  }\r\n\r\n  private updateFilters(props: Partial<ArchivesFilters>) {\r\n    this.filters = { ...this.filters, ...props };\r\n  }\r\n  async searchArchive(e: CustomEvent) {\r\n    try {\r\n      e.stopImmediatePropagation();\r\n      e.stopPropagation();\r\n      this.isLoading = 'search';\r\n      await this.getArchivedTasks();\r\n    } catch (error) {\r\n      console.log(error);\r\n    } finally {\r\n      this.isLoading = null;\r\n    }\r\n  }\r\n\r\n  async exportArchive(e: CustomEvent) {\r\n    try {\r\n      e.stopImmediatePropagation();\r\n      e.stopPropagation();\r\n      this.isLoading = 'excel';\r\n      this.getArchivedTasks();\r\n    } catch (error) {\r\n      console.log(error);\r\n    } finally {\r\n      this.isLoading = null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <ir-title class=\"px-1\" label=\"Cleaning Archives (90 days)\" displayContext=\"sidebar\"></ir-title>\r\n        <section class=\"px-1\">\r\n          <div class=\"d-flex\">\r\n            <ir-select\r\n              class=\"w-100\"\r\n              showFirstOption={false}\r\n              LabelAvailable={false}\r\n              data={[\r\n                { text: 'All units', value: '000' },\r\n                ,\r\n                ...this.units?.map(v => ({\r\n                  text: v.name,\r\n                  value: v.id.toString(),\r\n                })),\r\n              ]}\r\n              onSelectChange={e => {\r\n                e.stopImmediatePropagation();\r\n                e.stopPropagation();\r\n                if (e.detail === '000') {\r\n                  this.updateFilters({ filtered_by_unit: [] });\r\n                } else {\r\n                  this.updateFilters({ filtered_by_unit: [e.detail] });\r\n                }\r\n              }}\r\n            ></ir-select>\r\n            <ir-select\r\n              class=\"ml-1 w-100\"\r\n              selectedValue={this.filters?.filtered_by_hkm?.length === housekeeping_store.hk_criteria.housekeepers.length ? '000' : this.filters?.filtered_by_hkm[0]?.toString()}\r\n              LabelAvailable={false}\r\n              showFirstOption={false}\r\n              data={[\r\n                { text: 'All housekeepers', value: '000' },\r\n                ...housekeeping_store?.hk_criteria?.housekeepers.map(v => ({\r\n                  text: v.name,\r\n                  value: v.id.toString(),\r\n                })),\r\n              ]}\r\n              onSelectChange={e => {\r\n                if (e.detail === '000') {\r\n                  this.updateFilters({ filtered_by_hkm: [] });\r\n                } else {\r\n                  this.updateFilters({ filtered_by_hkm: [e.detail] });\r\n                }\r\n              }}\r\n            ></ir-select>\r\n          </div>\r\n          <div class=\"d-flex mt-1 align-items-center\">\r\n            <igl-date-range\r\n              class=\"mr-1\"\r\n              dateLabel={locales.entries.Lcz_Dates}\r\n              minDate={moment().add(-90, 'days').format('YYYY-MM-DD')}\r\n              defaultData={{\r\n                fromDate: this.filters.from_date,\r\n                toDate: this.filters.to_date,\r\n              }}\r\n            ></igl-date-range>\r\n            <ir-button\r\n              title={locales.entries?.Lcz_Search}\r\n              variant=\"icon\"\r\n              icon_name=\"search\"\r\n              class=\"mr-1\"\r\n              isLoading={this.isLoading === 'search'}\r\n              onClickHandler={e => this.searchArchive(e)}\r\n            ></ir-button>\r\n            <ir-button\r\n              title={locales.entries?.Lcz_ExportToExcel}\r\n              variant=\"icon\"\r\n              icon_name=\"file\"\r\n              isLoading={this.isLoading === 'excel'}\r\n              onClickHandler={e => this.exportArchive(e)}\r\n            ></ir-button>\r\n          </div>\r\n          {/* route to booking details */}\r\n          {this.data?.length === 0 && !isRequestPending('/Get_Archived_HK_Tasks') ? (\r\n            <p class={'text-center mt-2'}>No Results Found</p>\r\n          ) : (\r\n            <table class=\"mt-2\">\r\n              <thead>\r\n                <th class=\"sr-only\">period</th>\r\n                <th class=\"sr-only\">housekeeper name</th>\r\n                <th class=\"sr-only\">unit</th>\r\n                <th class=\"sr-only\">booking number</th>\r\n              </thead>\r\n              <tbody>\r\n                {this.data?.map(d => (\r\n                  <tr key={d.id}>\r\n                    <td class=\"pr-2\">{d.date}</td>\r\n                    <td class=\"px-2\">{d.house_keeper}</td>\r\n                    <td class=\"px-2\">{d.unit}</td>\r\n                    <td class=\"px-2\">\r\n                      {d.booking_nbr ? (\r\n                        <ir-button\r\n                          btn_color=\"link\"\r\n                          btnStyle={{\r\n                            width: 'fit-content',\r\n                            padding: '0',\r\n                            margin: '0',\r\n                          }}\r\n                          labelStyle={{\r\n                            padding: '0',\r\n                          }}\r\n                          text={d.booking_nbr.toString()}\r\n                          onClick={() => {\r\n                            window.open(`https://x.igloorooms.com/manage/acbookingeditV2.aspx?BN=${d.booking_nbr}`, '_blank');\r\n                          }}\r\n                        ></ir-button>\r\n                      ) : (\r\n                        'N/A'\r\n                      )}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          )}\r\n        </section>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"]}