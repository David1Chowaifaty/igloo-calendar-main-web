{"version":3,"file":"ir-hk-tasks.js","sourceRoot":"","sources":["../../../../src/components/ir-housekeeping/ir-hk-tasks/ir-hk-tasks.tsx"],"names":[],"mappings":"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","sourcesContent":["import { IPendingActions } from '@/models/housekeeping';\nimport { HouseKeepingService } from '@/services/housekeeping.service';\nimport { RoomService } from '@/services/room.service';\nimport housekeeping_store, { updateHKStore } from '@/stores/housekeeping.store';\nimport { Component, Host, Listen, Prop, State, Watch, h, Element } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-hk-tasks',\n  styleUrl: 'ir-hk-tasks.css',\n  scoped: true,\n})\nexport class IrHkTasks {\n  @Element() el: HTMLElement;\n\n  @Prop() language: string = '';\n  @Prop() ticket: string = '';\n  @Prop() baseurl: string = '';\n  @Prop() propertyid: number;\n\n  @State() isLoading = false;\n  @State() selectedDuration = '';\n  @State() selectedHouseKeeper = '0';\n  @State() selectedRoom: IPendingActions | null = null;\n\n  private modalOpenTimeOut: NodeJS.Timeout;\n  private roomService = new RoomService();\n  private houseKeepingService = new HouseKeepingService();\n\n  componentWillLoad() {\n    if (this.baseurl) {\n      axios.defaults.baseURL = this.baseurl;\n    }\n    if (this.ticket !== '') {\n      this.roomService.setToken(this.ticket);\n      this.houseKeepingService.setToken(this.ticket);\n      updateHKStore('default_properties', { token: this.ticket, property_id: this.propertyid, language: this.language });\n      this.initializeApp();\n    }\n  }\n\n  @Listen('resetData')\n  async handleResetData(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const { arrival, arrival_time, housekeeper, unit, status } = this.selectedRoom;\n    this.houseKeepingService.executeHKAction({\n      property_id: this.propertyid,\n      arrival,\n      arrival_time,\n      housekeeper: {\n        id: housekeeper.id,\n      },\n      status: {\n        code: status.code,\n      },\n      unit: {\n        id: unit.id,\n      },\n    });\n    await this.houseKeepingService.getExposedHKSetup(this.propertyid);\n  }\n\n  @Watch('ticket')\n  async ticketChanged(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.roomService.setToken(this.ticket);\n      this.houseKeepingService.setToken(this.ticket);\n      updateHKStore('default_properties', { token: this.ticket, property_id: this.propertyid, language: this.language });\n      this.initializeApp();\n    }\n  }\n  handleCheckChange(e: CustomEvent, action: IPendingActions) {\n    if (e.detail) {\n      this.selectedRoom = action;\n      this.modalOpenTimeOut = setTimeout(() => {\n        const modal = this.el.querySelector('ir-modal');\n        if (modal) {\n          (modal as HTMLIrModalElement).openModal();\n        }\n      }, 50);\n    }\n  }\n  disconnectedCallback() {\n    if (this.modalOpenTimeOut) {\n      clearTimeout(this.modalOpenTimeOut);\n    }\n  }\n  async getPendingActions() {\n    await this.houseKeepingService.getHKPendingActions({\n      property_id: this.propertyid,\n      bracket: {\n        code: this.selectedDuration,\n      },\n      housekeeper: {\n        id: +this.selectedHouseKeeper,\n      },\n    });\n  }\n  async initializeApp() {\n    try {\n      this.isLoading = true;\n      await Promise.all([\n        this.houseKeepingService.getExposedHKStatusCriteria(this.propertyid),\n        this.roomService.fetchData(this.propertyid, this.language),\n        this.roomService.fetchLanguage(this.language, ['_HK_FRONT']),\n      ]);\n      this.selectedDuration = housekeeping_store.hk_tasks.brackets[0].code;\n      await this.getPendingActions();\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  async handleConfirm(e: CustomEvent) {\n    e.preventDefault();\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    try {\n      await this.getPendingActions();\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.selectedRoom = null;\n    }\n  }\n  render() {\n    if (this.isLoading) {\n      return <ir-loading-screen></ir-loading-screen>;\n    }\n    return (\n      <Host>\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <section class=\"p-2\">\n          <ir-title label=\"Housekeeping Tasks\" justifyContent=\"space-between\">\n            <ir-button slot=\"title-body\" text={'Create task'} size=\"sm\"></ir-button>\n          </ir-title>\n          <div class=\"d-flex align-items-center mb-1\">\n            <ir-select\n              selectedValue={this.selectedDuration}\n              onSelectChange={e => {\n                this.selectedDuration = e.detail;\n                this.getPendingActions();\n              }}\n              data={housekeeping_store.hk_tasks.brackets.map(bracket => ({\n                text: bracket.description,\n                value: bracket.code,\n              }))}\n              showFirstOption={false}\n              LabelAvailable={false}\n            ></ir-select>\n            <ir-select\n              onSelectChange={e => {\n                this.selectedHouseKeeper = e.detail;\n                this.getPendingActions();\n              }}\n              selectedValue={this.selectedHouseKeeper}\n              data={[\n                { text: 'All housekeepers', value: '0' },\n                ...housekeeping_store.hk_tasks.housekeepers.map(bracket => ({\n                  text: bracket.name,\n                  value: bracket.id.toString(),\n                })),\n              ]}\n              showFirstOption={false}\n              LabelAvailable={false}\n              class=\"ml-2\"\n            ></ir-select>\n          </div>\n          <div class=\"card p-1\">\n            <div class=\"table-container\">\n              <table>\n                <thead>\n                  <th>Unit</th>\n                  <th>Status</th>\n                  <th>Arrival</th>\n                  <th>Arrival Time</th>\n                  <th>Housekeeper</th>\n                  <th class=\"text-center\">Done?</th>\n                </thead>\n                <tbody>\n                  {housekeeping_store.pending_housekeepers?.map(action => (\n                    <tr key={action.housekeeper.id}>\n                      <td>{action.unit.name}</td>\n                      <td>{action.status.description}</td>\n                      <td>{action.arrival}</td>\n                      <td>{action.arrival_time}</td>\n                      <td>{action.housekeeper.name}</td>\n                      <td>\n                        <div class=\"checkbox-container\">\n                          <ir-checkbox onCheckChange={e => this.handleCheckChange(e, action)} checked={this.selectedRoom?.unit.id === action.unit.id}></ir-checkbox>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </section>\n        {this.selectedRoom && (\n          <ir-modal\n            onConfirmModal={this.handleConfirm.bind(this)}\n            onCancelModal={() => (this.selectedRoom = null)}\n            modalBody={`Are you sure that room ${this.selectedRoom.unit.name} is cleaned?`}\n          ></ir-modal>\n        )}\n      </Host>\n    );\n  }\n}\n"]}