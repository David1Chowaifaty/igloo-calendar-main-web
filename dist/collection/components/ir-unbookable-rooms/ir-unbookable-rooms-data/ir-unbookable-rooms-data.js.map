{"version":3,"file":"ir-unbookable-rooms-data.js","sourceRoot":"","sources":["../../../../src/components/ir-unbookable-rooms/ir-unbookable-rooms-data/ir-unbookable-rooms-data.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, Prop, State, h } from '@stencil/core';\nimport { AllowedProperties, FetchUnBookableRoomsResult } from '@/services/property.service';\nimport { Debounce } from '@/decorators/debounce';\nimport moment from 'moment';\n\ntype UnbookableRoomsMode = 'default' | 'mpo';\ntype UnbookableRoomsFilters = { period_to_check: number; consecutive_period: number; country: string };\n\n@Component({\n  tag: 'ir-unbookable-rooms-data',\n  styleUrl: 'ir-unbookable-rooms-data.css',\n  scoped: true,\n})\nexport class IrUnbookableRoomsData {\n  @Prop({ reflect: true }) mode: UnbookableRoomsMode = 'default';\n  @Prop() isLoading = false;\n  @Prop() errorMessage = '';\n  @Prop() unbookableRooms: FetchUnBookableRoomsResult = [];\n  @Prop() allowedProperties: AllowedProperties = null;\n  @Prop() filters: UnbookableRoomsFilters = { period_to_check: 2, consecutive_period: 14, country: 'all' };\n  @Prop() progressFilters = { period_to_check: 2, consecutive_period: 14 };\n\n  @State() propertyNameFilter = '';\n\n  private todayFormatted = moment().format('MMM DD');\n\n  private getPropertyName(propertyId: number) {\n    if (!this.allowedProperties?.length) {\n      return `Property ${propertyId}`;\n    }\n    const match = this.allowedProperties.find(property => property.id === propertyId);\n    return match?.name ?? `Property ${propertyId}`;\n  }\n\n  private getPeriodOffset(firstNight: string): number {\n    if (!firstNight) return 0;\n\n    const today = moment().startOf('day');\n    const firstUnbookable = moment(firstNight, 'YYYY-MM-DD');\n\n    if (!firstUnbookable.isValid()) {\n      return 0;\n    }\n\n    const daysUntil = firstUnbookable.diff(today, 'days');\n\n    // Account for consecutive nights\n    const effectiveStart = daysUntil - (this.progressFilters.consecutive_period - 1);\n\n    const offset = (effectiveStart / (this.progressFilters.period_to_check * 30)) * 100;\n\n    return Math.max(0, Math.min(100, offset));\n  }\n\n  private getEndDateFormatted(): string {\n    return moment().add(this.progressFilters.period_to_check, 'months').format('MMM DD');\n  }\n\n  @Debounce(300)\n  private filterProperties(value: string): void {\n    this.propertyNameFilter = value?.trim().toLowerCase() ?? '';\n  }\n\n  render() {\n    const totalIssues = this.unbookableRooms?.length ?? 0;\n    const selectedCountryId = this.filters.country !== 'all' ? Number(this.filters.country) : null;\n    const hasCountryFilter = this.mode === 'mpo' && Number.isFinite(selectedCountryId);\n    const filteredRooms = hasCountryFilter ? this.unbookableRooms.filter(entry => entry.country?.id === selectedCountryId) : this.unbookableRooms;\n    const groupedByProperty = filteredRooms.reduce((acc, entry) => {\n      const list = acc.get(entry.property_id) ?? [];\n      acc.set(entry.property_id, [...list, entry]);\n      return acc;\n    }, new Map<number, FetchUnBookableRoomsResult>());\n    const groupedEntries = [...groupedByProperty.entries()].map(([propertyId, entries]) => ({\n      propertyId,\n      entries,\n      name: this.getPropertyName(propertyId),\n    }));\n    const sortedEntries = groupedEntries.sort(\n      (a, b) => a.name.localeCompare(b.name, undefined, { sensitivity: 'base' }) || a.propertyId - b.propertyId,\n    );\n    const filteredEntries =\n      this.mode === 'mpo' && this.propertyNameFilter ? sortedEntries.filter(item => item.name.toLowerCase().includes(this.propertyNameFilter)) : sortedEntries;\n\n    return (\n      <Host>\n        {!this.isLoading && !this.errorMessage && totalIssues === 0 && (\n          <wa-card class=\"unbookable-rooms__empty-state\">\n            <wa-icon name=\"check-circle\" class=\"unbookable-rooms__empty-state--icon\"></wa-icon>\n            <p>Hooray! Nothing to report.</p>\n          </wa-card>\n        )}\n        {totalIssues > 0 && (\n          <wa-card class=\"unbookable-rooms__card-container\">\n            {this.mode === 'mpo' && (\n              <ir-input\n                withClear\n                class=\"mb-2\"\n                onText-change={e => this.filterProperties(e.detail)}\n                style={{ maxWidth: '400px' }}\n                placeholder=\"Search properties\"\n                appearance=\"filled\"\n              >\n                <wa-icon slot=\"start\" name=\"magnifying-glass\"></wa-icon>\n              </ir-input>\n            )}\n            {filteredEntries.map(({ propertyId, entries }, i) => [\n              <article class=\"property-card\">\n                <wa-details\n                  name=\"issue-card\"\n                  onwa-hide={e => {\n                    e.stopImmediatePropagation();\n                    e.stopPropagation();\n                    if (this.mode === 'default') {\n                      e.preventDefault();\n                    }\n                  }}\n                  open={this.mode === 'default'}\n                  appearance=\"plain\"\n                  class=\"issue__detail\"\n                >\n                  {this.mode === 'mpo' && (\n                    <header slot=\"summary\" class=\"property-card__header\">\n                      <span>{this.getPropertyName(propertyId)}</span>\n                      <b>({entries.length}) </b>\n                    </header>\n                  )}\n                  <div class=\"property-card__body\">\n                    {entries.map(entry => [\n                      <div class=\"issue\">\n                        <div class=\"issue__info\">\n                          <span class=\"issue__room\">{entry.room_type_name}</span>\n                        </div>\n                        <div class=\"period-chart\">\n                          <span class=\"period-chart__start\">{this.todayFormatted}</span>\n\n                          <div class=\"period-chart__track\">\n                            <div\n                              title=\"available\"\n                              class=\"period-chart__fill\"\n                              style={{\n                                width: `${this.getPeriodOffset(entry.first_night_not_bookable)}%`,\n                              }}\n                            ></div>\n\n                            <div\n                              class=\"period-chart__marker\"\n                              style={{\n                                left: `${this.getPeriodOffset(entry.first_night_not_bookable)}%`,\n                              }}\n                            >\n                              <span class=\"period-chart__label\">{moment(entry.first_night_not_bookable, 'YYYY-MM-DD').format('MMM DD')}</span>\n                            </div>\n                          </div>\n\n                          <span class=\"period-chart__end\">{this.getEndDateFormatted()}</span>\n                        </div>\n                      </div>,\n                    ])}\n                  </div>\n                  <section class=\"period-chart__legend\">\n                    <div class=\"period-chart__legend-item\">\n                      <span class=\"period-chart__legend-swatch period-chart__legend-swatch--bookable\"></span>\n                      <span>Bookable period</span>\n                    </div>\n\n                    <div class=\"period-chart__legend-item\">\n                      <span class=\"period-chart__legend-swatch period-chart__legend-swatch--blocked\"></span>\n                      <span>Not bookable period</span>\n                    </div>\n                  </section>\n                </wa-details>\n              </article>,\n              i !== filteredEntries.length - 1 && <wa-divider></wa-divider>,\n            ])}\n          </wa-card>\n        )}\n      </Host>\n    );\n  }\n}\n"]}