{"version":3,"file":"ir-payment-option.js","sourceRoot":"","sources":["../../../src/components/ir-payment-option/ir-payment-option.tsx"],"names":[],"mappings":"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","sourcesContent":["import { PaymentOption } from '@/models/payment-options';\nimport { PaymentOptionService } from '@/services/payment_option.service';\nimport payment_option_store from '@/stores/payment-option.store';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-payment-option',\n  styleUrl: 'ir-payment-option.css',\n  scoped: true,\n})\nexport class IrPaymentOption {\n  @Prop() baseurl: string;\n  @Prop() propertyid: string;\n  @Prop() ticket: string;\n\n  @State() paymentOptions: PaymentOption[] = [];\n  @State() isLoading: boolean = false;\n  @State() selectedOption: PaymentOption | null = null;\n\n  private paymentOptionService = new PaymentOptionService();\n  propertyOptionsById: Map<string | number, PaymentOption>;\n  propertyOptionsByCode: Map<string | number, PaymentOption>;\n\n  componentWillLoad() {\n    axios.defaults.baseURL = this.baseurl;\n    if (this.ticket) {\n      this.init();\n    }\n  }\n  @Watch('ticket')\n  handleTokenChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.init();\n    }\n  }\n  init() {\n    this.initServices();\n    this.fetchData();\n  }\n  @Listen('closeModal')\n  handleCloseModal(e: CustomEvent) {\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    console.log(e.detail);\n    if (e.detail) {\n      const newOption: PaymentOption = e.detail;\n      this.modifyPaymentList(newOption);\n      if (newOption.is_payment_gateway) {\n        this.propertyOptionsById.set(newOption.id, newOption);\n      } else {\n        this.propertyOptionsByCode.set(newOption.code, newOption);\n      }\n    } else {\n      if (!this.propertyOptionsByCode.has(payment_option_store.selectedOption?.code) && !this.propertyOptionsById.has(payment_option_store.selectedOption?.id)) {\n        this.modifyPaymentList({ ...payment_option_store.selectedOption, is_active: false });\n      }\n    }\n    payment_option_store.selectedOption = null;\n  }\n  async fetchData() {\n    try {\n      this.isLoading = true;\n      const [paymentOptions, propertyOptions] = await Promise.all([\n        this.paymentOptionService.GetExposedPaymentMethods(),\n        this.paymentOptionService.GetPropertyPaymentMethods(this.propertyid),\n      ]);\n      this.propertyOptionsById = new Map(propertyOptions.map(o => [o.id, o]));\n      this.propertyOptionsByCode = new Map(propertyOptions.map(o => [o.code, o]));\n      this.paymentOptions = paymentOptions?.map(option => {\n        if (option.is_payment_gateway) {\n          return this.propertyOptionsById.get(option.id) || option;\n        }\n        return this.propertyOptionsByCode.get(option.code) || option;\n      });\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  initServices() {\n    payment_option_store.token = this.ticket;\n    this.paymentOptionService.setToken(this.ticket);\n  }\n  private modifyPaymentList(paymentOption: PaymentOption) {\n    this.paymentOptions = [\n      ...this.paymentOptions.map(p => {\n        if ((paymentOption.is_payment_gateway && p.id === paymentOption.id) || (paymentOption.code === '005' && p.code === '005')) {\n          return paymentOption;\n        }\n        return p;\n      }),\n    ];\n  }\n  async handleCheckChange(e: CustomEvent, po: PaymentOption) {\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n\n    const is_active = e.detail;\n    const newOption = { ...po, is_active, property_id: this.propertyid };\n\n    if (po.code !== '005' && !po.is_payment_gateway) {\n      await this.paymentOptionService.HandlePaymentMethod(newOption);\n      this.modifyPaymentList(newOption);\n      return;\n    }\n\n    if (!this.showEditButton(po, true)) {\n      this.modifyPaymentList(newOption);\n      return;\n    }\n    console.log('here');\n    if (is_active && po.data?.some(d => d.value === null)) {\n      payment_option_store.selectedOption = newOption;\n    } else {\n      await this.paymentOptionService.HandlePaymentMethod(newOption);\n    }\n    this.modifyPaymentList(newOption);\n  }\n  showEditButton(po: PaymentOption, ignoreActive = false) {\n    if (!po.is_active && !ignoreActive) {\n      return false;\n    }\n\n    return po.code === '005' || (po.is_payment_gateway && po.data?.length > 0);\n  }\n  render() {\n    if (this.isLoading || this.paymentOptions.length == 0) {\n      return (\n        <div class=\"h-screen bg-white d-flex flex-column align-items-center justify-content-center\">\n          <ir-loading-screen></ir-loading-screen>\n        </div>\n      );\n    }\n    return (\n      <Host class=\"p-2\">\n        <ir-interceptor></ir-interceptor>\n        <div class=\"card p-1 flex-fill m-0\">\n          <div class=\"d-flex align-items-center mb-2\">\n            <div class=\"p-0 m-0 mr-1\">\n              <ir-icons name=\"credit_card\"></ir-icons>\n            </div>\n            <h3 class={'m-0 p-0'}> Payment Options</h3>\n          </div>\n          <table class=\"table table-striped table-bordered no-footer dataTable\">\n            <thead>\n              <tr>\n                <th scope=\"col\" class=\"text-left\">\n                  Payment method\n                </th>\n                <th scope=\"col\">Status</th>\n                <th scope=\"col\" class=\"actions-theader\">\n                  Action\n                </th>\n              </tr>\n            </thead>\n            <tbody class=\"\">\n              {this.paymentOptions?.map(po => (\n                <tr key={po.id}>\n                  <td class={'text-left po-description'}>{po.description}</td>\n                  <td>\n                    <ir-switch checked={po.is_active} onCheckChange={e => this.handleCheckChange(e, po)}></ir-switch>\n                  </td>\n                  <td>\n                    {this.showEditButton(po) && (\n                      <ir-button\n                        variant=\"icon\"\n                        icon_name=\"edit\"\n                        onClickHanlder={() => {\n                          payment_option_store.selectedOption = po;\n                        }}\n                      ></ir-button>\n                    )}\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n        <ir-sidebar\n          onIrSidebarToggle={() => {\n            payment_option_store.selectedOption = null;\n          }}\n          label={`${payment_option_store.selectedOption?.description} Information`}\n          open={payment_option_store.selectedOption !== null}\n        >\n          {payment_option_store.selectedOption && <ir-option-details propertyId={this.propertyid} slot=\"sidebar-body\"></ir-option-details>}\n        </ir-sidebar>\n      </Host>\n    );\n  }\n}\n"]}