{"version":3,"file":"ir-reallocation-form.js","sourceRoot":"","sources":["../../../../src/components/ir-reallocation-drawer/ir-reallocation-form/ir-reallocation-form.tsx"],"names":[],"mappings":"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","sourcesContent":["import { SelectedUnit, SelectedUnitSchema } from '@/components/igloo-calendar/igl-split-booking/types';\nimport { Booking, IUnit, Room } from '@/models/booking.dto';\nimport { PropertyRoomType } from '@/models/IBooking';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { EventsService } from '@/services/events.service';\nimport { resetBookingStore } from '@/stores/booking.store';\nimport calendar_data from '@/stores/calendar-data';\nimport locales from '@/stores/locales.store';\nimport { calculateDaysBetweenDates } from '@/utils/booking';\nimport { checkMealPlan, SelectOption } from '@/utils/utils';\nimport { Component, Event, EventEmitter, Fragment, Prop, State, h } from '@stencil/core';\nimport moment, { Moment } from 'moment';\nimport { ZodError } from 'zod';\n\n@Component({\n  tag: 'ir-reallocation-form',\n  styleUrl: 'ir-reallocation-form.css',\n  scoped: true,\n})\nexport class IrReallocationForm {\n  @Prop() booking: Booking;\n  @Prop() identifier: string;\n  @Prop() pool: string;\n  @Prop() formId: string;\n\n  @State() date: Moment;\n  @State() isLoading: boolean;\n  @State() room: Room;\n  @State() roomTypes: PropertyRoomType[] = [];\n  @State() selectedUnit: Partial<SelectedUnit> = {};\n  @State() errors: Record<string, boolean> | null;\n  @State() mealPlanOptions: SelectOption[] | null = null;\n\n  @Event({ bubbles: true, composed: true }) closeModal: EventEmitter<null>;\n\n  private bookingService = new BookingService();\n  private eventsService = new EventsService();\n\n  componentWillLoad() {\n    this.room = this.getRoom();\n    this.date = moment(this.room.from_date, 'YYYY-MM-DD');\n    this.checkBookingAvailability();\n  }\n\n  private getRoom() {\n    if (!this.booking) {\n      throw new Error('Missing booking');\n    }\n    if (!this.identifier) {\n      throw new Error('Missing Identifier');\n    }\n    const room = this.booking.rooms.find(r => r.identifier === this.identifier);\n    if (!room) {\n      throw new Error(`Couldn't find room with identifier ${this.identifier}`);\n    }\n    return room;\n  }\n\n  private async checkBookingAvailability() {\n    this.isLoading = true;\n    resetBookingStore(false);\n    const is_in_agent_mode = this.booking.agent !== null;\n    const { from_date, to_date } = this.getDates();\n    try {\n      const data = await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: this.booking.property.id,\n        adultChildCount: {\n          adult: 1,\n          child: 0,\n        },\n        language: 'en',\n        room_type_ids: [],\n        currency: this.booking.currency,\n        agent_id: is_in_agent_mode ? this.booking.agent.id : null,\n        is_in_agent_mode,\n        room_type_ids_to_update: [],\n      });\n      this.roomTypes = (data as any as PropertyRoomType[]).filter(r => r.is_available_to_book);\n      this.isLoading = false;\n    } catch (error) {\n      console.error('Error initializing booking availability:', error);\n    }\n  }\n\n  private getDates(): { from_date: string; to_date: string } {\n    return {\n      from_date: this.date.clone().format('YYYY-MM-DD'),\n      to_date: this.date.clone().add(calculateDaysBetweenDates(this.room.from_date, this.room.to_date), 'days').format('YYYY-MM-DD'),\n    };\n  }\n\n  private async reallocateUnit() {\n    try {\n      this.errors = null;\n      const selectedUnit = SelectedUnitSchema.parse(this.selectedUnit);\n      const { from_date, to_date } = this.getDates();\n      await this.eventsService.reallocateEvent(this.pool, selectedUnit.unit_id, from_date, to_date, selectedUnit.rateplan_id);\n      this.closeModal.emit(null);\n    } catch (error) {\n      const err: Record<string, boolean> = {};\n      if (error instanceof ZodError) {\n        console.error(error);\n        error.issues.forEach(i => {\n          err[i.path[0]] = true;\n        });\n        this.errors = { ...err };\n      }\n    }\n  }\n\n  private updateSelectedUnit(params: Partial<SelectedUnit>) {\n    const merged: Partial<SelectedUnit> = { ...this.selectedUnit, ...params };\n    const roomTypesSource = calendar_data?.property?.roomtypes;\n    const mealPlanResult = checkMealPlan({\n      rateplan_id: this.room.rateplan.id.toString(),\n      roomTypeId: merged?.roomtype_id,\n      roomTypes: roomTypesSource,\n    });\n\n    const hasExplicitRateplanUpdate = Object.prototype.hasOwnProperty.call(params, 'rateplan_id');\n\n    if (Array.isArray(mealPlanResult)) {\n      this.mealPlanOptions = mealPlanResult;\n      if (!hasExplicitRateplanUpdate) {\n        delete merged.rateplan_id;\n      }\n    } else {\n      this.mealPlanOptions = null;\n      if (!hasExplicitRateplanUpdate) {\n        if (mealPlanResult) {\n          merged.rateplan_id = Number(mealPlanResult.value);\n        } else {\n          delete merged.rateplan_id;\n        }\n      }\n    }\n\n    this.selectedUnit = merged;\n  }\n  // private get minDate() {\n  //   if (!this.booking.is_direct) {\n  //     return this.booking.from_date;\n  //   }\n  //   const MFromDate = moment(this.room.from_date, 'YYYY-MM-DD');\n  //   const today = moment();\n  //   if (MFromDate.isBefore(today)) {\n  //     return MFromDate.format('YYYY-MM-DD');\n  //   }\n  //   return today.format('YYYY-MM-DD');\n  // }\n  // private get maxDate() {\n  //   if (this.booking.is_direct) {\n  //     return;\n  //   }\n  //   return this.booking.from_date;\n  // }\n  render() {\n    if (this.isLoading) {\n      return (\n        <div class=\"drawer__loader-container\">\n          <ir-spinner></ir-spinner>\n        </div>\n      );\n    }\n    return (\n      <form\n        id={this.formId}\n        class=\"reallocation-form\"\n        onSubmit={e => {\n          e.preventDefault();\n          this.reallocateUnit();\n        }}\n      >\n        <div class=\"booking-summary\">\n          <ir-date-view from_date={this.room.from_date} to_date={this.room.to_date} showDateDifference={false}></ir-date-view>\n          <p style={{ padding: '0', margin: '0' }}>\n            <span>From: </span>\n            <span class=\"rateplan-details\">\n              {this.room.roomtype.name} {this.room.rateplan.short_name} {this.room.rateplan.is_non_refundable ? locales.entries.Lcz_NonRefundable : ''}{' '}\n              <span class=\"rateplan-details-unit\">{(this.room.unit as IUnit).name}</span>\n            </span>\n          </p>\n        </div>\n        {/* <div class=\"date-picker-row\">\n          <ir-custom-date-picker\n            data-testid=\"pickup_arrival_date\"\n            date={this.date?.format('YYYY-MM-DD')}\n            // maxDate={this.defaultDates?.to_date.format('YYYY-MM-DD')}\n            minDate={this.minDate}\n            maxDate={this.maxDate}\n            emitEmptyDate={true}\n            label=\"From:\"\n            onDateChanged={evt => {\n              this.date = evt.detail.start;\n            }}\n          ></ir-custom-date-picker>\n          <ir-custom-button variant=\"brand\" loading={isRequestPending('/Check_Availability')} onClickHandler={() => this.checkBookingAvailability()}>\n            Check available units\n          </ir-custom-button>\n        </div> */}\n        {this.errors?.roomtype_id && <p class=\"error-message\">Please select a room</p>}\n        {this.roomTypes.length === 0 ? (\n          <ir-empty-state style={{ marginTop: '20vh' }}></ir-empty-state>\n        ) : (\n          <wa-radio-group\n            onchange={e => {\n              const [roomtype_id, unit_id] = (e.target as any).value.split('_');\n              this.updateSelectedUnit({\n                roomtype_id: Number(roomtype_id),\n                unit_id: Number(unit_id),\n              });\n            }}\n            name=\"available-units\"\n            class=\"room-type-list\"\n          >\n            <p style={{ margin: '0', padding: '0', marginBottom: '0.5rem' }}>To:</p>\n            {this.roomTypes?.map(roomType => {\n              const units = (() => {\n                const unitMap = new Map<number, string>();\n                for (const rateplan of roomType.rateplans ?? []) {\n                  for (const unit of rateplan.assignable_units ?? []) {\n                    if (unit.Is_Fully_Available) {\n                      unitMap.set(unit.pr_id, unit.name);\n                    }\n                  }\n                }\n\n                return Array.from(unitMap, ([id, name]) => ({ id, name }));\n              })();\n              return (\n                <Fragment>\n                  <div key={`roomTypeRow-${roomType.id}`} class={`room-type-row`}>\n                    <div class={'choice-row'}>\n                      <span class=\"room-type-name\">{roomType.name}</span>\n                    </div>\n                  </div>\n                  {units.map((room, j) => {\n                    const isLastUnit = j === units.length - 1;\n                    const showMealPlanSelect = this.selectedUnit?.unit_id === room.id && Array.isArray(this.mealPlanOptions) && this.mealPlanOptions.length > 0;\n                    return (\n                      <wa-radio\n                        value={`${roomType.id}_${room.id}`}\n                        checked={this.selectedUnit?.unit_id === room.id}\n                        key={`physicalRoom-${room.id}-${j}`}\n                        class={`physical-room${isLastUnit ? ' physical-room--last' : ''}`}\n                      >\n                        <span>{room.name}</span>\n                        {showMealPlanSelect && (\n                          <ir-validator value={this.selectedUnit?.rateplan_id} schema={SelectedUnitSchema.shape.rateplan_id}>\n                            <wa-select\n                              size=\"small\"\n                              placeholder=\"Select a new rateplan...\"\n                              value={this.selectedUnit?.rateplan_id?.toString()}\n                              onchange={e => {\n                                e.stopImmediatePropagation();\n                                e.stopPropagation();\n                                this.updateSelectedUnit({\n                                  rateplan_id: Number((e.target as HTMLSelectElement).value),\n                                });\n                              }}\n                            >\n                              {this.mealPlanOptions.map(option => {\n                                return <wa-option value={option.value?.toString()}>{option.text + `${option.custom_text ? ' | ' : ''}${option.custom_text}`}</wa-option>;\n                              })}\n                            </wa-select>\n                          </ir-validator>\n                        )}\n                      </wa-radio>\n                    );\n                  })}\n                </Fragment>\n              );\n            })}\n          </wa-radio-group>\n        )}\n      </form>\n    );\n  }\n}\n"]}