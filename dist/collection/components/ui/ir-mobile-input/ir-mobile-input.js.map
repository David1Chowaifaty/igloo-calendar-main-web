{"version":3,"file":"ir-mobile-input.js","sourceRoot":"","sources":["../../../../src/components/ui/ir-mobile-input/ir-mobile-input.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { ICountry } from '@/models/IBooking';\nimport { NativeWaInput } from '../ir-input/ir-input';\n\nexport interface IrMobileInputChangeDetail {\n  country: ICountry;\n  value: string;\n  formattedValue: string;\n}\n\n@Component({\n  tag: 'ir-mobile-input',\n  styleUrls: ['ir-mobile-input.css'],\n  shadow: true,\n})\nexport class IrMobileInput {\n  @Element() el: HTMLIrMobileInputElement;\n  private static idCounter = 0;\n  private readonly componentId = ++IrMobileInput.idCounter;\n  private readonly inputId = `ir-mobile-input-${this.componentId}`;\n  private readonly labelId = `${this.inputId}-label`;\n  private readonly descriptionId = `${this.inputId}-description`;\n  private readonly errorId = `${this.inputId}-error`;\n  private readonly countryStatusId = `${this.inputId}-country-status`;\n\n  /** The input's size. */\n  @Prop({ reflect: true }) size: NativeWaInput['size'] = 'small';\n  /** Visible label for the phone input */\n  @Prop() label: string = 'Phone number';\n  /** Name attribute passed to the native input */\n  @Prop() name: string = 'phone';\n  /** Placeholder shown when the input is empty */\n  @Prop() placeholder: string = 'Enter phone number';\n  /** Help text rendered under the label */\n  @Prop() description?: string;\n  /** Error message announced to screen readers */\n  @Prop() error?: string;\n  /** Native required attribute */\n  @Prop({ reflect: true }) required: boolean = false;\n  /** Whether the control is disabled */\n  @Prop({ reflect: true }) disabled: boolean = false;\n  /** Selected country ISO code. Component updates this prop when a new country is chosen */\n  @Prop({ mutable: true, reflect: true }) countryCode?: string;\n  /** Input value without formatting. Component keeps this prop in sync */\n  @Prop({ mutable: true, reflect: true }) value: string = '';\n  /**\n   * Country list, used to populate prefix and dropdown.\n   * If not provided, fetched from the booking service.\n   */\n  @Prop({ mutable: true }) countries: ICountry[] = [];\n\n  @Event({ eventName: 'mobile-input-change' }) mobileInputChange!: EventEmitter<IrMobileInputChangeDetail>;\n  @Event({ eventName: 'mobile-input-country-change' }) mobileInputCountryChange!: EventEmitter<ICountry>;\n\n  @State() selectedCountry?: ICountry;\n  @State() isInvalid: boolean = false;\n\n  componentWillLoad() {\n    const resolvedCountry: ICountry | null = this.resolveCountry(this.countryCode) ?? null;\n    if (!resolvedCountry) {\n      return;\n    }\n    if (this.el.hasAttribute('aria-invalid')) {\n      this.isInvalid = Boolean(JSON.parse(this.el.getAttribute('aria-invalid')));\n    }\n    this.selectedCountry = resolvedCountry;\n    this.countryCode = resolvedCountry?.code;\n    this.value = this.value ?? '';\n  }\n\n  @Watch('countryCode')\n  protected handleCountryCodeChange(nextCode?: string) {\n    const resolvedCountry = this.resolveCountry(nextCode);\n    if (resolvedCountry && resolvedCountry !== this.selectedCountry) {\n      this.selectedCountry = resolvedCountry;\n    }\n  }\n\n  @Watch('selectedCountry')\n  protected handleSelectedCountryChange(next?: ICountry, previous?: ICountry) {\n    if (!next) return;\n    if (!previous || next.code !== previous.code) {\n      if (this.countryCode !== next.code) {\n        this.countryCode = next.code;\n      }\n      this.mobileInputCountryChange.emit(next);\n    }\n  }\n\n  @Watch('value')\n  protected handleValueChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.value = newValue ?? '';\n    }\n  }\n\n  @Watch('aria-invalid')\n  handleAriaInvalidChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.isInvalid = Boolean(newValue);\n    }\n  }\n\n  private resolveCountry(code?: string) {\n    if (!code) return undefined;\n    return this.countries.find(country => country.code.toUpperCase() === code.toUpperCase());\n  }\n  // private emitChange() {\n  //   if (!this.selectedCountry) return;\n  //   this.mobileInputChange.emit({\n  //     country: this.selectedCountry,\n  //     value: this.value ?? '',\n  //     formattedValue: this.value ?? '',\n  //   });\n  // }\n\n  private handleCountrySelect = (event: CustomEvent) => {\n    if (this.disabled) return;\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n    const value = (event.detail as any)?.item?.value;\n    const selected = this.countries.find(country => country.id.toString() === `${value}`);\n    if (selected) {\n      this.selectedCountry = selected;\n    }\n    requestAnimationFrame(() => {\n      const innerInput = this.el.shadowRoot?.querySelector('ir-input')?.shadowRoot?.querySelector('input') as HTMLInputElement | undefined;\n      innerInput?.focus();\n    });\n  };\n\n  // private handlePlainInput = (event: Event) => {\n  //   const { value } = event.target as HTMLInputElement;\n  //   this.mobileInputChange.emit({ formattedValue: value, value, country: this.selectedCountry });\n  //   if (this.mask) return;\n  //   const nextValue = (event.target as HTMLInputElement)?.value ?? '';\n  //   if (nextValue !== this.value) {\n  //     this.value = nextValue;\n  //     this.displayValue = nextValue;\n  //     this.emitChange();\n  //   }\n  // };\n\n  render() {\n    const describedByIds = [this.description ? this.descriptionId : null, this.error ? this.errorId : null].filter(Boolean).join(' ') || undefined;\n\n    return (\n      <Host size={'small'} role=\"group\" aria-labelledby={this.labelId} aria-describedby={describedByIds}>\n        <label class=\"mobile-input__label\" id={this.labelId} htmlFor={this.inputId}>\n          {this.label}\n          {this.required ? (\n            <span class=\"mobile-input__required\" aria-hidden=\"true\">\n              *\n            </span>\n          ) : null}\n        </label>\n        {this.description ? (\n          <p id={this.descriptionId} class=\"mobile-input__description\">\n            {this.description}\n          </p>\n        ) : null}\n        <div class={{ 'mobile-input__container': true, 'mobile-input__container--disabled': this.disabled }}>\n          <wa-dropdown\n            onwa-show={e => {\n              e.stopPropagation();\n              e.stopImmediatePropagation();\n            }}\n            onwa-hide={e => {\n              e.stopPropagation();\n              e.stopImmediatePropagation();\n            }}\n            onwa-select={this.handleCountrySelect}\n            class=\"mobile-input__prefix-dropdown\"\n          >\n            <button\n              aria-invalid={String(this.isInvalid && !this.selectedCountry)}\n              slot=\"trigger\"\n              type=\"button\"\n              class=\"mobile-input__trigger\"\n              disabled={this.disabled}\n              aria-haspopup=\"listbox\"\n              aria-label=\"Change country calling code\"\n            >\n              <div class=\"mobile-input__phone-country\" style={{ marginRight: '1rem' }}>\n                {this.selectedCountry ? <img src={this.selectedCountry?.flag} alt={this.selectedCountry?.name} class=\"mobile-input__logo\" /> : <span>Select</span>}\n                {/* <span aria-hidden=\"true\">{this.selectedCountry?.phone_prefix}</span> */}\n              </div>\n              <wa-icon class=\"mobile-input__phone-country-caret\" name=\"chevron-down\" aria-hidden=\"true\"></wa-icon>\n            </button>\n            <span class=\"sr-only\" id={this.countryStatusId} aria-live=\"polite\">\n              {this.selectedCountry ? `Selected country ${this.selectedCountry.name} ${this.selectedCountry.phone_prefix}` : 'Select a country'}\n            </span>\n            {this.countries.map(country => (\n              <wa-dropdown-item value={country.id.toString()}>\n                <div class=\"mobile-input__phone-country\" role=\"option\" aria-selected={this.selectedCountry?.id === country.id ? 'true' : 'false'}>\n                  <img src={country.flag} alt={country.name} class=\"mobile-input__logo\" />\n                  <span class=\"mobile-input__country-name\">{country.name}</span>\n                  <span class=\"mobile-input__country-prefix\">{country.phone_prefix}</span>\n                </div>\n              </wa-dropdown-item>\n            ))}\n          </wa-dropdown>\n          <ir-input\n            aria-invalid={String(this.isInvalid && (this.value ?? '').length < 4)}\n            type=\"tel\"\n            inputMode=\"tel\"\n            autocomplete=\"off\"\n            disabled={this.disabled}\n            placeholder={this.placeholder}\n            defaultValue={this.value}\n            value={this.value}\n            class=\"phone__input\"\n            onText-change={e => {\n              const value = e.detail;\n              this.value = value;\n              this.mobileInputChange.emit({ formattedValue: value, value, country: this.selectedCountry });\n            }}\n          >\n            {this.selectedCountry && <span slot=\"start\">{this.selectedCountry?.phone_prefix}</span>}\n          </ir-input>\n        </div>\n        {this.error ? (\n          <p id={this.errorId} class=\"mobile-input__error\" role=\"alert\">\n            {this.error}\n          </p>\n        ) : null}\n      </Host>\n    );\n  }\n}\n"]}