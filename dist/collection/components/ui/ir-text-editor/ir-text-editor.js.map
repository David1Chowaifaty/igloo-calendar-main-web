{"version":3,"file":"ir-text-editor.js","sourceRoot":"","sources":["../../../../src/components/ui/ir-text-editor/ir-text-editor.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, Element, Event, EventEmitter, Prop, Watch, State } from '@stencil/core';\nimport Quill, { QuillOptions } from 'quill';\n\nexport type QuillToolbarButton = 'bold' | 'italic' | 'underline' | 'strike' | 'link' | 'image' | 'video' | 'clean';\n\nexport interface ToolbarConfig {\n  bold?: boolean;\n  italic?: boolean;\n  underline?: boolean;\n  strike?: boolean;\n  link?: boolean;\n  image?: boolean;\n  video?: boolean;\n  clean?: boolean;\n}\n\nfunction buildToolbar(config: ToolbarConfig): any[] {\n  const toolbar = [];\n  const textFormats: string[] = [];\n  if (config.bold) textFormats.push('bold');\n  if (config.italic) textFormats.push('italic');\n  if (config.underline) textFormats.push('underline');\n  if (config.strike) textFormats.push('strike');\n  if (textFormats.length) {\n    toolbar.push(textFormats);\n  }\n  if (config.link) toolbar.push(['link']);\n  if (config.image) toolbar.push(['image']);\n  if (config.video) toolbar.push(['video']);\n  if (config.clean) toolbar.push(['clean']);\n  return toolbar;\n}\n@Component({\n  tag: 'ir-text-editor',\n  styleUrls: ['ir-text-editor.css', 'quill.snow.css'],\n  shadow: false,\n})\nexport class IrTextEditor {\n  @Element() el: HTMLElement;\n\n  @Prop() error: boolean;\n\n  @Prop() maxLength: number;\n\n  /** Initial HTML content */\n  @Prop() value: string = '';\n\n  /** If true, makes the editor read-only */\n  @Prop() readOnly: boolean = false;\n\n  /** Determines if the current user can edit the content */\n  @Prop() userCanEdit: boolean = true;\n\n  /** Placeholder text */\n  @Prop() placeholder: string;\n\n  /**\n   * Type-safe toolbar configuration.\n   * For example, you can pass:\n   *\n   * {\n   *   bold: true,\n   *   italic: true,\n   *   underline: true,\n   *   strike: false,\n   *   link: true,\n   *   clean: true\n   * }\n   */\n  @Prop() toolbarConfig?: ToolbarConfig;\n\n  /** Emits current HTML content whenever it changes */\n  @Event() textChange: EventEmitter<string>;\n\n  @State() editorValue = '';\n\n  /** Private, non-reactive Quill editor instance */\n  private editor: Quill;\n\n  private editorContainer!: HTMLDivElement;\n\n  componentDidLoad() {\n    const options: QuillOptions = {\n      modules: {\n        toolbar: {\n          container: this.computedToolbar,\n          handlers: {\n            undo: () => {\n              if (this.editor) {\n                this.editor.history.undo();\n                this.updateHistoryButtons();\n              }\n            },\n            redo: () => {\n              if (this.editor) {\n                this.editor.history.redo();\n                this.updateHistoryButtons();\n              }\n            },\n          },\n        },\n        history: {\n          delay: 1000,\n          maxStack: 100,\n          userOnly: true,\n        },\n      },\n      placeholder: this.placeholder,\n      readOnly: !this.userCanEdit || this.readOnly,\n      theme: 'snow',\n    };\n    const icons = Quill.import('ui/icons');\n    icons['undo'] =\n      '<svg title=\"undo\" xmlns=\"http://www.w3.org/2000/svg\" height=\"18\" width=\"18\" viewBox=\"0 0 512 512\"><path class=\"ql-fill\" d=\"M48.5 224L40 224c-13.3 0-24-10.7-24-24L16 72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2L98.6 96.6c87.6-86.5 228.7-86.2 315.8 1c87.5 87.5 87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3c-62.2-62.2-162.7-62.5-225.3-1L185 183c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8L48.5 224z\" /></svg>'; // Replace '...' with actual SVG path\n    icons['redo'] =\n      '<svg title=\"redo\" xmlns=\"http://www.w3.org/2000/svg\" height=\"18\" width=\"18\" viewBox=\"0 0 512 512\"><path class=\"ql-fill\" d=\"M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z\"/></svg>';\n    this.editor = new Quill(this.editorContainer, options);\n    (this.editor.getModule('toolbar') as any).addHandler('undo', () => {\n      this.editor.history.undo();\n    });\n    (this.editor.getModule('toolbar') as any).addHandler('redo', () => {\n      this.editor.history.redo();\n    });\n    if (this.value) {\n      this.setEditorValue(this.value);\n    }\n    this.editor.on('text-change', (_, __, source) => {\n      if (source === 'user' && this.maxLength) {\n        const plainText = this.editor.getText();\n        const effectiveLength = plainText.endsWith('\\n') ? plainText.length - 1 : plainText.length;\n        if (effectiveLength > this.maxLength) {\n          const excess = effectiveLength - this.maxLength;\n          this.editor.deleteText(this.maxLength, excess, 'user');\n          return;\n        }\n      }\n      const html = this.editor.root.innerHTML;\n      this.editorValue = html;\n      this.textChange.emit(html);\n    });\n  }\n\n  @Watch('value')\n  handleValueChange(newValue: string, oldValue: string) {\n    if (!newValue) {\n      this.setEditorValue(newValue);\n      return;\n    }\n    if (newValue !== oldValue && newValue !== this.editorValue) {\n      this.setEditorValue(newValue);\n    }\n  }\n  @Watch('readOnly')\n  onReadOnlyChange(newVal: boolean) {\n    if (this.editor) {\n      this.editor.enable(this.userCanEdit && !newVal);\n    }\n  }\n\n  @Watch('userCanEdit')\n  onUserCanEditChange(newVal: boolean) {\n    if (this.editor) {\n      this.editor.enable(newVal && !this.readOnly);\n    }\n  }\n\n  disconnectedCallback() {\n    if (this.editor) {\n      this.editor = null;\n    }\n  }\n  private get computedToolbar() {\n    return this.toolbarConfig ? buildToolbar(this.toolbarConfig) : [[{ undo: 'ql-undo' }, { redo: 'ql-redo' }], ['bold', 'italic', 'underline', 'strike'], ['link'], ['clean']];\n  }\n  private setEditorValue(value: string) {\n    if (!this.editor) {\n      return;\n    }\n    this.editor.clipboard.dangerouslyPasteHTML(value);\n    requestAnimationFrame(() => {\n      const length = this.editor.getLength();\n      this.editor.setSelection(length - 1, 0);\n    });\n  }\n  private updateHistoryButtons() {\n    const undoButton = this.el.querySelector('.ql-undo') as HTMLButtonElement;\n    const redoButton = this.el.querySelector('.ql-redo') as HTMLButtonElement;\n    if (!this.editor) return;\n\n    // Disable undo if there is no undo history\n    if (this.editor.history.stack.undo.length === 0) {\n      undoButton && (undoButton.disabled = true);\n    } else {\n      undoButton && (undoButton.disabled = false);\n    }\n\n    // Disable redo if there is no redo history\n    if (this.editor.history.stack.redo.length === 0) {\n      redoButton && (redoButton.disabled = true);\n    } else {\n      redoButton && (redoButton.disabled = false);\n    }\n  }\n  render() {\n    return (\n      <div class={{ 'editor-wrapper': true, 'error': this.error }}>\n        <div ref={el => (this.editorContainer = el as HTMLDivElement)} class=\"editor-container\"></div>\n      </div>\n    );\n  }\n}\n"]}