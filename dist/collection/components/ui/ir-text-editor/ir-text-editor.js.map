{"version":3,"file":"ir-text-editor.js","sourceRoot":"","sources":["../../../../src/components/ui/ir-text-editor/ir-text-editor.tsx"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,CAAC,EAAE,OAAO,EAAE,KAAK,EAAgB,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,eAAe,CAAC;AAC/F,OAAO,KAAuB,MAAM,OAAO,CAAC;AAe5C,SAAS,YAAY,CAAC,MAAqB;IACzC,MAAM,OAAO,GAAG,EAAE,CAAC;IACnB,MAAM,WAAW,GAAa,EAAE,CAAC;IACjC,IAAI,MAAM,CAAC,IAAI;QAAE,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC1C,IAAI,MAAM,CAAC,MAAM;QAAE,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC9C,IAAI,MAAM,CAAC,SAAS;QAAE,WAAW,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IACpD,IAAI,MAAM,CAAC,MAAM;QAAE,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC9C,IAAI,WAAW,CAAC,MAAM,EAAE,CAAC;QACvB,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;IAC5B,CAAC;IACD,IAAI,MAAM,CAAC,IAAI;QAAE,OAAO,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;IACxC,IAAI,MAAM,CAAC,KAAK;QAAE,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;IAC1C,IAAI,MAAM,CAAC,KAAK;QAAE,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;IAC1C,IAAI,MAAM,CAAC,KAAK;QAAE,OAAO,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC;IAC1C,OAAO,OAAO,CAAC;AACjB,CAAC;AAMD,MAAM,OAAO,YAAY;IALzB;QAYE,2BAA2B;QACnB,UAAK,GAAW,EAAE,CAAC;QAE3B,0CAA0C;QAClC,aAAQ,GAAY,KAAK,CAAC;QAElC,0DAA0D;QAClD,gBAAW,GAAY,IAAI,CAAC;QAuB3B,gBAAW,GAAG,EAAE,CAAC;KAwI3B;IAjIC,gBAAgB;QACd,MAAM,OAAO,GAAiB;YAC5B,OAAO,EAAE;gBACP,OAAO,EAAE;oBACP,SAAS,EAAE,IAAI,CAAC,eAAe;oBAC/B,QAAQ,EAAE;wBACR,IAAI,EAAE,GAAG,EAAE;4BACT,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;gCAChB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;gCAC3B,IAAI,CAAC,oBAAoB,EAAE,CAAC;4BAC9B,CAAC;wBACH,CAAC;wBACD,IAAI,EAAE,GAAG,EAAE;4BACT,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;gCAChB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;gCAC3B,IAAI,CAAC,oBAAoB,EAAE,CAAC;4BAC9B,CAAC;wBACH,CAAC;qBACF;iBACF;gBACD,OAAO,EAAE;oBACP,KAAK,EAAE,IAAI;oBACX,QAAQ,EAAE,GAAG;oBACb,QAAQ,EAAE,IAAI;iBACf;aACF;YACD,WAAW,EAAE,IAAI,CAAC,WAAW;YAC7B,QAAQ,EAAE,CAAC,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,QAAQ;YAC5C,KAAK,EAAE,MAAM;SACd,CAAC;QACF,MAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QACvC,KAAK,CAAC,MAAM,CAAC;YACX,kfAAkf,CAAC,CAAC,qCAAqC;QAC3hB,KAAK,CAAC,MAAM,CAAC;YACX,mfAAmf,CAAC;QACtf,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,IAAI,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;QACtD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAS,CAAC,UAAU,CAAC,MAAM,EAAE,GAAG,EAAE;YAChE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QAC7B,CAAC,CAAC,CAAC;QACF,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAS,CAAC,UAAU,CAAC,MAAM,EAAE,GAAG,EAAE;YAChE,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC;QAC7B,CAAC,CAAC,CAAC;QACH,IAAI,IAAI,CAAC,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAClC,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,aAAa,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,EAAE;YAC9C,IAAI,MAAM,KAAK,MAAM,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;gBACxC,MAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC;gBACxC,MAAM,eAAe,GAAG,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,MAAM,CAAC;gBAC3F,IAAI,eAAe,GAAG,IAAI,CAAC,SAAS,EAAE,CAAC;oBACrC,MAAM,MAAM,GAAG,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC;oBAChD,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;oBACvD,OAAO;gBACT,CAAC;YACH,CAAC;YACD,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YACxC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YACxB,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACL,CAAC;IAGD,iBAAiB,CAAC,QAAgB,EAAE,QAAgB;QAClD,IAAI,CAAC,QAAQ,EAAE,CAAC;YACd,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;YAC9B,OAAO;QACT,CAAC;QACD,IAAI,QAAQ,KAAK,QAAQ,IAAI,QAAQ,KAAK,IAAI,CAAC,WAAW,EAAE,CAAC;YAC3D,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QAChC,CAAC;IACH,CAAC;IAED,gBAAgB,CAAC,MAAe;QAC9B,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,IAAI,CAAC,MAAM,CAAC,CAAC;QAClD,CAAC;IACH,CAAC;IAGD,mBAAmB,CAAC,MAAe;QACjC,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC/C,CAAC;IACH,CAAC;IAED,oBAAoB;QAClB,IAAI,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACrB,CAAC;IACH,CAAC;IACD,IAAY,eAAe;QACzB,OAAO,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,YAAY,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC;IAC9K,CAAC;IACO,cAAc,CAAC,KAAa;QAClC,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YACjB,OAAO;QACT,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;QAClD,qBAAqB,CAAC,GAAG,EAAE;YACzB,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC;YACvC,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC;QAC1C,CAAC,CAAC,CAAC;IACL,CAAC;IACO,oBAAoB;QAC1B,MAAM,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,UAAU,CAAsB,CAAC;QAC1E,MAAM,UAAU,GAAG,IAAI,CAAC,EAAE,CAAC,aAAa,CAAC,UAAU,CAAsB,CAAC;QAC1E,IAAI,CAAC,IAAI,CAAC,MAAM;YAAE,OAAO;QAEzB,2CAA2C;QAC3C,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAChD,UAAU,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC;QAC7C,CAAC;aAAM,CAAC;YACN,UAAU,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,KAAK,CAAC,CAAC;QAC9C,CAAC;QAED,2CAA2C;QAC3C,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YAChD,UAAU,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC;QAC7C,CAAC;aAAM,CAAC;YACN,UAAU,IAAI,CAAC,UAAU,CAAC,QAAQ,GAAG,KAAK,CAAC,CAAC;QAC9C,CAAC;IACH,CAAC;IACD,MAAM;QACJ,OAAO,CACL,4DAAK,KAAK,EAAE,EAAE,gBAAgB,EAAE,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,KAAK,EAAE;YACzD,4DAAK,GAAG,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,GAAG,EAAoB,CAAC,EAAE,KAAK,EAAC,kBAAkB,GAAO,CAC1F,CACP,CAAC;IACJ,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CACF","sourcesContent":["import { Component, h, Element, Event, EventEmitter, Prop, Watch, State } from '@stencil/core';\r\nimport Quill, { QuillOptions } from 'quill';\r\n\r\nexport type QuillToolbarButton = 'bold' | 'italic' | 'underline' | 'strike' | 'link' | 'image' | 'video' | 'clean';\r\n\r\nexport interface ToolbarConfig {\r\n  bold?: boolean;\r\n  italic?: boolean;\r\n  underline?: boolean;\r\n  strike?: boolean;\r\n  link?: boolean;\r\n  image?: boolean;\r\n  video?: boolean;\r\n  clean?: boolean;\r\n}\r\n\r\nfunction buildToolbar(config: ToolbarConfig): any[] {\r\n  const toolbar = [];\r\n  const textFormats: string[] = [];\r\n  if (config.bold) textFormats.push('bold');\r\n  if (config.italic) textFormats.push('italic');\r\n  if (config.underline) textFormats.push('underline');\r\n  if (config.strike) textFormats.push('strike');\r\n  if (textFormats.length) {\r\n    toolbar.push(textFormats);\r\n  }\r\n  if (config.link) toolbar.push(['link']);\r\n  if (config.image) toolbar.push(['image']);\r\n  if (config.video) toolbar.push(['video']);\r\n  if (config.clean) toolbar.push(['clean']);\r\n  return toolbar;\r\n}\r\n@Component({\r\n  tag: 'ir-text-editor',\r\n  styleUrls: ['ir-text-editor.css', 'quill.snow.css'],\r\n  shadow: false,\r\n})\r\nexport class IrTextEditor {\r\n  @Element() el: HTMLElement;\r\n\r\n  @Prop() error: boolean;\r\n\r\n  @Prop() maxLength: number;\r\n\r\n  /** Initial HTML content */\r\n  @Prop() value: string = '';\r\n\r\n  /** If true, makes the editor read-only */\r\n  @Prop() readOnly: boolean = false;\r\n\r\n  /** Determines if the current user can edit the content */\r\n  @Prop() userCanEdit: boolean = true;\r\n\r\n  /** Placeholder text */\r\n  @Prop() placeholder: string;\r\n\r\n  /**\r\n   * Type-safe toolbar configuration.\r\n   * For example, you can pass:\r\n   *\r\n   * {\r\n   *   bold: true,\r\n   *   italic: true,\r\n   *   underline: true,\r\n   *   strike: false,\r\n   *   link: true,\r\n   *   clean: true\r\n   * }\r\n   */\r\n  @Prop() toolbarConfig?: ToolbarConfig;\r\n\r\n  /** Emits current HTML content whenever it changes */\r\n  @Event() textChange: EventEmitter<string>;\r\n\r\n  @State() editorValue = '';\r\n\r\n  /** Private, non-reactive Quill editor instance */\r\n  private editor: Quill;\r\n\r\n  private editorContainer!: HTMLDivElement;\r\n\r\n  componentDidLoad() {\r\n    const options: QuillOptions = {\r\n      modules: {\r\n        toolbar: {\r\n          container: this.computedToolbar,\r\n          handlers: {\r\n            undo: () => {\r\n              if (this.editor) {\r\n                this.editor.history.undo();\r\n                this.updateHistoryButtons();\r\n              }\r\n            },\r\n            redo: () => {\r\n              if (this.editor) {\r\n                this.editor.history.redo();\r\n                this.updateHistoryButtons();\r\n              }\r\n            },\r\n          },\r\n        },\r\n        history: {\r\n          delay: 1000,\r\n          maxStack: 100,\r\n          userOnly: true,\r\n        },\r\n      },\r\n      placeholder: this.placeholder,\r\n      readOnly: !this.userCanEdit || this.readOnly,\r\n      theme: 'snow',\r\n    };\r\n    const icons = Quill.import('ui/icons');\r\n    icons['undo'] =\r\n      '<svg title=\"undo\" xmlns=\"http://www.w3.org/2000/svg\" height=\"18\" width=\"18\" viewBox=\"0 0 512 512\"><path class=\"ql-fill\" d=\"M48.5 224L40 224c-13.3 0-24-10.7-24-24L16 72c0-9.7 5.8-18.5 14.8-22.2s19.3-1.7 26.2 5.2L98.6 96.6c87.6-86.5 228.7-86.2 315.8 1c87.5 87.5 87.5 229.3 0 316.8s-229.3 87.5-316.8 0c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0c62.5 62.5 163.8 62.5 226.3 0s62.5-163.8 0-226.3c-62.2-62.2-162.7-62.5-225.3-1L185 183c6.9 6.9 8.9 17.2 5.2 26.2s-12.5 14.8-22.2 14.8L48.5 224z\" /></svg>'; // Replace '...' with actual SVG path\r\n    icons['redo'] =\r\n      '<svg title=\"redo\" xmlns=\"http://www.w3.org/2000/svg\" height=\"18\" width=\"18\" viewBox=\"0 0 512 512\"><path class=\"ql-fill\" d=\"M463.5 224l8.5 0c13.3 0 24-10.7 24-24l0-128c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2L413.4 96.6c-87.6-86.5-228.7-86.2-315.8 1c-87.5 87.5-87.5 229.3 0 316.8s229.3 87.5 316.8 0c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0c-62.5 62.5-163.8 62.5-226.3 0s-62.5-163.8 0-226.3c62.2-62.2 162.7-62.5 225.3-1L327 183c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l119.5 0z\"/></svg>';\r\n    this.editor = new Quill(this.editorContainer, options);\r\n    (this.editor.getModule('toolbar') as any).addHandler('undo', () => {\r\n      this.editor.history.undo();\r\n    });\r\n    (this.editor.getModule('toolbar') as any).addHandler('redo', () => {\r\n      this.editor.history.redo();\r\n    });\r\n    if (this.value) {\r\n      this.setEditorValue(this.value);\r\n    }\r\n    this.editor.on('text-change', (_, __, source) => {\r\n      if (source === 'user' && this.maxLength) {\r\n        const plainText = this.editor.getText();\r\n        const effectiveLength = plainText.endsWith('\\n') ? plainText.length - 1 : plainText.length;\r\n        if (effectiveLength > this.maxLength) {\r\n          const excess = effectiveLength - this.maxLength;\r\n          this.editor.deleteText(this.maxLength, excess, 'user');\r\n          return;\r\n        }\r\n      }\r\n      const html = this.editor.root.innerHTML;\r\n      this.editorValue = html;\r\n      this.textChange.emit(html);\r\n    });\r\n  }\r\n\r\n  @Watch('value')\r\n  handleValueChange(newValue: string, oldValue: string) {\r\n    if (!newValue) {\r\n      this.setEditorValue(newValue);\r\n      return;\r\n    }\r\n    if (newValue !== oldValue && newValue !== this.editorValue) {\r\n      this.setEditorValue(newValue);\r\n    }\r\n  }\r\n  @Watch('readOnly')\r\n  onReadOnlyChange(newVal: boolean) {\r\n    if (this.editor) {\r\n      this.editor.enable(this.userCanEdit && !newVal);\r\n    }\r\n  }\r\n\r\n  @Watch('userCanEdit')\r\n  onUserCanEditChange(newVal: boolean) {\r\n    if (this.editor) {\r\n      this.editor.enable(newVal && !this.readOnly);\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    if (this.editor) {\r\n      this.editor = null;\r\n    }\r\n  }\r\n  private get computedToolbar() {\r\n    return this.toolbarConfig ? buildToolbar(this.toolbarConfig) : [[{ undo: 'ql-undo' }, { redo: 'ql-redo' }], ['bold', 'italic', 'underline', 'strike'], ['link'], ['clean']];\r\n  }\r\n  private setEditorValue(value: string) {\r\n    if (!this.editor) {\r\n      return;\r\n    }\r\n    this.editor.clipboard.dangerouslyPasteHTML(value);\r\n    requestAnimationFrame(() => {\r\n      const length = this.editor.getLength();\r\n      this.editor.setSelection(length - 1, 0);\r\n    });\r\n  }\r\n  private updateHistoryButtons() {\r\n    const undoButton = this.el.querySelector('.ql-undo') as HTMLButtonElement;\r\n    const redoButton = this.el.querySelector('.ql-redo') as HTMLButtonElement;\r\n    if (!this.editor) return;\r\n\r\n    // Disable undo if there is no undo history\r\n    if (this.editor.history.stack.undo.length === 0) {\r\n      undoButton && (undoButton.disabled = true);\r\n    } else {\r\n      undoButton && (undoButton.disabled = false);\r\n    }\r\n\r\n    // Disable redo if there is no redo history\r\n    if (this.editor.history.stack.redo.length === 0) {\r\n      redoButton && (redoButton.disabled = true);\r\n    } else {\r\n      redoButton && (redoButton.disabled = false);\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <div class={{ 'editor-wrapper': true, 'error': this.error }}>\r\n        <div ref={el => (this.editorContainer = el as HTMLDivElement)} class=\"editor-container\"></div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"]}