{"version":3,"file":"ir-revenue-table.js","sourceRoot":"","sources":["../../../../src/components/ir-daily-revenue/ir-revenue-table/ir-revenue-table.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Fragment, h, Prop } from '@stencil/core';\nimport { DailyPaymentFilter, FolioPayment, GroupedFolioPayment } from '../types';\nimport { PaymentEntries } from '@/components/ir-booking-details/types';\nimport { PAYMENT_TYPES_WITH_METHOD } from '@/components/ir-booking-details/ir-payment-details/global.variables';\nimport { formatAmount } from '@/utils/utils';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  tag: 'ir-revenue-table',\n  styleUrl: 'ir-revenue-table.css',\n  scoped: true,\n})\nexport class IrRevenueTable {\n  @Prop() payments: GroupedFolioPayment = new Map();\n  @Prop() paymentEntries: PaymentEntries;\n  @Prop() filters: DailyPaymentFilter;\n\n  private payTypesObj: {};\n  private payMethodObj: {};\n  private groupType: 'method' | 'type' = 'method';\n\n  componentWillLoad() {\n    const buildPaymentLookup = (key: keyof PaymentEntries) => {\n      let pt = {};\n      this.paymentEntries[key].forEach(p => {\n        pt = { ...pt, [p.CODE_NAME]: p.CODE_VALUE_EN };\n      });\n      return pt;\n    };\n\n    this.payTypesObj = buildPaymentLookup('types');\n    this.payMethodObj = buildPaymentLookup('methods');\n  }\n\n  /**\n   * Groups payments by method, then by type.\n   * - Never throws on bad input (null/undefined, non-Map, malformed keys, non-array values).\n   * - Keys are parsed defensively; unknown parts fall back to \"UNKNOWN\".\n   */\n  private regroupPaymentsByMethod(): Map<string, Map<string, FolioPayment[]>> {\n    const result = new Map<string, Map<string, FolioPayment[]>>();\n\n    // Early return on empty/invalid source\n    const src = this.payments;\n    if (!(src instanceof Map) || src.size === 0) return result;\n\n    // Helper: parse \"TYPE_METHOD\" into [type, method] safely\n    const parseKey = (key: unknown): [string, string] => {\n      if (typeof key !== 'string') return ['UNKNOWN', 'UNKNOWN'];\n      // Allow extra underscores on the method side: TYPE_METHOD_WITH_UNDERSCORES\n      const [type, ...rest] = key.split('_');\n      const method = rest.join('_');\n      const safeType = (type && type.trim()) || 'UNKNOWN';\n      const safeMethod = (method && method.trim()) || 'UNKNOWN';\n      return [safeType, safeMethod];\n    };\n\n    for (const [rawKey, rawList] of src.entries()) {\n      const [paymentType, paymentMethod] = parseKey(rawKey);\n\n      // Normalize value to a clean array of FolioPayment\n      const list: FolioPayment[] = Array.isArray(rawList) ? (rawList.filter(Boolean) as FolioPayment[]) : [];\n\n      // Skip silently if nothing to add\n      if (list.length === 0) {\n        // Still ensure the buckets exist so consumers can rely on them if needed\n        if (!result.has(paymentMethod)) result.set(paymentMethod, new Map());\n        if (!result.get(paymentMethod)!.has(paymentType)) {\n          result.get(paymentMethod)!.set(paymentType, []);\n        }\n        continue;\n      }\n\n      const typeMap = result.get(paymentMethod) ?? new Map<string, FolioPayment[]>();\n      const existing = typeMap.get(paymentType) ?? [];\n      typeMap.set(paymentType, existing.concat(list));\n      result.set(paymentMethod, typeMap);\n    }\n\n    return result;\n  }\n\n  render() {\n    const hasPayments = this.payments instanceof Map && this.payments.size > 0;\n\n    return (\n      <div class=\"card p-1 revenue-table__table\">\n        {hasPayments ? (\n          <Fragment>\n            <div class=\"revenue-table__header\">\n              <p>Method</p>\n              <p>Amount</p>\n            </div>\n            {this.groupType === 'type' &&\n              Array.from((this.payments as Map<string, FolioPayment[]>).entries()).map(([key, list]) => {\n                const [paymentType, paymentMethod] = key.split('_');\n                const groupName = PAYMENT_TYPES_WITH_METHOD.includes(paymentType)\n                  ? `${this.payTypesObj[paymentType] ?? paymentType}: ${this.payMethodObj[paymentMethod] ?? paymentMethod}`\n                  : this.payTypesObj[paymentType] ?? paymentType;\n\n                return <ir-revenue-row key={key} payments={list} groupName={groupName}></ir-revenue-row>;\n              })}\n            {this.groupType === 'method' &&\n              Array.from(this.regroupPaymentsByMethod().entries()).flatMap(([methodKey, byType]) => {\n                const total = Array.from(byType.entries()).reduce((prev, [_, list]) => prev + list.reduce((p, c) => p + c.amount, 0), 0);\n                return (\n                  <div key={`method_${methodKey}`}>\n                    <div class=\"revenue-table__method_header\">\n                      <p>{this.payMethodObj[methodKey] ?? methodKey}</p>\n                      <p>{formatAmount(calendar_data.currency.symbol, total)}</p>\n                    </div>\n                    {Array.from(byType.entries()).map(([typeKey, list]) => {\n                      const groupName = PAYMENT_TYPES_WITH_METHOD.includes(typeKey) ? `${this.payTypesObj[typeKey] ?? typeKey}` : this.payTypesObj[typeKey] ?? typeKey;\n\n                      return (\n                        <div key={`type_${typeKey}`} class=\"px-1\">\n                          <ir-revenue-row payments={list} groupName={groupName}></ir-revenue-row>\n                        </div>\n                      );\n                    })}\n                  </div>\n                );\n              })}\n          </Fragment>\n        ) : (\n          <p class=\"text-center my-auto mx-auto\">There are no payment transactions recorded for the selected date.</p>\n        )}\n      </div>\n    );\n  }\n}\n"]}