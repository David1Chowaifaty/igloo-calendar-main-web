{"version":3,"file":"ir-billing.js","sourceRoot":"","sources":["../../../src/components/ir-billing/ir-billing.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Booking } from '@/models/booking.dto';\nimport { Component, Event, EventEmitter, Fragment, Listen, Prop, State, h } from '@stencil/core';\nimport { BookingInvoiceInfo } from '../ir-invoice/types';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { formatAmount } from '@/utils/utils';\nimport moment from 'moment';\n\n@Component({\n  tag: 'ir-billing',\n  styleUrls: ['ir-billing.css', '../../common/table.css'],\n  scoped: true,\n})\nexport class IrBilling {\n  @Prop() booking: Booking;\n\n  @State() isOpen: 'invoice' = null;\n  @State() isLoading: 'page' | 'void' = 'page';\n  @State() invoiceInfo: BookingInvoiceInfo;\n  @State() selectedInvoice: string = null;\n\n  @Event() billingClose: EventEmitter<void>;\n\n  private bookingService = new BookingService();\n\n  componentWillLoad() {\n    this.init();\n  }\n  @Listen('invoiceCreated')\n  async handleInvoiceCreation(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.invoiceInfo = await this.bookingService.getBookingInvoiceInfo({ booking_nbr: this.booking.booking_nbr });\n  }\n  private async init() {\n    try {\n      this.isLoading = 'page';\n      this.invoiceInfo = await this.bookingService.getBookingInvoiceInfo({ booking_nbr: this.booking.booking_nbr });\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.isLoading = null;\n    }\n  }\n  private async voidInvoice(e: CustomEvent) {\n    this.isLoading = 'void';\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    await this.bookingService.voidInvoice({\n      invoice_nbr: this.selectedInvoice,\n      reason: '',\n    });\n    this.invoiceInfo = await this.bookingService.getBookingInvoiceInfo({ booking_nbr: this.booking.booking_nbr });\n    this.isLoading = null;\n    this.selectedInvoice = null;\n  }\n\n  render() {\n    if (this.isLoading === 'page') {\n      return (\n        <div class=\"drawer__loader-container\">\n          <ir-spinner></ir-spinner>\n        </div>\n      );\n    }\n    return (\n      <Fragment>\n        <div class=\"billing__container\">\n          <section>\n            <div class=\"billing__section-title-row\">\n              <h4 class=\"billing__section-title\">Physical documents</h4>\n              <ir-custom-button\n                variant=\"brand\"\n                onClickHandler={e => {\n                  e.stopImmediatePropagation();\n                  e.stopPropagation();\n                  this.isOpen = 'invoice';\n                }}\n              >\n                Issue invoice\n              </ir-custom-button>\n            </div>\n            <div class=\"table-container\">\n              <table class=\"table\">\n                <thead>\n                  <tr>\n                    <th>Type</th>\n                    <th>Number</th>\n                    <th>Date</th>\n                    <th class=\"billing__price-col\">Amount</th>\n                    <th></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {this.invoiceInfo?.invoices?.map(invoice => (\n                    <tr class=\"ir-table-row\">\n                      <td>{invoice.status.code === 'VALID' ? 'Invoice' : 'Credit note'}</td>\n                      <td>{invoice.status.code === 'VALID' ? invoice.nbr : invoice.credit_note.nbr}</td>\n                      <td>\n                        {invoice.status.code === 'VALID'\n                          ? moment(invoice.date, 'YYYY-MM-DD').format('MMM DD, YYYY')\n                          : moment(invoice.credit_note.date, 'YYYY-MM-DD').format('MMM DD, YYYY')}\n                      </td>\n                      <td class=\"billing__price-col\">\n                        <span class=\"ir-price\">{formatAmount(invoice.currency.symbol, invoice.total_amount ?? 0)}</span>\n                      </td>\n                      <td>\n                        <div class=\"billing__actions-row\">\n                          <wa-tooltip for={`pdf-${invoice.system_id}`}>Download pdf</wa-tooltip>\n                          <ir-custom-button id={`pdf-${invoice.system_id}`} variant=\"neutral\" appearance=\"plain\">\n                            <wa-icon name=\"file-pdf\" style={{ fontSize: '1rem' }}></wa-icon>\n                          </ir-custom-button>\n                          {invoice.status.code === 'VALID' && (\n                            <ir-custom-button\n                              onClickHandler={() => {\n                                this.selectedInvoice = invoice.nbr;\n                              }}\n                              variant=\"danger\"\n                              appearance=\"plain\"\n                            >\n                              Void with credit note\n                            </ir-custom-button>\n                          )}\n                        </div>\n                      </td>\n                      {/* <p>\n                    {this.booking.guest.first_name} {this.booking.guest.last_name}\n                  </p> */}\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n            <div class=\"billing__cards\">\n              {this.invoiceInfo.invoices?.map(invoice => (\n                <wa-card key={invoice.nbr} class=\"billing__card\">\n                  <div class=\"billing__card-header\">\n                    <div class=\"billing__card-header-info\">\n                      <p class=\"billing__card-number\">{invoice.status.code === 'VALID' ? invoice.nbr : invoice.credit_note.nbr}</p>\n                      <p class=\"billing__card-type\">{invoice.status.code === 'VALID' ? 'Invoice' : 'Credit note'}</p>\n                    </div>\n\n                    <wa-tooltip for={`mobile-pdf-${invoice.system_id}`}>Download pdf</wa-tooltip>\n                    <ir-custom-button id={`mobile-pdf-${invoice.system_id}`} variant=\"neutral\" appearance=\"plain\" class=\"billing__card-download-btn\">\n                      <wa-icon name=\"file-pdf\" style={{ fontSize: '1rem' }}></wa-icon>\n                    </ir-custom-button>\n                  </div>\n\n                  <div class=\"billing__card-details\">\n                    <div class=\"billing__card-detail\">\n                      <p class=\"billing__card-detail-label\">Date</p>\n                      <p class=\"billing__card-detail-value\">\n                        {' '}\n                        {invoice.status.code === 'VALID'\n                          ? moment(invoice.date, 'YYYY-MM-DD').format('MMM DD, YYYY')\n                          : moment(invoice.credit_note.date, 'YYYY-MM-DD').format('MMM DD, YYYY')}\n                      </p>\n                    </div>\n\n                    <div class=\"billing__card-detail\">\n                      <p class=\"billing__card-detail-label --amount\">Amount</p>\n                      <p class=\"billing__card-detail-value\">{formatAmount(invoice.currency.symbol, invoice.total_amount ?? 0)}</p>\n                    </div>\n                  </div>\n\n                  {invoice.status.code === 'VALID' && (\n                    <div slot=\"footer\" class=\"billing__card-footer\">\n                      <ir-custom-button\n                        onClickHandler={() => {\n                          this.selectedInvoice = invoice.nbr;\n                        }}\n                        variant=\"danger\"\n                        appearance=\"outlined\"\n                        class=\"billing__card-void-btn\"\n                      >\n                        Void with credit note\n                      </ir-custom-button>\n                    </div>\n                  )}\n                </wa-card>\n              ))}\n            </div>\n            {this.invoiceInfo.invoices?.length === 0 && <div>No invoices created</div>}\n          </section>\n        </div>\n        <ir-invoice\n          invoiceInfo={this.invoiceInfo}\n          onInvoiceClose={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.isOpen = null;\n          }}\n          open={this.isOpen === 'invoice'}\n          booking={this.booking}\n        ></ir-invoice>\n        <ir-dialog\n          label=\"Alert\"\n          open={this.selectedInvoice !== null}\n          lightDismiss={false}\n          onIrDialogHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n          }}\n          onIrDialogAfterHide={e => {\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n            this.selectedInvoice = null;\n          }}\n        >\n          <p>Confirm that you want to void this invoice and generate a corresponding credit note.</p>\n          <div slot=\"footer\" class=\"ir-dialog__footer\">\n            <ir-custom-button data-dialog=\"close\" size=\"medium\" appearance=\"filled\" variant=\"neutral\">\n              Cancel\n            </ir-custom-button>\n            <ir-custom-button loading={this.isLoading === 'void'} onClickHandler={this.voidInvoice.bind(this)} size=\"medium\" variant=\"danger\">\n              Confirm\n            </ir-custom-button>\n          </div>\n        </ir-dialog>\n      </Fragment>\n    );\n  }\n}\n"]}