{"version":3,"file":"ir-applicable-policies.js","sourceRoot":"","sources":["../../../../../src/components/ir-booking-details/ir-payment-details/ir-applicable-policies/ir-applicable-policies.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Booking, Bracket, ExposedApplicablePolicy } from '@/models/booking.dto';\nimport { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\nimport { CancellationStatement } from '../../types';\nimport moment, { Moment } from 'moment';\nimport { formatAmount } from '@/utils/utils';\nimport calendar_data from '@/stores/calendar-data';\nimport { IPaymentAction } from '@/services/payment.service';\n\n@Component({\n  tag: 'ir-applicable-policies',\n  styleUrl: 'ir-applicable-policies.css',\n  scoped: true,\n})\nexport class IrApplicablePolicies {\n  @Prop() booking: Booking;\n  @Prop() propertyId: number;\n  @Prop() language: string = 'en';\n\n  @State() cancellationStatements: CancellationStatement[] = [];\n  @State() isLoading: boolean = false;\n  @State() guaranteeAmount: number;\n\n  @Event() generatePayment: EventEmitter<IPaymentAction>;\n\n  componentWillLoad() {\n    this.loadApplicablePolicies();\n  }\n\n  @Watch('booking')\n  handleBookingChange() {\n    this.loadApplicablePolicies();\n  }\n  private async loadApplicablePolicies() {\n    this.isLoading = true;\n    try {\n      const getPoliciesByType = (policies: ExposedApplicablePolicy[], type: ExposedApplicablePolicy['type']) => {\n        return policies.find(p => p.type === type);\n      };\n      const statements: CancellationStatement[] = [];\n      let total = 0;\n      this.booking.rooms.forEach(room => {\n        const cancellationPolicy = getPoliciesByType(room.applicable_policies, 'cancelation');\n        const guaranteePolicy = getPoliciesByType(room.applicable_policies, 'guarantee');\n        if (cancellationPolicy) {\n          statements.push({\n            ...cancellationPolicy,\n            roomType: room.roomtype,\n            ratePlan: room.rateplan,\n            brackets: cancellationPolicy.brackets.filter(b => b.amount > 0),\n            checkInDate: room.from_date,\n          });\n        }\n        if (guaranteePolicy) {\n          total += this.getCurrentBracket(guaranteePolicy.brackets)?.amount ?? 0;\n        }\n      });\n\n      this.guaranteeAmount = total;\n      this.cancellationStatements = [...statements];\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n  private formatPreviousBracketDueOn(d1: Moment, d2: Moment) {\n    if (d1.isSame(d2, 'year')) {\n      return d1.format('MMM DD');\n    }\n\n    return d1.format('MMM DD, YYYY');\n  }\n  // private getBracketLabelsAndArrowState({ bracket, index, brackets }: { index: number; bracket: Bracket; brackets: Bracket[]; }): {\n  //   leftLabel: string;\n  //   showArrow: boolean;\n  //   rightLabel: string;\n  // } {\n  //   let leftLabel = '';\n  //   let showArrow = true;\n  //   let rightLabel = '';\n  //   const MCheckInDate = moment(this.booking.booked_on.date, 'YYYY-MM-DD');\n  //   if (brackets.length === 1) {\n  //     const d1 = moment(bracket.due_on, 'YYYY-MM-DD');\n  //     const isSameDay = d1.isSame(MCheckInDate, 'dates');\n  //     const isDueAfterBookedOn = d1.isAfter(MCheckInDate, 'dates');\n  //     leftLabel = isSameDay ? null : this.formatPreviousBracketDueOn(d1, MCheckInDate);\n  //     showArrow = !isSameDay && !isDueAfterBookedOn;\n  //     rightLabel = isDueAfterBookedOn ? null : MCheckInDate.format('MMM DD, YYYY');\n  //   } else if (brackets.length > 1) {\n  //     if (index === 0) {\n  //       leftLabel = 'Until';\n  //       showArrow = false;\n  //       rightLabel = moment(brackets[index + 1]?.due_on, 'YYYY-MM-DD').format('MMM DD, YYYY');\n  //     } else if (index === brackets.length - 1) {\n  //       leftLabel = moment(bracket.due_on, 'YYYY-MM-DD').format('MMM DD, YYYY');\n  //       showArrow = false;\n  //       rightLabel = null;\n  //     } else {\n  //       const d1 = moment(bracket.due_on, 'YYYY-MM-DD');\n  //       const d2 = moment(brackets[index + 1].due_on, 'YYYY-MM-DD').add(-1, 'days');\n  //       leftLabel = this.formatPreviousBracketDueOn(d1, d2);\n  //       rightLabel = d2.format('MMM DD, YYYY');\n  //     }\n  //   }\n  //   return { leftLabel, rightLabel, showArrow };\n  // }\n  private getBracketLabelsAndArrowState({ bracket, index, brackets }: { index: number; bracket: Bracket; brackets: Bracket[] }): {\n    leftLabel: string | null;\n    showArrow: boolean;\n    rightLabel: string | null;\n  } {\n    // Validate inputs\n    if (!bracket || !brackets || index < 0 || index >= brackets.length) {\n      return { leftLabel: null, rightLabel: null, showArrow: false };\n    }\n\n    // Parse dates with validation\n    const checkInDate = moment(this.booking.booked_on.date, 'YYYY-MM-DD');\n    const bracketDueDate = moment(bracket.due_on, 'YYYY-MM-DD');\n\n    if (!checkInDate.isValid() || !bracketDueDate.isValid()) {\n      console.warn('Invalid date encountered in getBracketLabelsAndArrowState');\n      return { leftLabel: null, rightLabel: null, showArrow: false };\n    }\n\n    // Single bracket case\n    if (brackets.length === 1) {\n      return this.handleSingleBracket(bracketDueDate, checkInDate);\n    }\n\n    // Multiple brackets case\n    return this.handleMultipleBrackets(bracket, index, brackets);\n  }\n\n  private handleSingleBracket(\n    bracketDueDate: moment.Moment,\n    checkInDate: moment.Moment,\n  ): {\n    leftLabel: string | null;\n    showArrow: boolean;\n    rightLabel: string | null;\n  } {\n    const isSameDay = bracketDueDate.isSame(checkInDate, 'day');\n    const isDueBeforeCheckIn = bracketDueDate.isBefore(checkInDate, 'day');\n    // const isDueAfterCheckIn = bracketDueDate.isAfter(checkInDate, 'day');\n\n    if (isSameDay) {\n      // Due date is same as check-in date\n      return {\n        leftLabel: null,\n        showArrow: false,\n        rightLabel: checkInDate.format('MMM DD, YYYY'),\n      };\n    } else if (isDueBeforeCheckIn) {\n      // Due date is before check-in (overdue scenario)\n      return {\n        leftLabel: this.formatPreviousBracketDueOn(bracketDueDate, checkInDate),\n        showArrow: true,\n        rightLabel: checkInDate.format('MMM DD, YYYY'),\n      };\n    } else {\n      // Due date is after check-in (future due date)\n      return {\n        leftLabel: checkInDate.format('MMM DD, YYYY'),\n        showArrow: true,\n        rightLabel: bracketDueDate.format('MMM DD, YYYY'),\n      };\n    }\n  }\n\n  private handleMultipleBrackets(\n    bracket: Bracket,\n    index: number,\n    brackets: Bracket[],\n  ): {\n    leftLabel: string | null;\n    showArrow: boolean;\n    rightLabel: string | null;\n  } {\n    const bracketDueDate = moment(bracket.due_on, 'YYYY-MM-DD');\n\n    // First bracket\n    if (index === 0) {\n      const nextBracket = brackets[index + 1];\n      if (!nextBracket) {\n        return { leftLabel: null, rightLabel: null, showArrow: false };\n      }\n\n      const nextBracketDueDate = moment(nextBracket.due_on, 'YYYY-MM-DD');\n      if (!nextBracketDueDate.isValid()) {\n        return { leftLabel: null, rightLabel: null, showArrow: false };\n      }\n\n      return {\n        leftLabel: 'Until',\n        showArrow: false,\n        rightLabel: nextBracketDueDate.format('MMM DD, YYYY'),\n      };\n    }\n\n    // Last bracket\n    if (index === brackets.length - 1) {\n      return {\n        leftLabel: bracketDueDate.format('MMM DD, YYYY'),\n        showArrow: false,\n        rightLabel: 'onwards',\n      };\n    }\n\n    // Middle brackets\n    const nextBracket = brackets[index + 1];\n    if (!nextBracket) {\n      return { leftLabel: null, rightLabel: null, showArrow: false };\n    }\n\n    const nextBracketDueDate = moment(nextBracket.due_on, 'YYYY-MM-DD');\n    if (!nextBracketDueDate.isValid()) {\n      return { leftLabel: null, rightLabel: null, showArrow: false };\n    }\n\n    // Calculate the end of current bracket period (day before next bracket starts)\n    const periodEndDate = nextBracketDueDate.clone().subtract(1, 'day');\n\n    return {\n      leftLabel: this.formatPreviousBracketDueOn(bracketDueDate, periodEndDate),\n      showArrow: true,\n      rightLabel: periodEndDate.format('MMM DD, YYYY'),\n    };\n  }\n  private getCurrentBracket(brackets: Bracket[]) {\n    const today = moment();\n    for (const bracket of brackets) {\n      if (today.isSameOrAfter(moment(bracket.due_on, 'YYYY-MM-DD'), 'days')) {\n        return bracket;\n      }\n    }\n    return null;\n  }\n\n  private generateCancellationStatement() {\n    const label = 'if cancelled today';\n    const { cancelation_penality_as_if_today } = this.booking.financial;\n    if (cancelation_penality_as_if_today === 0) {\n      return `No penalty ${label}`;\n    }\n    return `${cancelation_penality_as_if_today < 0 ? 'Refund' : 'Charge'} ${formatAmount(calendar_data.currency.symbol, Math.abs(cancelation_penality_as_if_today))} ${label}`;\n  }\n\n  render() {\n    if (this.isLoading) {\n      return null;\n    }\n    const remainingGuaranteeAmount = this.booking.financial.collected - this.guaranteeAmount;\n    return (\n      <Host>\n        {this.guaranteeAmount !== 0 && (\n          <section>\n            <div class=\"applicable-policies__guarantee\">\n              <div class=\"applicable-policies__guarantee-info\">\n                <p class=\"applicable-policies__guarantee-date\">{moment(this.booking.booked_on.date, 'YYYY-MM-DD').format('MMM DD, YYYY')}</p>\n                <p class=\"applicable-policies__guarantee-amount\">{formatAmount(calendar_data.currency.symbol, this.guaranteeAmount)}</p>\n                <p class=\"applicable-policies__guarantee-label\">Guarantee</p>\n              </div>\n              {remainingGuaranteeAmount < 0 && (\n                <div class=\"applicable-policies__guarantee-action\">\n                  <ir-button\n                    btn_color=\"dark\"\n                    text=\"Pay\"\n                    size=\"sm\"\n                    onClickHandler={() => {\n                      this.generatePayment.emit({\n                        amount: Math.abs(remainingGuaranteeAmount),\n\n                        currency: calendar_data.currency,\n                        due_on: moment().format('YYYY-MM-DD'),\n                        pay_type_code: null,\n                        reason: '',\n                        type: 'OVERDUE',\n                      });\n                    }}\n                  ></ir-button>\n                </div>\n              )}\n            </div>\n          </section>\n        )}\n        <section>\n          <div class=\"applicable-policies__container\">\n            <p class=\"applicable-policies__title font-size-large p-0 m-0\">Cancellation Schedule</p>\n            <p class=\"applicable-policies__no-penalty\">{this.generateCancellationStatement()}</p>\n          </div>\n\n          <div class=\"applicable-policies__statements\">\n            {this.cancellationStatements?.map(statement => (\n              <div class=\"applicable-policies__statement\">\n                {this.cancellationStatements.length > 1 && (\n                  <p class=\"applicable-policies__room\">\n                    <b>{statement.roomType.name}</b> {statement.ratePlan['short_name']}\n                  </p>\n                )}\n                <div class=\"applicable-policies__brackets\">\n                  {statement.brackets.map((bracket, idx) => {\n                    const { leftLabel, rightLabel, showArrow } = this.getBracketLabelsAndArrowState({\n                      index: idx,\n                      bracket,\n                      brackets: statement.brackets,\n                      // checkIn: statement.checkInDate,\n                    });\n                    return (\n                      <div class=\"applicable-policies__bracket\">\n                        <p class=\"applicable-policies__bracket-dates\">\n                          {leftLabel} {showArrow && <ir-icons name=\"arrow_right\" class=\"applicable-policies__icon\" style={{ '--icon-size': '0.875rem' }}></ir-icons>} {rightLabel}\n                        </p>\n                        <p class=\"applicable-policies__amount\">{formatAmount(calendar_data.currency.symbol, bracket.amount)}</p>\n\n                        <p class=\"applicable-policies__statement-text\">{bracket.statement}</p>\n                      </div>\n                    );\n                  })}\n                </div>\n                <div class=\"applicable-policies__brackets-table\">\n                  <table>\n                    <tbody>\n                      {statement.brackets.map((bracket, idx) => {\n                        const { leftLabel, rightLabel, showArrow } = this.getBracketLabelsAndArrowState({\n                          index: idx,\n                          bracket,\n                          brackets: statement.brackets,\n                          // checkIn: statement.checkInDate,\n                        });\n                        return (\n                          <tr>\n                            <td class=\"applicable-policies__bracket-dates\">\n                              {leftLabel} {showArrow && <ir-icons name=\"arrow_right\" class=\"applicable-policies__icon\" style={{ '--icon-size': '0.875rem' }}></ir-icons>}{' '}\n                              {rightLabel}\n                            </td>\n\n                            <td class=\"applicable-policies__amount px-1\">{formatAmount(calendar_data.currency.symbol, bracket.amount)}</td>\n\n                            <td class=\"applicable-policies__statement-text\">{bracket.statement}</td>\n                          </tr>\n                        );\n                      })}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            ))}\n          </div>\n        </section>\n      </Host>\n    );\n  }\n}\n"]}