{"version":3,"file":"ir-checkout-dialog.js","sourceRoot":"","sources":["../../../src/components/ir-checkout-dialog/ir-checkout-dialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Booking } from '@/models/booking.dto';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport locales from '@/stores/locales.store';\nimport { Component, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\nimport { BookingInvoiceInfo } from '../ir-invoice/types';\n\n@Component({\n  tag: 'ir-checkout-dialog',\n  styleUrl: 'ir-checkout-dialog.css',\n  shadow: true,\n})\nexport class IrCheckoutDialog {\n  @Prop({ reflect: true }) open: boolean;\n  /**\n   * Booking data for the current room checkout action.\n   */\n  @Prop() booking: Booking;\n\n  /**\n   * Unique identifier of the room being checked out.\n   */\n  @Prop() identifier: string;\n\n  @State() isLoading: 'checkout' | 'skipCheckout' | 'checkout&invoice' | 'page' = 'page';\n  @State() buttons: Set<'checkout' | 'checkout_without_invoice' | 'invoice_checkout'> = new Set();\n  @State() invoiceInfo: BookingInvoiceInfo;\n\n  @Event({ composed: true, bubbles: true }) checkoutDialogClosed: EventEmitter<{ reason: 'dialog' | 'openInvoice' }>;\n\n  private bookingService = new BookingService();\n\n  private async checkoutRoom({ e, source }: { e: CustomEvent; source: 'checkout' | 'skipCheckout' | 'checkout&invoice' }) {\n    try {\n      e.stopImmediatePropagation();\n      e.stopPropagation();\n      this.isLoading = source;\n      await this.bookingService.handleExposedRoomInOut({\n        booking_nbr: this.booking.booking_nbr,\n        room_identifier: this.identifier,\n        status: '002',\n      });\n      this.isLoading = null;\n      this.checkoutDialogClosed.emit({ reason: source === 'checkout&invoice' ? 'openInvoice' : 'dialog' });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  @Watch('open')\n  handleOpenChange(newValue: boolean, oldValue: boolean) {\n    if (newValue !== oldValue) {\n      this.init();\n    }\n  }\n\n  private async init() {\n    if (!this.open) {\n      return;\n    }\n    try {\n      this.isLoading = 'page';\n      this.invoiceInfo = await this.bookingService.getBookingInvoiceInfo({ booking_nbr: this.booking.booking_nbr });\n      this.setupButtons();\n    } catch (error) {\n    } finally {\n      this.isLoading = null;\n    }\n  }\n\n  private setupButtons() {\n    const toBeInvoicedRooms = this.invoiceInfo.invoiceable_items.filter(item => item.type === 'BSA' && item.reason?.code !== '001');\n    //check if all rooms are invoiced\n    const allRoomInvoiced = toBeInvoicedRooms.length === 0;\n    if (allRoomInvoiced) {\n      this.buttons.add('checkout');\n      return;\n    }\n    //invoice and checkout : if some rooms are not invoiced\n    this.buttons.add('invoice_checkout');\n    //checkout without invoice :available except for last room in a booking\n    if (toBeInvoicedRooms.length > 1) {\n      this.buttons.add('checkout_without_invoice');\n    }\n  }\n\n  render() {\n    return (\n      <ir-dialog\n        open={this.open}\n        label=\"Alert\"\n        style={{ '--ir-dialog-width': 'fit-content' }}\n        onIrDialogHide={e => {\n          e.stopImmediatePropagation();\n          e.stopPropagation();\n          this.checkoutDialogClosed.emit();\n        }}\n      >\n        {this.isLoading === 'page' ? (\n          <div class=\"dialog__loader-container\">\n            <ir-spinner></ir-spinner>\n          </div>\n        ) : (\n          <p>Are you sure you want to Check Out this unit?</p>\n        )}\n        <div slot=\"footer\" class=\"ir-dialog__footer\">\n          {/* {!this.isLoading && ( */}\n          <Fragment>\n            <ir-custom-button size=\"medium\" data-dialog=\"close\" appearance=\"filled\" variant=\"neutral\">\n              {locales.entries.Lcz_Cancel}\n            </ir-custom-button>\n            {this.buttons.has('checkout') && (\n              <ir-custom-button\n                size=\"medium\"\n                // loading={this.isLoading}\n                onClickHandler={e => this.checkoutRoom({ e, source: 'checkout' })}\n                variant={'brand'}\n                loading={this.isLoading === 'checkout'}\n              >\n                Checkout\n              </ir-custom-button>\n            )}\n            {this.buttons.has('checkout_without_invoice') && (\n              <ir-custom-button\n                loading={this.isLoading === 'skipCheckout'}\n                size=\"medium\"\n                // loading={this.isLoading}\n                onClickHandler={e => this.checkoutRoom({ e, source: 'skipCheckout' })}\n                variant={'brand'}\n                appearance={this.buttons.has('invoice_checkout') ? 'outlined' : 'accent'}\n              >\n                Checkout without invoice\n              </ir-custom-button>\n            )}\n            {this.buttons.has('invoice_checkout') && (\n              <ir-custom-button\n                size=\"medium\"\n                loading={this.isLoading === 'checkout&invoice'}\n                onClickHandler={e => {\n                  this.checkoutRoom({ e, source: 'checkout&invoice' });\n                }}\n                variant={'brand'}\n                appearance={'accent'}\n              >\n                Checkout & invoice\n              </ir-custom-button>\n            )}\n          </Fragment>\n          {/* )} */}\n        </div>\n      </ir-dialog>\n    );\n  }\n}\n"]}