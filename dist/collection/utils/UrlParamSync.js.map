{"version":3,"file":"UrlParamSync.js","sourceRoot":"","sources":["../../src/utils/UrlParamSync.ts"],"names":[],"mappings":"AAOA,MAAM,OAAO,YAAY;IAOvB,YAAY,SAAY,EAAE,OAAwB;QAF1C,eAAU,GAA4C,EAAE,CAAC;QAsBjE,wBAAwB;QAChB,oBAAe,GAAG,GAAG,EAAE;YAC7B,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,YAAY,EAAE,EAAE,EAAE;gBACpD,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;gBACjC,IAAI,GAAG,GAAQ,YAAY,CAAC;gBAE5B,IAAI,GAAG,KAAK,IAAI,EAAE,CAAC;oBACjB,IAAI,CAAC;wBACH,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,GAAG,CAAC,CAAC,CAAC;oBAC5C,CAAC;oBAAC,WAAM,CAAC;wBACP,GAAG,GAAG,GAAG,CAAC,CAAC,yBAAyB;oBACtC,CAAC;gBACH,CAAC;gBAEA,IAAI,CAAC,SAAiB,CAAC,GAAG,CAAC,GAAG,GAAG,CAAC;YACrC,CAAC,CAAC,CAAC;QACL,CAAC,CAAC;QAnCA,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QAEvB,4BAA4B;QAC5B,IAAI,CAAC,eAAe,EAAE,CAAC;QAEvB,gCAAgC;QAChC,MAAM,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QAE1D,8DAA8D;QAC9D,IAAI,CAAC,YAAY,EAAE,CAAC;QAEpB,wCAAwC;QACxC,IAAI,CAAC,WAAW,EAAE,CAAC;QAEnB,iBAAiB;QACjB,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC3B,CAAC;IAoBO,QAAQ,CAAC,KAAa;QAC5B,MAAM,MAAM,GAAG,IAAI,eAAe,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;QAC3D,OAAO,MAAM,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC;IAEO,QAAQ,CAAC,KAAa,EAAE,KAAU,EAAE,OAAO,GAAG,IAAI;QACxD,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAE1C,IAAI,KAAK,KAAK,SAAS,IAAI,KAAK,KAAK,IAAI,IAAI,KAAK,KAAK,EAAE,EAAE,CAAC;YAC1D,GAAG,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QACjC,CAAC;aAAM,CAAC;YACN,MAAM,OAAO,GAAG,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;YAC1D,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACvC,CAAC;QAED,IAAI,OAAO,EAAE,CAAC;YACZ,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC;QACtD,CAAC;aAAM,CAAC;YACN,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,EAAE,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC;QACnD,CAAC;IACH,CAAC;IAEO,SAAS;QACf,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,OAAO,EAAE,EAAE,EAAE;YAC/C,MAAM,KAAK,GAAI,IAAI,CAAC,SAAiB,CAAC,GAAG,CAAC,CAAC;YAC3C,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,KAAK,EAAE,OAAO,aAAP,OAAO,cAAP,OAAO,GAAI,IAAI,CAAC,CAAC;QAC/C,CAAC,CAAC,CAAC;IACL,CAAC;IAED,6BAA6B;IACrB,WAAW;QACjB,MAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,cAAc,GAAI,IAAI,CAAC,SAAiB,CAAC,MAAM,CAAC;QACpD,IAAI,CAAC,SAAiB,CAAC,MAAM,GAAG;;YAC/B,IAAI,CAAC,SAAS,EAAE,CAAC;YACjB,OAAO,MAAA,IAAI,CAAC,cAAc,0CAAE,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QACrD,CAAC,CAAC;IACJ,CAAC;IAEO,iBAAiB;QACvB,MAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,oBAAoB,GAAI,IAAI,CAAC,SAAiB,CAAC,oBAAoB,CAAC;QACxE,IAAI,CAAC,SAAiB,CAAC,oBAAoB,GAAG;;YAC7C,MAAM,CAAC,mBAAmB,CAAC,UAAU,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;YAC7D,IAAI,CAAC,cAAc,EAAE,CAAC;YACtB,MAAA,IAAI,CAAC,oBAAoB,0CAAE,KAAK,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;QACpD,CAAC,CAAC;IACJ,CAAC;IAED,2BAA2B;IACnB,YAAY;QAClB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;YAC1B,IAAI,CAAC,UAAU,CAAC,IAAI,GAAG,OAAO,CAAC,SAAS,CAAC;YACzC,IAAI,CAAC,UAAU,CAAC,OAAO,GAAG,OAAO,CAAC,YAAY,CAAC;YAE/C,MAAM,KAAK,GAAG,IAAI,CAAC,eAAe,CAAC;YAEnC,OAAO,CAAC,SAAS,GAAG,UAAU,GAAG,IAAI;gBACnC,MAAM,GAAG,GAAI,IAAI,CAAC,UAAU,CAAC,IAAY,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;gBAC/D,KAAK,EAAE,CAAC;gBACR,OAAO,GAAG,CAAC;YACb,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAEb,OAAO,CAAC,YAAY,GAAG,UAAU,GAAG,IAAI;gBACtC,MAAM,GAAG,GAAI,IAAI,CAAC,UAAU,CAAC,OAAe,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;gBAClE,KAAK,EAAE,CAAC;gBACR,OAAO,GAAG,CAAC;YACb,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACf,CAAC;IACH,CAAC;IAEO,cAAc;QACpB,IAAI,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE,CAAC;YACzB,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC,IAAW,CAAC;YAChD,OAAO,CAAC,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,OAAc,CAAC;YACtD,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QACvB,CAAC;IACH,CAAC;CACF","sourcesContent":["type SyncConfig<T> = {\n  key: keyof T; // State property name\n  param: string; // URL param name\n  defaultValue?: any;\n  replace?: boolean; // true = replaceState (default), false = pushState\n};\n\nexport class UrlParamSync<T extends object> {\n  private component: T;\n  private configs: SyncConfig<T>[];\n  private originalDisconnected?: () => void;\n  private originalRender?: () => any;\n  private restoreFns: { push?: Function; replace?: Function } = {};\n\n  constructor(component: T, configs: SyncConfig<T>[]) {\n    this.component = component;\n    this.configs = configs;\n\n    // Initialize state from URL\n    this.applyUrlToState();\n\n    // Listen for browser navigation\n    window.addEventListener('popstate', this.applyUrlToState);\n\n    // Patch pushState/replaceState to detect external URL changes\n    this.patchHistory();\n\n    // Patch render to auto-sync state â†’ URL\n    this.patchRender();\n\n    // Ensure cleanup\n    this.patchDisconnected();\n  }\n\n  // --- State <-> URL ---\n  private applyUrlToState = () => {\n    this.configs.forEach(({ key, param, defaultValue }) => {\n      const raw = this.getParam(param);\n      let val: any = defaultValue;\n\n      if (raw !== null) {\n        try {\n          val = JSON.parse(decodeURIComponent(raw));\n        } catch {\n          val = raw; // fallback: plain string\n        }\n      }\n\n      (this.component as any)[key] = val;\n    });\n  };\n\n  private getParam(param: string): string | null {\n    const params = new URLSearchParams(window.location.search);\n    return params.get(param);\n  }\n\n  private setParam(param: string, value: any, replace = true) {\n    const url = new URL(window.location.href);\n\n    if (value === undefined || value === null || value === '') {\n      url.searchParams.delete(param);\n    } else {\n      const encoded = encodeURIComponent(JSON.stringify(value));\n      url.searchParams.set(param, encoded);\n    }\n\n    if (replace) {\n      window.history.replaceState({}, '', url.toString());\n    } else {\n      window.history.pushState({}, '', url.toString());\n    }\n  }\n\n  private updateAll() {\n    this.configs.forEach(({ key, param, replace }) => {\n      const value = (this.component as any)[key];\n      this.setParam(param, value, replace ?? true);\n    });\n  }\n\n  // --- Lifecycle Patching ---\n  private patchRender() {\n    const self = this;\n    this.originalRender = (this.component as any).render;\n    (this.component as any).render = function () {\n      self.updateAll();\n      return self.originalRender?.apply(this, arguments);\n    };\n  }\n\n  private patchDisconnected() {\n    const self = this;\n    this.originalDisconnected = (this.component as any).disconnectedCallback;\n    (this.component as any).disconnectedCallback = function () {\n      window.removeEventListener('popstate', self.applyUrlToState);\n      self.restoreHistory();\n      self.originalDisconnected?.apply(this, arguments);\n    };\n  }\n\n  // --- History Patching ---\n  private patchHistory() {\n    if (!this.restoreFns.push) {\n      this.restoreFns.push = history.pushState;\n      this.restoreFns.replace = history.replaceState;\n\n      const apply = this.applyUrlToState;\n\n      history.pushState = function (...args) {\n        const ret = (this.restoreFns.push as any).apply(history, args);\n        apply();\n        return ret;\n      }.bind(this);\n\n      history.replaceState = function (...args) {\n        const ret = (this.restoreFns.replace as any).apply(history, args);\n        apply();\n        return ret;\n      }.bind(this);\n    }\n  }\n\n  private restoreHistory() {\n    if (this.restoreFns.push) {\n      history.pushState = this.restoreFns.push as any;\n      history.replaceState = this.restoreFns.replace as any;\n      this.restoreFns = {};\n    }\n  }\n}\n"]}