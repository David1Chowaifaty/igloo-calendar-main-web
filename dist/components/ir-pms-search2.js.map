{"file":"ir-pms-search2.js","mappings":"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","names":[],"sources":["src/components/pms-header/ir-pms-search/ir-pms-search.css?tag=ir-pms-search&encapsulation=shadow","src/components/pms-header/ir-pms-search/ir-pms-search.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.pms-autocomplete__end-slot {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.pms-search__autocomplete::part(listbox) {\n  max-height: 250px;\n  width: max-content;\n  max-width: 350px;\n}\n\n.pms-search__option {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n\n.pms-search__option-label {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.pms-search__option-status {\n  flex-shrink: 0;\n}\n\n.pms-search__empty {\n  display: flex;\n  align-items: center;\n  flex-direction: column;\n  gap: 0.75rem;\n  padding: 0.75rem 0.9rem;\n  border-radius: 0.75rem;\n}\n\n.pms-search__empty-icon {\n  font-size: 1.1rem;\n  opacity: 0.7;\n  margin-top: 0.15rem;\n}\n\n.pms-search__empty-content {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 0.15rem;\n  min-width: 0;\n}\n\n.pms-search__empty-title {\n  font-weight: 600;\n  line-height: 1.2;\n}\n\n.pms-search__empty-subtitle {\n  font-size: 0.875rem;\n  opacity: 0.8;\n  line-height: 1.25;\n}\n\n.pms-search__empty-example {\n  font-weight: 600;\n  opacity: 0.95;\n}\n\n.pms-search__option {\n  display: grid;\n  grid-template-columns:\n    120px   /* booking numbers */\n    1fr           /* guest name (max width) */\n;\n  align-items: center;\n  gap: 1rem;\n}\n\n\n\n\n.pms-search__option-icon {\n  width: 1.5625rem; \n  flex-shrink: 0;\n}\n\n.pms-search__option-bookings {\n  margin: 0;\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  line-height: 1.2;\n}\n\n.pms-search__option-booking {\n  font-size: 0.875rem; \n  font-weight: 500;\n}\n\n.pms-search__option-channel-booking {\n  font-size: 0.75rem;\n}\n\n.pms-search__option-label {\n  font-size: 0.875rem;\n  font-weight: 500;\n  white-space: nowrap;\n}\n\n.pms-search__option-status {\n  margin-left: auto;\n}\n.pms-search__option-icon{\n  width: 1rem;\n}\n.pms-search__option-status,\n.pms-search__autocomplete-option::part(checked-icon){\n  display:none\n}\n.pms-search__option-label,\n.pms-search__option-booking{\n  font-size: 1rem;\n}\n\n@media (width >= 40rem){\n  .pms-search__option-icon {\n    width: 1.5625rem; \n    flex-shrink: 0;\n  }\n}\n@media (min-width: 768px){\n  .pms-search__autocomplete::part(listbox) {\n    width: auto;\n    max-width: var(--auto-size-available-width);\n  }\n  .pms-search__option-status{\n    display: inline-flex;\n  }\n}","import { IrComboboxSelectEventDetail } from '@/components';\nimport { Debounce } from '@/decorators/debounce';\nimport { Booking } from '@/models/booking.dto';\nimport Token from '@/models/Token';\nimport { BookingListingService } from '@/services/booking_listing.service';\nimport { Component, Event, EventEmitter, Host, Prop, State, Watch, h } from '@stencil/core';\n\n\n@Component({\n  tag: 'ir-pms-search',\n  styleUrl: 'ir-pms-search.css',\n  shadow: true,\n})\nexport class IrPmsSearch {\n  @Prop() propertyid: string;\n  @Prop() ticket: string;\n\n  @State() shortcutHint: string | null = null;\n  @State() bookings: Booking[] = [];\n  @State() isLoading: boolean;\n\n\n  private tokenService = new Token();\n  private bookingListingService = new BookingListingService();\n\n  @Event({ bubbles: true, composed: true, eventName: 'combobox-select' }) comboboxSelect: EventEmitter<IrComboboxSelectEventDetail>;\n  autoCompleteRef: HTMLIrAutocompleteElement;\n\n  componentWillLoad() {\n    document.addEventListener('keydown', this.focusInput);\n    this.detectShortcutHint();\n    if (this.ticket) {\n      this.tokenService.setToken(this.ticket);\n    }\n  }\n  disconnectedCallback() {\n    document.removeEventListener('keydown', this.focusInput);\n  }\n\n  @Watch('ticket')\n  handleTicketChange(newValue: string, oldValue: string) {\n    console.log(this.ticket);\n    if (newValue !== oldValue && newValue) {\n      this.tokenService.setToken(this.ticket);\n    }\n  }\n\n  private detectShortcutHint() {\n    // Hide on mobile / touch devices\n    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n\n    if (isTouchDevice) {\n      this.shortcutHint = null;\n      return;\n    }\n\n    // Detect macOS\n    const isMac = /Mac|iPhone|iPad|iPod/.test(navigator.platform);\n\n    this.shortcutHint = isMac ? 'âŒ˜ K' : 'Ctrl K';\n  }\n\n  private focusInput = (event: KeyboardEvent) => {\n    const isK = event.key.toLowerCase() === 'k';\n    const isCmdOrCtrl = event.metaKey || event.ctrlKey;\n\n    if (isK && isCmdOrCtrl) {\n      event.preventDefault();\n      // this.pickerInputRef?.focusInput();\n      console.log(this.autoCompleteRef)\n      this.autoCompleteRef.focusInput()\n    }\n  };\n  @Debounce(300)\n  private async fetchBookings(event: CustomEvent<string>) {\n    // throw new Error('Method not implemented.');\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    const value = event.detail;\n    this.autoCompleteRef.hide()\n    if (!value) {\n      return;\n    }\n    const isNumber = /^(?:-?\\d+|.{3}-.*)$/.test(value);\n    this.isLoading = true;\n    this.bookings = await this.bookingListingService.getExposedBookings(\n      {\n        book_nbr: isNumber ? value : null,\n        name: isNumber ? null : value,\n        property_id: this.propertyid as any,\n        filter_type: 1,\n        from: '2026-01-01',\n        to: '2026-01-08',\n        balance_filter: '0',\n        start_row: 0,\n        end_row: 20,\n        total_count: 0,\n        booking_status: '',\n        affiliate_id: 0,\n        is_mpo_managed: false,\n        is_mpo_used: false,\n        is_for_mobile: false,\n        is_combined_view: false,\n        is_to_export: false,\n        property_ids: null,\n        channel: '',\n      },\n      { skipStore: true },\n    );\n    this.autoCompleteRef.show()\n    this.isLoading = false;\n  }\n  private handleComboboxSelect(event: CustomEvent<string>): void {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n    this.comboboxSelect.emit({\n      item: {\n        label: \"\",\n        value: event.detail\n      }\n    });\n  }\n  render() {\n    return (\n      <Host>\n        <ir-autocomplete\n         \n          class=\"pms-search__autocomplete\"\n          placeholder='Search'\n          ref={el => this.autoCompleteRef = el}\n          onCombobox-change={event => this.handleComboboxSelect(event as CustomEvent<string>)}\n          onText-change={event => this.fetchBookings(event as CustomEvent<string>)}\n          pill appearance='filled'>\n          <wa-icon name='magnifying-glass' slot='start'></wa-icon>\n          <div slot='end' class=\"pms-autocomplete__end-slot\">\n            {this.isLoading && <wa-spinner></wa-spinner>}\n            {this.shortcutHint && <span>{this.shortcutHint}</span>}\n          </div>\n          {this.bookings?.length === 0 && !this.isLoading && (\n            <div class=\"pms-search__empty\" role=\"status\" aria-live=\"polite\">\n              <wa-icon name=\"circle-info\" aria-hidden=\"true\"></wa-icon>\n              <div class=\"pms-search__empty-content\">\n                <div class=\"pms-search__empty-title\">No results found</div>\n              </div>\n            </div>\n          )}\n          {this.bookings.map(b => {\n            const label = `${b.booking_nbr}  ${b.guest.first_name} ${b.guest.last_name}`;\n            return (\n              <ir-autocomplete-option class='pms-search__autocomplete-option' value={b.booking_nbr} label={label}>\n                  <img\n                    slot='start'\n                    class=\"pms-search__option-icon\"\n                    src={b.origin.Icon}\n                    alt={b.origin.Label}\n                  />\n                <div class=\"pms-search__option\">\n                  <p class=\"pms-search__option-bookings\">\n                    <span class=\"pms-search__option-booking\">\n                      {b.booking_nbr}\n                    </span>\n                    {b.channel_booking_nbr && (\n                      <span class=\"pms-search__option-channel-booking\">\n                        {b.channel_booking_nbr}\n                      </span>\n                    )}\n                  </p>\n                  <span class=\"pms-search__option-label\">\n                    {b.guest.first_name} {b.guest.last_name}\n                  </span>\n                </div>\n                  <ir-booking-status-tag\n                    slot='end'\n                    class=\"pms-search__option-status\"\n                    status={b.status}\n                  ></ir-booking-status-tag>\n\n              </ir-autocomplete-option>\n            );\n          })}\n        </ir-autocomplete>\n      </Host>\n    );\n  }\n\n}\n"],"version":3}