{"file":"ir-rectifier2.js","mappings":"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","names":["moment"],"sources":["src/components/igloo-calendar/igl-bulk-operations/ir-rectifier/ir-rectifier.css?tag=ir-rectifier&encapsulation=scoped","src/components/igloo-calendar/igl-bulk-operations/ir-rectifier/ir-rectifier.tsx"],"sourcesContent":[".ir-rectifier__form {\n  padding: 0 1.5rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1.5rem;\n}\n\n.ir-rectifier__roomtypes {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n.ir-rectifier__date-range {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n","import { ExposedRectifierParamsSchema, PropertyService } from '@/services/property.service';\nimport calendar_data from '@/stores/calendar-data';\nimport { Component, Event, EventEmitter, Host, Prop, State, h } from '@stencil/core';\nimport moment from 'moment';\n\ntype RectifierFormState = {\n  property_id: number | null;\n  room_type_ids: number[];\n  from: string | null;\n  to: string | null;\n};\n\n@Component({\n  tag: 'ir-rectifier',\n  styleUrl: 'ir-rectifier.css',\n  scoped: true,\n})\nexport class IrRectifier {\n  @Prop() formId: string;\n\n  @State() form: RectifierFormState = {\n    property_id: null,\n    room_type_ids: [],\n    from: null,\n    to: null,\n  };\n  @State() autoValidate = false;\n  @State() showRoomTypeError = false;\n\n  @Event() loadingChanged: EventEmitter<boolean>;\n  @Event() closeDrawer: EventEmitter<void>;\n\n  private propertyService = new PropertyService();\n  toDateRef: HTMLIrCustomDatePickerElement;\n\n  componentWillLoad() {\n    this.form = {\n      ...this.form,\n      property_id: calendar_data.property?.id ?? calendar_data.id ?? null,\n    };\n  }\n\n  private updateForm(next: Partial<RectifierFormState>) {\n    this.form = {\n      ...this.form,\n      ...next,\n    };\n  }\n\n  private normalizeDateRange(next: Partial<RectifierFormState>) {\n    const from = next.from ?? this.form.from;\n    const to = next.to ?? this.form.to;\n\n    if (from && to && moment(from).isAfter(to, 'day')) {\n      if (next.from) {\n        return { ...next, to: from };\n      }\n      if (next.to) {\n        return { ...next, from: to };\n      }\n    }\n    return next;\n  }\n\n  private updateRoomTypeSelection(roomTypeId: number, checked: boolean) {\n    const nextIds = new Set(this.form.room_type_ids);\n    if (checked) {\n      nextIds.add(roomTypeId);\n    } else {\n      nextIds.delete(roomTypeId);\n    }\n    this.showRoomTypeError = false;\n    this.updateForm({ room_type_ids: Array.from(nextIds) });\n  }\n\n  private async handleSubmit() {\n    this.loadingChanged.emit(true);\n    this.autoValidate = true;\n    this.showRoomTypeError = false;\n    try {\n      const propertyId = this.form.property_id ?? calendar_data.property?.id ?? calendar_data.id ?? undefined;\n      const result = ExposedRectifierParamsSchema.safeParse({\n        ...this.form,\n        property_id: propertyId,\n      });\n      if (!result.success) {\n        this.showRoomTypeError = result.error.issues.some(issue => issue.path[0] === 'room_type_ids');\n        return;\n      }\n      await this.propertyService.exposedRectifier(result.data);\n      this.closeDrawer.emit();\n    } catch (error) {\n      console.error(error);\n    } finally {\n      this.loadingChanged.emit(false);\n    }\n  }\n\n  render() {\n    const roomTypes = calendar_data.property?.roomtypes ?? [];\n    return (\n      <Host>\n        <form\n          onSubmit={e => {\n            e.preventDefault();\n            this.handleSubmit();\n          }}\n          class=\"ir-rectifier__form\"\n          id={this.formId}\n        >\n          <wa-callout size=\"small\" appearance=\"filled\" variant=\"warning\">\n            <wa-icon slot=\"icon\" name=\"triangle-exclamation\"></wa-icon>\n            This will update the total availability of the select room types by calculating: No. of physical rooms - Booked - Blocked - Pending\n          </wa-callout>\n          <div class=\"ir-rectifier__roomtypes\">\n            {roomTypes.map(roomtype => {\n              const roomTypeId = Number(roomtype?.id);\n              if (!Number.isFinite(roomTypeId)) {\n                return null;\n              }\n              const isSelected = this.form.room_type_ids.includes(roomTypeId);\n              return (\n                <wa-checkbox\n                  class=\"ir-rectifier__roomtype-checkbox\"\n                  checked={isSelected}\n                  onchange={e => {\n                    const checked = (e.target as HTMLInputElement).checked;\n                    this.updateRoomTypeSelection(roomTypeId, checked);\n                  }}\n                >\n                  {roomtype.name}\n                </wa-checkbox>\n              );\n            })}\n          </div>\n          {this.showRoomTypeError && <p class=\"text-danger m-0\">Please select at least one room type.</p>}\n          <div class=\"ir-rectifier__date-range\">\n            <ir-validator value={this.form.from ?? null} schema={ExposedRectifierParamsSchema.shape.from} autovalidate={this.autoValidate}>\n              <ir-custom-date-picker\n                class=\"ir-rectifier__date-picker ir-rectifier__date-picker--from\"\n                label=\"From\"\n                emitEmptyDate\n                date={this.form.from}\n                onDateChanged={e => {\n                  const from = e.detail.start?.format('YYYY-MM-DD') ?? null;\n                  this.updateForm(this.normalizeDateRange({ from }));\n                  requestAnimationFrame(() => this.toDateRef?.openDatePicker());\n                }}\n              ></ir-custom-date-picker>\n            </ir-validator>\n            <ir-validator value={this.form.to ?? null} schema={ExposedRectifierParamsSchema.shape.to} autovalidate={this.autoValidate}>\n              <ir-custom-date-picker\n                class=\"ir-rectifier__date-picker ir-rectifier__date-picker--to\"\n                label=\"To (inclusive)\"\n                emitEmptyDate\n                disabled={!this.form.from}\n                ref={el => (this.toDateRef = el)}\n                date={this.form.to}\n                minDate={this.form.from}\n                onDateChanged={e => {\n                  const to = e.detail.start?.format('YYYY-MM-DD') ?? null;\n                  this.updateForm(this.normalizeDateRange({ to }));\n                }}\n              ></ir-custom-date-picker>\n            </ir-validator>\n          </div>\n        </form>\n      </Host>\n    );\n  }\n}\n"],"version":3}