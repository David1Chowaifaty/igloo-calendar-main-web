{"file":"ir-booking-guarantee2.js","mappings":"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","names":[],"sources":["src/components/ir-booking-details/ir-payment-details/ir-booking-guarantee/ir-booking-guarantee.css?tag=ir-booking-guarantee&encapsulation=scoped","src/components/ir-booking-details/ir-payment-details/ir-booking-guarantee/ir-booking-guarantee.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n:host {\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;\n}\n:host * {\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;\n}\n.iframeHeight {\n  height: max-content;\n  height: 22.5rem;\n}\n","import { Component, h, Prop, State } from '@stencil/core';\nimport { Booking } from '@/models/booking.dto';\nimport { BookingService } from '@/services/booking.service';\nimport { toFloat } from '@/utils/utils';\nimport locales from '@/stores/locales.store';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  styleUrl: 'ir-booking-guarantee.css',\n  tag: 'ir-booking-guarantee',\n  scoped: true,\n})\nexport class IrBookingGuarantee {\n  @Prop() booking: Booking;\n  @Prop() bookingService: BookingService;\n\n  @State() collapsed: boolean = false;\n  @State() paymentDetailsUrl: string = '';\n  @State() paymentExceptionMessage: string = '';\n\n  async componentWillLoad() {\n    try {\n      // Initialize any required data\n    } catch (error) {\n      if (this.booking.guest.cci) {\n        return;\n      }\n      if (!this.booking.is_direct && this.booking.channel_booking_nbr) {\n        this.paymentExceptionMessage = error;\n      }\n    }\n  }\n\n  private formatCurrency(amount: number, currency: string, locale: string = 'en-US'): string {\n    if (!currency || amount < 0) {\n      return '';\n    }\n\n    return new Intl.NumberFormat(locale, {\n      style: 'currency',\n      currency,\n      minimumFractionDigits: 2,\n      maximumFractionDigits: 2,\n    }).format(amount);\n  }\n\n  private checkPaymentCode(value: string): string | null {\n    return calendar_data.allowed_payment_methods?.find(pm => pm.code === value)?.description ?? null;\n  }\n\n  private getPaymentMethod(): string | null {\n    let paymentMethod = null;\n    const payment_code = this.booking?.extras?.find(e => e.key === 'payment_code');\n\n    if (this.booking.agent) {\n      const code = this.booking?.extras?.find(e => e.key === 'agent_payment_mode');\n      if (code) {\n        paymentMethod = code.value === '001' ? locales.entries.Lcz_OnCredit : payment_code ? this.checkPaymentCode(payment_code.value) : null;\n      }\n    } else if (payment_code) {\n      paymentMethod = payment_code.value === '000' ? 'No card info required upon booking' : this.checkPaymentCode(payment_code.value);\n    }\n\n    return paymentMethod;\n  }\n\n  private async handleToggleCollapse() {\n    if (!this.booking.is_direct && this.booking.channel_booking_nbr && !this.booking.guest.cci && !this.collapsed) {\n      this.paymentDetailsUrl = await this.bookingService.getPCICardInfoURL(this.booking.booking_nbr);\n    }\n    this.collapsed = !this.collapsed;\n  }\n\n  private shouldShowGuarantee(): boolean {\n    const paymentMethod = this.booking.is_direct ? this.getPaymentMethod() : null;\n    return this.booking.is_direct ? Boolean(paymentMethod || this.booking.guest.cci) : true;\n  }\n\n  private shouldShowToggleButton() {\n    return !this.booking.is_direct || (this.booking.is_direct && this.booking.guest.cci);\n  }\n\n  private renderCreditCardInfo() {\n    const { cci } = this.booking.guest;\n    if (!cci) return null;\n\n    return [\n      <div>\n        {cci && 'Card:'} <span>{cci.nbr || ''}</span>\n        {cci.expiry_month && ' Expiry: '}\n        <span>\n          {cci.expiry_month || ''}\n          {cci.expiry_year && '/' + cci.expiry_year}\n        </span>\n      </div>,\n      <div>\n        {cci.holder_name && 'Name:'} <span>{cci.holder_name || ''}</span>\n        {cci.cvc && ' - CVC:'} <span>{cci.cvc || ''}</span>\n      </div>,\n    ];\n  }\n\n  private renderCollapsedContent() {\n    if (this.booking.guest.cci) {\n      return this.renderCreditCardInfo();\n    }\n\n    if (this.paymentDetailsUrl) {\n      return <iframe src={this.paymentDetailsUrl} width=\"100%\" class=\"iframeHeight\" frameborder=\"0\" name=\"payment\" />;\n    }\n\n    return <div class=\"text-center\">{this.paymentExceptionMessage}</div>;\n  }\n\n  private renderOtaGuarantee() {\n    const { ota_guarante } = this.booking;\n    if (!ota_guarante || this.booking.is_direct) return null;\n\n    return (\n      <div>\n        <ir-label content={ota_guarante.card_type + `${ota_guarante.is_virtual ? ' (virtual)' : ''}`} labelText={`${locales.entries.Lcz_CardType}:`} />\n        <ir-label content={ota_guarante.cardholder_name} labelText={`${locales.entries.Lcz_CardHolderName}:`} />\n        <ir-label content={ota_guarante.card_number} labelText={`${locales.entries.Lcz_CardNumber}:`} />\n        <ir-label\n          content={this.formatCurrency(\n            toFloat(Number(ota_guarante.meta?.virtual_card_current_balance), Number(ota_guarante.meta?.virtual_card_decimal_places)),\n            ota_guarante.meta?.virtual_card_currency_code,\n          )}\n          labelText={`${locales.entries.Lcz_CardBalance}:`}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    if (!this.shouldShowGuarantee()) {\n      return null;\n    }\n\n    const paymentMethod = this.booking.is_direct ? this.getPaymentMethod() : null;\n\n    return (\n      <div class=\"mb-1\">\n        <div class=\"d-flex align-items-center\">\n          <span class=\"mr-1 font-medium\">\n            {locales.entries.Lcz_BookingGuarantee}\n            {paymentMethod && <span>: {paymentMethod}</span>}\n          </span>\n\n          {this.shouldShowToggleButton() && (\n            <ir-button\n              id=\"drawer-icon\"\n              data-toggle=\"collapse\"\n              data-target=\".guarrantee\"\n              aria-expanded={this.collapsed ? 'true' : 'false'}\n              aria-controls=\"myCollapse\"\n              class=\"sm-padding-right pointer\"\n              variant=\"icon\"\n              icon_name=\"credit_card\"\n              onClickHandler={this.handleToggleCollapse.bind(this)}\n            />\n          )}\n        </div>\n\n        <div class=\"collapse guarrantee\">{this.renderCollapsedContent()}</div>\n\n        {this.renderOtaGuarantee()}\n      </div>\n    );\n  }\n}\n"],"version":3}