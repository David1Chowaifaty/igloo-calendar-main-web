{"file":"ir-unbookable-rooms-data2.js","mappings":"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","names":["moment"],"sources":["src/components/ir-unbookable-rooms/ir-unbookable-rooms-data/ir-unbookable-rooms-data.css?tag=ir-unbookable-rooms-data&encapsulation=scoped","src/components/ir-unbookable-rooms/ir-unbookable-rooms-data/ir-unbookable-rooms-data.tsx"],"sourcesContent":[":host {\n  display: block;\n  flex: 1 1 0%;\n}\n\n.unbookable-rooms__empty-state {\n  flex: 1 1 0%;\n}\n\n.unbookable-rooms__empty-state::part(body) {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n  text-align: center;\n  height: 100%;\n}\n\n.unbookable-rooms__empty-state--icon {\n  font-size: 1.5rem;\n  color: var(--wa-color-success-fill-loud);\n}\n\n.unbookable-rooms__card-container {\n  flex: 1 1 0%;\n}\n\n.property-card__header {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n}\n\n.property-card__header h3 {\n  margin: 0;\n  font-size: 1.05rem;\n}\n\n.property-card__body {\n  display: grid;\n}\n\n.issue {\n  display: grid;\n  gap: 1rem;\n  padding: 0.875rem 0;\n}\n\n.issue__info {\n  display: grid;\n  gap: 4px;\n  width: fit-content;\n}\n\n.issue__progress-container {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  flex: 1 1 0%;\n  width: 100%;\n  max-width: 600px;\n}\n\n.issue__progress-bar {\n  flex: 1 1 0%;\n}\n\n.issue__detail::part(header),\n.issue__detail::part(content) {\n  padding-left: 0 !important;\n  padding-right: 0 !important;\n}\n\n.issue__detail::part(content) {\n  padding-bottom: 0;\n}\n\n:host([mode='default']) .issue__detail::part(icon) {\n  display: none;\n}\n\n.issue__detail::part(header) {\n  padding: 0;\n}\n\n:host([mode='default']) .issue__detail::part(header) {\n  cursor: default;\n}\n\n:host([mode='default']) .issue__detail::part(header):focus-visible {\n  outline: none !important;\n}\n\n:host([mode='mpo']) .issue__detail::part(content) {\n  padding-inline-start: 0.5rem !important;\n}\n\n@media (min-width: 768px) {\n  .issue {\n    grid-template-columns: minmax(max-content, 300px) 1fr;\n  }\n}\n/* =========================================================\n   Period Chart (Timeline)\n   ========================================================= */\n\n.period-chart {\n  display: grid;\n  grid-template-columns: auto 1fr auto;\n  align-items: center;\n  gap: 1rem;\n  font-size: 0.875rem;\n}\n\n.period-chart__track {\n  position: relative;\n  height: 4px;\n  background: var(--wa-color-danger-fill-loud);\n  border-radius: 2px;\n}\n\n.period-chart__marker {\n  position: absolute;\n  top: 50%;\n  transform: translate(-50%, -50%);\n}\n\n.period-chart__marker::before {\n  content: '';\n  width: 8px;\n  height: 8px;\n  background: var(--wa-color-brand-fill-loud);\n  border-radius: 50%;\n  display: block;\n}\n\n.period-chart__label {\n  position: absolute;\n  top: -1.5rem;\n  left: 50%;\n  transform: translateX(-50%);\n  white-space: nowrap;\n  font-weight: 600;\n  color: var(--wa-color-danger-fill-loud);\n}\n\n.period-chart__start,\n.period-chart__end {\n  color: var(--wa-color-text-quiet);\n}\n\n.period-chart__fill {\n  position: absolute;\n  height: 100%;\n  left: 0;\n  top: 0;\n  background: var(--wa-color-brand-fill-loud);\n  border-radius: 2px;\n}\n\n.period-chart__fill {\n  border-radius: 2px 0 0 2px;\n}\n\n.period-chart__fill,\n.period-chart__marker {\n  transition: width 0.3s ease, left 0.3s ease;\n}\n/* =========================================================\n   Period Chart Legend\n   ========================================================= */\n\n.period-chart__legend {\n  display: flex;\n  justify-content: flex-end;\n  gap: 1rem;\n  margin-top: 0.5rem;\n  font-size: 0.75rem;\n}\n\n.period-chart__legend-item {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  white-space: nowrap;\n}\n\n.period-chart__legend-swatch {\n  width: 10px;\n  height: 10px;\n  border-radius: 2px;\n  flex-shrink: 0;\n}\n\n.period-chart__legend-swatch--bookable {\n  background: var(--wa-color-brand-fill-loud);\n}\n\n.period-chart__legend-swatch--blocked {\n  background: var(--wa-color-danger-fill-loud);\n}\n","import { Component, Host, Prop, State, h } from '@stencil/core';\nimport { AllowedProperties, FetchUnBookableRoomsResult } from '@/services/property.service';\nimport { Debounce } from '@/decorators/debounce';\nimport moment from 'moment';\n\ntype UnbookableRoomsMode = 'default' | 'mpo';\ntype UnbookableRoomsFilters = { period_to_check: number; consecutive_period: number; country: string };\n\n@Component({\n  tag: 'ir-unbookable-rooms-data',\n  styleUrl: 'ir-unbookable-rooms-data.css',\n  scoped: true,\n})\nexport class IrUnbookableRoomsData {\n  @Prop({ reflect: true }) mode: UnbookableRoomsMode = 'default';\n  @Prop() isLoading = false;\n  @Prop() errorMessage = '';\n  @Prop() unbookableRooms: FetchUnBookableRoomsResult = [];\n  @Prop() allowedProperties: AllowedProperties = null;\n  @Prop() filters: UnbookableRoomsFilters = { period_to_check: 2, consecutive_period: 14, country: 'all' };\n  @Prop() progressFilters = { period_to_check: 2, consecutive_period: 14 };\n\n  @State() propertyNameFilter = '';\n\n  private todayFormatted = moment().format('MMM DD');\n\n  private getPropertyName(propertyId: number) {\n    if (!this.allowedProperties?.length) {\n      return `Property ${propertyId}`;\n    }\n    const match = this.allowedProperties.find(property => property.id === propertyId);\n    return match?.name ?? `Property ${propertyId}`;\n  }\n\n  private getPeriodOffset(firstNight: string): number {\n    if (!firstNight) return 0;\n\n    const today = moment().startOf('day');\n    const firstUnbookable = moment(firstNight, 'YYYY-MM-DD');\n\n    if (!firstUnbookable.isValid()) {\n      return 0;\n    }\n\n    const daysUntil = firstUnbookable.diff(today, 'days');\n\n    // Account for consecutive nights\n    const effectiveStart = daysUntil - (this.progressFilters.consecutive_period - 1);\n\n    const offset = (effectiveStart / (this.progressFilters.period_to_check * 30)) * 100;\n\n    return Math.max(0, Math.min(100, offset));\n  }\n\n  private getEndDateFormatted(): string {\n    return moment().add(this.progressFilters.period_to_check, 'months').format('MMM DD');\n  }\n\n  @Debounce(300)\n  private filterProperties(value: string): void {\n    this.propertyNameFilter = value?.trim().toLowerCase() ?? '';\n  }\n\n  render() {\n    const totalIssues = this.unbookableRooms?.length ?? 0;\n    const selectedCountryId = this.filters.country !== 'all' ? Number(this.filters.country) : null;\n    const hasCountryFilter = this.mode === 'mpo' && Number.isFinite(selectedCountryId);\n    const filteredRooms = hasCountryFilter ? this.unbookableRooms.filter(entry => entry.country?.id === selectedCountryId) : this.unbookableRooms;\n    const groupedByProperty = filteredRooms.reduce((acc, entry) => {\n      const list = acc.get(entry.property_id) ?? [];\n      acc.set(entry.property_id, [...list, entry]);\n      return acc;\n    }, new Map<number, FetchUnBookableRoomsResult>());\n    const groupedEntries = [...groupedByProperty.entries()].map(([propertyId, entries]) => ({\n      propertyId,\n      entries,\n      name: this.getPropertyName(propertyId),\n    }));\n    const sortedEntries = groupedEntries.sort(\n      (a, b) => a.name.localeCompare(b.name, undefined, { sensitivity: 'base' }) || a.propertyId - b.propertyId,\n    );\n    const filteredEntries =\n      this.mode === 'mpo' && this.propertyNameFilter ? sortedEntries.filter(item => item.name.toLowerCase().includes(this.propertyNameFilter)) : sortedEntries;\n\n    return (\n      <Host>\n        {!this.isLoading && !this.errorMessage && totalIssues === 0 && (\n          <wa-card class=\"unbookable-rooms__empty-state\">\n            <wa-icon name=\"check-circle\" class=\"unbookable-rooms__empty-state--icon\"></wa-icon>\n            <p>Hooray! Nothing to report.</p>\n          </wa-card>\n        )}\n        {totalIssues > 0 && (\n          <wa-card class=\"unbookable-rooms__card-container\">\n            {this.mode === 'mpo' && (\n              <ir-input\n                withClear\n                class=\"mb-2\"\n                onText-change={e => this.filterProperties(e.detail)}\n                style={{ maxWidth: '400px' }}\n                placeholder=\"Search properties\"\n                appearance=\"filled\"\n              >\n                <wa-icon slot=\"start\" name=\"magnifying-glass\"></wa-icon>\n              </ir-input>\n            )}\n            {filteredEntries.map(({ propertyId, entries }, i) => [\n              <article class=\"property-card\">\n                <wa-details\n                  name=\"issue-card\"\n                  onwa-hide={e => {\n                    e.stopImmediatePropagation();\n                    e.stopPropagation();\n                    if (this.mode === 'default') {\n                      e.preventDefault();\n                    }\n                  }}\n                  open={this.mode === 'default'}\n                  appearance=\"plain\"\n                  class=\"issue__detail\"\n                >\n                  {this.mode === 'mpo' && (\n                    <header slot=\"summary\" class=\"property-card__header\">\n                      <span>{this.getPropertyName(propertyId)}</span>\n                      <b>({entries.length}) </b>\n                    </header>\n                  )}\n                  <div class=\"property-card__body\">\n                    {entries.map(entry => [\n                      <div class=\"issue\">\n                        <div class=\"issue__info\">\n                          <span class=\"issue__room\">{entry.room_type_name}</span>\n                        </div>\n                        <div class=\"period-chart\">\n                          <span class=\"period-chart__start\">{this.todayFormatted}</span>\n\n                          <div class=\"period-chart__track\">\n                            <div\n                              title=\"available\"\n                              class=\"period-chart__fill\"\n                              style={{\n                                width: `${this.getPeriodOffset(entry.first_night_not_bookable)}%`,\n                              }}\n                            ></div>\n\n                            <div\n                              class=\"period-chart__marker\"\n                              style={{\n                                left: `${this.getPeriodOffset(entry.first_night_not_bookable)}%`,\n                              }}\n                            >\n                              <span class=\"period-chart__label\">{moment(entry.first_night_not_bookable, 'YYYY-MM-DD').format('MMM DD')}</span>\n                            </div>\n                          </div>\n\n                          <span class=\"period-chart__end\">{this.getEndDateFormatted()}</span>\n                        </div>\n                      </div>,\n                    ])}\n                  </div>\n                  <section class=\"period-chart__legend\">\n                    <div class=\"period-chart__legend-item\">\n                      <span class=\"period-chart__legend-swatch period-chart__legend-swatch--bookable\"></span>\n                      <span>Bookable period</span>\n                    </div>\n\n                    <div class=\"period-chart__legend-item\">\n                      <span class=\"period-chart__legend-swatch period-chart__legend-swatch--blocked\"></span>\n                      <span>Not bookable period</span>\n                    </div>\n                  </section>\n                </wa-details>\n              </article>,\n              i !== filteredEntries.length - 1 && <wa-divider></wa-divider>,\n            ])}\n          </wa-card>\n        )}\n      </Host>\n    );\n  }\n}\n"],"version":3}