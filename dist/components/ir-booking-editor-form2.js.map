{"file":"ir-booking-editor-form2.js","mappings":"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","names":[],"sources":["src/components/igloo-calendar/ir-booking-editor/ir-booking-editor-form/ir-booking-editor-form.css?tag=ir-booking-editor-form&encapsulation=scoped","src/components/igloo-calendar/ir-booking-editor/ir-booking-editor-form/ir-booking-editor-form.tsx"],"sourcesContent":[":host {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n}\n.booking-editor__guest-form {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  height: 100%;\n}\n.booking-editor__header {\n  width: 100%;\n  align-items: flex-center;\n  display: flex;\n}\n\n.booking-editor__dates {\n  line-height: 1.2;\n}\n\n.booking-editor__total {\n  display: flex;\n  align-items: center;\n  white-space: nowrap;\n}\n\n.booking-editor__total-label {\n  margin-right: 4px;\n}\n\n.booking-editor__total-amount {\n  white-space: nowrap;\n}\n\n.booking-editor__booked-by {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-bottom: 1.5rem;\n}\n\n.booking-editor__heading {\n  margin: 0;\n  font-family: var(--wa-font-family-heading);\n  font-weight: var(--wa-font-weight-heading);\n  line-height: var(--wa-line-height-condensed);\n  text-wrap: balance;\n  font-size: var(--wa-font-size-l);\n  /* margin-bottom: 1.5rem; */\n}\n\n@media (min-width: 768px) {\n  .booking-editor__booked-by {\n    flex-direction: row;\n    align-items: center;\n  }\n  .booking-editor__booked-by-picker {\n    max-width: 40rem;\n  }\n}\n","import booking_store, { bookedByGuestBaseData, calculateTotalRooms, getBookingTotalPrice, IRatePlanSelection, updateBookedByGuest } from '@/stores/booking.store';\nimport calendar_data from '@/stores/calendar-data';\nimport locales from '@/stores/locales.store';\nimport { formatAmount } from '@/utils/utils';\nimport { Component, Event, EventEmitter, h, Prop, State } from '@stencil/core';\nimport { BookingEditorMode } from '../types';\nimport { calculateDaysBetweenDates } from '@/utils/booking';\nimport { Room } from '@/models/booking.dto';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { ExposedGuests } from '@/services/booking-service/types';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\n\n@Component({\n  tag: 'ir-booking-editor-form',\n  styleUrl: 'ir-booking-editor-form.css',\n  scoped: true,\n})\nexport class IrBookingEditorForm {\n  @Prop() mode: BookingEditorMode = 'PLUS_BOOKING';\n  @Prop() room: Room;\n\n  @State() guests: ExposedGuests;\n  @Event() doReservation: EventEmitter<string>;\n\n  private bookingService = new BookingService();\n  pickerEl: HTMLIrPickerElement;\n\n  private async fetchGuests(email: string) {\n    try {\n      if (!email) {\n        return;\n      }\n      this.guests = await this.bookingService.fetchExposedGuest(email, calendar_data.property.id);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n\n  private handleComboboxSelect(e: CustomEvent) {\n    const guest = this.guests?.find(guest => guest.id?.toString() === e.detail.item.value);\n    if (!guest) {\n      console.warn(`guest not found with id ${e.detail.item.value}`);\n      return;\n    }\n    updateBookedByGuest({\n      id: guest.id,\n      email: guest.email,\n      firstName: guest.first_name,\n      lastName: guest.last_name,\n      mobile: guest.mobile_without_prefix,\n      countryId: guest.country_id?.toString(),\n      phone_prefix: guest['country_phone_prefix'],\n    });\n  }\n  render() {\n    const { dates } = booking_store.bookingDraft;\n    let hasBookedByGuestController = false;\n    const totalRooms = calculateTotalRooms();\n    const totalCost = totalRooms > 1 ? getBookingTotalPrice() : 0;\n    return (\n      <form\n        class=\"booking-editor__guest-form\"\n        id=\"new_booking_form\"\n        autoComplete=\"off\"\n        onSubmit={e => {\n          e.preventDefault();\n          const submitter = (e as SubmitEvent).submitter as any | null;\n          this.doReservation.emit(submitter?.value);\n        }}\n      >\n        <div class=\"booking-editor__header\">\n          <ir-date-view\n            class=\"booking-editor__dates mr-1 flex-fill font-weight-bold font-medium-1\"\n            from_date={dates.checkIn}\n            to_date={dates.checkOut}\n            dateOption=\"DD MMM YYYY\"\n          ></ir-date-view>\n\n          {totalRooms > 1 && (\n            <div class=\"booking-editor__total mt-1 mt-md-0 text-right\">\n              <span class=\"booking-editor__total-label\">{locales.entries.Lcz_TotalPrice}</span>{' '}\n              <span class=\"booking-editor__total-amount font-weight-bold font-medium-1\">{formatAmount(calendar_data.property.currency.symbol, totalCost)}</span>\n            </div>\n          )}\n        </div>\n        {Object.values(booking_store.ratePlanSelections).map(val =>\n          Object.values(val).map(ratePlan => {\n            const rp = ratePlan as IRatePlanSelection;\n            if (rp.reserved === 0) {\n              return null;\n            }\n\n            return [...new Array(rp.reserved)].map((_, i) => {\n              const shouldAutoFillGuest =\n                ['BAR_BOOKING', 'PLUS_BOOKING'].includes(this.mode) &&\n                booking_store.bookedByGuest.id === -1 &&\n                !hasBookedByGuestController &&\n                !booking_store.bookedByGuestManuallyEdited;\n              if (shouldAutoFillGuest) {\n                hasBookedByGuestController = true;\n              }\n              return (\n                <igl-application-info\n                  autoFillGuest={shouldAutoFillGuest}\n                  totalNights={calculateDaysBetweenDates(dates.checkIn.format('YYYY-MM-DD'), dates.checkOut.format('YYYY-MM-DD'))}\n                  bedPreferenceType={booking_store.selects.bedPreferences}\n                  currency={calendar_data.property.currency}\n                  guestInfo={rp.guest ? rp.guest[i] : null}\n                  bookingType={this.mode}\n                  rateplanSelection={rp}\n                  key={`${rp.ratePlan.id}_${i}`}\n                  roomIndex={i}\n                  baseData={\n                    this.mode === 'EDIT_BOOKING'\n                      ? {\n                          roomtypeId: this.room.roomtype.id,\n                          unit: this.room.unit as any,\n                        }\n                      : undefined\n                  }\n                ></igl-application-info>\n              );\n            });\n          }),\n        )}\n        {['BAR_BOOKING', 'PLUS_BOOKING'].includes(this.mode) && (\n          <section class={'mt-2'}>\n            <div class=\"booking-editor__booked-by booking-editor__booked-by-header\">\n              <h4 class=\"booking-editor__heading booking-editor__booked-by-title\">Booked by</h4>\n\n              <ir-picker\n                class=\"booking-editor__booked-by-picker\"\n                appearance=\"filled\"\n                // placeholder=\"Search customer by email, name or company name\"\n                placeholder=\"Search customer by email or name\"\n                withClear\n                onText-change={event => this.fetchGuests(event.detail)}\n                debounce={500}\n                loading={isRequestPending('/Fetch_Exposed_Guests')}\n                mode=\"select-async\"\n                ref={el => (this.pickerEl = el)}\n                onCombobox-select={this.handleComboboxSelect.bind(this)}\n              >\n                {this.guests?.map(guest => {\n                  const label = `${guest.email} - ${guest.first_name} ${guest.last_name}`;\n                  return (\n                    <ir-picker-item label={label} value={guest.id?.toString()} key={guest.id}>\n                      {label}\n                    </ir-picker-item>\n                  );\n                })}\n              </ir-picker>\n              {booking_store.bookedByGuest.id !== -1 && (\n                <ir-custom-button\n                  onClickHandler={() => {\n                    updateBookedByGuest(bookedByGuestBaseData);\n                    this.pickerEl.clearInput();\n                  }}\n                  variant=\"brand\"\n                >\n                  Clear user\n                </ir-custom-button>\n              )}\n            </div>\n            <ir-booking-editor-guest-form></ir-booking-editor-guest-form>\n          </section>\n        )}\n      </form>\n    );\n  }\n}\n"],"version":3}