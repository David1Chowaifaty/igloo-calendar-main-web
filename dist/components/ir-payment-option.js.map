{"file":"ir-payment-option.js","mappings":"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","names":["IrPaymentOption"],"sources":["src/components/ir-payment-option/ir-payment-option.css?tag=ir-payment-option&encapsulation=scoped","src/components/ir-payment-option/ir-payment-option.tsx"],"sourcesContent":["/* @import url('../../assets/reset.css'); */\n:host {\n  display: block;\n}\n.payment-table-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.po-view {\n  padding: 0;\n  margin: 0;\n}\n.payment-img {\n  height: 18px;\n  display: none;\n}\n\n@media (min-width: 768px) {\n  .po-view {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    gap: 0.5rem;\n  }\n  .dataTable {\n    width: 70%;\n  }\n  .payment-img {\n    display: block;\n  }\n  .actions-header {\n    width: max-content !important;\n  }\n  .payment-table-container {\n    justify-content: flex-start;\n  }\n}\n@media (min-width: 1280px) {\n  .dataTable {\n    width: 50%;\n  }\n}\n","import { PaymentOption } from '@/models/payment-options';\nimport { PaymentOptionService } from '@/services/payment_option.service';\nimport payment_option_store from '@/stores/payment-option.store';\nimport { Component, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport axios from 'axios';\n\n@Component({\n  tag: 'ir-payment-option',\n  styleUrl: 'ir-payment-option.css',\n  scoped: true,\n})\nexport class IrPaymentOption {\n  @Prop() baseurl: string;\n  @Prop() propertyid: string;\n  @Prop() ticket: string;\n\n  @State() paymentOptions: PaymentOption[] = [];\n  @State() isLoading: boolean = false;\n  @State() selectedOption: PaymentOption | null = null;\n\n  private paymentOptionService = new PaymentOptionService();\n  propertyOptionsById: Map<string | number, PaymentOption>;\n  propertyOptionsByCode: Map<string | number, PaymentOption>;\n\n  componentWillLoad() {\n    axios.defaults.baseURL = this.baseurl;\n    if (this.ticket) {\n      this.init();\n    }\n  }\n  @Watch('ticket')\n  handleTokenChange(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.init();\n    }\n  }\n  init() {\n    this.initServices();\n    this.fetchData();\n  }\n  @Listen('closeModal')\n  handleCloseModal(e: CustomEvent) {\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n    console.log(e.detail);\n    this.closeModal(e.detail);\n  }\n  private closeModal(newOption: PaymentOption | null) {\n    if (newOption) {\n      this.modifyPaymentList(newOption);\n      if (newOption.is_payment_gateway) {\n        this.propertyOptionsById.set(newOption.id, newOption);\n      } else {\n        this.propertyOptionsByCode.set(newOption.code, newOption);\n      }\n    } else {\n      if (!this.propertyOptionsByCode.has(payment_option_store.selectedOption?.code) && !this.propertyOptionsById.has(payment_option_store.selectedOption?.id)) {\n        this.modifyPaymentList({ ...payment_option_store.selectedOption, is_active: false });\n      }\n    }\n    payment_option_store.selectedOption = null;\n    payment_option_store.mode = null;\n  }\n  async fetchData() {\n    try {\n      this.isLoading = true;\n      const [paymentOptions, propertyOptions] = await Promise.all([\n        this.paymentOptionService.GetExposedPaymentMethods(),\n        this.paymentOptionService.GetPropertyPaymentMethods(this.propertyid),\n      ]);\n      this.propertyOptionsById = new Map(propertyOptions.map(o => [o.id, o]));\n      this.propertyOptionsByCode = new Map(propertyOptions.map(o => [o.code, o]));\n      this.paymentOptions = paymentOptions?.map(option => {\n        if (option.is_payment_gateway) {\n          return this.propertyOptionsById.get(option.id) || option;\n        }\n        return this.propertyOptionsByCode.get(option.code) || option;\n      });\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  initServices() {\n    payment_option_store.token = this.ticket;\n    this.paymentOptionService.setToken(this.ticket);\n  }\n  private modifyPaymentList(paymentOption: PaymentOption) {\n    this.paymentOptions = [\n      ...this.paymentOptions.map(p => {\n        if ((paymentOption.is_payment_gateway && p.id === paymentOption.id) || (paymentOption.code === '005' && p.code === '005')) {\n          return paymentOption;\n        }\n        return p;\n      }),\n    ];\n  }\n  async handleCheckChange(e: CustomEvent, po: PaymentOption) {\n    e.stopPropagation();\n    e.stopImmediatePropagation();\n\n    const is_active = e.detail;\n    const newOption = { ...po, is_active, property_id: this.propertyid };\n\n    if (po.code !== '005' && !po.is_payment_gateway) {\n      await this.paymentOptionService.HandlePaymentMethod(newOption);\n      this.modifyPaymentList(newOption);\n      return;\n    }\n\n    if (!this.showEditButton(po)) {\n      this.modifyPaymentList(newOption);\n      return;\n    }\n    console.log('here');\n    if (is_active && po.data?.some(d => d.value === null)) {\n      payment_option_store.mode = 'create';\n      payment_option_store.selectedOption = newOption;\n    } else {\n      await this.paymentOptionService.HandlePaymentMethod(newOption);\n    }\n    this.modifyPaymentList(newOption);\n  }\n  showEditButton(po: PaymentOption) {\n    if (!po.is_payment_gateway && po.code !== '005') {\n      return false;\n    }\n\n    return po.code === '005' || (po.is_payment_gateway && po.data?.length > 0);\n  }\n  render() {\n    if (this.isLoading || this.paymentOptions.length == 0) {\n      return (\n        <div class=\"h-screen bg-white d-flex flex-column align-items-center justify-content-center\">\n          <ir-loading-screen></ir-loading-screen>\n        </div>\n      );\n    }\n    return (\n      <Host class=\"p-2\">\n        <ir-toast></ir-toast>\n        <ir-interceptor></ir-interceptor>\n        <div class=\"card p-1 flex-fill m-0\">\n          <div class=\"d-flex align-items-center mb-2\">\n            <div class=\"p-0 m-0 mr-1\">\n              <ir-icons name=\"credit_card\"></ir-icons>\n            </div>\n            <h3 class={'m-0 p-0'}> Payment Options</h3>\n          </div>\n          <div class=\"payment-table-container\">\n            <table class=\"table table-striped table-bordered no-footer dataTable\">\n              <thead>\n                <tr>\n                  <th scope=\"col\" class=\"text-left\">\n                    Payment method\n                  </th>\n                  <th scope=\"col\">Status</th>\n                  <th scope=\"col\" class=\"actions-header\">\n                    Action\n                  </th>\n                </tr>\n              </thead>\n              <tbody class=\"\">\n                {this.paymentOptions?.map(po => {\n                  if (po.code === '004') {\n                    return null;\n                  }\n                  return (\n                    <tr key={po.id}>\n                      <td class={'text-left po-description'}>\n                        <div class=\"po-view\">\n                          <span class={'p-0 m-0'}>{po.description}</span> <img src=\"https://www.jccsmart.com/assets/images/app-logo.svg\" alt=\"\" class=\"payment-img\" />\n                        </div>\n                      </td>\n\n                      <td>\n                        <ir-switch checked={po.is_active} onCheckChange={e => this.handleCheckChange(e, po)}></ir-switch>\n                      </td>\n                      <td class=\"payment-action\">\n                        {this.showEditButton(po) && (\n                          <ir-button\n                            variant=\"icon\"\n                            icon_name=\"edit\"\n                            onClickHanlder={() => {\n                              payment_option_store.selectedOption = po;\n                              payment_option_store.mode = 'edit';\n                            }}\n                          ></ir-button>\n                        )}\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            </table>\n          </div>\n        </div>\n        <ir-sidebar\n          onIrSidebarToggle={() => {\n            this.closeModal(null);\n          }}\n          label={`${payment_option_store.selectedOption?.description} Information`}\n          open={payment_option_store.selectedOption !== null}\n        >\n          {payment_option_store.selectedOption && <ir-option-details propertyId={this.propertyid} slot=\"sidebar-body\"></ir-option-details>}\n        </ir-sidebar>\n      </Host>\n    );\n  }\n}\n"],"version":3}