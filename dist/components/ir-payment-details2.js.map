{"file":"ir-payment-details2.js","mappings":"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","names":["moment"],"sources":["src/components/ir-booking-details/ir-payment-details/ir-payment-details.css?tag=ir-payment-details&encapsulation=scoped","src/components/ir-booking-details/ir-payment-details/ir-payment-details.tsx"],"sourcesContent":[":host {\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;\n}\n:host * {\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;\n}\n\n.sm-margin-right {\n  margin-right: 5px !important;\n  background: #000;\n}\n.action_icons {\n  width: 60px;\n}\n.w-60 {\n  width: 100px;\n  padding: 0 5px;\n}\n.payments-height {\n  height: 30px;\n}\n.payment_date {\n  width: 100px;\n}\n.iframeHeight {\n  height: max-content;\n  height: 22.5rem;\n}\n.designation {\n  width: 120px;\n}\n.total-cost-container {\n  background: #7cbebe;\n  color: white;\n  padding: 0.5rem;\n  border-radius: 5px;\n}\n","import { Component, h, Prop, State, Event, EventEmitter, Listen } from '@stencil/core';\nimport { Booking, IPayment } from '@/models/booking.dto';\nimport { BookingService } from '@/services/booking.service';\nimport { PaymentService, IPaymentAction } from '@/services/payment.service';\nimport locales from '@/stores/locales.store';\nimport { IToast } from '@/components/ui/ir-toast/toast';\nimport { PaymentSidebarEvent } from '../types';\nimport { IEntries } from '@/models/IBooking';\nimport moment from 'moment';\n@Component({\n  styleUrl: 'ir-payment-details.css',\n  tag: 'ir-payment-details',\n  scoped: true,\n})\nexport class IrPaymentDetails {\n  @Prop({ mutable: true }) bookingDetails: Booking;\n  @Prop() paymentActions: IPaymentAction[];\n  @Prop() paymentTypes: IEntries[];\n\n  @State() confirmModal: boolean = false;\n  @State() toBeDeletedItem: IPayment | null = null;\n  @State() modalMode: 'delete' | 'save' | null = null;\n\n  @Event({ bubbles: true }) resetBookingEvt: EventEmitter<null>;\n  @Event({ bubbles: true }) resetExposedCancellationDueAmount: EventEmitter<null>;\n  @Event({ bubbles: true }) toast: EventEmitter<IToast>;\n  @Event({ bubbles: true }) openSidebar: EventEmitter<PaymentSidebarEvent>;\n\n  private paymentService = new PaymentService();\n  private bookingService = new BookingService();\n\n  @Listen('generatePayment')\n  handlePaymentGeneration(e: CustomEvent) {\n    const value = e.detail;\n    this.openSidebar.emit({\n      type: 'payment-folio',\n      payload: { payment: { ...value, date: value.due_on, id: -1, amount: value.amount }, mode: 'payment-action' },\n    });\n  }\n\n  private handleAddPayment = () => {\n    this.openSidebar.emit({\n      type: 'payment-folio',\n      payload: {\n        payment: {\n          id: -1,\n          date: moment().format('YYYY-MM-DD'),\n          amount: null,\n          currency: undefined,\n          designation: null,\n          reference: null,\n        },\n        mode: 'new',\n      },\n    });\n  };\n\n  private handleEditPayment = (payment: IPayment) => {\n    console.log(payment);\n    this.openSidebar.emit({\n      type: 'payment-folio',\n      payload: { payment, mode: 'edit' },\n    });\n  };\n\n  private handleDeletePayment = (payment: IPayment) => {\n    this.modalMode = 'delete';\n    this.toBeDeletedItem = payment;\n    this.openModal();\n  };\n\n  private async cancelPayment() {\n    try {\n      await this.paymentService.CancelPayment(this.toBeDeletedItem.id);\n      const newPaymentArray = this.bookingDetails.financial.payments.filter((item: IPayment) => item.id !== this.toBeDeletedItem.id);\n\n      this.bookingDetails = {\n        ...this.bookingDetails,\n        financial: { ...this.bookingDetails.financial, payments: newPaymentArray },\n      };\n\n      this.confirmModal = false;\n      this.resetBookingEvt.emit(null);\n      this.resetExposedCancellationDueAmount.emit(null);\n      this.toBeDeletedItem = null;\n      this.modalMode = null;\n    } catch (error) {\n      console.error('Error canceling payment:', error);\n      this.toast.emit({\n        type: 'error',\n        title: 'Error',\n        description: 'Failed to cancel payment. Please try again.',\n        position: 'top-right',\n      });\n    }\n  }\n\n  private handleConfirmModal = async (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n\n    if (this.modalMode === 'delete') {\n      await this.cancelPayment();\n    }\n  };\n\n  private handleCancelModal = (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalMode = null;\n    this.toBeDeletedItem = null;\n  };\n\n  private openModal() {\n    const modal: any = document.querySelector('.delete-record-modal');\n    modal?.openModal();\n  }\n\n  private hasValidFinancialData(): boolean {\n    return Boolean(this.bookingDetails?.financial);\n  }\n\n  private shouldShowPaymentActions(): boolean {\n    return Boolean(this.paymentActions?.filter(pa => pa.amount !== 0).length > 0 && this.bookingDetails.is_direct);\n  }\n\n  render() {\n    if (!this.hasValidFinancialData()) {\n      return null;\n    }\n\n    const { financial, currency } = this.bookingDetails;\n\n    return [\n      <div class=\"card p-1\">\n        <ir-payment-summary totalCost={financial.gross_cost} balance={financial.due_amount} collected={this.bookingDetails.financial.collected} currency={currency} />\n        <ir-booking-guarantee booking={this.bookingDetails} bookingService={this.bookingService} />\n        {this.shouldShowPaymentActions() && <ir-payment-actions paymentAction={this.paymentActions} booking={this.bookingDetails} />}\n      </div>,\n      <ir-payments-folio\n        paymentTypes={this.paymentTypes}\n        payments={financial.payments || []}\n        onAddPayment={this.handleAddPayment}\n        onEditPayment={e => this.handleEditPayment(e.detail)}\n        onDeletePayment={e => this.handleDeletePayment(e.detail)}\n      />,\n      <ir-modal\n        item={this.toBeDeletedItem}\n        class=\"delete-record-modal\"\n        modalTitle={locales.entries.Lcz_Confirmation}\n        modalBody={this.modalMode === 'delete' ? locales.entries.Lcz_IfDeletedPermantlyLost : locales.entries.Lcz_EnteringAmountGreaterThanDue}\n        iconAvailable={true}\n        icon=\"ft-alert-triangle danger h1\"\n        leftBtnText={locales.entries.Lcz_Cancel}\n        rightBtnText={this.modalMode === 'delete' ? locales.entries.Lcz_Delete : locales.entries.Lcz_Confirm}\n        leftBtnColor=\"secondary\"\n        rightBtnColor={this.modalMode === 'delete' ? 'danger' : 'primary'}\n        onConfirmModal={this.handleConfirmModal}\n        onCancelModal={this.handleCancelModal}\n      />,\n    ];\n  }\n}\n"],"version":3}