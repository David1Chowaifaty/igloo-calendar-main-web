{"file":"ir-payment-details2.js","mappings":"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","names":["moment"],"sources":["src/components/ir-booking-details/ir-payment-details/ir-payment-details.css?tag=ir-payment-details&encapsulation=scoped","src/components/ir-booking-details/ir-payment-details/ir-payment-details.tsx"],"sourcesContent":[":host {\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;\n}\n:host * {\n  font-family: 'Open Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;\n}\n\n.sm-margin-right {\n  margin-right: 5px !important;\n  background: #000;\n}\n.action_icons {\n  width: 60px;\n}\n.w-60 {\n  width: 100px;\n  padding: 0 5px;\n}\n.payments-height {\n  height: 30px;\n}\n.payment_date {\n  width: 100px;\n}\n.iframeHeight {\n  height: max-content;\n  height: 22.5rem;\n}\n.designation {\n  width: 120px;\n}\n.total-cost-container {\n  background: #7cbebe;\n  color: white;\n  padding: 0.5rem;\n  border-radius: 5px;\n}\n","import { Component, h, Prop, State, Event, EventEmitter, Listen } from '@stencil/core';\nimport { Booking, IPayment } from '@/models/booking.dto';\nimport { BookingService } from '@/services/booking.service';\nimport { PaymentService, IPaymentAction } from '@/services/payment.service';\nimport locales from '@/stores/locales.store';\nimport { IToast } from '@/components/ui/ir-toast/toast';\nimport { Payment, PaymentEntries, PaymentSidebarEvent, PrintScreenOptions } from '../types';\nimport moment from 'moment';\nimport { formatAmount } from '@/utils/utils';\nimport calendar_data from '@/stores/calendar-data';\n\n@Component({\n  styleUrl: 'ir-payment-details.css',\n  tag: 'ir-payment-details',\n  scoped: true,\n})\nexport class IrPaymentDetails {\n  @Prop({ mutable: true }) booking: Booking;\n  @Prop() paymentActions: IPaymentAction[];\n  @Prop() propertyId: number;\n  @Prop() paymentEntries: PaymentEntries;\n\n  @State() confirmModal: boolean = false;\n  @State() toBeDeletedItem: IPayment | null = null;\n  @State() modalMode: 'delete' | 'save' | null = null;\n\n  @Event({ bubbles: true }) resetBookingEvt: EventEmitter<null>;\n  @Event({ bubbles: true }) resetExposedCancellationDueAmount: EventEmitter<null>;\n  @Event({ bubbles: true }) toast: EventEmitter<IToast>;\n  @Event({ bubbles: true }) openSidebar: EventEmitter<PaymentSidebarEvent>;\n  @Event({ bubbles: true }) openPrintScreen: EventEmitter<PrintScreenOptions>;\n\n  private paymentService = new PaymentService();\n  private bookingService = new BookingService();\n\n  @Listen('generatePayment')\n  handlePaymentGeneration(e: CustomEvent) {\n    const value = e.detail;\n    const paymentType = this.paymentEntries?.types?.find(p => p.CODE_NAME === (this.booking.status.code === '003' ? value.pay_type_code : '001'));\n    this.openSidebar.emit({\n      type: 'payment-folio',\n      payload: {\n        payment: {\n          ...value,\n          date: moment().format('YYYY-MM-DD'),\n          id: -1,\n          amount: value.amount,\n          payment_type: paymentType\n            ? {\n                code: paymentType.CODE_NAME,\n                description: paymentType.CODE_VALUE_EN,\n                operation: paymentType.NOTES,\n              }\n            : null,\n          designation: paymentType?.CODE_VALUE_EN ?? null,\n        },\n        mode: 'payment-action',\n      },\n    });\n  }\n\n  private handleAddPayment = (props?: { type: 'cancellation-penalty' | 'refund'; amount: number }) => {\n    let payment: Payment = {\n      id: -1,\n      date: moment().format('YYYY-MM-DD'),\n      amount: null,\n      currency: calendar_data.currency,\n      designation: null,\n      reference: null,\n    };\n    if (props) {\n      const { amount, type } = props;\n      const cashMethod = this.paymentEntries.methods.find(pt => pt.CODE_NAME === '001');\n      const payment_method = {\n        code: cashMethod.CODE_NAME,\n        description: cashMethod.CODE_VALUE_EN,\n        operation: cashMethod.NOTES,\n      };\n      const paymentType = this.paymentEntries.types.find(pt => pt.CODE_NAME === (type === 'cancellation-penalty' ? '001' : '010'));\n      payment = {\n        ...payment,\n        amount: amount,\n        designation: paymentType.CODE_VALUE_EN,\n        payment_type: {\n          code: paymentType.CODE_NAME,\n          description: paymentType.CODE_VALUE_EN,\n          operation: paymentType.NOTES,\n        },\n        payment_method: type === 'refund' ? undefined : payment_method,\n      };\n      this.openSidebar.emit({\n        type: 'payment-folio',\n        payload: {\n          payment,\n          mode: 'payment-action',\n        },\n      });\n      return;\n    }\n    this.openSidebar.emit({\n      type: 'payment-folio',\n      payload: {\n        payment,\n        mode: 'new',\n      },\n    });\n  };\n\n  private handleEditPayment = (payment: IPayment) => {\n    this.openSidebar.emit({\n      type: 'payment-folio',\n      payload: { payment, mode: 'edit' },\n    });\n  };\n\n  private handleDeletePayment = (payment: IPayment) => {\n    this.modalMode = 'delete';\n    this.toBeDeletedItem = payment;\n    this.openModal();\n  };\n\n  private async handleIssueReceipt(detail: IPayment) {\n    if (detail.receipt_nbr) {\n      this.openPrintScreen.emit({\n        mode: 'receipt',\n        payload: {\n          pid: detail.id.toString(),\n          rnb: detail.receipt_nbr,\n        },\n      });\n      return;\n    }\n    const _number = await this.bookingService.getNextValue({ starter: 'RC' });\n    this.openPrintScreen.emit({\n      mode: 'receipt',\n      payload: {\n        pid: detail.id.toString(),\n        rnb: `RC-${_number.My_Result}`,\n      },\n    });\n  }\n\n  private async cancelPayment() {\n    try {\n      await this.paymentService.CancelPayment(this.toBeDeletedItem.id);\n      const newPaymentArray = this.booking.financial.payments.filter((item: IPayment) => item.id !== this.toBeDeletedItem.id);\n\n      this.booking = {\n        ...this.booking,\n        financial: { ...this.booking.financial, payments: newPaymentArray },\n      };\n\n      this.confirmModal = false;\n      this.resetBookingEvt.emit(null);\n      this.resetExposedCancellationDueAmount.emit(null);\n      this.toBeDeletedItem = null;\n      this.modalMode = null;\n    } catch (error) {\n      console.error('Error canceling payment:', error);\n      this.toast.emit({\n        type: 'error',\n        title: 'Error',\n        description: 'Failed to cancel payment. Please try again.',\n        position: 'top-right',\n      });\n    }\n  }\n\n  private handleConfirmModal = async (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n\n    if (this.modalMode === 'delete') {\n      await this.cancelPayment();\n    }\n  };\n\n  private handleCancelModal = (e: CustomEvent) => {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.modalMode = null;\n    this.toBeDeletedItem = null;\n  };\n\n  private openModal() {\n    const modal: any = document.querySelector('.delete-record-modal');\n    modal?.openModal();\n  }\n\n  private hasValidFinancialData(): boolean {\n    return Boolean(this.booking?.financial);\n  }\n\n  // private shouldShowPaymentActions(): boolean {\n  //   return Boolean(this.paymentActions?.filter(pa => pa.amount !== 0).length > 0 && this.booking.is_direct);\n  // }\n  private shouldShowRefundButton(): boolean {\n    if (!this.booking.is_direct) {\n      return false;\n    }\n    if (this.booking.financial.due_amount === 0) {\n      return false;\n    }\n    if (this.booking.financial.cancelation_penality_as_if_today === 0) {\n      return false;\n    }\n    if (this.booking.is_requested_to_cancel || ['003', '004'].includes(this.booking.status.code)) {\n      return this.booking.financial.cancelation_penality_as_if_today < 0;\n    }\n    return false;\n  }\n\n  private shouldCancellationButton(): boolean {\n    if (!this.booking.is_direct) {\n      return false;\n    }\n    if (this.booking.financial.due_amount === 0) {\n      return false;\n    }\n    if (this.booking.financial.cancelation_penality_as_if_today === 0) {\n      return false;\n    }\n    if (['003', '004'].includes(this.booking.status.code) && this.booking.financial.cancelation_penality_as_if_today > 0) {\n      return true;\n    }\n    return false;\n  }\n\n  render() {\n    if (!this.hasValidFinancialData()) {\n      return null;\n    }\n\n    const { financial, currency } = this.booking;\n\n    return [\n      <wa-card>\n        <ir-payment-summary\n          isBookingCancelled={['003', '004'].includes(this.booking.status.code)}\n          totalCost={financial.gross_cost}\n          balance={financial.due_amount}\n          collected={this.booking.financial.collected + this.booking.financial.refunds}\n          currency={currency}\n        />\n        <ir-booking-guarantee booking={this.booking} bookingService={this.bookingService} />\n        {/* {this.shouldShowPaymentActions() && <ir-payment-actions paymentAction={this.paymentActions} booking={this.booking} />} */}\n        {!['003', '004'].includes(this.booking.status.code) && this.booking.is_direct && (\n          <ir-applicable-policies propertyId={this.propertyId} booking={this.booking}></ir-applicable-policies>\n        )}\n\n        {this.shouldShowRefundButton() && (\n          <div class=\"d-flex mt-1\">\n            <ir-button\n              btn_color=\"outline\"\n              text={`Refund ${formatAmount(currency.symbol, Math.abs(this.booking.financial.cancelation_penality_as_if_today))}`}\n              size=\"sm\"\n              onClickHandler={() => {\n                this.handleAddPayment({ type: 'refund', amount: Math.abs(this.booking.financial.cancelation_penality_as_if_today) });\n              }}\n            ></ir-button>\n          </div>\n        )}\n        {this.shouldCancellationButton() && (\n          <div class=\"d-flex mt-1\">\n            <ir-button\n              btn_color=\"outline\"\n              text={`Charge cancellation penalty ${formatAmount(currency.symbol, this.booking.financial.cancelation_penality_as_if_today)}`}\n              size=\"sm\"\n              onClickHandler={() => {\n                this.handleAddPayment({ type: 'cancellation-penalty', amount: Math.abs(this.booking.financial.cancelation_penality_as_if_today) });\n              }}\n            ></ir-button>\n          </div>\n        )}\n      </wa-card>,\n      <ir-payments-folio\n        payments={financial.payments || []}\n        onAddPayment={() => this.handleAddPayment()}\n        onEditPayment={e => this.handleEditPayment(e.detail)}\n        onDeletePayment={e => this.handleDeletePayment(e.detail)}\n        onIssueReceipt={e => this.handleIssueReceipt(e.detail)}\n      />,\n      <ir-modal\n        item={this.toBeDeletedItem}\n        class=\"delete-record-modal\"\n        modalTitle={locales.entries.Lcz_Confirmation}\n        modalBody={this.modalMode === 'delete' ? locales.entries.Lcz_IfDeletedPermantlyLost : locales.entries.Lcz_EnteringAmountGreaterThanDue}\n        iconAvailable={true}\n        icon=\"ft-alert-triangle danger h1\"\n        leftBtnText={locales.entries.Lcz_Cancel}\n        rightBtnText={this.modalMode === 'delete' ? locales.entries.Lcz_Delete : locales.entries.Lcz_Confirm}\n        leftBtnColor=\"secondary\"\n        rightBtnColor={this.modalMode === 'delete' ? 'danger' : 'primary'}\n        onConfirmModal={this.handleConfirmModal}\n        onCancelModal={this.handleCancelModal}\n      />,\n    ];\n  }\n}\n"],"version":3}