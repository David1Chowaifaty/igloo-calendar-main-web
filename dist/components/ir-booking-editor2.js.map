{"file":"ir-booking-editor2.js","mappings":"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","names":["moment"],"sources":["src/components/igloo-calendar/ir-booking-editor/ir-booking-editor.css?tag=ir-booking-editor&encapsulation=scoped","src/components/igloo-calendar/ir-booking-editor/ir-booking-editor.tsx"],"sourcesContent":[":host {\n  display: block;\n  height: 100%;\n}\n.booking-editor__roomtype-container {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-top: 2rem;\n  padding-bottom: 3rem;\n}\n","import { Booking } from '@/models/booking.dto';\nimport { Component, Event, EventEmitter, Fragment, Host, Listen, Prop, State, Watch, h } from '@stencil/core';\nimport { BlockedDatePayload, BookedByGuestSchema, BookingEditorMode, BookingStep, RoomsGuestsSchema } from './types';\nimport { RoomService } from '@/services/room.service';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport locales from '@/stores/locales.store';\nimport booking_store, {\n  BookingDraft,\n  getReservedRooms,\n  modifyBookingStore,\n  reserveRooms,\n  resetBookingStore,\n  setBookingDraft,\n  setBookingSelectOptions,\n  updateBookedByGuest,\n} from '@/stores/booking.store';\nimport { BookingSource } from '@/models/igl-book-property';\nimport calendar_data from '@/stores/calendar-data';\nimport { ISetupEntries } from '@/models/IBooking';\nimport moment from 'moment';\nimport { IRBookingEditorService } from './ir-booking-editor.service';\n\n@Component({\n  tag: 'ir-booking-editor',\n  styleUrl: 'ir-booking-editor.css',\n  scoped: true,\n})\nexport class IrBookingEditor {\n  @Prop() propertyId: string | number;\n  @Prop() language: string = 'en';\n  @Prop() roomTypeIds: (string | number)[] = [];\n  @Prop() identifier: string;\n  @Prop({ mutable: true }) booking: Booking;\n  @Prop() mode: BookingEditorMode = 'PLUS_BOOKING';\n  @Prop() checkIn: string;\n  @Prop() checkOut: string;\n  @Prop() step: BookingStep;\n  @Prop() blockedUnit: BlockedDatePayload;\n  @Prop() unitId: string;\n\n  @State() isLoading: boolean = true;\n\n  @Event({ composed: true, bubbles: true }) resetBookingEvt: EventEmitter<void>;\n  @Event() loadingChanged: EventEmitter<{ cause: string | null }>;\n  @Event() adjustBlockedUnit: EventEmitter<any>;\n\n  private roomService = new RoomService();\n  private bookingService = new BookingService();\n  private bookingEditorService = new IRBookingEditorService(this.mode);\n\n  private room: Booking['rooms'][0];\n\n  private get adjustedCheckout() {\n    if (this.bookingEditorService.isEventType('PLUS_BOOKING') && !this.blockedUnit) {\n      return undefined;\n    }\n    return this.checkOut;\n  }\n\n  componentWillLoad() {\n    this.initializeApp();\n  }\n\n  @Watch('mode')\n  handleModeChange(newMode: BookingEditorMode, oldMode: BookingEditorMode) {\n    if (newMode !== oldMode) {\n      this.bookingEditorService.setMode(newMode);\n    }\n  }\n\n  @Listen('guestSelected')\n  handleGuestSelected(e: CustomEvent) {\n    this.booking = { ...e.detail };\n    updateBookedByGuest({\n      firstName: this.booking.guest.first_name,\n      lastName: this.booking.guest.last_name,\n    });\n    const source = booking_store.selects.sources.find(s => s.code === this.booking.source.code);\n    setBookingDraft({\n      source,\n    });\n  }\n\n  private async initializeApp() {\n    try {\n      this.isLoading = true;\n      this.bookingEditorService.setMode(this.mode);\n      const [languageTexts, countriesList] = await Promise.all([\n        this.roomService.fetchLanguage(this.language),\n        this.bookingService.getCountries(this.language),\n        this.roomService.getExposedProperty({\n          id: Number(this.propertyId),\n          language: this.language,\n          is_backend: true,\n          include_units_hk_status: true,\n          include_sales_rate_plans: true,\n        }),\n      ]);\n      if (!locales.entries) {\n        locales.entries = languageTexts.entries;\n        locales.direction = languageTexts.direction;\n      }\n      await this.fetchSetupEntriesAndInitialize();\n      setBookingSelectOptions({\n        countries: countriesList,\n      });\n      this.initializeDraftFromBooking();\n      if (this.bookingEditorService.isEventType('EDIT_BOOKING')) {\n        await this.checkBookingAvailability();\n      }\n    } catch (error) {\n      console.error('Error initializing app:', error);\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  disconnectedCallback() {\n    resetBookingStore(true);\n  }\n\n  @Listen('checkAvailability')\n  handleCheckAvailability(e: CustomEvent) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    this.checkBookingAvailability();\n  }\n  /**\n   * Initializes booking draft and guest data\n   * based on the current editor mode.\n   *\n   * Throws if required booking data is missing.\n   */\n  private initializeDraftFromBooking() {\n    if (this.bookingEditorService.isEventType(['EDIT_BOOKING', 'ADD_ROOM'])) {\n      if (!this.booking || (!this.identifier && this.bookingEditorService.isEventType('EDIT_BOOKING'))) {\n        throw new Error('Missing booking or identifier');\n      }\n    }\n\n    if (this.bookingEditorService.isEventType('EDIT_BOOKING')) {\n      const room = this.booking.rooms.find(room => room.identifier === this.identifier);\n      modifyBookingStore('guest', {\n        bed_preference: room.bed_preference?.toString(),\n        infant_nbr: room.occupancy.infant_nbr,\n        first_name: room.guest.first_name ?? '',\n        last_name: room.guest.last_name ?? '',\n        unit: (room.unit as any)?.id?.toString(),\n      });\n      this.room = room;\n    }\n\n    let draft: Partial<BookingDraft> = {\n      dates: {\n        checkIn: this.checkIn ? moment(this.checkIn, 'YYYY-MM-DD') : moment(),\n        checkOut: this.checkOut ? moment(this.checkOut, 'YYYY-MM-DD') : moment().add(1, 'day'),\n      },\n    };\n\n    if (this.bookingEditorService.isEventType(['EDIT_BOOKING', 'ADD_ROOM'])) {\n      const source = booking_store.selects.sources.find(s => s.code === this.booking.source.code);\n\n      draft = {\n        ...draft,\n        source,\n      };\n\n      if (this.bookingEditorService.isEventType('EDIT_BOOKING')) {\n        draft = {\n          ...draft,\n          occupancy: {\n            adults: this.booking.occupancy.adult_nbr,\n            children: this.booking.occupancy.children_nbr,\n          },\n        };\n      }\n\n      updateBookedByGuest({\n        firstName: this.booking.guest.first_name,\n        lastName: this.booking.guest.last_name,\n      });\n    }\n\n    setBookingDraft(draft);\n  }\n  private updateBooking() {\n    try {\n      const currentRoomType = this.room;\n      const roomtypeId = currentRoomType.roomtype.id;\n      const rateplanId = currentRoomType.rateplan.id;\n      const guest = {\n        bed_preference: currentRoomType.bed_preference?.toString(),\n        infant_nbr: currentRoomType.occupancy.infant_nbr,\n        last_name: currentRoomType.guest.last_name,\n        first_name: currentRoomType.guest.first_name,\n        unit: (currentRoomType.unit as any)?.id?.toString(),\n        roomtype_id: currentRoomType.roomtype.id,\n      };\n      modifyBookingStore('guest', guest);\n      reserveRooms({\n        roomTypeId: roomtypeId,\n        ratePlanId: rateplanId,\n        rooms: 1,\n        guest: [guest],\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n  private async checkBookingAvailability() {\n    // resetBookingStore(false);\n    const { source, occupancy, dates } = booking_store.bookingDraft;\n    const from_date = dates.checkIn.format('YYYY-MM-DD');\n    const to_date = dates.checkOut.format('YYYY-MM-DD');\n    const is_in_agent_mode = source?.type === 'TRAVEL_AGENCY';\n    try {\n      const room_type_ids_to_update = this.bookingEditorService.isEventType('EDIT_BOOKING') ? [this.room.roomtype?.id] : [];\n      const room_type_ids = this.bookingEditorService.isEventType(['BAR_BOOKING', 'SPLIT_BOOKING']) ? this.roomTypeIds.map(r => Number(r)) : [];\n\n      await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: calendar_data.property.id,\n        adultChildCount: {\n          adult: occupancy.adults,\n          child: occupancy.children,\n        },\n        language: this.language,\n        room_type_ids,\n        currency: calendar_data.property.currency,\n        agent_id: is_in_agent_mode ? source?.tag : null,\n        is_in_agent_mode,\n        room_type_ids_to_update,\n      });\n      if (this.mode !== 'EDIT_BOOKING') {\n        await this.assignCountryCode();\n      }\n      if (this.bookingEditorService.isEventType('EDIT_BOOKING')) {\n        this.updateBooking();\n      }\n    } catch (error) {\n      console.error('Error initializing booking availability:', error);\n    }\n  }\n\n  private async doReservation(source: string) {\n    try {\n      this.loadingChanged.emit({ cause: source as any });\n      const reservedRooms = getReservedRooms();\n      RoomsGuestsSchema.parse(reservedRooms.map(r => ({ ...r.guest, requires_bed_preference: r.ratePlanSelection.roomtype.is_bed_configuration_enabled })));\n      BookedByGuestSchema.parse(booking_store.bookedByGuest);\n      const body = await this.bookingEditorService.prepareBookUserServiceParams({\n        check_in: source === 'book-checkin',\n        booking: this.booking,\n        room: this.room,\n        unitId: this.unitId?.toString(),\n      });\n      console.log({ DoReservationPayload: body });\n      await this.bookingService.doReservation(body);\n      this.adjustBlockedUnit.emit(body);\n\n      this.resetBookingEvt.emit(null);\n    } catch (error) {\n      console.log(error);\n    } finally {\n      this.loadingChanged.emit({ cause: null });\n    }\n    // alert('do reservation');\n  }\n\n  private async assignCountryCode() {\n    const country = await this.bookingService.getUserDefaultCountry();\n    const countryId = country['COUNTRY_ID'];\n    const _c = booking_store.selects.countries.find(c => c.id?.toString() === countryId?.toString());\n    updateBookedByGuest({\n      countryId: countryId,\n      phone_prefix: _c?.phone_prefix,\n    });\n  }\n\n  private async fetchSetupEntriesAndInitialize() {\n    try {\n      const setupEntries = await this.fetchSetupEntries();\n      this.setSourceOptions(calendar_data.property.allowed_booking_sources);\n      this.setOtherProperties(setupEntries);\n    } catch (error) {\n      console.error('Error fetching setup entries:', error);\n    }\n  }\n\n  private setOtherProperties(setupEntries: ISetupEntries) {\n    setBookingSelectOptions({\n      arrivalTime: setupEntries.arrivalTime,\n      bedPreferences: setupEntries.bedPreferenceType,\n      ratePricingMode: setupEntries.ratePricingMode,\n    });\n  }\n\n  private setSourceOptions(bookingSource: BookingSource[]) {\n    const _sourceOptions = this.bookingEditorService.isEventType('BAR_BOOKING') ? this.getFilteredSourceOptions(bookingSource) : bookingSource;\n    setBookingSelectOptions({\n      sources: _sourceOptions,\n    });\n    let sourceOption: BookingSource;\n    if (this.bookingEditorService.isEventType('EDIT_BOOKING') && this.booking) {\n      const option = bookingSource.find(option => this.booking.source?.code === option.code);\n      sourceOption = option;\n    } else {\n      sourceOption = _sourceOptions.find(o => o.type !== 'LABEL');\n    }\n    setBookingDraft({\n      source: sourceOption,\n    });\n  }\n\n  private getFilteredSourceOptions(sourceOptions: BookingSource[]): BookingSource[] {\n    const agentIds = new Set<string>();\n    if (!Boolean(this.unitId)) {\n      return sourceOptions;\n    }\n    const room = calendar_data.roomsInfo.find(room => room.physicalrooms.find(r => r.id.toString() === this.unitId?.toString()));\n    const hasAgentOnlyRoomType =\n      (() => {\n        const rps = room?.rateplans ?? [];\n        if (rps.length === 0) return false;\n        const isForAgentOnly = rps.every((rp: any) => (rp?.agents?.length ?? 0) > 0);\n        if (isForAgentOnly) {\n          rps.forEach((rp: any) => {\n            (rp?.agents ?? []).forEach((ag: any) => agentIds.add(ag?.id?.toString()));\n          });\n        }\n        return isForAgentOnly;\n      })() ?? false;\n\n    if (!hasAgentOnlyRoomType) {\n      return sourceOptions;\n    }\n    return sourceOptions.filter((opt: any) => {\n      if (opt?.type === 'LABEL') return true;\n      const candidate = opt?.tag;\n      const matchesId = candidate != null && agentIds.has(candidate);\n      return matchesId;\n    });\n  }\n\n  private async fetchSetupEntries() {\n    return await this.bookingService.fetchSetupEntries();\n  }\n\n  render() {\n    if (this.isLoading) {\n      return (\n        <div class={'drawer__loader-container'}>\n          <ir-spinner></ir-spinner>\n        </div>\n      );\n    }\n    return (\n      <Host>\n        <div>\n          <ir-interceptor></ir-interceptor>\n          {this.step === 'details' && (\n            <Fragment>\n              <ir-booking-editor-header booking={this.booking} checkIn={this.checkIn} checkOut={this.adjustedCheckout} mode={this.mode}></ir-booking-editor-header>\n              <div class={'booking-editor__roomtype-container'}>\n                {booking_store.roomTypes?.map(roomType => (\n                  <igl-room-type\n                    key={`room-type-${roomType.id}`}\n                    id={roomType.id.toString()}\n                    roomType={roomType}\n                    bookingType={this.mode}\n                    ratePricingMode={booking_store.selects?.ratePricingMode}\n                    roomTypeId={this.room?.roomtype?.id}\n                    currency={calendar_data.property.currency}\n                  ></igl-room-type>\n                ))}\n              </div>\n            </Fragment>\n          )}\n\n          {this.step === 'confirm' && (\n            <ir-booking-editor-form\n              onDoReservation={e => {\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n                this.doReservation(e.detail);\n              }}\n              room={this.room}\n              mode={this.mode}\n            ></ir-booking-editor-form>\n          )}\n        </div>\n      </Host>\n    );\n  }\n}\n"],"version":3}