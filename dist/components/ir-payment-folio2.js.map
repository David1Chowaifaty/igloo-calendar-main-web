{"file":"ir-payment-folio2.js","mappings":"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","names":["moment"],"sources":["src/components/ir-booking-details/ir-payment-details/ir-payment-folio/ir-payment-folio.css?tag=ir-payment-folio&encapsulation=scoped","src/common/sheet.css?tag=ir-payment-folio&encapsulation=scoped","src/components/ir-booking-details/ir-payment-details/ir-payment-folio/ir-payment-folio.tsx"],"sourcesContent":[":host {\n  display: block;\n  --payment-type-badge-bg: #ff4961;\n}\n.payment-type-badge {\n  background: var(--payment-type-badge-bg);\n  color: white;\n  padding: 0.2rem 0.3rem !important;\n  font-size: 12px;\n  border-radius: 4px;\n  margin: 0;\n  text-transform: capitalize;\n}\n.credit-badge {\n  --payment-type-badge-bg: #629a4c;\n}\n.debit-badge {\n  --payment-type-badge-bg: #ff4961;\n}\n.dropdown-item-payment {\n  display: flex;\n  align-items: center;\n  gap: 1rem;\n  box-sizing: border-box;\n  justify-content: space-between;\n}\n\n.input-group-text {\n  border-color: #cacfe7 !important;\n}\n",":host {\n  height: 100%;\n}\n.sheet-container {\n  display: flex !important;\n  flex-direction: column !important;\n  background: white;\n  height: 100vh;\n  gap: 1rem;\n  z-index: 1000;\n}\n.sheet-container {\n  height: -webkit-fill-available;\n  height: 100vh;\n  height: 100dvh;\n}\n\n/* @supports (height: 100svh) {\n  .sheet-container {\n    height: 100svh;\n  }\n} */\n.sheet-footer {\n  position: sticky;\n  bottom: 0;\n  z-index: 20;\n  background: white;\n  border-top: 1px solid #e4e5ec;\n  display: flex;\n  flex-direction: column;\n  padding: 1rem;\n  gap: 0.5rem;\n}\n.sheet-header {\n  position: sticky;\n  top: 0;\n  z-index: 10;\n  background: white;\n}\n.sheet-body {\n  flex: 1 1 0%;\n}\n/* @media (max-width: 767px) {\n  .sheet-footer {\n    bottom: env(safe-area-inset-bottom);\n  }\n} */\n@media (min-width: 768px) {\n  .sheet-footer {\n    flex-direction: row;\n    align-items: center;\n  }\n}\n","import calendar_data from '@/stores/calendar-data';\nimport { Component, Event, EventEmitter, Fragment, Prop, State, Watch, h } from '@stencil/core';\nimport moment from 'moment';\nimport { z, ZodError } from 'zod';\nimport { IPayment } from '@/models/booking.dto';\nimport { IEntries } from '@/models/IBooking';\nimport { PaymentService } from '@/services/payment.service';\nimport { FolioEntryMode } from '../../types';\nimport { buildPaymentTypes } from '@/services/booking.service';\n\n@Component({\n  tag: 'ir-payment-folio',\n  styleUrls: ['ir-payment-folio.css', '../../../../common/sheet.css'],\n  scoped: true,\n})\nexport class IrPaymentFolio {\n  @Prop() paymentTypes: IEntries[];\n  @Prop() paymentTypesGroups: IEntries[];\n\n  @Prop() bookingNumber: string;\n\n  @Prop() payment: IPayment = {\n    date: moment().format('YYYY-MM-DD'),\n    amount: 0,\n    designation: undefined,\n    currency: null,\n    reference: null,\n    id: -1,\n  };\n\n  @Prop() mode: FolioEntryMode;\n\n  @State() isLoading: boolean;\n  @State() errors: any;\n  @State() autoValidate: boolean = false;\n  @State() folioData: IPayment;\n  @State() _paymentTypes: Record<string, IEntries[]> = {};\n\n  @Event() closeModal: EventEmitter<null>;\n  @Event() resetBookingEvt: EventEmitter<null>;\n  @Event() resetExposedCancellationDueAmount: EventEmitter<null>;\n\n  private folioSchema: any;\n  private paymentService = new PaymentService();\n\n  componentWillLoad() {\n    this.folioSchema = z.object({\n      date: z\n        .string()\n        .regex(/^\\d{4}-\\d{2}-\\d{2}$/)\n        .refine(\n          dateStr => {\n            const date = moment(dateStr, 'YYYY-MM-DD', true);\n            return date.isValid() && !date.isAfter(moment(), 'dates');\n          },\n          { message: `Invalid date` },\n        ),\n      amount: z.coerce.number().refine(a => a !== 0),\n      reference: z.string().optional().nullable(),\n      designation: z.string().min(1),\n      payment_type: z.object({\n        code: z.string().min(3).max(4),\n        description: z.string().min(1),\n        operation: z.union([z.literal('CR'), z.literal('DB')]),\n      }),\n    });\n    if (this.payment) {\n      this.folioData = { ...this.payment };\n    }\n    this.getPaymentTypes();\n  }\n\n  @Watch('payment')\n  handlePaymentChange(newValue: IPayment, oldValue: IPayment) {\n    if (newValue !== oldValue && newValue) {\n      this.folioData = { ...newValue };\n      this.getPaymentTypes();\n    }\n  }\n  @Watch('paymentTypes')\n  handlePaymentTypesChange(newValue: IEntries[], oldValue: IEntries[]) {\n    if (newValue !== oldValue && newValue) {\n      this.getPaymentTypes();\n    }\n  }\n\n  private updateFolioData(params: Partial<IPayment>): void {\n    this.folioData = { ...this.folioData, ...params };\n  }\n\n  private async savePayment() {\n    try {\n      this.isLoading = true;\n      this.autoValidate = true;\n      if (this.errors) {\n        this.errors = null;\n      }\n      this.folioSchema.parse(this.folioData ?? {});\n      await this.paymentService.AddPayment(\n        {\n          ...this.folioData,\n          currency: calendar_data.currency,\n          reference: this.folioData.reference ?? '',\n          designation: this.folioData.payment_type?.description,\n        },\n        this.bookingNumber,\n      );\n      this.resetBookingEvt.emit(null);\n      this.resetExposedCancellationDueAmount.emit(null);\n      this.closeModal.emit(null);\n    } catch (error) {\n      const err = {};\n      if (error instanceof ZodError) {\n        error.issues.forEach(e => {\n          err[e.path[0]] = true;\n        });\n      }\n      console.error(error);\n      this.errors = err;\n    } finally {\n      this.isLoading = false;\n    }\n  }\n\n  private handleDropdownChange(e: CustomEvent<string | number>) {\n    e.stopImmediatePropagation();\n    e.stopPropagation();\n    const value = e.detail.toString();\n    console.log(value);\n    this.updateFolioData({ designation: value });\n    if (!e.detail) {\n      this.updateFolioData({\n        payment_type: null,\n      });\n    } else {\n      const payment_type = this.paymentTypes.find(pt => pt.CODE_NAME === value);\n      if (!payment_type) {\n        console.warn(`Invalid payment type ${e.detail}`);\n        this.updateFolioData({\n          payment_type: null,\n        });\n        return;\n      }\n      this.updateFolioData({\n        payment_type: {\n          code: payment_type.CODE_NAME,\n          description: payment_type.CODE_VALUE_EN,\n          operation: payment_type.NOTES,\n        },\n      });\n    }\n  }\n  private async getPaymentTypes() {\n    const rec = buildPaymentTypes(this.paymentTypes, this.paymentTypesGroups);\n    if (this.mode === 'payment-action' && this.payment.payment_type?.code === '001') {\n      const { PAYMENTS } = rec;\n      return (this._paymentTypes = {\n        PAYMENTS,\n      });\n    }\n    this._paymentTypes = rec;\n  }\n\n  private renderDropdownItems() {\n    return Object.values(this._paymentTypes).map((p, idx) => (\n      <Fragment>\n        {p.map(pt => (\n          <ir-dropdown-item value={pt.CODE_NAME} class=\"dropdown-item-payment\">\n            <span>{pt.CODE_VALUE_EN}</span>\n            <span class={`payment-type-badge ${pt.NOTES === 'CR' ? 'credit-badge' : 'debit-badge'}`}>{pt.NOTES === 'CR' ? 'credit' : 'debit'}</span>\n          </ir-dropdown-item>\n        ))}\n        {idx !== Object.values(this._paymentTypes).length - 1 && <div class=\"dropdown-divider\"></div>}\n      </Fragment>\n    ));\n  }\n  render() {\n    return (\n      <form\n        class={'sheet-container'}\n        onSubmit={async e => {\n          e.preventDefault();\n          this.savePayment();\n        }}\n      >\n        <ir-title\n          class=\"px-1 sheet-header\"\n          onCloseSideBar={() => this.closeModal.emit(null)}\n          label={this.mode === 'edit' ? 'Edit Folio Entry' : 'New Folio Entry'}\n          displayContext=\"sidebar\"\n        ></ir-title>\n        <section class={'px-1 sheet-body d-flex flex-column'} style={{ gap: '1rem' }}>\n          <div class={'d-flex w-fill'} style={{ gap: '0.5rem' }}>\n            {/*Date Picker */}\n            <div class=\"form-group  mb-0 flex-grow-1\">\n              <div class=\"input-group row m-0 flex-grow-1\">\n                <div class={`input-group-prepend col-4 col-md-3 p-0 text-dark border-0`}>\n                  <label class={`input-group-text flex-grow-1 text-dark border-theme `}>Date</label>\n                </div>\n                <div class=\"form-control  form-control-md col-10 flex-grow-1 d-flex align-items-center px-0 mx-0\" style={{ border: '0' }}>\n                  <style>\n                    {`.ir-date-picker-trigger{\n                    width:100%;}`}\n                  </style>\n                  <ir-date-picker\n                    data-testid=\"pickup_date\"\n                    date={this.folioData?.date}\n                    class=\"w-100\"\n                    emitEmptyDate={true}\n                    maxDate={moment().format('YYYY-MM-DD')}\n                    aria-invalid={this.errors?.date && !this.folioData?.date ? 'true' : 'false'}\n                    onDateChanged={evt => {\n                      this.updateFolioData({ date: evt.detail.start?.format('YYYY-MM-DD') });\n                    }}\n                  >\n                    <input\n                      type=\"text\"\n                      slot=\"trigger\"\n                      value={this.folioData?.date ? moment(this.folioData?.date).format('MMM DD, YYYY') : null}\n                      class={`form-control w-100 input-sm ${this.errors?.date && !this.folioData?.date ? 'border-danger' : ''} text-left`}\n                      style={{ borderTopLeftRadius: '0', borderBottomLeftRadius: '0', width: '100%' }}\n                    ></input>\n                  </ir-date-picker>\n                </div>\n              </div>\n            </div>\n          </div>\n          <div>\n            <ir-price-input\n              containerClassname=\"row\"\n              labelContainerClassname=\"col-4 col-md-3 p-0 text-dark border-0\"\n              minValue={0}\n              autoValidate={this.autoValidate}\n              zod={this.folioSchema.pick({ amount: true })}\n              wrapKey=\"amount\"\n              label=\"Amount\"\n              labelStyle={'flex-grow-1 text-dark  border-theme'}\n              error={this.errors?.amount && !this.folioData?.amount}\n              value={this.folioData?.amount?.toString()}\n              currency={calendar_data.currency.symbol}\n              onTextChange={e => this.updateFolioData({ amount: Number(e.detail) })}\n            ></ir-price-input>\n          </div>\n          <div>\n            <ir-dropdown\n              value={this.folioData?.payment_type?.code}\n              disabled={this.payment.payment_type?.code !== '001' && this.mode === 'payment-action'}\n              onOptionChange={this.handleDropdownChange.bind(this)}\n            >\n              <div slot=\"trigger\" class={'input-group row m-0 '}>\n                <div class={`input-group-prepend col-4 col-md-3 p-0 text-dark border-0`}>\n                  <label class={`input-group-text flex-grow-1 text-dark  border-theme`}>Transaction type</label>\n                </div>\n                <button\n                  type=\"button\"\n                  disabled={this.payment.payment_type?.code !== '001' && this.mode === 'payment-action'}\n                  class={`form-control  d-flex align-items-center cursor-pointer ${this.errors?.designation && !this.folioData?.designation ? 'border-danger' : ''}`}\n                >\n                  {this.folioData?.payment_type ? <span>{this.folioData.payment_type?.description}</span> : <span>Select...</span>}\n                </button>\n              </div>\n              <ir-dropdown-item value=\"\">Select...</ir-dropdown-item>\n              {this.renderDropdownItems()}\n            </ir-dropdown>\n          </div>\n          <div>\n            <ir-input-text\n              value={this.folioData?.reference}\n              error={this.errors?.reference_number}\n              autoValidate={this.autoValidate}\n              zod={this.folioSchema.pick({ reference: true })}\n              label=\"Reference\"\n              maxLength={50}\n              inputContainerStyle={{\n                margin: '0',\n              }}\n              onTextChange={e => this.updateFolioData({ reference: e.detail })}\n              labelWidth={3}\n              labelContainerClassname={'col-4 col-md-3'}\n            ></ir-input-text>\n          </div>\n        </section>\n        <div class={'sheet-footer'}>\n          <ir-button onClick={() => this.closeModal.emit(null)} btn_styles=\"justify-content-center\" class={`flex-fill`} text={'Cancel'} btn_color=\"secondary\"></ir-button>\n          <ir-button\n            btn_styles=\"justify-content-center align-items-center\"\n            class={'flex-fill'}\n            isLoading={this.isLoading}\n            text={'Save'}\n            btn_color=\"primary\"\n            btn_type=\"submit\"\n          ></ir-button>\n        </div>\n      </form>\n    );\n  }\n}\n"],"version":3}