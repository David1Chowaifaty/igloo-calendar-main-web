{"file":"ir-hk-unassigned-units2.js","mappings":"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","names":[],"sources":["src/components/ir-housekeeping/ir-hk-unassigned-units/ir-hk-unassigned-units.css?tag=ir-hk-unassigned-units&encapsulation=scoped","src/common/sheet.css?tag=ir-hk-unassigned-units&encapsulation=scoped","src/components/ir-housekeeping/ir-hk-unassigned-units/ir-hk-unassigned-units.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n  --ir-root-active-color: #1e9ff2;\r\n  --ir-root-inactive-color: #d2d2d2;\r\n}\r\ntable {\r\n  width: 100%;\r\n}\r\ntd {\r\n  padding-top: 3px;\r\n  padding-bottom: 3px;\r\n}\r\ntd:last-child {\r\n  text-align: end;\r\n}\r\n.title {\r\n  min-width: 230px !important;\r\n}\r\n",":host {\r\n  height: 100%;\r\n}\r\n.sheet-container {\r\n  display: flex !important;\r\n  flex-direction: column !important;\r\n  background: white;\r\n  height: 100% !important;\r\n  gap: 1rem;\r\n}\r\n.sheet-footer {\r\n  position: sticky;\r\n  bottom: 0;\r\n  z-index: 20;\r\n  background: white;\r\n  border-top: 1px solid #e4e5ec;\r\n  display: flex;\r\n  flex-direction: column;\r\n  padding: 1rem;\r\n  gap: 0.5rem;\r\n}\r\n.sheet-header {\r\n  position: sticky;\r\n  top: 0;\r\n  z-index: 10;\r\n  background: white;\r\n}\r\n.sheet-body {\r\n  flex: 1 1 0%;\r\n}\r\n@media (min-width: 768px) {\r\n  .sheet-footer {\r\n    flex-direction: row;\r\n    align-items: center;\r\n  }\r\n}\r\n","import { IHouseKeepers, IPropertyHousekeepingAssignment } from '@/models/housekeeping';\r\nimport { HouseKeepingService } from '@/services/housekeeping.service';\r\nimport calendar_data from '@/stores/calendar-data';\r\nimport housekeeping_store from '@/stores/housekeeping.store';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport locales from '@/stores/locales.store';\r\nimport { Component, Event, EventEmitter, Prop, State, h } from '@stencil/core';\r\n\r\n@Component({\r\n  tag: 'ir-hk-unassigned-units',\r\n  styleUrls: ['ir-hk-unassigned-units.css', '../../../common/sheet.css'],\r\n  scoped: true,\r\n})\r\nexport class IrHkUnassignedUnits {\r\n  @Prop() user: IHouseKeepers | null = null;\r\n\r\n  @State() renderAgain = false;\r\n\r\n  @Event() closeSideBar: EventEmitter<null>;\r\n  @Event() resetData: EventEmitter<null>;\r\n\r\n  private assignedUnits: Map<number, IPropertyHousekeepingAssignment> = new Map();\r\n  private housekeepingService = new HouseKeepingService();\r\n\r\n  assignUnit(unit_id: number, hk_id: number | null, checked: boolean) {\r\n    if (this.user) {\r\n      const userUnit = this.user.assigned_units.find(unit => unit.id === unit_id);\r\n      if ((checked && userUnit) || (!checked && !userUnit)) {\r\n        this.assignedUnits.delete(unit_id);\r\n      } else if (!checked && userUnit) {\r\n        this.assignedUnits.set(unit_id, { hkm_id: hk_id, is_to_assign: false, unit_id });\r\n      } else if (checked) {\r\n        const assignment: IPropertyHousekeepingAssignment = {\r\n          hkm_id: hk_id,\r\n          is_to_assign: true,\r\n          unit_id,\r\n        };\r\n        this.assignedUnits.set(unit_id, assignment);\r\n      }\r\n    } else {\r\n      if (this.assignedUnits.has(unit_id) && !hk_id) {\r\n        this.assignedUnits.delete(unit_id);\r\n        return;\r\n      } else {\r\n        this.assignedUnits.set(unit_id, {\r\n          hkm_id: hk_id,\r\n          is_to_assign: true,\r\n          unit_id,\r\n        });\r\n      }\r\n    }\r\n    this.renderAgain = !this.renderAgain;\r\n  }\r\n\r\n  async assignUnits() {\r\n    try {\r\n      await this.housekeepingService.manageExposedAssignedUnitToHKM(housekeeping_store.default_properties.property_id, [...this.assignedUnits.values()]);\r\n      this.resetData.emit(null);\r\n    } catch (error) {\r\n      console.error(error);\r\n    } finally {\r\n      this.closeSideBar.emit(null);\r\n    }\r\n  }\r\n  renderRooms() {\r\n    if (!this.user) {\r\n      return housekeeping_store.hk_criteria.units_assignments.unassigned_units?.map(unit => (\r\n        <tr key={unit.id}>\r\n          <td class=\"\">{unit.name}</td>\r\n          <td class=\"sr-only\"></td>\r\n          <td class=\"pl-1\">\r\n            <ir-select\r\n              onSelectChange={e => {\r\n                let hk_id = e.detail;\r\n                if (hk_id === '') {\r\n                  hk_id = null;\r\n                } else {\r\n                  hk_id = +hk_id;\r\n                }\r\n                this.assignUnit(unit.id, hk_id, false);\r\n              }}\r\n              LabelAvailable={false}\r\n              data={housekeeping_store.hk_criteria.housekeepers.map(hk => ({ text: hk.name, value: hk.id.toString() }))}\r\n            ></ir-select>\r\n          </td>\r\n        </tr>\r\n      ));\r\n    }\r\n    return calendar_data.roomsInfo.map(roomType => {\r\n      console.log(roomType);\r\n      if (!roomType.is_active) {\r\n        return null;\r\n      }\r\n      return roomType.physicalrooms?.map(physical_room => {\r\n        if (!physical_room['is_active']) {\r\n          return null;\r\n        }\r\n        let taken = !housekeeping_store.hk_criteria.units_assignments.unassigned_units?.find(unit => unit.id.toString() === physical_room.id.toString());\r\n        let housekeeper = [];\r\n        const assignedRoom = this.assignedUnits.get(physical_room.id);\r\n        if (assignedRoom && assignedRoom.is_to_assign) {\r\n          housekeeper = [this.user];\r\n          taken = true;\r\n        } else {\r\n          if (taken) {\r\n            housekeeper = housekeeping_store.hk_criteria.housekeepers.filter(hk => hk.assigned_units.find(unit => unit.id === physical_room.id));\r\n          }\r\n        }\r\n        return (\r\n          <tr key={physical_room.id}>\r\n            <td>{physical_room.name}</td>\r\n            <td>{taken ? housekeeper[0]?.name : ''}</td>\r\n            <td>\r\n              <ir-switch\r\n                onCheckChange={e => {\r\n                  const checked = e.detail;\r\n                  this.assignUnit(physical_room.id, this.user.id, checked);\r\n                }}\r\n                checked={taken && housekeeper[0]?.id === this.user.id}\r\n              ></ir-switch>\r\n            </td>\r\n          </tr>\r\n        );\r\n      });\r\n    });\r\n  }\r\n  render() {\r\n    return (\r\n      <div class=\"sheet-container\">\r\n        <ir-title class=\"title sheet-header px-1\" displayContext=\"sidebar\" label={!this.user ? 'Assingn Units' : `Assignment for ${this.user.name}`}></ir-title>\r\n        <section class=\"px-1 sheet-body\">\r\n          <table>\r\n            <thead>\r\n              <th class=\"sr-only\">{locales.entries.Lcz_RoomName}</th>\r\n              <th class=\"sr-only\">{locales.entries.Lcz_HousekeeperName}</th>\r\n              <th class=\"sr-only\">{locales.entries.Lcz_Actions}</th>\r\n            </thead>\r\n            <tbody>{this.renderRooms()}</tbody>\r\n          </table>\r\n        </section>\r\n        <div class=\"sheet-footer\">\r\n          <ir-button\r\n            onClickHandler={() => this.closeSideBar.emit(null)}\r\n            class=\"flex-fill\"\r\n            btn_styles=\"w-100 justify-content-center align-items-center\"\r\n            btn_color=\"secondary\"\r\n            text={locales.entries.Lcz_Cancel}\r\n          ></ir-button>\r\n          <ir-button\r\n            isLoading={isRequestPending('/Manage_Exposed_Assigned_Unit_To_HKM')}\r\n            onClickHandler={this.assignUnits.bind(this)}\r\n            class=\"flex-fill\"\r\n            btn_styles=\"w-100  justify-content-center align-items-center\"\r\n            text={locales.entries.Lcz_Confirm}\r\n          ></ir-button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"version":3}