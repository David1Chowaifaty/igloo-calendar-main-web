{"file":"ir-reallocation-form2.js","mappings":";;;;;;;;;;;;;;;;;AAAA,MAAM,qBAAqB,GAAG,2pDAA2pD,CAAC;AAC1rD,iCAAe,qBAAqB;;MCmBvB,kBAAkB;;;;;;IACrB,OAAO,CAAU;IACjB,UAAU,CAAS;IACnB,IAAI,CAAS;IACb,MAAM,CAAS;IAEd,IAAI,CAAS;IACb,IAAI,CAAO;IACX,SAAS,GAAuB,EAAE,CAAC;IACnC,YAAY,GAA0B,EAAE,CAAC;IACzC,MAAM,CAAiC;IACvC,eAAe,GAA0B,IAAI,CAAC;IAEb,UAAU,CAAqB;IAEjE,cAAc,GAAG,IAAI,cAAc,EAAE,CAAC;IACtC,aAAa,GAAG,IAAI,aAAa,EAAE,CAAC;IAE5C,iBAAiB;QACf,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,CAAC;QAC3B,IAAI,CAAC,IAAI,GAAGA,KAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;KACvD;IAEO,OAAO;QACb,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;SACpC;QACD,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YACpB,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;SACvC;QACD,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,UAAU,KAAK,IAAI,CAAC,UAAU,CAAC,CAAC;QAC5E,IAAI,CAAC,IAAI,EAAE;YACT,MAAM,IAAI,KAAK,CAAC,sCAAsC,IAAI,CAAC,UAAU,EAAE,CAAC,CAAC;SAC1E;QACD,OAAO,IAAI,CAAC;KACb;IAEO,MAAM,wBAAwB;QACpC,iBAAiB,CAAC,KAAK,CAAC,CAAC;QACzB,MAAM,gBAAgB,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,KAAK,IAAI,CAAC;QACrD,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC/C,IAAI;YACF,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,sBAAsB,CAAC;gBAC5D,SAAS;gBACT,OAAO;gBACP,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;gBACpC,eAAe,EAAE;oBACf,KAAK,EAAE,CAAC;oBACR,KAAK,EAAE,CAAC;iBACT;gBACD,QAAQ,EAAE,IAAI;gBACd,aAAa,EAAE,EAAE;gBACjB,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,QAAQ;gBAC/B,QAAQ,EAAE,gBAAgB,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,GAAG,IAAI;gBACzD,gBAAgB;gBAChB,uBAAuB,EAAE,EAAE;aAC5B,CAAC,CAAC;YACH,IAAI,CAAC,SAAS,GAAG,IAAiC,CAAC;SACpD;QAAC,OAAO,KAAK,EAAE;YACd,OAAO,CAAC,KAAK,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;SAClE;KACF;IAEO,QAAQ;QACd,OAAO;YACL,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,MAAM,CAAC,YAAY,CAAC;YACjD,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,MAAM,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC;SAC/H,CAAC;KACH;IAEO,MAAM,cAAc;QAC1B,IAAI;YACF,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YACnB,MAAM,YAAY,GAAG,kBAAkB,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACjE,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;YAC/C,MAAM,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,EAAE,YAAY,CAAC,OAAO,EAAE,SAAS,EAAE,OAAO,EAAE,YAAY,CAAC,WAAW,CAAC,CAAC;YACxH,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAC5B;QAAC,OAAO,KAAK,EAAE;YACd,MAAM,GAAG,GAA4B,EAAE,CAAC;YACxC,IAAI,KAAK,YAAY,QAAQ,EAAE;gBAC7B,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;gBACrB,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;oBACpB,GAAG,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;iBACvB,CAAC,CAAC;gBACH,IAAI,CAAC,MAAM,GAAG,EAAE,GAAG,GAAG,EAAE,CAAC;aAC1B;SACF;KACF;IAEO,kBAAkB,CAAC,MAA6B;QACtD,MAAM,MAAM,GAA0B,EAAE,GAAG,IAAI,CAAC,YAAY,EAAE,GAAG,MAAM,EAAE,CAAC;QAC1E,MAAM,eAAe,GAAG,aAAa,EAAE,QAAQ,EAAE,SAAS,CAAC;QAC3D,MAAM,cAAc,GAAG,aAAa,CAAC;YACnC,WAAW,EAAE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE;YAC7C,UAAU,EAAE,MAAM,EAAE,WAAW;YAC/B,SAAS,EAAE,eAAe;SAC3B,CAAC,CAAC;QAEH,MAAM,yBAAyB,GAAG,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;QAE9F,IAAI,KAAK,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE;YACjC,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;YACtC,IAAI,CAAC,yBAAyB,EAAE;gBAC9B,OAAO,MAAM,CAAC,WAAW,CAAC;aAC3B;SACF;aAAM;YACL,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;YAC5B,IAAI,CAAC,yBAAyB,EAAE;gBAC9B,IAAI,cAAc,EAAE;oBAClB,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC;iBACnD;qBAAM;oBACL,OAAO,MAAM,CAAC,WAAW,CAAC;iBAC3B;aACF;SACF;QAED,IAAI,CAAC,YAAY,GAAG,MAAM,CAAC;KAC5B;IACD,IAAY,OAAO;QACjB,MAAM,SAAS,GAAGA,KAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;QAC5D,MAAM,KAAK,GAAGA,KAAM,EAAE,CAAC;QACvB,IAAI,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;YAC7B,OAAO,SAAS,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;SACvC;QACD,OAAO,KAAK,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;KACnC;IACD,MAAM;QACJ,QACE,6DACE,EAAE,EAAE,IAAI,CAAC,MAAM,EACf,KAAK,EAAC,mBAAmB,EACzB,QAAQ,EAAE,CAAC;gBACT,CAAC,CAAC,cAAc,EAAE,CAAC;gBACnB,IAAI,CAAC,cAAc,EAAE,CAAC;aACvB,IAED,4DAAK,KAAK,EAAC,iBAAiB,IAC1B,qEAAc,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,kBAAkB,EAAE,KAAK,GAAiB,EACpH,0DAAG,KAAK,EAAC,kBAAkB,IACxB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,OAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,GAAG,OAAO,CAAC,OAAO,CAAC,iBAAiB,GAAG,EAAE,CAC5G,CACA,EACN,4DAAK,KAAK,EAAC,iBAAiB,IAC1B,6FACc,qBAAqB,EACjC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,YAAY,CAAC;;YAErC,OAAO,EAAE,IAAI,CAAC,OAAO,EACrB,aAAa,EAAE,IAAI,EACnB,KAAK,EAAC,OAAO,EACb,aAAa,EAAE,GAAG;gBAChB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC;aAC9B,GACsB,EACzB,yEAAkB,OAAO,EAAC,OAAO,EAAC,OAAO,EAAE,gBAAgB,CAAC,qBAAqB,CAAC,EAAE,cAAc,EAAE,MAAM,IAAI,CAAC,wBAAwB,EAAE,4BAEtH,CACf,EACL,IAAI,CAAC,MAAM,EAAE,WAAW,IAAI,0DAAG,KAAK,EAAC,eAAe,2BAAyB,EAC9E,uEACE,QAAQ,EAAE,CAAC;gBACT,MAAM,CAAC,WAAW,EAAE,OAAO,CAAC,GAAI,CAAC,CAAC,MAAc,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBAClE,IAAI,CAAC,kBAAkB,CAAC;oBACtB,WAAW,EAAE,MAAM,CAAC,WAAW,CAAC;oBAChC,OAAO,EAAE,MAAM,CAAC,OAAO,CAAC;iBACzB,CAAC,CAAC;aACJ,EACD,IAAI,EAAC,iBAAiB,EACtB,KAAK,EAAC,gBAAgB,IAErB,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC,QAAQ;YAC3B,IAAI,CAAC,QAAQ,CAAC,oBAAoB,EAAE;gBAClC,OAAO,IAAI,CAAC;aACb;YACD,MAAM,KAAK,GAAG,CAAC;gBACb,MAAM,OAAO,GAAG,IAAI,GAAG,EAAkB,CAAC;gBAC1C,KAAK,MAAM,QAAQ,IAAI,QAAQ,CAAC,SAAS,IAAI,EAAE,EAAE;oBAC/C,KAAK,MAAM,IAAI,IAAI,QAAQ,CAAC,gBAAgB,IAAI,EAAE,EAAE;wBAClD,IAAI,IAAI,CAAC,kBAAkB,EAAE;4BAC3B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;yBACpC;qBACF;iBACF;gBAED,OAAO,KAAK,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,EAAE,IAAI,CAAC,MAAM,EAAE,EAAE,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;aAC5D,GAAG,CAAC;YACL,QACE,EAAC,QAAQ,QACP,WAAK,GAAG,EAAE,eAAe,QAAQ,CAAC,EAAE,EAAE,EAAE,KAAK,EAAE,eAAe,IAC5D,WAAK,KAAK,EAAE,YAAY,IACtB,YAAM,KAAK,EAAC,gBAAgB,IAAE,QAAQ,CAAC,IAAI,CAAQ,CAC/C,CACF,EACL,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;gBACjB,MAAM,UAAU,GAAG,CAAC,KAAK,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;gBAC1C,MAAM,kBAAkB,GAAG,IAAI,CAAC,YAAY,EAAE,OAAO,KAAK,IAAI,CAAC,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,CAAC,CAAC;gBAC5I,QACE,gBACE,KAAK,EAAE,GAAG,QAAQ,CAAC,EAAE,IAAI,IAAI,CAAC,EAAE,EAAE,EAClC,OAAO,EAAE,IAAI,CAAC,YAAY,EAAE,OAAO,KAAK,IAAI,CAAC,EAAE,EAC/C,GAAG,EAAE,gBAAgB,IAAI,CAAC,EAAE,IAAI,CAAC,EAAE,EACnC,KAAK,EAAE,gBAAgB,UAAU,GAAG,sBAAsB,GAAG,EAAE,EAAE,IAEjE,gBAAO,IAAI,CAAC,IAAI,CAAQ,EACvB,kBAAkB,KACjB,oBAAc,KAAK,EAAE,IAAI,CAAC,YAAY,EAAE,WAAW,EAAE,MAAM,EAAE,kBAAkB,CAAC,KAAK,CAAC,WAAW,IAC/F,iBACE,IAAI,EAAC,OAAO,EACZ,WAAW,EAAC,0BAA0B,EACtC,KAAK,EAAE,IAAI,CAAC,YAAY,EAAE,WAAW,EAAE,QAAQ,EAAE,EACjD,QAAQ,EAAE,CAAC;wBACT,CAAC,CAAC,wBAAwB,EAAE,CAAC;wBAC7B,CAAC,CAAC,eAAe,EAAE,CAAC;wBACpB,IAAI,CAAC,kBAAkB,CAAC;4BACtB,WAAW,EAAE,MAAM,CAAE,CAAC,CAAC,MAA4B,CAAC,KAAK,CAAC;yBAC3D,CAAC,CAAC;qBACJ,IAEA,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,MAAM;oBAC9B,OAAO,iBAAW,KAAK,EAAE,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE,IAAG,MAAM,CAAC,IAAI,GAAG,GAAG,MAAM,CAAC,WAAW,GAAG,KAAK,GAAG,EAAE,GAAG,MAAM,CAAC,WAAW,EAAE,CAAa,CAAC;iBAC1I,CAAC,CACQ,CACC,CAChB,CACQ,EACX;aACH,CAAC,CACO,EACX;SACH,CAAC,CACa,CACZ,EACP;KACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","names":["moment"],"sources":["src/components/ir-reallocation-drawer/ir-reallocation-form/ir-reallocation-form.css?tag=ir-reallocation-form&encapsulation=scoped","src/components/ir-reallocation-drawer/ir-reallocation-form/ir-reallocation-form.tsx"],"sourcesContent":[":host {\n  display: block;\n  color: var(--ir-text-color, #1f2a37);\n  font-family: var(--ir-font-family, 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif);\n}\n\n.reallocation-form {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.booking-summary {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.rateplan-details {\n  margin: 0;\n  font-weight: 500;\n  color: var(--ir-muted-text-color, #4b5563);\n}\n\n.date-picker-row {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 0.5rem;\n  align-items: flex-end;\n}\n\n.date-picker-row .ir-custom-date-picker {\n  flex: 1 1 220px;\n}\n\n.error-message {\n  margin: 0;\n  margin-top: 0.75rem;\n  color: var(--ir-error-color, #c0392b);\n  font-size: 0.95rem;\n}\n\n.room-type-list {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n  margin-top: 0.75rem;\n}\n\n.choice-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 0.5rem;\n}\n\n.room-type-name {\n  font-weight: 600;\n  color: var(--ir-heading-color, #111827);\n}\n\n.physical-room {\n  display: flex;\n  align-items: center;\n  font-size: 0.95rem;\n  padding-inline-start: 1rem;\n}\n.physical-room::part(label) {\n  display: flex;\n  align-items: center;\n}\n.physical-room + .physical-room {\n  margin-top: 0.5rem;\n}\n\n.physical-room--last {\n  margin-bottom: 0.25rem;\n}\n\n.physical-room wa-select {\n  margin-left: 1rem;\n  min-width: 220px;\n}\n.custom-date-picker {\n  max-width: 200px;\n}\n.room-type-row {\n  margin-bottom: 0.5rem;\n}\n","import { SelectedUnit, SelectedUnitSchema } from '@/components/igloo-calendar/igl-split-booking/types';\nimport { Booking, Room } from '@/models/booking.dto';\nimport { PropertyRoomType } from '@/models/IBooking';\nimport { BookingService } from '@/services/booking-service/booking.service';\nimport { EventsService } from '@/services/events.service';\nimport { resetBookingStore } from '@/stores/booking.store';\nimport calendar_data from '@/stores/calendar-data';\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\nimport locales from '@/stores/locales.store';\nimport { calculateDaysBetweenDates } from '@/utils/booking';\nimport { checkMealPlan, SelectOption } from '@/utils/utils';\nimport { Component, Event, EventEmitter, Fragment, Prop, State, h } from '@stencil/core';\nimport moment, { Moment } from 'moment';\nimport { ZodError } from 'zod';\n\n@Component({\n  tag: 'ir-reallocation-form',\n  styleUrl: 'ir-reallocation-form.css',\n  scoped: true,\n})\nexport class IrReallocationForm {\n  @Prop() booking: Booking;\n  @Prop() identifier: string;\n  @Prop() pool: string;\n  @Prop() formId: string;\n\n  @State() date: Moment;\n  @State() room: Room;\n  @State() roomTypes: PropertyRoomType[] = [];\n  @State() selectedUnit: Partial<SelectedUnit> = {};\n  @State() errors: Record<string, boolean> | null;\n  @State() mealPlanOptions: SelectOption[] | null = null;\n\n  @Event({ bubbles: true, composed: true }) closeModal: EventEmitter<null>;\n\n  private bookingService = new BookingService();\n  private eventsService = new EventsService();\n\n  componentWillLoad() {\n    this.room = this.getRoom();\n    this.date = moment(this.room.from_date, 'YYYY-MM-DD');\n  }\n\n  private getRoom() {\n    if (!this.booking) {\n      throw new Error('Missing booking');\n    }\n    if (!this.identifier) {\n      throw new Error('Missing Identifier');\n    }\n    const room = this.booking.rooms.find(r => r.identifier === this.identifier);\n    if (!room) {\n      throw new Error(`Couldn't find room with identifier ${this.identifier}`);\n    }\n    return room;\n  }\n\n  private async checkBookingAvailability() {\n    resetBookingStore(false);\n    const is_in_agent_mode = this.booking.agent !== null;\n    const { from_date, to_date } = this.getDates();\n    try {\n      const data = await this.bookingService.getBookingAvailability({\n        from_date,\n        to_date,\n        propertyid: this.booking.property.id,\n        adultChildCount: {\n          adult: 1,\n          child: 0,\n        },\n        language: 'en',\n        room_type_ids: [],\n        currency: this.booking.currency,\n        agent_id: is_in_agent_mode ? this.booking.agent.id : null,\n        is_in_agent_mode,\n        room_type_ids_to_update: [],\n      });\n      this.roomTypes = data as any as PropertyRoomType[];\n    } catch (error) {\n      console.error('Error initializing booking availability:', error);\n    }\n  }\n\n  private getDates(): { from_date: string; to_date: string } {\n    return {\n      from_date: this.date.clone().format('YYYY-MM-DD'),\n      to_date: this.date.clone().add(calculateDaysBetweenDates(this.room.from_date, this.room.to_date), 'days').format('YYYY-MM-DD'),\n    };\n  }\n\n  private async reallocateUnit() {\n    try {\n      this.errors = null;\n      const selectedUnit = SelectedUnitSchema.parse(this.selectedUnit);\n      const { from_date, to_date } = this.getDates();\n      await this.eventsService.reallocateEvent(this.pool, selectedUnit.unit_id, from_date, to_date, selectedUnit.rateplan_id);\n      this.closeModal.emit(null);\n    } catch (error) {\n      const err: Record<string, boolean> = {};\n      if (error instanceof ZodError) {\n        console.error(error);\n        error.issues.forEach(i => {\n          err[i.path[0]] = true;\n        });\n        this.errors = { ...err };\n      }\n    }\n  }\n\n  private updateSelectedUnit(params: Partial<SelectedUnit>) {\n    const merged: Partial<SelectedUnit> = { ...this.selectedUnit, ...params };\n    const roomTypesSource = calendar_data?.property?.roomtypes;\n    const mealPlanResult = checkMealPlan({\n      rateplan_id: this.room.rateplan.id.toString(),\n      roomTypeId: merged?.roomtype_id,\n      roomTypes: roomTypesSource,\n    });\n\n    const hasExplicitRateplanUpdate = Object.prototype.hasOwnProperty.call(params, 'rateplan_id');\n\n    if (Array.isArray(mealPlanResult)) {\n      this.mealPlanOptions = mealPlanResult;\n      if (!hasExplicitRateplanUpdate) {\n        delete merged.rateplan_id;\n      }\n    } else {\n      this.mealPlanOptions = null;\n      if (!hasExplicitRateplanUpdate) {\n        if (mealPlanResult) {\n          merged.rateplan_id = Number(mealPlanResult.value);\n        } else {\n          delete merged.rateplan_id;\n        }\n      }\n    }\n\n    this.selectedUnit = merged;\n  }\n  private get minDate() {\n    const MFromDate = moment(this.room.from_date, 'YYYY-MM-DD');\n    const today = moment();\n    if (MFromDate.isBefore(today)) {\n      return MFromDate.format('YYYY-MM-DD');\n    }\n    return today.format('YYYY-MM-DD');\n  }\n  render() {\n    return (\n      <form\n        id={this.formId}\n        class=\"reallocation-form\"\n        onSubmit={e => {\n          e.preventDefault();\n          this.reallocateUnit();\n        }}\n      >\n        <div class=\"booking-summary\">\n          <ir-date-view from_date={this.room.from_date} to_date={this.room.to_date} showDateDifference={false}></ir-date-view>\n          <p class=\"rateplan-details\">\n            {this.room.rateplan.short_name} {this.room.rateplan.is_non_refundable ? locales.entries.Lcz_NonRefundable : ''}\n          </p>\n        </div>\n        <div class=\"date-picker-row\">\n          <ir-custom-date-picker\n            data-testid=\"pickup_arrival_date\"\n            date={this.date?.format('YYYY-MM-DD')}\n            // maxDate={this.defaultDates?.to_date.format('YYYY-MM-DD')}\n            minDate={this.minDate}\n            emitEmptyDate={true}\n            label=\"From:\"\n            onDateChanged={evt => {\n              this.date = evt.detail.start;\n            }}\n          ></ir-custom-date-picker>\n          <ir-custom-button variant=\"brand\" loading={isRequestPending('/Check_Availability')} onClickHandler={() => this.checkBookingAvailability()}>\n            Check available units\n          </ir-custom-button>\n        </div>\n        {this.errors?.roomtype_id && <p class=\"error-message\">Please select a room</p>}\n        <wa-radio-group\n          onchange={e => {\n            const [roomtype_id, unit_id] = (e.target as any).value.split('_');\n            this.updateSelectedUnit({\n              roomtype_id: Number(roomtype_id),\n              unit_id: Number(unit_id),\n            });\n          }}\n          name=\"available-units\"\n          class=\"room-type-list\"\n        >\n          {this.roomTypes?.map(roomType => {\n            if (!roomType.is_available_to_book) {\n              return null;\n            }\n            const units = (() => {\n              const unitMap = new Map<number, string>();\n              for (const rateplan of roomType.rateplans ?? []) {\n                for (const unit of rateplan.assignable_units ?? []) {\n                  if (unit.Is_Fully_Available) {\n                    unitMap.set(unit.pr_id, unit.name);\n                  }\n                }\n              }\n\n              return Array.from(unitMap, ([id, name]) => ({ id, name }));\n            })();\n            return (\n              <Fragment>\n                <div key={`roomTypeRow-${roomType.id}`} class={`room-type-row`}>\n                  <div class={'choice-row'}>\n                    <span class=\"room-type-name\">{roomType.name}</span>\n                  </div>\n                </div>\n                {units.map((room, j) => {\n                  const isLastUnit = j === units.length - 1;\n                  const showMealPlanSelect = this.selectedUnit?.unit_id === room.id && Array.isArray(this.mealPlanOptions) && this.mealPlanOptions.length > 0;\n                  return (\n                    <wa-radio\n                      value={`${roomType.id}_${room.id}`}\n                      checked={this.selectedUnit?.unit_id === room.id}\n                      key={`physicalRoom-${room.id}-${j}`}\n                      class={`physical-room${isLastUnit ? ' physical-room--last' : ''}`}\n                    >\n                      <span>{room.name}</span>\n                      {showMealPlanSelect && (\n                        <ir-validator value={this.selectedUnit?.rateplan_id} schema={SelectedUnitSchema.shape.rateplan_id}>\n                          <wa-select\n                            size=\"small\"\n                            placeholder=\"Select a new rateplan...\"\n                            value={this.selectedUnit?.rateplan_id?.toString()}\n                            onchange={e => {\n                              e.stopImmediatePropagation();\n                              e.stopPropagation();\n                              this.updateSelectedUnit({\n                                rateplan_id: Number((e.target as HTMLSelectElement).value),\n                              });\n                            }}\n                          >\n                            {this.mealPlanOptions.map(option => {\n                              return <wa-option value={option.value?.toString()}>{option.text + `${option.custom_text ? ' | ' : ''}${option.custom_text}`}</wa-option>;\n                            })}\n                          </wa-select>\n                        </ir-validator>\n                      )}\n                    </wa-radio>\n                  );\n                })}\n              </Fragment>\n            );\n          })}\n        </wa-radio-group>\n      </form>\n    );\n  }\n}\n"],"version":3}