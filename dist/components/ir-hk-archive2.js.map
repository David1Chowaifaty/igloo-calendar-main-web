{"file":"ir-hk-archive2.js","mappings":"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","names":["__stencil_proxyCustomElement","moment"],"sources":["src/components/ir-housekeeping/ir-hk-tasks/ir-hk-archive/ir-hk-archive.css?tag=ir-hk-archive&encapsulation=scoped","src/components/ir-housekeeping/ir-hk-tasks/ir-hk-archive/ir-hk-archive.tsx"],"sourcesContent":[":host {\r\n  display: block;\r\n}\r\n.unit-name {\r\n  max-width: 100px;\r\n  display: inline-block;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n","// import { HouseKeepingService } from '@/services/housekeeping.service';\r\n// import housekeeping_store from '@/stores/housekeeping.store';\r\nimport { ArchivedTask } from '@/models/housekeeping';\r\nimport { HouseKeepingService } from '@/services/housekeeping.service';\r\nimport calendar_data from '@/stores/calendar-data';\r\nimport housekeeping_store from '@/stores/housekeeping.store';\r\nimport { isRequestPending } from '@/stores/ir-interceptor.store';\r\nimport locales from '@/stores/locales.store';\r\nimport { downloadFile } from '@/utils/utils';\r\nimport { Component, Fragment, Host, Listen, Prop, State, h } from '@stencil/core';\r\nimport moment from 'moment';\r\nimport { v4 } from 'uuid';\r\nexport type ArchivesFilters = {\r\n  from_date: string;\r\n  to_date: string;\r\n  filtered_by_hkm?: number[];\r\n  filtered_by_unit?: number[];\r\n};\r\n@Component({\r\n  tag: 'ir-hk-archive',\r\n  styleUrl: 'ir-hk-archive.css',\r\n  scoped: true,\r\n})\r\nexport class IrHkArchive {\r\n  @Prop() propertyId: string | number;\r\n  @Prop() language: string = 'en';\r\n  @Prop() ticket: string;\r\n\r\n  @State() filters: ArchivesFilters = {\r\n    from_date: null,\r\n    to_date: null,\r\n    filtered_by_hkm: [],\r\n    filtered_by_unit: [],\r\n  };\r\n  @State() data: (ArchivedTask & { id: string })[] = [];\r\n  @State() isLoading: 'search' | 'excel' | null = null;\r\n  @State() fetchedData: boolean = false;\r\n  @State() selectedBooking: number | string | null;\r\n\r\n  private houseKeepingService = new HouseKeepingService();\r\n  private units: { id: number; name: string }[] = [];\r\n  private handleSideBarToggle(e) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    this.selectedBooking = null;\r\n  }\r\n\r\n  componentWillLoad() {\r\n    this.setUpUnits();\r\n  }\r\n  private setUpUnits() {\r\n    const units = [];\r\n    calendar_data.roomsInfo.forEach(r => {\r\n      r.physicalrooms.forEach(room => {\r\n        units.push({ id: room.id, name: room.name });\r\n      });\r\n    });\r\n    this.units = units;\r\n  }\r\n\r\n  private async getArchivedTasks(export_to_excel: boolean = false) {\r\n    const res = await this.houseKeepingService.getArchivedHKTasks({ property_id: Number(this.propertyId), ...this.filters, is_export_to_excel: export_to_excel });\r\n    this.data = [...(res?.tasks || [])]?.map(t => ({ ...t, id: v4() }));\r\n    this.fetchedData = true;\r\n    return { tasks: res?.tasks, url: res?.url };\r\n  }\r\n\r\n  @Listen('dateRangeChanged')\r\n  handleDateRangeChange(e: CustomEvent) {\r\n    e.stopImmediatePropagation();\r\n    e.stopPropagation();\r\n    const { fromDate, toDate } = e.detail;\r\n    this.updateFilters({\r\n      from_date: fromDate ? fromDate.format('YYYY-MM-DD') : null,\r\n      to_date: toDate ? toDate.format('YYYY-MM-DD') : null,\r\n    });\r\n  }\r\n\r\n  private updateFilters(props: Partial<ArchivesFilters>) {\r\n    this.filters = { ...this.filters, ...props };\r\n  }\r\n  async searchArchive(e: CustomEvent) {\r\n    try {\r\n      e.stopImmediatePropagation();\r\n      e.stopPropagation();\r\n      this.isLoading = 'search';\r\n      await this.getArchivedTasks();\r\n    } catch (error) {\r\n      console.log(error);\r\n    } finally {\r\n      this.isLoading = null;\r\n    }\r\n  }\r\n\r\n  async exportArchive(e: CustomEvent) {\r\n    try {\r\n      e.stopImmediatePropagation();\r\n      e.stopPropagation();\r\n      this.isLoading = 'excel';\r\n      const { url } = await this.getArchivedTasks(true);\r\n      downloadFile(url);\r\n    } catch (error) {\r\n      console.log(error);\r\n    } finally {\r\n      this.isLoading = null;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <Host>\r\n        <ir-title class=\"px-1\" label=\"Cleaning Archives (90 days)\" displayContext=\"sidebar\"></ir-title>\r\n        <section class=\"px-1\">\r\n          <div class=\"d-flex\">\r\n            <ir-select\r\n              class=\"w-100\"\r\n              showFirstOption={false}\r\n              LabelAvailable={false}\r\n              data={[\r\n                { text: 'All units', value: '000' },\r\n                ,\r\n                ...this.units\r\n                  ?.map(v => ({\r\n                    text: v.name,\r\n                    value: v.id.toString(),\r\n                  }))\r\n                  .sort((a, b) => a.text.toLowerCase().localeCompare(b.text.toLowerCase())),\r\n              ]}\r\n              onSelectChange={e => {\r\n                e.stopImmediatePropagation();\r\n                e.stopPropagation();\r\n                if (e.detail === '000') {\r\n                  this.updateFilters({ filtered_by_unit: [] });\r\n                } else {\r\n                  this.updateFilters({ filtered_by_unit: [e.detail] });\r\n                }\r\n              }}\r\n            ></ir-select>\r\n            {housekeeping_store?.hk_criteria?.housekeepers.length > 1 && (\r\n              <ir-select\r\n                class=\"ml-1 w-100\"\r\n                selectedValue={this.filters?.filtered_by_hkm?.length === housekeeping_store.hk_criteria.housekeepers.length ? '000' : this.filters?.filtered_by_hkm[0]?.toString()}\r\n                LabelAvailable={false}\r\n                showFirstOption={false}\r\n                data={[\r\n                  { text: 'All housekeepers', value: '000' },\r\n                  ...housekeeping_store?.hk_criteria?.housekeepers\r\n                    .map(v => ({\r\n                      text: v.name,\r\n                      value: v.id.toString(),\r\n                    }))\r\n                    .sort((a, b) => a.text.toLowerCase().localeCompare(b.text.toLowerCase())),\r\n                ]}\r\n                onSelectChange={e => {\r\n                  if (e.detail === '000') {\r\n                    this.updateFilters({ filtered_by_hkm: [] });\r\n                  } else {\r\n                    this.updateFilters({ filtered_by_hkm: [e.detail] });\r\n                  }\r\n                }}\r\n              ></ir-select>\r\n            )}\r\n          </div>\r\n          <div class=\"d-flex mt-1 align-items-center\">\r\n            {/* <igl-date-range\r\n              class=\"mr-1\"\r\n              dateLabel={locales.entries.Lcz_Dates}\r\n              minDate={moment().add(-90, 'days').format('YYYY-MM-DD')}\r\n              defaultData={{\r\n                fromDate: this.filters.from_date,\r\n                toDate: this.filters.to_date,\r\n              }}\r\n            ></igl-date-range> */}\r\n            <ir-range-picker\r\n              class=\"mr-1\"\r\n              fromDate={this.filters.from_date ? moment(this.filters.from_date, 'YYYY-MM-DD') : null}\r\n              toDate={this.filters.to_date ? moment(this.filters.to_date, 'YYYY-MM-DD') : null}\r\n            ></ir-range-picker>\r\n            <ir-button\r\n              title={locales.entries?.Lcz_Search}\r\n              variant=\"icon\"\r\n              icon_name=\"search\"\r\n              class=\"mr-1\"\r\n              isLoading={this.isLoading === 'search'}\r\n              onClickHandler={e => this.searchArchive(e)}\r\n            ></ir-button>\r\n            <ir-button\r\n              title={locales.entries?.Lcz_ExportToExcel}\r\n              variant=\"icon\"\r\n              icon_name=\"file\"\r\n              isLoading={this.isLoading === 'excel'}\r\n              onClickHandler={e => this.exportArchive(e)}\r\n            ></ir-button>\r\n          </div>\r\n          {this.fetchedData && (\r\n            <Fragment>\r\n              {this.data?.length === 0 && !isRequestPending('/Get_Archived_HK_Tasks') ? (\r\n                <p class={'text-center mt-2'}>No Results Found</p>\r\n              ) : (\r\n                <table class=\"mt-2\">\r\n                  <thead>\r\n                    <th class=\"sr-only\">period</th>\r\n                    <th class=\"sr-only\">housekeeper name</th>\r\n                    <th class=\"sr-only\">unit</th>\r\n                    <th class=\"sr-only\">booking number</th>\r\n                  </thead>\r\n                  <tbody>\r\n                    {this.data?.map(d => (\r\n                      <tr key={d.id}>\r\n                        <td class=\"pr-2\">{d.date}</td>\r\n                        <td class=\"px-2\">{d.house_keeper}</td>\r\n                        <td class=\"px-2\">\r\n                          <ir-tooltip message={d.unit} customSlot>\r\n                            <span slot=\"tooltip-trigger\" class={`unit-name`}>\r\n                              {d.unit}\r\n                            </span>\r\n                          </ir-tooltip>\r\n                        </td>\r\n                        <td class=\"px-2\">\r\n                          {d.booking_nbr ? (\r\n                            <ir-button\r\n                              btn_color=\"link\"\r\n                              btnStyle={{\r\n                                width: 'fit-content',\r\n                                padding: '0',\r\n                                margin: '0',\r\n                              }}\r\n                              labelStyle={{\r\n                                padding: '0',\r\n                              }}\r\n                              text={d.booking_nbr.toString()}\r\n                              onClick={() => {\r\n                                this.selectedBooking = d.booking_nbr;\r\n                                // window.open(`https://x.igloorooms.com/manage/acbookingeditV2.aspx?BN=${d.booking_nbr}`, '_blank');\r\n                              }}\r\n                            ></ir-button>\r\n                          ) : (\r\n                            'N/A'\r\n                          )}\r\n                        </td>\r\n                      </tr>\r\n                    ))}\r\n                  </tbody>\r\n                </table>\r\n              )}\r\n            </Fragment>\r\n          )}\r\n        </section>\r\n        <ir-sidebar\r\n          onIrSidebarToggle={this.handleSideBarToggle.bind(this)}\r\n          open={!!this.selectedBooking}\r\n          showCloseButton={false}\r\n          sidebarStyles={{\r\n            width: '80rem',\r\n            background: '#F2F3F8',\r\n          }}\r\n        >\r\n          {this.selectedBooking && (\r\n            <ir-booking-details\r\n              slot=\"sidebar-body\"\r\n              hasPrint\r\n              hasReceipt\r\n              hasCloseButton\r\n              onCloseSidebar={() => (this.selectedBooking = null)}\r\n              is_from_front_desk\r\n              propertyid={Number(this.propertyId)}\r\n              hasRoomEdit\r\n              hasRoomDelete\r\n              bookingNumber={this.selectedBooking?.toString()}\r\n              language={this.language}\r\n              hasRoomAdd\r\n              ticket={this.ticket}\r\n            ></ir-booking-details>\r\n          )}\r\n        </ir-sidebar>\r\n      </Host>\r\n    );\r\n  }\r\n}\r\n"],"version":3}